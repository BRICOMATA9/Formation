!function(e){var t={};function i(n){if(t[n])return t[n].exports;var a=t[n]={i:n,l:!1,exports:{}};return e[n].call(a.exports,a,a.exports,i),a.l=!0,a.exports}i.m=e,i.c=t,i.d=function(e,t,n){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:n})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var n=Object.create(null);if(i.r(n),Object.defineProperty(n,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var a in e)i.d(n,a,function(t){return e[t]}.bind(null,a));return n},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="/travel/static-content/versioned_IA97spT9oP/js/",i(i.s=1114)}([function(e,t,i){"use strict";var n,a,s;n=["category","action","label","page","funnel","legacy","optimize"],a=function(e){return _.isString(e)&&!_.isEmpty(e)},s=function(e,t){Odigeo.trigger("analytics:tracking",{type:e,data:t})},e.exports={bindEvents:function(e){e.off(".tracking").on(Odigeo.Events.tap+".tracking","[data-auto-tracking]",_.bind(this.processTrackingHandler,this,_,Odigeo.History.getPageNameFromFragment())),Odigeo.off("widgetstracking:eventtrack").on("widgetstracking:eventtrack",_.partial(this.processTracking,_,Odigeo.History.getPageNameFromFragment().split("/")[0]))},trackEvent:function(e,t,i,n){a(e)&&a(t)&&this.processTracking({action:e,label:t,optimize:n},i)},trackPage:function(e,t){Odigeo.trigger("analytics:tracking",{type:"trackVirtualPage",data:{page:e,funnel:_.result(t,"funnel",!0),legacy:_.result(t,"legacy"),error:_.result(t,"error")}})},setCustomDimension:function(e,t){Odigeo.trigger("analytics:tracking",{type:"setCustomDimension",data:{customDimension:e,value:t}})},processTrackingHandler:function(e,t){var i=$(e.currentTarget),n=_.clone(i.data("autoTracking"));this.processTracking(n,t)},processTracking:function(e,t){var i=t||Odigeo.History.getPageNameFromFragment().split("/")[0],a=_.extend({category:i,page:i},_.pick(e,n));s(!_.isUndefined(e)&&e.gaType?e.gaType:"trackEvent",a)},trackEventWithCategory:function(e,t,i){s("trackEvent",{category:e,action:t,label:i})},trackStop:function(e){$.post(Odigeo.Settings.getProperty("metricServiceUrlFormatter")("stopMetric/"+e))},startMetric:function(e){Odigeo.Session.set(e,Date.now())},stopMetric:function(e){var t=Date.now(),i=Odigeo.Session.get(e),n=Odigeo.Session.get("disableGrafana");Odigeo.Session.remove(e),"true"!==n&&i&&$.post(Odigeo.Settings.getProperty("metricServiceUrlFormatter")("trackTime"),{key:e,time:t-i})},counterMetric:function(e){"true"!==Odigeo.Session.get("disableGrafana")&&$.post(Odigeo.Settings.getProperty("metricServiceUrlFormatter")("counterMetric/"+e),{})},trackTimeMetric:function(e,t){$.post(Odigeo.Settings.getProperty("metricServiceUrlFormatter")("trackTime"),{key:e,time:Odigeo.Utils.getDifferenceInMilliseconds(t,new Date)})},trackEventIfCondition:function(e,t,i,n){n&&this.trackEventWithCategory(e,t,i)},addCrossDomainIframesTracking:function(){var e=$("iframe.tracking-cross-domain");_.forEach(e,function(e){s("addCrossDomainIframeTracking",e)})},openExternalLink:function(e,t){s("sendToPageBlank",{url:e,goOutside:!0,onlyUniversal:t||!1})},trackPromo:function(e,t){s("trackPromo",{promo:{id:e.data("track-id"),name:e.data("track-name"),creative:e.data("track-creative"),position:e.data("track-position")},isClick:t})},trackInternalCampaigns:function(){var e=$(".internal-campaign-tracking");_.forEach(e,function(e){var t=$(e);this.trackPromo(t),t.on(Odigeo.Events.tap,_.bind(this.trackPromo,this,t,!0))},this),s("trackPromo",{promo:{id:"XX",name:"XX",creative:"XX",position:"XX"}})},pushOptimizeWidget:function(e,t){Odigeo.trigger("analytics:tracking",{type:"pushOptimizeWidget",data:{page:e,funnel:!0,widgetName:t}})},decorateAppTouchpointUrl:function(e){var t="";return Odigeo.requireWidget("google-analytics","googleanalytics",function(i){t=i.get("getDecoratedAppTouchpointUrl",e)}),t},trackEcommerce:function(e){s("trackECommerce",e)},getClientId:function(){return _.has(window,"ga.getAll")&&!_.isEmpty(window.ga.getAll())?window.ga.getAll()[0].get("clientId"):"not-initialized"}}},function(e,t){"function"==typeof Object.create?e.exports=function(e,t){e.super_=t,e.prototype=Object.create(t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}})}:e.exports=function(e,t){e.super_=t;var i=function(){};i.prototype=t.prototype,e.prototype=new i,e.prototype.constructor=e}},function(e,t,i){var n=i(3),a=n.Buffer;function s(e,t){for(var i in e)t[i]=e[i]}function r(e,t,i){return a(e,t,i)}a.from&&a.alloc&&a.allocUnsafe&&a.allocUnsafeSlow?e.exports=n:(s(n,t),t.Buffer=r),s(a,r),r.from=function(e,t,i){if("number"==typeof e)throw new TypeError("Argument must not be a number");return a(e,t,i)},r.alloc=function(e,t,i){if("number"!=typeof e)throw new TypeError("Argument must be a number");var n=a(e);return void 0!==t?"string"==typeof i?n.fill(t,i):n.fill(t):n.fill(0),n},r.allocUnsafe=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return a(e)},r.allocUnsafeSlow=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return n.SlowBuffer(e)}},function(e,t,i){"use strict";(function(e){
/*!
 * The buffer module from node.js, for the browser.
 *
 * @author   Feross Aboukhadijeh <feross@feross.org> <http://feross.org>
 * @license  MIT
 */
var n=i(214),a=i(215),s=i(103);function r(){return c.TYPED_ARRAY_SUPPORT?2147483647:1073741823}function o(e,t){if(r()<t)throw new RangeError("Invalid typed array length");return c.TYPED_ARRAY_SUPPORT?(e=new Uint8Array(t)).__proto__=c.prototype:(null===e&&(e=new c(t)),e.length=t),e}function c(e,t,i){if(!(c.TYPED_ARRAY_SUPPORT||this instanceof c))return new c(e,t,i);if("number"!=typeof e)return d(this,e,t,i);if("string"==typeof t)throw new Error("If encoding is specified then the first argument must be a string");return g(this,e)}function d(e,t,i,n){if("number"==typeof t)throw new TypeError('"value" argument must not be a number');return"undefined"!=typeof ArrayBuffer&&t instanceof ArrayBuffer?function(e,t,i,n){if(t.byteLength,i<0||t.byteLength<i)throw new RangeError("'offset' is out of bounds");if(t.byteLength<i+(n||0))throw new RangeError("'length' is out of bounds");return t=void 0===i&&void 0===n?new Uint8Array(t):void 0===n?new Uint8Array(t,i):new Uint8Array(t,i,n),c.TYPED_ARRAY_SUPPORT?(e=t).__proto__=c.prototype:e=h(e,t),e}(e,t,i,n):"string"==typeof t?function(e,t,i){if("string"==typeof i&&""!==i||(i="utf8"),!c.isEncoding(i))throw new TypeError('"encoding" must be a valid string encoding');var n=0|p(t,i),a=(e=o(e,n)).write(t,i);return a!==n&&(e=e.slice(0,a)),e}(e,t,i):function(e,t){if(c.isBuffer(t)){var i=0|u(t.length);return 0===(e=o(e,i)).length||t.copy(e,0,0,i),e}if(t){if("undefined"!=typeof ArrayBuffer&&t.buffer instanceof ArrayBuffer||"length"in t)return"number"!=typeof t.length||(n=t.length)!=n?o(e,0):h(e,t);if("Buffer"===t.type&&s(t.data))return h(e,t.data)}var n;throw new TypeError("First argument must be a string, Buffer, ArrayBuffer, Array, or array-like object.")}(e,t)}function l(e){if("number"!=typeof e)throw new TypeError('"size" argument must be a number');if(e<0)throw new RangeError('"size" argument must not be negative')}function g(e,t){if(l(t),e=o(e,t<0?0:0|u(t)),!c.TYPED_ARRAY_SUPPORT)for(var i=0;i<t;++i)e[i]=0;return e}function h(e,t){var i=t.length<0?0:0|u(t.length);e=o(e,i);for(var n=0;n<i;n+=1)e[n]=255&t[n];return e}function u(e){if(e>=r())throw new RangeError("Attempt to allocate Buffer larger than maximum size: 0x"+r().toString(16)+" bytes");return 0|e}function p(e,t){if(c.isBuffer(e))return e.length;if("undefined"!=typeof ArrayBuffer&&"function"==typeof ArrayBuffer.isView&&(ArrayBuffer.isView(e)||e instanceof ArrayBuffer))return e.byteLength;"string"!=typeof e&&(e=""+e);var i=e.length;if(0===i)return 0;for(var n=!1;;)switch(t){case"ascii":case"latin1":case"binary":return i;case"utf8":case"utf-8":case void 0:return N(e).length;case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return 2*i;case"hex":return i>>>1;case"base64":return L(e).length;default:if(n)return N(e).length;t=(""+t).toLowerCase(),n=!0}}function f(e,t,i){var n=e[t];e[t]=e[i],e[i]=n}function m(e,t,i,n,a){if(0===e.length)return-1;if("string"==typeof i?(n=i,i=0):2147483647<i?i=2147483647:i<-2147483648&&(i=-2147483648),i=+i,isNaN(i)&&(i=a?0:e.length-1),i<0&&(i=e.length+i),i>=e.length){if(a)return-1;i=e.length-1}else if(i<0){if(!a)return-1;i=0}if("string"==typeof t&&(t=c.from(t,n)),c.isBuffer(t))return 0===t.length?-1:_(e,t,i,n,a);if("number"==typeof t)return t&=255,c.TYPED_ARRAY_SUPPORT&&"function"==typeof Uint8Array.prototype.indexOf?a?Uint8Array.prototype.indexOf.call(e,t,i):Uint8Array.prototype.lastIndexOf.call(e,t,i):_(e,[t],i,n,a);throw new TypeError("val must be string, number or Buffer")}function _(e,t,i,n,a){var s,r=1,o=e.length,c=t.length;if(void 0!==n&&("ucs2"===(n=String(n).toLowerCase())||"ucs-2"===n||"utf16le"===n||"utf-16le"===n)){if(e.length<2||t.length<2)return-1;o/=r=2,c/=2,i/=2}function d(e,t){return 1===r?e[t]:e.readUInt16BE(t*r)}if(a){var l=-1;for(s=i;s<o;s++)if(d(e,s)===d(t,-1===l?0:s-l)){if(-1===l&&(l=s),s-l+1===c)return l*r}else-1!==l&&(s-=s-l),l=-1}else for(o<i+c&&(i=o-c),s=i;0<=s;s--){for(var g=!0,h=0;h<c;h++)if(d(e,s+h)!==d(t,h)){g=!1;break}if(g)return s}return-1}function b(e,t,i,n){i=Number(i)||0;var a=e.length-i;n?a<(n=Number(n))&&(n=a):n=a;var s=t.length;if(s%2!=0)throw new TypeError("Invalid hex string");s/2<n&&(n=s/2);for(var r=0;r<n;++r){var o=parseInt(t.substr(2*r,2),16);if(isNaN(o))return r;e[i+r]=o}return r}function y(e,t,i,n){return U(function(e){for(var t=[],i=0;i<e.length;++i)t.push(255&e.charCodeAt(i));return t}(t),e,i,n)}function v(e,t,i){return 0===t&&i===e.length?n.fromByteArray(e):n.fromByteArray(e.slice(t,i))}function S(e,t,i){i=Math.min(e.length,i);for(var n=[],a=t;a<i;){var s,r,o,c,d=e[a],l=null,g=239<d?4:223<d?3:191<d?2:1;if(a+g<=i)switch(g){case 1:d<128&&(l=d);break;case 2:128==(192&(s=e[a+1]))&&127<(c=(31&d)<<6|63&s)&&(l=c);break;case 3:s=e[a+1],r=e[a+2],128==(192&s)&&128==(192&r)&&2047<(c=(15&d)<<12|(63&s)<<6|63&r)&&(c<55296||57343<c)&&(l=c);break;case 4:s=e[a+1],r=e[a+2],o=e[a+3],128==(192&s)&&128==(192&r)&&128==(192&o)&&65535<(c=(15&d)<<18|(63&s)<<12|(63&r)<<6|63&o)&&c<1114112&&(l=c)}null===l?(l=65533,g=1):65535<l&&(l-=65536,n.push(l>>>10&1023|55296),l=56320|1023&l),n.push(l),a+=g}return function(e){var t=e.length;if(t<=C)return String.fromCharCode.apply(String,e);for(var i="",n=0;n<t;)i+=String.fromCharCode.apply(String,e.slice(n,n+=C));return i}(n)}t.Buffer=c,t.SlowBuffer=function(e){return+e!=e&&(e=0),c.alloc(+e)},t.INSPECT_MAX_BYTES=50,c.TYPED_ARRAY_SUPPORT=void 0!==e.TYPED_ARRAY_SUPPORT?e.TYPED_ARRAY_SUPPORT:function(){try{var e=new Uint8Array(1);return e.__proto__={__proto__:Uint8Array.prototype,foo:function(){return 42}},42===e.foo()&&"function"==typeof e.subarray&&0===e.subarray(1,1).byteLength}catch(e){return!1}}(),t.kMaxLength=r(),c.poolSize=8192,c._augment=function(e){return e.__proto__=c.prototype,e},c.from=function(e,t,i){return d(null,e,t,i)},c.TYPED_ARRAY_SUPPORT&&(c.prototype.__proto__=Uint8Array.prototype,c.__proto__=Uint8Array,"undefined"!=typeof Symbol&&Symbol.species&&c[Symbol.species]===c&&Object.defineProperty(c,Symbol.species,{value:null,configurable:!0})),c.alloc=function(e,t,i){return n=null,s=t,r=i,l(a=e),a<=0?o(n,a):void 0!==s?"string"==typeof r?o(n,a).fill(s,r):o(n,a).fill(s):o(n,a);var n,a,s,r},c.allocUnsafe=function(e){return g(null,e)},c.allocUnsafeSlow=function(e){return g(null,e)},c.isBuffer=function(e){return!(null==e||!e._isBuffer)},c.compare=function(e,t){if(!c.isBuffer(e)||!c.isBuffer(t))throw new TypeError("Arguments must be Buffers");if(e===t)return 0;for(var i=e.length,n=t.length,a=0,s=Math.min(i,n);a<s;++a)if(e[a]!==t[a]){i=e[a],n=t[a];break}return i<n?-1:n<i?1:0},c.isEncoding=function(e){switch(String(e).toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"latin1":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return!0;default:return!1}},c.concat=function(e,t){if(!s(e))throw new TypeError('"list" argument must be an Array of Buffers');if(0===e.length)return c.alloc(0);var i;if(void 0===t)for(i=t=0;i<e.length;++i)t+=e[i].length;var n=c.allocUnsafe(t),a=0;for(i=0;i<e.length;++i){var r=e[i];if(!c.isBuffer(r))throw new TypeError('"list" argument must be an Array of Buffers');r.copy(n,a),a+=r.length}return n},c.byteLength=p,c.prototype._isBuffer=!0,c.prototype.swap16=function(){var e=this.length;if(e%2!=0)throw new RangeError("Buffer size must be a multiple of 16-bits");for(var t=0;t<e;t+=2)f(this,t,t+1);return this},c.prototype.swap32=function(){var e=this.length;if(e%4!=0)throw new RangeError("Buffer size must be a multiple of 32-bits");for(var t=0;t<e;t+=4)f(this,t,t+3),f(this,t+1,t+2);return this},c.prototype.swap64=function(){var e=this.length;if(e%8!=0)throw new RangeError("Buffer size must be a multiple of 64-bits");for(var t=0;t<e;t+=8)f(this,t,t+7),f(this,t+1,t+6),f(this,t+2,t+5),f(this,t+3,t+4);return this},c.prototype.toString=function(){var e=0|this.length;return 0===e?"":0===arguments.length?S(this,0,e):function(e,t,i){var n=!1;if((void 0===t||t<0)&&(t=0),t>this.length)return"";if((void 0===i||i>this.length)&&(i=this.length),i<=0)return"";if((i>>>=0)<=(t>>>=0))return"";for(e||(e="utf8");;)switch(e){case"hex":return T(this,t,i);case"utf8":case"utf-8":return S(this,t,i);case"ascii":return w(this,t,i);case"latin1":case"binary":return O(this,t,i);case"base64":return v(this,t,i);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return P(this,t,i);default:if(n)throw new TypeError("Unknown encoding: "+e);e=(e+"").toLowerCase(),n=!0}}.apply(this,arguments)},c.prototype.equals=function(e){if(!c.isBuffer(e))throw new TypeError("Argument must be a Buffer");return this===e||0===c.compare(this,e)},c.prototype.inspect=function(){var e="",i=t.INSPECT_MAX_BYTES;return 0<this.length&&(e=this.toString("hex",0,i).match(/.{2}/g).join(" "),this.length>i&&(e+=" ... ")),"<Buffer "+e+">"},c.prototype.compare=function(e,t,i,n,a){if(!c.isBuffer(e))throw new TypeError("Argument must be a Buffer");if(void 0===t&&(t=0),void 0===i&&(i=e?e.length:0),void 0===n&&(n=0),void 0===a&&(a=this.length),t<0||i>e.length||n<0||a>this.length)throw new RangeError("out of range index");if(a<=n&&i<=t)return 0;if(a<=n)return-1;if(i<=t)return 1;if(this===e)return 0;for(var s=(a>>>=0)-(n>>>=0),r=(i>>>=0)-(t>>>=0),o=Math.min(s,r),d=this.slice(n,a),l=e.slice(t,i),g=0;g<o;++g)if(d[g]!==l[g]){s=d[g],r=l[g];break}return s<r?-1:r<s?1:0},c.prototype.includes=function(e,t,i){return-1!==this.indexOf(e,t,i)},c.prototype.indexOf=function(e,t,i){return m(this,e,t,i,!0)},c.prototype.lastIndexOf=function(e,t,i){return m(this,e,t,i,!1)},c.prototype.write=function(e,t,i,n){if(void 0===t)n="utf8",i=this.length,t=0;else if(void 0===i&&"string"==typeof t)n=t,i=this.length,t=0;else{if(!isFinite(t))throw new Error("Buffer.write(string, encoding, offset[, length]) is no longer supported");t|=0,isFinite(i)?(i|=0,void 0===n&&(n="utf8")):(n=i,i=void 0)}var a=this.length-t;if((void 0===i||a<i)&&(i=a),0<e.length&&(i<0||t<0)||t>this.length)throw new RangeError("Attempt to write outside buffer bounds");n||(n="utf8");for(var s,r,o,c,d,l,g=!1;;)switch(n){case"hex":return b(this,e,t,i);case"utf8":case"utf-8":return d=t,l=i,U(N(e,this.length-d),this,d,l);case"ascii":return y(this,e,t,i);case"latin1":case"binary":return y(this,e,t,i);case"base64":return this,o=t,c=i,U(L(e),this,o,c);case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return s=t,r=i,U(function(e,t){for(var i,n,a,s=[],r=0;r<e.length&&!((t-=2)<0);++r)n=(i=e.charCodeAt(r))>>8,a=i%256,s.push(a),s.push(n);return s}(e,this.length-s),this,s,r);default:if(g)throw new TypeError("Unknown encoding: "+n);n=(""+n).toLowerCase(),g=!0}},c.prototype.toJSON=function(){return{type:"Buffer",data:Array.prototype.slice.call(this._arr||this,0)}};var C=4096;function w(e,t,i){var n="";i=Math.min(e.length,i);for(var a=t;a<i;++a)n+=String.fromCharCode(127&e[a]);return n}function O(e,t,i){var n="";i=Math.min(e.length,i);for(var a=t;a<i;++a)n+=String.fromCharCode(e[a]);return n}function T(e,t,i){var n=e.length;(!t||t<0)&&(t=0),(!i||i<0||n<i)&&(i=n);for(var a="",s=t;s<i;++s)a+=M(e[s]);return a}function P(e,t,i){for(var n=e.slice(t,i),a="",s=0;s<n.length;s+=2)a+=String.fromCharCode(n[s]+256*n[s+1]);return a}function E(e,t,i){if(e%1!=0||e<0)throw new RangeError("offset is not uint");if(i<e+t)throw new RangeError("Trying to access beyond buffer length")}function k(e,t,i,n,a,s){if(!c.isBuffer(e))throw new TypeError('"buffer" argument must be a Buffer instance');if(a<t||t<s)throw new RangeError('"value" argument is out of bounds');if(i+n>e.length)throw new RangeError("Index out of range")}function A(e,t,i,n){t<0&&(t=65535+t+1);for(var a=0,s=Math.min(e.length-i,2);a<s;++a)e[i+a]=(t&255<<8*(n?a:1-a))>>>8*(n?a:1-a)}function D(e,t,i,n){t<0&&(t=4294967295+t+1);for(var a=0,s=Math.min(e.length-i,4);a<s;++a)e[i+a]=t>>>8*(n?a:3-a)&255}function I(e,t,i,n,a,s){if(i+n>e.length)throw new RangeError("Index out of range");if(i<0)throw new RangeError("Index out of range")}function x(e,t,i,n,s){return s||I(e,0,i,4),a.write(e,t,i,n,23,4),i+4}function B(e,t,i,n,s){return s||I(e,0,i,8),a.write(e,t,i,n,52,8),i+8}c.prototype.slice=function(e,t){var i,n=this.length;if((e=~~e)<0?(e+=n)<0&&(e=0):n<e&&(e=n),(t=void 0===t?n:~~t)<0?(t+=n)<0&&(t=0):n<t&&(t=n),t<e&&(t=e),c.TYPED_ARRAY_SUPPORT)(i=this.subarray(e,t)).__proto__=c.prototype;else{var a=t-e;i=new c(a,void 0);for(var s=0;s<a;++s)i[s]=this[s+e]}return i},c.prototype.readUIntLE=function(e,t,i){e|=0,t|=0,i||E(e,t,this.length);for(var n=this[e],a=1,s=0;++s<t&&(a*=256);)n+=this[e+s]*a;return n},c.prototype.readUIntBE=function(e,t,i){e|=0,t|=0,i||E(e,t,this.length);for(var n=this[e+--t],a=1;0<t&&(a*=256);)n+=this[e+--t]*a;return n},c.prototype.readUInt8=function(e,t){return t||E(e,1,this.length),this[e]},c.prototype.readUInt16LE=function(e,t){return t||E(e,2,this.length),this[e]|this[e+1]<<8},c.prototype.readUInt16BE=function(e,t){return t||E(e,2,this.length),this[e]<<8|this[e+1]},c.prototype.readUInt32LE=function(e,t){return t||E(e,4,this.length),(this[e]|this[e+1]<<8|this[e+2]<<16)+16777216*this[e+3]},c.prototype.readUInt32BE=function(e,t){return t||E(e,4,this.length),16777216*this[e]+(this[e+1]<<16|this[e+2]<<8|this[e+3])},c.prototype.readIntLE=function(e,t,i){e|=0,t|=0,i||E(e,t,this.length);for(var n=this[e],a=1,s=0;++s<t&&(a*=256);)n+=this[e+s]*a;return(a*=128)<=n&&(n-=Math.pow(2,8*t)),n},c.prototype.readIntBE=function(e,t,i){e|=0,t|=0,i||E(e,t,this.length);for(var n=t,a=1,s=this[e+--n];0<n&&(a*=256);)s+=this[e+--n]*a;return(a*=128)<=s&&(s-=Math.pow(2,8*t)),s},c.prototype.readInt8=function(e,t){return t||E(e,1,this.length),128&this[e]?-1*(255-this[e]+1):this[e]},c.prototype.readInt16LE=function(e,t){t||E(e,2,this.length);var i=this[e]|this[e+1]<<8;return 32768&i?4294901760|i:i},c.prototype.readInt16BE=function(e,t){t||E(e,2,this.length);var i=this[e+1]|this[e]<<8;return 32768&i?4294901760|i:i},c.prototype.readInt32LE=function(e,t){return t||E(e,4,this.length),this[e]|this[e+1]<<8|this[e+2]<<16|this[e+3]<<24},c.prototype.readInt32BE=function(e,t){return t||E(e,4,this.length),this[e]<<24|this[e+1]<<16|this[e+2]<<8|this[e+3]},c.prototype.readFloatLE=function(e,t){return t||E(e,4,this.length),a.read(this,e,!0,23,4)},c.prototype.readFloatBE=function(e,t){return t||E(e,4,this.length),a.read(this,e,!1,23,4)},c.prototype.readDoubleLE=function(e,t){return t||E(e,8,this.length),a.read(this,e,!0,52,8)},c.prototype.readDoubleBE=function(e,t){return t||E(e,8,this.length),a.read(this,e,!1,52,8)},c.prototype.writeUIntLE=function(e,t,i,n){e=+e,t|=0,i|=0,n||k(this,e,t,i,Math.pow(2,8*i)-1,0);var a=1,s=0;for(this[t]=255&e;++s<i&&(a*=256);)this[t+s]=e/a&255;return t+i},c.prototype.writeUIntBE=function(e,t,i,n){e=+e,t|=0,i|=0,n||k(this,e,t,i,Math.pow(2,8*i)-1,0);var a=i-1,s=1;for(this[t+a]=255&e;0<=--a&&(s*=256);)this[t+a]=e/s&255;return t+i},c.prototype.writeUInt8=function(e,t,i){return e=+e,t|=0,i||k(this,e,t,1,255,0),c.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),this[t]=255&e,t+1},c.prototype.writeUInt16LE=function(e,t,i){return e=+e,t|=0,i||k(this,e,t,2,65535,0),c.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):A(this,e,t,!0),t+2},c.prototype.writeUInt16BE=function(e,t,i){return e=+e,t|=0,i||k(this,e,t,2,65535,0),c.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):A(this,e,t,!1),t+2},c.prototype.writeUInt32LE=function(e,t,i){return e=+e,t|=0,i||k(this,e,t,4,4294967295,0),c.TYPED_ARRAY_SUPPORT?(this[t+3]=e>>>24,this[t+2]=e>>>16,this[t+1]=e>>>8,this[t]=255&e):D(this,e,t,!0),t+4},c.prototype.writeUInt32BE=function(e,t,i){return e=+e,t|=0,i||k(this,e,t,4,4294967295,0),c.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):D(this,e,t,!1),t+4},c.prototype.writeIntLE=function(e,t,i,n){if(e=+e,t|=0,!n){var a=Math.pow(2,8*i-1);k(this,e,t,i,a-1,-a)}var s=0,r=1,o=0;for(this[t]=255&e;++s<i&&(r*=256);)e<0&&0===o&&0!==this[t+s-1]&&(o=1),this[t+s]=(e/r>>0)-o&255;return t+i},c.prototype.writeIntBE=function(e,t,i,n){if(e=+e,t|=0,!n){var a=Math.pow(2,8*i-1);k(this,e,t,i,a-1,-a)}var s=i-1,r=1,o=0;for(this[t+s]=255&e;0<=--s&&(r*=256);)e<0&&0===o&&0!==this[t+s+1]&&(o=1),this[t+s]=(e/r>>0)-o&255;return t+i},c.prototype.writeInt8=function(e,t,i){return e=+e,t|=0,i||k(this,e,t,1,127,-128),c.TYPED_ARRAY_SUPPORT||(e=Math.floor(e)),e<0&&(e=255+e+1),this[t]=255&e,t+1},c.prototype.writeInt16LE=function(e,t,i){return e=+e,t|=0,i||k(this,e,t,2,32767,-32768),c.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8):A(this,e,t,!0),t+2},c.prototype.writeInt16BE=function(e,t,i){return e=+e,t|=0,i||k(this,e,t,2,32767,-32768),c.TYPED_ARRAY_SUPPORT?(this[t]=e>>>8,this[t+1]=255&e):A(this,e,t,!1),t+2},c.prototype.writeInt32LE=function(e,t,i){return e=+e,t|=0,i||k(this,e,t,4,2147483647,-2147483648),c.TYPED_ARRAY_SUPPORT?(this[t]=255&e,this[t+1]=e>>>8,this[t+2]=e>>>16,this[t+3]=e>>>24):D(this,e,t,!0),t+4},c.prototype.writeInt32BE=function(e,t,i){return e=+e,t|=0,i||k(this,e,t,4,2147483647,-2147483648),e<0&&(e=4294967295+e+1),c.TYPED_ARRAY_SUPPORT?(this[t]=e>>>24,this[t+1]=e>>>16,this[t+2]=e>>>8,this[t+3]=255&e):D(this,e,t,!1),t+4},c.prototype.writeFloatLE=function(e,t,i){return x(this,e,t,!0,i)},c.prototype.writeFloatBE=function(e,t,i){return x(this,e,t,!1,i)},c.prototype.writeDoubleLE=function(e,t,i){return B(this,e,t,!0,i)},c.prototype.writeDoubleBE=function(e,t,i){return B(this,e,t,!1,i)},c.prototype.copy=function(e,t,i,n){if(i||(i=0),n||0===n||(n=this.length),t>=e.length&&(t=e.length),t||(t=0),0<n&&n<i&&(n=i),n===i)return 0;if(0===e.length||0===this.length)return 0;if(t<0)throw new RangeError("targetStart out of bounds");if(i<0||i>=this.length)throw new RangeError("sourceStart out of bounds");if(n<0)throw new RangeError("sourceEnd out of bounds");n>this.length&&(n=this.length),e.length-t<n-i&&(n=e.length-t+i);var a,s=n-i;if(this===e&&i<t&&t<n)for(a=s-1;0<=a;--a)e[a+t]=this[a+i];else if(s<1e3||!c.TYPED_ARRAY_SUPPORT)for(a=0;a<s;++a)e[a+t]=this[a+i];else Uint8Array.prototype.set.call(e,this.subarray(i,i+s),t);return s},c.prototype.fill=function(e,t,i,n){if("string"==typeof e){if("string"==typeof t?(n=t,t=0,i=this.length):"string"==typeof i&&(n=i,i=this.length),1===e.length){var a=e.charCodeAt(0);a<256&&(e=a)}if(void 0!==n&&"string"!=typeof n)throw new TypeError("encoding must be a string");if("string"==typeof n&&!c.isEncoding(n))throw new TypeError("Unknown encoding: "+n)}else"number"==typeof e&&(e&=255);if(t<0||this.length<t||this.length<i)throw new RangeError("Out of range index");if(i<=t)return this;var s;if(t>>>=0,i=void 0===i?this.length:i>>>0,e||(e=0),"number"==typeof e)for(s=t;s<i;++s)this[s]=e;else{var r=c.isBuffer(e)?e:N(new c(e,n).toString()),o=r.length;for(s=0;s<i-t;++s)this[s+t]=r[s%o]}return this};var R=/[^+\/0-9A-Za-z-_]/g;function M(e){return e<16?"0"+e.toString(16):e.toString(16)}function N(e,t){var i;t=t||1/0;for(var n=e.length,a=null,s=[],r=0;r<n;++r){if(55295<(i=e.charCodeAt(r))&&i<57344){if(!a){if(56319<i){-1<(t-=3)&&s.push(239,191,189);continue}if(r+1===n){-1<(t-=3)&&s.push(239,191,189);continue}a=i;continue}if(i<56320){-1<(t-=3)&&s.push(239,191,189),a=i;continue}i=65536+(a-55296<<10|i-56320)}else a&&-1<(t-=3)&&s.push(239,191,189);if(a=null,i<128){if((t-=1)<0)break;s.push(i)}else if(i<2048){if((t-=2)<0)break;s.push(i>>6|192,63&i|128)}else if(i<65536){if((t-=3)<0)break;s.push(i>>12|224,i>>6&63|128,63&i|128)}else{if(!(i<1114112))throw new Error("Invalid code point");if((t-=4)<0)break;s.push(i>>18|240,i>>12&63|128,i>>6&63|128,63&i|128)}}return s}function L(e){return n.toByteArray(function(e){var t;if((e=(t=e,t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")).replace(R,"")).length<2)return"";for(;e.length%4!=0;)e+="=";return e}(e))}function U(e,t,i,n){for(var a=0;a<n&&!(a+i>=t.length||a>=e.length);++a)t[a+i]=e[a];return a}}).call(this,i(12))},function(e,t,i){(function(e){!function(e,t){"use strict";function n(e,t){if(!e)throw new Error(t||"Assertion failed")}function a(e,t){e.super_=t;var i=function(){};i.prototype=t.prototype,e.prototype=new i,e.prototype.constructor=e}function s(e,t,i){if(s.isBN(e))return e;this.negative=0,this.words=null,this.length=0,(this.red=null)!==e&&("le"!==t&&"be"!==t||(i=t,t=10),this._init(e||0,t||10,i||"be"))}var r;"object"==typeof e?e.exports=s:t.BN=s,(s.BN=s).wordSize=26;try{r=i(254).Buffer}catch(e){}function o(e,t,i){for(var n=0,a=Math.min(e.length,i),s=t;s<a;s++){var r=e.charCodeAt(s)-48;n<<=4,n|=49<=r&&r<=54?r-49+10:17<=r&&r<=22?r-17+10:15&r}return n}function c(e,t,i,n){for(var a=0,s=Math.min(e.length,i),r=t;r<s;r++){var o=e.charCodeAt(r)-48;a*=n,a+=49<=o?o-49+10:17<=o?o-17+10:o}return a}s.isBN=function(e){return e instanceof s||null!==e&&"object"==typeof e&&e.constructor.wordSize===s.wordSize&&Array.isArray(e.words)},s.max=function(e,t){return 0<e.cmp(t)?e:t},s.min=function(e,t){return e.cmp(t)<0?e:t},s.prototype._init=function(e,t,i){if("number"==typeof e)return this._initNumber(e,t,i);if("object"==typeof e)return this._initArray(e,t,i);"hex"===t&&(t=16),n(t===(0|t)&&2<=t&&t<=36);var a=0;"-"===(e=e.toString().replace(/\s+/g,""))[0]&&a++,16===t?this._parseHex(e,a):this._parseBase(e,t,a),"-"===e[0]&&(this.negative=1),this.strip(),"le"===i&&this._initArray(this.toArray(),t,i)},s.prototype._initNumber=function(e,t,i){e<0&&(this.negative=1,e=-e),this.length=e<67108864?(this.words=[67108863&e],1):e<4503599627370496?(this.words=[67108863&e,e/67108864&67108863],2):(n(e<9007199254740992),this.words=[67108863&e,e/67108864&67108863,1],3),"le"===i&&this._initArray(this.toArray(),t,i)},s.prototype._initArray=function(e,t,i){if(n("number"==typeof e.length),e.length<=0)return this.words=[0],this.length=1,this;this.length=Math.ceil(e.length/3),this.words=new Array(this.length);for(var a=0;a<this.length;a++)this.words[a]=0;var s,r,o=0;if("be"===i)for(a=e.length-1,s=0;0<=a;a-=3)r=e[a]|e[a-1]<<8|e[a-2]<<16,this.words[s]|=r<<o&67108863,this.words[s+1]=r>>>26-o&67108863,26<=(o+=24)&&(o-=26,s++);else if("le"===i)for(s=a=0;a<e.length;a+=3)r=e[a]|e[a+1]<<8|e[a+2]<<16,this.words[s]|=r<<o&67108863,this.words[s+1]=r>>>26-o&67108863,26<=(o+=24)&&(o-=26,s++);return this.strip()},s.prototype._parseHex=function(e,t){this.length=Math.ceil((e.length-t)/6),this.words=new Array(this.length);for(var i=0;i<this.length;i++)this.words[i]=0;var n,a,s=0;for(i=e.length-6,n=0;t<=i;i-=6)a=o(e,i,i+6),this.words[n]|=a<<s&67108863,this.words[n+1]|=a>>>26-s&4194303,26<=(s+=24)&&(s-=26,n++);i+6!==t&&(a=o(e,t,i+6),this.words[n]|=a<<s&67108863,this.words[n+1]|=a>>>26-s&4194303),this.strip()},s.prototype._parseBase=function(e,t,i){this.words=[0];for(var n=0,a=this.length=1;a<=67108863;a*=t)n++;n--,a=a/t|0;for(var s=e.length-i,r=s%n,o=Math.min(s,s-r)+i,d=0,l=i;l<o;l+=n)d=c(e,l,l+n,t),this.imuln(a),this.words[0]+d<67108864?this.words[0]+=d:this._iaddn(d);if(0!==r){var g=1;for(d=c(e,l,e.length,t),l=0;l<r;l++)g*=t;this.imuln(g),this.words[0]+d<67108864?this.words[0]+=d:this._iaddn(d)}},s.prototype.copy=function(e){e.words=new Array(this.length);for(var t=0;t<this.length;t++)e.words[t]=this.words[t];e.length=this.length,e.negative=this.negative,e.red=this.red},s.prototype.clone=function(){var e=new s(null);return this.copy(e),e},s.prototype._expand=function(e){for(;this.length<e;)this.words[this.length++]=0;return this},s.prototype.strip=function(){for(;1<this.length&&0===this.words[this.length-1];)this.length--;return this._normSign()},s.prototype._normSign=function(){return 1===this.length&&0===this.words[0]&&(this.negative=0),this},s.prototype.inspect=function(){return(this.red?"<BN-R: ":"<BN: ")+this.toString(16)+">"};var d=["","0","00","000","0000","00000","000000","0000000","00000000","000000000","0000000000","00000000000","000000000000","0000000000000","00000000000000","000000000000000","0000000000000000","00000000000000000","000000000000000000","0000000000000000000","00000000000000000000","000000000000000000000","0000000000000000000000","00000000000000000000000","000000000000000000000000","0000000000000000000000000"],l=[0,0,25,16,12,11,10,9,8,8,7,7,7,7,6,6,6,6,6,6,6,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5,5],g=[0,0,33554432,43046721,16777216,48828125,60466176,40353607,16777216,43046721,1e7,19487171,35831808,62748517,7529536,11390625,16777216,24137569,34012224,47045881,64e6,4084101,5153632,6436343,7962624,9765625,11881376,14348907,17210368,20511149,243e5,28629151,33554432,39135393,45435424,52521875,60466176];function h(e,t,i){i.negative=t.negative^e.negative;var n=e.length+t.length|0;n=(i.length=n)-1|0;var a=0|e.words[0],s=0|t.words[0],r=a*s,o=67108863&r,c=r/67108864|0;i.words[0]=o;for(var d=1;d<n;d++){for(var l=c>>>26,g=67108863&c,h=Math.min(d,t.length-1),u=Math.max(0,d-e.length+1);u<=h;u++){var p=d-u|0;l+=(r=(a=0|e.words[p])*(s=0|t.words[u])+g)/67108864|0,g=67108863&r}i.words[d]=0|g,c=0|l}return 0!==c?i.words[d]=0|c:i.length--,i.strip()}s.prototype.toString=function(e,t){var i;if(t=0|t||1,16===(e=e||10)||"hex"===e){i="";for(var a=0,s=0,r=0;r<this.length;r++){var o=this.words[r],c=(16777215&(o<<a|s)).toString(16);i=0!=(s=o>>>24-a&16777215)||r!==this.length-1?d[6-c.length]+c+i:c+i,26<=(a+=2)&&(a-=26,r--)}for(0!==s&&(i=s.toString(16)+i);i.length%t!=0;)i="0"+i;return 0!==this.negative&&(i="-"+i),i}if(e===(0|e)&&2<=e&&e<=36){var h=l[e],u=g[e];i="";var p=this.clone();for(p.negative=0;!p.isZero();){var f=p.modn(u).toString(e);i=(p=p.idivn(u)).isZero()?f+i:d[h-f.length]+f+i}for(this.isZero()&&(i="0"+i);i.length%t!=0;)i="0"+i;return 0!==this.negative&&(i="-"+i),i}n(!1,"Base should be between 2 and 36")},s.prototype.toNumber=function(){var e=this.words[0];return 2===this.length?e+=67108864*this.words[1]:3===this.length&&1===this.words[2]?e+=4503599627370496+67108864*this.words[1]:2<this.length&&n(!1,"Number can only safely store up to 53 bits"),0!==this.negative?-e:e},s.prototype.toJSON=function(){return this.toString(16)},s.prototype.toBuffer=function(e,t){return n(void 0!==r),this.toArrayLike(r,e,t)},s.prototype.toArray=function(e,t){return this.toArrayLike(Array,e,t)},s.prototype.toArrayLike=function(e,t,i){var a=this.byteLength(),s=i||Math.max(1,a);n(a<=s,"byte array longer than desired length"),n(0<s,"Requested array length <= 0"),this.strip();var r,o,c="le"===t,d=new e(s),l=this.clone();if(c){for(o=0;!l.isZero();o++)r=l.andln(255),l.iushrn(8),d[o]=r;for(;o<s;o++)d[o]=0}else{for(o=0;o<s-a;o++)d[o]=0;for(o=0;!l.isZero();o++)r=l.andln(255),l.iushrn(8),d[s-o-1]=r}return d},s.prototype._countBits=Math.clz32?function(e){return 32-Math.clz32(e)}:function(e){var t=e,i=0;return 4096<=t&&(i+=13,t>>>=13),64<=t&&(i+=7,t>>>=7),8<=t&&(i+=4,t>>>=4),2<=t&&(i+=2,t>>>=2),i+t},s.prototype._zeroBits=function(e){if(0===e)return 26;var t=e,i=0;return 0==(8191&t)&&(i+=13,t>>>=13),0==(127&t)&&(i+=7,t>>>=7),0==(15&t)&&(i+=4,t>>>=4),0==(3&t)&&(i+=2,t>>>=2),0==(1&t)&&i++,i},s.prototype.bitLength=function(){var e=this.words[this.length-1],t=this._countBits(e);return 26*(this.length-1)+t},s.prototype.zeroBits=function(){if(this.isZero())return 0;for(var e=0,t=0;t<this.length;t++){var i=this._zeroBits(this.words[t]);if(e+=i,26!==i)break}return e},s.prototype.byteLength=function(){return Math.ceil(this.bitLength()/8)},s.prototype.toTwos=function(e){return 0!==this.negative?this.abs().inotn(e).iaddn(1):this.clone()},s.prototype.fromTwos=function(e){return this.testn(e-1)?this.notn(e).iaddn(1).ineg():this.clone()},s.prototype.isNeg=function(){return 0!==this.negative},s.prototype.neg=function(){return this.clone().ineg()},s.prototype.ineg=function(){return this.isZero()||(this.negative^=1),this},s.prototype.iuor=function(e){for(;this.length<e.length;)this.words[this.length++]=0;for(var t=0;t<e.length;t++)this.words[t]=this.words[t]|e.words[t];return this.strip()},s.prototype.ior=function(e){return n(0==(this.negative|e.negative)),this.iuor(e)},s.prototype.or=function(e){return this.length>e.length?this.clone().ior(e):e.clone().ior(this)},s.prototype.uor=function(e){return this.length>e.length?this.clone().iuor(e):e.clone().iuor(this)},s.prototype.iuand=function(e){var t;t=this.length>e.length?e:this;for(var i=0;i<t.length;i++)this.words[i]=this.words[i]&e.words[i];return this.length=t.length,this.strip()},s.prototype.iand=function(e){return n(0==(this.negative|e.negative)),this.iuand(e)},s.prototype.and=function(e){return this.length>e.length?this.clone().iand(e):e.clone().iand(this)},s.prototype.uand=function(e){return this.length>e.length?this.clone().iuand(e):e.clone().iuand(this)},s.prototype.iuxor=function(e){var t,i;i=this.length>e.length?(t=this,e):(t=e,this);for(var n=0;n<i.length;n++)this.words[n]=t.words[n]^i.words[n];if(this!==t)for(;n<t.length;n++)this.words[n]=t.words[n];return this.length=t.length,this.strip()},s.prototype.ixor=function(e){return n(0==(this.negative|e.negative)),this.iuxor(e)},s.prototype.xor=function(e){return this.length>e.length?this.clone().ixor(e):e.clone().ixor(this)},s.prototype.uxor=function(e){return this.length>e.length?this.clone().iuxor(e):e.clone().iuxor(this)},s.prototype.inotn=function(e){n("number"==typeof e&&0<=e);var t=0|Math.ceil(e/26),i=e%26;this._expand(t),0<i&&t--;for(var a=0;a<t;a++)this.words[a]=67108863&~this.words[a];return 0<i&&(this.words[a]=~this.words[a]&67108863>>26-i),this.strip()},s.prototype.notn=function(e){return this.clone().inotn(e)},s.prototype.setn=function(e,t){n("number"==typeof e&&0<=e);var i=e/26|0,a=e%26;return this._expand(i+1),this.words[i]=t?this.words[i]|1<<a:this.words[i]&~(1<<a),this.strip()},s.prototype.iadd=function(e){var t,i,n;if(0!==this.negative&&0===e.negative)return this.negative=0,t=this.isub(e),this.negative^=1,this._normSign();if(0===this.negative&&0!==e.negative)return e.negative=0,t=this.isub(e),e.negative=1,t._normSign();n=this.length>e.length?(i=this,e):(i=e,this);for(var a=0,s=0;s<n.length;s++)t=(0|i.words[s])+(0|n.words[s])+a,this.words[s]=67108863&t,a=t>>>26;for(;0!==a&&s<i.length;s++)t=(0|i.words[s])+a,this.words[s]=67108863&t,a=t>>>26;if(this.length=i.length,0!==a)this.words[this.length]=a,this.length++;else if(i!==this)for(;s<i.length;s++)this.words[s]=i.words[s];return this},s.prototype.add=function(e){var t;return 0!==e.negative&&0===this.negative?(e.negative=0,t=this.sub(e),e.negative^=1,t):0===e.negative&&0!==this.negative?(this.negative=0,t=e.sub(this),this.negative=1,t):this.length>e.length?this.clone().iadd(e):e.clone().iadd(this)},s.prototype.isub=function(e){if(0!==e.negative){e.negative=0;var t=this.iadd(e);return e.negative=1,t._normSign()}if(0!==this.negative)return this.negative=0,this.iadd(e),this.negative=1,this._normSign();var i,n,a=this.cmp(e);if(0===a)return this.negative=0,this.length=1,this.words[0]=0,this;n=0<a?(i=this,e):(i=e,this);for(var s=0,r=0;r<n.length;r++)s=(t=(0|i.words[r])-(0|n.words[r])+s)>>26,this.words[r]=67108863&t;for(;0!==s&&r<i.length;r++)s=(t=(0|i.words[r])+s)>>26,this.words[r]=67108863&t;if(0===s&&r<i.length&&i!==this)for(;r<i.length;r++)this.words[r]=i.words[r];return this.length=Math.max(this.length,r),i!==this&&(this.negative=1),this.strip()},s.prototype.sub=function(e){return this.clone().isub(e)};var u=function(e,t,i){var n,a,s,r=e.words,o=t.words,c=i.words,d=0,l=0|r[0],g=8191&l,h=l>>>13,u=0|r[1],p=8191&u,f=u>>>13,m=0|r[2],_=8191&m,b=m>>>13,y=0|r[3],v=8191&y,S=y>>>13,C=0|r[4],w=8191&C,O=C>>>13,T=0|r[5],P=8191&T,E=T>>>13,k=0|r[6],A=8191&k,D=k>>>13,I=0|r[7],x=8191&I,B=I>>>13,R=0|r[8],M=8191&R,N=R>>>13,L=0|r[9],U=8191&L,F=L>>>13,$=0|o[0],W=8191&$,H=$>>>13,q=0|o[1],V=8191&q,G=q>>>13,j=0|o[2],K=8191&j,z=j>>>13,Y=0|o[3],X=8191&Y,J=Y>>>13,Q=0|o[4],Z=8191&Q,ee=Q>>>13,te=0|o[5],ie=8191&te,ne=te>>>13,ae=0|o[6],se=8191&ae,re=ae>>>13,oe=0|o[7],ce=8191&oe,de=oe>>>13,le=0|o[8],ge=8191&le,he=le>>>13,ue=0|o[9],pe=8191&ue,fe=ue>>>13;i.negative=e.negative^t.negative,i.length=19;var me=(d+(n=Math.imul(g,W))|0)+((8191&(a=(a=Math.imul(g,H))+Math.imul(h,W)|0))<<13)|0;d=((s=Math.imul(h,H))+(a>>>13)|0)+(me>>>26)|0,me&=67108863,n=Math.imul(p,W),a=(a=Math.imul(p,H))+Math.imul(f,W)|0,s=Math.imul(f,H);var _e=(d+(n=n+Math.imul(g,V)|0)|0)+((8191&(a=(a=a+Math.imul(g,G)|0)+Math.imul(h,V)|0))<<13)|0;d=((s=s+Math.imul(h,G)|0)+(a>>>13)|0)+(_e>>>26)|0,_e&=67108863,n=Math.imul(_,W),a=(a=Math.imul(_,H))+Math.imul(b,W)|0,s=Math.imul(b,H),n=n+Math.imul(p,V)|0,a=(a=a+Math.imul(p,G)|0)+Math.imul(f,V)|0,s=s+Math.imul(f,G)|0;var be=(d+(n=n+Math.imul(g,K)|0)|0)+((8191&(a=(a=a+Math.imul(g,z)|0)+Math.imul(h,K)|0))<<13)|0;d=((s=s+Math.imul(h,z)|0)+(a>>>13)|0)+(be>>>26)|0,be&=67108863,n=Math.imul(v,W),a=(a=Math.imul(v,H))+Math.imul(S,W)|0,s=Math.imul(S,H),n=n+Math.imul(_,V)|0,a=(a=a+Math.imul(_,G)|0)+Math.imul(b,V)|0,s=s+Math.imul(b,G)|0,n=n+Math.imul(p,K)|0,a=(a=a+Math.imul(p,z)|0)+Math.imul(f,K)|0,s=s+Math.imul(f,z)|0;var ye=(d+(n=n+Math.imul(g,X)|0)|0)+((8191&(a=(a=a+Math.imul(g,J)|0)+Math.imul(h,X)|0))<<13)|0;d=((s=s+Math.imul(h,J)|0)+(a>>>13)|0)+(ye>>>26)|0,ye&=67108863,n=Math.imul(w,W),a=(a=Math.imul(w,H))+Math.imul(O,W)|0,s=Math.imul(O,H),n=n+Math.imul(v,V)|0,a=(a=a+Math.imul(v,G)|0)+Math.imul(S,V)|0,s=s+Math.imul(S,G)|0,n=n+Math.imul(_,K)|0,a=(a=a+Math.imul(_,z)|0)+Math.imul(b,K)|0,s=s+Math.imul(b,z)|0,n=n+Math.imul(p,X)|0,a=(a=a+Math.imul(p,J)|0)+Math.imul(f,X)|0,s=s+Math.imul(f,J)|0;var ve=(d+(n=n+Math.imul(g,Z)|0)|0)+((8191&(a=(a=a+Math.imul(g,ee)|0)+Math.imul(h,Z)|0))<<13)|0;d=((s=s+Math.imul(h,ee)|0)+(a>>>13)|0)+(ve>>>26)|0,ve&=67108863,n=Math.imul(P,W),a=(a=Math.imul(P,H))+Math.imul(E,W)|0,s=Math.imul(E,H),n=n+Math.imul(w,V)|0,a=(a=a+Math.imul(w,G)|0)+Math.imul(O,V)|0,s=s+Math.imul(O,G)|0,n=n+Math.imul(v,K)|0,a=(a=a+Math.imul(v,z)|0)+Math.imul(S,K)|0,s=s+Math.imul(S,z)|0,n=n+Math.imul(_,X)|0,a=(a=a+Math.imul(_,J)|0)+Math.imul(b,X)|0,s=s+Math.imul(b,J)|0,n=n+Math.imul(p,Z)|0,a=(a=a+Math.imul(p,ee)|0)+Math.imul(f,Z)|0,s=s+Math.imul(f,ee)|0;var Se=(d+(n=n+Math.imul(g,ie)|0)|0)+((8191&(a=(a=a+Math.imul(g,ne)|0)+Math.imul(h,ie)|0))<<13)|0;d=((s=s+Math.imul(h,ne)|0)+(a>>>13)|0)+(Se>>>26)|0,Se&=67108863,n=Math.imul(A,W),a=(a=Math.imul(A,H))+Math.imul(D,W)|0,s=Math.imul(D,H),n=n+Math.imul(P,V)|0,a=(a=a+Math.imul(P,G)|0)+Math.imul(E,V)|0,s=s+Math.imul(E,G)|0,n=n+Math.imul(w,K)|0,a=(a=a+Math.imul(w,z)|0)+Math.imul(O,K)|0,s=s+Math.imul(O,z)|0,n=n+Math.imul(v,X)|0,a=(a=a+Math.imul(v,J)|0)+Math.imul(S,X)|0,s=s+Math.imul(S,J)|0,n=n+Math.imul(_,Z)|0,a=(a=a+Math.imul(_,ee)|0)+Math.imul(b,Z)|0,s=s+Math.imul(b,ee)|0,n=n+Math.imul(p,ie)|0,a=(a=a+Math.imul(p,ne)|0)+Math.imul(f,ie)|0,s=s+Math.imul(f,ne)|0;var Ce=(d+(n=n+Math.imul(g,se)|0)|0)+((8191&(a=(a=a+Math.imul(g,re)|0)+Math.imul(h,se)|0))<<13)|0;d=((s=s+Math.imul(h,re)|0)+(a>>>13)|0)+(Ce>>>26)|0,Ce&=67108863,n=Math.imul(x,W),a=(a=Math.imul(x,H))+Math.imul(B,W)|0,s=Math.imul(B,H),n=n+Math.imul(A,V)|0,a=(a=a+Math.imul(A,G)|0)+Math.imul(D,V)|0,s=s+Math.imul(D,G)|0,n=n+Math.imul(P,K)|0,a=(a=a+Math.imul(P,z)|0)+Math.imul(E,K)|0,s=s+Math.imul(E,z)|0,n=n+Math.imul(w,X)|0,a=(a=a+Math.imul(w,J)|0)+Math.imul(O,X)|0,s=s+Math.imul(O,J)|0,n=n+Math.imul(v,Z)|0,a=(a=a+Math.imul(v,ee)|0)+Math.imul(S,Z)|0,s=s+Math.imul(S,ee)|0,n=n+Math.imul(_,ie)|0,a=(a=a+Math.imul(_,ne)|0)+Math.imul(b,ie)|0,s=s+Math.imul(b,ne)|0,n=n+Math.imul(p,se)|0,a=(a=a+Math.imul(p,re)|0)+Math.imul(f,se)|0,s=s+Math.imul(f,re)|0;var we=(d+(n=n+Math.imul(g,ce)|0)|0)+((8191&(a=(a=a+Math.imul(g,de)|0)+Math.imul(h,ce)|0))<<13)|0;d=((s=s+Math.imul(h,de)|0)+(a>>>13)|0)+(we>>>26)|0,we&=67108863,n=Math.imul(M,W),a=(a=Math.imul(M,H))+Math.imul(N,W)|0,s=Math.imul(N,H),n=n+Math.imul(x,V)|0,a=(a=a+Math.imul(x,G)|0)+Math.imul(B,V)|0,s=s+Math.imul(B,G)|0,n=n+Math.imul(A,K)|0,a=(a=a+Math.imul(A,z)|0)+Math.imul(D,K)|0,s=s+Math.imul(D,z)|0,n=n+Math.imul(P,X)|0,a=(a=a+Math.imul(P,J)|0)+Math.imul(E,X)|0,s=s+Math.imul(E,J)|0,n=n+Math.imul(w,Z)|0,a=(a=a+Math.imul(w,ee)|0)+Math.imul(O,Z)|0,s=s+Math.imul(O,ee)|0,n=n+Math.imul(v,ie)|0,a=(a=a+Math.imul(v,ne)|0)+Math.imul(S,ie)|0,s=s+Math.imul(S,ne)|0,n=n+Math.imul(_,se)|0,a=(a=a+Math.imul(_,re)|0)+Math.imul(b,se)|0,s=s+Math.imul(b,re)|0,n=n+Math.imul(p,ce)|0,a=(a=a+Math.imul(p,de)|0)+Math.imul(f,ce)|0,s=s+Math.imul(f,de)|0;var Oe=(d+(n=n+Math.imul(g,ge)|0)|0)+((8191&(a=(a=a+Math.imul(g,he)|0)+Math.imul(h,ge)|0))<<13)|0;d=((s=s+Math.imul(h,he)|0)+(a>>>13)|0)+(Oe>>>26)|0,Oe&=67108863,n=Math.imul(U,W),a=(a=Math.imul(U,H))+Math.imul(F,W)|0,s=Math.imul(F,H),n=n+Math.imul(M,V)|0,a=(a=a+Math.imul(M,G)|0)+Math.imul(N,V)|0,s=s+Math.imul(N,G)|0,n=n+Math.imul(x,K)|0,a=(a=a+Math.imul(x,z)|0)+Math.imul(B,K)|0,s=s+Math.imul(B,z)|0,n=n+Math.imul(A,X)|0,a=(a=a+Math.imul(A,J)|0)+Math.imul(D,X)|0,s=s+Math.imul(D,J)|0,n=n+Math.imul(P,Z)|0,a=(a=a+Math.imul(P,ee)|0)+Math.imul(E,Z)|0,s=s+Math.imul(E,ee)|0,n=n+Math.imul(w,ie)|0,a=(a=a+Math.imul(w,ne)|0)+Math.imul(O,ie)|0,s=s+Math.imul(O,ne)|0,n=n+Math.imul(v,se)|0,a=(a=a+Math.imul(v,re)|0)+Math.imul(S,se)|0,s=s+Math.imul(S,re)|0,n=n+Math.imul(_,ce)|0,a=(a=a+Math.imul(_,de)|0)+Math.imul(b,ce)|0,s=s+Math.imul(b,de)|0,n=n+Math.imul(p,ge)|0,a=(a=a+Math.imul(p,he)|0)+Math.imul(f,ge)|0,s=s+Math.imul(f,he)|0;var Te=(d+(n=n+Math.imul(g,pe)|0)|0)+((8191&(a=(a=a+Math.imul(g,fe)|0)+Math.imul(h,pe)|0))<<13)|0;d=((s=s+Math.imul(h,fe)|0)+(a>>>13)|0)+(Te>>>26)|0,Te&=67108863,n=Math.imul(U,V),a=(a=Math.imul(U,G))+Math.imul(F,V)|0,s=Math.imul(F,G),n=n+Math.imul(M,K)|0,a=(a=a+Math.imul(M,z)|0)+Math.imul(N,K)|0,s=s+Math.imul(N,z)|0,n=n+Math.imul(x,X)|0,a=(a=a+Math.imul(x,J)|0)+Math.imul(B,X)|0,s=s+Math.imul(B,J)|0,n=n+Math.imul(A,Z)|0,a=(a=a+Math.imul(A,ee)|0)+Math.imul(D,Z)|0,s=s+Math.imul(D,ee)|0,n=n+Math.imul(P,ie)|0,a=(a=a+Math.imul(P,ne)|0)+Math.imul(E,ie)|0,s=s+Math.imul(E,ne)|0,n=n+Math.imul(w,se)|0,a=(a=a+Math.imul(w,re)|0)+Math.imul(O,se)|0,s=s+Math.imul(O,re)|0,n=n+Math.imul(v,ce)|0,a=(a=a+Math.imul(v,de)|0)+Math.imul(S,ce)|0,s=s+Math.imul(S,de)|0,n=n+Math.imul(_,ge)|0,a=(a=a+Math.imul(_,he)|0)+Math.imul(b,ge)|0,s=s+Math.imul(b,he)|0;var Pe=(d+(n=n+Math.imul(p,pe)|0)|0)+((8191&(a=(a=a+Math.imul(p,fe)|0)+Math.imul(f,pe)|0))<<13)|0;d=((s=s+Math.imul(f,fe)|0)+(a>>>13)|0)+(Pe>>>26)|0,Pe&=67108863,n=Math.imul(U,K),a=(a=Math.imul(U,z))+Math.imul(F,K)|0,s=Math.imul(F,z),n=n+Math.imul(M,X)|0,a=(a=a+Math.imul(M,J)|0)+Math.imul(N,X)|0,s=s+Math.imul(N,J)|0,n=n+Math.imul(x,Z)|0,a=(a=a+Math.imul(x,ee)|0)+Math.imul(B,Z)|0,s=s+Math.imul(B,ee)|0,n=n+Math.imul(A,ie)|0,a=(a=a+Math.imul(A,ne)|0)+Math.imul(D,ie)|0,s=s+Math.imul(D,ne)|0,n=n+Math.imul(P,se)|0,a=(a=a+Math.imul(P,re)|0)+Math.imul(E,se)|0,s=s+Math.imul(E,re)|0,n=n+Math.imul(w,ce)|0,a=(a=a+Math.imul(w,de)|0)+Math.imul(O,ce)|0,s=s+Math.imul(O,de)|0,n=n+Math.imul(v,ge)|0,a=(a=a+Math.imul(v,he)|0)+Math.imul(S,ge)|0,s=s+Math.imul(S,he)|0;var Ee=(d+(n=n+Math.imul(_,pe)|0)|0)+((8191&(a=(a=a+Math.imul(_,fe)|0)+Math.imul(b,pe)|0))<<13)|0;d=((s=s+Math.imul(b,fe)|0)+(a>>>13)|0)+(Ee>>>26)|0,Ee&=67108863,n=Math.imul(U,X),a=(a=Math.imul(U,J))+Math.imul(F,X)|0,s=Math.imul(F,J),n=n+Math.imul(M,Z)|0,a=(a=a+Math.imul(M,ee)|0)+Math.imul(N,Z)|0,s=s+Math.imul(N,ee)|0,n=n+Math.imul(x,ie)|0,a=(a=a+Math.imul(x,ne)|0)+Math.imul(B,ie)|0,s=s+Math.imul(B,ne)|0,n=n+Math.imul(A,se)|0,a=(a=a+Math.imul(A,re)|0)+Math.imul(D,se)|0,s=s+Math.imul(D,re)|0,n=n+Math.imul(P,ce)|0,a=(a=a+Math.imul(P,de)|0)+Math.imul(E,ce)|0,s=s+Math.imul(E,de)|0,n=n+Math.imul(w,ge)|0,a=(a=a+Math.imul(w,he)|0)+Math.imul(O,ge)|0,s=s+Math.imul(O,he)|0;var ke=(d+(n=n+Math.imul(v,pe)|0)|0)+((8191&(a=(a=a+Math.imul(v,fe)|0)+Math.imul(S,pe)|0))<<13)|0;d=((s=s+Math.imul(S,fe)|0)+(a>>>13)|0)+(ke>>>26)|0,ke&=67108863,n=Math.imul(U,Z),a=(a=Math.imul(U,ee))+Math.imul(F,Z)|0,s=Math.imul(F,ee),n=n+Math.imul(M,ie)|0,a=(a=a+Math.imul(M,ne)|0)+Math.imul(N,ie)|0,s=s+Math.imul(N,ne)|0,n=n+Math.imul(x,se)|0,a=(a=a+Math.imul(x,re)|0)+Math.imul(B,se)|0,s=s+Math.imul(B,re)|0,n=n+Math.imul(A,ce)|0,a=(a=a+Math.imul(A,de)|0)+Math.imul(D,ce)|0,s=s+Math.imul(D,de)|0,n=n+Math.imul(P,ge)|0,a=(a=a+Math.imul(P,he)|0)+Math.imul(E,ge)|0,s=s+Math.imul(E,he)|0;var Ae=(d+(n=n+Math.imul(w,pe)|0)|0)+((8191&(a=(a=a+Math.imul(w,fe)|0)+Math.imul(O,pe)|0))<<13)|0;d=((s=s+Math.imul(O,fe)|0)+(a>>>13)|0)+(Ae>>>26)|0,Ae&=67108863,n=Math.imul(U,ie),a=(a=Math.imul(U,ne))+Math.imul(F,ie)|0,s=Math.imul(F,ne),n=n+Math.imul(M,se)|0,a=(a=a+Math.imul(M,re)|0)+Math.imul(N,se)|0,s=s+Math.imul(N,re)|0,n=n+Math.imul(x,ce)|0,a=(a=a+Math.imul(x,de)|0)+Math.imul(B,ce)|0,s=s+Math.imul(B,de)|0,n=n+Math.imul(A,ge)|0,a=(a=a+Math.imul(A,he)|0)+Math.imul(D,ge)|0,s=s+Math.imul(D,he)|0;var De=(d+(n=n+Math.imul(P,pe)|0)|0)+((8191&(a=(a=a+Math.imul(P,fe)|0)+Math.imul(E,pe)|0))<<13)|0;d=((s=s+Math.imul(E,fe)|0)+(a>>>13)|0)+(De>>>26)|0,De&=67108863,n=Math.imul(U,se),a=(a=Math.imul(U,re))+Math.imul(F,se)|0,s=Math.imul(F,re),n=n+Math.imul(M,ce)|0,a=(a=a+Math.imul(M,de)|0)+Math.imul(N,ce)|0,s=s+Math.imul(N,de)|0,n=n+Math.imul(x,ge)|0,a=(a=a+Math.imul(x,he)|0)+Math.imul(B,ge)|0,s=s+Math.imul(B,he)|0;var Ie=(d+(n=n+Math.imul(A,pe)|0)|0)+((8191&(a=(a=a+Math.imul(A,fe)|0)+Math.imul(D,pe)|0))<<13)|0;d=((s=s+Math.imul(D,fe)|0)+(a>>>13)|0)+(Ie>>>26)|0,Ie&=67108863,n=Math.imul(U,ce),a=(a=Math.imul(U,de))+Math.imul(F,ce)|0,s=Math.imul(F,de),n=n+Math.imul(M,ge)|0,a=(a=a+Math.imul(M,he)|0)+Math.imul(N,ge)|0,s=s+Math.imul(N,he)|0;var xe=(d+(n=n+Math.imul(x,pe)|0)|0)+((8191&(a=(a=a+Math.imul(x,fe)|0)+Math.imul(B,pe)|0))<<13)|0;d=((s=s+Math.imul(B,fe)|0)+(a>>>13)|0)+(xe>>>26)|0,xe&=67108863,n=Math.imul(U,ge),a=(a=Math.imul(U,he))+Math.imul(F,ge)|0,s=Math.imul(F,he);var Be=(d+(n=n+Math.imul(M,pe)|0)|0)+((8191&(a=(a=a+Math.imul(M,fe)|0)+Math.imul(N,pe)|0))<<13)|0;d=((s=s+Math.imul(N,fe)|0)+(a>>>13)|0)+(Be>>>26)|0,Be&=67108863;var Re=(d+(n=Math.imul(U,pe))|0)+((8191&(a=(a=Math.imul(U,fe))+Math.imul(F,pe)|0))<<13)|0;return d=((s=Math.imul(F,fe))+(a>>>13)|0)+(Re>>>26)|0,Re&=67108863,c[0]=me,c[1]=_e,c[2]=be,c[3]=ye,c[4]=ve,c[5]=Se,c[6]=Ce,c[7]=we,c[8]=Oe,c[9]=Te,c[10]=Pe,c[11]=Ee,c[12]=ke,c[13]=Ae,c[14]=De,c[15]=Ie,c[16]=xe,c[17]=Be,c[18]=Re,0!==d&&(c[19]=d,i.length++),i};function p(e,t,i){return(new f).mulp(e,t,i)}function f(e,t){this.x=e,this.y=t}Math.imul||(u=h),s.prototype.mulTo=function(e,t){var i=this.length+e.length;return 10===this.length&&10===e.length?u(this,e,t):i<63?h(this,e,t):i<1024?function(e,t,i){i.negative=t.negative^e.negative,i.length=e.length+t.length;for(var n=0,a=0,s=0;s<i.length-1;s++){var r=a;a=0;for(var o=67108863&n,c=Math.min(s,t.length-1),d=Math.max(0,s-e.length+1);d<=c;d++){var l=s-d,g=(0|e.words[l])*(0|t.words[d]),h=67108863&g;o=67108863&(h=h+o|0),a+=(r=(r=r+(g/67108864|0)|0)+(h>>>26)|0)>>>26,r&=67108863}i.words[s]=o,n=r,r=a}return 0!==n?i.words[s]=n:i.length--,i.strip()}(this,e,t):p(this,e,t)},f.prototype.makeRBT=function(e){for(var t=new Array(e),i=s.prototype._countBits(e)-1,n=0;n<e;n++)t[n]=this.revBin(n,i,e);return t},f.prototype.revBin=function(e,t,i){if(0===e||e===i-1)return e;for(var n=0,a=0;a<t;a++)n|=(1&e)<<t-a-1,e>>=1;return n},f.prototype.permute=function(e,t,i,n,a,s){for(var r=0;r<s;r++)n[r]=t[e[r]],a[r]=i[e[r]]},f.prototype.transform=function(e,t,i,n,a,s){this.permute(s,e,t,i,n,a);for(var r=1;r<a;r<<=1)for(var o=r<<1,c=Math.cos(2*Math.PI/o),d=Math.sin(2*Math.PI/o),l=0;l<a;l+=o)for(var g=c,h=d,u=0;u<r;u++){var p=i[l+u],f=n[l+u],m=i[l+u+r],_=n[l+u+r],b=g*m-h*_;_=g*_+h*m,m=b,i[l+u]=p+m,n[l+u]=f+_,i[l+u+r]=p-m,n[l+u+r]=f-_,u!==o&&(b=c*g-d*h,h=c*h+d*g,g=b)}},f.prototype.guessLen13b=function(e,t){var i=1|Math.max(t,e),n=1&i,a=0;for(i=i/2|0;i;i>>>=1)a++;return 1<<a+1+n},f.prototype.conjugate=function(e,t,i){if(!(i<=1))for(var n=0;n<i/2;n++){var a=e[n];e[n]=e[i-n-1],e[i-n-1]=a,a=t[n],t[n]=-t[i-n-1],t[i-n-1]=-a}},f.prototype.normalize13b=function(e,t){for(var i=0,n=0;n<t/2;n++){var a=8192*Math.round(e[2*n+1]/t)+Math.round(e[2*n]/t)+i;e[n]=67108863&a,i=a<67108864?0:a/67108864|0}return e},f.prototype.convert13b=function(e,t,i,a){for(var s=0,r=0;r<t;r++)s+=0|e[r],i[2*r]=8191&s,s>>>=13,i[2*r+1]=8191&s,s>>>=13;for(r=2*t;r<a;++r)i[r]=0;n(0===s),n(0==(-8192&s))},f.prototype.stub=function(e){for(var t=new Array(e),i=0;i<e;i++)t[i]=0;return t},f.prototype.mulp=function(e,t,i){var n=2*this.guessLen13b(e.length,t.length),a=this.makeRBT(n),s=this.stub(n),r=new Array(n),o=new Array(n),c=new Array(n),d=new Array(n),l=new Array(n),g=new Array(n),h=i.words;h.length=n,this.convert13b(e.words,e.length,r,n),this.convert13b(t.words,t.length,d,n),this.transform(r,s,o,c,n,a),this.transform(d,s,l,g,n,a);for(var u=0;u<n;u++){var p=o[u]*l[u]-c[u]*g[u];c[u]=o[u]*g[u]+c[u]*l[u],o[u]=p}return this.conjugate(o,c,n),this.transform(o,c,h,s,n,a),this.conjugate(h,s,n),this.normalize13b(h,n),i.negative=e.negative^t.negative,i.length=e.length+t.length,i.strip()},s.prototype.mul=function(e){var t=new s(null);return t.words=new Array(this.length+e.length),this.mulTo(e,t)},s.prototype.mulf=function(e){var t=new s(null);return t.words=new Array(this.length+e.length),p(this,e,t)},s.prototype.imul=function(e){return this.clone().mulTo(e,this)},s.prototype.imuln=function(e){n("number"==typeof e),n(e<67108864);for(var t=0,i=0;i<this.length;i++){var a=(0|this.words[i])*e,s=(67108863&a)+(67108863&t);t>>=26,t+=a/67108864|0,t+=s>>>26,this.words[i]=67108863&s}return 0!==t&&(this.words[i]=t,this.length++),this},s.prototype.muln=function(e){return this.clone().imuln(e)},s.prototype.sqr=function(){return this.mul(this)},s.prototype.isqr=function(){return this.imul(this.clone())},s.prototype.pow=function(e){var t=function(e){for(var t=new Array(e.bitLength()),i=0;i<t.length;i++){var n=i/26|0,a=i%26;t[i]=(e.words[n]&1<<a)>>>a}return t}(e);if(0===t.length)return new s(1);for(var i=this,n=0;n<t.length&&0===t[n];n++,i=i.sqr());if(++n<t.length)for(var a=i.sqr();n<t.length;n++,a=a.sqr())0!==t[n]&&(i=i.mul(a));return i},s.prototype.iushln=function(e){n("number"==typeof e&&0<=e);var t,i=e%26,a=(e-i)/26,s=67108863>>>26-i<<26-i;if(0!==i){var r=0;for(t=0;t<this.length;t++){var o=this.words[t]&s,c=(0|this.words[t])-o<<i;this.words[t]=c|r,r=o>>>26-i}r&&(this.words[t]=r,this.length++)}if(0!==a){for(t=this.length-1;0<=t;t--)this.words[t+a]=this.words[t];for(t=0;t<a;t++)this.words[t]=0;this.length+=a}return this.strip()},s.prototype.ishln=function(e){return n(0===this.negative),this.iushln(e)},s.prototype.iushrn=function(e,t,i){var a;n("number"==typeof e&&0<=e),a=t?(t-t%26)/26:0;var s=e%26,r=Math.min((e-s)/26,this.length),o=67108863^67108863>>>s<<s,c=i;if(a-=r,a=Math.max(0,a),c){for(var d=0;d<r;d++)c.words[d]=this.words[d];c.length=r}if(0===r);else if(this.length>r)for(this.length-=r,d=0;d<this.length;d++)this.words[d]=this.words[d+r];else this.words[0]=0,this.length=1;var l=0;for(d=this.length-1;0<=d&&(0!==l||a<=d);d--){var g=0|this.words[d];this.words[d]=l<<26-s|g>>>s,l=g&o}return c&&0!==l&&(c.words[c.length++]=l),0===this.length&&(this.words[0]=0,this.length=1),this.strip()},s.prototype.ishrn=function(e,t,i){return n(0===this.negative),this.iushrn(e,t,i)},s.prototype.shln=function(e){return this.clone().ishln(e)},s.prototype.ushln=function(e){return this.clone().iushln(e)},s.prototype.shrn=function(e){return this.clone().ishrn(e)},s.prototype.ushrn=function(e){return this.clone().iushrn(e)},s.prototype.testn=function(e){n("number"==typeof e&&0<=e);var t=e%26,i=(e-t)/26,a=1<<t;return!(this.length<=i||!(this.words[i]&a))},s.prototype.imaskn=function(e){n("number"==typeof e&&0<=e);var t=e%26,i=(e-t)/26;if(n(0===this.negative,"imaskn works only with positive numbers"),this.length<=i)return this;if(0!==t&&i++,this.length=Math.min(i,this.length),0!==t){var a=67108863^67108863>>>t<<t;this.words[this.length-1]&=a}return this.strip()},s.prototype.maskn=function(e){return this.clone().imaskn(e)},s.prototype.iaddn=function(e){return n("number"==typeof e),n(e<67108864),e<0?this.isubn(-e):0!==this.negative?(1===this.length&&(0|this.words[0])<e?(this.words[0]=e-(0|this.words[0]),this.negative=0):(this.negative=0,this.isubn(e),this.negative=1),this):this._iaddn(e)},s.prototype._iaddn=function(e){this.words[0]+=e;for(var t=0;t<this.length&&67108864<=this.words[t];t++)this.words[t]-=67108864,t===this.length-1?this.words[t+1]=1:this.words[t+1]++;return this.length=Math.max(this.length,t+1),this},s.prototype.isubn=function(e){if(n("number"==typeof e),n(e<67108864),e<0)return this.iaddn(-e);if(0!==this.negative)return this.negative=0,this.iaddn(e),this.negative=1,this;if(this.words[0]-=e,1===this.length&&this.words[0]<0)this.words[0]=-this.words[0],this.negative=1;else for(var t=0;t<this.length&&this.words[t]<0;t++)this.words[t]+=67108864,this.words[t+1]-=1;return this.strip()},s.prototype.addn=function(e){return this.clone().iaddn(e)},s.prototype.subn=function(e){return this.clone().isubn(e)},s.prototype.iabs=function(){return this.negative=0,this},s.prototype.abs=function(){return this.clone().iabs()},s.prototype._ishlnsubmul=function(e,t,i){var a,s,r=e.length+i;this._expand(r);var o=0;for(a=0;a<e.length;a++){s=(0|this.words[a+i])+o;var c=(0|e.words[a])*t;o=((s-=67108863&c)>>26)-(c/67108864|0),this.words[a+i]=67108863&s}for(;a<this.length-i;a++)o=(s=(0|this.words[a+i])+o)>>26,this.words[a+i]=67108863&s;if(0===o)return this.strip();for(n(-1===o),a=o=0;a<this.length;a++)o=(s=-(0|this.words[a])+o)>>26,this.words[a]=67108863&s;return this.negative=1,this.strip()},s.prototype._wordDiv=function(e,t){var i=(this.length,e.length),n=this.clone(),a=e,r=0|a.words[a.length-1];0!=(i=26-this._countBits(r))&&(a=a.ushln(i),n.iushln(i),r=0|a.words[a.length-1]);var o,c=n.length-a.length;if("mod"!==t){(o=new s(null)).length=c+1,o.words=new Array(o.length);for(var d=0;d<o.length;d++)o.words[d]=0}var l=n.clone()._ishlnsubmul(a,1,c);0===l.negative&&(n=l,o&&(o.words[c]=1));for(var g=c-1;0<=g;g--){var h=67108864*(0|n.words[a.length+g])+(0|n.words[a.length+g-1]);for(h=Math.min(h/r|0,67108863),n._ishlnsubmul(a,h,g);0!==n.negative;)h--,n.negative=0,n._ishlnsubmul(a,1,g),n.isZero()||(n.negative^=1);o&&(o.words[g]=h)}return o&&o.strip(),n.strip(),"div"!==t&&0!==i&&n.iushrn(i),{div:o||null,mod:n}},s.prototype.divmod=function(e,t,i){return n(!e.isZero()),this.isZero()?{div:new s(0),mod:new s(0)}:0!==this.negative&&0===e.negative?(o=this.neg().divmod(e,t),"mod"!==t&&(a=o.div.neg()),"div"!==t&&(r=o.mod.neg(),i&&0!==r.negative&&r.iadd(e)),{div:a,mod:r}):0===this.negative&&0!==e.negative?(o=this.divmod(e.neg(),t),"mod"!==t&&(a=o.div.neg()),{div:a,mod:o.mod}):0!=(this.negative&e.negative)?(o=this.neg().divmod(e.neg(),t),"div"!==t&&(r=o.mod.neg(),i&&0!==r.negative&&r.isub(e)),{div:o.div,mod:r}):e.length>this.length||this.cmp(e)<0?{div:new s(0),mod:this}:1===e.length?"div"===t?{div:this.divn(e.words[0]),mod:null}:"mod"===t?{div:null,mod:new s(this.modn(e.words[0]))}:{div:this.divn(e.words[0]),mod:new s(this.modn(e.words[0]))}:this._wordDiv(e,t);var a,r,o},s.prototype.div=function(e){return this.divmod(e,"div",!1).div},s.prototype.mod=function(e){return this.divmod(e,"mod",!1).mod},s.prototype.umod=function(e){return this.divmod(e,"mod",!0).mod},s.prototype.divRound=function(e){var t=this.divmod(e);if(t.mod.isZero())return t.div;var i=0!==t.div.negative?t.mod.isub(e):t.mod,n=e.ushrn(1),a=e.andln(1),s=i.cmp(n);return s<0||1===a&&0===s?t.div:0!==t.div.negative?t.div.isubn(1):t.div.iaddn(1)},s.prototype.modn=function(e){n(e<=67108863);for(var t=(1<<26)%e,i=0,a=this.length-1;0<=a;a--)i=(t*i+(0|this.words[a]))%e;return i},s.prototype.idivn=function(e){n(e<=67108863);for(var t=0,i=this.length-1;0<=i;i--){var a=(0|this.words[i])+67108864*t;this.words[i]=a/e|0,t=a%e}return this.strip()},s.prototype.divn=function(e){return this.clone().idivn(e)},s.prototype.egcd=function(e){n(0===e.negative),n(!e.isZero());var t=this,i=e.clone();t=0!==t.negative?t.umod(e):t.clone();for(var a=new s(1),r=new s(0),o=new s(0),c=new s(1),d=0;t.isEven()&&i.isEven();)t.iushrn(1),i.iushrn(1),++d;for(var l=i.clone(),g=t.clone();!t.isZero();){for(var h=0,u=1;0==(t.words[0]&u)&&h<26;++h,u<<=1);if(0<h)for(t.iushrn(h);0<h--;)(a.isOdd()||r.isOdd())&&(a.iadd(l),r.isub(g)),a.iushrn(1),r.iushrn(1);for(var p=0,f=1;0==(i.words[0]&f)&&p<26;++p,f<<=1);if(0<p)for(i.iushrn(p);0<p--;)(o.isOdd()||c.isOdd())&&(o.iadd(l),c.isub(g)),o.iushrn(1),c.iushrn(1);0<=t.cmp(i)?(t.isub(i),a.isub(o),r.isub(c)):(i.isub(t),o.isub(a),c.isub(r))}return{a:o,b:c,gcd:i.iushln(d)}},s.prototype._invmp=function(e){n(0===e.negative),n(!e.isZero());var t=this,i=e.clone();t=0!==t.negative?t.umod(e):t.clone();for(var a,r=new s(1),o=new s(0),c=i.clone();0<t.cmpn(1)&&0<i.cmpn(1);){for(var d=0,l=1;0==(t.words[0]&l)&&d<26;++d,l<<=1);if(0<d)for(t.iushrn(d);0<d--;)r.isOdd()&&r.iadd(c),r.iushrn(1);for(var g=0,h=1;0==(i.words[0]&h)&&g<26;++g,h<<=1);if(0<g)for(i.iushrn(g);0<g--;)o.isOdd()&&o.iadd(c),o.iushrn(1);0<=t.cmp(i)?(t.isub(i),r.isub(o)):(i.isub(t),o.isub(r))}return(a=0===t.cmpn(1)?r:o).cmpn(0)<0&&a.iadd(e),a},s.prototype.gcd=function(e){if(this.isZero())return e.abs();if(e.isZero())return this.abs();var t=this.clone(),i=e.clone();t.negative=0;for(var n=i.negative=0;t.isEven()&&i.isEven();n++)t.iushrn(1),i.iushrn(1);for(;;){for(;t.isEven();)t.iushrn(1);for(;i.isEven();)i.iushrn(1);var a=t.cmp(i);if(a<0){var s=t;t=i,i=s}else if(0===a||0===i.cmpn(1))break;t.isub(i)}return i.iushln(n)},s.prototype.invm=function(e){return this.egcd(e).a.umod(e)},s.prototype.isEven=function(){return 0==(1&this.words[0])},s.prototype.isOdd=function(){return 1==(1&this.words[0])},s.prototype.andln=function(e){return this.words[0]&e},s.prototype.bincn=function(e){n("number"==typeof e);var t=e%26,i=(e-t)/26,a=1<<t;if(this.length<=i)return this._expand(i+1),this.words[i]|=a,this;for(var s=a,r=i;0!==s&&r<this.length;r++){var o=0|this.words[r];s=(o+=s)>>>26,o&=67108863,this.words[r]=o}return 0!==s&&(this.words[r]=s,this.length++),this},s.prototype.isZero=function(){return 1===this.length&&0===this.words[0]},s.prototype.cmpn=function(e){var t,i=e<0;if(0!==this.negative&&!i)return-1;if(0===this.negative&&i)return 1;if(this.strip(),1<this.length)t=1;else{i&&(e=-e),n(e<=67108863,"Number is too big");var a=0|this.words[0];t=a===e?0:a<e?-1:1}return 0!==this.negative?0|-t:t},s.prototype.cmp=function(e){if(0!==this.negative&&0===e.negative)return-1;if(0===this.negative&&0!==e.negative)return 1;var t=this.ucmp(e);return 0!==this.negative?0|-t:t},s.prototype.ucmp=function(e){if(this.length>e.length)return 1;if(this.length<e.length)return-1;for(var t=0,i=this.length-1;0<=i;i--){var n=0|this.words[i],a=0|e.words[i];if(n!==a){n<a?t=-1:a<n&&(t=1);break}}return t},s.prototype.gtn=function(e){return 1===this.cmpn(e)},s.prototype.gt=function(e){return 1===this.cmp(e)},s.prototype.gten=function(e){return 0<=this.cmpn(e)},s.prototype.gte=function(e){return 0<=this.cmp(e)},s.prototype.ltn=function(e){return-1===this.cmpn(e)},s.prototype.lt=function(e){return-1===this.cmp(e)},s.prototype.lten=function(e){return this.cmpn(e)<=0},s.prototype.lte=function(e){return this.cmp(e)<=0},s.prototype.eqn=function(e){return 0===this.cmpn(e)},s.prototype.eq=function(e){return 0===this.cmp(e)},s.red=function(e){return new C(e)},s.prototype.toRed=function(e){return n(!this.red,"Already a number in reduction context"),n(0===this.negative,"red works only with positives"),e.convertTo(this)._forceRed(e)},s.prototype.fromRed=function(){return n(this.red,"fromRed works only with numbers in reduction context"),this.red.convertFrom(this)},s.prototype._forceRed=function(e){return this.red=e,this},s.prototype.forceRed=function(e){return n(!this.red,"Already a number in reduction context"),this._forceRed(e)},s.prototype.redAdd=function(e){return n(this.red,"redAdd works only with red numbers"),this.red.add(this,e)},s.prototype.redIAdd=function(e){return n(this.red,"redIAdd works only with red numbers"),this.red.iadd(this,e)},s.prototype.redSub=function(e){return n(this.red,"redSub works only with red numbers"),this.red.sub(this,e)},s.prototype.redISub=function(e){return n(this.red,"redISub works only with red numbers"),this.red.isub(this,e)},s.prototype.redShl=function(e){return n(this.red,"redShl works only with red numbers"),this.red.shl(this,e)},s.prototype.redMul=function(e){return n(this.red,"redMul works only with red numbers"),this.red._verify2(this,e),this.red.mul(this,e)},s.prototype.redIMul=function(e){return n(this.red,"redMul works only with red numbers"),this.red._verify2(this,e),this.red.imul(this,e)},s.prototype.redSqr=function(){return n(this.red,"redSqr works only with red numbers"),this.red._verify1(this),this.red.sqr(this)},s.prototype.redISqr=function(){return n(this.red,"redISqr works only with red numbers"),this.red._verify1(this),this.red.isqr(this)},s.prototype.redSqrt=function(){return n(this.red,"redSqrt works only with red numbers"),this.red._verify1(this),this.red.sqrt(this)},s.prototype.redInvm=function(){return n(this.red,"redInvm works only with red numbers"),this.red._verify1(this),this.red.invm(this)},s.prototype.redNeg=function(){return n(this.red,"redNeg works only with red numbers"),this.red._verify1(this),this.red.neg(this)},s.prototype.redPow=function(e){return n(this.red&&!e.red,"redPow(normalNum)"),this.red._verify1(this),this.red.pow(this,e)};var m={k256:null,p224:null,p192:null,p25519:null};function _(e,t){this.name=e,this.p=new s(t,16),this.n=this.p.bitLength(),this.k=new s(1).iushln(this.n).isub(this.p),this.tmp=this._tmp()}function b(){_.call(this,"k256","ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe fffffc2f")}function y(){_.call(this,"p224","ffffffff ffffffff ffffffff ffffffff 00000000 00000000 00000001")}function v(){_.call(this,"p192","ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff")}function S(){_.call(this,"25519","7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed")}function C(e){if("string"==typeof e){var t=s._prime(e);this.m=t.p,this.prime=t}else n(e.gtn(1),"modulus must be greater than 1"),this.m=e,this.prime=null}function w(e){C.call(this,e),this.shift=this.m.bitLength(),this.shift%26!=0&&(this.shift+=26-this.shift%26),this.r=new s(1).iushln(this.shift),this.r2=this.imod(this.r.sqr()),this.rinv=this.r._invmp(this.m),this.minv=this.rinv.mul(this.r).isubn(1).div(this.m),this.minv=this.minv.umod(this.r),this.minv=this.r.sub(this.minv)}_.prototype._tmp=function(){var e=new s(null);return e.words=new Array(Math.ceil(this.n/13)),e},_.prototype.ireduce=function(e){for(var t,i=e;this.split(i,this.tmp),(t=(i=(i=this.imulK(i)).iadd(this.tmp)).bitLength())>this.n;);var n=t<this.n?-1:i.ucmp(this.p);return 0===n?(i.words[0]=0,i.length=1):0<n?i.isub(this.p):i.strip(),i},_.prototype.split=function(e,t){e.iushrn(this.n,0,t)},_.prototype.imulK=function(e){return e.imul(this.k)},a(b,_),b.prototype.split=function(e,t){for(var i=Math.min(e.length,9),n=0;n<i;n++)t.words[n]=e.words[n];if(t.length=i,e.length<=9)return e.words[0]=0,void(e.length=1);var a=e.words[9];for(t.words[t.length++]=4194303&a,n=10;n<e.length;n++){var s=0|e.words[n];e.words[n-10]=(4194303&s)<<4|a>>>22,a=s}a>>>=22,0===(e.words[n-10]=a)&&10<e.length?e.length-=10:e.length-=9},b.prototype.imulK=function(e){e.words[e.length]=0,e.words[e.length+1]=0,e.length+=2;for(var t=0,i=0;i<e.length;i++){var n=0|e.words[i];t+=977*n,e.words[i]=67108863&t,t=64*n+(t/67108864|0)}return 0===e.words[e.length-1]&&(e.length--,0===e.words[e.length-1]&&e.length--),e},a(y,_),a(v,_),a(S,_),S.prototype.imulK=function(e){for(var t=0,i=0;i<e.length;i++){var n=19*(0|e.words[i])+t,a=67108863&n;n>>>=26,e.words[i]=a,t=n}return 0!==t&&(e.words[e.length++]=t),e},s._prime=function(e){if(m[e])return m[e];var t;if("k256"===e)t=new b;else if("p224"===e)t=new y;else if("p192"===e)t=new v;else{if("p25519"!==e)throw new Error("Unknown prime "+e);t=new S}return m[e]=t},C.prototype._verify1=function(e){n(0===e.negative,"red works only with positives"),n(e.red,"red works only with red numbers")},C.prototype._verify2=function(e,t){n(0==(e.negative|t.negative),"red works only with positives"),n(e.red&&e.red===t.red,"red works only with red numbers")},C.prototype.imod=function(e){return this.prime?this.prime.ireduce(e)._forceRed(this):e.umod(this.m)._forceRed(this)},C.prototype.neg=function(e){return e.isZero()?e.clone():this.m.sub(e)._forceRed(this)},C.prototype.add=function(e,t){this._verify2(e,t);var i=e.add(t);return 0<=i.cmp(this.m)&&i.isub(this.m),i._forceRed(this)},C.prototype.iadd=function(e,t){this._verify2(e,t);var i=e.iadd(t);return 0<=i.cmp(this.m)&&i.isub(this.m),i},C.prototype.sub=function(e,t){this._verify2(e,t);var i=e.sub(t);return i.cmpn(0)<0&&i.iadd(this.m),i._forceRed(this)},C.prototype.isub=function(e,t){this._verify2(e,t);var i=e.isub(t);return i.cmpn(0)<0&&i.iadd(this.m),i},C.prototype.shl=function(e,t){return this._verify1(e),this.imod(e.ushln(t))},C.prototype.imul=function(e,t){return this._verify2(e,t),this.imod(e.imul(t))},C.prototype.mul=function(e,t){return this._verify2(e,t),this.imod(e.mul(t))},C.prototype.isqr=function(e){return this.imul(e,e.clone())},C.prototype.sqr=function(e){return this.mul(e,e)},C.prototype.sqrt=function(e){if(e.isZero())return e.clone();var t=this.m.andln(3);if(n(t%2==1),3===t){var i=this.m.add(new s(1)).iushrn(2);return this.pow(e,i)}for(var a=this.m.subn(1),r=0;!a.isZero()&&0===a.andln(1);)r++,a.iushrn(1);n(!a.isZero());var o=new s(1).toRed(this),c=o.redNeg(),d=this.m.subn(1).iushrn(1),l=this.m.bitLength();for(l=new s(2*l*l).toRed(this);0!==this.pow(l,d).cmp(c);)l.redIAdd(c);for(var g=this.pow(l,a),h=this.pow(e,a.addn(1).iushrn(1)),u=this.pow(e,a),p=r;0!==u.cmp(o);){for(var f=u,m=0;0!==f.cmp(o);m++)f=f.redSqr();n(m<p);var _=this.pow(g,new s(1).iushln(p-m-1));h=h.redMul(_),g=_.redSqr(),u=u.redMul(g),p=m}return h},C.prototype.invm=function(e){var t=e._invmp(this.m);return 0!==t.negative?(t.negative=0,this.imod(t).redNeg()):this.imod(t)},C.prototype.pow=function(e,t){if(t.isZero())return new s(1).toRed(this);if(0===t.cmpn(1))return e.clone();var i=new Array(16);i[0]=new s(1).toRed(this),i[1]=e;for(var n=2;n<i.length;n++)i[n]=this.mul(i[n-1],e);var a=i[0],r=0,o=0,c=t.bitLength()%26;for(0===c&&(c=26),n=t.length-1;0<=n;n--){for(var d=t.words[n],l=c-1;0<=l;l--){var g=d>>l&1;a!==i[0]&&(a=this.sqr(a)),0!==g||0!==r?(r<<=1,r|=g,(4==++o||0===n&&0===l)&&(a=this.mul(a,i[r]),r=o=0)):o=0}c=26}return a},C.prototype.convertTo=function(e){var t=e.umod(this.m);return t===e?t.clone():t},C.prototype.convertFrom=function(e){var t=e.clone();return t.red=null,t},s.mont=function(e){return new w(e)},a(w,C),w.prototype.convertTo=function(e){return this.imod(e.ushln(this.shift))},w.prototype.convertFrom=function(e){var t=this.imod(e.mul(this.rinv));return t.red=null,t},w.prototype.imul=function(e,t){if(e.isZero()||t.isZero())return e.words[0]=0,e.length=1,e;var i=e.imul(t),n=i.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),a=i.isub(n).iushrn(this.shift),s=a;return 0<=a.cmp(this.m)?s=a.isub(this.m):a.cmpn(0)<0&&(s=a.iadd(this.m)),s._forceRed(this)},w.prototype.mul=function(e,t){if(e.isZero()||t.isZero())return new s(0)._forceRed(this);var i=e.mul(t),n=i.maskn(this.shift).mul(this.minv).imaskn(this.shift).mul(this.m),a=i.isub(n).iushrn(this.shift),r=a;return 0<=a.cmp(this.m)?r=a.isub(this.m):a.cmpn(0)<0&&(r=a.iadd(this.m)),r._forceRed(this)},w.prototype.invm=function(e){return this.imod(e._invmp(this.m).mul(this.r2))._forceRed(this)}}(e,this)}).call(this,i(153)(e))},function(e,t,i){"use strict";var n=t;n.version=i(260).version,n.utils=i(261),n.rand=i(125),n.curve=i(47),n.curves=i(266),n.ec=i(274),n.eddsa=i(278)},function(e,t,i){"use strict";e.exports=function e(t){var i=["ONE_WAY","ROUND_TRIP","MULTIPLE_DESTINATIONS"],n=_.take(t,2),a=_.zipObject(t,["OW","RT","MD"]),s=_.zipObject(t,["O","R","M"]),r=_.zipObject(t,i);return{toResultsType:function(e){return r[e]},toAcronym:function(e){return a[e]},toTinyAcronym:function(e){return s[e]},isRoundTrip:function(e){return e===t[1]},isOneWay:function(e){return e===t[0]},isMultipleDestinations:function(e){return e===t[2]},isOneWayOrRoundTrip:function(e){return _.includes(n,e)},ofResults:function(){return e(i)},fromResults:function(e){return t[_.indexOf(i,e)]}}}(["oneWayTrip","roundTrip","multipleTrip"])},function(e,t,i){"use strict";var n;n=new(i(197)),e.exports={fireEvent:function(e,t,i){n.fireEvent(e,t,i)},updateDatalayer:function(e){n.updateDatalayer(e)}}},function(e,t){(e.exports=function(e,t){if(!e)throw new Error(t||"Assertion failed")}).equal=function(e,t,i){if(e!=t)throw new Error(i||"Assertion failed: "+e+" != "+t)}},function(e,t,i){"use strict";var n=5,a={priceSeparatorSymbol:"&#8250;",cssDiscountPercentagePosition:"odf-ribbon-top-right",cssDiscountPercentageTheme:"odf-ribbon-discount",discountPercentagePrefix:"&#45;",discountPercentageSuffix:"&#37;"},s=["UNKNOWN","UN"],r=_.range(1,5),o=[_.partial(function(e,t,i){return 16<t&&i?e:null},["od-rwd-lg","od-rwd-md"]),_.partial(function(e,t,i){return 10<t&&i||18<t?e:null},["od-rwd-2lg","od-rwd-lg"]),_.partial(function(e,t,i){return i&&8<t?e:null},["od-rwd-xl","od-rwd-2lg"]),_.constant(["odf-text-2xl","odf-text-2lg"])];function c(e){return!_.isNull(e)&&_.includes(r,e)}function d(e){return _.pick(Odigeo.Utils.splitFormatedCurrency(Math.abs(e)),_.negate(_.isNull))}function l(e){var t,i,s=Math.floor(_.get(e,"discountPercentage",0)),r=_.get(e,"pricePerPassengerWithoutDiscount",0),c=n<=s,l=function(e,t){return _.zipObject(["primary","secondary"],_.spread(_.find(o,function(i){return!_.isNull(i(e,t))}))(arguments))}((t=Odigeo.Utils.formatCurrency(e.price),(i=Odigeo.Utils.Currency.currencySign)!==Odigeo.Utils.Currency.currencyCode&&1<_.size(i)?_.size(t.replace(i," ")):_.size(t)),c);return _.extend({},a,{providerPrice:e.price,fareDiscountPrice:r,fareDiscountPercentage:s,hasMinimumDiscount:c,paxDisclaimerSymbol:e.isShowPaxDisclaimer?"&#42;":"",primaryPriceSizeCssModifier:l.primary,secondaryPriceSizeCssModifier:l.secondary,hasInfoDiscount:e.hasInfoDiscount,formatPrice:d(e.price),formatFareDiscountPrice:d(r),priceDiscountTitleCms:e.hasInfoDiscount?Odigeo.Utils.replaceCmsKeyArgs(Odigeo.UIElements.translations.dynpackProduct.pricediscount.titleCms,a.discountPercentagePrefix.concat(s).concat(a.discountPercentageSuffix)):""})}function g(e,t){return _.extend({},t,{isBestPrice:e.isBestPrice,isFullPrice:e.isFullPrice,activeAbs:e.activeAbs,numberOfSegments:e.numberOfSegments,fullTablePriceBreakDownOnFullPrice:_.get(e,"priceDisplayConfig.fullTablePriceBreakDownOnFullPrice",!1),showPricePerPax:_.get(e,"priceDisplayConfig.showPricePerPax",!1),numPassengers:e.numPassengers,formatCurrency:_.partial(Odigeo.Utils.formatCurrency,_,_.extend({},Odigeo.Utils.Currency,{negationSymbol:"- "})),disclaimer:(i=e,n=t.disclaimers,a=i.isBestPrice?n.BEST_PRICE:n.PRICE_BREAK_DOWN_FEE,i.isFullprice&&!_.isEmpty(i.listRoomDeals)?n.ROOM_SELECTION_FEE:a),dynpackFareDiscountDetails:e.dynpackFareDiscountDetails});var i,n,a}function h(e){return _.chain(e).countBy("accommodationDeal.providerId").value()}function u(e){return e?"selected odf-btn-primary":"odf-btn-secondary"}e.exports={getBookButtonClass:u,extendPriceBreakdownData:g,extendPriceBreakdownPrimeData:function(e,t){var i,n,a=_.get(e.flightSelectionDTO,"fareItinerary.priceWithoutDiscountSelected",!1),s=a?"od-pricebreakdown-membership-discount-fee-warning":"od-pricebreakdown-membership-discount-fee";return _.extend(g(e,t),{isMembershipPriceDisplay:_.get(t,"membershipPerksDTO.memberLoggedIn",!1),isMembershipPriceOrDualPriceDisplay:_.get(t,"membershipPerksDTO.includedInPrice",!1),membershipDiscountClass:s,membershipPriceDiscountClass:(i=s,n=a,n?i+" odf-text-line-through":i),isFlightWithoutDiscount:a})},getAccommodationItemResult:function(e,t){return{templates:Odigeo.Utils.getTemplates($("#dpresults-templates"),{priceDiscount:".price-discount-template"}),currencyDiffers:e.dynpackCurrencyDiffers,tripAdvisorReview:{},selectedClass:"book_btn od-dynpack-book-btn "+u(e.flightPreselectedId===e.mainItineraryId),bookButtonText:Odigeo.Utils.pluralizeAll(t.translations.selectFlight,e.numberOfSegments),priceDiscountDynpack:l({pricePerPassengerWithoutDiscount:_.get(e,"dynpackPriceDiscount.pricePerPassengerWithoutDiscount"),discountPercentage:_.get(e,"dynpackPriceDiscount.discountPercentage"),price:_.get(e,"dynpackPriceDiscount.priceByProduct"),isShowPaxDisclaimer:t.isShowPaxDisclaimer,hasInfoDiscount:!0})}},getBackgroundImageError:function(e,t){return"background-image: url('"+e+"'), url('"+t+"')"},getBoardTypeIcon:function(e){return{HB:"odf-icon-food-meal",AI:"odf-icon-wine-food",BB:"odf-icon-coffe-cup",FB:"odf-icon-fork-knife",SC:"odf-icon-microwave"}[e]||""},getHotelCategory:function(e){return _.isString(e)?Odigeo.Utils.parseJson(e):e},getOnLoadError:function(e){return"this.onerror=null;this.src='"+e+"'"},getPassengerTranslations:function(e,t){return _.reduce(t,function(t,i,n){var a=e[n];return _.isNumber(a)&&0!==a&&t.push(Odigeo.Utils.pluralizeAll(i,a)),t},[]).join(", ")},getPriceColorCssModifier:function(e){return c(e)?"odf-text-negative":""},getPriceDiscountData:l,getPriceFormat:d,getRoomsLeftData:function(e){var t=e.roomsLeft,i=1===t,n=Odigeo.UIElements.translations.dynpackProduct.roomSelection,a=i?n.roomleftLast:n.roomleftAvailable;return{roomsLeft:t,hasRoomsLeft:!_.isNull(t)&&1<=t&&t<=4,hasRoomLeftUrgent:i,roomsLeftTranslation:Odigeo.Utils.replaceCmsKeyArgs(a,t)}},getSegmentsPreselectedWithStopsColorClass:function(e,t){return _.map(e,function(e){return _.defaultsDeep({stops:{directColorClass:t&&0===e.stops.quantity?"odf-text-positive":""}},e)})},getSpaceCssModifier:function(e,t,i){var n="";return _.isEmpty(e)||_.isEmpty(i)||(n=["odf-space",e,t,i].join("-")),n},getTrackingDataProvidedOlsetScore:function(e){var t=null!==_.get(e,"[0]accommodationDeal.score",null)?1:0;return["mobile"===Odigeo.SessionScope.flow?"dynpack_hotel_results":"dynpack_results","olset_score","olset_provided_"+t]},getTrackingLabelLoadedResults:function(e,t){var i=h(t);return["list_shown:10_bc:"+(i.BC?i.BC:0),"_hb:"+(i.HB?i.HB:0),"_oc:"+(i.OC?i.OC:0),"_hc:"+(i.HC?i.HC:0)].join("")},hasHotelRoomsLeft:c,isTopChoice:function(e,t){return t.highlightTopChoice&&(i=e,"OC"===_.get(i,"accommodationDeal.providerId"));var i},isValidHotelData:function(e){return!_.isEmpty(e)&&!_.includes(s,e)},getPriceTemplate:function(e,t){var i="";if(t)i="";else{var n=e.accommodationDeal.dynpackFare&&!e.isSpecialDiscount;i="price",i=e.hasRoomsLeft?"priceScarcity":i,i=n?"priceDiscount":i,i=e.hasRoomsLeft&&n?"priceScarcityDiscount":i}return i},getSelectorByData:function(e){return"[data-"+e.detail+'="'+e.value+'"]:not('+e.exclude+")"},countProviders:h,buildHotelSelectOrClickLabel:function(e,t,i){var n=_.get(e,"accommodationDeal",{}),a=_.get(e,"accommodationInfo",{});return[t+":"+n.key,"_pos:NA","_prc:"+_.get(e,"price",0)+"-"+_.get(n,"providerCurrency","").toLowerCase(),"_type:"+Odigeo.Utils.extractNumberOfChar(_.get(a,"type",""),4),"_sup:"+_.get(n,"providerId","").toLowerCase(),"_cha:"+Odigeo.Utils.extractNumberOfChar(_.get(a,"chain","nan")||"nan",4),"_list:"+i].join("")},buildHotelSelectedLabel:function(e,t,i){var n=_.get(e,"accommodationDeal",{}),a=_.get(e,"accommodationInfo",{}),s=_.get(e,"priceBreakdownDynpack",{});return["hotel_selected:"+_.get(n,"key",""),"_pos:"+t,"_prc:"+_.get(s,"pricePerPassenger",_.get(e,"price",0)),"-"+_(s).get("providerCurrency",_.get(n,"providerCurrency","")).toLowerCase(),"_type:"+Odigeo.Utils.extractNumberOfChar(_.get(a,"type",""),4),"_sup:"+_.get(n,"providerId","").toLowerCase(),"_cha:"+Odigeo.Utils.extractNumberOfChar(_.get(a,"chain","nan")||"nan",4),"_list:"+i].join("")},getTripAdvisorRateMessage:function(e,t){return e=parseFloat(e)||0,t["userRate"+Math.min(4,Math.floor(2*e-5))]||""}}},function(e,t,i){"use strict";var n=i(98),a=function(e,t){return _.get(e,["methods",t])};e.exports=function(e){return{create:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};if(!(e.isEnabled||_.constant(!0))())return n;var i,s,r,o,c,d=(i=e,s=t,o=(r=_.get(i,"options",{}))[s.id]||r["*"],{options:_.merge({},o,s.options)});return function e(t,i){return{execute:function(n){var s=arguments,r=t.then(function(e){var t=a(i,n);return _.isFunction(t)&&t.apply(e,_.tail(s)),e});return e(r,i)},get:function(e){var n=arguments;return t.then(function(t){var s=a(i,e);if(_.isFunction(s))return s.apply(t,_.tail(n))})}}}((c=_.get(e,"viewClass.prototype.name"),_.isString(c)?Odigeo.Templates.getWidgetTemplate(c):$.Deferred().resolve({}).promise()).then(function(i){return function(e,t){var i,n,a,s=e.viewClass||Backbone.View,r=e.modelClass,o=_.isUndefined(r)?{}:{model:new r};return new s(_.extend({el:(i=t,n=i.el,a=i.id,_.isUndefined(n)?_.isString(a)?"#"+a:void 0:n)},o,t))}(e,_.extend({templates:i},t,d))}),e)}}}},function(e,t,i){"use strict";var n=i(8),a=i(1);function s(e){return(e>>>24|e>>>8&65280|e<<8&16711680|(255&e)<<24)>>>0}function r(e){return 1===e.length?"0"+e:e}function o(e){return 7===e.length?"0"+e:6===e.length?"00"+e:5===e.length?"000"+e:4===e.length?"0000"+e:3===e.length?"00000"+e:2===e.length?"000000"+e:1===e.length?"0000000"+e:e}t.inherits=a,t.toArray=function(e,t){if(Array.isArray(e))return e.slice();if(!e)return[];var i,n,a=[];if("string"==typeof e)if(t){if("hex"===t)for((e=e.replace(/[^a-z0-9]+/gi,"")).length%2!=0&&(e="0"+e),r=0;r<e.length;r+=2)a.push(parseInt(e[r]+e[r+1],16))}else for(var s=0,r=0;r<e.length;r++){var o=e.charCodeAt(r);a[s++]=o<128?o:(a[s++]=o<2048?o>>6|192:(n=r,55296!=(64512&(i=e).charCodeAt(n))||n<0||n+1>=i.length||56320!=(64512&i.charCodeAt(n+1))?a[s++]=o>>12|224:(o=65536+((1023&o)<<10)+(1023&e.charCodeAt(++r)),a[s++]=o>>18|240,a[s++]=o>>12&63|128),o>>6&63|128),63&o|128)}else for(r=0;r<e.length;r++)a[r]=0|e[r];return a},t.toHex=function(e){for(var t="",i=0;i<e.length;i++)t+=r(e[i].toString(16));return t},t.htonl=s,t.toHex32=function(e,t){for(var i="",n=0;n<e.length;n++){var a=e[n];"little"===t&&(a=s(a)),i+=o(a.toString(16))}return i},t.zero2=r,t.zero8=o,t.join32=function(e,t,i,a){var s=i-t;n(s%4==0);for(var r=new Array(s/4),o=0,c=t;o<r.length;o++,c+=4){var d;d="big"===a?e[c]<<24|e[c+1]<<16|e[c+2]<<8|e[c+3]:e[c+3]<<24|e[c+2]<<16|e[c+1]<<8|e[c],r[o]=d>>>0}return r},t.split32=function(e,t){for(var i=new Array(4*e.length),n=0,a=0;n<e.length;n++,a+=4){var s=e[n];"big"===t?(i[a]=s>>>24,i[a+1]=s>>>16&255,i[a+2]=s>>>8&255,i[a+3]=255&s):(i[a+3]=s>>>24,i[a+2]=s>>>16&255,i[a+1]=s>>>8&255,i[a]=255&s)}return i},t.rotr32=function(e,t){return e>>>t|e<<32-t},t.rotl32=function(e,t){return e<<t|e>>>32-t},t.sum32=function(e,t){return e+t>>>0},t.sum32_3=function(e,t,i){return e+t+i>>>0},t.sum32_4=function(e,t,i,n){return e+t+i+n>>>0},t.sum32_5=function(e,t,i,n,a){return e+t+i+n+a>>>0},t.sum64=function(e,t,i,n){var a=e[t],s=n+e[t+1]>>>0,r=(s<n?1:0)+i+a;e[t]=r>>>0,e[t+1]=s},t.sum64_hi=function(e,t,i,n){return(t+n>>>0<t?1:0)+e+i>>>0},t.sum64_lo=function(e,t,i,n){return t+n>>>0},t.sum64_4_hi=function(e,t,i,n,a,s,r,o){var c=0,d=t;return c+=(d=d+n>>>0)<t?1:0,c+=(d=d+s>>>0)<s?1:0,e+i+a+r+(c+=(d=d+o>>>0)<o?1:0)>>>0},t.sum64_4_lo=function(e,t,i,n,a,s,r,o){return t+n+s+o>>>0},t.sum64_5_hi=function(e,t,i,n,a,s,r,o,c,d){var l=0,g=t;return l+=(g=g+n>>>0)<t?1:0,l+=(g=g+s>>>0)<s?1:0,l+=(g=g+o>>>0)<o?1:0,e+i+a+r+c+(l+=(g=g+d>>>0)<d?1:0)>>>0},t.sum64_5_lo=function(e,t,i,n,a,s,r,o,c,d){return t+n+s+o+d>>>0},t.rotr64_hi=function(e,t,i){return(t<<32-i|e>>>i)>>>0},t.rotr64_lo=function(e,t,i){return(e<<32-i|t>>>i)>>>0},t.shr64_hi=function(e,t,i){return e>>>i},t.shr64_lo=function(e,t,i){return(e<<32-i|t>>>i)>>>0}},function(e,t){var i;i=function(){return this}();try{i=i||new Function("return this")()}catch(e){"object"==typeof window&&(i=window)}e.exports=i},function(e,t,i){"use strict";var n=function(e){return e.extend({initialize:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},i=_.get(t,"templates",{});this.templates=_.get(i,"templates",{}),this.keys=_.get(i,"keys",{}),this.options=_.get(t,"options",{}),this.id=t.id||this.$el.attr("id"),e.prototype.initialize.call(this,t)}})},a=n(Backbone.View);a.extend=function(e){return n(Backbone.View.extend(e))},e.exports=a},function(e,t,i){"use strict";var n,a=Odigeo.Model.extend({dataUrl:"getinsurancecatalogue",loaded:!1,processedCollection:null,isLoadedPromise:null,initialize:function(){this.isLoadedPromise=$.Deferred(),this.populateShoppingCart()},load:function(){this.populateShoppingCart()},url:function(){return Odigeo.Settings.getProperty("serviceUrlFormatter")(this.dataUrl)},populateShoppingCart:function(){this.loaded=!1,this.processedCollection=null,this.fetch(this.getDataRequestSettings())},getDataRequestSettings:function(){return{type:"GET",cache:!1,dataType:"json",contentType:"application/json",success:_.bind(this.requestSuccessHandler,this),error:_.bind(this.requestErrorHandler,this)}},requestSuccessHandler:function(){this.loaded=!0,this.isLoadedPromise.resolve(!0),this.trigger("productCatalogueCollectionIsOk")},requestErrorHandler:function(){this.loaded=!1,this.isLoadedPromise.resolve(!1)},isLoaded:function(){return this.loaded},getInsurances:function(){return _.isEmpty(this.processedCollection)&&this.processData(),this.processedCollection},getInsurance:function(e){return _.find(this.getInsurances(),function(t){return t.id===e})},getInsuranceByPolicy:function(e){return _.find(this.getInsurances(),{policy:e})||{}},processData:function(){var e=this.toJSON(),t=e.preselected;this.processedCollection=_.map(e.insurances,function(e){return _.extend(e,{preselected:_.contains(t,e.policy)})})},isCanxFree:function(){return this.get("canxFree")},isCanxFreeCandidate:function(){return this.get("canxFreeCandidate")},getLoadedPromise:function(e){return this.isLoadedPromise.promise()}});e.exports.getInstance=function(){return _.isUndefined(n)&&(n=new a),n}},function(e,t,i){"use strict";var n=function(e){this.mixin=e};n.prototype.getMixin=function(){return _.clone(this.mixin)},n.prototype.extend=function(e){return _.extend({},this.mixin,e)},n.prototype.deepExtend=function(e){return _.merge({},this.mixin,e)},e.exports=n},function(e,t){var i,n,a=e.exports={};function s(){throw new Error("setTimeout has not been defined")}function r(){throw new Error("clearTimeout has not been defined")}function o(e){if(i===setTimeout)return setTimeout(e,0);if((i===s||!i)&&setTimeout)return i=setTimeout,setTimeout(e,0);try{return i(e,0)}catch(t){try{return i.call(null,e,0)}catch(t){return i.call(this,e,0)}}}!function(){try{i="function"==typeof setTimeout?setTimeout:s}catch(e){i=s}try{n="function"==typeof clearTimeout?clearTimeout:r}catch(e){n=r}}();var c,d=[],l=!1,g=-1;function h(){l&&c&&(l=!1,c.length?d=c.concat(d):g=-1,d.length&&u())}function u(){if(!l){var e=o(h);l=!0;for(var t=d.length;t;){for(c=d,d=[];++g<t;)c&&c[g].run();g=-1,t=d.length}c=null,l=!1,function(e){if(n===clearTimeout)return clearTimeout(e);if((n===r||!n)&&clearTimeout)return n=clearTimeout,clearTimeout(e);try{n(e)}catch(t){try{return n.call(null,e)}catch(t){return n.call(this,e)}}}(e)}}function p(e,t){this.fun=e,this.array=t}function f(){}a.nextTick=function(e){var t=new Array(arguments.length-1);if(1<arguments.length)for(var i=1;i<arguments.length;i++)t[i-1]=arguments[i];d.push(new p(e,t)),1!==d.length||l||o(u)},p.prototype.run=function(){this.fun.apply(null,this.array)},a.title="browser",a.browser=!0,a.env={},a.argv=[],a.version="",a.versions={},a.on=f,a.addListener=f,a.once=f,a.off=f,a.removeListener=f,a.removeAllListeners=f,a.emit=f,a.prependListener=f,a.prependOnceListener=f,a.listeners=function(e){return[]},a.binding=function(e){throw new Error("process.binding is not supported")},a.cwd=function(){return"/"},a.chdir=function(e){throw new Error("process.chdir is not supported")},a.umask=function(){return 0}},function(e,t,i){var n=i(2).Buffer,a=i(64).Transform,s=i(68).StringDecoder;function r(e){a.call(this),this.hashMode="string"==typeof e,this.hashMode?this[e]=this._finalOrDigest:this.final=this._finalOrDigest,this._final&&(this.__final=this._final,this._final=null),this._decoder=null,this._encoding=null}i(1)(r,a),r.prototype.update=function(e,t,i){"string"==typeof e&&(e=n.from(e,t));var a=this._update(e);return this.hashMode?this:(i&&(a=this._toString(a,i)),a)},r.prototype.setAutoPadding=function(){},r.prototype.getAuthTag=function(){throw new Error("trying to get auth tag in unsupported state")},r.prototype.setAuthTag=function(){throw new Error("trying to set auth tag in unsupported state")},r.prototype.setAAD=function(){throw new Error("trying to set aad in unsupported state")},r.prototype._transform=function(e,t,i){var n;try{this.hashMode?this._update(e):this.push(this._update(e))}catch(e){n=e}finally{i(n)}},r.prototype._flush=function(e){var t;try{this.push(this.__final())}catch(e){t=e}e(t)},r.prototype._finalOrDigest=function(e){var t=this.__final()||n.alloc(0);return e&&(t=this._toString(t,e,!0)),t},r.prototype._toString=function(e,t,i){if(this._decoder||(this._decoder=new s(t),this._encoding=t),this._encoding!==t)throw new Error("can't switch encodings");var n=this._decoder.write(e);return i&&(n+=this._decoder.end()),n},e.exports=r},function(e,t,i){"use strict";e.exports=function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:_.identity;return e.extend({initialize:function(){var i=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},n=_.get(i,"templates.templates.main",_.constant("")),a=_.get(i,"templates.keys",{}),s=i.options;this.$el.html(n(t({keys:a,options:s}))),e.prototype.initialize.call(this,i)}})}},function(e,t,i){"use strict";var n=i(44),a=Object.keys||function(e){var t=[];for(var i in e)t.push(i);return t};e.exports=g;var s=i(30);s.inherits=i(1);var r=i(105),o=i(67);s.inherits(g,r);for(var c=a(o.prototype),d=0;d<c.length;d++){var l=c[d];g.prototype[l]||(g.prototype[l]=o.prototype[l])}function g(e){if(!(this instanceof g))return new g(e);r.call(this,e),o.call(this,e),e&&!1===e.readable&&(this.readable=!1),e&&!1===e.writable&&(this.writable=!1),this.allowHalfOpen=!0,e&&!1===e.allowHalfOpen&&(this.allowHalfOpen=!1),this.once("end",h)}function h(){this.allowHalfOpen||this._writableState.ended||n.nextTick(u,this)}function u(e){e.end()}Object.defineProperty(g.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&void 0!==this._writableState&&this._readableState.destroyed&&this._writableState.destroyed},set:function(e){void 0!==this._readableState&&void 0!==this._writableState&&(this._readableState.destroyed=e,this._writableState.destroyed=e)}}),g.prototype._destroy=function(e,t){this.push(null),this.end(),n.nextTick(t,e)}},function(e,t,i){"use strict";var n,a=i(90),s=Backbone.Model,r=a.extend({nestedProps:{departure:s,destination:s}}),o=Backbone.Collection.extend({model:r}),c=function(e){var t=e.toJSON();Odigeo.Session.set("searchParameters",JSON.stringify(t))},d=a.extend({initialize:function(){this.listenTo(this,"change",c)},nestedProps:{searchSegments:o}});e.exports={getInstance:function(){return _.isUndefined(n)&&(n=new d),n}}},function(e,t,i){"use strict";e.exports={confirmation_cars_banner:"confirmation_cars_banner",confirmation_cars_emerginglayer:"confirmation_cars_emerginglayer",confirmation_cars_smartblock:"confirmation_cars_smartblock",mytrips_cars_banner:"mytrips_cars_banner",mytripdetails_cars_banner:"mytripdetails_cars_banner",mytripdetails_cars_smartblock:"mytripdetails_cars_smartblock",mytripsdetails_hotels_emerginglayer:"mytripsdetails_hotels_emerginglayer",mytripsdetails_hotels_iframe:"mytripsdetails_hotels_iframe"}},function(e,t,i){"use strict";var n=i(150).getInstance(),a=i(15),s=["create","update","delete"],r=["read"];e.exports=new a({init:function(){this.widget instanceof Odigeo.Widget&&this.listenTo(this.widget,"construct",this.fetchFromSearchModel),this.listenTo(n,"sync:fetch",this.fetchFromSearchModel),this.listenTo(n,"clear",this.clear),this.listenTo(n,"errors",this.setErrors),this.listenTo(n,"change",function(e,t){_.isEqual(t.modelId,this.getModelId())||t.silent||this.trigger("changeSearchModel",e,t)}),this.on("add remove",this.save),this.bindCustomEvents(n)},listenSearchModelProperty:function(e,t){this.listenTo(n,"change:"+e,t)},setSearchModelProperty:function(e,t){n.set(e,t)},setErrors:function(e,t){_.isArray(e)&&(this.errors=e),t.silent||this.trigger("error",this.errors)},getErrors:function(){return _.isArray(this.errors)?this.errors:[]},sync:function(e,t,i){return i=i||{},_.includes(r,e)&&this.getModelMethod(i),_.includes(s,e)&&!i.searchModelSilent&&this.setModelMethod(t,i),$.Deferred().resolve().promise()},save:function(e,t,i){return this instanceof Odigeo.Model?Odigeo.Model.prototype.save.call(this,e,t,i):this instanceof Backbone.Model?Backbone.Model.prototype.save.call(this,e,t,i):this.sync("update",this,i)},fetchFromSearchModel:function(){return this.fetch.apply(this,arguments).then(_.bind(this.trigger,this,"sync:fetch")),this},getModelMethod:function(e){e.success(this.getOriginalData())},setModelMethod:function(e,t){n.set(this.pushParse(e,this.getOriginalData()),_.extend({modelId:this.getModelId()},t))},parse:function(e){return _.pick(e,_.keys(this.defaults))},pushParse:function(){return _.pick(this.toJSON(),_.keys(this.defaults))},getModelId:function(){return _.result(this.widget,"id")},getOriginalData:function(){return n.toJSON()},bindCustomEvents:function(){},getDates:function(){return n.getDates()}})},function(e,t,i){"use strict";(function(t,n){var a=i(2).Buffer,s=t.crypto||t.msCrypto;s&&s.getRandomValues?e.exports=function(e,i){if(65536<e)throw new Error("requested too many random bytes");var r=new t.Uint8Array(e);0<e&&s.getRandomValues(r);var o=a.from(r.buffer);return"function"!=typeof i?o:n.nextTick(function(){i(null,o)})}:e.exports=function(){throw new Error("Secure random number generation is not supported by this browser.\nUse Chrome, Firefox or Internet Explorer 11")}}).call(this,i(12),i(16))},function(e,t,i){var n=i(2).Buffer;function a(e,t){this._block=n.alloc(e),this._finalSize=t,this._blockSize=e,this._len=0}a.prototype.update=function(e,t){"string"==typeof e&&(t=t||"utf8",e=n.from(e,t));for(var i=this._block,a=this._blockSize,s=e.length,r=this._len,o=0;o<s;){for(var c=r%a,d=Math.min(s-o,a-c),l=0;l<d;l++)i[c+l]=e[o+l];o+=d,(r+=d)%a==0&&this._update(i)}return this._len+=s,this},a.prototype.digest=function(e){var t=this._len%this._blockSize;this._block[t]=128,this._block.fill(0,t+1),t>=this._finalSize&&(this._update(this._block),this._block.fill(0));var i=8*this._len;if(i<=4294967295)this._block.writeUInt32BE(i,this._blockSize-4);else{var n=(4294967295&i)>>>0,a=(i-n)/4294967296;this._block.writeUInt32BE(a,this._blockSize-8),this._block.writeUInt32BE(n,this._blockSize-4)}this._update(this._block);var s=this._hash();return e?s.toString(e):s},a.prototype._update=function(){throw new Error("_update must be implemented by subclass")},e.exports=a},,,function(e,t,i){"use strict";var n=i(102);e.exports={isMyTripsHome:function(){if("mytrips"!==Odigeo.History.getPageNameFromFragment())return null;var e=window.location.href.split("/"),t=_.last(e).charAt(0);return!_.isFinite(parseInt(t))},isConfirmationPage:function(){return"confirmation"===Odigeo.History.getPageNameFromFragment().toLowerCase()},getPassengers:function(e){var t=_.groupBy(e,"travellerType");return{numAdults:_.size(t.ADULT),numChildren:_.size(t.CHILD),numInfants:_.size(t.INFANT)}},getToken:function(e,t){var i="";return t&&(i=n.createHmac("sha256",t).update(e).digest("hex")),i},getFormattedDate:function(e,t){var i=new Date(e);return Odigeo.Utils.formatDate(i,t)},getEncodedDate:function(e,t){var i=this.getFormattedDate(e,t);return encodeURIComponent(i)}}},,function(e,t,i){"use strict";var n=i(1),a=i(63),s=i(69),r=i(70),o=i(17);function c(e){o.call(this,"digest"),this._hash=e}n(c,o),c.prototype._update=function(e){this._hash.update(e)},c.prototype._final=function(){return this._hash.digest()},e.exports=function(e){return"md5"===(e=e.toLowerCase())?new a:"rmd160"===e||"ripemd160"===e?new s:new c(r(e))}},function(e,t,i){(function(e){function i(e){return Object.prototype.toString.call(e)}t.isArray=function(e){return Array.isArray?Array.isArray(e):"[object Array]"===i(e)},t.isBoolean=function(e){return"boolean"==typeof e},t.isNull=function(e){return null===e},t.isNullOrUndefined=function(e){return null==e},t.isNumber=function(e){return"number"==typeof e},t.isString=function(e){return"string"==typeof e},t.isSymbol=function(e){return"symbol"==typeof e},t.isUndefined=function(e){return void 0===e},t.isRegExp=function(e){return"[object RegExp]"===i(e)},t.isObject=function(e){return"object"==typeof e&&null!==e},t.isDate=function(e){return"[object Date]"===i(e)},t.isError=function(e){return"[object Error]"===i(e)||e instanceof Error},t.isFunction=function(e){return"function"==typeof e},t.isPrimitive=function(e){return null===e||"boolean"==typeof e||"number"==typeof e||"string"==typeof e||"symbol"==typeof e||void 0===e},t.isBuffer=e.isBuffer}).call(this,i(3).Buffer)},function(e,t,i){(function(t){e.exports=function(e,i){for(var n=Math.min(e.length,i.length),a=new t(n),s=0;s<n;++s)a[s]=e[s]^i[s];return a}}).call(this,i(3).Buffer)},function(e,t,i){"use strict";var n=i(11),a=i(8);function s(){this.pending=null,this.pendingTotal=0,this.blockSize=this.constructor.blockSize,this.outSize=this.constructor.outSize,this.hmacStrength=this.constructor.hmacStrength,this.padLength=this.constructor.padLength/8,this.endian="big",this._delta8=this.blockSize/8,this._delta32=this.blockSize/32}(t.BlockHash=s).prototype.update=function(e,t){if(e=n.toArray(e,t),this.pending?this.pending=this.pending.concat(e):this.pending=e,this.pendingTotal+=e.length,this.pending.length>=this._delta8){var i=(e=this.pending).length%this._delta8;this.pending=e.slice(e.length-i,e.length),0===this.pending.length&&(this.pending=null),e=n.join32(e,0,e.length-i,this.endian);for(var a=0;a<e.length;a+=this._delta32)this._update(e,a,a+this._delta32)}return this},s.prototype.digest=function(e){return this.update(this._pad()),a(null===this.pending),this._digest(e)},s.prototype._pad=function(){var e=this.pendingTotal,t=this._delta8,i=t-(e+this.padLength)%t,n=new Array(i+this.padLength);n[0]=128;for(var a=1;a<i;a++)n[a]=0;if(e<<=3,"big"===this.endian){for(var s=8;s<this.padLength;s++)n[a++]=0;n[a++]=0,n[a++]=0,n[a++]=0,n[a++]=0,n[a++]=e>>>24&255,n[a++]=e>>>16&255,n[a++]=e>>>8&255,n[a++]=255&e}else for(n[a++]=255&e,n[a++]=e>>>8&255,n[a++]=e>>>16&255,n[a++]=e>>>24&255,n[a++]=0,n[a++]=0,n[a++]=0,n[a++]=0,s=8;s<this.padLength;s++)n[a++]=0;return n}},function(e,t,i){var n=t;n.bignum=i(4),n.define=i(282).define,n.base=i(34),n.constants=i(131),n.decoders=i(288),n.encoders=i(290)},function(e,t,i){var n=t;n.Reporter=i(285).Reporter,n.DecoderBuffer=i(130).DecoderBuffer,n.EncoderBuffer=i(130).EncoderBuffer,n.Node=i(286)},function(e,t,i){"use strict";var n,a,s,r,o,c,d,l,g,h,u,p,f,m,b,y,v,S,C,w,O,T,P,E,k,A,D,I,x,B,R,M,N,L=i(0),U=".nag_btn_ignore",F=Odigeo.Events.tap;e.exports=(n=void 0,a=function(e){return s(e),r(e).toggle(!0)},s=function(e){return n=e.view},r=function(e){return o(T(e),e)},o=function(e,t){return c(e,t),b(t),e},c=function(e,t){return[p,f].forEach(function(i){return i(e,t)})},d=function(e){return S(e,"actionBtnFunction")},l=function(e){return S(e,"ignoreBtnFunction")},g=function(e){return m(e).trackingAdd},h=function(e){return m(e).trackingContinue},u=function(e){for(var t,i=arguments.length,n=Array(1<i?i-1:0),a=1;a<i;a++)n[a-1]=arguments[a];return(t=_).extend.apply(t,[{nagLightBox:e}].concat(n))},p=function(e,t){return R(u(e,t,{id:".nag_btn_action",action:d(i=t),tracking:g(i),triggerContinueButtonBindings:i.shouldRebindContinueButtonAfterActionBtnPressed},w(t)));var i},f=function(e,t){return R(u(e,t,{id:U,action:l(i=t),tracking:h(i),triggerContinueButtonBindings:!1},w(t)));var i},m=function(e){return e.tracking||{}},b=function(e){return v("nags",y(e),w(e).page,!0)},y=function(e){return m(e).trackingLoad},v=function(){return L.trackEvent.apply(L,arguments)},S=function(e,t){return e[t]||_.noop},C=function(){return(0<arguments.length&&void 0!==arguments[0]?arguments[0]:{}).page||Odigeo.History.getPageNameFromFragment()},w=function(e){return{page:C(m(e))}},O=function(){return A().removeClass("open")},T=function(e){return t=e,n.$el.append(E(t)),P();var t},P=function(){return new Odigeo.UIElements.Lightbox(A(),{closeOnOuterClick:!1,focusClass:U})},E=function(e){return k(e)({translations:e.translations,data:e.data})},k=function(e){return _.template(D(e).html(),Odigeo.Utils.getTmplSettings())},A=function(){return n.$el.find("#nag_container")},D=function(e){return n.$el.find(e.isOfferNag?".nag_offer_template_container":".nag_template_container")},I=function(e){return t={action:(i=e).tracking,page:C(i)},v("nags",t.action,t.page),x(e);var t,i},x=function(e){return e.nagLightBox.remove()},B=function(e,t){return _.isFunction(e)&&e(),t&&Odigeo.trigger("passengers_manager:continueButtonBinding",!1)},R=function(e){return N(e).on(F,e.id,function(t){return M(t,e)})},M=function(e,t){return(i=e).preventDefault(),i.stopPropagation(),I(t),B(t.action,t.triggerContinueButtonBindings);var i},N=function(e){return _.get(e,"nagLightBox.$container",{on:_.noop})},{show:function(e){return a(e),{close:O,config:e}}})},function(e,t,i){"use strict";var n=i(58).getInstance(),a=i(97).getInstance(),s=i(37).getInstance(),r=i(59).getInstance(),o=i(142).getInstance(),c=i(15),d=i(82),l=i(41);e.exports=new c({CONST_TYPES:{baggageType:"BAGGAGE_TYPE",transportType:"TRANSPORT_TYPE",applicationLevel:"APPLICATION_LEVEL",rowIds:"ROW_IDS",requestType:"REQUEST_TYPE",itinerarySegmentsCount:2},getBaggagesType:function(e){return _.isUndefined(this[e])&&(this[e]=_.clone(s[e])),this[e]},getBaggagesTypesEnum:function(){return this.getBaggagesType(this.CONST_TYPES.baggageType)},getBaggagesTransportsEnum:function(){return this.getBaggagesType(this.CONST_TYPES.transportType)},getBaggagesApplicationLevelEnum:function(){return this.getBaggagesType(this.CONST_TYPES.applicationLevel)},getBaggagesRowIdsArray:function(){return this.getBaggagesType(this.CONST_TYPES.rowIds)},getBaggagesRequestTypesEnum:function(){return this.getBaggagesType(this.CONST_TYPES.requestType)},getRowIdsWithBaggageSelection:function(){return _.uniq(_.map(this.getBaggageSelectedOptionsWithPieces(),function(e){return e.get("idRow")}))},getAllSelectableRowIds:function(){return _.map(this.getBaggagesPassengerSelection(0),function(e){return e.get("idRow")})},subscribeToCollectionEvent:function(e,t){_.isFunction(t)&&this.listenTo(o,e,t)},suscribeOnCollectionBuildEvent:function(){var e="collectionBuilt",t=this.getEventHandlersHolder().onCollectionBuilt;_.isFunction(t)&&this.listenTo(o,e,t),this.listenTo(o,e,this.suscribeOnBaggageChangeEvent),this.listenTo(o,e,this.suscribeOnBaggageLoadedEvent)},suscribeOnBaggageChangeEvent:function(){var e=this.getEventHandlersHolder().onBaggageChange;_.isFunction(e)&&Odigeo.bind("baggagesObserver:onBaggageChange",_.bind(e,this))},suscribeOnBaggageLoadedEvent:function(){var e=this.getEventHandlersHolder().onBaggageLoaded;_.isFunction(e)&&Odigeo.bind("baggagesObserver:onBaggageLoaded",_.bind(e,this))},suscribeBaggagesCollectionEvents:function(){this.suscribeOnCollectionBuildEvent()},getEventHandlersHolder:function(){return _.isEmpty(this.eventHandlers)?this:this.eventHandlers},getBaggageOptionByCid:function(e){return n.get(e)},getFirstBaggageOption:function(e){return n.getOption(e)},getAllBaggagesOptions:function(e){return n.getOptions(e)},getAllSpecialBaggageOptions:function(e){return a.getOptions(e)},getBaggagesRowSelection:function(e,t){return n.getRowSelection(e,t)},getBaggagesRowIncluded:function(e,t){return n.getRowIncluded(e,t)},getBaggagesPassengerSelection:function(e){return n.getPassengerSelection(e)},getBaggagesFullSelection:function(){return n.getFullSelection()},getBaggageSelectedOptionsWithPieces:function(){return _.filter(this.getBaggagesFullSelection(),function(e){return 0<e.get("piecesToShow")})},getBaggageBundleDiscountPercentage:function(){return s.getBaggageBundleDiscountPercentage()},getBaggageRowByCid:function(e){return s.get(e)},getBaggageFirstRow:function(e){return s.getRow(e)},getBaggageAllRows:function(){return s.toJSON()},getBaggageAllRowsWithCid:function(){return _.merge(_.map(s.models,function(e){return{cid:e.cid}}),s.toJSON())},getPassengerRows:function(e){return s.getPassengerRows(e)},getPassengerSelectableRows:function(e){return s.getPassengerSelectableRows(e)},getPassengerIncludedAndSelectableRows:function(e){return s.getPassengerIncludedAndSelectableRows(e)},getBaggageIncludedPieces:function(){return n.includedPieces},getBaggageSelectedPieces:function(){return n.selectedPieces},getPassengerBaggageSelectedPieces:function(e){return n.getPassengerBaggageSelectedPieces(e)},getTotalBaggageSelectedFee:function(){return _.reduce(this.getBaggageSelectedOptionsWithPieces(),function(e,t){return e+s.getRow({idRow:t.get("idRow"),idPassenger:t.get("idPassenger")}).get("baggageFeeIncludedInPrice")*t.get("piecesToShow")},0)},getSelectedBaggageAverageFee:function(){var e=this.getBaggageSelectedPieces();return this.isAnItineraryTrip()&&(e*=this.CONST_TYPES.itinerarySegmentsCount),0<e?Odigeo.Utils.formatCurrency(this.getTotalBaggageSelectedFee()/e):0},getBaggagePropensity:function(){var e=_.first(this.getPassengerSelectableRows(0));return _.isEmpty(e)?null:e.get("baggagePropensity")},getDiscount:function(){return n.getDiscount()},getDiscountedPart:function(){return n.getDiscountedPart()},isBaggagePropensityLow:function(){var e=this.getBaggagePropensity(),t=_.isNumber(e)&&e<=.2;return Odigeo.AB.isBagPropensityNag&&t},getBaggageSelectedTotalPrice:function(){return this.getBaggagesDiscountPrice(n.selectedTotalPrice)},getBaggagesInCartTotal:function(){return n.selectedInCartTotalPrice},getBaggagesRequestType:function(){return s.requestType},getTripTypeId:function(){var e=this.getBaggagesRequestType();return"ONE_WAY"===e?"OW":"ROUND_TRIP"===e?"RT":"MD"},getSelectableRowsNoExtraBag:function(){return _.filter(this.getBaggageAllRows(),function(e){return!e.hasIncludedBaggages&&e.hasSelectableBaggages})},getFirstSelectableOptionsEachPax:function(){return _.map(this.getSelectableRowsNoExtraBag(),function(e){return _.first(this.getAllBaggagesOptions({idPassenger:e.idPassenger,idRow:e.idRow,selected:!1}))},this)},getFirstSelectableBaggageData:function(){var e=_.first(this.getFirstSelectableOptionsEachPax());return _.isUndefined(e)?{}:e.pick("piecesToShow","kilos","price")},getSegmentsWithBagSelectionFormatted:function(e,t){var i=_.reduce(t,function(t,i){var n=_.indexOf(e,i);return 0<=n&&t.push(n+1),t},[],this);return _.isEmpty(i)?"0":i.join("-")},getFlightsWithBagsSelectedTracking:function(){return this.haveAllSegmentsBagsSelected()?"ALL":this.getSegmentsWithBagSelectionFormatted(this.getBaggagesRowIdsArray(),this.getRowIdsWithBaggageSelection())},evenUpBaggageSelection:function(){_.forEach(this.getFirstSelectableOptionsEachPax(),function(e){this.updateBaggageSelection({newOptionCid:e,isUserAction:!0,triggerEvents:!0})},this)},getPaxCount:function(){var e=Odigeo.Utils.parseJson(Odigeo.Session.get("searchParameters"))||{};return(e.numAdults||1)+(e.numChildren||0)},getFRSegments:function(){return _.filter(this.getBaggageAllRows(),function(e){return"FR"===e.carrierCode})},setPromotionBadgeTracking:function(){var e=_.size(this.getAllSelectableRowIds()),t=_.size(this.getBaggageIncludedPieces()),i=this.options.isMeta?1:0,a=this.getTripTypeId(),s=this.getPaxCount(),r=_.size(this.getFRSegments()),o=n.getBaggagePropensity(),c="baggage_loaded:"+e+"-"+t+"_meta:"+i+"_type:"+a+"_pax:"+s+"_FR:"+r+"_disc:"+(1<Odigeo.AB.promotionMerchandisingBadgePartition&&_.isNumber(o)&&o<n.CONST.BAGS_PROPENSITY_THRESHOLD?"all":"no");this.view.sendPromotionBadgeTracking(c)},sendContinueToPaymentBaggageTracking:function(e){var t=this.getBaggageSelectedPieces(),i=this.getBaggageIncludedPieces(),a=this.options.isMeta?1:0,s=this.getTripTypeId(),o=(e.ADULT||0)+(e.CHILD||0),c=this.getFlightsWithBagsSelectedTracking(),d=n.getBaggagePropensity(),g=1<Odigeo.AB.promotionMerchandisingBadgePartition&&_.isNumber(d)&&d<n.CONST.BAGS_PROPENSITY_THRESHOLD,h="num_bags:"+t+"-"+i+"_meta:"+a+"_type:"+s+"_flig:"+c+"_pax:"+o+"_num:"+(t+i)+"_"+(r.getCarrier()||"FR")+":"+l.getTypeTrackingConstant(r.getSelectedType())+"-"+this.getBoardingOptionsTrackingConstant()+"_disc:"+(g?"all":"no");this.sendBaggageTracking(h,"")},getBoardingOptionsTrackingConstant:function(){return r.isPriorityOptionsActive()?r.getCarrierSections():"0"},doBaggageAllowAutoselection:function(){return Odigeo.AB.isBaggageGroupedBySegment?s.isAutoSelectionEnabled():n.doOptionsAllowAutoselection()&&s.doRowsAllowAutoselection()},doBaggageAllowSmartNag:function(){var e=s.isAnItineraryTrip()||s.isOneWayTrip();return(n.doOptionsAllowSmartNag()||e)&&s.doRowsAllowSmartNag()&&!this.hasIncludedBaggage()},doBaggageAllowEvenUpNag:function(){var e=this.hasIncludedBaggage()&&this.hasSelectableRowsNoExtraBag();return s.isRoundTrip()&&!s.isAnItineraryTrip()&&e},getBaggagePassengerComposedRowsInfo:function(e){var t=this.getPassengerRows(e);return _.map(t,function(t){var i=t.get("idRow"),n={idPassenger:e,idRow:i},a=this.sortOptions(this.getAllBaggagesOptions(n)),s=!d.isBannedAirline(t.get("carrierCode"),Odigeo.AB.isHidingBannedAirlineLogos);return{rowDescriptor:t,airline:{imageShown:s},options:a,selected:this.getBaggagesRowSelection(e,i),included:this.getBaggagesRowIncluded(e,i)}},this)},getBaggagesDiscountPrice:function(e){var t=s.getBaggageBundleDiscountPercentage();return 0<t&&n.areAllPassengersWithBaggage()&&Odigeo.AB.isBaggageDiscountEnabled&&(e-=t/100*e),e},getBaggagesDiscount:function(){return s.getBaggageBundleDiscountPercentage()},getAreAllPassengersWithBaggage:function(){return n.areAllPassengersWithBaggage()},hasAllRowsIncludedBaggages:function(){var e=_.filter(this.getBaggageAllRows(),{hasIncludedBaggages:!0});return 0<this.getBaggageAllRows().length&&e.length===this.getBaggageAllRows().length},getAllBaggagePriceBreakDownItems:function(){return this.processBaggagePriceBreakDownItems(!0)},getBaggagePriceBreakDownItems:function(){return this.processBaggagePriceBreakDownItems(!1)},processBaggagePriceBreakDownItems:function(e){return _.map(this.getPassengerRows(0),function(t){var i=t.toJSON(),n=[{idRow:i.idRow,selected:!0,isSelectableBaggage:!0}];e&&n.push({idRow:i.idRow,isIncludedBaggage:!0});var a=this.getBaggageOptions(n);return _.extend({},{baggagesItems:a,size:this.getTotalPieces(a)},_.pick(i,"departureIata","arrivalIata","baggageApplicationLevel","idRow"))},this)},getBaggageOptions:function(e){var t=_.map(e,function(e){return this.getAllBaggagesOptions(e)},this);return this.getBaggageTotalByWeight(_.flatten(t))},getTotalPieces:function(e){return _.reduce(e,function(e,t){return e+t.pieces},0)},getTotalPrice:function(e){return _.reduce(e,function(e,t){return e+this.getTotalSegmentPrice(t.baggagesItems)},0,this)},getPriceBeforeDiscount:function(e){return _.reduce(e,function(e,t){return e+this.getTotalSegmentPriceBeforeDiscount(t.baggagesItems)},0,this)},getTotalSegmentPrice:function(e){return _.reduce(e,function(e,t){return e+(_.isUndefined(t.price)?0:t.price)},0)},getTotalSegmentPriceBeforeDiscount:function(e){return _.reduce(e,function(e,t){return e+(_.isUndefined(t.priceBeforeDiscount)?0:t.priceBeforeDiscount)},0)},extendItineraryBaggage:function(e){var t=[];return"ROUND_TRIP"!==this.getFlightType()?e:(_.each(e,function(e){t.push(e),"ITINERARY"===e.baggageApplicationLevel&&"FIRST"===e.idRow&&t.push(_.extend(_.clone(e),{arrivalIata:e.departureIata,departureIata:e.arrivalIata,idRow:"SECOND"}))}),t)},getAccumulatedBaggageDescriptor:function(e){return _.reduce(e,function(e,t){return{pieces:e.pieces+this.getOptionPieces(t),kilos:t.get("kilos"),kilosPerPiece:t.get("kilosPerPiece"),length:e.length||t.get("pieces"),price:e.price+t.get("price")}},{pieces:0,kilos:0,kilosPerPiece:0,price:0,length:0},this)},getOptionPieces:function(e){return e.get("isIncludedBaggage")?e.get("pieces"):e.get("piecesToShow")},getBaggageTotalByWeight:function(e){var t=this.getBaggageGroupedByWeight(e),i=this.accumulateBaggageTotalByWeight(t);return 0<i.length?i:[{pieces:0,kilos:0}]},accumulateBaggageTotalByWeight:function(e){var t=this,i={pieces:0,kilos:!0,price:0,priceBeforeDiscount:0},n=_.reduce(e,function(e,t){var n=this.getAccumulatedBaggageDescriptor(t);return 0!==n.pieces&&(e.push(n),i=this.getCompoundWeightBaggageOption(i,n)),e},[],this);return i.priceBeforeDiscount=i.price,i.price=this.getBaggagesDiscountPrice(i.price),i.kilos&&0<n.length&&(n=_.map(n,function(e){return e.priceBeforeDiscount=e.price,e.price=t.getBaggagesDiscountPrice(e.price),e})),i.kilos?n:[{pieces:i.pieces,kilos:0,length:1,price:i.price,priceBeforeDiscount:i.priceBeforeDiscount}]},getCompoundWeightBaggageOption:function(e,t){return{pieces:e.pieces+t.pieces,kilos:e.kilos&&0<t.kilos,price:e.price+t.price}},getBaggageGroupedByWeight:function(e){return _.groupBy(e,function(e){return e.get("kilosPerPiece")})},calculateTotalQuantity:function(){return this.getBaggageIncludedPieces()+this.getBaggageSelectedPieces()},calculateTotalSum:function(){return this.getBaggageSelectedTotalPrice()},hasPassengerSelectableBaggage:function(){var e=this.getFirstBaggageOption({idPassenger:this.options.paxIndex,isSelectableBaggage:!0});return!_.isUndefined(e)},hasAnySelectableBaggage:function(){var e=this.getFirstBaggageOption({isSelectableBaggage:!0,selected:!1});return!_.isUndefined(e)},hasAnySpecialBaggage:function(){return a.length},hasIncludedBaggage:function(){var e=this.getFirstBaggageOption({isIncludedBaggage:!0});return!_.isUndefined(e)},hasSelectableRowsNoExtraBag:function(){return 0<_.size(this.getSelectableRowsNoExtraBag())},hasNotSelectableOrIncludedBaggages:function(){return!this.hasAnySelectableBaggage()&&!this.hasIncludedBaggage()},haveAllSegmentsBagsSelected:function(){return _.size(this.getAllSelectableRowIds())===_.size(this.getRowIdsWithBaggageSelection())},hasPassengerAllSegmentsWithIncludedAndSelectableBaggage:function(){var e=this.getPassengerRows(this.options.paxIndex),t=this.getPassengerIncludedAndSelectableRows(this.options.paxIndex);return!_.isUndefined(e)&&!_.isUndefined(t)&&e.length===t.length},hasNoBagBeenSelected:function(){return 0===n.selectedPieces},hasAllPassengerRowsSelectedBaggage:function(e){var t=this.getFirstBaggageOption({idPassenger:e,selected:!0,pieces:0});return _.isUndefined(t)},isAnItineraryTrip:function(){return s.isAnItineraryTrip()},isOneWayTrip:function(){return s.isOneWayTrip()},getFlightType:function(){return s.getRequestType()},sortOptions:function(e){var t=void 0,i=_.reject(e,function(e){var i=0===e.get("pieces");return i&&(t=e),i}),n=_.sortBy(i,function(e){return e.get("pieces")});return _.isUndefined(t)||n.push(t),n}})},function(e,t,i){"use strict";var n,a=Backbone.Collection.extend({model:i(185),BAGGAGE_TYPE:{notAllowed:"NOT_ALLOWED",included:"INCLUDED",includedSelectable:"INCLUDED_SELECTABLE",selectable:"SELECTABLE"},TRANSPORT_TYPE:{airplane:"PLANE",train:"TRAIN"},APPLICATION_LEVEL:{itinerary:"ITINERARY",segment:"SEGMENT",section:"SECTION"},REQUEST_TYPE:{oneWay:"ONE_WAY",roundTrip:"ROUND_TRIP",multiTrip:"MULTIPLE_DESTINATIONS"},requestType:"",allowAutoselection:null,allowSmartNag:null,allSelectable:null,allSameCarrier:null,autoSelectionEnabled:!1,baggageBundleDiscountPercentage:0,ROW_IDS:["FIRST","SECOND","THIRD","FOURTH","FIFTH","SIXTH"],baggage_row_ids:[],fillData:function(e,t){var i;_.isNaN(t.idPassenger)||(i={idPassenger:t.idPassenger,idRow:t.idRow,hasIncludedBaggages:t.hasIncludedBaggages,hasSelectableBaggages:t.hasSelectableBaggages,hasSpecialBaggage:t.hasSpecialBaggage,carrierCode:e.carrier.code,departureCity:e.departureLocation.city,departureCityIata:e.departureLocation.cityIataCode,departureIata:e.departureLocation.iata,arrivalCity:e.arrivalLocation.city,arrivalCityIata:e.arrivalLocation.cityIataCode,arrivalIata:e.arrivalLocation.iata,transportType:e.transportType,baggageApplicationLevel:e.baggageApplicationLevel,baggageFeeIncludedInPrice:e.baggageFeeIncludedInPrice,baggagePropensity:e.baggagePropensity},this.add(i),this.baggage_row_ids=_.union(this.baggage_row_ids,[t.idRow]))},setBaggageBundleDiscountPercentage:function(e){this.baggageBundleDiscountPercentage=e},clearCollection:function(){this.remove(this.models)},getBaggageBundleDiscountPercentage:function(){return this.baggageBundleDiscountPercentage},getRow:function(e){return this.findWhere(e)},getRows:function(e){return this.where(e)},getRowIds:function(){return this.baggage_row_ids},getPassengerRows:function(e){return this.getRows({idPassenger:e})},getPassengerIncludedAndSelectableRows:function(e){return this.getRows({idPassenger:e,hasIncludedBaggages:!0,hasSelectableBaggages:!0})},getPassengerSelectableRows:function(e){return this.getRows({idPassenger:e,hasSelectableBaggages:!0})},setRequestType:function(e){_.contains(_.values(this.REQUEST_TYPE),e)&&(this.requestType=e)},getRequestType:function(){return this.requestType},setAutoSelectionEnabled:function(e){this.autoSelectionEnabled=e},isAutoSelectionEnabled:function(){return this.autoSelectionEnabled},areAllLegsSelectable:function(){var e;return _.isNull(this.allSelectable)&&(e=this.getRows({hasSelectableBaggages:!0}),this.allSelectable=e.length===this.length),this.allSelectable},hasAllRowsSameCarrier:function(){var e,t,i,n;return _.isNull(this.allSameCarrier)&&(e=this.getRow({idPassenger:0,idRow:this.ROW_IDS[0]}),i=_.isUndefined(e)?"":e.get("carrierCode"),t=this.getRow({idPassenger:0,idRow:this.ROW_IDS[1]}),n=_.isUndefined(t)?"":t.get("carrierCode"),this.allSameCarrier=i===n),this.allSameCarrier},getCarrierOfRow:function(e){var t;return t=this.getRow({idPassenger:0,idRow:this.ROW_IDS[e]}),_.isUndefined(t)?"":t.get("carrierCode")},doRowsAllowAutoselection:function(){var e;return _.isNull(this.allowAutoselection)&&(e=this.requestType===this.REQUEST_TYPE.roundTrip,this.allowAutoselection=e&&this.areAllLegsSelectable()),this.allowAutoselection},doRowsAllowSmartNag:function(){var e;return _.isNull(this.allowSmartNag)&&(e=this.isOneWayTrip()||this.requestType===this.REQUEST_TYPE.roundTrip,this.allowSmartNag=e&&this.areAllLegsSelectable()),this.allowSmartNag},isRoundTrip:function(){return this.requestType===this.REQUEST_TYPE.roundTrip},isAnItineraryTrip:function(){return this.requestType===this.REQUEST_TYPE.roundTrip&&_.every(this.toJSON(),function(e){return e.baggageApplicationLevel===this.APPLICATION_LEVEL.itinerary},this)},isOneWayTrip:function(){return this.requestType===this.REQUEST_TYPE.oneWay}});e.exports.getInstance=function(){return _.isUndefined(n)&&(n=new a),n}},,function(e,t,i){"use strict";e.exports={isGRecaptchaLoaded:!1,isGRecaptchaInit:!1,init:function(){this.isGRecaptchaInit||(window.grecaptchaloaded=_.bind(this.gRecaptchaLoaded,this),Odigeo.require(["recaptcha"]),this.isGRecaptchaInit=!0)},gRecaptchaLoaded:function(){this.isGRecaptchaLoaded=!0,Odigeo.trigger("recaptcha:loaded")},gRecaptchaRender:function(e,t,i){return window.grecaptcha.render(e,{sitekey:i,badge:"inline",size:"invisible",theme:"light",callback:t,"error-callback":Function.prototype,"expired-callback":Function.prototype})},gRecaptchaExecute:function(e){window.grecaptcha.execute(e)},gRecaptchaGetResponse:function(e){return window.grecaptcha.getResponse(e)},gRecaptchaReset:function(e){_.isUndefined(e)||window.grecaptcha.reset(e)}}},function(e,t,i){"use strict";var n=i(98),a={};e.exports=function(e){return{get:function(t,i){var s=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var i=[],n=!0,a=!1,s=void 0;try{for(var r,o=e[Symbol.iterator]();!(n=(r=o.next()).done)&&(i.push(r.value),!t||i.length!==t);n=!0);}catch(e){a=!0,s=e}finally{try{!n&&o.return&&o.return()}finally{if(a)throw s}}return i}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}(e[t]||[],3),r=s[0],o=s[1],c=s[2];return i=i||r,o?(a[i]=a[i]||o.create(_.extend({},{options:c,id:i})),a[i]):n}}}},function(e,t,i){"use strict";var n=i(0),a="default",s={BO_SB:"small",BO_PB:"priority",BO_HB:"10kg",NA:"NA"},r=function(e){return s[e]},o=function(e){return r(e.selectedType)},c=function(e){n.trackEvent(e.action,l(e))},d=function(e,t,i){return _.get(t,["collection",e,"available"])?i:"0"},l=function(e){var t=[e.preffix,":",_.get(e,"data.totalNumber"),"-",_.get(e,"data.carrier",""),":",_.get(e,"data.carrierNumber")];return _.isEmpty(e.suffix)||t.push(e.suffix),t.join("")};e.exports={setPopupMode:function(e){a=e},getPopupMode:function(){return a},getTypeTrackingConstant:r,getSelectedTypeTrackingConstant:o,trackBoardingOptionAllSections:function(e){c({action:"on_load_widgets",preffix:["ryanair_widget_appearances-",o(e),"_legs"].join(""),data:e})},trackBoardingOptionCarrierSections:function(e){c({action:"on_load_widgets",preffix:"ryanair_widget_appearances-none_legs",data:e})},trackBoardingOptionAttention:function(e){e.priorityOptionsEnabledForAllSections&&"BO_SB"===e.selectedType&&c({action:"on_load_message",preffix:"ryanair_message_appearances_legs",data:e})},trackBoardingOptionsOpenButton:function(e){c({action:"ryanair_widget",preffix:["ryanair_widget_open-",o(e),"_legs"].join(""),data:e})},trackingBoardingOptionsShowPopup:function(e){c({action:"ryanair_"+a,preffix:["ryanair_",a,"_appearances-",o(e),"_legs"].join(""),data:e,suffix:["_prod:",d("BO_SB",e,"S"),"-",d("BO_SB",e,"P"),"-",d("BO_HB",e,"C")].join("")})},trackingBoardingOptionsPopupButton:function(e){c({action:"ryanair_"+a,preffix:["ryanair_",a,"_select-",r(e.selected),"_legs"].join(""),data:e})},trackingBoardingOptionsPopupClose:function(e){c({action:"ryanair_"+a,preffix:["ryanair_",a,"_close-",o(e),"_legs"].join(""),data:e})},trackingBoardingOptionsContinue:function(e){0<_.get(e,"carrierNumber",0)&&c({action:"ryanair_bag",preffix:["ryanair_bag-",a,"_selected-",o(e),"_legs"].join(""),data:e,suffix:["_pag:",e.page].join("")})},trackOnPaxLoad:function(){var e=Odigeo.Utils.parseJson(Odigeo.Session.get("bookedFlights")),t=e.length,i=_.filter(e,function(e){return"FR"===e.carriercode||"OE"}),n=_.size(i),a={totalNumber:t,carrier:""+(2===t?e[0].carriercode+"-"+e[1].carriercode:e[0].carriercode),carrierNumber:""+n};c({action:"on_load_widgets",preffix:["ryanair_widget","_appearances","-none_legs"].join(""),data:a})}}},,function(e,t,i){"use strict";e.exports={BAGGAGES:"BAGGAGES",BAGGAGES_WEIGHT:"BAGGAGES_WEIGHT",SERVICE_OPTIONS:"SERVICE_OPTIONS",ADULTS:"ADULTS",CHILDREN:"CHILDREN",INFANTS:"INFANTS",INSURANCE:"INSURANCE",INSURANCE_IN_CART:"INSURANCE_IN_CART",REBOOKING_INSURANCE:"REBOOKING_INSURANCE",CANX_INSURANCE:"CANX_INSURANCE",ASSISTANCE_INSURANCE:"ASSISTANCE_INSURANCE",ADDITION:"ADDITION",SERVICE_FEE:"SERVICE_FEE",CC_FEE:"CC_FEE",DISCOUNT_FEE:"DISCOUNT_FEE",SEAT:"SEAT",SEATMAP:"SEATMAP",PROMO_CODE:"PROMO_CODE",MEMBERSHIP_SUBSCRIPTION:"MEMBERSHIP_SUBSCRIPTION",REPRICING:"REPRICING",HAND_BAGGAGE:"HAND_BAGGAGE"}},function(e,t,i){"use strict";(function(t){!t.version||0===t.version.indexOf("v0.")||0===t.version.indexOf("v1.")&&0!==t.version.indexOf("v1.8.")?e.exports={nextTick:function(e,i,n,a){if("function"!=typeof e)throw new TypeError('"callback" argument must be a function');var s,r,o=arguments.length;switch(o){case 0:case 1:return t.nextTick(e);case 2:return t.nextTick(function(){e.call(null,i)});case 3:return t.nextTick(function(){e.call(null,i,n)});case 4:return t.nextTick(function(){e.call(null,i,n,a)});default:for(s=new Array(o-1),r=0;r<s.length;)s[r++]=arguments[r];return t.nextTick(function(){e.apply(null,s)})}}}:e.exports=t}).call(this,i(16))},function(e,t,i){var n=i(2).Buffer;function a(e){n.isBuffer(e)||(e=n.from(e));for(var t=e.length/4|0,i=new Array(t),a=0;a<t;a++)i[a]=e.readUInt32BE(4*a);return i}function s(e){for(;0<e.length;e++)e[0]=0}function r(e,t,i,n,a){for(var s,r,o,c,d=i[0],l=i[1],g=i[2],h=i[3],u=e[0]^t[0],p=e[1]^t[1],f=e[2]^t[2],m=e[3]^t[3],_=4,b=1;b<a;b++)s=d[u>>>24]^l[p>>>16&255]^g[f>>>8&255]^h[255&m]^t[_++],r=d[p>>>24]^l[f>>>16&255]^g[m>>>8&255]^h[255&u]^t[_++],o=d[f>>>24]^l[m>>>16&255]^g[u>>>8&255]^h[255&p]^t[_++],c=d[m>>>24]^l[u>>>16&255]^g[p>>>8&255]^h[255&f]^t[_++],u=s,p=r,f=o,m=c;return s=(n[u>>>24]<<24|n[p>>>16&255]<<16|n[f>>>8&255]<<8|n[255&m])^t[_++],r=(n[p>>>24]<<24|n[f>>>16&255]<<16|n[m>>>8&255]<<8|n[255&u])^t[_++],o=(n[f>>>24]<<24|n[m>>>16&255]<<16|n[u>>>8&255]<<8|n[255&p])^t[_++],c=(n[m>>>24]<<24|n[u>>>16&255]<<16|n[p>>>8&255]<<8|n[255&f])^t[_++],[s>>>=0,r>>>=0,o>>>=0,c>>>=0]}var o=[0,1,2,4,8,16,32,64,128,27,54],c=function(){for(var e=new Array(256),t=0;t<256;t++)e[t]=t<128?t<<1:t<<1^283;for(var i=[],n=[],a=[[],[],[],[]],s=[[],[],[],[]],r=0,o=0,c=0;c<256;++c){var d=o^o<<1^o<<2^o<<3^o<<4;d=d>>>8^255&d^99;var l=e[n[i[r]=d]=r],g=e[l],h=e[g],u=257*e[d]^16843008*d;a[0][r]=u<<24|u>>>8,a[1][r]=u<<16|u>>>16,a[2][r]=u<<8|u>>>24,a[3][r]=u,u=16843009*h^65537*g^257*l^16843008*r,s[0][d]=u<<24|u>>>8,s[1][d]=u<<16|u>>>16,s[2][d]=u<<8|u>>>24,s[3][d]=u,0===r?r=o=1:(r=l^e[e[e[h^l]]],o^=e[e[o]])}return{SBOX:i,INV_SBOX:n,SUB_MIX:a,INV_SUB_MIX:s}}();function d(e){this._key=a(e),this._reset()}d.blockSize=16,d.keySize=32,d.prototype.blockSize=d.blockSize,d.prototype.keySize=d.keySize,d.prototype._reset=function(){for(var e=this._key,t=e.length,i=t+6,n=4*(i+1),a=[],s=0;s<t;s++)a[s]=e[s];for(s=t;s<n;s++){var r=a[s-1];s%t==0?(r=r<<8|r>>>24,r=c.SBOX[r>>>24]<<24|c.SBOX[r>>>16&255]<<16|c.SBOX[r>>>8&255]<<8|c.SBOX[255&r],r^=o[s/t|0]<<24):6<t&&s%t==4&&(r=c.SBOX[r>>>24]<<24|c.SBOX[r>>>16&255]<<16|c.SBOX[r>>>8&255]<<8|c.SBOX[255&r]),a[s]=a[s-t]^r}for(var d=[],l=0;l<n;l++){var g=n-l,h=a[g-(l%4?0:4)];d[l]=l<4||g<=4?h:c.INV_SUB_MIX[0][c.SBOX[h>>>24]]^c.INV_SUB_MIX[1][c.SBOX[h>>>16&255]]^c.INV_SUB_MIX[2][c.SBOX[h>>>8&255]]^c.INV_SUB_MIX[3][c.SBOX[255&h]]}this._nRounds=i,this._keySchedule=a,this._invKeySchedule=d},d.prototype.encryptBlockRaw=function(e){return r(e=a(e),this._keySchedule,c.SUB_MIX,c.SBOX,this._nRounds)},d.prototype.encryptBlock=function(e){var t=this.encryptBlockRaw(e),i=n.allocUnsafe(16);return i.writeUInt32BE(t[0],0),i.writeUInt32BE(t[1],4),i.writeUInt32BE(t[2],8),i.writeUInt32BE(t[3],12),i},d.prototype.decryptBlock=function(e){var t=(e=a(e))[1];e[1]=e[3],e[3]=t;var i=r(e,this._invKeySchedule,c.INV_SUB_MIX,c.INV_SBOX,this._nRounds),s=n.allocUnsafe(16);return s.writeUInt32BE(i[0],0),s.writeUInt32BE(i[3],4),s.writeUInt32BE(i[2],8),s.writeUInt32BE(i[1],12),s},d.prototype.scrub=function(){s(this._keySchedule),s(this._invKeySchedule),s(this._key)},e.exports.AES=d},function(e,t,i){var n=i(2).Buffer,a=i(63);e.exports=function(e,t,i,s){if(n.isBuffer(e)||(e=n.from(e,"binary")),t&&(n.isBuffer(t)||(t=n.from(t,"binary")),8!==t.length))throw new RangeError("salt should be Buffer with 8 byte length");for(var r=i/8,o=n.alloc(r),c=n.alloc(s||0),d=n.alloc(0);0<r||0<s;){var l=new a;l.update(d),l.update(e),t&&l.update(t),d=l.digest();var g=0;if(0<r){var h=o.length-r;g=Math.min(r,d.length),d.copy(o,h,0,g),r-=g}if(g<d.length&&0<s){var u=c.length-s,p=Math.min(s,d.length-g);d.copy(c,u,g,g+p),s-=p}}return d.fill(0),{key:o,iv:c}}},function(e,t,i){"use strict";var n=t;n.base=i(262),n.short=i(263),n.mont=i(264),n.edwards=i(265)},function(e,t,i){(function(t){var n=i(281),a=i(293),s=i(294),r=i(72),o=i(114);(e.exports=function(e){var i;"object"!=typeof e||t.isBuffer(e)||(i=e.passphrase,e=e.key),"string"==typeof e&&(e=new t(e));var c,d,l,g,h,u,p,f,m,_,b,y,v,S=s(e,i),C=S.tag,w=S.data;switch(C){case"CERTIFICATE":d=n.certificate.decode(w,"der").tbsCertificate.subjectPublicKeyInfo;case"PUBLIC KEY":switch(d||(d=n.PublicKey.decode(w,"der")),c=d.algorithm.algorithm.join(".")){case"1.2.840.113549.1.1.1":return n.RSAPublicKey.decode(d.subjectPublicKey.data,"der");case"1.2.840.10045.2.1":return d.subjectPrivateKey=d.subjectPublicKey,{type:"ec",data:d};case"1.2.840.10040.4.1":return d.algorithm.params.pub_key=n.DSAparam.decode(d.subjectPublicKey.data,"der"),{type:"dsa",data:d.algorithm.params};default:throw new Error("unknown key id "+c)}throw new Error("unknown key type "+C);case"ENCRYPTED PRIVATE KEY":g=i,h=(l=w=n.EncryptedPrivateKey.decode(w,"der")).algorithm.decrypt.kde.kdeparams.salt,u=parseInt(l.algorithm.decrypt.kde.kdeparams.iters.toString(),10),p=a[l.algorithm.decrypt.cipher.algo.join(".")],f=l.algorithm.decrypt.cipher.iv,m=l.subjectPrivateKey,_=parseInt(p.split("-")[1],10)/8,b=o.pbkdf2Sync(g,h,u,_),y=r.createDecipheriv(p,b,f),(v=[]).push(y.update(m)),v.push(y.final()),w=t.concat(v);case"PRIVATE KEY":switch(c=(d=n.PrivateKey.decode(w,"der")).algorithm.algorithm.join(".")){case"1.2.840.113549.1.1.1":return n.RSAPrivateKey.decode(d.subjectPrivateKey,"der");case"1.2.840.10045.2.1":return{curve:d.algorithm.curve,privateKey:n.ECPrivateKey.decode(d.subjectPrivateKey,"der").privateKey};case"1.2.840.10040.4.1":return d.algorithm.params.priv_key=n.DSAparam.decode(d.subjectPrivateKey,"der"),{type:"dsa",params:d.algorithm.params};default:throw new Error("unknown key id "+c)}throw new Error("unknown key type "+C);case"RSA PUBLIC KEY":return n.RSAPublicKey.decode(w,"der");case"RSA PRIVATE KEY":return n.RSAPrivateKey.decode(w,"der");case"DSA PRIVATE KEY":return{type:"dsa",params:n.DSAPrivateKey.decode(w,"der")};case"EC PRIVATE KEY":return{curve:(w=n.ECPrivateKey.decode(w,"der")).parameters.value,privateKey:w.privateKey};default:throw new Error("unknown key type "+C)}}).signature=n.signature}).call(this,i(3).Buffer)},function(e,t,i){var n=i(3),a=n.Buffer;function s(e,t){for(var i in e)t[i]=e[i]}function r(e,t,i){return a(e,t,i)}a.from&&a.alloc&&a.allocUnsafe&&a.allocUnsafeSlow?e.exports=n:(s(n,t),t.Buffer=r),s(a,r),r.from=function(e,t,i){if("number"==typeof e)throw new TypeError("Argument must not be a number");return a(e,t,i)},r.alloc=function(e,t,i){if("number"!=typeof e)throw new TypeError("Argument must be a number");var n=a(e);return void 0!==t?"string"==typeof i?n.fill(t,i):n.fill(t):n.fill(0),n},r.allocUnsafe=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return a(e)},r.allocUnsafeSlow=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return n.SlowBuffer(e)}},function(e,t,i){"use strict";function n(e){Odigeo.requireWidget("users-manager","usersmanager",function(t){t.execute("submitUserRequest",e)})}function a(e){return n(_.extend({data:"",action:"logOut"},e))}e.exports={submitUserRequest:n,membershipRefreshPage:function(e){var t;return _.contains(["home","flights","","/","results","details"],Odigeo.History.getPageNameFromFragment())?window.location.reload(!0):(t=e,Odigeo.trigger("membership:refreshWidgets",t),void Odigeo.trigger("membership:refreshSubscription",t))},logoutUser:_.partial(a,""),logoutMemberUser:_.partial(a,{isMemberAction:!0}),isUserDTOMember:function(e){return!!(e&&e.membershipInfoDTO&&e.membershipInfoDTO.membershipDTO)},getMobilePbJspParams:function(e,t,i){return{isMemberBetweenTravellers:e,isPrimeBlocked:i,comingPage:t}},getMembershipPbItem:function(e){return{type:"membershipsubscription",data:{allprice:e.allPrice||0,concept:e.conceptLabel,conceptKey:e.conceptKey,oneprice:e.onePrice||0,quantity:e.quantity}}},openLoginForm:function(e,t,i){_.result(i,"stopPropagation"),e.trackEvent("sso_pax_page","go_to_login"),t.get("login").execute("openModalLogin")}}},function(e,t,i){"use strict";var n=function(e){return e instanceof $?e:$(e)},a=function(e){return e.parents().closest(".validation_field")},s=function(e,t,i){var s=n(e),r=s.val(),o=a(s),c=o.attr("data-state"),d="valid";return!i&&_.isEmpty(r)?d="init"===c&&t?"init":"empty":new RegExp(s.data("pattern")).test(r)||(d="invalid"),o.attr("data-state",d),d},r=function(e,t){var i=n(e),a=0<_.size(i.find("input"))?i.find("input"):i.find("select").first(),s=i.find(".wrong_label"),r=t?_.isEmpty(a.val())&&!_.isEmpty(a.data("mandatory"))&&_.isEmpty(a.data("requiredoptional")):"empty"===i.attr("data-state");s.text(a.data(r?"mandatory":"error"))},o=function(e,t){return new RegExp(t).test(e)},c=function(e,t){var i=a(e);i.toggleClass("focused",t),t&&i.attr("data-state","focused")},d={REGEX_VALIDATOR:o,SECOND_EMAIL_VALIDATOR:o,NULL_VALIDATOR:function(e){return!!e},OPTIONAL:function(){return!0}};e.exports={setState:s,setStateAndShowError:function(e,t,i){var a=n(e),o=s(a,t,i);-1<_.indexOf(["empty","invalid"],o)&&r(a.parents().closest(".validation_field"))},showError:r,showHidePlaceholder:function(e,t){var i=n(e),a=0===i.siblings(".bottom_placeholder").length?i.parent().siblings(".bottom_placeholder"):i.siblings(".bottom_placeholder");0<a.length&&a.toggleClass("showed",t)},validateField:function(e){var t=e.data("validationType"),i=e.val(),n=e.data("pattern");return d[t]?d[t](i,n):!!i},setDataStateAndShowLabel:function(e,t,i){var s=n(e),r=a(s).find(".wrong_label");a(s).attr("data-state",t),r.text(i)},scrollToFirstError:function(e){Odigeo.Utils.scrollToElement(e.find(".validation_field").filter('.empty, .invalid, [data-state="empty"], [data-state="invalid"]').eq(0))},setFocus:function(e){c(n(e),!0)},removeFocus:function(e){c(n(e),!1)},clearField:function(e){var t=$(e.target).closest(".validation_field").find("input");return t.val(""),t.focus(),t},trimCreditCardNumber:function(e){return e.replace(/[\/\s-]/g,"")},removeRegexStartAndEndCharacters:function(e){return new RegExp(_.trim(e,"$^"),"g")},giveWrongCharacters:function(e){var t,i;if("REGEX_VALIDATOR"===e.data("validationType"))if(i=(t=e.val()).match(this.removeRegexStartAndEndCharacters(e.data("pattern"))),_.startsWith(e.data("name"),"phoneNumber")){var n=t.match(/[^0-9]/gi);t=i?n.join(""):"length_"+t.length}else _.each(i,function(e){t=t.replace(e,"")});return t}}},function(e,t,i){"use strict";var n=i(100).getInstance(),a=i(15);e.exports=new a({bindPriceCollection:function(){this.listenTo(n,"priceCollection.change",_.bind(this.trigger,this,"priceCollection.repaintPrices"))},getPriceCollectionData:function(){return n.getJSONData()},getUnformattedFinalPrice:function(){return n.calculateTotalPrice()},getFinalPrice:function(){return Odigeo.Utils.formatCurrency(n.calculateTotalPrice())},getPricePerPassenger:function(){return Odigeo.Utils.formatCurrency(n.calculatePricePerPassenger())},getUnformattedTicketPrice:function(){return n.getTotalTicketPrice()},getTicketPrice:function(){return Odigeo.Utils.formatCurrency(this.getUnformattedTicketPrice())},getTicketPricePerPassenger:function(){return Odigeo.Utils.formatCurrency(n.getTotalTicketPricePerPax())},getItemByType:function(e){return n.getPriceBreakdownItemByType(e)},getPriceBreakdownItemByConceptKey:function(e){return n.getPriceBreakdownItemByConceptKey(e)},getSHPrice:function(){return n.getSHPrice()},getPayWithGuaranteeItemInCollection:function(){return n.getPayWithGuaranteeItemInCollection()}})},,,function(e,t,i){"use strict";var n=i(0),a={error_management_sessionExpired:{load:{action:"back_end_errors",label:"session_expiring_expired",optimize:!0},click:{action:"back_end_errors",label:"session_expiring_new_search"},clickSameSearch:{action:"back_end_errors",label:"session_expiring_same_search"},clickDialogPhone:{action:"back_end_errors",label:"session_expiring_call_us"}},error_management_packageNotAvailable:{load:{action:_.template("results_list_<%= obj %>"),label:_.template("shared_dynpack_no_results_found_<%= obj %>")},click:{action:_.template("results_list_<%= obj %>"),label:_.template("undo_shared_dynpack_no_results_found_<%= obj %>")},clickSameSearch:{action:_.template("results_list_<%= obj %>"),label:_.template("relaunch_shared_dynpack_no_results_found_<%= obj %>")}},error_management_noResults:{load:{action:_.template("results_list_<%= obj %>"),label:_.template("searching_dynpack_no_results_found_<%= obj %>")},click:{action:_.template("results_list_<%= obj %>"),label:_.template("undo_searching_dynpack_no_results_found_<%= obj %>")}},compressed_header:{click:{action:"searcher_dynpack",label:"click_change_search"}},roomselection:{onLoadRoomList:{action:"rooms_list",label:s},onLoadRoomCards:{action:"room_selection_list",label:s},onSelectRoom:{action:"room_selection_list",label:_.template("room_selected_<%= obj %>")}},stepper:{click:{action:"header",label:_.template("click_<%= obj %>")}},filter_flights:{click:{action:"results_filters",label:"open_filters_float"}},filter_hotels:{click:{action:"results_filters_hotels",label:"open_filters"}},most_popular:{click:{action:"results_list_hotels",label:"sort_open"}},map:{click:{action:"results_list_hotels",label:"map_open_all_hotels"}},modify_links:{click:{action:"trip_information",label:_.template("<%= obj %>")}},dp_price_summary:{click:{action:"discount",label:"click_flighthotel_discount_price-summary"}},accommodation_menu_bar:{click:{action:"rooms_menu",label:_.template("menu_option_<%= obj %>")}}};function s(e){var t=_.size(e.listRoomDeals),i=_.size(e.reductionRoomDeals);return["room_showed","reduc:"+(Number(!_.isEqual(t,i))?"yes":"no"),"num:"+t+"-"+i].join("_")}e.exports=function(e){var t=a[e];function i(e,i,a){var s,r,o,c=(s=i,r=a,o=t[e],{action:_.isFunction(o.action)?o.action(r):o.action,label:_.isFunction(o.label)?o.label(s):o.label,optimize:o.optimize});n.trackEvent(c.action,c.label,null,c.optimize)}return _.mapValues(t,function(e,t){return _.partial(i,t)})}},function(e,t,i){"use strict";var n=i(93),a=i(10),s=function(){return{loginError:Odigeo.UserArea.loginError,firstLogin:Odigeo.UserArea.firstLogin,lastLoginEmailUsed:Odigeo.UserArea.loginName}};e.exports=a({modelClass:i(315),viewClass:i(316),options:{"login-header":s(),"my-trips-login-form":_.extend(s(),{noModalDialogs:!0}),"login-expired-login-form":{noModalDialogs:!0}},methods:{loginOk:function(e){this.loginOk(e)},loginEmailOnTopOk:function(e){this._anyLoginOk(e,"email_on_top_login",!0)},loginWithFacebookOk:function(e){this.loginWithFacebookOk(e)},loginWithGoogleOk:function(e){this.loginWithGoogleOk(e)},successfullLogin:function(e){this.successfullLogin(e)},isLoggedInOk:function(e,t){this.isLoggedInOk(e,t)},isLoggedInWithError:function(){this._logoutActions()},openModalLogin:function(){this.openModalLogin()},openModalLogout:function(e){this.openModalLogout(e)},closeConnectorsLayer:function(){this.closeConnectorsLayer()},recoverPasswordOk:function(){this.recoverPasswordOk()},recoverPasswordWithError:function(e){this.recoverPasswordError(e)},loginWithError:function(e){this.loginWithError(e)},loginWithFacebookWithError:function(e){this.loginWithError(_.defaults(e,{messageError:n.socialLoginType.facebook}))},loginWithGoogleWithError:function(e){this.loginWithError(_.defaults(e,{messageError:n.socialLoginType.google}))},logOutOk:function(){n.logoutSocialAccount(),this._logoutActions()},isUserLogged:function(){Odigeo.trigger(this.id+":userIsLogged",this.model.logged)},goToMyTrips:function(){this.goToMyTrips()},fromDeepLinkToDetails:function(e){this.fromDeepLinkToDetails(e)},setLogged:function(){this.model.logged=!0},hideShowRegisterFooterLink:function(e){this.hideShowRegisterFooterLink(e)},initEmbedView:function(e){this.initEmbedView(e)},checkMembershipFastMenu:function(e){this.checkMembershipFastMenu(e)},launchPriceMemberDisplay:function(){var e=this.model.isMembership&&this.model.logged?"login":"logout";Odigeo.trigger("membership:priceMemberDisplay",e)},displayLoginOk:function(e){this.displayLoginOk(e)},isMember:function(){return this.model.isMembership},renderCaptcha:function(e){this.renderCaptcha(e)},performUserRequestIfLogged:function(e,t){this.performUserRequestIfLogged(e,t)}}})},,function(e,t,i){"use strict";var n,a=i(37).getInstance(),s=Odigeo.Collection.extend({model:i(186),includedPieces:0,selectedPieces:0,allPiecesBySegment:{},selectedTotalPrice:0,selectedTotalPricePlusDiscount:0,discountFigure:null,discountPercentage:null,totalDiscount:0,selectedInCartTotalPrice:0,allowAutoselection:null,allowSmartNag:null,allowRowsAutoselection:null,defaultOption:{price:0},BAGGAGE_TYPE:{notAllowed:"NOT_ALLOWED",included:"INCLUDED",includedSelectable:"INCLUDED_SELECTABLE",selectable:"SELECTABLE"},CONST:{BAGS_PROPENSITY_THRESHOLD:.3,DISCOUNT_ROUND_UP:5,NUM_SELECTED_BAGS:"numSelected_bags"},initialize:function(){this.listenTo(this,"change",this.notifySelectionToHandler)},fillData:function(e,t){!_.isNaN(t.idPassenger)&&this.isOptionIdCorrect(t.idRow)&&_.each(e,function(e){this.add(_.extend(e,{idPassenger:t.idPassenger,idRow:t.idRow,isIncludedBaggage:t.isIncludedBaggage,isSelectableBaggage:t.isSelectableBaggage}))},this)},clearCollection:function(){this.selectedTotalPrice=0,this.selectedTotalPricePlusDiscount=0,this.totalDiscount=0,this.selectedPieces=0,this.includedPieces=0,this.allPiecesBySegment={},this.selectedInCartTotalPrice=0,this.remove(this.models)},getDiscount:function(){return this.calculateDiscount(this.selectedTotalPrice)},calculateDiscount:function(e){var t=a.getBaggageBundleDiscountPercentage(),i=0;return 0<t&&(i=e-t/100*e),i},getDiscountedPart:function(){var e=a.getBaggageBundleDiscountPercentage(),t=this.selectedTotalPrice,i=0;return 0<e&&(i=e/100*t*(this.getFullSelection().length/this.selectedPieces)),i},getOption:function(e){return e=_.isUndefined(e)?{}:e,this.findWhere(e)},getOptions:function(e){return e=_.isUndefined(e)?{}:e,this.where(e)},getRowSelection:function(e,t){return this.getOption({idPassenger:e,idRow:t,selected:!0})},getRowIncluded:function(e,t){return this.getOption({idPassenger:e,idRow:t,isIncludedBaggage:!0})},getRowIncludedForAnyPassenger:function(e){return this.getOption({idRow:e,isIncludedBaggage:!0})},getPassengerSelection:function(e){return this.getOptions({idPassenger:e,selected:!0})},getPassengerBaggageSelectedPieces:function(e){return _.reduce(this.getOptions({idPassenger:e,selected:!0}),function(e,t){return e+t.get("pieces")},0)},getFullSelection:function(){return this.getOptions({selected:!0})},getIncludedPieces:function(){return this.includedPieces},getSelectedPieces:function(){return this.selectedPieces},areAllPassengersWithBaggage:function(){return _.every(this.getFullSelection(),function(e){return 0<e.get("pieces")})},getAllPieces:function(){return this.includedPieces+this.selectedPieces},getAllPiecesBySegment:function(){return this.allPiecesBySegment},selectDefaultOption:function(e,t){var i=this.getDefaultOption(e,t);this.updateOption(i.cid)},getDefaultOption:function(e,t){return this.getOption(_.extend({},this.defaultOption,{idPassenger:e,idRow:t}))},executeBeforeUpdateHook:function(e,t,i){return!_.isFunction(e)||e(t,i)},executeAfterUpdateHook:function(e,t,i){_.isFunction(e)&&e(t,i)},updateTotalInCartFromTotalPrice:function(e){0<a.getBaggageBundleDiscountPercentage()&&e&&Odigeo.AB.isBaggageDiscountEnabled?this.selectedInCartTotalPrice=this.calculateDiscount(this.selectedTotalPrice):this.selectedInCartTotalPrice=this.selectedTotalPrice},updateOption:function(e,t,i){var n=this.get(e),a=this.getCurrentSelectedOption(e),s=_.isUndefined(a),r=!s&&a.cid!==n.cid;s?this.updateOptionSelectedState(n,!0):r&&this.executeBeforeUpdateHook(t,a,n)&&(this.updateOptionSelectedState(a,!1),this.updateOptionSelectedState(n,!0),this.executeAfterUpdateHook(i,a,n))},getCurrentSelectedOption:function(e){var t=this.get(e);return this.getRowSelection(t.get("idPassenger"),t.get("idRow"))},updateOptionSelectedState:function(e,t){_.isUndefined(e)||(this.updateSelectedTotalsInfo(e,t),e.set("selected",t))},updateSelectedTotalsInfo:function(e,t){var i=e.get("piecesToShow"),n=e.get("price");e.get("isSelectableBaggage")&&(t?this.addPiecesToSegment(e):(i=-i,n=-n,this.removePiecesBySegment(e)),this.selectedPieces=this.selectedPieces+i,Odigeo.Session.set(this.CONST.NUM_SELECTED_BAGS,this.selectedPieces),this.selectedTotalPrice=this.setTotalPrice(t,n,i))},setTotalPrice:function(e,t,i){var n=0!==i?t:this.selectedTotalPrice;return 1<Odigeo.AB.promotionMerchandisingBadgePartition&&this.shouldDisplayPromotionBadge()?(this.discountPercentage=this.getDiscountPercentage(),0!==t&&(n=this.selectedTotalPrice+t,0<=i&&(this.totalDiscount=n*this.discountPercentage/100),e?this.selectedTotalPricePlusDiscount=this.selectedTotalPrice+t+this.totalDiscount:(this.selectedTotalPricePlusDiscount=this.selectedTotalPricePlusDiscount-this.totalDiscount,this.totalDiscount=n*this.discountPercentage/100,this.selectedTotalPricePlusDiscount=this.selectedTotalPricePlusDiscount+this.totalDiscount+t,n=(this.totalDiscount=0)===this.selectedPieces?0:n)),n):this.selectedTotalPrice+t},getPassengerSelectableRows:function(e){return a.getPassengerSelectableRows(e)},getBaggagePropensity:function(){var e=_.first(this.getPassengerSelectableRows(0));return _.isEmpty(e)?null:e.get("baggagePropensity")},shouldDisplayPromotionBadge:function(){var e=this.getBaggagePropensity();return _.isNumber(e)&&e<this.CONST.BAGS_PROPENSITY_THRESHOLD},removePiecesBySegment:function(e){var t=e.get("idRow"),i=e.cid;_.isObject(this.allPiecesBySegment[t])&&_.isObject(this.allPiecesBySegment[t][i])&&delete this.allPiecesBySegment[t][i]},calculateIncludedPieces:function(){var e,t=this.getOptions({isIncludedBaggage:!0});this.includedPieces=0,_.each(t,function(t){e=t.get("pieces"),this.includedPieces+=e,this.addPiecesToSegment(t)},this)},addPiecesToSegment:function(e){var t=e.get("idRow"),i=e.cid;_.isUndefined(this.allPiecesBySegment[t])&&(this.allPiecesBySegment[t]={}),this.allPiecesBySegment[t][i]=e},isOptionIdCorrect:function(e){return _.isString(e)&&0<e.length},hasSecondLegSameCombinations:function(){var e=this.getOptions({idRow:"FIRST"});return _.every(e,function(e){var t=_.extend({idRow:"SECOND"},_.pick(e.getAll(),"pieces","kilos"));return!_.isUndefined(this.getOption(t))},this)},hasSecondLegSameCombinationsWithoutWeight:function(){var e,t;return!!this.hasSecondLegSameCombinations()||(e=this.getOptions({idRow:"FIRST"}),t=this.getOptions({idRow:"SECOND"}),this.checkIfLegContainNonRepeatedCaseNumbers(e)&&this.checkIfLegContainNonRepeatedCaseNumbers(t)&&this.isFirstSegmentOptionsASubsetOfSecondSegment(e))},isFirstSegmentOptionsASubsetOfSecondSegment:function(e){return _.every(e,function(e){var t=_.extend({idRow:"SECOND"},_.pick(e.getAll(),"pieces"));return!_.isUndefined(this.getOption(t))},this)},checkIfLegContainNonRepeatedCaseNumbers:function(e){return e.length===_.uniq(e,function(e){return e.get("pieces")+"--"+e.get("idPassenger")}).length},doOptionsAllowAutoselection:function(){return _.isNull(this.allowAutoselection)&&(this.allowAutoselection=this.hasSecondLegSameCombinationsWithoutWeight()),this.allowAutoselection},doOptionsAllowSmartNag:function(){return _.isNull(this.allowSmartNag)&&(this.allowSmartNag=Odigeo.AB.isBaggageGroupedBySegment?this.doRowsAllowAutoselection():this.hasSecondLegSameCombinationsWithoutWeight()),this.allowSmartNag},doRowsAllowAutoselection:function(){return this.allowRowsAutoselection},setAllowRowsAutoselection:function(e){this.allowRowsAutoselection=e},getDiscountPercentage:function(){var e,t,i=_.isNull(this.discountFigure)?0:this.discountFigure,n=this.getOptions({idPassenger:0,isSelectableBaggage:!0,piecesToShow:1});n=_.filter(n,function(e){return 0<e.get("price")});var a=_.sortBy(n,["price"]);return _.isUndefined(a[0])||(t=a[0].get("price"),e=_.ceil(i/(t+i)*100),e=_.ceil(e/this.CONST.DISCOUNT_ROUND_UP)*this.CONST.DISCOUNT_ROUND_UP),e},setDiscountFigure:function(e){this.discountFigure=e}});e.exports.getInstance=function(){return _.isUndefined(n)&&(n=new s),n}},function(e,t,i){"use strict";function n(e){if(Array.isArray(e)){for(var t=0,i=Array(e.length);t<e.length;t++)i[t]=e[t];return i}return Array.from(e)}var a=void 0,s=i(188),r=i(41),o=Odigeo.Model.extend({dataUrl:"getboardingoptions",loaded:!1,loading:!1,interacted:!1,selectedByUser:!1,defaultType:"BO_SB",emptyType:"NA",load:function(e){this.isABEnabled()&&e.load&&this.populate()},url:function(){return Odigeo.Settings.getProperty("serviceUrlFormatter")(this.dataUrl)},populate:function(){this.loaded||this.loading||this.fetch(this.getDataRequestSettings())},getDataRequestSettings:function(){return{type:"GET",cache:!(this.loading=!0),dataType:"json",contentType:"application/json",success:_.bind(this.requestSuccessHandler,this)}},requestSuccessHandler:function(){this.loading=!1,this.loaded=!0,this.processData(),r.trackBoardingOptionCarrierSections(this.getTrackData()),this.triggerBoardingOptionsLoaded()},triggerBoardingOptionsLoaded:function(){this.isPriorityOptionsEnabled()&&Odigeo.trigger("boarding-options:boardingOptionsLoaded",_.extend(this.toJSON(),{trackingData:this.getTrackData()}))},setData:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return this.set(e),this.processData(),this.triggerBoardingOptionsLoaded(),this},getDesktopAB:function(){return _.get(Odigeo,"AB.getBoardingOptionsWidget",1)},getMobileAB:function(){return _.get(Odigeo,"AB.boardingOptionsMobile",1)},isABEnabled:function(){return"mobile"===Odigeo.SessionScope.flow?this.getMobileAB():_.includes([2,3],this.getDesktopAB())},isLoaded:function(){return this.loaded},processData:function(){this.set({selectedType:this.isPriorityOptionsEnabled()?this.getSelectedType()||this.defaultType:this.emptyType,defaultType:this.defaultType,fee:this.getFee(),trackingData:this.getTrackData(),carrierSettings:_.get(s.get(),this.getCarrier().toLowerCase())})},isPriorityOptionsEnabled:function(){return this.isABEnabled()&&this.hasPriorityOptionsEnabledForAllSections()&&this.isProviderCompatible()&&this.isCarrierCompatible()},isProviderCompatible:function(){var e=this.getDesktopAB();return"mobile"===Odigeo.SessionScope.flow?this.getMobileAB():3===e||2===e&&this.isTravelfusionFlight()},isCarrierCompatible:function(){return!_.isEmpty(this.getCarrierSettings())},isTravelfusionFlight:function(){return!_.get(this.getFlightDetailsDTO(),"amadeusFlight",!0)},isPriorityOptionsActive:function(){return this.isPriorityOptionsEnabled()&&0<_.get(this.get("descriptors"),"length",0)},hasPriorityOptionsEnabledForAllSections:function(){return this.get("priorityBoardingInAllSections")},getSelectedType:function(){return this.isPriorityOptionsEnabled()?this.isPriorityOptionsActive()?this.getSelectedTypeFromSelection():this.defaultType:this.emptyType},getSelectedTypeFromSelection:function(){return this.getUserSelectionType()||_.get(this.get("selection"),"[0].type",this.defaultType)},getFee:function(){var e=this.get("selection")||[],t=_.reduce(e,function(e,t){return e+Math.abs(t.totalPrice-t.providerPrice)},0);return 0<e.length?t/e.length:0},setInteraction:function(){this.interacted=!0},setSelectedByUser:function(){this.selectedByUser=!0},select:function(e){this.set("clientSelection",e),Odigeo.trigger("getTotalByFullprice",this)},getUserSelectionType:function(){return _.get(this.get("clientSelection"),"selectedType")},hasUserAddedAnything:function(){return this.getSelectedType()!==this.defaultType},hasUserInteracted:function(){return this.interacted},isSelectedByUser:function(){return this.selectedByUser},mustShowNag:function(){return this.isPriorityOptionsActive()&&!this.hasUserInteracted()&&!this.hasUserAddedAnything()&&"mobile"!==Odigeo.SessionScope.flow},getCompleteUserSelectionData:function(){return this.hasUserAddedAnything()?this.getCompoundSelection(this.getUserSelectionType()||this.defaultType):[]},getCompoundSelection:function(e){var t=this;return _.reduce(this.get("descriptors"),function(i,a){return[].concat(n(i),n(t.getPaxSelection(a,t.getRawType(a,e))))},[])},getPaxSelection:function(e,t){return this.getTravellers().map(function(i){return{section:e.section,numPassenger:i,type:t}})},getRawType:function(e,t){return _.get(this.getDescriptorByType(e,t),"rawType")},getDescriptorByType:function(e,t){return _.get(e,"boardingOptions",[]).find(function(e){return e.type===t})},getTrackData:function(){var e=this.getCarrier().replace(/\./g,"-");return{carrier:this.getDefaultIfEmpty(e,"FR"),totalNumber:this.getAllSections().length,carrierNumber:this.getCarrierSectionNumber(this.getDefaultIfEmpty(this.getCarrierList(),["FR"])),selectedType:this.isPriorityOptionsEnabled()?this.getSelectedType()||this.defaultType:this.emptyType,priorityOptionsEnabledForAllSections:this.hasPriorityOptionsEnabledForAllSections(),collection:this.get("collection")}},getDefaultIfEmpty:function(e,t){return _.isEmpty(e)?t:e},getCarrier:function(){return this.get("carrierCode")||""},getCarrierList:function(){return this.get("carriers")||[]},getAllSections:function(){return _.get(this.getFlightDetailsDTO(),"allSections",[])},getFlightDetailsDTO:function(){return this.get("flightDetailsDTO")},getCarrierSectionNumber:function(e){return _.reduce(this.getAllSections(),function(t,i){return t+(_.includes(e,_.get(i,"carrier.code",""))?1:0)},0,this)},getCarrierSections:function(){var e=this.getAllSections(),t=this.getCarrierSectionIds();return e.length===t.length?"ALL":t.join("-")},getCarrierSectionIds:function(){return _.map(this.getCarrierToTrackSections(),function(e){return parseInt(e.id,10)+1})},getCarrierToTrackSections:function(){var e=this.getCarrierList();return _.filter(this.getAllSections(),function(t){return _.includes(e,_.get(t,"carrier.code",""))},0,this)},getTravellers:function(){return this.get("travellers")||[]},getNumTravellers:function(){return this.getTravellers().length||0},getUnitPrice:function(){return _.get(this.get("collection"),[this.getSelectedType(),"totalPrice"],0)},getSelectionPrice:function(){return this.getNumTravellers()*this.getCarrierSectionNumber(this.getCarrierList())*this.getUnitPrice()},getCarrierSettings:function(){return this.get("carrierSettings")}});e.exports.getInstance=function(e){return _.isUndefined(a)&&(a=new o),a.load(e||{}),a}},function(e,t,i){"use strict";var n=i(15),a=i(102),s=i(0),r=function(e){return"AIRPORT"===e.type?e.iata:e.cityIataCode},o=function(e){return"AIRPORT"===e.type?e.city+" - "+e.airport:e.city},c=function(e){return{date:Odigeo.Utils.addDays(e.date,1),iata:e.iata,rentalCarsDepartureIata:e.rentalCarsArrivalIata,rentalCarsDepartureName:e.rentalCarsArrivalName,cityName:e.cityName}},d=function(e){var t,i,n,a,s,d,l,g,h,u,m,b,y,v,S,C,w,O,T,P,E=e.myTrip.itineraries[0].segments,k=E.length,A=e.myTrip.travellers,D=1===k?"one_way":"return"===(t=e.tripCategory)?"round_trip":t,I="one_way"===D,x=(s=(a=(i=E)[0].sections[i[0].sections.length-1]).arrivalDate,d=r(i[0].arrivalLocation),l=r(i[0].departureLocation),g=o(i[0].arrivalLocation),h=a.arrivalLocation.city,u=a.arrivalLocation.country,m="AIRPORT"===(n=i[0].arrivalLocation).type?n.geoNodeId:n.cityGeoNodeId,{date:s,iata:d,iataAirport:i[0].arrivalLocation.iata,departureIata:l,departureIataAirport:i[0].departureLocation.iata,rentalCarsArrivalIata:a.arrivalLocation.iata,rentalCarsArrivalName:g,cityName:h,geoNodeId:m,countryName:u,arrivalCountryCode:a.arrivalLocation.countryCode,departureCountryCode:a.departureLocation.countryCode}),B=I?c(x):(y=(b=E[1].sections[0]).departureDate,v=r(b.departureLocation),S=o(b.departureLocation),C=b.departureLocation.city,{date:y,iata:v,rentalCarsDepartureIata:b.departureLocation.iata,rentalCarsDepartureName:S,cityName:C}),R=p(e),M=(w=e.passengers,O=0,_.forEach(w,function(e){return O+=function(e){var t=0,i=e.baggageSelectionDTOs.filter(function(e){return"FIRST"===e.segmentTypeIndexDTO})[0];return _.forEach(i.selectedBaggageDescriptor,function(e){t+=e.baggageDescriptor.pieces}),t+=i.baggageDescriptorIncludedInPrice.pieces}(e)}),O);return{pickup:x,returnData:B,passengers:A,nPassengers:A.length,tripType:D,isOneWay:I,additionalInfo:{pnr:(T=e,P=_.get(T,"myTrip.itineraries[0].reference","").split(" ")[0],""===P&&(P=Odigeo.Utils.isRequestApp("dp")?_.get(Odigeo.Utils.parseJson(Odigeo.Storage.get("lastSearchDynpack")),"externalSelectionRequest.segmentKeys[0]","").split(",")[1]:_.get(Odigeo.Utils.parseJson(Odigeo.Session.get("flightSelectionData")),"flightNumbers[0]","").split(",")[1]),P),flightCategory:R,cabinClass:f(),buyerCountryCode:_.get(e,"myTrip.buyer.country"),totalBaggage:M}}},l=function(e){var t=Odigeo.Utils.formatDate,i=Odigeo.Utils.formatDate.masks.isoDate;return t(e.departureDate,i)+"-"+t(e.returnDate,i)+"-"+e.nPassengers+"-"+e.departureIata+"-"+t(new Date,i)},g=function(e,t){return a.createHmac("sha256",t).update(e).digest("hex")},h=function(e){var t=Date.now()-e,i=new Date(t);return Math.abs(i.getUTCFullYear()-1970)},u=function(e){var t,i,n=_.groupBy(e,"ageType");return{numAdults:_.size(n.ADULT),numChildren:_.size(n.CHILD),numInfants:_.size(n.INFANT),childrenAges:(t=n,i=_.pluck(_.union(t.CHILD,t.INFANT),"birthDate"),_.map(i,h))}},p=function(e){var t,i="general";return t=e,_.some(t.myTrip.travellers,function(e){return"ADULT"!==e.ageType})?i="family":e.tripType&&"round_trip"===e.tripType.toLocaleLowerCase()&&Odigeo.Utils.getDifferenceInDays(e.pickup.date,e.returnData.date)<=1&&(i="business"),i},f=function(){return _.get(Odigeo.Utils.parseJson(Odigeo.Session.get("searchParameters")),"cabinClass","")},m=function(e,t,i){var n,a,s=Odigeo.UIElements.translations.expediaHotels.key,r=i?u(t.passengers):(n=t.passengers,a=_.groupBy(n,"travellerType"),{numAdults:_.size(a.ADULT),numChildren:_.size(a.CHILDREN),numInfants:_.size(a.INFANT)}),o={departureDate:t.pickup.date,returnDate:t.returnData.date,nPassengers:t.nPassengers,departureIata:t.pickup.departureIataAirport},c=l(o);return{checkin:e(t.pickup.date,"yyyy-mm-dd",!0),checkin_monthday:e(t.pickup.date,"dd",!0),checkin_year_month:e(t.pickup.date,"yyyy-mm",!0),checkout:e(t.returnData.date,"yyyy-mm-dd",!0),checkout_monthday:e(t.returnData.date,"dd",!0),checkout_year_month:e(t.returnData.date,"yyyy-mm",!0),purchaseDate:e(new Date,e.masks.isoDate),passengers:r,nPassengers:t.nPassengers,roomParams:App.Flights.getRoomsParams(r),currency:Odigeo.Utils.Currency.currencyCode,token:_.isEmpty(s)?"":g(c,s),pickupIata:t.pickup.iataAirport,departureIata:t.pickup.departureIataAirport,earlyFlightHotelData:b(t,r)}},b=function(e,t){var i=Odigeo.Utils.formatDate,n=new Date(e.pickup.date);n.setDate(n.getDate()-1);var a=new Date(e.pickup.date),s={};if(Odigeo.AB.isExpediaLinksAndWidget){var r=Odigeo.UIElements.translations.expediaHotels.key,o={departureDate:n,returnDate:a,nPassengers:e.nPassengers,departureIata:e.pickup.departureIataAirport},c=l(o);s={checkin:i(n,"yyyy-mm-dd",!0),checkout:i(a,"yyyy-mm-dd",!0),roomParams:App.Flights.getRoomsParams(t),token:_.isEmpty(r)?"":g(c,r)}}else s={checkin_monthday:Odigeo.Utils.formatDate(n,"dd",!0),checkin_year_month:Odigeo.Utils.formatDate(n,"yyyy-mm",!0),checkout_monthday:Odigeo.Utils.formatDate(a,"dd",!0),checkout_year_month:Odigeo.Utils.formatDate(a,"yyyy-mm",!0)};return s},y=function(e,t){var i,n,a,s,r,o,c,d,l=Odigeo.Utils;return{departureIata:e.pickup.departureIata,departureIataAirport:e.pickup.departureIataAirport,pickupIata:e.pickup.iata,pickupIataAirport:e.pickup.iataAirport,rentalCarsPickupIata:e.pickup.rentalCarsArrivalIata,rentalCarsPickupName:e.pickup.rentalCarsArrivalName,returnIata:e.returnData.iata,rentalCarsDropoffIata:e.returnData.rentalCarsDepartureIata,rentalCarsDropoffName:e.returnData.rentalCarsDepartureName,nPassengers:e.nPassengers,additionalInfo:e.additionalInfo,pnr:e.pnr,geoNodeId:e.pickup.geoNodeId,cityName:e.pickup.cityName,countryName:e.pickup.countryName,buyerCountryCode:e.buyerCountryCode||e.additionalInfo.buyerCountryCode,isOneWay:e.isOneWay?1:0,gt:(r=l,o=e,c=r.roundDateMinutesToQuarterHours(o.pickup.date),d=r.roundDateMinutesToQuarterHours(o.returnData.date),c=r.addMins(c,30),d=o.isOneWay?r.addHours(d,1):r.addHours(d,-2),{cityName:o.pickup.cityName,tripType:o.tripType,nPassengers:o.nPassengers,pickupDatetime:r.formatDate(c,"mm/dd/yyyy HH:MM",!0),returnDatetime:r.formatDate(d,"mm/dd/yyyy HH:MM",!0),tripDays:r.getDifferenceInDays(o.pickup.date,o.returnData.date)}),cars:(i=e,n=(new Date).getTime(),a=i.nPassengers,s=_.get(i,"passengers[0].birthDate",0),{pickupDate:_.get(i,"pickup.date",n),returnDate:_.get(i,"returnData.date",n),nPassengers:a,driverAge:0!==s?Odigeo.Utils.getAge(s):25,arrivalCountryCode:i.pickup.arrivalCountryCode,departureCountryCode:i.pickup.departureCountryCode,numBaggages:i.additionalInfo.totalBaggage}),hotel:m(l.formatDate,e,t)}};e.exports=new n({getMyTripsXsellingData:function(e){var t=function(e){var t,i,n,a,s,o,d,l,g,h,u,p,f,m=e.itineraryBookings.bookingItinerary,b=Odigeo.Utils.getRemainingMinutes(m.departureDate)<0,y=e.itineraryBookings.itinerarySegments,v=y.length,S=e.travellers,C=1===v?"one_way":m.tripType.toLowerCase(),w="one_way"===C,O=(i=b,n=(t=y)[0].sections[t[0].sections.length-1].section,a=i?Odigeo.Utils.addMins(Odigeo.Utils.getTodayExactTimeLocal(),60):n.arrivalDate,s=r(n.to),o=r(n.from),d=n.to.cityName,{date:a,iata:s,iataAirport:n.to.iataCode,departureIata:o,departureIataAirport:n.from.iataCode,rentalCarsArrivalIata:n.to.iataCode,cityName:d,geoNodeId:n.to.geoNodeId}),T=w?c(O):(g=(l=y[1].sections[0].section).departureDate,h=r(l.from),u=l.from.cityName,{date:g,iata:h,rentalCarsDepartureIata:l.from.iataCode,cityName:u}),P=e.buyer.country;return{pickup:O,returnData:T,passengers:S,nPassengers:S.length,tripType:C,isOneWay:w,additionalInfo:(p=e,f={},_.each(p.itineraryBookings.itinerarySegments,function(e){_.each(e.sections,function(e){_.isEmpty(e.section.pnr)||(f.pnr=e.section.pnr,f.cabinClass=e.section.cabinClass)})}),f),buyerCountryCode:P}}(e);return y(t,!1)},getConfirmationXsellingData:function(e){var t="";return null!==e.myTrip&&(t=y(d(e),!0)),t},prepareAndReplaceCmsKey:function(e,t){return e.unshift(t.url),Odigeo.Utils.replaceCmsKeyArgs.apply(this,e)},getHotelsData:function(e){var t=e.hotel;return{bannerSuffix:"hotels",urlArgs:[e.pickupIata,t.checkin_monthday,t.checkin_year_month,t.checkout_monthday,t.checkout_year_month]}},renderXsellWidget:function(e,t,i){$(i).append(e(t))},getWidgetUrl:function(e,t,i){var n=Odigeo.UIElements.translations[i];return this.prepareAndReplaceCmsKey(e,n[t])},getExpediaToken:function(e,t){return g(e,t)},openXsellLink:function(e){var t=$(e.currentTarget).data(),i=_.get(this,"widget.view.trackingCategory",null);_.isEmpty(t.label)||(_.isEmpty(i)?s.trackEvent(_.isEmpty(t.action)?"xsell_widget":t.action,t.label):s.trackEventWithCategory(i,_.isEmpty(t.action)?"xsell_widget":t.action,t.label)),s.openExternalLink(t.ref)}})},function(e,t,i){"use strict";e.exports={parseSetMethodArgs:function(e){var t={},i=e[0],n={};return _.isString(i)?(t[i]=e[1],n=e[2]):_.isObject(i)&&(t=_.isPlainObject(i)?i:i.attributes,n=e[1]),[t,n]}}},,function(e,t,i){"use strict";var n=i(1),a=i(104),s=i(227).Buffer,r=new Array(16);function o(){a.call(this,64),this._a=1732584193,this._b=4023233417,this._c=2562383102,this._d=271733878}function c(e,t){return e<<t|e>>>32-t}function d(e,t,i,n,a,s,r){return c(e+(t&i|~t&n)+a+s|0,r)+t|0}function l(e,t,i,n,a,s,r){return c(e+(t&n|i&~n)+a+s|0,r)+t|0}function g(e,t,i,n,a,s,r){return c(e+(t^i^n)+a+s|0,r)+t|0}function h(e,t,i,n,a,s,r){return c(e+(i^(t|~n))+a+s|0,r)+t|0}n(o,a),o.prototype._update=function(){for(var e=r,t=0;t<16;++t)e[t]=this._block.readInt32LE(4*t);var i=this._a,n=this._b,a=this._c,s=this._d;n=h(n=h(n=h(n=h(n=g(n=g(n=g(n=g(n=l(n=l(n=l(n=l(n=d(n=d(n=d(n=d(n,a=d(a,s=d(s,i=d(i,n,a,s,e[0],3614090360,7),n,a,e[1],3905402710,12),i,n,e[2],606105819,17),s,i,e[3],3250441966,22),a=d(a,s=d(s,i=d(i,n,a,s,e[4],4118548399,7),n,a,e[5],1200080426,12),i,n,e[6],2821735955,17),s,i,e[7],4249261313,22),a=d(a,s=d(s,i=d(i,n,a,s,e[8],1770035416,7),n,a,e[9],2336552879,12),i,n,e[10],4294925233,17),s,i,e[11],2304563134,22),a=d(a,s=d(s,i=d(i,n,a,s,e[12],1804603682,7),n,a,e[13],4254626195,12),i,n,e[14],2792965006,17),s,i,e[15],1236535329,22),a=l(a,s=l(s,i=l(i,n,a,s,e[1],4129170786,5),n,a,e[6],3225465664,9),i,n,e[11],643717713,14),s,i,e[0],3921069994,20),a=l(a,s=l(s,i=l(i,n,a,s,e[5],3593408605,5),n,a,e[10],38016083,9),i,n,e[15],3634488961,14),s,i,e[4],3889429448,20),a=l(a,s=l(s,i=l(i,n,a,s,e[9],568446438,5),n,a,e[14],3275163606,9),i,n,e[3],4107603335,14),s,i,e[8],1163531501,20),a=l(a,s=l(s,i=l(i,n,a,s,e[13],2850285829,5),n,a,e[2],4243563512,9),i,n,e[7],1735328473,14),s,i,e[12],2368359562,20),a=g(a,s=g(s,i=g(i,n,a,s,e[5],4294588738,4),n,a,e[8],2272392833,11),i,n,e[11],1839030562,16),s,i,e[14],4259657740,23),a=g(a,s=g(s,i=g(i,n,a,s,e[1],2763975236,4),n,a,e[4],1272893353,11),i,n,e[7],4139469664,16),s,i,e[10],3200236656,23),a=g(a,s=g(s,i=g(i,n,a,s,e[13],681279174,4),n,a,e[0],3936430074,11),i,n,e[3],3572445317,16),s,i,e[6],76029189,23),a=g(a,s=g(s,i=g(i,n,a,s,e[9],3654602809,4),n,a,e[12],3873151461,11),i,n,e[15],530742520,16),s,i,e[2],3299628645,23),a=h(a,s=h(s,i=h(i,n,a,s,e[0],4096336452,6),n,a,e[7],1126891415,10),i,n,e[14],2878612391,15),s,i,e[5],4237533241,21),a=h(a,s=h(s,i=h(i,n,a,s,e[12],1700485571,6),n,a,e[3],2399980690,10),i,n,e[10],4293915773,15),s,i,e[1],2240044497,21),a=h(a,s=h(s,i=h(i,n,a,s,e[8],1873313359,6),n,a,e[15],4264355552,10),i,n,e[6],2734768916,15),s,i,e[13],1309151649,21),a=h(a,s=h(s,i=h(i,n,a,s,e[4],4149444226,6),n,a,e[11],3174756917,10),i,n,e[2],718787259,15),s,i,e[9],3951481745,21),this._a=this._a+i|0,this._b=this._b+n|0,this._c=this._c+a|0,this._d=this._d+s|0},o.prototype._digest=function(){this._block[this._blockOffset++]=128,56<this._blockOffset&&(this._block.fill(0,this._blockOffset,64),this._update(),this._blockOffset=0),this._block.fill(0,this._blockOffset,56),this._block.writeUInt32LE(this._length[0],56),this._block.writeUInt32LE(this._length[1],60),this._update();var e=s.allocUnsafe(16);return e.writeInt32LE(this._a,0),e.writeInt32LE(this._b,4),e.writeInt32LE(this._c,8),e.writeInt32LE(this._d,12),e},e.exports=o},function(e,t,i){e.exports=a;var n=i(65).EventEmitter;function a(){n.call(this)}i(1)(a,n),a.Readable=i(66),a.Writable=i(223),a.Duplex=i(224),a.Transform=i(225),a.PassThrough=i(226),(a.Stream=a).prototype.pipe=function(e,t){var i=this;function a(t){e.writable&&!1===e.write(t)&&i.pause&&i.pause()}function s(){i.readable&&i.resume&&i.resume()}i.on("data",a),e.on("drain",s),e._isStdio||t&&!1===t.end||(i.on("end",o),i.on("close",c));var r=!1;function o(){r||(r=!0,e.end())}function c(){r||(r=!0,"function"==typeof e.destroy&&e.destroy())}function d(e){if(l(),0===n.listenerCount(this,"error"))throw e}function l(){i.removeListener("data",a),e.removeListener("drain",s),i.removeListener("end",o),i.removeListener("close",c),i.removeListener("error",d),e.removeListener("error",d),i.removeListener("end",l),i.removeListener("close",l),e.removeListener("close",l)}return i.on("error",d),e.on("error",d),i.on("end",l),i.on("close",l),e.on("close",l),e.emit("pipe",i),e}},function(e,t){function i(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function n(e){return"function"==typeof e}function a(e){return"object"==typeof e&&null!==e}function s(e){return void 0===e}((e.exports=i).EventEmitter=i).prototype._events=void 0,i.prototype._maxListeners=void 0,i.defaultMaxListeners=10,i.prototype.setMaxListeners=function(e){if("number"!=typeof e||e<0||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},i.prototype.emit=function(e){var t,i,r,o,c,d;if(this._events||(this._events={}),"error"===e&&(!this._events.error||a(this._events.error)&&!this._events.error.length)){if((t=arguments[1])instanceof Error)throw t;var l=new Error('Uncaught, unspecified "error" event. ('+t+")");throw l.context=t,l}if(s(i=this._events[e]))return!1;if(n(i))switch(arguments.length){case 1:i.call(this);break;case 2:i.call(this,arguments[1]);break;case 3:i.call(this,arguments[1],arguments[2]);break;default:o=Array.prototype.slice.call(arguments,1),i.apply(this,o)}else if(a(i))for(o=Array.prototype.slice.call(arguments,1),r=(d=i.slice()).length,c=0;c<r;c++)d[c].apply(this,o);return!0},i.prototype.on=i.prototype.addListener=function(e,t){var r;if(!n(t))throw TypeError("listener must be a function");return this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,n(t.listener)?t.listener:t),this._events[e]?a(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,a(this._events[e])&&!this._events[e].warned&&(r=s(this._maxListeners)?i.defaultMaxListeners:this._maxListeners)&&0<r&&this._events[e].length>r&&(this._events[e].warned=!0,console.trace),this},i.prototype.once=function(e,t){if(!n(t))throw TypeError("listener must be a function");var i=!1;function a(){this.removeListener(e,a),i||(i=!0,t.apply(this,arguments))}return a.listener=t,this.on(e,a),this},i.prototype.removeListener=function(e,t){var i,s,r,o;if(!n(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(r=(i=this._events[e]).length,s=-1,i===t||n(i.listener)&&i.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(a(i)){for(o=r;0<o--;)if(i[o]===t||i[o].listener&&i[o].listener===t){s=o;break}if(s<0)return this;1===i.length?(i.length=0,delete this._events[e]):i.splice(s,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},i.prototype.removeAllListeners=function(e){var t,i;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(n(i=this._events[e]))this.removeListener(e,i);else if(i)for(;i.length;)this.removeListener(e,i[i.length-1]);return delete this._events[e],this},i.prototype.listeners=function(e){return this._events&&this._events[e]?n(this._events[e])?[this._events[e]]:this._events[e].slice():[]},i.prototype.listenerCount=function(e){if(this._events){var t=this._events[e];if(n(t))return 1;if(t)return t.length}return 0},i.listenerCount=function(e,t){return e.listenerCount(t)}},function(e,t,i){(((t=e.exports=i(105)).Stream=t).Readable=t).Writable=i(67),t.Duplex=i(19),t.Transform=i(108),t.PassThrough=i(222)},function(e,t,i){"use strict";(function(t,n,a){var s=i(44);function r(e){var t=this;this.next=null,this.entry=null,this.finish=function(){!function(e,t,i){var n=e.entry;for(e.entry=null;n;){var a=n.callback;t.pendingcb--,a(void 0),n=n.next}t.corkedRequestsFree?t.corkedRequestsFree.next=e:t.corkedRequestsFree=e}(t,e)}}e.exports=b;var o,c=!t.browser&&-1<["v0.10","v0.9."].indexOf(t.version.slice(0,5))?n:s.nextTick;b.WritableState=_;var d=i(30);d.inherits=i(1);var l,g={deprecate:i(221)},h=i(106),u=i(2).Buffer,p=a.Uint8Array||function(){},f=i(107);function m(){}function _(e,t){o=o||i(19),e=e||{};var n=t instanceof o;this.objectMode=!!e.objectMode,n&&(this.objectMode=this.objectMode||!!e.writableObjectMode);var a=e.highWaterMark,d=e.writableHighWaterMark,l=this.objectMode?16:16384;this.highWaterMark=a||0===a?a:n&&(d||0===d)?d:l,this.highWaterMark=Math.floor(this.highWaterMark),this.finalCalled=!1,this.needDrain=!1,this.ending=!1,this.ended=!1,this.finished=!1;var g=(this.destroyed=!1)===e.decodeStrings;this.decodeStrings=!g,this.defaultEncoding=e.defaultEncoding||"utf8",this.length=0,this.writing=!1,this.corked=0,this.sync=!0,this.bufferProcessing=!1,this.onwrite=function(e){!function(e,t){var i,n,a,r,o,d,l=e._writableState,g=l.sync,h=l.writecb;if((d=l).writing=!1,d.writecb=null,d.length-=d.writelen,d.writelen=0,t)i=e,a=g,r=t,o=h,--(n=l).pendingcb,a?(s.nextTick(o,r),s.nextTick(O,i,n),i._writableState.errorEmitted=!0,i.emit("error",r)):(o(r),i._writableState.errorEmitted=!0,i.emit("error",r),O(i,n));else{var u=C(l);u||l.corked||l.bufferProcessing||!l.bufferedRequest||S(e,l),g?c(v,e,l,u,h):v(e,l,u,h)}}(t,e)},this.writecb=null,this.writelen=0,this.bufferedRequest=null,this.lastBufferedRequest=null,this.pendingcb=0,this.prefinished=!1,this.errorEmitted=!1,this.bufferedRequestCount=0,this.corkedRequestsFree=new r(this)}function b(e){if(o=o||i(19),!(l.call(b,this)||this instanceof o))return new b(e);this._writableState=new _(e,this),this.writable=!0,e&&("function"==typeof e.write&&(this._write=e.write),"function"==typeof e.writev&&(this._writev=e.writev),"function"==typeof e.destroy&&(this._destroy=e.destroy),"function"==typeof e.final&&(this._final=e.final)),h.call(this)}function y(e,t,i,n,a,s,r){t.writelen=n,t.writecb=r,t.writing=!0,t.sync=!0,i?e._writev(a,t.onwrite):e._write(a,s,t.onwrite),t.sync=!1}function v(e,t,i,n){var a,s;i||(a=e,0===(s=t).length&&s.needDrain&&(s.needDrain=!1,a.emit("drain"))),t.pendingcb--,n(),O(e,t)}function S(e,t){t.bufferProcessing=!0;var i=t.bufferedRequest;if(e._writev&&i&&i.next){var n=t.bufferedRequestCount,a=new Array(n),s=t.corkedRequestsFree;s.entry=i;for(var o=0,c=!0;i;)(a[o]=i).isBuf||(c=!1),i=i.next,o+=1;a.allBuffers=c,y(e,t,!0,t.length,a,"",s.finish),t.pendingcb++,t.lastBufferedRequest=null,s.next?(t.corkedRequestsFree=s.next,s.next=null):t.corkedRequestsFree=new r(t),t.bufferedRequestCount=0}else{for(;i;){var d=i.chunk,l=i.encoding,g=i.callback;if(y(e,t,!1,t.objectMode?1:d.length,d,l,g),i=i.next,t.bufferedRequestCount--,t.writing)break}null===i&&(t.lastBufferedRequest=null)}t.bufferedRequest=i,t.bufferProcessing=!1}function C(e){return e.ending&&0===e.length&&null===e.bufferedRequest&&!e.finished&&!e.writing}function w(e,t){e._final(function(i){t.pendingcb--,i&&e.emit("error",i),t.prefinished=!0,e.emit("prefinish"),O(e,t)})}function O(e,t){var i,n,a=C(t);return a&&(i=e,(n=t).prefinished||n.finalCalled||("function"==typeof i._final?(n.pendingcb++,n.finalCalled=!0,s.nextTick(w,i,n)):(n.prefinished=!0,i.emit("prefinish"))),0===t.pendingcb&&(t.finished=!0,e.emit("finish"))),a}d.inherits(b,h),_.prototype.getBuffer=function(){for(var e=this.bufferedRequest,t=[];e;)t.push(e),e=e.next;return t},function(){try{Object.defineProperty(_.prototype,"buffer",{get:g.deprecate(function(){return this.getBuffer()},"_writableState.buffer is deprecated. Use _writableState.getBuffer instead.","DEP0003")})}catch(e){}}(),"function"==typeof Symbol&&Symbol.hasInstance&&"function"==typeof Function.prototype[Symbol.hasInstance]?(l=Function.prototype[Symbol.hasInstance],Object.defineProperty(b,Symbol.hasInstance,{value:function(e){return!!l.call(this,e)||this===b&&e&&e._writableState instanceof _}})):l=function(e){return e instanceof this},b.prototype.pipe=function(){this.emit("error",new Error("Cannot pipe, not readable"))},b.prototype.write=function(e,t,i){var n,a,r,o,c,d,l,g,h,f=this._writableState,_=!1,b=!f.objectMode&&(n=e,u.isBuffer(n)||n instanceof p);return b&&!u.isBuffer(e)&&(a=e,e=u.from(a)),"function"==typeof t&&(i=t,t=null),b?t="buffer":t||(t=f.defaultEncoding),"function"!=typeof i&&(i=m),f.ended?(this,g=i,h=new Error("write after end"),this.emit("error",h),s.nextTick(g,h)):(b||(this,r=f,c=i,l=!(d=!0),null===(o=e)?l=new TypeError("May not write null values to stream"):"string"==typeof o||void 0===o||r.objectMode||(l=new TypeError("Invalid non-string/buffer chunk")),l&&(this.emit("error",l),s.nextTick(c,l),d=!1),d))&&(f.pendingcb++,_=function(e,t,i,n,a,s){if(!i){var r=function(e,t,i){return e.objectMode||!1===e.decodeStrings||"string"!=typeof t||(t=u.from(t,i)),t}(t,n,a);n!==r&&(i=!0,a="buffer",n=r)}var o=t.objectMode?1:n.length;t.length+=o;var c=t.length<t.highWaterMark;if(c||(t.needDrain=!0),t.writing||t.corked){var d=t.lastBufferedRequest;t.lastBufferedRequest={chunk:n,encoding:a,isBuf:i,callback:s,next:null},d?d.next=t.lastBufferedRequest:t.bufferedRequest=t.lastBufferedRequest,t.bufferedRequestCount+=1}else y(e,t,!1,o,n,a,s);return c}(this,f,b,e,t,i)),_},b.prototype.cork=function(){this._writableState.corked++},b.prototype.uncork=function(){var e=this._writableState;e.corked&&(e.corked--,e.writing||e.corked||e.finished||e.bufferProcessing||!e.bufferedRequest||S(this,e))},b.prototype.setDefaultEncoding=function(e){if("string"==typeof e&&(e=e.toLowerCase()),!(-1<["hex","utf8","utf-8","ascii","binary","base64","ucs2","ucs-2","utf16le","utf-16le","raw"].indexOf((e+"").toLowerCase())))throw new TypeError("Unknown encoding: "+e);return this._writableState.defaultEncoding=e,this},b.prototype._write=function(e,t,i){i(new Error("_write() is not implemented"))},b.prototype._writev=null,b.prototype.end=function(e,t,i){var n=this._writableState;"function"==typeof e?(i=e,t=e=null):"function"==typeof t&&(i=t,t=null),null!=e&&this.write(e,t),n.corked&&(n.corked=1,this.uncork()),n.ending||n.finished||function(e,t,i){t.ending=!0,O(e,t),i&&(t.finished?s.nextTick(i):e.once("finish",i)),t.ended=!0,e.writable=!1}(this,n,i)},Object.defineProperty(b.prototype,"destroyed",{get:function(){return void 0!==this._writableState&&this._writableState.destroyed},set:function(e){this._writableState&&(this._writableState.destroyed=e)}}),b.prototype.destroy=f.destroy,b.prototype._undestroy=f.undestroy,b.prototype._destroy=function(e,t){this.end(),t(e)}}).call(this,i(16),i(219).setImmediate,i(12))},function(e,t,i){"use strict";var n=i(2).Buffer,a=n.isEncoding||function(e){switch((e=""+e)&&e.toLowerCase()){case"hex":case"utf8":case"utf-8":case"ascii":case"binary":case"base64":case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":case"raw":return!0;default:return!1}};function s(e){var t;switch(this.encoding=function(e){var t=function(e){if(!e)return"utf8";for(var t;;)switch(e){case"utf8":case"utf-8":return"utf8";case"ucs2":case"ucs-2":case"utf16le":case"utf-16le":return"utf16le";case"latin1":case"binary":return"latin1";case"base64":case"ascii":case"hex":return e;default:if(t)return;e=(""+e).toLowerCase(),t=!0}}(e);if("string"!=typeof t&&(n.isEncoding===a||!a(e)))throw new Error("Unknown encoding: "+e);return t||e}(e),this.encoding){case"utf16le":this.text=c,this.end=d,t=4;break;case"utf8":this.fillLast=o,t=4;break;case"base64":this.text=l,this.end=g,t=3;break;default:return this.write=h,void(this.end=u)}this.lastNeed=0,this.lastTotal=0,this.lastChar=n.allocUnsafe(t)}function r(e){return e<=127?0:e>>5==6?2:e>>4==14?3:e>>3==30?4:-1}function o(e){var t=this.lastTotal-this.lastNeed,i=function(e,t,i){if(128!=(192&t[0]))return e.lastNeed=0,"�".repeat(i);if(1<e.lastNeed&&1<t.length){if(128!=(192&t[1]))return e.lastNeed=1,"�".repeat(i+1);if(2<e.lastNeed&&2<t.length&&128!=(192&t[2]))return e.lastNeed=2,"�".repeat(i+2)}}(this,e,t);return void 0!==i?i:this.lastNeed<=e.length?(e.copy(this.lastChar,t,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal)):(e.copy(this.lastChar,t,0,e.length),void(this.lastNeed-=e.length))}function c(e,t){if((e.length-t)%2!=0)return this.lastNeed=1,this.lastTotal=2,this.lastChar[0]=e[e.length-1],e.toString("utf16le",t,e.length-1);var i=e.toString("utf16le",t);if(i){var n=i.charCodeAt(i.length-1);if(55296<=n&&n<=56319)return this.lastNeed=2,this.lastTotal=4,this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1],i.slice(0,-1)}return i}function d(e){var t=e&&e.length?this.write(e):"";if(this.lastNeed){var i=this.lastTotal-this.lastNeed;return t+this.lastChar.toString("utf16le",0,i)}return t}function l(e,t){var i=(e.length-t)%3;return 0===i?e.toString("base64",t):(this.lastNeed=3-i,this.lastTotal=3,1===i?this.lastChar[0]=e[e.length-1]:(this.lastChar[0]=e[e.length-2],this.lastChar[1]=e[e.length-1]),e.toString("base64",t,e.length-i))}function g(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+this.lastChar.toString("base64",0,3-this.lastNeed):t}function h(e){return e.toString(this.encoding)}function u(e){return e&&e.length?this.write(e):""}(t.StringDecoder=s).prototype.write=function(e){if(0===e.length)return"";var t,i;if(this.lastNeed){if(void 0===(t=this.fillLast(e)))return"";i=this.lastNeed,this.lastNeed=0}else i=0;return i<e.length?t?t+this.text(e,i):this.text(e,i):t||""},s.prototype.end=function(e){var t=e&&e.length?this.write(e):"";return this.lastNeed?t+"�".repeat(this.lastTotal-this.lastNeed):t},s.prototype.text=function(e,t){var i=function(e,t,i){var n=t.length-1;if(n<i)return 0;var a=r(t[n]);return 0<=a?(0<a&&(e.lastNeed=a-1),a):--n<i?0:0<=(a=r(t[n]))?(0<a&&(e.lastNeed=a-2),a):--n<i?0:0<=(a=r(t[n]))?(0<a&&(2===a?a=0:e.lastNeed=a-3),a):0}(this,e,t);if(!this.lastNeed)return e.toString("utf8",t);this.lastTotal=i;var n=e.length-(i-this.lastNeed);return e.copy(this.lastChar,0,n),e.toString("utf8",t,n)},s.prototype.fillLast=function(e){if(this.lastNeed<=e.length)return e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,this.lastNeed),this.lastChar.toString(this.encoding,0,this.lastTotal);e.copy(this.lastChar,this.lastTotal-this.lastNeed,0,e.length),this.lastNeed-=e.length}},function(e,t,i){"use strict";var n=i(3).Buffer,a=i(1),s=i(104),r=new Array(16),o=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8,3,10,14,4,9,15,8,1,2,7,0,6,13,11,5,12,1,9,11,10,0,8,12,4,13,3,7,15,14,5,6,2,4,0,5,9,7,12,2,10,14,1,3,8,11,6,15,13],c=[5,14,7,0,9,2,11,4,13,6,15,8,1,10,3,12,6,11,3,7,0,13,5,10,14,15,8,12,4,9,1,2,15,5,1,3,7,14,6,9,11,8,12,2,10,0,4,13,8,6,4,1,3,11,15,0,5,12,2,13,9,7,10,14,12,15,10,4,1,5,8,7,6,2,13,14,0,3,9,11],d=[11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8,7,6,8,13,11,9,7,15,7,12,15,9,11,7,13,12,11,13,6,7,14,9,13,15,14,8,13,6,5,12,7,5,11,12,14,15,14,15,9,8,9,14,5,6,8,6,5,12,9,15,5,11,6,8,13,12,5,12,13,14,11,8,5,6],l=[8,9,9,11,13,15,15,5,7,7,8,11,14,14,12,6,9,13,15,7,12,8,9,11,7,7,12,7,6,15,13,11,9,7,15,11,8,6,6,14,12,13,5,14,13,13,7,5,15,5,8,11,14,14,6,14,6,9,12,9,12,5,15,8,8,5,12,9,12,5,14,6,8,13,6,5,15,13,11,11],g=[0,1518500249,1859775393,2400959708,2840853838],h=[1352829926,1548603684,1836072691,2053994217,0];function u(){s.call(this,64),this._a=1732584193,this._b=4023233417,this._c=2562383102,this._d=271733878,this._e=3285377520}function p(e,t){return e<<t|e>>>32-t}function f(e,t,i,n,a,s,r,o){return p(e+(t^i^n)+s+r|0,o)+a|0}function m(e,t,i,n,a,s,r,o){return p(e+(t&i|~t&n)+s+r|0,o)+a|0}function _(e,t,i,n,a,s,r,o){return p(e+((t|~i)^n)+s+r|0,o)+a|0}function b(e,t,i,n,a,s,r,o){return p(e+(t&n|i&~n)+s+r|0,o)+a|0}function y(e,t,i,n,a,s,r,o){return p(e+(t^(i|~n))+s+r|0,o)+a|0}a(u,s),u.prototype._update=function(){for(var e=r,t=0;t<16;++t)e[t]=this._block.readInt32LE(4*t);for(var i=0|this._a,n=0|this._b,a=0|this._c,s=0|this._d,u=0|this._e,v=0|this._a,S=0|this._b,C=0|this._c,w=0|this._d,O=0|this._e,T=0;T<80;T+=1){var P,E;E=T<16?(P=f(i,n,a,s,u,e[o[T]],g[0],d[T]),y(v,S,C,w,O,e[c[T]],h[0],l[T])):T<32?(P=m(i,n,a,s,u,e[o[T]],g[1],d[T]),b(v,S,C,w,O,e[c[T]],h[1],l[T])):T<48?(P=_(i,n,a,s,u,e[o[T]],g[2],d[T]),_(v,S,C,w,O,e[c[T]],h[2],l[T])):T<64?(P=b(i,n,a,s,u,e[o[T]],g[3],d[T]),m(v,S,C,w,O,e[c[T]],h[3],l[T])):(P=y(i,n,a,s,u,e[o[T]],g[4],d[T]),f(v,S,C,w,O,e[c[T]],h[4],l[T])),i=u,u=s,s=p(a,10),a=n,n=P,v=O,O=w,w=p(C,10),C=S,S=E}var k=this._b+a+w|0;this._b=this._c+s+O|0,this._c=this._d+u+v|0,this._d=this._e+i+S|0,this._e=this._a+n+C|0,this._a=k},u.prototype._digest=function(){this._block[this._blockOffset++]=128,56<this._blockOffset&&(this._block.fill(0,this._blockOffset,64),this._update(),this._blockOffset=0),this._block.fill(0,this._blockOffset,56),this._block.writeUInt32LE(this._length[0],56),this._block.writeUInt32LE(this._length[1],60),this._update();var e=n.alloc?n.alloc(20):new n(20);return e.writeInt32LE(this._a,0),e.writeInt32LE(this._b,4),e.writeInt32LE(this._c,8),e.writeInt32LE(this._d,12),e.writeInt32LE(this._e,16),e},e.exports=u},function(e,t,i){(t=e.exports=function(e){e=e.toLowerCase();var i=t[e];if(!i)throw new Error(e+" is not supported (we accept pull requests)");return new i}).sha=i(228),t.sha1=i(229),t.sha224=i(230),t.sha256=i(109),t.sha384=i(231),t.sha512=i(110)},function(e,t,i){"use strict";t.utils=i(237),t.Cipher=i(238),t.DES=i(239),t.CBC=i(240),t.EDE=i(241)},function(e,t,i){var n=i(243),a=i(251),s=i(120);t.createCipher=t.Cipher=n.createCipher,t.createCipheriv=t.Cipheriv=n.createCipheriv,t.createDecipher=t.Decipher=a.createDecipher,t.createDecipheriv=t.Decipheriv=a.createDecipheriv,t.listCiphers=t.getCiphers=function(){return Object.keys(s)}},function(e,t,i){var n={ECB:i(244),CBC:i(245),CFB:i(246),CFB8:i(247),CFB1:i(248),OFB:i(249),CTR:i(118),GCM:i(118)},a=i(120);for(var s in a)a[s].module=n[a[s].mode];e.exports=a},function(e,t,i){(function(t){var n=i(4),a=i(23);function s(e){for(var t=e.modulus.byteLength(),i=new n(a(t));0<=i.cmp(e.modulus)||!i.umod(e.prime1)||!i.umod(e.prime2);)i=new n(a(t));return i}(e.exports=function(e,i){var a,r,o={blinder:(r=s(a=i)).toRed(n.mont(a.modulus)).redPow(new n(a.publicExponent)).fromRed(),unblinder:r.invm(a.modulus)},c=i.modulus.byteLength(),d=(n.mont(i.modulus),new n(e).mul(o.blinder).umod(i.modulus)),l=d.toRed(n.mont(i.prime1)),g=d.toRed(n.mont(i.prime2)),h=i.coefficient,u=i.prime1,p=i.prime2,f=l.redPow(i.exponent1),m=g.redPow(i.exponent2);f=f.fromRed(),m=m.fromRed();var _=f.isub(m).imul(h).umod(u);return _.imul(p),m.iadd(_),new t(m.imul(o.unblinder).umod(i.modulus).toArray(!1,c))}).getr=s}).call(this,i(3).Buffer)},function(e,t,i){var n=t;n.utils=i(11),n.common=i(32),n.sha=i(267),n.ripemd=i(271),n.hmac=i(272),n.sha1=n.sha.sha1,n.sha256=n.sha.sha256,n.sha224=n.sha.sha224,n.sha384=n.sha.sha384,n.sha512=n.sha.sha512,n.ripemd160=n.ripemd.ripemd160},function(e,t,i){"use strict";var n,a,s,r,o,c,d,l,g,h,u,p,f,m,b,y;function v(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var S=i(21),C={flights:{ED:(n={},v(n,S.confirmation_cars_banner,313551),v(n,S.confirmation_cars_emerginglayer,313449),v(n,S.confirmation_cars_smartblock,313466),v(n,S.mytrips_cars_banner,313823),v(n,S.mytripdetails_cars_smartblock,313738),n),GV:(a={},v(a,S.confirmation_cars_banner,315846),v(a,S.confirmation_cars_emerginglayer,315744),v(a,S.confirmation_cars_smartblock,315761),v(a,S.mytrips_cars_banner,316118),v(a,S.mytripdetails_cars_smartblock,316033),a),OP:(s={},v(s,S.confirmation_cars_banner,315081),v(s,S.confirmation_cars_emerginglayer,314979),v(s,S.confirmation_cars_smartblock,314996),v(s,S.mytrips_cars_banner,315353),v(s,S.mytripdetails_cars_smartblock,315268),s),TL:(r={},v(r,S.confirmation_cars_banner,314316),v(r,S.confirmation_cars_emerginglayer,314214),v(r,S.confirmation_cars_smartblock,314231),v(r,S.mytrips_cars_banner,314588),v(r,S.mytripdetails_cars_smartblock,314503),r)},dp:{ED:(o={},v(o,S.confirmation_cars_banner,313653),v(o,S.confirmation_cars_emerginglayer,313449),v(o,S.confirmation_cars_smartblock,313568),v(o,S.mytrips_cars_banner,313823),v(o,S.mytripdetails_cars_smartblock,313738),o),GV:(c={},v(c,S.confirmation_cars_banner,315948),v(c,S.confirmation_cars_emerginglayer,315744),v(c,S.confirmation_cars_smartblock,315863),v(c,S.mytrips_cars_banner,316118),v(c,S.mytripdetails_cars_smartblock,316033),c),OP:(d={},v(d,S.confirmation_cars_banner,315183),v(d,S.confirmation_cars_emerginglayer,314979),v(d,S.confirmation_cars_smartblock,315098),v(d,S.mytrips_cars_banner,315353),v(d,S.mytripdetails_cars_smartblock,315268),d),TL:(l={},v(l,S.confirmation_cars_banner,314418),v(l,S.confirmation_cars_emerginglayer,314214),v(l,S.confirmation_cars_smartblock,314333),v(l,S.mytrips_cars_banner,314588),v(l,S.mytripdetails_cars_smartblock,314503),l)}},w={flights:{ED:(g={},v(g,S.confirmation_cars_banner,313687),v(g,S.confirmation_cars_emerginglayer,313670),v(g,S.mytrips_cars_banner,313840),v(g,S.mytripdetails_cars_banner,313857),g),GV:(h={},v(h,S.confirmation_cars_banner,315982),v(h,S.confirmation_cars_emerginglayer,315965),v(h,S.mytrips_cars_banner,316135),v(h,S.mytripdetails_cars_banner,316152),h),OP:(u={},v(u,S.confirmation_cars_banner,315217),v(u,S.confirmation_cars_emerginglayer,315200),v(u,S.mytrips_cars_banner,315370),v(u,S.mytripdetails_cars_banner,315387),u),TL:(p={},v(p,S.confirmation_cars_banner,314452),v(p,S.confirmation_cars_emerginglayer,314435),v(p,S.mytrips_cars_banner,314605),v(p,S.mytripdetails_cars_banner,314622),p)},dp:{ED:(f={},v(f,S.confirmation_cars_banner,313721),v(f,S.confirmation_cars_emerginglayer,313704),v(f,S.mytrips_cars_banner,313840),v(f,S.mytripdetails_cars_banner,313857),f),GV:(m={},v(m,S.confirmation_cars_banner,316016),v(m,S.confirmation_cars_emerginglayer,315999),v(m,S.mytrips_cars_banner,316135),v(m,S.mytripdetails_cars_banner,316152),m),OP:(b={},v(b,S.confirmation_cars_banner,315251),v(b,S.confirmation_cars_emerginglayer,315234),v(b,S.mytrips_cars_banner,315370),v(b,S.mytripdetails_cars_banner,315387),b),TL:(y={},v(y,S.confirmation_cars_banner,314486),v(y,S.confirmation_cars_emerginglayer,314469),v(y,S.mytrips_cars_banner,314605),v(y,S.mytripdetails_cars_banner,314622),y)}};e.exports=function(e){var t="mobile"===Odigeo.SessionScope.flow?w:C,i=Odigeo.SessionScope.brand,n=Odigeo.SessionScope.flowProduct;return"upsell"===n&&(n="dp"),_.get(t,n+"."+i+"."+e,0)}},function(e,t,i){"use strict";e.exports={create:function(e){var t=function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return!!n()&&e.should(t)},i=function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return a()?e.shoot(t):_.noop()},n=function(){return e.should&&_.isFunction(e.should)},a=function(){return e.shoot&&_.isFunction(e.shoot)},s=function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return!!t(e)&&(i(e),!0)},r=function(){return{should:t,shoot:s,exposedMethods:e.exposedMethods||{}}};return{start:function(t){return i=t,_.extend(e,{getParameters:function(){return i},getView:function(){return i.view},getProceedToPayment:function(){return i.proceedToPayment}}),_.extend({},e,r());var i},doShoot:i}}}},function(e,t,i){"use strict";var n,a=i(0),s="modal_container",r="modal_footer",o="modal_button",c="modal_close",d="."+s+".open",l=function(e){$(_.get(e,"target")).hasClass(s)&&($(d).off(Odigeo.Events.tap,this.CLOSE_OUTCLICK_HANDLER),this.close(!0))},g=function(e){_.isEmpty(e.action)||_.isEmpty(e.label)||a.trackEvent(e.action,e.label,e.page)};(n=function(e,t,i){this.CLOSE_OUTCLICK_HANDLER=_.bind(l,this),this.$container=e instanceof $?e:$(e),this.content=_.extend({header:"",content:"",button:"",constants:{containerClass:s,closeButtonClass:c,footerClass:r,footerButtonClass:o,headerClass:"modal_header"}},t),this.options=_.merge({template:null,fillThePage:!0,generateHtml:!0,preventContainerTap:!0,button:{hide:!1,callback:function(){},analytics:{action:"",label:""}},open:{analytics:{action:"",label:""}},close:{analytics:{action:"",label:""}}},i),this.options.generateHtml?this.initTemplate().then(_.bind(function(){this.generateTemplate(),this.bindEvents()},this)):this.bindEvents()}).prototype.initTemplate=function(){var e=$.Deferred();return _.isFunction(this.options.template)?e.resolve():Odigeo.Templates.getGenericTemplates(["modal"]).then(_.bind(function(t){this.options.template=_.get(t,"modal.modal",_.noop),e.resolve()},this)),e.promise()},n.prototype.generateTemplate=function(){var e=this.options.template||_.noop,t=$(e(this.content)),i=this.options.fillThePage?"calc(100vh - 20px)":void 0;t.css({"max-height":i,overflow:"hidden"}),this.$container.addClass("odf-lightbox-bg modal_lightbox").empty().append(t)},n.prototype.updateContainer=function(e){e instanceof $&&(this.$container=e,this.generateTemplate(),this.bindEvents())},n.prototype.bindEvents=function(){this.options.preventContainerTap&&this.$container.on(Odigeo.Events.tap,function(e){e.stopPropagation(),e.preventDefault()}),this.$container.find("."+o).on(Odigeo.Events.tap,_.bind(function(e){e.stopPropagation(),e.preventDefault(),g(this.options.button.analytics),this.$container.one(Odigeo.Events.transitionEnd,_.bind(function(){var e=_.get(this.options,"button.callback");_.isFunction(e)&&e()},this)),this.close(!1)},this)),this.$container.find("."+c).on(Odigeo.Events.tap,_.bind(function(e){e.stopPropagation(),e.preventDefault(),this.close(!0)},this))},n.prototype.open=function(e,t){e=e&&!_.get(this.options,"button.hide",!1),this.$container.find("."+r).toggleClass("odf-hidden",_.isUndefined(e)||!e),this.$container.addClass("open"),this.toggleLockBody(!0),g(this.options.open.analytics),t&&this.closeOnOutclick()},n.prototype.close=function(e){this.$container.removeClass("open"),this.toggleLockBody(!1),e&&g(this.options.close.analytics)},n.prototype.closeOnOutclick=function(){$(d).on(Odigeo.Events.tap,this.CLOSE_OUTCLICK_HANDLER)},n.prototype.toggleLockBody=function(e){$("body").toggleClass("odf-overflow-hidden",e)},e.exports=n.prototype.constructor=n},,,function(e,t,i){"use strict";e.exports={},e.exports.errorLenghtOverMax=function(e,t){return _.isUndefined(t)?!!e&&47<e.length:!!t},e.exports.clearErrors=function(e,t){_.each(e,function(e){$(e).closest(".input_wrapper").removeClass("invalid invalid-long")},this),_.each(t,function(e){$(e).removeClass("invalid invalid-long")},this)},e.exports.showError=function(e,t,i){var n=this.errorLenghtOverMax(e,i);n="ja"===Odigeo.SessionScope.tmParam.language&&"M"===Odigeo.SessionScope.tmParam.device&&25<e.length||n,t.find(n?".error_long_message":".error_message").text(e),t.addClass(n?"invalid-long":"invalid")},e.exports.checkValidity=function(e,t){var i=_.reduce(e,function(e,t){return $.merge(e,this._validateOneField($(t)))},[],this);return _.each(i,function(e){this._showError(e,t)},this),i},e.exports._validateOneField=function(e){var t=[],i=e.data();if(!i||!i.validationType)return t;var n=e.is("input")?e.val():"click";return _.isEmpty(n)?t.push({index:i?i.name:"",key:"empty"}):i&&i.validationType&&!Odigeo.Utils.isValid(i.validationType,n)&&t.push({index:i.name,key:"invalid"}),t},e.exports._showError=function(e,t){var i=t.find("[data-name="+e.index+"]"),n=i.data(e.key),a=i.closest(".input_wrapper");this.showError(n,a)}},function(e,t,i){"use strict";e.exports={isBannedAirline:function(e,t){return t&&_.includes(["LH","SN","OS","LX"],e)},isCarrierWithSmallBagInCabin:function(e){return _.includes(Odigeo.JCMS.carriersWithSmallBagInCabin.split(",").map(function(e){return e.trim()}),e)},createAirlineSectionInfo:function(e){return{imageShown:!this.isBannedAirline(e.carrier.code,Odigeo.AB.isHidingBannedAirlineLogos)}}}},function(e,t,i){"use strict";var n=i(0),a=function(e){return e?"CANXSELF":"none"},s=function(e){return e?"CANXSELF":"standard"};e.exports={trackOnClickSelectFairUpgradePanel:function(e){n.trackEvent(e.action,["open_result_clus:",a(e.shown),"-pol:",s(e.shown)].join(""))},trackOnSubmitFairUpgradeSelection:function(e){n.trackEvent(e.action,["select_result_clus:",a(e.selected),"-pol:",s(e.selected)].join(""))},trackOnClickFareUpgradeTermsAndConditions:function(e){n.trackEvent(e.action,["open_info_clus:",a(!0),"-pol:",s(!0)].join(""))}}},function(e,t,i){"use strict";e.exports={CONCEPT_KEY:"conceptKey",CONCEPT_LABEL:"conceptLabel",ONE_PRICE:"onePrice",ONE_PRICE_PROVIDER:"onePriceProvider",ALL_PRICE:"allPrice",QUANTITY:"quantity",TYPE:"type",FARE:"fare",PROVIDER_FARE:"providerFare",ALL_PRICE_PROVIDER:"allPriceProvider",MARKUP:"markup",TAX:"tax"}},function(e,t,i){"use strict";var n=i(0);function a(){return this.pending=!1,function(){_.each(this.getImages(),function(e){_.isEmpty(e.thumbnailUrl)&&(e.thumbnailUrl=e.url),function(e){"https:"===Odigeo.Utils.getWebProtocol()&&(e.url=e.url.replace("http:","https:"),e.thumbnailUrl=e.thumbnailUrl.replace("http:","https:"))}.call(this,e)},this)}.call(this),function(){this.set("groupFacilities",App.Accommodations.convertFacilities(function(){return this.get("accommodationFacilities")||[]}.call(this)))}.call(this),this.trigger("loadDetails"),Odigeo.trigger("accommodation-details-manager:loadDetails"),n.stopMetric("LOAD_INTERMEDIATE_ROOM_DETAILS"),n.counterMetric("LOAD_INTERMEDIATE_ROOM_DETAILS_OK_COUNTER"),this}function s(e,t){r.call(this),this.trigger("failLoad",t),Odigeo.trigger("accommodation-details-manager:failLoad"),n.counterMetric("LOAD_INTERMEDIATE_ROOM_DETAILS_KO_COUNTER")}function r(e){this.clear().set(_.extend({},this.defaults,e))}var o,c=Odigeo.Model.extend({dataUrl:"accommodation/details",pending:!1,tracking:!0,defaults:{key:null,tripAdvisorId:null,groupFacilities:{}},url:function(){return Odigeo.Settings.getProperty("serviceUrlFormatter")(this.dataUrl)},store:function(e){this.set(e),this.update(e)},update:function(e){return e.key===this.get("key")?(this.pending||this.trigger("loadDetails"),$.Deferred().resolve()):(_.isString(e.tripAdvisorId)&&_.isEmpty(e.tripAdvisorId)&&(e.tripAdvisorId=null),r.call(this,e),function(){return Odigeo.trigger("session:refreshed"),this.trigger("fetchDetails"),this.pending=!0,this.fetch({data:{key:this.get("key")},success:_.bind(a,this),error:_.bind(s,this)})}.call(this))},deleteImgs:function(e){return _.isEmpty(e)||(this.set("accommodationImages",_.reject(this.getImages(),function(t,i){return _.includes(e,i)})),this.trigger("remove:img")),this},getAccommodationDealInformation:function(){return this.get("accommodationDealInformation")||{}},getCoordinates:function(){return this.getAccommodationDealInformation().coordinates||{}},getImages:function(){return this.get("accommodationImages")||[]},getImage:function(e){return this.getImages()[e]||{}},getImagesLength:function(){return this.getImages().length}});e.exports.AccommodationDetailsModel=c,e.exports.getInstance=function(){return _.isUndefined(o)&&(o=new c),o}},function(e,t,i){"use strict";var n=i(27),a=i(76),s=i(95),r="UTC:yyyy-mm-dd'T'HH:MM:ss",o=i(21),c={ED:"edreams",OP:"opodo",TL:"travellink",GV:"govoyages"},d=[o.confirmation_cars_banner,o.confirmation_cars_emerginglayer,o.mytripdetails_cars_banner],l=function(e){var t="";if(_.contains(d,e)){var i=g();_.isEmpty(i)||(t="&abtest="+i)}return t},g=function(){var e=void 0;switch(s.getRedirectionAbConfig()){case 3:e="b";break;case 2:e="a";break;default:e=""}return e};e.exports={buildUrlFromConfirmationPage:function(e,t,i){var s,o={brand:(s=Odigeo.SessionScope.brand,_.get(c,s,"")),language:_.get(Odigeo.SessionScope,"tmParam.language","en"),arrivalIataCode:e.rentalCarsPickupIata,departureIataCode:e.rentalCarsPickupIata,clientResidenceId:e.buyerCountryCode,clientAge:e.cars.driverAge,arrivalDateTime:n.getEncodedDate(e.cars.pickupDate,r),departureDateTime:n.getEncodedDate(e.cars.returnDate,r),currency:Odigeo.Utils.Currency.currencyCode,nOfPassengers:e.cars.nPassengers,sourceCountry:e.cars.departureCountryCode,destinationCountry:e.cars.arrivalCountryCode,oneWay:e.isOneWay,nOfBaggages:e.cars.numBaggages},d=Odigeo.Utils.replaceCmsKeyArgsByName(t,o);return(d+="&clientId="+a(i))+l(i)},getCartrawlerAbParameters:l,getAbParametersForSmartblock:function(){var e=g();return _.isEmpty(e)?null:{ab:e}},getAbPartition:g}},,function(e,t,i){"use strict";var n=i(77),a={getModel:function(e){return _.get(e,"models.baggage",{})}};e.exports={create:function(e){return n.create(_.extend({},e,a))}}},,function(e,t,i){"use strict";var n=i(61).parseSetMethodArgs,a=Backbone.Model,s=a.prototype.set,r=a.extend({toJSON:function(){var e=a.prototype.toJSON.call(this);return _.each(this.nestedProps,function(t,i){e[i]=e[i].toJSON()}),e},set:function(){var e=n(arguments),t=_.keys(this.nestedProps),i=_.omit(e[0],t),a=_.pick(e[0],t),r=e[1],c={},d=_.extend({},r,{silent:!0});_.isEmpty(this.attributes)&&o.call(this,d),s.call(this,i,d);var l=_.reduce(this.changedAttributes(),function(e,t,i){return e[i]={change:!0},e},{});_.each(a,_.bind(function(e,t){var i,n,a,s,o,d,l=this.get(t);(_.has(l,"models")||_.has(l,"attributes"))&&(n=l,a=e,s=r,d=_.isFunction(_.get(a,"toJSON"))?a.toJSON():a,n.__collectedEvents={},n.set(d,s),o=_.clone(n.__collectedEvents),delete n.__collectedEvents,i=o),_.isEmpty(i)||(c[t]=i)},this));var g=_.extend(c,l);_.isEmpty(g)||(function(e,t){_.each(e,_.bind(function(e,i){e.change=!0,_.each(e,_.bind(function(e,n){this.trigger(n+":"+i,this,this.get(i),t)},this))},this))}.call(this,g,r),function(e,t){var i=_.merge.apply(null,_.toArray(e));i.change=!0,_.each(i,_.bind(function(e,i){this.trigger(i,this,t)},this))}.call(this,g,r))}}),o=function(e){var t=_.result(this,"defaults",{});_.each(this.nestedProps,_.bind(function(i,n){var a;s.call(this,n,new i((a=t[n],_.isFunction(_.get(a,"toJSON"))?a.toJSON():a),e),e)},this))},c=function(e){_.defaults(this,{__collectedEvents:{}}),_.includes(e,":")||(this.__collectedEvents[e]=!0)};r.extend=function(e,t){return a.extend.call(r,_.extend({},e,{initialize:function(t,i){var n=e.initialize||e.constructor||_.noop;this.nestedProps=e.nestedProps||{},_.each(this.nestedProps,_.bind(function(e,t){this.get(t).on("all",c)},this)),n.call(this,t,i)}}),t)},e.exports=r},,function(e,t,i){"use strict";var n=i(0),a=i(6).ofResults(),s=Odigeo.Settings.getProperty("serviceUrlFormatter")("getcollapsibleflightsummarydata"),r="NA",o=["HUB","SMARTHUB"],c=["details","passengersinfo","roomselection","flightsummary"],d={flightsummary:"sum",details:"pax",passengersinfo:"pax",payment:"pay",confirmation:"conf",cancellation:"can",flex:"flex",servicepack:"sp",insurance:"ins",ancillaries:"anc",hotel_results:"hres",room:"room",canx:"canx"},l=function(e,t){return e.filter(function(e){return!(t^_.includes(o,e.fareItineraryType))})},g=function(e){return e.length?_.min(e,"price"):{}},h=function(e,t){var i=e.itineraryGroupsList[t];return _.min(i.segItems,"numStops").numStops||0},u=function(e,t){var i=function(e,t){if(Array.isArray(e))return e;if(Symbol.iterator in Object(e))return function(e,t){var i=[],n=!0,a=!1,s=void 0;try{for(var r,o=e[Symbol.iterator]();!(n=(r=o.next()).done)&&(i.push(r.value),!t||i.length!==t);n=!0);}catch(e){a=!0,s=e}finally{try{!n&&o.return&&o.return()}finally{if(a)throw s}}return i}(e,t);throw new TypeError("Invalid attempt to destructure non-iterable instance")}(e.itineraryGroupsList[t].segItems,1)[0];return p(i)},p=function(e){var t=e.sections.filter(function(e){return!_.isEmpty(e.stopDuration)||0<e.stopDuration}),i=_.sum(t,function(e){return Number(e.stopDuration)}),n=0<t.length?i/t.length/60:0;return Math.round(100*n)/100},f=function(e){return e?0:r},m=function(){var e,t=Odigeo.Utils.parseJson(Odigeo.Session.get("vinTrackingOptions")),i=Odigeo.Utils.isRequestApp("dp")?Odigeo.History.getPageNameFromFragment():b();t&&t.isVinFlight&&(t.page=d[i],y("vin",(e=t).tripType+"_vin_price:"+e.price+"_stopso:"+e.outBoundStops+"_stopsi:"+e.inBoundStops+"_duro:"+e.outBoundAverageDuration+"_duri:"+e.inBoundAverageDuration+"_page:"+e.page))},b=function(){return Odigeo.History.getFragment().split("/").filter(function(e){return""!=e}).slice(-1)[0]},y=function(e,t){n.trackEvent(e,t)};e.exports={trackResultsOnLoad:function(e){var t,i=function(e){var t=l(e.items,!0),i=l(e.items,!1),n=t.length?g(t):{},s=i.length?g(i):{},r=a.toAcronym(e.searchType),o="OW"!==r,c=t.length&&o?u(n,1):f(o),d=i.length&&o?u(s,1):f(o);return{vinFlights:t,notVinFlights:i,cheapestVin:n,cheapestNotVin:s,tripType:r,outboundVinStops:t.length?h(n,0):0,outboundNotVinStops:i.length?h(s,0):0,inboundVinStops:t.length&&o?h(n,1):f(o),inboundNotVinStops:i.length&&o?h(s,1):f(o),outboundVinStopsDuration:t.length?u(n,0):0,outboundNotVinStopsDuration:i.length?u(s,0):0,inboundVinStopsDuration:c,inboundNotVinStopsDuration:d,totalResults:e.items.length}}(e);i.vinFlights.length&&(t=function(e){return e.tripType+"_vin_n:"+e.vinFlights.length+"_r:"+e.totalResults+"_pv:"+parseInt(_.get(e.cheapestVin,"price",0),10)+"_pnv:"+parseInt(_.get(e.cheapestNotVin,"price",0),10)+"_svo:"+e.outboundVinStops+"_snvo:"+e.outboundNotVinStops+"_svi:"+e.inboundVinStops+"_snvi:"+e.inboundNotVinStops+"_dvo:"+e.outboundVinStopsDuration+"_dnvo:"+e.outboundNotVinStopsDuration+"_dvi:"+e.inboundVinStopsDuration+"_dnvi:"+e.inboundNotVinStopsDuration}(i),y("onload",t))},trackOnSelectFlight:function(e,t){var i;i=e.itinerary,_.includes(o,i.fareItineraryType)&&y("vin",function(e,t){var i,n,s=a.toAcronym(t.searchType),o="OW"!==s,c=l(t.fareItineraries),d=g(c);return s+"_sel_vin_pr:"+(n=e.positions,_.get(n,"[0].itinerary"))+"_pp:"+Number((i=e.itinerary,_.get(i,"mainItineraryId","").split(",")[0]))+"_pv:"+parseInt(e.itinerary.price,10)+"_pnv:"+(_.isEmpty(d)?r:parseInt(d.price,10))+"_svo:"+h(e.itinerary,0)+"_snvo:"+(_.isEmpty(d)?r:h(d,0))+"_svi:"+(o?h(e.itinerary,1):r)+"_snvi:"+(o&&!_.isEmpty(d)?h(d,1):r)+"_dvo:"+u(e.itinerary,0)+"_dnvo:"+(_.isEmpty(d)?r:u(d,0))+"_dvi:"+(o?u(e.itinerary,1):r)+"_dnvi:"+(o&&!_.isEmpty(d)?u(d,1):r)}(e,t))},trackOnLoadFlow:function(){return(_.includes(c,Odigeo.History.getPageNameFromFragment())?$.ajax({url:s,method:"GET"}).then(function(e){Odigeo.Session.set("vinTrackingOptions",JSON.stringify(function(e){var t,i,n=$(".od_page.active .vin_price_info").data("selectedprice"),s=e.flightDetailsDTO,o=a.toAcronym(e.tripType),c="OW"!==o;return{tripType:o,price:n,isVinFlight:(t=s.hub,i=s.smartHub,t||i),outBoundStops:s.segments[0].allStops,inBoundStops:c?s.segments[1].allStops:r,outBoundAverageDuration:p(s.segments[0]),inBoundAverageDuration:c?p(s.segments[1]):r}}(e)))}):$.Deferred().resolve().promise()).then(m)}}},function(e,t,i){"use strict";var n,a,s={},r={},o={},c={buyer:!1,typeOfTraveller:"ADULT",frequentFlyerList:[],email:null,profile:{gender:"",title:"",name:"",middleName:null,firstLastName:"",secondLastName:null,birthDate:null,prefixPhoneNumber:null,phoneNumber:null,prefixAlternatePhoneNumber:null,mobilePhoneNumber:null,alternatePhoneNumber:null,isDefault:!0,cpf:null,nationalityCountryCode:null,identificationList:[],address:null},importedFromLocal:!1},d={facebook:"facebook",google:"google"},l=function(e,t){return new RegExp(n).test(e+t)},g=function(e,t,i,n){return e.valid&&(_.extend(e,{traveller:{email:n,profile:{name:t,firstLastName:i,title:"MR",gender:"MALE"}}}),e.valid=!0),e},h=function(e){_.isUndefined(e)||("home"===e?Odigeo.Utils.goToApplicationHome():Odigeo.Router.navigate(e))};e.exports={init:function(e,t,i,a){"undefined"==typeof FB&&Odigeo.require(["facebook"],function(){FB.init({appId:Odigeo.SessionScope.social.facebookAppId,cookie:!0,xfbml:!0,version:"v3.0"})}),"undefined"==typeof gapi&&Odigeo.require(["googlePlus"],function(){gapi.load("auth2",function(){gapi.auth2.init({client_id:Odigeo.SessionScope.social.googleLoginClientId,scope:"profile email",prompt:"select_account"}).then(_.bind(function(){Odigeo.Session.get("socialLoginExpired")&&!_.isNull(gapi.auth2.getAuthInstance())&&(gapi.auth2.getAuthInstance().signOut(),Odigeo.Session.remove("socialLoginExpired"))},this))})}),n=a,s[i]=e,r[i]=t},socialLoginType:d,getLoginStatus:function(e){var t=e;Odigeo.Session.set("loginWidget",e),FB.login(_.bind(function(e){var i,n,a;n=t,"connected"===(i=e).status?(a={token:o=i.authResponse.accessToken,loginType:d.facebook},s[n](a)):r[n]("not_authorized"===i.status?"error":"unknown",d.facebook)},this),{scope:"email",return_scopes:!0})},getLoginStatusGoogle:function(e){var t=e;Odigeo.Session.set("loginWidget",e),gapi.auth2.getAuthInstance().signIn({scope:"profile email"}).then(_.bind(function(e){var i,n,o;n=t,(i=e).isSignedIn()?(o={token:i.getAuthResponse().id_token,loginType:d.google},a=gapi.auth2.getAuthInstance().currentUser.get().getBasicProfile(),s[n](o)):r[n]("unknown",d.google)},this),_.bind(function(e){var i;i=e,r[t]("access_denied"===i.error?"error":"unknown",d.google)},this))},getFirstName:function(e){_.isEmpty(o)?this.getGoogleUserInformation(e):this.getFacebookUserInformation(e)},getFacebookUserInformation:function(e){FB.api("/me",{fields:"first_name,last_name,email",access_token:o.token},function(t){var i={valid:l(t.first_name,t.last_name)};e(g(i,t.first_name,t.last_name,t.email))})},getGoogleUserInformation:function(e){var t={valid:l(a.getGivenName(),a.getFamilyName())};e(g(t,a.getGivenName(),a.getFamilyName(),a.getEmail()))},createTraveller:function(e){this.getFirstName(_.bind(function(t){var i=_.clone(c);i.email=t.traveller.email,_.extend(i.profile,t.traveller.profile),e(t.valid?i:null)}))},addTravellerToAccount:function(e,t,i){_.isEmpty(e.userDTO.traveller)?this.getFirstName(_.bind(function(n){var a=_.bind(function(e,t){return c.email=t,_.extend(c.profile,e),[c]},this);n.valid?(e.userDTO.traveller=a(n.traveller.profile,n.traveller.email),Odigeo.trigger(t+":submitUserRequest",{action:"updateAccountInfo",data:e.userDTO},!0)):h(i)},this)):h(i)},logoutSocialAccount:function(){"undefined"==typeof gapi||_.isNull(gapi.auth2.getAuthInstance())||gapi.auth2.getAuthInstance().signOut()}}},function(e,t,i){"use strict";var n=i(100).getInstance(),a=i(84),s=i(15);e.exports=new s({addItemToPricemanagerCollection:function(e){return n.addItem(e)},removeItemFromPricemanagerCollectionByType:function(e){return n.removeItemByType(e),this},removeItemFromPricemanagerCollection:function(e){return _.isNull(e)||n.removeItem(e),this},addItemToPricemanagerCollectionIfNotExists:function(e){var t=e.get(a.CONCEPT_KEY),i=n.getPriceBreakdownItemByConceptKey(t);return i||(i=this.addItemToPricemanagerCollection(e)),i}})},function(e,t,i){"use strict";e.exports={getRedirectionAbConfig:function(){var e=Odigeo.History.getPageNameFromFragment(),t="desktop"===Odigeo.SessionScope.flow,i=1;return t&&Odigeo.Utils.parseJson(Odigeo.Session.get("isRedirectionFromConfirmation"))&&("mytrips"===e||"tripdetails"===e)?i=3:t&&2===Odigeo.AB.confirmationMytripsAutomaticRedirection&&"confirmation"===e&&(i=2),i}}},function(e,t,i){"use strict";var n=_.constant($.Deferred().promise()),a=_.constant({execute:n,get:n}),s=function(e){this.widgets=e};s.prototype.deactivate=function(e){_.each(_.isString(e)?new Array(e):e,function(e){this.widgets[e]=a},this)},e.exports=s},function(e,t,i){"use strict";var n,a=Odigeo.Collection.extend({model:i(187),fillData:function(e,t){!_.isNaN(t.idPassenger)&&this.isOptionIdCorrect(t.idRow)&&(this.add({idPassenger:t.idPassenger,idRow:t.idRow}),this.add(_.map(e,function(e){return _.extend(e,{idPassenger:t.idPassenger,idRow:t.idRow})})))},clearCollection:function(){this.remove(this.models)},getOptions:function(e){return e=_.isUndefined(e)?{}:e,this.where(e)},isOptionIdCorrect:function(e){return _.isString(e)&&0<e.length}});e.exports.getInstance=function(){return _.isUndefined(n)&&(n=new a),n}},function(e,t,i){"use strict";e.exports={execute:function(){return this},get:function(){return $.Deferred().resolve().promise()}}},function(e,t,i){"use strict";var n=/['"]?\]\.|['"]?\]\[['"]?|\[['"]?|['"]?\]|\./;e.exports=function(e,t,i){var a,s=t.split(n);for(_.last(s)||s.pop(),a=0;a<s.length&&_.isObject(e);++a)e=e[s[a]];return a<s.length||_.isUndefined(e)?i:e}},function(e,t,i){"use strict";var n,a,s,r,o,c,d,l,g,h,u,p,f,m,b,y,v,S,C,w,O,T;a=i(200),s=i(101),r=i(43),o=i(84),c={seatMapSelectionCollection:s},d=[r.BAGGAGES,r.BAGGAGES_WEIGHT,r.INSURANCE,r.INSURANCE_IN_CART,r.CANX_INSURANCE,r.ASSISTANCE_INSURANCE,r.ADDITION,r.SEAT,r.SEATMAP,r.SERVICE_OPTIONS,r.REBOOKING_INSURANCE,r.MEMBERSHIP_SUBSCRIPTION,r.HAND_BAGGAGE],l=[r.ADULTS,r.CHILDREN,r.INFANTS],g=function(e){this.currencyConfig.providerCurrency=e.providerCurrency,this.currencyConfig.realProviderCurrency=e.realProviderCurrency},h=function(e){this.bestPricePerPassenger=e.bestPricePerPassenger,this.bestPricePerPassengerFormatted=Odigeo.Utils.formatCurrency(this.bestPricePerPassenger)},u=function(e){_.each(e.items,function(e){e.type===r.PROMO_CODE&&(e.quantity=1,e.onePrice=-Math.abs(e.allPrice),e.allPrice=-Math.abs(e.allPrice))})},p=function(e){this.refundableTaxes=e.refundableTaxes},f=function(e){_.each(e.items,function(e){e.type===r.INSURANCE_IN_CART&&(e.type=r.INSURANCE,e.conceptKey=e.conceptKey.replace(/-/g,""))})},m=function(e){this.preselectedRefundableFareUpgradePrice=e.preselectedRefundableFareUpgradePrice},b=function(e){this.isRefundableFareUpgradeShownInPax=e.isRefundableFareUpgradeShownInPax},y=function(e){this.areAllPassengersWithBaggage=e.areAllPassengersWithBaggage},v=function(e){this.baggageBundleDiscountPercentage=e.baggageBundleDiscountPercentage},S=function(e){var t,i=e.membershipPerksDTO;this.membershipPerks=i?{isMembershipPriceDisplay:!0,isIncludedInPrice:(t=i).includedInPrice,fee:t.fee,isMemberLoggedIn:t.memberLoggedIn}:{}},C=function(){_.each(c,function(e,t){this[t]=e.getInstance(),this.listenTo(this[t],"add remove update",_.bind(w,this))},this)},w=function(e,t,i){var n=t.getPriceBreakdownItem();Odigeo.Utils.isMatch(i,{add:!0})?this.addItem(n):this.removeItem(n)},O=function(e,t){if(!_.isUndefined(e))return Odigeo.Utils.formatCurrency(e,t)},T=Odigeo.Collection.extend({numPassengers:0,allPaxHasTax:!1,anyHasTax:!1,anyHasFare:!1,totalTicketPrice:0,totalTicketProviderPrice:0,totalTicketPricePerPax:0,totalFarePricePerPax:0,totalProviderFarePricePerPax:0,totalTicketProviderPricePerPax:0,totalTaxPricePerPax:0,serviceFeeItemPrice:0,serviceFeeItemPriceProvider:0,areAllPassengersWithBaggage:0,baggageBundleDiscountPercentage:0,refundableTaxes:0,bestPricePerPassenger:0,currencyConfig:{providerCurrency:null,realProviderCurrency:null},doesNotMatchCurrency:!1,seatMapSelectionCollection:null,model:a,membershipPerks:{},sortingOrder:[r.ADULTS,r.CHILDREN,r.INFANTS,r.SERVICE_FEE,r.CC_FEE,r.BAGGAGES,r.BAGGAGES_WEIGHT,r.SEAT,r.SEATMAP,r.HAND_BAGGAGE,r.INSURANCE,r.INSURANCE_IN_CART,r.ASSISTANCE_INSURANCE,r.REBOOKING_INSURANCE,r.CANX_INSURANCE,r.PROMO_CODE,r.SERVICE_OPTIONS],initialize:function(){_.bind(C,this)()},comparator:function(e){return _.indexOf(this.sortingOrder,e.get(o.TYPE))},url:function(){return Odigeo.Settings.property("serviceUrlFormatter")("booking/pricebreakdown")},parse:function(e){if(!_.isUndefined(e))return _.bind(g,this,e)(),_.bind(h,this,e)(),_.bind(u,this,e)(),_.bind(p,this,e)(),_.bind(S,this,e)(),_.bind(f,this,e)(),_.bind(m,this,e)(),_.bind(b,this,e)(),_.bind(y,this,e)(),_.bind(v,this,e)(),_.isObject(e.items)?this.filterByQuantity(e.items):e},fetchData:function(){this.fetch({reset:!0}).always(_.bind(function(){this.storeInmutableData(),this.triggerChange()},this))},setMembershipPerksIncludedPrice:function(e){this.membershipPerks.isIncludedInPrice=e},filterByQuantity:function(e){return _.filter(e,function(e){return 0<e.quantity})},storeInmutableData:function(){this.numPassengers=this.calculatePassengersNum(),this.allPaxHasTax=this.allPaxShouldHaveTax(),this.anyHasTax=this.hasTax(r.ADULTS),this.anyHasFare=this.hasFare(r.ADULTS),this.totalTicketPrice=this.calculateTotalTicketPrice(),this.totalTicketProviderPrice=this.calculateTotalTicketProviderPrice(),this.totalTicketPricePerPax=_.isUndefined(this.numPassengers)||0===this.numPassengers?0:this.totalTicketPrice/this.numPassengers,this.totalTicketProviderPricePerPax=_.isUndefined(this.numPassengers)||0===this.numPassengers?0:this.totalTicketProviderPrice/this.numPassengers,this.serviceFeeItemPrice=this.getPriceBreakdownItemByType(r.SERVICE_FEE).get(o.ALL_PRICE),this.serviceFeeItemPriceProvider=this.getPriceBreakdownItemByType(r.SERVICE_FEE).get(o.MARKUP),this.totalFarePricePerPax=this.calculateTotalFarePricePerPax(),this.totalProviderFarePricePerPax=this.calculateTotalProviderFarePricePerPax(),this.totalTaxPricePerPax=this.calculateTotalTaxPricePerPax(),this.doesNotMatchCurrency=this.currencyConfig.providerCurrency!==this.currencyConfig.realProviderCurrency},containsType:function(e){return this.some(function(t){return(_.isArray(e)?t.matchTypeFromList(e):t.isMatchingType(e))&&t.isQuantifiable()})},getPriceBreakdownItemByType:function(e){return this.findWhere({type:e})||new this.model({type:e})},getPriceBreakdownItemsByType:function(e){return this.where({type:e})},getPriceBreakdownItemByConceptKey:function(e){return this.findWhere({conceptKey:_.isNumber(e)?e.toString():e})},getPassengersNum:function(){return this.numPassengers},allPaxShouldHaveTax:function(){return _.every(l,function(e){return this.hasTax(e)},this)},hasTax:function(e){var t=this.getPriceBreakdownItemsByType(e);return _.some(t,function(e){return e.hasPrice(o.TAX)})},hasFare:function(e){var t=this.getPriceBreakdownItemsByType(e);return _.some(t,function(e){return e.hasPrice(o.FARE)})},isPaymentMethodCreditCard:function(){var e=this.getPriceBreakdownItemByType(r.CC_FEE).get("method");return"CREDITCARD"===e||"SECURE3D"===e},addItem:function(e){var t=_.get(e,"allowMultipleOfTheSameType",!1)?this.addMultipleOfTheSameTypeAllowed(e):this.addNoMultipleOfTheSameTypeAllowed(e);return t instanceof Odigeo.Model&&t.on("change",this.triggerChange),this.triggerChange(),t},addNoMultipleOfTheSameTypeAllowed:function(e){var t=this.getPriceBreakdownItemByType(e.type);return this.replaceItemByIndex(t,e)},addMultipleOfTheSameTypeAllowed:function(e){var t=this.indexOf(e);return-1===t?this.add(e,{at:t}):this.at(t)},removeItem:function(e){e instanceof Odigeo.Model&&e.off("change",this.triggerChange),this.remove(e),this.triggerChange()},replaceItemByIndex:function(e,t){var i=this.indexOf(e);return this.remove(this.at(i)),this.add(t,{at:i})},removeItemByType:function(e){var t=this.getPriceBreakdownItemByType(e);this.remove(t),this.triggerChange()},getSHPrice:function(){var e=this.serviceFeeItemPrice||0,t=this.getPriceBreakdownItemByType(r.CC_FEE).get(o.ALL_PRICE)||0;return O((e+t)/this.numPassengers)},calculatePassengersNum:function(){return this.calculationTotalPax(function(e,t){return e+t.get(o.QUANTITY)})},getTotalTicketPrice:function(){return+this.totalTicketPricePerPax.toFixed(2)*this.numPassengers},calculateTotalPrice:function(){var e=this.getTotalTicketPrice();return this.reduce(function(e,t){if(this.appliesToTotal(t)){var i=t.getPrice();return t.isBaggageOrBaggageWeightItem()&&0<this.baggageBundleDiscountPercentage&&this.areAllPassengersWithBaggage&&Odigeo.AB.isBaggageDiscountEnabled&&(i-=this.baggageBundleDiscountPercentage/100*i),e+i}return e},e,this)},appliesToTotal:function(e){return!e.isPassengerItem()||e.isInsuranceItem()},getTotalTicketPricePerPax:function(){return this.getTotalTicketPrice()/this.getPassengersNum()},calculatePricePerPassenger:function(){return this.calculateTotalPrice()/this.getPassengersNum()},calculationTotalPax:function(e){if(_.isFunction(e))return this.reduce(function(t,i){return i.isPassengerItem()?e(t,i):t},0)},calculationPerPax:function(e){if(_.isFunction(e))return this.calculationTotalPax(e)/this.getPassengersNum()},calculateTotalTicketPrice:function(){return this.calculationTotalPax(function(e,t){return e+t.getPrice()})},calculateTotalTicketProviderPrice:function(){return this.calculationTotalPax(function(e,t){return e+t.getProviderPrice()})},calculateTotalFarePricePerPax:function(){return this.calculationPerPax(function(e,t){return e+t.get(o.FARE)*t.get(o.QUANTITY)})},calculateTotalProviderFarePricePerPax:function(){return this.calculationPerPax(function(e,t){return e+t.get(o.PROVIDER_FARE)*t.get(o.QUANTITY)})},calculateTotalTaxPricePerPax:function(){return this.calculationPerPax(function(e,t){return e+t.get(o.TAX)*t.get(o.QUANTITY)})},getPayWithGuaranteeItemInCollection:function(){var e=r.CANX_INSURANCE;return this.getPriceBreakdownItemByType(e)},triggerChange:function(){this.trigger("priceCollection.change")},getJSONData:function(){return{items:this.toJSON(),numPassengers:this.numPassengers,bestPricePerPassenger:this.bestPricePerPassenger,bestPricePerPassengerFormatted:this.bestPricePerPassengerFormatted,currencyConfig:this.currencyConfig,doesNotMatchCurrency:this.doesNotMatchCurrency,hasBags:this.containsType([r.BAGGAGES,r.BAGGAGES_WEIGHT]),hasInsurances:this.containsType([r.INSURANCE_IN_CART,r.INSURANCE,r.CANX_INSURANCE,r.ASSISTANCE_INSURANCE]),hasSeats:this.containsType([r.SEAT,r.SEATMAP]),hasAncillaries:this.containsType(d),hasDiscountFee:this.containsType(r.DISCOUNT_FEE),hasInsuranceSelected:this.containsType([r.INSURANCE,r.ASSISTANCE_INSURANCE,r.INSURANCE_IN_CART]),allPaxHasTax:this.allPaxHasTax,hasTax:this.anyHasTax,hasFare:this.anyHasFare,totalPrice:this.calculateTotalPrice(),totalPricePerPax:this.calculatePricePerPassenger(),totalTicketPrice:this.totalTicketPrice,totalTicketPricePerPax:this.totalTicketPricePerPax,totalTicketProviderPricePerPax:this.totalTicketProviderPricePerPax,totalFarePricePerPax:O(this.totalFarePricePerPax),totalProviderFarePricePerPax:O(this.totalProviderFarePricePerPax),totalTaxPricePerPax:O(this.totalTaxPricePerPax),totalFee:this.serviceFeeItemPrice+this.getPriceBreakdownItemByType(r.CC_FEE).get(o.ALL_PRICE),totalFeeFormatted:O(this.serviceFeeItemPrice+this.getPriceBreakdownItemByType(r.CC_FEE).get(o.ALL_PRICE)),totalFeeProvider:this.serviceFeeItemPriceProvider,totalFeeProviderFormatted:O(this.serviceFeeItemPriceProvider),serviceFeeItem:this.getPriceBreakdownItemByType(r.SERVICE_FEE).toJSON(),discountFeeItem:this.getPriceBreakdownItemByType(r.DISCOUNT_FEE).toJSON(),ccFeeItem:this.getPriceBreakdownItemByType(r.CC_FEE).toJSON(),ccFeeClass:0<this.getPriceBreakdownItemByType(r.CC_FEE).get(o.ONE_PRICE)?"positive":"negative",methodIsCc:this.isPaymentMethodCreditCard(),refundableTaxes:this.refundableTaxes,refundableTaxesFormatted:O(this.refundableTaxes),membershipPerks:this.membershipPerks,preselectedRefundableFareUpgradePrice:this.preselectedRefundableFareUpgradePrice,isRefundableFareUpgradeShownInPax:this.isRefundableFareUpgradeShownInPax,baggageBundleDiscountPercentage:this.baggageBundleDiscountPercentage,areAllPassengersWithBaggage:this.areAllPassengersWithBaggage}}}),e.exports.getInstance=function(){return _.isUndefined(n)&&(n=new T),n}},function(e,t,i){"use strict";var n,a=Backbone.Collection.extend({model:i(201),dataUrl:"getseatmapselection",nTravellers:0,initialize:function(){},url:function(){return Odigeo.Settings.getProperty("serviceUrlFormatter")(this.dataUrl)},setUp:function(e){this.options=Odigeo.Utils.parseOptions(e),this.nTravellers=this.options.nTravellers,this.options.fromSession?this.setPreselectedSeatsFromSession(this.options.bookingId):this.fillData(e)},fillData:function(e){_.get(e,"isPostBooking",!1)||this.fetch(this.getDataRequestSettings())},getDataRequestSettings:function(){return{type:"GET",cache:!1,dataType:"json",contentType:"application/json",success:_.bind(this.requestSuccessHandler,this)}},requestSuccessHandler:function(e){this.trigger("seatMapSelectionResponseIsOK",e)},resetCollection:function(){this.remove(this.models)},getSeat:function(e){return this.findWhere(e)},getFlightSeats:function(e,t){return this.where({section:t})},getPriceBreakdownItem:function(){var e=this.getSelectedSeatsPrice(),t=this.getSelectedSeatsLength();return{allPrice:e,quantity:t,onePrice:0<t?e/t:0,type:"SEATMAP",conceptKey:"seatmap",conceptLabel:"seatmap"}},getSelectedSeatsPrice:function(){return this.reduce(function(e,t){return e+t.get("totalPrice")},0)},getTotalPrice:function(){return this.getSelectedSeatsPrice()},getSelectedSeatsLength:function(){return this.length},hasSelectedAnySeat:function(){return 0<this.length},getPriceBreakdown:function(){return[{type:"SEAT",quantity:this.length,totalAmount:this.getTotalPrice()}]},getCurrencyCode:function(){return this.hasSelectedAnySeat()?this.first().get("currencyCode"):null},getSeatSelectionFees:function(){var e=this.reduce(function(e,t){return e+(t.get("totalPrice")-t.get("providerPrice"))},0);return 0<e?e/this.length:0},setPreselectedSeatsFromSession:function(e){if(!this.hasSelectedAnySeat()){var t=Odigeo.Utils.parseJson(Odigeo.Session.storage.getItem("seatSelection_"+e))||[];this.loadPreselectedSeats(t)}},addSelection:function(e){this.add({numPassenger:e.numPassenger,floorSelection:e.seat.get("floor"),rowSelection:e.seat.get("seatRow"),seatMapRow:e.seat.get("seatMapRow"),columnSelection:e.seat.get("column"),providerPrice:e.seat.get("providerPrice"),totalPrice:e.seat.get("totalPrice"),currencyCode:e.seat.get("currencyCode"),section:e.section,segment:e.segment})},loadPreselectedSeats:function(e){_.each(e,function(e){this.add(e)},this)},getConfirmActionTrackingText:function(){var e=this.options.numAdults+this.options.numChildren,t=Math.round(parseFloat(this.options.totalPrice)),i=Math.round(parseFloat(this.getSelectedSeatsPrice())),n=this.options.numberOfAvailableSeatmap;return"seat_selection_gds_selection_sel:"+this.getSelectedSeatsLength()+"_off:"+n+"_pax:"+e+"_pri:"+i+"_fli:"+t},getConfirmActionTrackingButton:function(e){return"seats_gds_save_and_continue_"+e},removeSelection:function(e){this.remove(e)},getNumSelectableSections:function(e){return _.size(_.filter(e,function(e){return e.isSelectable}))}});e.exports.getInstance=function(){return _.isUndefined(n)&&(n=new a),n}},function(e,t,i){"use strict";t.randomBytes=t.rng=t.pseudoRandomBytes=t.prng=i(23),t.createHash=t.Hash=i(29),t.createHmac=t.Hmac=i(111);var n=i(233),a=Object.keys(n),s=["sha1","sha224","sha256","sha384","sha512","md5","rmd160"].concat(a);t.getHashes=function(){return s};var r=i(114);t.pbkdf2=r.pbkdf2,t.pbkdf2Sync=r.pbkdf2Sync;var o=i(235);t.Cipher=o.Cipher,t.createCipher=o.createCipher,t.Cipheriv=o.Cipheriv,t.createCipheriv=o.createCipheriv,t.Decipher=o.Decipher,t.createDecipher=o.createDecipher,t.Decipheriv=o.Decipheriv,t.createDecipheriv=o.createDecipheriv,t.getCiphers=o.getCiphers,t.listCiphers=o.listCiphers;var c=i(253);t.DiffieHellmanGroup=c.DiffieHellmanGroup,t.createDiffieHellmanGroup=c.createDiffieHellmanGroup,t.getDiffieHellman=c.getDiffieHellman,t.createDiffieHellman=c.createDiffieHellman,t.DiffieHellman=c.DiffieHellman;var d=i(258);t.createSign=d.createSign,t.Sign=d.Sign,t.createVerify=d.createVerify,t.Verify=d.Verify,t.createECDH=i(296);var l=i(297);t.publicEncrypt=l.publicEncrypt,t.privateEncrypt=l.privateEncrypt,t.publicDecrypt=l.publicDecrypt,t.privateDecrypt=l.privateDecrypt;var g=i(300);t.randomFill=g.randomFill,t.randomFillSync=g.randomFillSync,t.createCredentials=function(){throw new Error(["sorry, createCredentials is not implemented yet","we accept pull requests","https://github.com/crypto-browserify/crypto-browserify"].join("\n"))},t.constants={DH_CHECK_P_NOT_SAFE_PRIME:2,DH_CHECK_P_NOT_PRIME:1,DH_UNABLE_TO_CHECK_GENERATOR:4,DH_NOT_SUITABLE_GENERATOR:8,NPN_ENABLED:1,ALPN_ENABLED:1,RSA_PKCS1_PADDING:1,RSA_SSLV23_PADDING:2,RSA_NO_PADDING:3,RSA_PKCS1_OAEP_PADDING:4,RSA_X931_PADDING:5,RSA_PKCS1_PSS_PADDING:6,POINT_CONVERSION_COMPRESSED:2,POINT_CONVERSION_UNCOMPRESSED:4,POINT_CONVERSION_HYBRID:6}},function(e,t){var i={}.toString;e.exports=Array.isArray||function(e){return"[object Array]"==i.call(e)}},function(e,t,i){"use strict";var n=i(2).Buffer,a=i(64).Transform;function s(e){a.call(this),this._block=n.allocUnsafe(e),this._blockSize=e,this._blockOffset=0,this._length=[0,0,0,0],this._finalized=!1}i(1)(s,a),s.prototype._transform=function(e,t,i){var n=null;try{this.update(e,t)}catch(e){n=e}i(n)},s.prototype._flush=function(e){var t=null;try{this.push(this.digest())}catch(e){t=e}e(t)},s.prototype.update=function(e,t){if(function(e,t){if(!n.isBuffer(e)&&"string"!=typeof e)throw new TypeError("Data must be a string or a buffer")}(e),this._finalized)throw new Error("Digest already called");n.isBuffer(e)||(e=n.from(e,t));for(var i=this._block,a=0;this._blockOffset+e.length-a>=this._blockSize;){for(var s=this._blockOffset;s<this._blockSize;)i[s++]=e[a++];this._update(),this._blockOffset=0}for(;a<e.length;)i[this._blockOffset++]=e[a++];for(var r=0,o=8*e.length;0<o;++r)this._length[r]+=o,0<(o=this._length[r]/4294967296|0)&&(this._length[r]-=4294967296*o);return this},s.prototype._update=function(){throw new Error("_update is not implemented")},s.prototype.digest=function(e){if(this._finalized)throw new Error("Digest already called");this._finalized=!0;var t=this._digest();void 0!==e&&(t=t.toString(e)),this._block.fill(0);for(var i=this._blockOffset=0;i<4;++i)this._length[i]=0;return t},s.prototype._digest=function(){throw new Error("_digest is not implemented")},e.exports=s},function(e,t,i){"use strict";(function(t,n){var a=i(44);e.exports=y;var s,r=i(103);y.ReadableState=b,i(65).EventEmitter;var o=function(e,t){return e.listeners(t).length},c=i(106),d=i(2).Buffer,l=t.Uint8Array||function(){},g=i(30);g.inherits=i(1);var h=i(216),u=void 0;u=h&&h.debuglog?h.debuglog("stream"):function(){};var p,f=i(217),m=i(107);g.inherits(y,c);var _=["error","close","destroy","pause","resume"];function b(e,t){e=e||{};var n=t instanceof(s=s||i(19));this.objectMode=!!e.objectMode,n&&(this.objectMode=this.objectMode||!!e.readableObjectMode);var a=e.highWaterMark,r=e.readableHighWaterMark,o=this.objectMode?16:16384;this.highWaterMark=a||0===a?a:n&&(r||0===r)?r:o,this.highWaterMark=Math.floor(this.highWaterMark),this.buffer=new f,this.length=0,this.pipes=null,this.pipesCount=0,this.flowing=null,this.ended=!1,this.endEmitted=!1,this.reading=!1,this.sync=!0,this.needReadable=!1,this.emittedReadable=!1,this.readableListening=!1,this.resumeScheduled=!1,this.destroyed=!1,this.defaultEncoding=e.defaultEncoding||"utf8",this.awaitDrain=0,this.readingMore=!1,this.decoder=null,this.encoding=null,e.encoding&&(p||(p=i(68).StringDecoder),this.decoder=new p(e.encoding),this.encoding=e.encoding)}function y(e){if(s=s||i(19),!(this instanceof y))return new y(e);this._readableState=new b(e,this),this.readable=!0,e&&("function"==typeof e.read&&(this._read=e.read),"function"==typeof e.destroy&&(this._destroy=e.destroy)),c.call(this)}function v(e,t,i,n,a){var s,r,o,c=e._readableState;return null===t?(c.reading=!1,function(e,t){if(!t.ended){if(t.decoder){var i=t.decoder.end();i&&i.length&&(t.buffer.push(i),t.length+=t.objectMode?1:i.length)}t.ended=!0,O(e)}}(e,c)):(a||(s=function(e,t){var i,n;return n=t,d.isBuffer(n)||n instanceof l||"string"==typeof t||void 0===t||e.objectMode||(i=new TypeError("Invalid non-string/buffer chunk")),i}(c,t)),s?e.emit("error",s):c.objectMode||t&&0<t.length?("string"==typeof t||c.objectMode||Object.getPrototypeOf(t)===d.prototype||(r=t,t=d.from(r)),n?c.endEmitted?e.emit("error",new Error("stream.unshift() after end event")):S(e,c,t,!0):c.ended?e.emit("error",new Error("stream.push() after EOF")):(c.reading=!1,c.decoder&&!i?(t=c.decoder.write(t),c.objectMode||0!==t.length?S(e,c,t,!1):P(e,c)):S(e,c,t,!1))):n||(c.reading=!1)),!(o=c).ended&&(o.needReadable||o.length<o.highWaterMark||0===o.length)}function S(e,t,i,n){t.flowing&&0===t.length&&!t.sync?(e.emit("data",i),e.read(0)):(t.length+=t.objectMode?1:i.length,n?t.buffer.unshift(i):t.buffer.push(i),t.needReadable&&O(e)),P(e,t)}Object.defineProperty(y.prototype,"destroyed",{get:function(){return void 0!==this._readableState&&this._readableState.destroyed},set:function(e){this._readableState&&(this._readableState.destroyed=e)}}),y.prototype.destroy=m.destroy,y.prototype._undestroy=m.undestroy,y.prototype._destroy=function(e,t){this.push(null),t(e)},y.prototype.push=function(e,t){var i,n=this._readableState;return n.objectMode?i=!0:"string"==typeof e&&((t=t||n.defaultEncoding)!==n.encoding&&(e=d.from(e,t),t=""),i=!0),v(this,e,t,!1,i)},y.prototype.unshift=function(e){return v(this,e,null,!0,!1)},y.prototype.isPaused=function(){return!1===this._readableState.flowing},y.prototype.setEncoding=function(e){return p||(p=i(68).StringDecoder),this._readableState.decoder=new p(e),this._readableState.encoding=e,this};var C=8388608;function w(e,t){return e<=0||0===t.length&&t.ended?0:t.objectMode?1:e!=e?t.flowing&&t.length?t.buffer.head.data.length:t.length:(e>t.highWaterMark&&(t.highWaterMark=(C<=(i=e)?i=C:(i--,i|=i>>>1,i|=i>>>2,i|=i>>>4,i|=i>>>8,i|=i>>>16,i++),i)),e<=t.length?e:t.ended?t.length:(t.needReadable=!0,0));var i}function O(e){var t=e._readableState;t.needReadable=!1,t.emittedReadable||(u("emitReadable",t.flowing),t.emittedReadable=!0,t.sync?a.nextTick(T,e):T(e))}function T(e){u("emit readable"),e.emit("readable"),D(e)}function P(e,t){t.readingMore||(t.readingMore=!0,a.nextTick(E,e,t))}function E(e,t){for(var i=t.length;!t.reading&&!t.flowing&&!t.ended&&t.length<t.highWaterMark&&(u("maybeReadMore read 0"),e.read(0),i!==t.length);)i=t.length;t.readingMore=!1}function k(e){u("readable nexttick read 0"),e.read(0)}function A(e,t){t.reading||(u("resume read 0"),e.read(0)),t.resumeScheduled=!1,t.awaitDrain=0,e.emit("resume"),D(e),t.flowing&&!t.reading&&e.read(0)}function D(e){var t=e._readableState;for(u("flow",t.flowing);t.flowing&&null!==e.read(););}function I(e,t){return 0===t.length?null:(t.objectMode?i=t.buffer.shift():!e||e>=t.length?(i=t.decoder?t.buffer.join(""):1===t.buffer.length?t.buffer.head.data:t.buffer.concat(t.length),t.buffer.clear()):i=function(e,t,i){var n;return e<t.head.data.length?(n=t.head.data.slice(0,e),t.head.data=t.head.data.slice(e)):n=e===t.head.data.length?t.shift():i?function(e,t){var i=t.head,n=1,a=i.data;for(e-=a.length;i=i.next;){var s=i.data,r=e>s.length?s.length:e;if(r===s.length?a+=s:a+=s.slice(0,e),0==(e-=r)){r===s.length?(++n,i.next?t.head=i.next:t.head=t.tail=null):(t.head=i).data=s.slice(r);break}++n}return t.length-=n,a}(e,t):function(e,t){var i=d.allocUnsafe(e),n=t.head,a=1;for(n.data.copy(i),e-=n.data.length;n=n.next;){var s=n.data,r=e>s.length?s.length:e;if(s.copy(i,i.length-e,0,r),0==(e-=r)){r===s.length?(++a,n.next?t.head=n.next:t.head=t.tail=null):(t.head=n).data=s.slice(r);break}++a}return t.length-=a,i}(e,t),n}(e,t.buffer,t.decoder),i);var i}function x(e){var t=e._readableState;if(0<t.length)throw new Error('"endReadable()" called on non-empty stream');t.endEmitted||(t.ended=!0,a.nextTick(B,t,e))}function B(e,t){e.endEmitted||0!==e.length||(e.endEmitted=!0,t.readable=!1,t.emit("end"))}function R(e,t){for(var i=0,n=e.length;i<n;i++)if(e[i]===t)return i;return-1}y.prototype.read=function(e){u("read",e),e=parseInt(e,10);var t=this._readableState,i=e;if(0!==e&&(t.emittedReadable=!1),0===e&&t.needReadable&&(t.length>=t.highWaterMark||t.ended))return u("read: emitReadable",t.length,t.ended),0===t.length&&t.ended?x(this):O(this),null;if(0===(e=w(e,t))&&t.ended)return 0===t.length&&x(this),null;var n,a=t.needReadable;return u("need readable",a),(0===t.length||t.length-e<t.highWaterMark)&&u("length less than watermark",a=!0),t.ended||t.reading?u("reading or ended",a=!1):a&&(u("do read"),t.reading=!0,t.sync=!0,0===t.length&&(t.needReadable=!0),this._read(t.highWaterMark),t.sync=!1,t.reading||(e=w(i,t))),null===(n=0<e?I(e,t):null)?(t.needReadable=!0,e=0):t.length-=e,0===t.length&&(t.ended||(t.needReadable=!0),i!==e&&t.ended&&x(this)),null!==n&&this.emit("data",n),n},y.prototype._read=function(e){this.emit("error",new Error("_read() is not implemented"))},y.prototype.pipe=function(e,t){var i=this,s=this._readableState;switch(s.pipesCount){case 0:s.pipes=e;break;case 1:s.pipes=[s.pipes,e];break;default:s.pipes.push(e)}s.pipesCount+=1,u("pipe count=%d opts=%j",s.pipesCount,t);var c=t&&!1===t.end||e===n.stdout||e===n.stderr?y:d;function d(){u("onend"),e.end()}s.endEmitted?a.nextTick(c):i.once("end",c),e.on("unpipe",function t(n,a){u("onunpipe"),n===i&&a&&!1===a.hasUnpiped&&(a.hasUnpiped=!0,u("cleanup"),e.removeListener("close",_),e.removeListener("finish",b),e.removeListener("drain",g),e.removeListener("error",m),e.removeListener("unpipe",t),i.removeListener("end",d),i.removeListener("end",y),i.removeListener("data",f),h=!0,!s.awaitDrain||e._writableState&&!e._writableState.needDrain||g())});var l,g=(l=i,function(){var e=l._readableState;u("pipeOnDrain",e.awaitDrain),e.awaitDrain&&e.awaitDrain--,0===e.awaitDrain&&o(l,"data")&&(e.flowing=!0,D(l))});e.on("drain",g);var h=!1,p=!1;function f(t){u("ondata"),(p=!1)!==e.write(t)||p||((1===s.pipesCount&&s.pipes===e||1<s.pipesCount&&-1!==R(s.pipes,e))&&!h&&(u("false write response, pause",i._readableState.awaitDrain),i._readableState.awaitDrain++,p=!0),i.pause())}function m(t){u("onerror",t),y(),e.removeListener("error",m),0===o(e,"error")&&e.emit("error",t)}function _(){e.removeListener("finish",b),y()}function b(){u("onfinish"),e.removeListener("close",_),y()}function y(){u("unpipe"),i.unpipe(e)}return i.on("data",f),function(e,t,i){if("function"==typeof e.prependListener)return e.prependListener(t,i);e._events&&e._events[t]?r(e._events[t])?e._events[t].unshift(i):e._events[t]=[i,e._events[t]]:e.on(t,i)}(e,"error",m),e.once("close",_),e.once("finish",b),e.emit("pipe",i),s.flowing||(u("pipe resume"),i.resume()),e},y.prototype.unpipe=function(e){var t=this._readableState,i={hasUnpiped:!1};if(0===t.pipesCount)return this;if(1===t.pipesCount)return e&&e!==t.pipes||(e||(e=t.pipes),t.pipes=null,t.pipesCount=0,t.flowing=!1,e&&e.emit("unpipe",this,i)),this;if(!e){var n=t.pipes,a=t.pipesCount;t.pipes=null,t.pipesCount=0,t.flowing=!1;for(var s=0;s<a;s++)n[s].emit("unpipe",this,i);return this}var r=R(t.pipes,e);return-1===r||(t.pipes.splice(r,1),t.pipesCount-=1,1===t.pipesCount&&(t.pipes=t.pipes[0]),e.emit("unpipe",this,i)),this},y.prototype.addListener=y.prototype.on=function(e,t){var i=c.prototype.on.call(this,e,t);if("data"===e)!1!==this._readableState.flowing&&this.resume();else if("readable"===e){var n=this._readableState;n.endEmitted||n.readableListening||(n.readableListening=n.needReadable=!0,n.emittedReadable=!1,n.reading?n.length&&O(this):a.nextTick(k,this))}return i},y.prototype.resume=function(){var e,t=this._readableState;return t.flowing||(u("resume"),t.flowing=!0,this,(e=t).resumeScheduled||(e.resumeScheduled=!0,a.nextTick(A,this,e))),this},y.prototype.pause=function(){return u("call pause flowing=%j",this._readableState.flowing),!1!==this._readableState.flowing&&(u("pause"),this._readableState.flowing=!1,this.emit("pause")),this},y.prototype.wrap=function(e){var t=this,i=this._readableState,n=!1;for(var a in e.on("end",function(){if(u("wrapped end"),i.decoder&&!i.ended){var e=i.decoder.end();e&&e.length&&t.push(e)}t.push(null)}),e.on("data",function(a){u("wrapped data"),i.decoder&&(a=i.decoder.write(a)),i.objectMode&&null==a||(i.objectMode||a&&a.length)&&(t.push(a)||(n=!0,e.pause()))}),e)void 0===this[a]&&"function"==typeof e[a]&&(this[a]=function(t){return function(){return e[t].apply(e,arguments)}}(a));for(var s=0;s<_.length;s++)e.on(_[s],this.emit.bind(this,_[s]));return this._read=function(t){u("wrapped _read",t),n&&(n=!1,e.resume())},this},y._fromList=I}).call(this,i(12),i(16))},function(e,t,i){e.exports=i(65).EventEmitter},function(e,t,i){"use strict";var n=i(44);function a(e,t){e.emit("error",t)}e.exports={destroy:function(e,t){var i=this,s=this._readableState&&this._readableState.destroyed,r=this._writableState&&this._writableState.destroyed;return s||r?t?t(e):!e||this._writableState&&this._writableState.errorEmitted||n.nextTick(a,this,e):(this._readableState&&(this._readableState.destroyed=!0),this._writableState&&(this._writableState.destroyed=!0),this._destroy(e||null,function(e){!t&&e?(n.nextTick(a,i,e),i._writableState&&(i._writableState.errorEmitted=!0)):t&&t(e)})),this},undestroy:function(){this._readableState&&(this._readableState.destroyed=!1,this._readableState.reading=!1,this._readableState.ended=!1,this._readableState.endEmitted=!1),this._writableState&&(this._writableState.destroyed=!1,this._writableState.ended=!1,this._writableState.ending=!1,this._writableState.finished=!1,this._writableState.errorEmitted=!1)}}},function(e,t,i){"use strict";e.exports=s;var n=i(19),a=i(30);function s(e){if(!(this instanceof s))return new s(e);n.call(this,e),this._transformState={afterTransform:function(e,t){var i=this._transformState;i.transforming=!1;var n=i.writecb;if(!n)return this.emit("error",new Error("write callback called multiple times"));i.writechunk=null,(i.writecb=null)!=t&&this.push(t),n(e);var a=this._readableState;a.reading=!1,(a.needReadable||a.length<a.highWaterMark)&&this._read(a.highWaterMark)}.bind(this),needTransform:!1,transforming:!1,writecb:null,writechunk:null,writeencoding:null},this._readableState.needReadable=!0,this._readableState.sync=!1,e&&("function"==typeof e.transform&&(this._transform=e.transform),"function"==typeof e.flush&&(this._flush=e.flush)),this.on("prefinish",r)}function r(){var e=this;"function"==typeof this._flush?this._flush(function(t,i){o(e,t,i)}):o(this,null,null)}function o(e,t,i){if(t)return e.emit("error",t);if(null!=i&&e.push(i),e._writableState.length)throw new Error("Calling transform done when ws.length != 0");if(e._transformState.transforming)throw new Error("Calling transform done when still transforming");return e.push(null)}a.inherits=i(1),a.inherits(s,n),s.prototype.push=function(e,t){return this._transformState.needTransform=!1,n.prototype.push.call(this,e,t)},s.prototype._transform=function(e,t,i){throw new Error("_transform() is not implemented")},s.prototype._write=function(e,t,i){var n=this._transformState;if(n.writecb=i,n.writechunk=e,n.writeencoding=t,!n.transforming){var a=this._readableState;(n.needTransform||a.needReadable||a.length<a.highWaterMark)&&this._read(a.highWaterMark)}},s.prototype._read=function(e){var t=this._transformState;null!==t.writechunk&&t.writecb&&!t.transforming?(t.transforming=!0,this._transform(t.writechunk,t.writeencoding,t.afterTransform)):t.needTransform=!0},s.prototype._destroy=function(e,t){var i=this;n.prototype._destroy.call(this,e,function(e){t(e),i.emit("close")})}},function(e,t,i){var n=i(1),a=i(24),s=i(2).Buffer,r=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298],o=new Array(64);function c(){this.init(),this._w=o,a.call(this,64,56)}n(c,a),c.prototype.init=function(){return this._a=1779033703,this._b=3144134277,this._c=1013904242,this._d=2773480762,this._e=1359893119,this._f=2600822924,this._g=528734635,this._h=1541459225,this},c.prototype._update=function(e){for(var t,i,n,a,s,o,c,d=this._w,l=0|this._a,g=0|this._b,h=0|this._c,u=0|this._d,p=0|this._e,f=0|this._f,m=0|this._g,_=0|this._h,b=0;b<16;++b)d[b]=e.readInt32BE(4*b);for(;b<64;++b)d[b]=0|(((i=d[b-2])>>>17|i<<15)^(i>>>19|i<<13)^i>>>10)+d[b-7]+(((t=d[b-15])>>>7|t<<25)^(t>>>18|t<<14)^t>>>3)+d[b-16];for(var y=0;y<64;++y){var v=_+(((c=p)>>>6|c<<26)^(c>>>11|c<<21)^(c>>>25|c<<7))+((o=m)^p&(f^o))+r[y]+d[y]|0,S=0|(((s=l)>>>2|s<<30)^(s>>>13|s<<19)^(s>>>22|s<<10))+((n=l)&(a=g)|h&(n|a));_=m,m=f,f=p,p=u+v|0,u=h,h=g,g=l,l=v+S|0}this._a=l+this._a|0,this._b=g+this._b|0,this._c=h+this._c|0,this._d=u+this._d|0,this._e=p+this._e|0,this._f=f+this._f|0,this._g=m+this._g|0,this._h=_+this._h|0},c.prototype._hash=function(){var e=s.allocUnsafe(32);return e.writeInt32BE(this._a,0),e.writeInt32BE(this._b,4),e.writeInt32BE(this._c,8),e.writeInt32BE(this._d,12),e.writeInt32BE(this._e,16),e.writeInt32BE(this._f,20),e.writeInt32BE(this._g,24),e.writeInt32BE(this._h,28),e},e.exports=c},function(e,t,i){var n=i(1),a=i(24),s=i(2).Buffer,r=[1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591],o=new Array(160);function c(){this.init(),this._w=o,a.call(this,128,112)}function d(e,t,i){return i^e&(t^i)}function l(e,t,i){return e&t|i&(e|t)}function g(e,t){return(e>>>28|t<<4)^(t>>>2|e<<30)^(t>>>7|e<<25)}function h(e,t){return(e>>>14|t<<18)^(e>>>18|t<<14)^(t>>>9|e<<23)}function u(e,t){return e>>>0<t>>>0?1:0}n(c,a),c.prototype.init=function(){return this._ah=1779033703,this._bh=3144134277,this._ch=1013904242,this._dh=2773480762,this._eh=1359893119,this._fh=2600822924,this._gh=528734635,this._hh=1541459225,this._al=4089235720,this._bl=2227873595,this._cl=4271175723,this._dl=1595750129,this._el=2917565137,this._fl=725511199,this._gl=4215389547,this._hl=327033209,this},c.prototype._update=function(e){for(var t,i,n,a,s,o,c,p,f=this._w,m=0|this._ah,_=0|this._bh,b=0|this._ch,y=0|this._dh,v=0|this._eh,S=0|this._fh,C=0|this._gh,w=0|this._hh,O=0|this._al,T=0|this._bl,P=0|this._cl,E=0|this._dl,k=0|this._el,A=0|this._fl,D=0|this._gl,I=0|this._hl,x=0;x<32;x+=2)f[x]=e.readInt32BE(4*x),f[x+1]=e.readInt32BE(4*x+4);for(;x<160;x+=2){var B=f[x-30],R=f[x-30+1],M=((c=B)>>>1|(p=R)<<31)^(c>>>8|p<<24)^c>>>7,N=((s=R)>>>1|(o=B)<<31)^(s>>>8|o<<24)^(s>>>7|o<<25),L=((n=B=f[x-4])>>>19|(a=R=f[x-4+1])<<13)^(a>>>29|n<<3)^n>>>6,U=((t=R)>>>19|(i=B)<<13)^(i>>>29|t<<3)^(t>>>6|i<<26),F=f[x-14],$=f[x-14+1],W=f[x-32],H=f[x-32+1],q=N+$|0,V=M+F+u(q,N)|0;V=(V=V+L+u(q=q+U|0,U)|0)+W+u(q=q+H|0,H)|0,f[x]=V,f[x+1]=q}for(var G=0;G<160;G+=2){V=f[G],q=f[G+1];var j=l(m,_,b),K=l(O,T,P),z=g(m,O),Y=g(O,m),X=h(v,k),J=h(k,v),Q=r[G],Z=r[G+1],ee=d(v,S,C),te=d(k,A,D),ie=I+J|0,ne=w+X+u(ie,I)|0;ne=(ne=(ne=ne+ee+u(ie=ie+te|0,te)|0)+Q+u(ie=ie+Z|0,Z)|0)+V+u(ie=ie+q|0,q)|0;var ae=Y+K|0,se=z+j+u(ae,Y)|0;w=C,I=D,C=S,D=A,S=v,A=k,v=y+ne+u(k=E+ie|0,E)|0,y=b,E=P,b=_,P=T,_=m,T=O,m=ne+se+u(O=ie+ae|0,ie)|0}this._al=this._al+O|0,this._bl=this._bl+T|0,this._cl=this._cl+P|0,this._dl=this._dl+E|0,this._el=this._el+k|0,this._fl=this._fl+A|0,this._gl=this._gl+D|0,this._hl=this._hl+I|0,this._ah=this._ah+m+u(this._al,O)|0,this._bh=this._bh+_+u(this._bl,T)|0,this._ch=this._ch+b+u(this._cl,P)|0,this._dh=this._dh+y+u(this._dl,E)|0,this._eh=this._eh+v+u(this._el,k)|0,this._fh=this._fh+S+u(this._fl,A)|0,this._gh=this._gh+C+u(this._gl,D)|0,this._hh=this._hh+w+u(this._hl,I)|0},c.prototype._hash=function(){var e=s.allocUnsafe(64);function t(t,i,n){e.writeInt32BE(t,n),e.writeInt32BE(i,n+4)}return t(this._ah,this._al,0),t(this._bh,this._bl,8),t(this._ch,this._cl,16),t(this._dh,this._dl,24),t(this._eh,this._el,32),t(this._fh,this._fl,40),t(this._gh,this._gl,48),t(this._hh,this._hl,56),e},e.exports=c},function(e,t,i){"use strict";var n=i(1),a=i(232),s=i(17),r=i(2).Buffer,o=i(112),c=i(69),d=i(70),l=r.alloc(128);function g(e,t){s.call(this,"digest"),"string"==typeof t&&(t=r.from(t));var i="sha512"===e||"sha384"===e?128:64;this._alg=e,(this._key=t).length>i?t=("rmd160"===e?new c:d(e)).update(t).digest():t.length<i&&(t=r.concat([t,l],i));for(var n=this._ipad=r.allocUnsafe(i),a=this._opad=r.allocUnsafe(i),o=0;o<i;o++)n[o]=54^t[o],a[o]=92^t[o];this._hash="rmd160"===e?new c:d(e),this._hash.update(n)}n(g,s),g.prototype._update=function(e){this._hash.update(e)},g.prototype._final=function(){var e=this._hash.digest();return("rmd160"===this._alg?new c:d(this._alg)).update(this._opad).update(e).digest()},e.exports=function(e,t){return"rmd160"===(e=e.toLowerCase())||"ripemd160"===e?new g("rmd160",t):"md5"===e?new a(o,t):new g(e,t)}},function(e,t,i){var n=i(63);e.exports=function(e){return(new n).update(e).digest()}},function(e){e.exports={sha224WithRSAEncryption:{sign:"rsa",hash:"sha224",id:"302d300d06096086480165030402040500041c"},"RSA-SHA224":{sign:"ecdsa/rsa",hash:"sha224",id:"302d300d06096086480165030402040500041c"},sha256WithRSAEncryption:{sign:"rsa",hash:"sha256",id:"3031300d060960864801650304020105000420"},"RSA-SHA256":{sign:"ecdsa/rsa",hash:"sha256",id:"3031300d060960864801650304020105000420"},sha384WithRSAEncryption:{sign:"rsa",hash:"sha384",id:"3041300d060960864801650304020205000430"},"RSA-SHA384":{sign:"ecdsa/rsa",hash:"sha384",id:"3041300d060960864801650304020205000430"},sha512WithRSAEncryption:{sign:"rsa",hash:"sha512",id:"3051300d060960864801650304020305000440"},"RSA-SHA512":{sign:"ecdsa/rsa",hash:"sha512",id:"3051300d060960864801650304020305000440"},"RSA-SHA1":{sign:"rsa",hash:"sha1",id:"3021300906052b0e03021a05000414"},"ecdsa-with-SHA1":{sign:"ecdsa",hash:"sha1",id:""},sha256:{sign:"ecdsa",hash:"sha256",id:""},sha224:{sign:"ecdsa",hash:"sha224",id:""},sha384:{sign:"ecdsa",hash:"sha384",id:""},sha512:{sign:"ecdsa",hash:"sha512",id:""},"DSA-SHA":{sign:"dsa",hash:"sha1",id:""},"DSA-SHA1":{sign:"dsa",hash:"sha1",id:""},DSA:{sign:"dsa",hash:"sha1",id:""},"DSA-WITH-SHA224":{sign:"dsa",hash:"sha224",id:""},"DSA-SHA224":{sign:"dsa",hash:"sha224",id:""},"DSA-WITH-SHA256":{sign:"dsa",hash:"sha256",id:""},"DSA-SHA256":{sign:"dsa",hash:"sha256",id:""},"DSA-WITH-SHA384":{sign:"dsa",hash:"sha384",id:""},"DSA-SHA384":{sign:"dsa",hash:"sha384",id:""},"DSA-WITH-SHA512":{sign:"dsa",hash:"sha512",id:""},"DSA-SHA512":{sign:"dsa",hash:"sha512",id:""},"DSA-RIPEMD160":{sign:"dsa",hash:"rmd160",id:""},ripemd160WithRSA:{sign:"rsa",hash:"rmd160",id:"3021300906052b2403020105000414"},"RSA-RIPEMD160":{sign:"rsa",hash:"rmd160",id:"3021300906052b2403020105000414"},md5WithRSAEncryption:{sign:"rsa",hash:"md5",id:"3020300c06082a864886f70d020505000410"},"RSA-MD5":{sign:"rsa",hash:"md5",id:"3020300c06082a864886f70d020505000410"}}},function(e,t,i){t.pbkdf2=i(234),t.pbkdf2Sync=i(117)},function(e,t,i){(function(t){var i=Math.pow(2,30)-1;function n(e,i){if("string"!=typeof e&&!t.isBuffer(e))throw new TypeError(i+" must be a buffer or string")}e.exports=function(e,t,a,s){if(n(e,"Password"),n(t,"Salt"),"number"!=typeof a)throw new TypeError("Iterations not a number");if(a<0)throw new TypeError("Bad iterations");if("number"!=typeof s)throw new TypeError("Key length not a number");if(s<0||i<s||s!=s)throw new TypeError("Bad key length")}}).call(this,i(3).Buffer)},function(e,t,i){(function(t){var i;i=t.browser?"utf-8":6<=parseInt(t.version.split(".")[0].slice(1),10)?"utf-8":"binary",e.exports=i}).call(this,i(16))},function(e,t,i){var n=i(112),a=i(69),s=i(70),r=i(115),o=i(116),c=i(2).Buffer,d=c.alloc(128),l={md5:16,sha1:20,sha224:28,sha256:32,sha384:48,sha512:64,rmd160:20,ripemd160:20};function g(e,t,i){var r,o="rmd160"===(r=e)||"ripemd160"===r?function(e){return(new a).update(e).digest()}:"md5"===r?n:function(e){return s(r).update(e).digest()},g="sha512"===e||"sha384"===e?128:64;t.length>g?t=o(t):t.length<g&&(t=c.concat([t,d],g));for(var h=c.allocUnsafe(g+l[e]),u=c.allocUnsafe(g+l[e]),p=0;p<g;p++)h[p]=54^t[p],u[p]=92^t[p];var f=c.allocUnsafe(g+i+4);h.copy(f,0,0,g),this.ipad1=f,this.ipad2=h,this.opad=u,this.alg=e,this.blocksize=g,this.hash=o,this.size=l[e]}g.prototype.run=function(e,t){return e.copy(t,this.blocksize),this.hash(t).copy(this.opad,this.blocksize),this.hash(this.opad)},e.exports=function(e,t,i,n,a){r(e,t,i,n),c.isBuffer(e)||(e=c.from(e,o)),c.isBuffer(t)||(t=c.from(t,o));var s=new g(a=a||"sha1",e,t.length),d=c.allocUnsafe(n),h=c.allocUnsafe(t.length+4);t.copy(h,0,0,t.length);for(var u=0,p=l[a],f=Math.ceil(n/p),m=1;m<=f;m++){h.writeUInt32BE(m,t.length);for(var _=s.run(h,s.ipad1),b=_,y=1;y<i;y++){b=s.run(b,s.ipad2);for(var v=0;v<p;v++)_[v]^=b[v]}_.copy(d,u),u+=p}return d}},function(e,t,i){var n=i(31),a=i(2).Buffer,s=i(119);t.encrypt=function(e,t){var i,r,o=Math.ceil(t.length/16),c=e._cache.length;e._cache=a.concat([e._cache,a.allocUnsafe(16*o)]);for(var d=0;d<o;d++){var l=(r=(i=e)._cipher.encryptBlockRaw(i._prev),s(i._prev),r),g=c+16*d;e._cache.writeUInt32BE(l[0],g+0),e._cache.writeUInt32BE(l[1],g+4),e._cache.writeUInt32BE(l[2],g+8),e._cache.writeUInt32BE(l[3],g+12)}var h=e._cache.slice(0,t.length);return e._cache=e._cache.slice(t.length),n(t,h)}},function(e,t){e.exports=function(e){for(var t,i=e.length;i--;){if(255!==(t=e.readUInt8(i))){t++,e.writeUInt8(t,i);break}e.writeUInt8(0,i)}}},function(e){e.exports={"aes-128-ecb":{cipher:"AES",key:128,iv:0,mode:"ECB",type:"block"},"aes-192-ecb":{cipher:"AES",key:192,iv:0,mode:"ECB",type:"block"},"aes-256-ecb":{cipher:"AES",key:256,iv:0,mode:"ECB",type:"block"},"aes-128-cbc":{cipher:"AES",key:128,iv:16,mode:"CBC",type:"block"},"aes-192-cbc":{cipher:"AES",key:192,iv:16,mode:"CBC",type:"block"},"aes-256-cbc":{cipher:"AES",key:256,iv:16,mode:"CBC",type:"block"},aes128:{cipher:"AES",key:128,iv:16,mode:"CBC",type:"block"},aes192:{cipher:"AES",key:192,iv:16,mode:"CBC",type:"block"},aes256:{cipher:"AES",key:256,iv:16,mode:"CBC",type:"block"},"aes-128-cfb":{cipher:"AES",key:128,iv:16,mode:"CFB",type:"stream"},"aes-192-cfb":{cipher:"AES",key:192,iv:16,mode:"CFB",type:"stream"},"aes-256-cfb":{cipher:"AES",key:256,iv:16,mode:"CFB",type:"stream"},"aes-128-cfb8":{cipher:"AES",key:128,iv:16,mode:"CFB8",type:"stream"},"aes-192-cfb8":{cipher:"AES",key:192,iv:16,mode:"CFB8",type:"stream"},"aes-256-cfb8":{cipher:"AES",key:256,iv:16,mode:"CFB8",type:"stream"},"aes-128-cfb1":{cipher:"AES",key:128,iv:16,mode:"CFB1",type:"stream"},"aes-192-cfb1":{cipher:"AES",key:192,iv:16,mode:"CFB1",type:"stream"},"aes-256-cfb1":{cipher:"AES",key:256,iv:16,mode:"CFB1",type:"stream"},"aes-128-ofb":{cipher:"AES",key:128,iv:16,mode:"OFB",type:"stream"},"aes-192-ofb":{cipher:"AES",key:192,iv:16,mode:"OFB",type:"stream"},"aes-256-ofb":{cipher:"AES",key:256,iv:16,mode:"OFB",type:"stream"},"aes-128-ctr":{cipher:"AES",key:128,iv:16,mode:"CTR",type:"stream"},"aes-192-ctr":{cipher:"AES",key:192,iv:16,mode:"CTR",type:"stream"},"aes-256-ctr":{cipher:"AES",key:256,iv:16,mode:"CTR",type:"stream"},"aes-128-gcm":{cipher:"AES",key:128,iv:12,mode:"GCM",type:"auth"},"aes-192-gcm":{cipher:"AES",key:192,iv:12,mode:"GCM",type:"auth"},"aes-256-gcm":{cipher:"AES",key:256,iv:12,mode:"GCM",type:"auth"}}},function(e,t,i){var n=i(45),a=i(2).Buffer,s=i(17),r=i(1),o=i(250),c=i(31),d=i(119);function l(e,t,i,r){s.call(this);var c=a.alloc(4,0);this._cipher=new n.AES(t);var l=this._cipher.encryptBlock(c);this._ghash=new o(l),i=function(e,t,i){if(12===t.length)return e._finID=a.concat([t,a.from([0,0,0,1])]),a.concat([t,a.from([0,0,0,2])]);var n=new o(i),s=t.length,r=s%16;n.update(t),r&&(r=16-r,n.update(a.alloc(r,0))),n.update(a.alloc(8,0));var c=8*s,l=a.alloc(8);l.writeUIntBE(c,0,8),n.update(l),e._finID=n.state;var g=a.from(e._finID);return d(g),g}(this,i,l),this._prev=a.from(i),this._cache=a.allocUnsafe(0),this._secCache=a.allocUnsafe(0),this._decrypt=r,this._alen=0,this._len=0,this._mode=e,this._authTag=null,this._called=!1}r(l,s),l.prototype._update=function(e){if(!this._called&&this._alen){var t=16-this._alen%16;t<16&&(t=a.alloc(t,0),this._ghash.update(t))}this._called=!0;var i=this._mode.encrypt(this,e);return this._decrypt?this._ghash.update(e):this._ghash.update(i),this._len+=e.length,i},l.prototype._final=function(){if(this._decrypt&&!this._authTag)throw new Error("Unsupported state or unable to authenticate data");var e=c(this._ghash.final(8*this._alen,8*this._len),this._cipher.encryptBlock(this._finID));if(this._decrypt&&function(e,t){var i=0;e.length!==t.length&&i++;for(var n=Math.min(e.length,t.length),a=0;a<n;++a)i+=e[a]^t[a];return i}(e,this._authTag))throw new Error("Unsupported state or unable to authenticate data");this._authTag=e,this._cipher.scrub()},l.prototype.getAuthTag=function(){if(this._decrypt||!a.isBuffer(this._authTag))throw new Error("Attempting to get auth tag in unsupported state");return this._authTag},l.prototype.setAuthTag=function(e){if(!this._decrypt)throw new Error("Attempting to set auth tag in unsupported state");this._authTag=e},l.prototype.setAAD=function(e){if(this._called)throw new Error("Attempting to set AAD in unsupported state");this._ghash.update(e),this._alen+=e.length},e.exports=l},function(e,t,i){var n=i(45),a=i(2).Buffer,s=i(17);function r(e,t,i,r){s.call(this),this._cipher=new n.AES(t),this._prev=a.from(i),this._cache=a.allocUnsafe(0),this._secCache=a.allocUnsafe(0),this._decrypt=r,this._mode=e}i(1)(r,s),r.prototype._update=function(e){return this._mode.encrypt(this,e,this._decrypt)},r.prototype._final=function(){this._cipher.scrub()},e.exports=r},function(e,t,i){var n=i(23);(e.exports=_).simpleSieve=f,_.fermatTest=m;var a=i(4),s=new a(24),r=new(i(124)),o=new a(1),c=new a(2),d=new a(5),l=(new a(16),new a(8),new a(10)),g=new a(3),h=(new a(7),new a(11)),u=new a(4),p=(new a(12),null);function f(e){for(var t=function(){if(null!==p)return p;var e=[];e[0]=2;for(var t=1,i=3;i<1048576;i+=2){for(var n=Math.ceil(Math.sqrt(i)),a=0;a<t&&e[a]<=n&&i%e[a]!=0;a++);t!==a&&e[a]<=n||(e[t++]=i)}return p=e}(),i=0;i<t.length;i++)if(0===e.modn(t[i]))return 0===e.cmpn(t[i]);return!0}function m(e){var t=a.mont(e);return 0===c.toRed(t).redPow(e.subn(1)).fromRed().cmpn(1)}function _(e,t){if(e<16)return new a(2===t||5===t?[140,123]:[140,39]);var i,p;for(t=new a(t);;){for(i=new a(n(Math.ceil(e/8)));i.bitLength()>e;)i.ishrn(1);if(i.isEven()&&i.iadd(o),i.testn(1)||i.iadd(c),t.cmp(c)){if(!t.cmp(d))for(;i.mod(l).cmp(g);)i.iadd(u)}else for(;i.mod(s).cmp(h);)i.iadd(u);if(f(p=i.shrn(1))&&f(i)&&m(p)&&m(i)&&r.test(p)&&r.test(i))return i}}},function(e,t,i){var n=i(4),a=i(125);function s(e){this.rand=e||new a.Rand}(e.exports=s).create=function(e){return new s(e)},s.prototype._randbelow=function(e){var t=e.bitLength(),i=Math.ceil(t/8);do{var a=new n(this.rand.generate(i))}while(0<=a.cmp(e));return a},s.prototype._randrange=function(e,t){var i=t.sub(e);return e.add(this._randbelow(i))},s.prototype.test=function(e,t,i){var a=e.bitLength(),s=n.mont(e),r=new n(1).toRed(s);t||(t=Math.max(1,a/48|0));for(var o=e.subn(1),c=0;!o.testn(c);c++);for(var d=e.shrn(c),l=o.toRed(s);0<t;t--){var g=this._randrange(new n(2),o);i&&i(g);var h=g.toRed(s).redPow(d);if(0!==h.cmp(r)&&0!==h.cmp(l)){for(var u=1;u<c;u++){if(0===(h=h.redSqr()).cmp(r))return!1;if(0===h.cmp(l))break}if(u===c)return!1}}return!0},s.prototype.getDivisor=function(e,t){var i=e.bitLength(),a=n.mont(e),s=new n(1).toRed(a);t||(t=Math.max(1,i/48|0));for(var r=e.subn(1),o=0;!r.testn(o);o++);for(var c=e.shrn(o),d=r.toRed(a);0<t;t--){var l=this._randrange(new n(2),r),g=e.gcd(l);if(0!==g.cmpn(1))return g;var h=l.toRed(a).redPow(c);if(0!==h.cmp(s)&&0!==h.cmp(d)){for(var u=1;u<o;u++){if(0===(h=h.redSqr()).cmp(s))return h.fromRed().subn(1).gcd(e);if(0===h.cmp(d))break}if(u===o)return(h=h.redSqr()).fromRed().subn(1).gcd(e)}}return!1}},function(e,t,i){var n;function a(e){this.rand=e}if(e.exports=function(e){return n||(n=new a(null)),n.generate(e)},(e.exports.Rand=a).prototype.generate=function(e){return this._rand(e)},a.prototype._rand=function(e){if(this.rand.getBytes)return this.rand.getBytes(e);for(var t=new Uint8Array(e),i=0;i<t.length;i++)t[i]=this.rand.getByte();return t},"object"==typeof self)self.crypto&&self.crypto.getRandomValues?a.prototype._rand=function(e){var t=new Uint8Array(e);return self.crypto.getRandomValues(t),t}:self.msCrypto&&self.msCrypto.getRandomValues?a.prototype._rand=function(e){var t=new Uint8Array(e);return self.msCrypto.getRandomValues(t),t}:"object"==typeof window&&(a.prototype._rand=function(){throw new Error("Not implemented yet")});else try{var s=i(255);if("function"!=typeof s.randomBytes)throw new Error("Not supported");a.prototype._rand=function(e){return s.randomBytes(e)}}catch(e){}},function(e,t,i){"use strict";var n=t;function a(e){return 1===e.length?"0"+e:e}function s(e){for(var t="",i=0;i<e.length;i++)t+=a(e[i].toString(16));return t}n.toArray=function(e,t){if(Array.isArray(e))return e.slice();if(!e)return[];var i=[];if("string"!=typeof e){for(var n=0;n<e.length;n++)i[n]=0|e[n];return i}if("hex"===t)for((e=e.replace(/[^a-z0-9]+/gi,"")).length%2!=0&&(e="0"+e),n=0;n<e.length;n+=2)i.push(parseInt(e[n]+e[n+1],16));else for(n=0;n<e.length;n++){var a=e.charCodeAt(n),s=a>>8,r=255&a;s?i.push(s,r):i.push(r)}return i},n.zero2=a,n.toHex=s,n.encode=function(e,t){return"hex"===t?s(e):e}},function(e,t,i){"use strict";var n=i(11).rotr32;function a(e,t,i){return e&t^~e&i}function s(e,t,i){return e&t^e&i^t&i}function r(e,t,i){return e^t^i}t.ft_1=function(e,t,i,n){return 0===e?a(t,i,n):1===e||3===e?r(t,i,n):2===e?s(t,i,n):void 0},t.ch32=a,t.maj32=s,t.p32=r,t.s0_256=function(e){return n(e,2)^n(e,13)^n(e,22)},t.s1_256=function(e){return n(e,6)^n(e,11)^n(e,25)},t.g0_256=function(e){return n(e,7)^n(e,18)^e>>>3},t.g1_256=function(e){return n(e,17)^n(e,19)^e>>>10}},function(e,t,i){"use strict";var n=i(11),a=i(32),s=i(127),r=i(8),o=n.sum32,c=n.sum32_4,d=n.sum32_5,l=s.ch32,g=s.maj32,h=s.s0_256,u=s.s1_256,p=s.g0_256,f=s.g1_256,m=a.BlockHash,_=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298];function b(){if(!(this instanceof b))return new b;m.call(this),this.h=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225],this.k=_,this.W=new Array(64)}n.inherits(b,m),(e.exports=b).blockSize=512,b.outSize=256,b.hmacStrength=192,b.padLength=64,b.prototype._update=function(e,t){for(var i=this.W,n=0;n<16;n++)i[n]=e[t+n];for(;n<i.length;n++)i[n]=c(f(i[n-2]),i[n-7],p(i[n-15]),i[n-16]);var a=this.h[0],s=this.h[1],m=this.h[2],_=this.h[3],b=this.h[4],y=this.h[5],v=this.h[6],S=this.h[7];for(r(this.k.length===i.length),n=0;n<i.length;n++){var C=d(S,u(b),l(b,y,v),this.k[n],i[n]),w=o(h(a),g(a,s,m));S=v,v=y,y=b,b=o(_,C),_=m,m=s,s=a,a=o(C,w)}this.h[0]=o(this.h[0],a),this.h[1]=o(this.h[1],s),this.h[2]=o(this.h[2],m),this.h[3]=o(this.h[3],_),this.h[4]=o(this.h[4],b),this.h[5]=o(this.h[5],y),this.h[6]=o(this.h[6],v),this.h[7]=o(this.h[7],S)},b.prototype._digest=function(e){return"hex"===e?n.toHex32(this.h,"big"):n.split32(this.h,"big")}},function(e,t,i){"use strict";var n=i(11),a=i(32),s=i(8),r=n.rotr64_hi,o=n.rotr64_lo,c=n.shr64_hi,d=n.shr64_lo,l=n.sum64,g=n.sum64_hi,h=n.sum64_lo,u=n.sum64_4_hi,p=n.sum64_4_lo,f=n.sum64_5_hi,m=n.sum64_5_lo,_=a.BlockHash,b=[1116352408,3609767458,1899447441,602891725,3049323471,3964484399,3921009573,2173295548,961987163,4081628472,1508970993,3053834265,2453635748,2937671579,2870763221,3664609560,3624381080,2734883394,310598401,1164996542,607225278,1323610764,1426881987,3590304994,1925078388,4068182383,2162078206,991336113,2614888103,633803317,3248222580,3479774868,3835390401,2666613458,4022224774,944711139,264347078,2341262773,604807628,2007800933,770255983,1495990901,1249150122,1856431235,1555081692,3175218132,1996064986,2198950837,2554220882,3999719339,2821834349,766784016,2952996808,2566594879,3210313671,3203337956,3336571891,1034457026,3584528711,2466948901,113926993,3758326383,338241895,168717936,666307205,1188179964,773529912,1546045734,1294757372,1522805485,1396182291,2643833823,1695183700,2343527390,1986661051,1014477480,2177026350,1206759142,2456956037,344077627,2730485921,1290863460,2820302411,3158454273,3259730800,3505952657,3345764771,106217008,3516065817,3606008344,3600352804,1432725776,4094571909,1467031594,275423344,851169720,430227734,3100823752,506948616,1363258195,659060556,3750685593,883997877,3785050280,958139571,3318307427,1322822218,3812723403,1537002063,2003034995,1747873779,3602036899,1955562222,1575990012,2024104815,1125592928,2227730452,2716904306,2361852424,442776044,2428436474,593698344,2756734187,3733110249,3204031479,2999351573,3329325298,3815920427,3391569614,3928383900,3515267271,566280711,3940187606,3454069534,4118630271,4000239992,116418474,1914138554,174292421,2731055270,289380356,3203993006,460393269,320620315,685471733,587496836,852142971,1086792851,1017036298,365543100,1126000580,2618297676,1288033470,3409855158,1501505948,4234509866,1607167915,987167468,1816402316,1246189591];function y(){if(!(this instanceof y))return new y;_.call(this),this.h=[1779033703,4089235720,3144134277,2227873595,1013904242,4271175723,2773480762,1595750129,1359893119,2917565137,2600822924,725511199,528734635,4215389547,1541459225,327033209],this.k=b,this.W=new Array(160)}function v(e,t,i,n,a){var s=e&i^~e&a;return s<0&&(s+=4294967296),s}function S(e,t,i,n,a,s){var r=t&n^~t&s;return r<0&&(r+=4294967296),r}function C(e,t,i,n,a){var s=e&i^e&a^i&a;return s<0&&(s+=4294967296),s}function w(e,t,i,n,a,s){var r=t&n^t&s^n&s;return r<0&&(r+=4294967296),r}function O(e,t){var i=r(e,t,28)^r(t,e,2)^r(t,e,7);return i<0&&(i+=4294967296),i}function T(e,t){var i=o(e,t,28)^o(t,e,2)^o(t,e,7);return i<0&&(i+=4294967296),i}function P(e,t){var i=r(e,t,14)^r(e,t,18)^r(t,e,9);return i<0&&(i+=4294967296),i}function E(e,t){var i=o(e,t,14)^o(e,t,18)^o(t,e,9);return i<0&&(i+=4294967296),i}function k(e,t){var i=r(e,t,1)^r(e,t,8)^c(e,t,7);return i<0&&(i+=4294967296),i}function A(e,t){var i=o(e,t,1)^o(e,t,8)^d(e,t,7);return i<0&&(i+=4294967296),i}function D(e,t){var i=r(e,t,19)^r(t,e,29)^c(e,t,6);return i<0&&(i+=4294967296),i}function I(e,t){var i=o(e,t,19)^o(t,e,29)^d(e,t,6);return i<0&&(i+=4294967296),i}n.inherits(y,_),(e.exports=y).blockSize=1024,y.outSize=512,y.hmacStrength=192,y.padLength=128,y.prototype._prepareBlock=function(e,t){for(var i=this.W,n=0;n<32;n++)i[n]=e[t+n];for(;n<i.length;n+=2){var a=D(i[n-4],i[n-3]),s=I(i[n-4],i[n-3]),r=i[n-14],o=i[n-13],c=k(i[n-30],i[n-29]),d=A(i[n-30],i[n-29]),l=i[n-32],g=i[n-31];i[n]=u(a,s,r,o,c,d,l,g),i[n+1]=p(a,s,r,o,c,d,l,g)}},y.prototype._update=function(e,t){this._prepareBlock(e,t);var i=this.W,n=this.h[0],a=this.h[1],r=this.h[2],o=this.h[3],c=this.h[4],d=this.h[5],u=this.h[6],p=this.h[7],_=this.h[8],b=this.h[9],y=this.h[10],k=this.h[11],A=this.h[12],D=this.h[13],I=this.h[14],x=this.h[15];s(this.k.length===i.length);for(var B=0;B<i.length;B+=2){var R=I,M=x,N=P(_,b),L=E(_,b),U=v(_,0,y,0,A),F=S(0,b,0,k,0,D),$=this.k[B],W=this.k[B+1],H=i[B],q=i[B+1],V=f(R,M,N,L,U,F,$,W,H,q),G=m(R,M,N,L,U,F,$,W,H,q);R=O(n,a),M=T(n,a),N=C(n,0,r,0,c),L=w(0,a,0,o,0,d);var j=g(R,M,N,L),K=h(R,M,N,L);I=A,x=D,A=y,D=k,y=_,k=b,_=g(u,p,V,G),b=h(p,p,V,G),u=c,p=d,c=r,d=o,r=n,o=a,n=g(V,G,j,K),a=h(V,G,j,K)}l(this.h,0,n,a),l(this.h,2,r,o),l(this.h,4,c,d),l(this.h,6,u,p),l(this.h,8,_,b),l(this.h,10,y,k),l(this.h,12,A,D),l(this.h,14,I,x)},y.prototype._digest=function(e){return"hex"===e?n.toHex32(this.h,"big"):n.split32(this.h,"big")}},function(e,t,i){var n=i(1),a=i(34).Reporter,s=i(3).Buffer;function r(e,t){a.call(this,t),s.isBuffer(e)?(this.base=e,this.offset=0,this.length=e.length):this.error("Input not Buffer")}n(r,a),(t.DecoderBuffer=r).prototype.save=function(){return{offset:this.offset,reporter:a.prototype.save.call(this)}},r.prototype.restore=function(e){var t=new r(this.base);return t.offset=e.offset,t.length=this.offset,this.offset=e.offset,a.prototype.restore.call(this,e.reporter),t},r.prototype.isEmpty=function(){return this.offset===this.length},r.prototype.readUInt8=function(e){return this.offset+1<=this.length?this.base.readUInt8(this.offset++,!0):this.error(e||"DecoderBuffer overrun")},r.prototype.skip=function(e,t){if(!(this.offset+e<=this.length))return this.error(t||"DecoderBuffer overrun");var i=new r(this.base);return i._reporterState=this._reporterState,i.offset=this.offset,i.length=this.offset+e,this.offset+=e,i},r.prototype.raw=function(e){return this.base.slice(e?e.offset:this.offset,this.length)},(t.EncoderBuffer=function e(t,i){if(Array.isArray(t))this.length=0,this.value=t.map(function(t){return t instanceof e||(t=new e(t,i)),this.length+=t.length,t},this);else if("number"==typeof t){if(!(0<=t&&t<=255))return i.error("non-byte EncoderBuffer value");this.value=t,this.length=1}else if("string"==typeof t)this.value=t,this.length=s.byteLength(t);else{if(!s.isBuffer(t))return i.error("Unsupported type: "+typeof t);this.value=t,this.length=t.length}}).prototype.join=function(e,t){return e||(e=new s(this.length)),t||(t=0),0===this.length||(Array.isArray(this.value)?this.value.forEach(function(i){i.join(e,t),t+=i.length}):("number"==typeof this.value?e[t]=this.value:"string"==typeof this.value?e.write(this.value,t):s.isBuffer(this.value)&&this.value.copy(e,t),t+=this.length)),e}},function(e,t,i){var n=t;n._reverse=function(e){var t={};return Object.keys(e).forEach(function(i){(0|i)==i&&(i|=0);var n=e[i];t[n]=i}),t},n.der=i(287)},function(e,t,i){var n=i(1),a=i(33),s=a.base,r=a.bignum,o=a.constants.der;function c(e){s.Node.call(this,"der",e)}function d(e,t){var i=e.readUInt8(t);if(e.isError(i))return i;var n=o.tagClass[i>>6],a=0==(32&i);if(31==(31&i)){var s=i;for(i=0;128==(128&s);){if(s=e.readUInt8(t),e.isError(s))return s;i<<=7,i|=127&s}}else i&=31;return{cls:n,primitive:a,tag:i,tagStr:o.tag[i]}}function l(e,t,i){var n=e.readUInt8(i);if(e.isError(n))return n;if(!t&&128===n)return null;if(0==(128&n))return n;var a=127&n;if(4<a)return e.error("length octect is too long");for(var s=n=0;s<a;s++){n<<=8;var r=e.readUInt8(i);if(e.isError(r))return r;n|=r}return n}(e.exports=function(e){this.enc="der",this.name=e.name,this.entity=e,this.tree=new c,this.tree._init(e.body)}).prototype.decode=function(e,t){return e instanceof s.DecoderBuffer||(e=new s.DecoderBuffer(e,t)),this.tree._decode(e,t)},n(c,s.Node),c.prototype._peekTag=function(e,t,i){if(e.isEmpty())return!1;var n=e.save(),a=d(e,'Failed to peek tag: "'+t+'"');return e.isError(a)?a:(e.restore(n),a.tag===t||a.tagStr===t||a.tagStr+"of"===t||i)},c.prototype._decodeTag=function(e,t,i){var n=d(e,'Failed to decode tag of "'+t+'"');if(e.isError(n))return n;var a=l(e,n.primitive,'Failed to get length of "'+t+'"');if(e.isError(a))return a;if(!i&&n.tag!==t&&n.tagStr!==t&&n.tagStr+"of"!==t)return e.error('Failed to match tag: "'+t+'"');if(n.primitive||null!==a)return e.skip(a,'Failed to match body of: "'+t+'"');var s=e.save(),r=this._skipUntilEnd(e,'Failed to skip indefinite length body: "'+this.tag+'"');return e.isError(r)?r:(a=e.offset-s.offset,e.restore(s),e.skip(a,'Failed to match body of: "'+t+'"'))},c.prototype._skipUntilEnd=function(e,t){for(;;){var i=d(e,t);if(e.isError(i))return i;var n,a=l(e,i.primitive,t);if(e.isError(a))return a;if(n=i.primitive||null!==a?e.skip(a):this._skipUntilEnd(e,t),e.isError(n))return n;if("end"===i.tagStr)break}},c.prototype._decodeList=function(e,t,i,n){for(var a=[];!e.isEmpty();){var s=this._peekTag(e,"end");if(e.isError(s))return s;var r=i.decode(e,"der",n);if(e.isError(r)&&s)break;a.push(r)}return a},c.prototype._decodeStr=function(e,t){if("bitstr"===t){var i=e.readUInt8();return e.isError(i)?i:{unused:i,data:e.raw()}}if("bmpstr"===t){var n=e.raw();if(n.length%2==1)return e.error("Decoding of string type: bmpstr length mismatch");for(var a="",s=0;s<n.length/2;s++)a+=String.fromCharCode(n.readUInt16BE(2*s));return a}if("numstr"===t){var r=e.raw().toString("ascii");return this._isNumstr(r)?r:e.error("Decoding of string type: numstr unsupported characters")}if("octstr"===t)return e.raw();if("objDesc"===t)return e.raw();if("printstr"!==t)return/str$/.test(t)?e.raw().toString():e.error("Decoding of string type: "+t+" unsupported");var o=e.raw().toString("ascii");return this._isPrintstr(o)?o:e.error("Decoding of string type: printstr unsupported characters")},c.prototype._decodeObjid=function(e,t,i){for(var n,a=[],s=0;!e.isEmpty();){var r=e.readUInt8();s<<=7,s|=127&r,0==(128&r)&&(a.push(s),s=0)}128&r&&a.push(s);var o=a[0]/40|0,c=a[0]%40;if(n=i?a:[o,c].concat(a.slice(1)),t){var d=t[n.join(" ")];void 0===d&&(d=t[n.join(".")]),void 0!==d&&(n=d)}return n},c.prototype._decodeTime=function(e,t){var i=e.raw().toString();if("gentime"===t)var n=0|i.slice(0,4),a=0|i.slice(4,6),s=0|i.slice(6,8),r=0|i.slice(8,10),o=0|i.slice(10,12),c=0|i.slice(12,14);else{if("utctime"!==t)return e.error("Decoding "+t+" time is not supported yet");n=0|i.slice(0,2),a=0|i.slice(2,4),s=0|i.slice(4,6),r=0|i.slice(6,8),o=0|i.slice(8,10),c=0|i.slice(10,12),n=n<70?2e3+n:1900+n}return Date.UTC(n,a-1,s,r,o,c,0)},c.prototype._decodeNull=function(e){return null},c.prototype._decodeBool=function(e){var t=e.readUInt8();return e.isError(t)?t:0!==t},c.prototype._decodeInt=function(e,t){var i=e.raw(),n=new r(i);return t&&(n=t[n.toString(10)]||n),n},c.prototype._use=function(e,t){return"function"==typeof e&&(e=e(t)),e._getDecoder("der").tree}},function(e,t,i){var n=i(1),a=i(3).Buffer,s=i(33),r=s.base,o=s.constants.der;function c(e){r.Node.call(this,"der",e)}function d(e){return e<10?"0"+e:e}(e.exports=function(e){this.enc="der",this.name=e.name,this.entity=e,this.tree=new c,this.tree._init(e.body)}).prototype.encode=function(e,t){return this.tree._encode(e,t).join()},n(c,r.Node),c.prototype._encodeComposite=function(e,t,i,n){var s,r=function(e,t,i,n){var a;if("seqof"===e?e="seq":"setof"===e&&(e="set"),o.tagByName.hasOwnProperty(e))a=o.tagByName[e];else{if("number"!=typeof e||(0|e)!==e)return n.error("Unknown tag: "+e);a=e}return 31<=a?n.error("Multi-octet tag encoding unsupported"):(t||(a|=32),a|o.tagClassByName[i||"universal"]<<6)}(e,t,i,this.reporter);if(n.length<128)return(s=new a(2))[0]=r,s[1]=n.length,this._createEncoderBuffer([s,n]);for(var c=1,d=n.length;256<=d;d>>=8)c++;(s=new a(2+c))[0]=r,s[1]=128|c,d=1+c;for(var l=n.length;0<l;d--,l>>=8)s[d]=255&l;return this._createEncoderBuffer([s,n])},c.prototype._encodeStr=function(e,t){if("bitstr"===t)return this._createEncoderBuffer([0|e.unused,e.data]);if("bmpstr"!==t)return"numstr"===t?this._isNumstr(e)?this._createEncoderBuffer(e):this.reporter.error("Encoding of string type: numstr supports only digits and space"):"printstr"===t?this._isPrintstr(e)?this._createEncoderBuffer(e):this.reporter.error("Encoding of string type: printstr supports only latin upper and lower case letters, digits, space, apostrophe, left and rigth parenthesis, plus sign, comma, hyphen, dot, slash, colon, equal sign, question mark"):/str$/.test(t)?this._createEncoderBuffer(e):"objDesc"===t?this._createEncoderBuffer(e):this.reporter.error("Encoding of string type: "+t+" unsupported");for(var i=new a(2*e.length),n=0;n<e.length;n++)i.writeUInt16BE(e.charCodeAt(n),2*n);return this._createEncoderBuffer(i)},c.prototype._encodeObjid=function(e,t,i){if("string"==typeof e){if(!t)return this.reporter.error("string objid given, but no values map found");if(!t.hasOwnProperty(e))return this.reporter.error("objid not found in values map");e=t[e].split(/[\s\.]+/g);for(var n=0;n<e.length;n++)e[n]|=0}else if(Array.isArray(e))for(e=e.slice(),n=0;n<e.length;n++)e[n]|=0;if(!Array.isArray(e))return this.reporter.error("objid() should be either array or string, got: "+JSON.stringify(e));if(!i){if(40<=e[1])return this.reporter.error("Second objid identifier OOB");e.splice(0,2,40*e[0]+e[1])}var s=0;for(n=0;n<e.length;n++){var r=e[n];for(s++;128<=r;r>>=7)s++}var o=new a(s),c=o.length-1;for(n=e.length-1;0<=n;n--)for(r=e[n],o[c--]=127&r;0<(r>>=7);)o[c--]=128|127&r;return this._createEncoderBuffer(o)},c.prototype._encodeTime=function(e,t){var i,n=new Date(e);return"gentime"===t?i=[d(n.getFullYear()),d(n.getUTCMonth()+1),d(n.getUTCDate()),d(n.getUTCHours()),d(n.getUTCMinutes()),d(n.getUTCSeconds()),"Z"].join(""):"utctime"===t?i=[d(n.getFullYear()%100),d(n.getUTCMonth()+1),d(n.getUTCDate()),d(n.getUTCHours()),d(n.getUTCMinutes()),d(n.getUTCSeconds()),"Z"].join(""):this.reporter.error("Encoding "+t+" time is not supported yet"),this._encodeStr(i,"octstr")},c.prototype._encodeNull=function(){return this._createEncoderBuffer("")},c.prototype._encodeInt=function(e,t){if("string"==typeof e){if(!t)return this.reporter.error("String int or enum given, but no values map");if(!t.hasOwnProperty(e))return this.reporter.error("Values map doesn't contain: "+JSON.stringify(e));e=t[e]}if("number"!=typeof e&&!a.isBuffer(e)){var i=e.toArray();!e.sign&&128&i[0]&&i.unshift(0),e=new a(i)}if(a.isBuffer(e)){var n=e.length;0===e.length&&n++;var s=new a(n);return e.copy(s),0===e.length&&(s[0]=0),this._createEncoderBuffer(s)}if(e<128)return this._createEncoderBuffer(e);if(e<256)return this._createEncoderBuffer([0,e]);n=1;for(var r=e;256<=r;r>>=8)n++;for(r=(s=new Array(n)).length-1;0<=r;r--)s[r]=255&e,e>>=8;return 128&s[0]&&s.unshift(0),this._createEncoderBuffer(new a(s))},c.prototype._encodeBool=function(e){return this._createEncoderBuffer(e?255:0)},c.prototype._use=function(e,t){return"function"==typeof e&&(e=e(t)),e._getEncoder("der").tree},c.prototype._skipDefault=function(e,t,i){var n,a=this._baseState;if(null===a.default)return!1;var s=e.join();if(void 0===a.defaultBuffer&&(a.defaultBuffer=this._encodeValue(a.default,t,i).join()),s.length!==a.defaultBuffer.length)return!1;for(n=0;n<s.length;n++)if(s[n]!==a.defaultBuffer[n])return!1;return!0}},function(e){e.exports={"1.3.132.0.10":"secp256k1","1.3.132.0.33":"p224","1.2.840.10045.3.1.1":"p192","1.2.840.10045.3.1.7":"p256","1.3.132.0.34":"p384","1.3.132.0.35":"p521"}},function(e,t,i){var n=i(29),a=i(49).Buffer;function s(e){var t=a.allocUnsafe(4);return t.writeUInt32BE(e,0),t}e.exports=function(e,t){for(var i,r=a.alloc(0),o=0;r.length<t;)i=s(o++),r=a.concat([r,n("sha1").update(e).update(i).digest()]);return r.slice(0,t)}},function(e,t){e.exports=function(e,t){for(var i=e.length,n=-1;++n<i;)e[n]^=t[n];return e}},function(e,t,i){var n=i(4),a=i(49).Buffer;e.exports=function(e,t){return a.from(e.toRed(n.mont(t.modulus)).redPow(new n(t.publicExponent)).fromRed().toArray())}},function(e,t,i){"use strict";e.exports={hasToShowResults:function(e){var t=e.messages,i=_.isNull(e.accommodationSearchResultsMetadata)?0:e.accommodationSearchResultsMetadata.numFilteredResults,n=0===t.length||"DISTANCE_LOCATION_ERROR"===t[0].code;return 0!==i&&n},hasToShowDistanceAlert:function(e){return 1===e.length&&"DISTANCE_LOCATION_ERROR"===e[0].code},getRequestData:function(){return Odigeo.Utils.parseJson(Odigeo.Session.get("accommodationSearchParameters")).accommodationSearchRequest},setPreviousSearchParameters:function(){Odigeo.Session.set("oldSearchParameters",Odigeo.Session.get("searchParameters"))},updateSearchParams:function(){var e=this.getRequestData(),t=Odigeo.Utils.parseJson(Odigeo.Session.get("searchParameters"));t.accommodationDestination=e.destination,t.checkInDate=e.checkInDate,t.checkOutDate=e.checkOutDate,Odigeo.Session.set("searchParameters",JSON.stringify(t))},getDestination:function(){var e=Odigeo.Utils.parseJson(Odigeo.Session.get("searchParameters"));return e.accommodationDestination||e.searchSegments[0].destination},getCheckOutDate:function(e){var t=1<e.searchSegments.length;return e.checkOutDate||(t?e.searchSegments[1].dateStr:Odigeo.Utils.getNextDay(e.searchSegments[0].dateStr))},getPreviousDestinationAndDates:function(){var e=Odigeo.Utils.parseJson(Odigeo.Session.get("oldSearchParameters"));return{destination:e.accommodationDestination||e.searchSegments[0].destination,checkInDate:e.checkInDate||e.searchSegments[0].dateStr,checkOutDate:this.getCheckOutDate(e)}},getSummaryData:function(e){return{destination:this.getDestination().name,numResults:e.numFilteredResults}},getNewSearchTrackingSuffix:function(e){var t=e.accommodationDestination||e.searchSegments[0].destination,i=this.getPreviousDestinationAndDates(),n=i.checkInDate!==e.checkInDate||i.checkOutDate!==e.checkOutDate,a=n?"dates":"same";return i.destination.name!==t.name&&(a=n?"both":"city"),a},replaceUrlParams:function(e,t){return _.each(e,function(e,i){if(_.get(e,"url")){var n=t[i];_.each(n,function(t,i){e.url=e.url.replace("$"+i+"$",t)})}})},getHotelDataFromSession:function(){var e=Odigeo.Utils.parseJson(Odigeo.Session.get("searchParameters")),t=e.searchSegments[0].dateStr,i=this.getCheckOutDate(e),n=Odigeo.SessionScope.visitId;return{iata:e.searchSegments[0].destination.iata,checkin_monthday:Odigeo.Utils.formatDate(t,"dd",!0),checkin_year_month:Odigeo.Utils.formatDate(t,"yyyy-mm",!0),checkout_monthday:Odigeo.Utils.formatDate(i,"dd",!0),checkout_year_month:Odigeo.Utils.formatDate(i,"yyyy-mm",!0),visitId:n}},getHotelLinkFromSession:function(){var e=this.getHotelDataFromSession(),t=Odigeo.UIElements.translations.xsellHomePage.homeHotelTabUrl;return Odigeo.Utils.replaceCmsKeyArgs(t,e.iata,e.checkin_monthday,e.checkin_year_month,e.checkout_monthday,e.checkout_year_month,e.visitId)}}},function(e,t,i){"use strict";var n="sso_remember_me",a={email:0,name:1,isMembership:2,loginType:3,loginSubtype:4},s=function(){var e=Odigeo.Utils.readCookie(n);return(decodeURIComponent(e)||"").split(";")};e.exports={getRememberMeCookieField:function(e){var t=a[e],i=s()[t];return i&&i.replace(/[#+]/g," ")||""},updateRememberMeCookieField:function(e,t){var i=a[e];if(!_.isUndefined(i)){var r=s();r[i]=t,Odigeo.Utils.createCookie(n,encodeURIComponent(r.join(";")))}}}},function(e,t,i){"use strict";var n=i(557),a=i(558),s=new Odigeo.Enum(["guarantees","serviceOptions"]),r={};e.exports=function(e){if(_.isEmpty(r[e]))switch(e){case s.guarantees:r[e]=new n(e);break;case s.serviceOptions:r[e]=new a(e)}return r[e]}},,function(e,t,i){"use strict";var n,a=i(189),s=i(190),r=i(58).getInstance(),o=i(37).getInstance(),c=i(97).getInstance(),d=function(){this.ROW_IDS=_.clone(o.ROW_IDS),this.baggagesOptionsModel=a.getInstance(),this.baggagesSelectionModel=s.getInstance(),this.init()},l={baggageDescriptor:{baggageType:"BAGGAGE"}},g=_.partial(_.filter,_,l),h=_.partial(_.reject,_,l);_.extend(d.prototype,Backbone.Events,{ROW_IDS:null,viewClass:null,baggagesInformation:[],init:function(){this.bindEvents()},clearCollections:function(){r.clearCollection(),o.clearCollection(),c.clearCollection()},buildCollection:function(){this.clearCollections(),this.requestBaggagesOptions()},bindEvents:function(){this.listenTo(this.baggagesOptionsModel,"responseIsOK",this.buildOptionsFromRequest),this.listenTo(this.baggagesOptionsModel,"responseIsOK",this.removeLoadingBaggages),this.listenTo(this.baggagesOptionsModel,"responseIsKO",_.bind(this.removeLoadingBaggages,this,!1)),this.listenTo(this.baggagesSelectionModel,"responseIsOK",this.updateSelectionFromShoppingCart)},requestBaggagesOptions:function(){this.baggagesOptionsModel.fetch(this.baggagesOptionsModel.getDataRequestSettings())},requestBaggagesSelection:function(){this.baggagesSelectionModel.fetch(this.baggagesSelectionModel.getDataRequestSettings())},removeLoadingBaggages:function(e){e||this.trigger("trackBaggages","baggage_widget_error_prov"),this.trigger("removeLoadingBaggages")},buildOptionsFromRequest:function(e){if(!_.isEmpty(e)){var t=e.getAll();o.setAutoSelectionEnabled(t.autoSelection),_.each(t.baggage,this.addPassengerBaggagesToCollection,this),o.setBaggageBundleDiscountPercentage(t.baggageBundleDiscountPercentage),this.setAllowRowsAutoselection(t.baggage),this.requestBaggagesSelection()}},setAllowRowsAutoselection:function(e){r.setAllowRowsAutoselection(_.reduce(e,function(e,t){return e&&t.autoSelection},!0))},areAllPassengersWithBaggage:function(e){return _.every(e,function(e){return _.every(e,function(e){return _.every(e.selectedBaggageDescriptor,function(e){return 0<e.baggageDescriptor.pieces})})})},updateSelectionFromShoppingCart:function(e){_.isEmpty(e)||(r.selectedInCartTotalPrice=0,_.each(e.getAll(),this.updatePassengerFromCartInfo,this)),r.updateTotalInCartFromTotalPrice(this.areAllPassengersWithBaggage(e.getAll())),this.collectionPostBuildProcess(),Odigeo.trigger("baggagesObserver:onBaggageLoaded")},collectionPostBuildProcess:function(){var e=this.baggagesInformation[0],t=_.isUndefined(e)?"":e.searchRequestType;r.calculateIncludedPieces(),o.setRequestType(t),this.trigger("collectionBuilt",this.baggagesInformation)},addBaggagesRowInfo:function(e,t){o.fillData(e,t)},addBaggagesOptions:function(e,t){r.fillData(e,t)},addSpecialBaggageOptions:function(e,t){c.fillData(e,t)},addPassengerBaggagesToCollection:function(e,t){var i=parseInt(t,10);_.isEmpty(e.segmentBaggages)?this.setDeferredStatus(i,e):(_.each(e.segmentBaggages,function(e,t){var n={rowType:this.parseRowType(e),hasIncludedBaggages:this.hasIncludedBaggages(e),hasSelectableBaggages:this.hasSelectableBaggages(e),hasSpecialBaggage:this.hasSpecialBaggage(e),idRow:this.ROW_IDS[t],idPassenger:i};this.addBaggagesRowInfo(e,n),this.addBaggageDescriptors(e,n)},this),this.baggagesInformation[i]=e)},setDeferredStatus:function(e,t){Odigeo.AB.isNewCreateShoppingCart&&_.isObject(t)&&(this.baggagesInformation[e]={status:t.status||""})},addBaggageDescriptors:function(e,t){t.hasIncludedBaggages&&this.addIncludedBaggageDescriptor(e.baggageDescriptorIncludedInPrice,t),t.hasSelectableBaggages&&this.addSelectableBaggageDescriptors(e.selectableBaggageDescriptor,t),t.hasSpecialBaggage&&this.addSpecialBaggageDescriptors(e.selectableBaggageDescriptor,t)},addIncludedBaggageDescriptor:function(e,t){e.price=0,this.addBaggagesOptions([e],_.extend(t,{isIncludedBaggage:!0,isSelectableBaggage:!1})),r.selectDefaultOption(t.idPassenger,t.idRow)},addSelectableBaggageDescriptors:function(e,t){e=g(e);var i=this.parseDescriptors(e);this.addBaggagesOptions(i,_.extend(t,{isIncludedBaggage:!1,isSelectableBaggage:!0})),r.selectDefaultOption(t.idPassenger,t.idRow)},addSpecialBaggageDescriptors:function(e,t){e=h(e);var i=this.parseDescriptors(e);this.addSpecialBaggageOptions(i,t)},updatePassengerFromCartInfo:function(e,t){var i=parseInt(t,10);_.each(e,function(e){var t=e.selectedBaggageDescriptor,n=_.find(t,l);if(!_.isUndefined(n)){var a,s={idPassenger:i,pieces:n.baggageDescriptor.pieces,kilos:n.baggageDescriptor.kilos,price:n.price},o="SEGMENT"===e.baggageApplicationLevel?{idRow:e.segmentTypeIndexDTO}:{};_.extend(s,o),a=_.isEmpty(n.baggageDescriptor)?{}:r.getOption(s),_.isEmpty(a)||r.updateOption(a.cid)}},this)},parseDescriptors:function(e){return _.map(e,function(e){var t=e.baggageDescriptor;return t.price=e.price,t})},hasIncludedBaggages:function(e){return!_.isEmpty(e.baggageDescriptorIncludedInPrice)&&0<e.baggageDescriptorIncludedInPrice.pieces},hasSelectableBaggages:function(e){return!_.isEmpty(g(e.selectableBaggageDescriptor))},hasSpecialBaggage:function(e){return!_.isEmpty(h(e.selectableBaggageDescriptor))},parseRowType:function(e){var t=this.hasIncludedBaggages(e),i=this.hasSelectableBaggages(e);return t&&i?"BOTH":t?"INCLUDED":i?"SELECTABLE":"NOT_ALLOWED"},parseBaggageType:function(e){var t=!_.isEmpty(e.baggageDescriptorIncludedInPrice)&&0<e.baggageDescriptorIncludedInPrice.pieces,i=!_.isEmpty(e.selectableBaggageDescriptor),n=this.BAGGAGE_TYPE.notAllowed;return t?n=i?this.BAGGAGE_TYPE.includedSelectable:this.BAGGAGE_TYPE.included:i&&(n=this.BAGGAGE_TYPE.selectable),n},getDiscountPercentage:function(){return r.getDiscountPercentage()},isBaggageSelected:function(){return r.selectedPieces}}),e.exports=d,e.exports.getInstance=function(){return _.isUndefined(n)&&(n=new d),n}},function(e,t,i){"use strict";var n=i(346);function a(e,t){return _.isObject(e)&&!_.isEmpty(e[t])}function s(e){return a(e,"selectedItems")}function r(e){return _.isObject(e)&&(_.lt(e.selectedMaxPrice,Number.MAX_VALUE)||_.gt(e.selectedMinPrice,0))}function o(e,t){return _.isObject(e)&&_.isNumber(e.selectedDistance)&&_.lt(e.selectedDistance,t)}function c(e,t,i){e&&(t[i]=n[i])}function d(e,t){s.call(this,e)&&_.each(e.selectedItems,function(e){c(!0,t,e)},this)}e.exports={hasSomeDataFilled:function(e){return _.some(_.isArray(e)?e:[e],_.negate(_.isEmpty))},hasSelectedFilterItems:s,hasSelectedFilterPrice:r,hasSelectedFilterDistance:o,getValidateActivateTags:function(e){return function(e,t){var i,n,l={};return c(s.call(this,e.categoryFilterModel),l,"GUEST_RATING"),c(s.call(this,e.reviewFilterModel),l,"GUEST_REVIEWS"),c(function(e){return a(e,"hotelName")}.call(this,e.hotelNameFilterModel),l,"HOTEL_NAME"),c(function(e){return _.get(e,"isOurSelection",!1)}.call(this,e.filterByOurSelectionModel),l,"OUR_SELECTION"),c(r.call(this,e.accommodationPriceFilterModel),l,"PRICE_RANGE"),c(o.call(this,e.distanceFilterModel,t),l,"DISTANCE_CENTER"),c(function(e){return a(e,"selectedItems")}.call(this,e.filterByNeighbourhoodModel),l,"NEIGHBOURHOOD"),n=l,d((i=e).facilityGroupFilterModel,n),d(i.accommodationTypeFilterModel,n),l}(e.accommodationSearchResultsMetadata,e.accommodationFiltersMetadata.distanceMetadata.maxDistance)}}},,,,function(e,t,i){"use strict";var n,a,s;n=i(150),a=i(353),s=function(e,t){this.searchModel=n.getInstance(),this.defaultParams=a.get(),this.opts=_.extend({searchParam:"lastSearchDynpack"},t),this.init(Odigeo.autoloadWidgetsAsync(e))},_.extend(s.prototype,{init:function(e){return _.each(e,function(e){e()}),this},reset:function(){return this.remove().restoreSearchParams(),this},resetWithEmptyDestination:function(){return this.remove().restoreSearchParamsWithEmptyDestination(),this},hasPreviousSearch:function(){return!_.isEmpty(this.getStorageParams())||this.searchModel.hasSearchData()},hasPreviousValidSearch:function(){return this.hasPreviousSearch()&&_.isEmpty(this.getSearchErrors())},restoreSearchParams:function(e){var t;return!e&&this.searchModel.hasSearchData()||(t=this.getStorageParams(),this.setSearchParams(_.isEmpty(t)?this.defaultParams:t)),this},restoreSearchParamsWithEmptyDestination:function(){if(this.searchModel.hasSearchData())return this;var e=this.getStorageParams();return e?(e.accommodationDestination&&delete e.accommodationDestination,e.searchSegments[0].destination=this.defaultParams.searchSegments[0].destination,e.searchSegments[1].departure=this.defaultParams.searchSegments[1].departure):e=this.defaultParams,this.setSearchParams(e),this},getStorageParams:function(){var e=this.getStorageClass();return Odigeo.Utils.parseJson(e.get(this.opts.searchParam))},getStorageClass:function(){return{lastSearchDynpack:Odigeo.Storage,searchParameters:Odigeo.Session,lastSearch:Odigeo.PageStorage}[this.opts.searchParam]||Odigeo.Session},getSearchErrors:function(e){return this.searchModel.validation(e)},isValid:function(){return!_.isEmpty(this.getSearchParams())&&_.isEmpty(this.searchModel.errors)},extendSearchParams:function(e){return this.restoreSearchParams(),this.setSearchParams($.extend(!0,{},this.defaultParams,e))},setSearchParams:function(e){return this.searchModel.fetch(_.omit(e,this.opts.omittedParams)),this},getSearchParams:function(){return this.searchModel.toJSON()},remove:function(){return this.searchModel.clear(),this}},Backbone.Events),e.exports=s},function(e,t,i){"use strict";var n={none:"none",bags:"bags",seats:"seats"},a=function(e,t){var i=_.values(e).join("|"),n=new RegExp("^("+i+")"),a=_.isEmpty(t)?"":_.first(t.match(n));return _.isEmpty(a)?e.none:a},s=function(e){return _.map(e,"code")};e.exports={getProductFromParam:a,availableProducts:n,parsePostBookingParams:function(e){var t,i,s,r;if(!_.isEmpty(e)&&(i=(t=Odigeo.Utils.parseHashParameters(e)).trackingId,s=t.bookingId,r=a(n,t.product),!_.isEmpty(i)&&!_.isEmpty(s)))try{return{email:atob(i),bookingId:s,product:r}}catch(e){return}},getCollectionMethods:function(e){return _.map(e.collectionMethods,function(e){return{method:e.collectionMethodType,code:e.creditCardType.code,name:e.creditCardType.name}})},getHotelsWhiteLabel:function(){var e=window.Odigeo.SessionScope.tmSettings.client;return"govoyage"===e&&(e="govoyages"),"https://"+("govoyages"===e?"hotel."+e+".com":"hotels."+e+".com")},getCreditCardTypeCodes:s,isAcceptedCreditCardType:function(e,t){var i=s(e);return!_.isEmpty(t)&&_.includes(i,t)}}},function(e,t,i){"use strict";var n=i(15),a=".draggable",s={start:Odigeo.Events.pointerdown+a,move:Odigeo.Events.pointermove+a,end:Odigeo.Events.pointerup+a},r=function(){if(!window.getComputedStyle)return!1;var e,t=document.createElement("p"),i={webkitTransform:"-webkit-transform",OTransform:"-o-transform",msTransform:"-ms-transform",MozTransform:"-moz-transform",transform:"transform"};for(var n in document.body.insertBefore(t,null),i)void 0!==t.style[n]&&(t.style[n]="translate3d(1px,1px,1px)",e=window.getComputedStyle(t).getPropertyValue(i[n]));return document.body.removeChild(t),void 0!==e&&0<e.length&&"none"!==e}(),o=function(e){return _.isEmpty(e.touches)?e:e.touches[0]},c=function(e){var t=o(e);return{x:t.pageX||t.clientX||t.layerX||t.screenX||0,y:t.pageY||t.clientY||t.layerY||t.screenY||0}},d=function(e){return Odigeo.Utils.stringToCamelCase("on_"+e)},l={_onStart:function(e){return e.tick=!1,e},_onMove:_.identity,_onEnd:function(e){return e.tick=!1,e}},g=function(e,t){return r?"translate3d("+e+"px, "+t+"px, 0px)":"translate("+e+"px, "+t+"px)"};e.exports=new n(_.extend({initDraggable:function(e,t){var i="none";return"vertical"===t?i="pan-x":"horizontal"===t&&(i="pan-y"),this.dragStorage={initial:0,translate:{x:0,y:0}},e.css("touch-action",i),this.bindTouchEvents(e),this},stopDraggable:function(e){return e.off(a),e.css("touch-action","auto"),this},bindTouchEvents:function(e){return e.on(s.start,_.bind(this.onTouchStart,this)),_.each(s,function(t,i){e.on(t,_.bind(this.notifyDrag,this,i))},this),this},onTouchStart:function(e){var t,i,n;return this.dragStorage.initial=(i=o(t=e),n=c(t),{x:i.startX||n.x,y:i.startY||n.y}),this},notifyDrag:function(e,t){return(0,l["_"+d(e)])(this,this.normalizeDragData(t,e)),this[d(e)](this.normalizeDragData(t,e)),this.onDrag(this.normalizeDragData(t,e)),this},normalizeDragData:function(e,t){var i=c(e);return{eventType:t,start:_.clone(this.dragStorage.initial),current:i,move:{x:i.x-this.dragStorage.initial.x,y:i.y-this.dragStorage.initial.y},target:e.target}},addTick:function(e){var t=_.rest(arguments);return this.tick?(this.dragStorage.enqueueCB=e,this.dragStorage.enqueueArgs=t):(this.tick=!0,this.dragStorage.enqueueCB=null,this.addFrame.apply(this,arguments)),this},addFrame:function(e){var t=_.rest(arguments);requestAnimationFrame(_.bind(function(){var i;e.apply(this,t),_.isFunction(this.dragStorage.enqueueCB)?(i=this.dragStorage.enqueueCB,this.dragStorage.enqueueCB=null,this.addFrame.apply(this,[i].concat(this.dragStorage.enqueueArgs))):this.tick=!1},this))},getTranslate:function(){return this.dragStorage.translate||{}},getTranslateX:function(){return this.getTranslate().x||0},getTranslateY:function(){return this.getTranslate().y||0},setTranslate:function(e,t,i){return e.style.webkitTransform=g(t,i),e.style.MozTransform=g(t,i),e.style.msTransform=g(t,i),e.style.OTransform=g(t,i),e.style.transform=g(t,i),this.dragStorage.translate={x:t,y:i},this},setTranslateX:function(e,t){return this.setTranslate(e,t,this.getTranslateY(e)),this},setTranslateY:function(e,t){return this.setTranslate(e,this.getTranslateX(e),t),this},onDrag:function(){return this},onStart:function(){return this},onMove:function(){return this},onEnd:function(){return this}},Backbone.Events))},function(e,t,i){"use strict";var n,a,s,r=i(6);a=new(i(151)),s=Odigeo.Model.extend({defaults:{newRoomFormat:!0},clear:function(){var e=Odigeo.Model.prototype.clear.call(this,{silent:!0});return this.set(this.defaults,{silent:!0}),this.trigger("clear",{searchModelSilent:!0}),e},set:function(){var e=Odigeo.Model.prototype.set.apply(this,arguments);return this.validation(),e},fetch:function(e){return this.set(e,{silent:!0}),this.trigger("sync:fetch",{searchModelSilent:!0}),$.Deferred().resolve().promise()},validation:function(e){var t,i,n,s,r=[],o=this.toJSON(),c=o.searchSegments;return a.resetConfig(),a.setConfig(e),r=r.concat(a.validateSegmentsLength(c)),n=!_.isEmpty(a.config.searchType)&&_.isEqual(a.config.searchType,"dpSearch"),s=!_.isEmpty(a.config.searchType)&&_.isEqual(a.config.searchType,"accommodationSearch")||!_.isEmpty(c)&&!_.isEmpty(c.type)&&_.contains(c.type,"accommodation"),_.isEmpty(r)&&(t=_.result(c[0],"dateStr"),i=_.result(c[1],"dateStr"),r=r.concat(a.validateFlighType(o.type),a.validateSegmentsLengthAndFlightType(c,o.type),a.validateSegmentsContent(c,o.type,null,s),a.validateAccommodationDestination(o.accommodationDestination,s),a.validatePassengers(o.numAdults,o.numChildren,o.numInfants),a.validateRoomChildrenAges(o.rooms,"childrenAges"),a.validateCabinClass(o.cabinClass),a.validateCalendarIncomplete(c,o.type),a.validateCalendarOutdate(t)),(_.has(o,"checkInDate")||_.has(o,"checkOutDate")||n)&&(r=_.every([o.checkInDate,o.checkInDate],a.isDate)?r.concat(a.validateCheckinDatesLength(o.checkInDate,o.checkOutDate)):r.concat(a.validateCheckinDatesLength(t,i,"date"))),s&&(_.has(o,"checkInDate")||_.has(o,"checkOutDate"))&&(r=r.concat(a.validateCheckInCalendarIncomplete(o.checkInDate,o.checkOutDate)))),this.trigger("errors",r,a.config),r},isSingleFlight:function(){return r.isOneWayOrRoundTrip(this.get("type"))},hasSearchData:function(){return!_.isEmpty(_.omit(this.toJSON(),_.keys(this.defaults)))},getDates:function(){return _.map(this.get("searchSegments"),function(e){return e.dateStr?Odigeo.Utils.parseDate(e.dateStr):null})}}),e.exports.SearchModelClass=s,e.exports.getInstance=function(){return _.isUndefined(n)&&(n=new s),n}},function(e,t,i){"use strict";var n=function(e){this.config=_.extend({flightTypes:["oneWayTrip","roundTrip","multipleTrip"],cabinClassTypes:["BUSINESS","FIRST","TOURIST","PREMIUM_ECONOMY","ECONOMIC_DISCOUNTED","SHOW_ALL"]},e),this.configMap=_.keys(this.config)},a=function(e,t){var i=Odigeo.Utils,n=_.map([e,t],function(e){return _.isString(e)?i.parseDate(e,i.formatDate.masks.isoDate):e});return _.every(n,_.isDate)?i.getDifferenceInDays.apply(i,n):Number.NaN};e.exports=n,_.extend(n.prototype,{setConfig:function(e){_.extend(this.config,e)},resetConfig:function(){this.config=_.pick(this.config,this.configMap)},validateSegmentsLength:function(e){var t=[];return _.isArray(e)||t.push({key:"searchSegments"}),t},validateFlighType:function(e){var t=[];return this.config.flightTypes.indexOf(e)<0&&t.push({key:"flightType"}),t},validateSegmentsLengthAndFlightType:function(e,t){var i=[],n=e.length;return("oneWayTrip"===t&&n<1||"roundTrip"===t&&2!==n||"multipleTrip"===t&&n<=1)&&i.push({key:"searchSegments"}),i},validateSegmentsContent:function(e,t,i,n){var a=t===this.config.flightTypes[1],s=t===this.config.flightTypes[0];return _.reduce(e,function(e,t,r){var o=_.union([t.destination],i||[]),c=[],d=!1;return(a||s)&&0<r||n&&s||(c=c.concat(this.validateAirport(t,r)),_.isEmpty(c)&&(d=_.some(o,function(e){return t.departure.geoNodeId===e.geoNodeId&&t.departure.iata===e.iata})),d&&c.push({index:r,key:"destination",type:"sameCity"}),this.trigger("sameCity",r,d,t.departure)),e.concat(c)},[],this)},validateAirport:function(e,t){var i=[];return this.isValidAirport(e.departure)||i.push({index:t,key:"departure",type:"invalid"}),this.isValidAirport(e.destination)||i.push({index:t,key:"destination",type:"invalid"}),i},isValidAirport:function(e){return!_.isEmpty(e)&&(_.has(e,"geoNodeId")&&_.isFinite(parseInt(e.geoNodeId,10))||_.has(e,"iata")&&_.isString(e.iata)&&3<=e.iata.length)},validateCabinClass:function(e){var t=[];return this.config.cabinClassTypes.indexOf(e)<0&&t.push({key:"cabinClass"}),t},validateAccommodationDestination:function(e,t){var i=[];return t&&_.isEmpty(e)&&i.push({index:1,key:"destination",type:"invalid"}),i},validateCheckinDates:function(e,t){var i=[];return 0===(i=i.concat(this.validateHasCheckinDates(e,t))).length&&(i=i.concat(this.validateCheckinDatesLength(e,t))),i},validateHasCheckinDates:function(e,t){var i=[],n=!this.isDate(e),a=!this.isDate(t);return n&&a||(n&&i.push({key:"checkInDates",index:0}),a&&i.push({key:"checkInDates",index:1})),i},validateCheckinDatesLength:function(e,t,i){var n=[],s=a(e,t);return!_.isNaN(s)&&s<=0?n.push({key:i||"checkInDates",index:3,type:"one-day-later"}):!_.isNaN(s)&&30<s&&n.push({key:i||"checkInDates",index:3,type:"max-thirty-days"}),n},validateCalendarIncomplete:function(e,t){var i=[],n=t===this.config.flightTypes[0],a=e[0];if(!_.isUndefined(a)&&a.dateStr||i.push({index:0,key:"date",type:"incomplete"}),n||1===e.length)return i;for(var s=e.map(function(e){return _.isUndefined(e.dateStr)||_.isNull(e.dateStr)?null:Date.parse(e.dateStr)}),r=1;r<s.length;r++){var o=_.max(_.filter(s.slice(0,r),Number)),c=s[r],d=_.isNull(c)||_.isNaN(c);(c<o||d)&&i.push({index:r,key:"date",type:"incomplete"})}return i},validateCheckInCalendarIncomplete:function(e,t){var i=[],n=a(e,t);return(_.isNaN(n)||n<0)&&i.push({key:"checkInDates",index:3,type:"incomplete"}),i},validateCalendarOutdate:function(e){var t=[],i=new Date(e),n=new Date;return n.setHours(0,0,0,0),this.isDate(e)&&i<n&&t.push({index:1,key:"date",type:"outdate"}),t},validatePassengers:function(e,t,i){var n=[];return(9<e+t+i||e<i)&&n.push({key:"passengers",type:"limits"}),n},validateRoomChildrenAges:function(e){return _.reduce(e,function(e,t,i){return _.find(t.childrenAges,function(t){return!!_.isNull(t)&&(e.push({key:"passengers",index:i,type:"error"}),!0)}),e},[])},isDate:function(e){return _.isDate(e)||!_.isNaN(Date.parse(e))}},Backbone.Events)},function(e,t,i){"use strict";e.exports={0:"freebies",1:"roomServices",2:"hotelServices",3:"wellness",4:"foodPlace",5:"technology",6:"transport",7:"sports",8:"entertainment",9:"general",10:"facilities",11:"childrenServices",12:"business"}},function(e,t){e.exports=function(e){return e.webpackPolyfill||(e.deprecate=function(){},e.paths=[],e.children||(e.children=[]),Object.defineProperty(e,"loaded",{enumerable:!0,get:function(){return e.l}}),Object.defineProperty(e,"id",{enumerable:!0,get:function(){return e.i}}),e.webpackPolyfill=1),e}},,function(e,t,i){"use strict";e.exports=["PAR-ALG","PAR-DKR","PAR-PTP","PAR-DXB","PAR-FDF","PAR-HKT","PAR-BKO","PAR-TYO","PAR-ABJ","PAR-DPS","PAR-CMB","PAR-CAI","PAR-DEL","PAR-BJA","PAR-PNH","PAR-SGN","PAR-HAN","PAR-KTM","PAR-TLM","PAR-MNL","PAR-DLA","PAR-NOU","PAR-MRS","ALG-PAR","DKR-PAR","PTP-PAR","DXB-PAR","FDF-PAR","HKT-PAR","BKO-PAR","TYO-PAR","ABJ-PAR","DPS-PAR","CMB-PAR","CAI-PAR","DEL-PAR","BJA-PAR","PNH-PAR","SGN-PAR","HAN-PAR","KTM-PAR","TLM-PAR","MNL-PAR","DLA-PAR","NOU-PAR","MRS-PAR"]},function(e,t,i){"use strict";var n=i(202),a={type:"sights",hltext:"",hltime:0,wrapperSelector:".vtr"};function s(e,t){this.map=e,this.options=_.extend({},a,t)}s.prototype.hasSelectedHeatMapControls=function(e){return _.isElement($(e).closest(this.options.wrapperSelector).get(0))},s.prototype.refresh=function(){window.AVUXI.MapHMRefresh(this.map)},s.prototype.load=function(){var e=new n;return e.run(_.bind(function(t){(function(){return _.isElement(this.map.getDiv().querySelector(this.options.wrapperSelector))}).call(this)||t.MapStart(this.map,"729a72bf01c4f"),e.getDeferred().resolve()},this))},e.exports=s},function(e,t,i){"use strict";e.exports={getPriceNoWrap:function(e){return'<span class="odf-text-nowrap">'+e+"</span>"}}},function(e,t,i){"use strict";var n=i(60),a=i(159),s=i(162),r=Odigeo.Model.extend(s.deepExtend(a.deepExtend(n.extend({setFromConfirmation:function(e){this.set(this.getConfirmationXsellingData(e))}})))),o=void 0;e.exports={getInstance:function(){return _.isUndefined(o)&&(o=new r),o}}},function(e,t,i){"use strict";var n=i(15),a=i(301);e.exports=new n(a)},function(e,t,i){"use strict";function n(e){var t=_.get(e,"dateOfBirth",!1);return t&&Odigeo.Utils.getAge(t)||0}e.exports=function(e){var t={},i=e.travellers,a=function(e){for(var t=0,i=0,a=0;a<e.length;a++){var s=n(e[a]);i<s&&(i=s,t=a)}return e[t]}(i);return t.getResidenceId=function(){return a.countryCodeOfResidence||e.buyer.country},t.getAge=function(){return n(a)||25},t.getNumberOfBaggagesInArrival=function(){return i.reduce(function(e,t){var i=t.baggages[0].baggageDescriptionList;return e+_.sum(i,function(e){return e.pieces})},0)},t}},function(e,t,i){"use strict";e.exports=function(e){return{getAddress:function(){return e.address},getCountryCode:function(){return e.country},getZipCode:function(){return e.zipCode},getAge:function(){var t=_.get(e,"dateOfBirth",0);return t?Odigeo.Utils.getAge(t):25}}}},function(e,t,i){"use strict";var n=i(15),a=i(303);e.exports=new n(a)},function(e,t,i){"use strict";e.exports={buyer:!1,typeOfTraveller:"",frequentFlyerList:[],profile:{gender:"",title:"",name:"",middleName:null,firstLastName:"",secondLastName:null,birthDate:null,prefixPhoneNumber:null,phoneNumber:null,prefixAlternatePhoneNumber:null,mobilePhoneNumber:null,alternatePhoneNumber:null,identificationType:null,identification:null,identificationExpirationDate:null,identificationCountryCode:null,identificationCountryCodeRes:null,address:{address:null,addressType:null,city:null,country:null,postalCode:null,isPrimary:!0,alias:null,state:null},cpf:null,nationalityCountryCode:null,identificationList:null,isDefault:!1},importedFromLocal:!1}},function(e,t){e.exports='<div class="od-login-social-button odf-text-nowrap login_facebook_error social_error input_wrapper">\r\n    <div class="od-login-fb-button login_facebook_button"\r\n         data-name="facebook_button"\r\n         data-error="{{ data.keys.loginSocialFacebookError }}"\r\n         data-unknown="{{ data.keys.loginSocialFacebookUnknown }}"\r\n         data-format="{{ data.keys.loginSocialMailFormat }}"\r\n         data-permissions="{{ data.keys.loginSocialFacebookPermissions }}">\r\n        <span class="od-login-social-button-icon"></span>\r\n        <span class="od-login-button-text">{{ data.keys.loginSocialFacebookTitle }}</span>\r\n    </div>\r\n</div>\r\n'},function(e,t){e.exports='<div class="od-login-social-button odf-text-nowrap login_google_error social_error input_wrapper">\r\n    <div class="od-login-gplus-button login_google_button"\r\n         data-name="google_button"\r\n         data-error="{{ data.keys.loginSocialGoogleError }}"\r\n         data-unknown="{{ data.keys.loginSocialGoogleUnknown }}"\r\n         data-format="{{ data.keys.loginSocialMailFormat }}"\r\n         data-permissions="{{ data.keys.loginSocialGooglePermissions }}">\r\n        <span class="od-login-social-button-icon"></span>\r\n        <span class="od-login-button-text">{{ data.keys.loginSocialGoogleTitle }}</span>\r\n    </div>\r\n</div>\r\n'},,function(e,t,i){"use strict";e.exports=function(e){return e.extend({initialize:function(t){this.updateDomSelectorsToCache(),e.prototype.initialize.call(this,t)},updateDomSelectorsToCache:function(){var e=this;this.$cachedSelectors=_.extend(this.$cachedSelectors||{},_.reduce(this.selectors,function(t,i,n){return t[n]=e.$el.find(i),t},{}))}})}},function(e,t,i){"use strict";var n=i(15),a=i(58).getInstance();e.exports=new n({updateBaggageSelection:function(e){var t=e.newOptionCid,i=a.getCurrentSelectedOption(t),n=this.getBaggageOptionByCid(t);a.updateOption(t,e.beforeUpdateHook,e.afterUpdateHook),e.triggerEvents&&this.triggerOnBaggageChange({currentOption:n,previousOption:i,isUserAction:e.isUserAction})},selectDefaultOption:function(e,t,i){var n=a.getRowSelection(e,t),s=a.getDefaultOption(e,t);a.selectDefaultOption(e,t),this.triggerOnBaggageChange({currentOption:s,previousOption:n,isUserAction:i})},updateAllMatchingBaggagesOptions:function(e,t){var i=_.filter(a.getOptions(e),function(e){return e.get("idPassenger")!==t});this.updateBaggagesOptions({baggagesOptions:i,triggerEvents:!0})},updateBaggagesOptions:function(e){_.each(e.baggagesOptions,function(t){this.updateBaggageSelection({newOptionCid:t.cid,isUserAction:!1,triggerEvents:e.triggerEvents})},this)},formatOption:function(e){return _.pick(e.getAll(),["pieces","kilos","price","idRow"])},getActualSelection:function(e){return _.chain(this.getAllBaggagesOptions({idPassenger:e})).filter(_.method("get","selected")).map(this.formatOption).value()},getAvailableOptions:function(e,t){var i=this.getAllBaggagesOptions({idPassenger:t});return _.filter(i,_.bind(function(t){return _.some(e,_.partial(_.isEqual,this.formatOption(t)))},this))},triggerOnBaggageChange:function(e){Odigeo.trigger("baggagesObserver:onBaggageChange",this.extendTriggerData(e))},extendTriggerData:function(e){var t=e.currentOption,i=t.get("selected")&&0===t.get("price")&&0!==e.previousOption.get("price");return _.extend({},e,{isBaggageBeingRemoved:i,idPassenger:t.get("idPassenger")})},resetMatchingBaggagesSelection:function(e){var t=a.defaultOption.extend(e),i=this.getOptions(t);_.isEmpty(i)||_.isUndefined(i)||_.each(i,function(e){a.updateBaggageSelection({newOptionCid:e.cid,isUserAction:!1,triggerEvents:!0})},this)},setDiscountFigure:function(){var e=this.options.discountFigure;_.isNull(a.discountFigure)&&a.setDiscountFigure(e)}})},function(e,t,i){"use strict";var n=i(6);e.exports=Odigeo.Model.extend({data:{},widget:{},isEmptyData:!1,minRowsToDisplay:2,maxRowsToDisplay:9,minPercentageToDisplay:5,sortCriteria:Odigeo.SessionScope.sortCriteria,numberOfDaysFlexibility:2,priceFreshnessDays:5,searchStrategy:"SEARCH_INDEXER",flexibleRoundTripFilterTypes:[{filterType:"a",days:1,fixed:!1},{filterType:"b",days:1,fixed:"returnDate",dynamic:"departureDate"},{filterType:"c",days:1,fixed:"departureDate",dynamic:"returnDate"},{filterType:"d",days:2,fixed:!1},{filterType:"e",days:2,fixed:"returnDate",dynamic:"departureDate"},{filterType:"f",days:2,fixed:"departureDate",dynamic:"returnDate"}],defaults:{cheapestPrice:0,displayHeader:!0,displayedList:[],searchParameters:{},tripType:"",usesCount:0,selectedPrice:0,firstSegmentDate:"",secondSegmentDate:"",interfaceClient:Odigeo.Utils.InterfaceClient.SMARTPHONE,isDataValid:!0,shallValidatePassengers:!1},init:function(){this.set("shallValidatePassengers",_.eq(this.widget.options.shallValidatePassengers,"true"))},url:function(){return Odigeo.Settings.property("appContext")+"/service/flow/flexibledates"},getDataRequestSettings:function(){return{type:"POST",cache:!1,success:_.bind(this.successRequest,this),data:this.getRequestParameters(),contentType:"application/json;charset=UTF-8",dataType:"json"}},getRequestParameters:function(){var e=this.get("searchParameters"),t={originGeoNode:_.get(e,"searchSegments[0].departure.geoNodeId"),departureDate:_.get(e,"searchSegments[0].dateStr"),site:Odigeo.SessionScope.website,resident:e.resident,adults:e.numAdults,children:e.numChildren,infants:e.numInfants,interfaceClient:this.get("interfaceClient"),priceCalculationCriteria:this.sortCriteria,numberOfDaysFlexibility:this.numberOfDaysFlexibility,priceFreshnessDays:this.priceFreshnessDays,searchStrategy:this.searchStrategy};return n.isRoundTrip(this.get("tripType"))?(t.destinationGeoNode=_.get(e,"searchSegments[1].departure.geoNodeId"),t.returnDate=_.get(e,"searchSegments[1].dateStr")):n.isOneWay(this.get("tripType"))&&(t.destinationGeoNode=_.get(e,"searchSegments[0].destination.geoNodeId")),JSON.stringify(t)},successRequest:function(e){this.isResponseDataValid(e)?(this.cleanResponseData(e),this.set(e),_.extend(this,e)):this.set("isDataValid",!1)},setUpData:function(){var e=Odigeo.Utils.parseJson(Odigeo.Session.get("searchParameters"));this.set("searchParameters",e),this.set("cheapestPrice",Odigeo.Session.get("cheapestItineraryPrice")),this.set("displayHeader",!0),this.set("firstSegmentDate",e.searchSegments[0].dateStr),this.set("isDataValid",!0),n.isRoundTrip(this.get("tripType"))&&this.set("secondSegmentDate",e.searchSegments[1].dateStr)},isResponseDataValid:function(e){return!(e.errors&&0<e.errors.length)&&e.matrixEntries&&0<e.matrixEntries.length},cleanResponseData:function(e){var t=this,i=this.sortCriteria;return _.forEach(e.matrixEntries,function(e){e.apparentPrices=_.find(e.apparentPrices,function(e){return e.apparentPriceCriteria===i}).apparentPrice,e.apparentPrices.amount=t.calculatePriceByPax(e.apparentPrices.amount)}),e},calculatePriceByPax:function(e){var t=this.get("searchParameters"),i=t.numAdults,n=t.numChildren,a=t.numInfants;return this.get("shallValidatePassengers")?e/(i+n+a):e},getDifferentDatesRoundTrip:function(e){var t=this,i=[],n=_.filter(this.matrixEntries,function(i){return e.fixed?t.selectFixingOneDay(i,e):t.selectSameNumberOfDays(i,e)});return 0<n.length&&(i=i.concat(n)),_.forEach(i,_.bind(function(t){t.price=t.apparentPrices.amount,t.flexibleType=e.filterType,t.cheapest=!1,t.searched=this.isSearchedRoundTrip(t.departureDate,t.returnDate)},this)),i},isSearchedRoundTrip:function(e,t){var i=this.get("searchParameters");return e===_.get(i,"searchSegments[0].dateStr")&&t===_.get(i,"searchSegments[1].dateStr")},selectSameNumberOfDays:function(e,t){var i=Odigeo.Utils.parseDate(this.get("firstSegmentDate")).getTime(),n=Odigeo.Utils.parseDate(this.get("secondSegmentDate")).getTime(),a=Odigeo.Utils.parseDate(e.departureDate).getTime(),s=Odigeo.Utils.parseDate(e.returnDate).getTime(),r=Odigeo.Utils.addDays(i,t.days),o=Odigeo.Utils.addDays(n,t.days),c=Odigeo.Utils.addDays(i,-1*t.days),d=Odigeo.Utils.addDays(n,-1*t.days);return a===r&&s===o||a===c&&s===d},selectFixingOneDay:function(e,t){var i=Odigeo.Utils.parseDate(this.get("firstSegmentDate")).getTime(),n=Odigeo.Utils.parseDate(this.get("secondSegmentDate")).getTime(),a=Odigeo.Utils.parseDate(e[t.fixed]).getTime(),s=Odigeo.Utils.parseDate(e[t.dynamic]).getTime(),r=Odigeo.Utils.addDays(s,t.days),o=Odigeo.Utils.addDays(s,-1*t.days),c="returnDate"===t.fixed?n:i,d="returnDate"===t.fixed?i:n;return a===c&&(d===r||d===o)},getRoundTripContentParams:function(e,t){var i=Odigeo.Utils.formatDate.masks.extendedDayDayMonth,n=Odigeo.Utils.formatDate(e.departureDate,i),a=Odigeo.Utils.formatDate(e.returnDate,i),s=Odigeo.Utils.splitFormatedCurrency(e.apparentPrices.amount),r=_.extend({},Odigeo.Utils.Currency,{decimalPlaces:0}),o=Math.ceil(e.apparentPrices.amount);return{dates:{departure:Odigeo.Utils.formatDate(e.departureDate,"dd/mm"),departureShortDay:Odigeo.Utils.formatDate(e.departureDate,"ddd"),return:Odigeo.Utils.formatDate(e.returnDate,"dd/mm"),returnShortDay:Odigeo.Utils.formatDate(e.returnDate,"ddd")},times:n+" - "+a,price:s.integer,priceFormatted:Odigeo.Utils.formatCurrency(o,r),flexibleType:e.flexibleType,departureDate:e.departureDate,returnDate:e.returnDate,index:t,cheaper:e.cheaper,cheapest:e.cheapest,searched:e.searched}},updateSearchObject:function(e,t){var i=Odigeo.Utils.parseJson(Odigeo.Session.get("searchParameters"));i.buyPath="CALENDAR_SEARCH_FLEXIBLE_DATES",i.searchSegments[0].dateStr=e,t&&(i.searchSegments[1].dateStr=t),Odigeo.Session.set("searchParameters",JSON.stringify(i))},processOneWayData:function(){var e=[];this.optimizeMatrixEntriesForOneWayProcessing();for(var t=-this.numberOfDaysFlexibility;t<=this.numberOfDaysFlexibility;t++){var i=this.widget.options.realSearches?this.createOneWayDataForDayFromRealSearches(t):this.createOneWayDataForDayFromMatrix(t);e.push(i)}this.set("displayedList",e)},createOneWayDataForDayFromRealSearches:function(e){var t=this.matrixEntriesByDayOffset[e],i=_.extend({},Odigeo.Utils.Currency,{decimalPlaces:0}),n=Math.ceil(t.price);return{date:t.date,price:t.price,priceFormatted:Odigeo.Utils.formatCurrency(n,i),cheapest:_.isEqual(this.get("cheapestOffset"),e),searched:t.selected,cheaper:t.price<this.get("selectedPrice"),offset:e}},createOneWayDataForDayFromMatrix:function(e){var t={date:null,priceFormatted:null,cheapest:!1,searched:0===e,cheaper:!1,offset:e},i=_.extend({},Odigeo.Utils.Currency,{decimalPlaces:0});if(this.matrixEntriesByDayOffset[e]){var n=Math.ceil(this.matrixEntriesByDayOffset[e].apparentPrices.amount);t.date=Odigeo.Utils.parseDate(this.matrixEntriesByDayOffset[e].departureDate),t.priceFormatted=Odigeo.Utils.formatCurrency(n,i),t.price=this.matrixEntriesByDayOffset[e].apparentPrices.amount,t.cheapest=this.matrixEntriesByDayOffset[e].cheapest,t.cheaper=this.matrixEntriesByDayOffset[e].cheaper,t.cheaperDay=this.matrixEntriesByDayOffset[e].cheaper}else t.date=Odigeo.Utils.parseDate(this.get("firstSegmentDate")),t.date.setDate(t.date.getDate()+e);if(0===e){var a=Math.ceil(this.get("cheapestPrice"));t.price=this.get("cheapestPrice"),t.priceFormatted=Odigeo.Utils.formatCurrency(a,i)}return t.dates={departure:Odigeo.Utils.formatDate(t.date,"dd/mm"),departureShortDay:Odigeo.Utils.formatDate(t.date,"ddd")},t.date=Odigeo.Utils.formatDate(t.date,"ddd d/mm"),t},optimizeMatrixEntriesForOneWayProcessing:function(){this.widget.options.realSearches?this.optimizeMatrixEntriesForOneWayProcessingFromRealSearches():this.optimizeMatrixEntriesForOneWayProcessingFromMatrix()},getMainSearchDate:function(e){return this.convertRealSearchDates(_.find(e,"main").departureDate)},convertRealSearchDates:function(e){return Odigeo.Utils.formatDate(Odigeo.Utils.parseDate(e,"dd/mm/yyyy"),Odigeo.Utils.formatDate.masks.isoDate)},optimizeMatrixEntriesForOneWayProcessingFromRealSearches:function(){var e=[],t=this.getMainSearchDate(this.get("realSearches"));_.each(this.get("realSearches"),function(i){var n=Odigeo.Utils.getDifferenceInDays(Odigeo.Utils.parseDate(t),Odigeo.Utils.parseDate(i.departureDate,"dd/mm/yyyy"));e[n]=_.assign(i,{apparentPrices:{amount:i.price},offSet:n,date:Odigeo.Utils.formatDate(Odigeo.Utils.parseDate(i.departureDate,"dd/mm/yyyy"),"ddd d/mm")})}),this.matrixEntriesByDayOffset=e,this.set("cheapestOffset",_.min(this.get("realSearches"),"price").offSet)},optimizeMatrixEntriesForOneWayProcessingFromMatrix:function(){var e={0:{departureDate:this.get("firstSegmentDate"),apparentPrices:{amount:this.get("cheapestPrice")}}},t=this.numberOfDaysFlexibility,i=this.get("cheapestPrice"),n=i,a=0,s=Odigeo.AB.getFlexibleDatesOW;_.each(this.matrixEntries,function(r){(e[r.matrixColumn-t]=r).matrixColumn===t&&(r.apparentPrices.amount=i),r.apparentPrices.amount<n&&(a=r.matrixColumn-t,n=r.apparentPrices.amount),r.apparentPrices.amount<i&&s!==Odigeo.Utils.Partition.B&&(r.cheaper=!0),r.price=r.apparentPrices.amount}),0===a&&s===Odigeo.Utils.Partition.C||(e[a].cheapest=!0),this.matrixEntriesByDayOffset=e},shouldOneWayBeRenderedOnSummary:function(){var e=Odigeo.AB.isFlexibleDatesSummaryOW&&"summary"===this.widget.options.page&&_.filter(this.get("flexibleDatesInfoFormatteds"),_.bind(function(e){return e.price<=this.get("actualPrice")},this)).length;return e||Odigeo.trigger(this.widget.id+":hideFlexibleDatesSummary"),e},shouldOneWayBeRenderedOnResults:function(){return(_.gt(Odigeo.AB.getFlexibleDatesOW,Odigeo.Utils.Partition.A)||_.eq(Odigeo.AB.getDesktopFlexibleDatesOneWayImprovements,Odigeo.Utils.Partition.B)||_.eq(Odigeo.AB.getMobileFlexibleDatesOneWayImprovements,Odigeo.Utils.Partition.B))&&"results"===this.widget.options.page},shouldOneWayBeRendered:function(){return(1<this.numberOfDaysWithPrice()||!!this.numberOfValidRealSearches())&&(this.shouldOneWayBeRenderedOnResults()||this.shouldOneWayBeRenderedOnSummary())&&n.isOneWay(this.get("tripType"))},shouldRoundTripBeRendered:function(){return n.isRoundTrip(this.get("tripType"))&&this.isFlexibleDatesRoundTripActivated()},isFlexibleDatesRoundTripActivated:function(){return _.eq(Odigeo.AB.getDesktopFlexibleDatesRoundTrip,Odigeo.Utils.Partition.B)||_.eq(Odigeo.AB.getMobileFlexibleDatesRoundTripImprovements,Odigeo.Utils.Partition.B)||_.eq(Odigeo.AB.getFlexibleDatesRT,Odigeo.Utils.Partition.B)||_.eq(Odigeo.AB.getFlexibleDatesRT,Odigeo.Utils.Partition.C)},numberOfValidRealSearches:function(){return!!this.widget.options.realSearches&&_.filter(this.get("realSearches"),"valid").length},numberOfDaysWithPrice:function(){var e=this.get("firstSegmentDate");return _.filter(this.matrixEntries,function(t){return t.departureDate!==e}).length},getOneWayEntryWithOffset:function(e){return this.matrixEntriesByDayOffset[e]},getFlexibleDatesRest:function(){this.fetch({type:"GET",url:Odigeo.Settings.property("appContext")+"/service/flow/flexibledates/format",success:_.bind(this.widget.getFlexibleDatesInfo,this.widget)})},cleanData:function(){this.unset("matrixEntries"),this.unset("realSearches"),this.unset("displayedList")},processRoundTripData:function(){var e=[];if(_.each(this.flexibleRoundTripFilterTypes,_.bind(function(t){var i=this.maxRowsToDisplay-e.length;if((e=e.concat(this.getDifferentDatesRoundTrip(t,i))).length===this.maxRowsToDisplay)return!1},this)),e.length<this.minRowsToDisplay)return!1;e=this.sortByFlexibleType(e),e=this.setCheaperDays(e),(Odigeo.AB.getDesktopFlexibleDatesRoundTrip||Odigeo.AB.getMobileFlexibleDatesRoundTripImprovements)&&e.unshift(this.createCurrentDayItem()),e=this.setCheapestDay(e),this.set("displayedList",this.getRoundTripDataRows(e))},sortByFlexibleType:function(e){return _.sortBy(e,"flexibleType")},setCheaperDays:function(e){var t=this.get("cheapestPrice");return _.map(e,function(e){return e.cheaper=_.gt(t,e.apparentPrices.amount),e})},setCheapestDay:function(e){return _.min(e,_.property("apparentPrices.amount")).cheapest=!0,e},getRoundTripDataRows:function(e){return _.map(e,this.getRoundTripContentParams)},createCurrentDayItem:function(){var e=this.get("searchParameters");return{departureDate:_.get(e,"searchSegments[0].dateStr"),returnDate:_.get(e,"searchSegments[1].dateStr"),apparentPrices:{amount:this.get("cheapestPrice")},cheapest:!1,searched:!0}},getPriceSavings:function(e){var t=this.get("cheapestPrice"),i=t-_.min(_.filter(e,{searched:!1}),_.property("price")).price;return Math.floor(i/t*100)},getNumOptionsForTracking:function(){return n.isOneWay(this.get("tripType"))?this.numberOfDaysWithPrice()||this.numberOfValidRealSearches():_.get(this.get("displayedList"),"length",0)},getItemFromIndex:function(e){return this.get("displayedList")[e]},getTrackingPriceDifference:function(){var e=this.get("selectedPrice"),t=this.get("cheapestPrice"),i=Math.round(100*(1-e/t));return this.getNumberForTracking(i,2)},getNumberForTracking:function(e,t){var i=Number(_.padLeft("",t,9)),n=0<=e?"+":"-",a=_.round(Math.abs(e));return a=i<a?i:a,n+_.padLeft(a,t,0)},getCheapestDisplayDay:function(){return _.min(this.get("displayedList"),_.property("price")).price},getExpensiveDisplayDay:function(){return _.max(this.get("displayedList"),_.property("price")).price},updateSelectedData:function(e){this.updateSearchObject(e.departureDate,e.returnDate),this.set("selectedPrice",e.price),this.set("usesCount",this.get("usesCount")+1)}})},function(e,t,i){"use strict";var n,a=i(14),s=i(83);e.exports=Backbone.View.extend({initialize:function(e){this.identifier="fare-upgrade-selector",this.template=e.template,this.bindEvents(),this.fareUpgradeSeleted,n=a.getInstance()},render:function(){return this.$el.html(this.getTemplate(this.model.toJSON())),this.texts={with:this.$el.find(".fare_upgrade_panel_continue_with").html(),without:this.$el.find(".fare_upgrade_panel_continue_without").html(),selected:this.$el.find(".fare_upgrade_panel_continue_selected").html()},this.isRefundableFareAddedToCart()?this.onBookBtnFareContainerSelected():this.onBookBtnFareContainerNotSelected(),this},templateSettings:Odigeo.Utils.getTmplSettings({variable:""}),getTemplate:function(e){return this.template(_.extend(e,{styles:e.styles||{}}))},bindEvents:function(){this.$el.on("tap",".book_with_fare_btn_not_selected:not(.disabled)",_.bind(this.onBookBtnFareContainerNotSelected,this)),this.$el.on("tap",".book_with_fare_btn_selected:not(.disabled)",_.bind(this.onBookBtnFareContainerSelected,this)),this.$el.on("tap",".results_fare_upgrade_terms",_.bind(this.onTermsAndConditionsLink,this))},onBookBtnFareContainerNotSelected:function(e){this.model.get("showSelectedStatus")&&(this.$el.find(".book_with_fare_btn_not_selected").addClass("checked").html(this.texts.selected),this.$el.find(".book_with_fare_btn_selected").removeClass("checked").html(this.texts.with)),(this.fareUpgradeSeleted||_.isUndefined(this.fareUpgradeSeleted))&&s.trackOnSubmitFairUpgradeSelection({action:"results_list",selected:!1}),this.triggerEvent(e),this.fareUpgradeSeleted=!1,Odigeo.trigger(this.identifier+":fareUpgradeUnselected",e)},onBookBtnFareContainerSelected:function(e){this.model.get("showSelectedStatus")&&(this.$el.find(".book_with_fare_btn_selected").addClass("checked").html(this.texts.selected),this.$el.find(".book_with_fare_btn_not_selected").removeClass("checked").html(this.texts.without)),this.fareUpgradeSeleted||s.trackOnSubmitFairUpgradeSelection({action:"results_list",selected:!0}),this.triggerEvent(e),this.fareUpgradeSeleted=!0,Odigeo.trigger(this.identifier+":fareUpgradeSelected",e)},triggerEvent:function(e){Odigeo.trigger(this.identifier+":fareUpgradeClicked",e)},isRefundableFareAddedToCart:function(){return n.isLoaded()&&n.getInsuranceByPolicy("CANXSELF").preselected},onTermsAndConditionsLink:function(){s.trackOnClickFareUpgradeTermsAndConditions({action:"results_list"})}})},,function(e,t,i){"use strict";var n=i(152),a=i(143);function s(e,t){return e===_.last(_.keys(t))}function r(e){return Odigeo.Utils.breakTextToMultipleLines(e).join("</br>")}function o(e){return _.isEmpty(e)?"":e.replace(/\n/g,"</br>")}function c(e){var t=e.get("accommodationDealInformation")||{};return{accommodationDealInformation:t,namesGroupsFacilities:n,hasDescription:a.hasSomeDataFilled([t.description,e.get("infoZone"),e.get("locationDescriptor")]),hasPolicies:a.hasSomeDataFilled([e.get("hotelPolicy"),e.get("checkInPolicy"),e.get("checkOutPolicy"),t.cancellationPolicyDescription])}}e.exports={getAccommodationDetailsData:function(e,t){return _.extend({},e.toJSON(),c(e),{hasReviews:_.isFinite(parseInt(e.get("tripadvisorId"),10)),roomSelectionTestPartition:t.roomSelectionTestPartition,isLastGroupFacility:_.partialRight(s,e.get("groupFacilities")),printPolicy:r,replaceNewLineWithBr:o,isLightbox:!!t.isLightbox})},getAccommodationDetailsTabsData:function(e){return _.extend({},e.toJSON(),c(e),{hasReviews:!_.isNull(e.get("tripAdvisorId")),hasServices:!_.isEmpty(e.get("groupFacilities"))})},replaceNewLineWithBr:o,printPolicy:r}},,,function(e,t,i){"use strict";var n,a;function s(e){if(Array.isArray(e)){for(var t=0,i=Array(e.length);t<e.length;t++)i[t]=e[t];return i}return Array.from(e)}function r(e,t,i){return t in e?Object.defineProperty(e,t,{value:i,enumerable:!0,configurable:!0,writable:!0}):e[t]=i,e}var o=i(491),c=i(21),d={ED:"edreams",OP:"opodo",GV:"govoyages",TL:"travellink"},l=/(\|)(?!.*\|)(.*)/,g=(r(n={},c.mytripsdetails_hotels_emerginglayer,"s.layer_emlold"),r(n,c.mytripsdetails_hotels_iframe,"s.cp_emlold"),n),h=(r(a={},c.mytripsdetails_hotels_emerginglayer,"s.layer_emlnew"),r(a,c.mytripsdetails_hotels_iframe,"s.mb_emlnew"),a);e.exports={replaceWapb3ForAb:function(e,t,i){if(1!==i){var n=function(e){var t=void 0,i=void 0;if(!_.isEmpty(e)){var n=e.indexOf("wapb3=");if(-1!==n){t=n;var a=e.indexOf("&",n+1);i=-1===a?e.length:a}}return[t,i]}(e);if(_.isEmpty(n.wapb3StartingPosition)){var a=function(e,t,i){return e.slice(t,i)}.apply(void 0,[e].concat(s(n)));r=a,c=t,d=void 0,3===(o=i)?d=r.replace(l,"|"+h[c]):2===o&&(d=r.replace(l,"|"+g[c])),a=d,e=function(e,t,i){return e.slice(0,t)+e.slice(i+1)}.apply(void 0,[e].concat(s(n)))+"&"+a}}var r,o,c,d;return e},getMemberDiscountParams:function(){var e=o.v4();return"&rffrid=h4p.hcom."+d[_.get(Odigeo,"SessionScope.brand")]+".000.000&intlid="+e}}},function(e,t,i){"use strict";$(function(){Odigeo.defineWidget("app_root",Odigeo.RootComponent)})},,,,,,function(e,t,i){"use strict";Odigeo.defineWidget("gdpr_newsletter",Odigeo.Widget.extend({viewClass:i(183)}))},function(e,t,i){"use strict";var n=i(0);e.exports=Odigeo.View.extend({selectors:{containerSubscriptionLink:".od_newsletter_subscription_link_container",unsubscribeLink:".price_manager_unsubscribe_link",subscribeLink:".price_manager_subscribe_link",newsletterModal:".price_manager_subscribe_modal"},tmpls:{mainTemplate:"#call-us-header-template"},events:{"tap @subscribeLink":"onClickNewsletterSubscription","tap @unsubscribeLink":"onClickNewsletterUnsubscription"},init:function(){this.toggleNewsletterSubscriptionStatus()},onClickNewsletterSubscription:function(){this.manageNewsletterSubscription("S")},onClickNewsletterUnsubscription:function(){this.manageNewsletterSubscription("U")},manageNewsletterSubscription:function(e){var t="U"===e?"unsubscribe":"subscribe";this.$cachedSelectors.newsletterModal.removeClass("odf-hidden"),n.trackEvent("payment_details","link_newsletter_"+t),Odigeo.Storage.set("changeNewsletterSubscriptionToken",e),setTimeout(_.bind(this.toggleNewsletterSubscriptionStatus,this),5e3)},toggleNewsletterSubscriptionStatus:function(){var e="U"===Odigeo.Storage.get("changeNewsletterSubscriptionToken");this.$cachedSelectors.containerSubscriptionLink.toggleClass("od-suscribe",e),this.$cachedSelectors.containerSubscriptionLink.toggleClass("od-unsuscribe",!e),this.$cachedSelectors.newsletterModal.addClass("odf-hidden")}})},function(e,t,i){"use strict";$(function(){var e=["xsellproductselection","pbpayment","flights_pay_page","confirmation","flights_confirmation_page","flights_confirmation_page_confirmed","flights_confirmation_page_rejected","flights_confirmation_page_pending"];function t(){return document.location.pathname.replace(Odigeo.Settings.getProperty("appContext"),"").replace(/^\/+|\/+$/g,"")}function i(){return"mobile"===_.get(Odigeo,"SessionScope.flow","desktop")?"dynpack_flight_results":"dynpack_results"}function n(t,i){var n=_.isUndefined(t)||-1!==e.indexOf(t),a=Odigeo.Session&&"true"===Odigeo.Session.get("isAccommodationPostBooking"),s=_.isUndefined(i)?-1:-1===i.indexOf("pb_");return n&&a&&s?"pb_"+i:i}Odigeo.defineWidget("googleanalytics",Odigeo.Widget.extend({modelClass:Odigeo.Model.extend({customVariables:{},userId:null,userIdCookieName:"UTM_user_id",gaActiveSessionCookieName:"_gaActiveSession",dimension31CookieName:"ua_dimension31",isAnalyticsUniversalActive:!1,hasTrackedVirtualPage:!1,hasSetDefaultCustomDimensions:!1,pluginsRequired:[],postponedPageviews:[],postponedEvents:[],updatingUserIdFromBoxever:!1,currentVirtualPage:null,eventTrackingCategoryDictionary:{home:{"":"home","/":"home",home:"home","flights/dates":"home","flights/departure0":"home","flights/departure1":"home","flights/departure2":"home","flights/departure3":"home","flights/departure4":"home","flights/departure5":"home","flights/destination0":"home","flights/destination1":"home","flights/destination2":"home","flights/destination3":"home","flights/destination4":"home","flights/destination5":"home","flights/passengers":"home",myinfo:"static_myinfo",settings:"static_settings",mytrips:"static_mytrips",about:"static_about",contact:"static_contact",securedcontact:"static_contact",masthead:"static_masthead",terms:"static_terms",error:"static_error",header:"header",register:"sso_register",accountblocked:"sso_blocked",resetpassword:"sso_change_pwd",frequentpassengers:"sso_frequent_passengers",accountpreferences:"sso_account_preferences",xsellproductselection:"intermediate_page",xsellproductselectionmetas:"intermediate_page_metas",android_app_layer:"android_app_layer",iphone_app_layer:"iphone_app_layer",filters:"intermediate_page"},dp:{"":"dynpack_tab","/":"dynpack_tab",home:"dynpack_tab",header:"dynpack_tab",notification_center:"dynpack_tab",sso_module:"sso_module",dpresults:i(),dpresults_flights:i(),dpresident:"dynpack_residents_page",roomselection:"dynpack_room_selection",flights_results:"dynpack_flight_results","details-extras":"dynpack_pax_page",details:"dynpack_pax_page",passengersinfo:"dynpack_pax_page",payment:"dynpack_pay_page",pbpayment:"dynpack_pay_page",ancillaries:"dynpack_ancillaries_page",selection:"dynpack_ancillaries_page",additions:"dynpack_additions_page",confirmation:"dynpack_confirmation_page",flights_confirmation_page:"dynpack_confirmation_page",flights_confirmation_page_confirmed:"dynpack_confirmation_page_confirmed",flights_confirmation_page_rejected:"dynpack_confirmation_page_rejected",flights_confirmation_page_pending:"dynpack_confirmation_page_pending",flights_pax_page:"dynpack_pax_page",flights_pay_page:"dynpack_pay_page",flights_ancillaries_page:"dynpack_ancillaries_page",flights_canxself_page:"dynpack_canxself_page",flights_insurance_page:"dynpack_insurance_page",flights_so_page:"dynpack_so_page",dynpack_hotel_results:"dynpack_hotel_results",dpresults_accommodation:"dynpack_hotel_results",filters:"dynpack_hotel_results",filter:"dynpack_flight_results",insurance:"dynpack_insurance_page",insurances:"dynpack_insurance_page",booking:"summary",dpresults_accommodation_details:"dynpack_room_selection",servicepack:"dynpack_so_page"},flights:{"":"flights_tab","/":"flights_tab",flights:"home",home:"flights_tab",header:"flights_tab",notification_center:"flights_tab",sso_module:"flights_tab",xsellproductselection:"intermediate_page",xsellproductselectionmetas:"intermediate_page_metas",filters:"intermediate_page",flightsummary:"flights_summary",flightinfo:"flights_info",insurance:"flights_insurance_page",insurances:"flights_insurance_page",flex:"flights_flex_page",servicepack:"flights_so_page","details-extras":"flights_pax_page",results:"flights_results",search_waiting:"search_waiting",filter:"flights_results",details:"flights_pax_page",passengersinfo:"flights_pax_page",ancillaries:"flights_ancillaries_page",canx:"flights_canxself_page",selection:"flights_ancillaries_page",additions:"flights_additions_page",payment:"flights_pay_page",pbpayment:"dynpack_pay_page",confirmation:"flights_confirmation_page",flights_confirmation_page_confirmed:"flights_confirmation_page_confirmed",flights_confirmation_page_rejected:"flights_confirmation_page_rejected",flights_confirmation_page_pending:"flights_confirmation_page_pending",resident:"flights_residents_page",android_app_layer:"android_app_layer",iphone_app_layer:"iphone_app_layer",my_area_trips:"my_area_trips",my_area_trips_details:"my_area_trips_details",trip_summary:"trip_summary",accommodation_details:"intermediate_room_selection",flights_results:"flights_results",roomselection:"room_selection"},cms:{"":t(),"/":t(),home:t()},trackingTool:{home:"home","/vuelos/":"flights",resident:"resident",results:"results",payment:"payment",details:"details","flights/waiting/1":"waitresults","flights/waiting/2":"waitpassengers","flights/waiting/3":"waitpayment","flights/waiting/4":"","flights/waiting/5":"waitconfirmation","sm/flights/waiting/1":"waitresults","sm/flights/waiting/2":"","sm/flights/waiting/3":"","sm/flights/waiting/4":"waitpassengers","sm/flights/waiting/5":"waitpayment","sm/flights/waiting/6":"waitconfirmation","details-extras":"passengers",payment3ds:"payment3ds","/flights/dates/":"flightdates",confirmation:"confirmation","/flights/departure0/":"departure0","/flights/departure1/":"departure1","/flights/departure2/":"departure2","/flights/departure3/":"departure3","/flights/departure4/":"departure4","/flights/departure5/":"departure5","/flights/destination0/":"destination0","/flights/destination1/":"destination1","/flights/destination2/":"destination2","/flights/destination3/":"destination3","/flights/destination4/":"destination4","/flights/destination5/":"destination5","/flights/passengersSelection/":"passengers",summary:"flightsummary",flightinfo:"flightinfo",insurances:"insurances","/flights/insurances/conditions":"insuranceconditions",filter:"filter",edit:"home",register:"","dynpack/waiting/1":"","dynpack/waiting/3":"","dynpack/waiting/4":"","dynpack/waiting/5":"","dynpack/waiting/2":"","room-selection":"",dpresults:"",roomselection:""}},pageVirtualApplicationDictionary:{"":"home",dpresults:"results",dpresident:"resident",roomselection:"room-selection",flex:"flex_page",canx:"cancellation-guarantee","ancillaries/canx":"cancellation-guarantee","ancillaries/selection":"ancillaries","ancillaries/additions":"additions"},brandDictionary:{ED:"eDreams",OP:"Opodo",GV:"Go Voyages",TL:"Travellink"},appPages:["","/","home","flights","results","flights-results","hotel-results","room-selection","edit","flights-filter","hotel-filter","summary","flightinfo","dp-upsell","dp-upsell-meta","cancellation-guarantee","flex_page","insurances","service_options","details-extras","details","passengersinfo","payment","confirmation","resident","redirection-3dsecure","ancillaries"],customVarPages:{"":"home",details:"details-extras",passengersinfo:"details-extras",dpresults:"results",roomselection:"room-selection"},_setCustomVar:function(e){_gaq.push(["_setCustomVar",parseInt(e.index,10),e.name,_.isUndefined(e.value)?"B":e.value,parseInt(e.scope,10)])},_removeCustomVar:function(e){_gaq.push(["_deleteCustomVar",parseInt(e,10)])},_gaqInit:function(e){var t=this.options.isBookingXSWhiteLabel?"bookingcom.":"";_gaq.push(["_setAccount",e],["_setDomainName",t+this.widget.options.mainDomain],["_setAllowLinker",!0],["_setCampaignCookieTimeout",2592e6]),_.isEmpty(this.widget.options.googleCodeCustomVar)||this._setCustomVar({index:30,name:this.widget.options.googleCodeCustomVar,scope:2}),this._setCustomVar({index:32,name:"sessionId",value:this.widget.options.dapiSessionId,scope:2})},_loadAnalyticsPremiumLibrary:function(){var e,t=document.createElement("script");t.type="text/javascript",t.async=!0,t.src=("https:"===document.location.protocol?"https://":"http://")+"stats.g.doubleclick.net/dc.js",(e=document.getElementsByTagName("script")[0]).parentNode.insertBefore(t,e)},pushReferrerFromSessionStorageKey:function(e,t){e&&(t?this.gaWrapper("set","referrer",e):_gaq.push(["_setReferrerOverride",e]))},_initializeGoogleAnalyticsPremium:function(e){window._gaq=window._gaq||[],window._gat=window._gat||[],_.isEmpty(e.hasAnonymizeIp)||!0!==$.parseJSON(e.hasAnonymizeIp)||_gaq.push(["_gat._anonymizeIp"]),this._gaqInit(e.googleCode),_gaq.push(function(){Odigeo.Session.set("hasToRemoveUtmParameters",!0)})},_initializeCustomVariables:function(e){if(e.abTestCustomVariables){var t=e.abTestCustomVariables;_.each(t,function(e){var t=this._sanitizePages(e.pages);this._initializeCustomVariablesPage(t,e)},this)}},_sanitizePages:function(e){var t=e.split(",");return _.map(t,function(e){return e.trim()})},_initializeCustomVariablesOnPageLoad:function(e,t){_.isUndefined(this.customVariables[e])&&(this.customVariables[e]=[]),this.customVariables[e].push(t)},_initializeCustomVariablesOnEvents:function(e,t){$("#"+e).on(t.event,t.selector,_.bind(function(){this._setCustomVar(t)},this))},_initializeCustomVariablesPage:function(e,t){_.each(e,function(e){e=this.customVarPages[e]||e,_.find(this.customVariables[e],t)||(_.isUndefined(t.event)?this._initializeCustomVariablesOnPageLoad(e,t):this._initializeCustomVariablesOnEvents(e,t))},this)},gaWrapper:function(){var e=[].slice.call(arguments,0);_.each(this.getTrackers(),function(t){e[0]=this.prependActionWithTrackerName(t,e[0]),window.ga.apply(null,e)},this)},prependActionWithTrackerName:function(e,t){return 1===this.getTrackers().length?t:e.get("name")+"."+t},getTrackers:function(){return window.ga.getAll?window.ga.getAll():[]},initializeGoogleAnalyticsUniversal:function(e){Odigeo.AB.hasToSetTrackingCookiesOnServerSide&&this.setCookiesServerSide(),this.gaWrapper("require","displayfeatures"),this.pushReferrerFromSessionStorageKey(e.overriddenReferrer,!0),this.initAnonymizeIpUniversal(e),this.getDefaultCustomDimensions(),this.setClientId(),this.gaWrapper("set","hitCallback",_.bind(this.onUniversalAnalyticsInitialized,this))},onUniversalAnalyticsInitialized:function(){this.setCookieActiveGaSession()},setClientId:function(){this.gaWrapper(_.bind(function(e){this.setCustomDimension({customDimension:"36",value:e.get("clientId")})},this))},setCookieActiveGaSession:function(){Odigeo.Utils.createCookie(this.gaActiveSessionCookieName,1,1/24/2)},setCookiesServerSide:function(){var e=Odigeo.Settings.property("trackingServiceUrlFormatter")("cookies/setServerSide");this.fetch({url:e})},getDefaultCustomDimensions:function(){var e=Odigeo.Settings.property("trackingServiceUrlFormatter")("ua/customDimensions");this.fetch({url:e,success:_.bind(function(e,t){this.setDefaultCustomDimensions(t)},this),error:_.bind(this.setDefaultCustomDimensions,this,{})})},setDefaultCustomDimensions:function(e){var t={dimension7:this.widget.options.dapiSessionId,dimension8:this.widget.options.locale,dimension9:this.widget.options.flow.charAt(0).toUpperCase(),dimension31:Odigeo.Utils.readCookie(this.dimension31CookieName)||"non-subscriber",dimension58:document.location.href};if("true"===this.widget.options.isNativeInterface){var i=Odigeo.Device.navigator.isIOSWebView?"IOS_":"ANDROID_",n={ED:"EDREAMS",GV:"GOV",OP:"OPODO",TL:"TRAVELLINK"}[Odigeo.SessionScope.brand];t=_.extend(t,{dimension40:i+n,dimension9:"A_"+i.charAt(0)})}this.gaWrapper("set",_.extend(e,t)),this.hasSetDefaultCustomDimensions=!0,this.trackPostponedPageviews()},trackPostponedPageviews:function(){_.each(this.postponedPageviews,this.trackVirtualPageInUniversal,this),this.postponedPageviews=[]},initAnonymizeIpUniversal:function(e){_.isEmpty(e.hasAnonymizeIp)||!0!==$.parseJSON(e.hasAnonymizeIp)||this.gaWrapper("set","anonymizeIp",!0)},_getRefererOverride:function(){var e="distil_referrer",t=Odigeo.Session.get(e);return Odigeo.Session.remove(e),t},init:function(){this.options=Odigeo.parseOptions(this.widget.options);var e=this.options;this._initializeGoogleAnalyticsPremium(e),e.overriddenReferrer=this._getRefererOverride(),this.isAnalyticsUniversalActive=!_.isUndefined(window.ga),this.isAnalyticsUniversalActive&&this.initializeGoogleAnalyticsUniversal(e),this.pushReferrerFromSessionStorageKey(e.overriddenReferrer,!1),this._initializeCustomVariables(e),this._loadAnalyticsPremiumLibrary(),this._trackCustomVariables(),Odigeo.trigger("google-analytics:constructed")},_trackCustomVariables:function(){var e=Odigeo.Utils.parseJson(this.widget.options.customVariables),t=1;_.each(e,_.bind(function(e,i){this._setCustomVar({index:t,name:i,scope:2,value:e}),t++},this)),this._setCustomVar({index:31,name:"release_number",scope:2,value:Odigeo.SessionScope.oneFrontVersion})},addProductsWrapper:function(e){_.each(e,function(e){this.gaWrapper("ec:addProduct",e)},this)},trackECommerceAddProducts:function(e){this.addProductsWrapper(e.flightItemsUniversal),this.addProductsWrapper(e.dynpackItemsUniversal),this.addProductsWrapper(e.insuranceItemsUniversal),this.addProductsWrapper(e.ancillaryItemsUniversal),this.addProductsWrapper(e.membershipItemsUniversal),this.addProductsWrapper(_.has(e,"accommodationItemUniversal")?[e.accommodationItemUniversal]:[]),_.isEmpty(e.membershipItemsUniversal)||(Odigeo.Utils.createCookie(this.dimension31CookieName,"subscriber",30),this.setCustomDimension({customDimension:"31",value:"subscriber"}))},trackECommerceUniversal:function(e){var t=e.transactionUniversal;this.requirePlugin("ec"),this.gaWrapper("set","&cu","EUR"),this.trackECommerceAddProducts(e),this.gaWrapper("ec:setAction","purchase",t)},trackECommercePremium:function(e){var t=e.transaction;_gaq.push(["_addTrans",t.orderId,t.affiliate,t.total,t.tax,t.shipping,"","",""]),_.each(e.items,function(e){_gaq.push(["_addItem",e.orderId,e.sku,e.prodName,e.category,e.unitPrice,e.quantity])},this),_gaq.push(["_trackTrans"])},trackECommerce:function(e){_.isNull(e)||!1!==e.fakeTransaction||(this.trackECommerceUniversal(e),e.transaction&&this.trackECommercePremium(e))},hasToSendUniversal:function(e,t,i){return!_.some([{category:"intermediate_page",action:"back_end_errors",label:"session_expiring_warning"},{category:"intermediate_page",action:"back_end_errors",label:"session_warning_final"},{category:"flights_results",action:"back_end_errors",label:"session_expiring_warning"},{category:"flights_results",action:"back_end_errors",label:"session_warning_final"}],{category:e,action:t,label:i})},trackEvent:function(e){if(e.label=this._getLabel(e),this.hasTrackedVirtualPage){var t=Odigeo.Utils.isWebmasterPage()?"cms":Odigeo.Utils.getAppInGlobalScope(),i=this._getCategory(e,t);this.isAnalyticsUniversalActive&&this.hasToSendUniversal(i,e.action,e.label)&&this.trackEventUniversal(e,i),this.trackOptimizeEvent(e,i)}else this.postponedEvents.push(e)},trackEventUniversal:function(e,t){var i={nonInteraction:!0,page:this.currentVirtualPage},n=["send","event",t,e.action,e.label];e.value&&n.push(e.value),e.transport&&(i.transport=e.transport),n.push(i),this.gaWrapper.apply(this,n)},trackTiming:function(e){var t=Odigeo.Utils.getAppInGlobalScope(),i=this._getCategory(e,t);_gaq.push(["_trackTiming",i,e.variable,e.time,e.opt_label,e.opt_sampleRate])},processMetasPage:function(e){var t=_.isEmpty(Odigeo.Session.get("isMetaForIntermediate"))?"":"metas";return"xsellproductselection"===e.page?e.page+t:e.page},_getLabel:function(e){var t=this.processMetasPage(e);return n(t=t||e.category,e.label)},_getCategory:function(e,t){t="upsell"===t?"dp":t;var i=this.processMetasPage(e),a="dp"!==t||_.isUndefined(e.category)?_.isUndefined(i)||_.isUndefined(this.eventTrackingCategoryDictionary[t])?e.category:this.eventTrackingCategoryDictionary[t][i]:this.eventTrackingCategoryDictionary[t][e.category];return n(i,_.isUndefined(a)?e.category:a)},sendToPageSelf:function(e){var t=e.url;e.goOutside=_.isUndefined(e.goOutside)?this.prepareLinkToTrackCrossDomain(t)!==t:e.goOutside,e.goOutside?(t=this.isAnalyticsUniversalActive?this._prepareUrlToTrackCrossDomainUniversal(t):t,_.isArray(_gaq)?document.location=t:_gaq.push(["_link",t])):document.location=e.url},sendToPageBlank:function(e){e.goOutside?window.open(this.prepareUrlToTrackCrossDomain(e.url,e.onlyUniversal)):window.open(e.url)},isWaitingPage:function(e){return/^waiting(\/\d|-3dsecure)$/g.test(e)},_getFunnel:function(e,t){var i=Odigeo.Utils.parseJson(Odigeo.Session.get("isAccommodationPostBooking"))?"hotels":Odigeo.Utils.getFunnelInGlobalScope(),n=Odigeo.Utils.isWebmasterPage(),a=-1<_.indexOf(this.appPages,e)&&!_.isUndefined(i),s="string"==typeof t&&""!==t&&t,r=!0===t&&"flights",o=!n&&(a||this.isWaitingPage(e))&&i,c=s||o||r;return c?c+"/":""},_getPage:function(e){return Odigeo.Utils.isWebmasterPage()?t():this.pageVirtualApplicationDictionary[e.page]||e.page},trackPostponedEvents:function(){_.each(this.postponedEvents,this.trackEvent,this),this.postponedEvents=[]},trackVirtualPage:function(e){this.trackVirtualPageInClassic(e),this.trackInTrackingTool(e),this.isAnalyticsUniversalActive?this.hasSetDefaultCustomDimensions?this.trackVirtualPageInUniversal(e):this.postponedPageviews.push(e):(this.hasTrackedVirtualPage=!0,this.trackPostponedEvents())},trackVirtualPageInClassic:function(e){this._trackCustomVarsForPageview(e);var t=this._generatePageviewPremium(e);this._trackPageviewInPremium(t,e),this._setDefaultCustomVar(e)},_trackCustomVarsForPageview:function(e){var t=this.customVarPages[e.page]||e.page;_.isUndefined(e.customVar)||(this._removeCustomVar(30),this._setCustomVar(e.customVar)),_.isUndefined(this.customVariables[t])||_.each(this.customVariables[t],function(e){this._setCustomVar(e)},this)},getFunnelPrefix:function(){return Odigeo.Utils.parseJson(Odigeo.Session.get("isAccommodationPostBooking"))?"/PB":"/BF"},_generatePageviewPremium:function(e){var t=this.widget.options.locale.split("_"),i=t[0],n=t[1],a=this.widget.options.flow,s=e.funnel?this.getFunnelPrefix():"",r="/L_"+i,o="/C_"+n,c="desktop"!==a?"/A_"+a:"",d=this._getPage(e);return s+r+o+c+"/"+this._getFunnel(d,e.funnel)+d+(_.isUndefined(e.error)?"":"popin"===e.error.type?"-popin-error":"_error_"+e.error.message)+"/"},_generatePageviewUniversal:function(e){var t=e.funnel?this.getFunnelPrefix():"",i=this._getPage(e);return t+"/"+this._getFunnel(i,e.funnel)+(e.error?"error/":"")+i+(_.isUndefined(e.error)?"":"popin"===e.error.type?"-popin-error":"_error_"+e.error.message)+"/"},configureFieldsObjectForPageview:function(e){var t={dimension33:Odigeo.Utils.readCookie("mktTrack")},i=this.extractDomain(document.referrer),n=this.options.selfReferrals,a=_.isArray(n)?n:new Array(n),s=-1!==location.search.indexOf("_ga="),r="1"===Odigeo.Utils.readCookie(this.gaActiveSessionCookieName);return!_.contains(a,i)||s||r||(t.campaignSource="referral",t.campaignMedium=i),_.extend(t,this.getSearchInfoCustomDimensions(),e.customMetrics),"mobile"===_.get(Odigeo,"SessionScope.flow")&&_.extend(t,{dimension49:_.get(window,"navigator.connection.type")||"unknown"}),t},getSearchInfoCustomDimensions:function(){var e=Odigeo.Session.get("analyticsSearchInfo");return Odigeo.Session.remove("analyticsSearchInfo"),Odigeo.Utils.parseJson(e)||{}},trackVirtualPageInUniversal:function(e){this.hasTrackedVirtualPage=!1;var t,i=this._generatePageviewUniversal(e),n=this.brandDictionary[Odigeo.SessionScope.brand]||"";t="true"===this.widget.options.isNativeInterface?["send","screenview",{screenName:i,appName:n}]:["send","pageview",i];var a=this.configureFieldsObjectForPageview(e,t);_.isEmpty(a)||t.push(a),_.isNull(this.userId)&&this.setUserId(e),this.getPageCustomDimensions(i).then(_.bind(function(){this.gaWrapper.apply(this,t),this.currentVirtualPage=i,this.hasTrackedVirtualPage=!0,this.trackOptimizePageview(e,i),this.trackPostponedEvents()},this))},getPageCustomDimensions:function(e){var t=Odigeo.Settings.property("trackingServiceUrlFormatter")("ua/pageCustomDimensions");return this.fetch({url:t,success:_.bind(function(t,i){this.setPageCustomDimensions(e,i)},this),error:_.bind(this.setPageCustomDimensions,this,e,{})})},setPageCustomDimensions:function(e,t){var i=_.extend(t,{dimension53:e,dimension54:_.get(window,"tmParam.levrev")});this.gaWrapper("set",_.pick(i,_.identity))},_trackPageviewInPremium:function(e,t){_gaq.push(["_set","page",e],["_trackPageview"])},trackInTrackingTool:function(e){var t="mobile"===Odigeo.SessionScope.flow,i=this._getPageNameForTrackingTool(e.page,t),n=Odigeo.Settings.options.trackingToolServiceFormatter("trackPageView")+"/"+i;i&&$.ajax({url:n,method:"GET"})},_getPageNameForTrackingTool:function(e,t){var i=this.eventTrackingCategoryDictionary.trackingTool;return(t&&-1<e.indexOf("waiting")?i["sm/"+e]:i[e])||""},_setDefaultCustomVar:function(e){_.isUndefined(e.customVar)||_.isEmpty(this.widget.options.googleCodeCustomVar)||(this._removeCustomVar(35),this._setCustomVar({index:30,name:this.widget.options.googleCodeCustomVar,scope:2}))},setCustomDimension:function(e){this.gaWrapper("set","dimension"+e.customDimension,e.value)},trackCustomVariable:function(e){e.customDimension&&this.setCustomDimension(e),this._setCustomVar(e)},requirePlugin:function(e){_.includes(this.pluginsRequired,e)||(this.gaWrapper("require",e),this.pluginsRequired.push(e))},trackPromo:function(e){this.requirePlugin("ec"),this.gaWrapper("ec:addPromo",e.promo),e.isClick&&(this.gaWrapper("ec:setAction","promo_click"),this.trackEventUniversal({action:"click",label:_.get(e.promo,"name")},"Internal Promotions"))},trackOptimizeEvent:function(e,t){e.optimize&&this.pushEventToDatalayer({event:"optimize-event",pagename:this.currentVirtualPage,action:e.action,label:e.label,category:t})},trackOptimizePageview:function(e,t){this.pushEventToDatalayer({event:"optimize-page-view",pagename:t})},pushEventToDatalayer:function(e){_.extend(e,{site_type:Odigeo.SessionScope.flow.charAt(0).toUpperCase()}),window.dataLayer.push(e)},trackSocial:function(e){_gaq.push(["_trackSocial",e.network,e.action,e.target,e.page])},prepareUrlToTrackCrossDomain:function(e,t){var i=t?e:this.prepareUrlToTrackCrossDomainClassic(e);return this.isAnalyticsUniversalActive?this._prepareUrlToTrackCrossDomainUniversal(i):i},prepareUrlToTrackCrossDomainClassic:function(e){return _.isFunction(window._gat._getTrackerByName)?window._gat._getTrackerByName()._getLinkerUrl(e):e},_prepareUrlToTrackCrossDomainUniversal:function(e){var t,i=this.getTrackers();return _.each(i,function(i){t=new window.gaplugins.Linker(i),e=t.decorate(e)},this),e},prepareLinkToTrackCrossDomain:function(e){var t=this.options.mainDomain,i=this.extractDomain(e),n=this.options.crossDomainExceptions,a=_.isArray(n)?n:new Array(n);return t===i||_.includes(a,i)?e:this.prepareUrlToTrackCrossDomain(e)},extractDomain:function(e){var t;return-1<(t=(-1<e.indexOf("://")?e.split("/")[2]:e.split("/")[0]).split(":")[0]).indexOf("www")?t.split("www.")[1]:t},decorateLink:function(e){this._requireLinker(),this.gaWrapper("linker:decorate",e)},_requireLinker:function(){this.hasRequiredUniversalLinker||(this.gaWrapper("require","linker"),this.hasRequiredUniversalLinker=!0)},addCrossDomainIframeTracking:function(e){if(!e.src.match(/_ga=/)){var t=this.prepareUrlToTrackCrossDomainClassic(e.src);this.gaWrapper(this.decorateIframeSrc(e,t))}},decorateIframeSrc:function(e,t){return function(i){window.linker=window.linker||new window.gaplugins.Linker(i),e.src=window.linker.decorate(t)}},waitForBoxever:function(e){var t=e||$.Deferred();return _.isUndefined(window.Boxever)||"anonymous"===window.Boxever.getID()?((window.delayedBoxeverRequest=window.delayedBoxeverRequest||0)<5?(window.delayedBoxeverRequest++,_.delay(_.bind(this.waitForBoxever,this,t),1200)):(Odigeo.Utils.deleteWindowPropertySafely("delayedBoxeverRequest"),t.resolve(!1)),t.promise()):(Odigeo.Utils.deleteWindowPropertySafely("delayedBoxeverRequest"),t.resolve(!0))},getUserIdFromBoxever:function(){if(!_.isUndefined(window.Boxever)){this.updatingUserIdFromBoxever=!0;var e=window.Boxever;e.browserShow(e.getID(),0,_.bind(this.processBoxeverResponse,this),"json")}},createCookieAndSetUserId:function(e){Odigeo.Utils.createCookie(this.userIdCookieName,e,730),this.setUserId()},processBoxeverResponse:function(e){var t;_.isUndefined(e.customer)||_.isUndefined(e.customer.ref)||(t=e.customer.ref,this.createCookieAndSetUserId(t))},setUserId:function(){var e=Odigeo.Utils.readCookie(this.userIdCookieName);_.isNull(e)?this.waitForBoxever().then(_.bind(function(e){e&&this.getUserIdFromBoxever()},this)):(this.userId=e,this.gaWrapper("set","userId",this.userId),this.setCustomDimension({customDimension:"10",value:this.userId}),this.updatingUserIdFromBoxever&&(this.trackEventUniversal({action:"user_id_updated",label:"user_id_"+this.userId},"user_id"),this.updatingUserIdFromBoxever=!1))},isInitializated:function(){return!_.isUndefined(window._gat)&&!_.isUndefined(window._gat._getTracker)&&(!this.isAnalyticsUniversalActive||window.ga.getAll&&!_.isEmpty(window.ga.getAll()))},hasAnalyticsUniversalActive:function(){return this.isAnalyticsUniversalActive},pushOptimizeWidget:function(e){var t=this._generatePageviewUniversal(e);this.pushEventToDatalayer({event:"optimize-widget",pagename:t,widget:e.widgetName})},getParameterByName:function(e,t){e=e.replace(/[[]]/g,"\\$&");var i=new RegExp("[?&]"+e+"(=([^&#]*)|&|#|$)").exec(t);return i?i[2]?decodeURIComponent(i[2].replace(/\+/g," ")):"":null},setParameterByName:function(e,t,i){e=e.replace(/[[]]/g,"\\$&");var n=new RegExp("([?&]"+e+")(=([^&#]*)|&|#|$)");return n.test(i)?i.replace(n,"$1="+encodeURIComponent(t)):i+(/\?/.test(i)?"&":"?")+e+"="+t},decorateParam:function(e,t,i){var n=this.getParameterByName(e,i);return n?this.setParameterByName(e,t(n),i):i},getUtmParams:function(){var e={utmcsr:"utm_source",utmcmd:"utm_medium",utmccn:"utm_campaign",utmcct:"utm_content",utmctr:"utm_term",utmgclid:"gclid"},t=Odigeo.Utils.readCookie("mktTrack")||"";if(!t)return{};var i=_.zipObject(t.split("|").map(function(e){return e.split("=")}));return _.mapKeys(i,function(t,i){return e[i]})},getMktportalParams:function(){return{mktportal:Odigeo.SessionScope.mktPortal||""}},getGaParams:function(){var e=window.ga.getAll()[0].get("linkerParam");return _.zipObject(e.split("&").map(function(e){return e.split("=")}))},getUtmUserIdParams:function(){return{user_id:Odigeo.Utils.readCookie("UTM_user_id")||""}},decorateAppTouchpointUrl:function(e){var t=e,i=_.assign({},this.getUtmParams(),this.getMktportalParams(),this.getGaParams(),this.getUtmUserIdParams()),n="?"+_.map(i,function(e,t){return t+"="+e}).join("&"),a=function(e){return e+n};return t=this.decorateParam("invoke_url_android",a,t),t=this.decorateParam("invoke_url_ios",a,t),this.setParameterByName("mktportal",i.mktportal,t)}}),exposedMethods:["trackEvent","trackTiming","sendToPageSelf","sendToPageBlank","trackECommerce","trackVirtualPage","trackVirtualPageInClassic","trackVirtualPageInUniversal","trackSocial","trackCustomVariable","setCustomDimension","trackPromo","prepareUrlToTrackCrossDomain","prepareUrlToTrackCrossDomainClassic","isInitializated","hasAnalyticsUniversalActive","prepareLinkToTrackCrossDomain","decorateLink","addCrossDomainIframeTracking","getUserIdFromBoxever","pushOptimizeWidget","decorateAppTouchpointUrl"],execute:function(e){var t;if(_.includes(this.exposedMethods,e)&&_.isFunction(this.model[e])){var i=[].slice.call(arguments,1);t=this.model[e].apply(this.model,i)}return _.isUndefined(t)?this:t},getUrlDecoratedWithCrossDomainParameters:function(e){return this.model.prepareLinkToTrackCrossDomain(e)},getDecoratedAppTouchpointUrl:function(e){return this.model.decorateAppTouchpointUrl(e)}}))})},function(e,t,i){"use strict";e.exports=Odigeo.Model.extend({defaults:{idRow:"",idPassenger:-1,hasIncludedBaggages:!1,hasSelectableBaggages:!1},getDescriptor:function(){return _.omit(this.getAll(),"idPassenger","idRow")}})},function(e,t,i){"use strict";e.exports=Odigeo.Model.extend({defaults:{pieces:0,kilos:0,price:0,baggageType:"BAGGAGE",isIncludedBaggage:!1,isSelectableBaggage:!1,selected:!1,idPassenger:-1,idRow:""},getDescriptor:function(){return _.pick(this.getAll(),"pieces","kilos","price","baggageType")}})},function(e,t,i){"use strict";e.exports=Odigeo.Model.extend({defaults:{pieces:0,piecesToShow:0,kilos:0,price:0,baggageType:"SPECIAL",selected:!1,idPassenger:-1,idRow:""},getDescriptor:function(){return _.pick(this.getAll(),"pieces","kilos","price","baggageType")}})},function(e,t,i){"use strict";var n={type:"icon",value:"tick"},a={type:"icon",value:"less"},s="odf-li-mark",r="odf-li-cross odf-text-soft",o={services:{BO_SB:[n,new function(e){return{type:"text",value:"_additional_price"}}("_additional_price"),a,a],BO_PB:[n,n,a,n],BO_HB:[n,a,n,a]},icons:{BO_SB:{standard:"odf-support-small-bag",confirmation:"odf-spot-small-bag-tick"},BO_PB:{standard:"odf-support-priority-boarding",confirmation:"odf-spot-priority-boarding-tick"},BO_HB:{standard:"odf-support-check-in-bag",confirmation:"odf-spot-check-in-bag-tick"}},highlightedType:{BO_PB:[{type:"BO_PB",available:!0}],BO_HB:[{type:"BO_PB",available:!1},{type:"BO_SB",available:!0}]},sortingConditions:[{type:"BO_SB"},{isHighlighted:!0},{isHighlighted:!1}]},c={services:{BO_PB:[{keys:["service1"],icon:s},{keys:["service2"],icon:s},{keys:["service4"],icon:s}],BO_HB:[{keys:["service1"],icon:s},{keys:["service3","service3_desc"],icon:s}],BO_SB:[{keys:["service1"],icon:s},{keys:["service2"],icon:r},{keys:["service3"],icon:r},{keys:["service4"],icon:r}]},icons:{BO_SB:{standard:"odf-support-small-bag",confirmation:"odf-spot-small-bag"},BO_PB:{standard:"odf-support-priority-boarding",confirmation:"odf-spot-priority-boarding-tick"},BO_HB:{standard:"odf-support-check-in-bag",confirmation:"odf-spot-check-in-bag-tick"}},highlightedType:{BO_PB:[{type:"BO_PB",available:!0}],BO_HB:[{type:"BO_PB",available:!1},{type:"BO_SB",available:!0}]},sortingConditions:[{isHighlighted:!0},{available:!0,type:"BO_HB"},{available:!0,type:"BO_SB"},{available:!1}]};e.exports={get:function(){var e="mobile"===Odigeo.SessionScope.flow,t=Odigeo.AB.isBoardingOptionsOE||Odigeo.AB.isBoardingOptionsOEWithCrossFaring,i=Odigeo.AB.isBoardingOptionsOEWithCrossFaring,n={fr:e?c:o},a=e?{oe:c}:t?{oe:o}:{},s=e?{"fr.oe":c}:i?{"fr.oe":o}:{};return _.extend({},n,a,s)}}},function(e,t,i){"use strict";var n,a=Odigeo.Model.extend({dataUrl:"getallbaggage",defaults:{},url:function(){return Odigeo.Settings.getProperty("serviceUrlFormatter")(this.dataUrl)},getDataRequestSettings:function(){return{success:_.bind(this.requestSuccessHandler,this),error:_.bind(this.requestErrorHandler,this)}},requestSuccessHandler:function(e){_.isEmpty(e)||this.trigger("responseIsOK",e)},requestErrorHandler:function(){this.trigger("responseIsKO")}});e.exports.BaggagesModelClass=a,e.exports.getInstance=function(){return _.isUndefined(n)&&(n=new a),n}},function(e,t,i){"use strict";var n,a=Odigeo.Model.extend({dataUrl:"getselectedbaggages",defaults:{},url:function(){return Odigeo.Settings.getProperty("serviceUrlFormatter")(this.dataUrl)},getDataRequestSettings:function(){return{success:_.bind(this.requestSuccessHandler,this),error:_.bind(this.requestErrorHandler,this)}},requestSuccessHandler:function(e){_.isEmpty(e)||this.trigger("responseIsOK",e)},requestErrorHandler:function(){this.trigger("responseIsKO")}});e.exports.BaggagesModelClass=a,e.exports.getInstance=function(){return _.isUndefined(n)&&(n=new a),n}},function(e,t,i){"use strict";e.exports=Backbone.View.extend({initialize:function(e){this.options=e,this.percentage=Math.ceil(100-e.selectedPrice/e.averagePrice*100)},render:function(){this.percentage>=this.options.minBoundary&&this.$el.html(this.options.template(this.getContent(this.percentage,this.options.translations)))},getContent:function(e,t){var i=t.savingAlert,n=Odigeo.AB.isMembershipFaresDiscoveryD||Odigeo.AB.isMembershipFaresDiscoveryArrowD?"odf-space-inner-m odf-text-right":"";return{cssClassIteration:50<=e?" od-results-saving-alert-text-iteration":"",percentageMessage:Odigeo.Utils.replaceCmsKeyArgs(i.percentageMessage,e),averageMessage:i.averageMessage,cssClassIterationReduceHeight:Odigeo.AB.isMobileResultsBoxReduceHeight?"odf-text-sm":"odf-text-md",spaceRightClass:n}}})},,,,,function(e,t,i){"use strict";var n=i(15),a=i(0),s=new n({initEmailCapture:function(){this.$slctrs={},this.hasLegal=!1,this.moduleContext="",this.trackKeys={},this.labelConcept="",this.action=""},validateEmailCapture:function(e){e.preventDefault();var t=!!_.isEmpty(this.$slctrs.legalInput)||this.$slctrs.legalInput.is(":checked");this.$slctrs.container.removeClass("invalid");var i=this.$slctrs.input.val();_.isEmpty(i)?this.setInvalidAndSendTrackingEmailCapture("missing"):Odigeo.Utils.isValidEmail(i)?t?this.onSuccess(i):(this.$slctrs.container.removeClass("invalid"),this.$slctrs.legalInput.parent().addClass("error"),this.setInvalidAndSendTrackingEmailCapture("accept_terms")):(this.$slctrs.input.val(""),this.setInvalidAndSendTrackingEmailCapture(t?"invalid":"both"))},showSentMessageEmailCapture:function(){this.$slctrs.container.removeClass("invalid").addClass("success"),this.$slctrs.button.removeClass("loading"),this.trackEventsEmailCapture()},setInvalidAndSendTrackingEmailCapture:function(e){"accept_terms"===e?this.$slctrs.legalInput.parent().addClass("error"):(this.$slctrs.container.addClass("invalid"),this.$slctrs.input.attr("placeholder",this.$slctrs.input.data("error-"+("both"===e?"invalid":e)))),this.trackEventsEmailCapture(e+"_error")},trackEventsEmailCapture:function(e){var t=this.labelConcept+(e||"successful");a.trackEvent(this.action,t,this.trackKeys[this.moduleContext])}});e.exports=s},function(e,t,i){"use strict";var n=i(0);e.exports=Odigeo.Model.extend({dataURL:"datalayer",pageNamesMap:{cms:"cms",home:"homepage",results:"results",dpresults:"results",dpresults_flights:"results",dpresults_accommodation:"hotel_results",xsellproductselection:"dp_upsell",roomselection:"room_selection",dpresults_accommodation_details:"room_selection",accommodation_details:"room_selection",flightsummary:"summary",trip_summary:"summary",booking:"summary",details:"details_extras",passengersinfo:"details_extras",insurance:"insurances",servicepack:"service_options",canx:"cancellation_guarantee",flex:"flexible_dates",payment:"payment",confirmation:"confirmation",mytrips:"mytrips",mytripslogin:"mytripslogin",register:"register",accountblocked:"accountblocked","flights/frequentpassengers":"frequent_travelers",accountpreferences:"account_preferences",resetpassword:"change_password",loginexpired:"loginexpired",additions:"additions",selection:"ancillaries"},postBookingAccommodationPagesMap:{xsellproductselection:"results",pbpayment:"payment"},url:function(){return Odigeo.Settings.getProperty("tagManagementUrlFormatter")(this.dataURL+"/"+this.getPageName())},getPageName:function(){var e=Odigeo.Utils.isWebmasterPage()?"cms":Odigeo.History.getPageNameFromFragment();e="ancillaries"===e?Odigeo.History.getFragment().match(/(?:[^\/]+)(?=$)/)[0]:e;var t=this.isAccommodationsPostBooking()&&_.has(this.postBookingAccommodationPagesMap,e)?this.postBookingAccommodationPagesMap:this.pageNamesMap;return _.get(t,e||"home")},initialize:function(){this.on("change",this.syncTcVars),this.syncTcVars()},syncTcVars:function(){window.tc_vars=this.flatten(this.toJSON())},fireEvent:function(e,t,i){var n={};n.event_category=e,n[t]=i,_.method("tC.container.reload",{events:{click:[{},n]}})(window)},loadContainer:function(){this.addClientSideAttributes(),_.method("tC.container.reload",{events:{page:[{},{}]}})(window)},isPageInWhitelist:function(){return _.has(_.invert(this.pageNamesMap),this.getPageName())},fetchDatalayer:function(){this.isPageInWhitelist()&&this.fetch({data:{product:this.isAccommodationsPostBooking()?"hotel_post_booking":Odigeo.Utils.getFunnelInGlobalScope()},success:this.loadContainer.bind(this),error:this.handleErrorOnBuildDatalayer.bind(this)})},updateDatalayer:function(e){_.isEmpty(e)?this.fetchDatalayer():(this.set(e),this.loadContainer())},handleErrorOnBuildDatalayer:function(){this.set("pageInfo",_.extend(this.get("pageInfo"),{page_name:this.getPageName()})),this.syncTcVars(),this.loadContainer()},addClientSideAttributes:function(){this.set({ext_ga_client_id:n.getClientId(),page_url:document.location.href}),this.syncTcVars()},isAccommodationsPostBooking:function(){return Odigeo.Utils.parseJson(Odigeo.Session.get("isAccommodationPostBooking"))},flatten:function(e,t){var i={};if(_.isNull(e)||_.isUndefined(e)||_.isNaN(e))return i[t]="",i;if(!_.isObject(e))return i[t]=e.toString(),i;for(var n in e)if(Object.prototype.hasOwnProperty.call(e,n)){var a=this.flatten(e[n],n);i=_.merge(i,a)}return i}})},function(e,t,i){"use strict";var n=i(10);e.exports=n({viewClass:i(408)})},function(e,t,i){"use strict";$(function(){Odigeo.defineWidget("sessionrecorder",Odigeo.Widget.extend({modelClass:Odigeo.Model.extend({init:function(){this.started=!1,this.constantTags=[]}}),viewClass:Odigeo.View.extend({events:{},init:function(){}}),nameInWindow:"__insp",insertRecorderScript:function(){var e=document.createElement("script");e.type="text/javascript",e.async=!0,e.id="inspsync",e.src=("https:"===document.location.protocol?"https":"http")+"://cdn.inspectlet.com/inspectlet.js";var t=document.getElementsByTagName("script")[0];t.parentNode.insertBefore(e,t)},init:function(){var e=!_.isEmpty(this.options.recorderId);(this.options.enabled=e)&&(this.options=Odigeo.parseOptions(this.options),window[this.nameInWindow]=window[this.nameInWindow]||[],window[this.nameInWindow].push(["wid",this.options.recorderId]))},bindVolatileEvents:function(){var e={"payment-manager:showErrors":function(e){return[e]},"payment-manager:showErrorsResume":function(){return Array.prototype.slice.call(arguments)},"payment-manager:noPaymentMethodsAvailable":["noPaymentMethodsAvailable_BrokenFLow"],"payment-manager:updateCardMethod":["updateCardMethod"],"payment-manager:ready":["paymentManagerReady"],"payment-manager:confirmationReady":function(e){return[{booking:e.bookingstatus}]}};_.map(e,function(e,t){Odigeo.on(t,_.partial(_.delay,_.bind(function(e){var t,i=[].slice.call(arguments,1);t=_.isFunction(e)?e(i):e,[this.trackTags,this.trackPairs][Number(_.isObject(t))].apply(this,t)},this,e),0))},this)},bindStaticEvents:function(){var e=[/payment_details/,/payment_details_error/,/confirm_purchase/,/insurances_information/,/service_options_information/,/reject_solutions/,/booking_status/];Odigeo.on("page:afterSwitch",_.partial(_.delay,_.bind(function(){this.trackVirtualPage()},this),0)),Odigeo.on("analytics:tracking",_.partial(_.delay,_.bind(function(t){if(_.isObject(t)&&_.isObject(t.data)){var i=t.data,n={};i.action?_.some(e,function(e){return e.test(i.action)})&&(n[i.action]=i.label,this.trackPairs(n)):t.type&&"trackVirtualPage"===t.type&&_.isObject(i.error)&&this.trackTags(i.error.message)}},this),0))},start:function(){this.options.enabled&&(this.model.started||(this.insertRecorderScript(),this.model.started=!0,this.trackPairs(_.chain(this.options).omit("recorderId","recorderVersion","enabled").value()),this.bindStaticEvents()),this.bindVolatileEvents())},_executeCommand:function(e,t){window[this.nameInWindow].push(_.isUndefined(t)?[e]:[e,t])},trackPairs:function(e){this.options.enabled&&this._executeCommand("tagSession",e)},trackTags:function(){this.options.enabled&&this._executeCommand("tagSession",[].slice.call(arguments).join(" "))},trackVirtualPage:function(){this.options.enabled&&this._executeCommand(["virtualPage"])},options:{}}))})},function(e,t,i){"use strict";var n,a,s,r,o,c=i(43),d=i(84),l=i(14);e.exports=(a=[c.INSURANCE,c.INSURANCE_IN_CART,c.ASSISTANCE_INSURANCE,c.REBOOKING_INSURANCE,c.CANX_INSURANCE],s=[c.ADULTS,c.CHILDREN,c.INFANTS],r=[c.SERVICE_FEE,c.CC_FEE,c.DISCOUNT_FEE],o=[d.ONE_PRICE,d.ALL_PRICE,d.ALL_PRICE_PROVIDER,d.FARE,d.PROVIDER_FARE,d.TAX],Odigeo.Model.extend({idAttribute:"pbId",defaults:{id:"",conceptKey:"",conceptLabel:"",fare:0,providerFare:0,allPrice:0,allPriceProvider:0,onePrice:0,quantity:0,tax:0,type:"",departureIata:"",arrivalIata:"",baggageApplicationLevel:""},parse:function(e){return this.pbId=e.type+e.conceptKey,e},isBaggageOrBaggageWeightItem:function(){return this.isMatchingType(c.BAGGAGES)||this.isMatchingType(c.BAGGAGES_WEIGHT)},isBaggageItem:function(){return this.isMatchingType(c.BAGGAGES)},isInsuranceItem:function(){return this.matchTypeFromList(a)},isAdditionalAncillaryProduct:function(){return this.isMatchingType(c.ADDITION)},isPreselectedInsuranceItem:function(){var e=this.getInsurance(this.get("id"));return this.isInsuranceItem()&&!_.isEmpty(e)&&e.preselected},isPassengerItem:function(){return this.matchTypeFromList(s)},isFeeItem:function(){return this.matchTypeFromList(r)},matchTypeFromList:function(e){return _.some(e,function(e){return this.isMatchingType(e)},this)},isProductItem:function(){return!(this.isPassengerItem()||this.isFeeItem())},isMatchingType:function(e){return Odigeo.Utils.isMatch(this.attributes,{type:e})},isQuantifiable:function(){return!this.isEmpty()||0<this.get(d.ALL_PRICE)},isEmpty:function(){return 0===this.get(d.QUANTITY)},isEmptyInsuranceInCart:function(){return this.get(d.TYPE)===c.INSURANCE_IN_CART&&0===this.get(d.ONE_PRICE)},isVisible:function(){return!(this.isEmpty()||this.isEmptyInsuranceInCart())},hasPrice:function(e){return 0!==this.get(e)},getPrice:function(){return 0===this.get(d.QUANTITY)?0:this.hasPrice(d.ALL_PRICE)?this.get(d.ALL_PRICE):this.get(d.ONE_PRICE)},getProviderPrice:function(){return 0===this.get(d.QUANTITY)?0:this.hasPrice(d.ALL_PRICE_PROVIDER)?this.get(d.ALL_PRICE_PROVIDER):this.get(d.ONE_PRICE_PROVIDER)},getFormattedPrice:function(e){if(_.contains(o,e))return Odigeo.Utils.formatCurrency(this.get(e))},toJSON:function(){var e=Odigeo.Model.prototype.toJSON.call(this);return n=l.getInstance(),_.extend(e,{isBaggageItem:this.isBaggageItem(),isPassengerItem:this.isPassengerItem(),isProductItem:this.isProductItem(),isInsuranceItem:this.isInsuranceItem(),isAdditionalAncillaryProduct:this.isAdditionalAncillaryProduct(),isPreselectedInsuranceItem:this.isPreselectedInsuranceItem(),onePriceFormatted:this.getFormattedPrice(d.ONE_PRICE),allPriceFormatted:this.getFormattedPrice(d.ALL_PRICE),allPriceProviderFormatted:this.getFormattedPrice(d.ALL_PRICE_PROVIDER),fareFormatted:this.getFormattedPrice(d.FARE),providerFareFormatted:this.getFormattedPrice(d.PROVIDER_FARE),taxFormatted:this.getFormattedPrice(d.TAX),hasFare:this.hasPrice(d.FARE),hasTax:this.hasPrice(d.TAX),isEmpty:this.isEmpty(),isVisible:this.isVisible(),isQuantifiable:this.isQuantifiable()})},equalsTo:function(e){var t=[d.CONCEPT_KEY,d.TYPE];return this.matchTypeFromList([c.BAGGAGES,c.BAGGAGES_WEIGHT])&&t.push(d.ONE_PRICE),_.every(t,function(t){return _.has(e,t)&&_.isEqual(this.attributes[t],e[t])},this)},getInsurances:function(){return n.isLoaded()?n.getInsurances():[]},getInsurance:function(e){return _.find(this.getInsurances(),function(t){return e===t.policy})||{}}}))},function(e,t,i){"use strict";e.exports=Odigeo.Model.extend({defaults:{section:0,numPassenger:0,floorSelection:0,rowSelection:0,seatMapRow:0,columnSelection:"",providerPrice:0,totalPrice:0,currencyCode:""},segment:0,idModel:"",idAttribute:"idModel"})},function(e,t,i){"use strict";var n={requireGoogleMap:!1,loaderTimeout:2e3,loaderIdTime:0};function a(e){this.deferred=null,this.options=_.extend({},n,e)}a.prototype.run=function(e){return this.deferred=$.Deferred(),Odigeo.require(function(){return!Odigeo.AB.isDeactivateAvuxi&&_.compact(["avuxi",this.options.requireGoogleMap&&"googleMaps"])}.call(this),_.bind(function(t){var i;i=t,_.isObject(i)&&!_.isEmpty(i)?(e(t),function(){window.clearTimeout(this.options.loaderIdTime),this.options.loaderIdTime=window.setTimeout(_.bind(function(){_.isEqual(this.deferred.state(),"pending")&&this.deferred.reject()},this),this.options.loaderTimeout)}.call(this)):this.deferred.reject(!1)},this),this.deferred.reject),this.deferred.promise()},a.prototype.getDeferred=function(){return this.deferred},e.exports=a},,,,,,function(e,t,i){"use strict";var n=i(0),a=i(157);Odigeo.defineWidget("membership_perks_info_lightbox",Odigeo.Widget.extend({modelClass:Odigeo.Model.extend({defaults:{isUserLoggedIn:!1,isPrimePriceSelected:!1,membershipSubscriptionPrice:null,state:""},updateSubscriptionPrice:function(e){this.set("membershipSubscriptionPrice",e)}}),viewClass:Odigeo.View.extend({selectors:{membershipPerksInfoLightboxContainer:".perks_info_lightbox_container",membershipHeaderTxt:".header_description",membershipDescriptionMoneyTxt:".description_money"},templateSelectors:{mainTemplate:"#membership-perks-info-lightbox-template"},exposedMethods:{openMembershipPerksInfoLightbox:"openMembershipPerksInfoLightbox"},events:{"tap .continue_with_member_lightbox":"onContinueWithMemberLightbox","tap .want_be_member_lightbox":"onMembershipPerksInfoLightboxButton","tap .lightbox_perks_close":"onCloseMembershipPerksInfoLightbox","tap .perks_info_lightbox_container":"onCloseMembershipPerksInfoLightboxTappingOutside","tap .lightbox_terms_and_conditions":"onClickTermsAndConditions"},init:function(){return this.templates=Odigeo.Utils.getTemplates(this.$el,this.templateSelectors,{variable:null}),this.opts=Odigeo.parseOptions(this.widget.options),this.model.set("isPrimePriceSelected",!this.opts.isPriceWithoutDiscountSelected),this.model.set("state",this.opts.isPriceWithoutDiscountSelected?"no-prime":"prime"),this},renderPerksInfoLightboxTemplate:function(e,t){var i=Odigeo.Utils,n=this.model.get("membershipSubscriptionPrice"),s=a.getPriceNoWrap(n);e.membershipHeaderTitle=i.replaceCmsKeyArgs(e.membershipHeaderTitle,n),e.membershipHeaderTxt=i.replaceCmsKeyArgs(e.membershipHeaderTxt,s),e.membershipDescriptionMoneyTxt=i.replaceCmsKeyArgs(e.membershipDescriptionMoneyTxt,n),e=_.extend(e,{isFromResultsPopup:!_.isUndefined(t)}),this.$el.find(this.selectors.membershipPerksInfoLightboxContainer).html(this.templates.mainTemplate({options:e}))},openMembershipPerksInfoLightbox:function(e){this.renderPerksInfoLightboxTemplate(this.opts,e),Odigeo.UIElements.toggleWidgetsDialogs(this.widget.id,Odigeo.AB.isMembershipRemoving10MinWarningMessage),this.$el.find(this.selectors.membershipPerksInfoLightboxContainer).addClass("open")},onContinueWithMemberLightbox:function(e){var t="continueWithMemberLighbox";"addInPayment"===this.widget.options.buttonBehaviour&&(this.onCloseMembershipPerksInfoLightbox(e),t="openPaymentSubscriptionLightBox"),Odigeo.trigger(this.widget.id+":"+t)},onMembershipPerksInfoLightboxButton:function(e){n.trackEvent("unlocked","prime_mem_select_more_info"),this.onCloseMembershipPerksInfoLightbox(e),Odigeo.AB.isMemberSmoothSubscription||"add"!==this.widget.options.buttonBehaviour||Odigeo.trigger(this.widget.id+":launchTravellersValidations")},onCloseMembershipPerksInfoLightboxTappingOutside:function(e){$(e.target).hasClass("perks_info_lightbox_container")&&this.onCloseMembershipPerksInfoLightbox(e)},onCloseMembershipPerksInfoLightbox:function(e){if(e.stopPropagation(),Odigeo.trigger("results-manager:openOrClosePerksMembershipDialog",!1),Odigeo.trigger("membership-perks-info-lightbox:openOrClosePerksMembershipDialog",!1),Odigeo.UIElements.toggleWidgetsDialogs(this.widget.id,!1),this.$el.find(this.selectors.membershipPerksInfoLightboxContainer).removeClass("open"),"addInPayment"===this.opts.buttonBehaviour)n.trackEventWithCategory("flights_pay_page","unlocked","know_more_close_pay_sce");else{var t=this.opts.isResultsPage?"flights_results":"flights_pax_page";n.trackEventWithCategory(t,"unlocked","know_more_close")}},onClickTermsAndConditions:function(){n.trackEvent("unlocked","unlocked_terms_and_conditions_sce:"+this.model.get("state"))}}),exposedMethods:{openMembershipPerksInfoLightbox:"view.openMembershipPerksInfoLightbox",updateSubscriptionPrice:"model.updateSubscriptionPrice"},execute:function(e){return Odigeo.Utils.executeInternalMethods(this,this.exposedMethods,e,_.rest(arguments))},loginDone:function(){this.model.set("isUserLoggedIn",!0)},logoutDone:function(){this.model.set("isUserLoggedIn",!1)}}))},function(e,t,i){"use strict";Odigeo.defineWidget("dp_waiting_page",Odigeo.Widget.extend({modelClass:i(210),viewClass:i(211),activate:function(){return this.view.activateWaitingPage.apply(this.view,arguments)},deactivate:function(){this.view.animateWaiting(this.view.deactivateWaitingPage,this.view.getCalculatedDelay())},off:function(){this.view.animateWaiting(this.view.offWaitingPage,0)}}))},function(e,t,i){"use strict";function n(e){var t,i,n,s,r={};return"oneWayTrip"!==e.type&&"roundTrip"!==e.type||(r.itinerary=(i=e.searchSegments[0],n=function(e){return _.toArray(_.pick(e,["city","name","iata"]))},{departure:(s=Odigeo.Utils.fitStringsCombination(26,n(i.departure),n(i.destination)))[0],destination:s[1]}),r.dates=function(e,t){var i={dateDeparture:null,dateDestination:null};return i.dateDeparture=a(e.searchSegments[0].dateStr,t),"roundTrip"===e.type&&(i.dateDestination=a(e.searchSegments[1].dateStr,t)),i}(e,this.widget.options.UTCFormat),r.travellers=(t=e,parseInt(t.numAdults,10)+parseInt(t.numChildren,10)+parseInt(t.numInfants,10))),r}function a(e,t){return Odigeo.Utils.formatDate(Odigeo.Utils.parseDate(e),t,!0)}e.exports=Odigeo.Model.extend({defaults:{dpresults:{id:"dpresults",analytics:1,type:null,itinerary:null,dates:null,travellers:null,adv:!0},dpresults_accommodation:{id:"dpresults",analytics:1,type:null,itinerary:null,dates:null,travellers:null,adv:!0},dpresults_flights:{id:"dpresults",analytics:1,type:null,itinerary:null,dates:null,travellers:null,adv:!0},roomselection:{id:"roomselection",analytics:2},details:{id:"details",analytics:3},payment:{id:"payment",analytics:4},confirmation:{id:"confirmation",analytics:5},selectedPage:null},initWaitingPage:function(e){return this.opts=Odigeo.Utils.parseOptions(this.widget.options),function(e){this.set("selectedPage",e.redirect||Odigeo.History.getPageNameFromFragment())}.call(this,e),function(e){var t=function(e){return{dpresults:n.call(this,e),dpresults_flights:n.call(this,e),dpresults_accommodation:n.call(this,e)}[this.get("selectedPage")]}.call(this,e)||{},i=this.get("selectedPage"),a=this.get(i);return $.extend(!0,a,t,this.opts)}.call(this,e)}})},function(e,t,i){"use strict";var n=i(0),a=i(212),s=Odigeo.UIElements.translations.dynpackProduct.waiting,r={duration:5e3,queue:null,changeInterval:null},o=$("#page"),c=new XMLSerializer,d=Odigeo.AB.isDynpackMobileNewProductSelection?["hotel","airplane","credential_vacations","skeleton"]:["airplane","hotel","credential_vacations","skeleton"],l={airplane:"",hotel:"",credential_vacations:""};function g(){var e=this,t=this.$el.find(this.selectors.animation),i=this.$el.find(this.selectors.stepsTextWrapper);this.animation.svgSequence=_.clone(d),u.call(this,t,i),r.changeInterval=setInterval(function(){u.call(e,t,i)},r.duration)}function h(){clearInterval(r.changeInterval)}function u(e,t){var i=this.animation.svgSequence.shift();"skeleton"===i?this.activateSkeletonPage():(e.html(l[i]),t.html(s[i])),_.isEmpty(this.animation.svgSequence)&&h()}e.exports=Odigeo.View.extend({animation:{delay:0,svgSequence:[]},selectors:{container:"#dpwaitingpage-container",animation:".swiper_svg_wrapper",stepsTextWrapper:".swiper_text_wrapper",stepsErrorWrapper:".swiper_error_wrapper",header:"header"},tmpls:{main:"#waitingpage-template"},init:function(){this.tmpls=Odigeo.Utils.getTemplates(this.$el,this.tmpls),this.opts=Odigeo.Utils.parseOptions(this.widget.options)},activateWaitingPage:function(){var e,t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};return Odigeo.trigger(this.widget.id+":hidePageOverDpWaitingPage"),e=this.model.initWaitingPage(t),this.$cachedSelectors.container.hide(),this.renderTemplate("#waiting-",e),function(e){var t,i,a;this.animation.delay=(new Date).getTime(),this.$cachedSelectors.container.show().addClass("animated"),o.trigger("toggle-waiting-page",!0),function(e){e&&Odigeo.UIElements.enhanceAdvertisementGptNonJS(this.$el.find(".dpwaiting_page").find("#modwaiting"))}.call(this,e.adv),t=e.analytics,i=Odigeo.Utils.getFunnelInGlobalScope(),a="true"===Odigeo.Session.get("payment3ds")?"-3dsecure":"/"+t,n.trackPage("waiting"+a,{legacy:"/waitPage/paso"+t+"/"+i+"/",funnel:!0}),Odigeo.Session.set("payment3ds",!1)}.call(this,e),this.opts.hasSvgAnimation&&function(){var e=this;_.every(l,_.negate(_.isEmpty))?g.call(this):a.getSvgImages(l,function(){return e.onFetchError.apply(e,arguments)},function(){return e.onFetchSuccess.apply(e,arguments)},function(){return e.onFetchAllSuccess()})}.call(this),this},renderTemplate:function(e,t){var i=this.model.get("selectedPage"),n=this.model.get(i),a=this.$el.find(e+n.id);0<a.length&&this.$cachedSelectors.container.html(this.tmpls.main(_.extend({renderContainer:_.template(a.html(),Odigeo.Utils.getTmplSettings())},t)))},activateSkeletonPage:function(){this.renderTemplate("#waiting-skeleton-"),Odigeo.trigger(this.widget.id+":activateSkeletonPage",!0)},getCalculatedDelay:function(){return this.opts.hasSvgAnimation?0:(new Date).getTime()-this.animation.delay<3e3?1500:0},animateWaiting:function(e,t){$.fx.muted?(this.activateContent(_.noop),this.$cachedSelectors.container.hide(),this.cleanWaitingPage(_.noop)):this.$cachedSelectors.container.clearQueue().delay(t).queue(_.bind(this.activateContent,this)).queue(_.bind(e,this)).queue(_.bind(this.cleanWaitingPage,this))},activateContent:function(e){Odigeo.trigger(this.widget.id+":cleanDpWaitingPage"),e()},deactivateWaitingPage:function(e){this.$cachedSelectors.container.removeClass("animated"),e()},offWaitingPage:function(e){this.$cachedSelectors.container.hide(),e()},cleanWaitingPage:function(e){this.opts.hasSvgAnimation&&h(),this.animation.delay=0,this.$cachedSelectors.container.empty(),o.trigger("toggle-waiting-page",!1),e()},onFetchSuccess:function(e,t){var i,n,a,s,r,o,d,g=e.getElementsByTagName("svg")[0];i=g,n=t,a=$(".header").height(),o=(s=parseInt(i.getAttribute("height"),10))+(r=($(window).height()-140-a-s)/2),d="0 -"+r+" "+parseInt(i.getAttribute("width"),10)+" "+o,i.setAttribute("viewBox",d),i.setAttribute("height",o),i.setAttribute("width","100%"),i.setAttribute("class","od-waitings-svg-"+n),l[t]=c.serializeToString(g)},onFetchAllSuccess:function(){g.call(this)},onFetchError:function(){this.$el.find(this.selectors.stepsErrorWrapper).removeClass("odf-hidden")}})},function(e,t,i){"use strict";var n=[];function a(e,t,i){var a=$.ajax({url:function(e){return Odigeo.Utils.getImageFromCDN("onefront/bluestone/icons/spot/"+e+".svg")}.call(this,e),method:"GET",dataType:"xml",success:function(t){i(t,e)},error:t,timeout:1e3});n.push(a)}e.exports={getSvgImages:function(e,t,i,s){_.forEach(e,function(e,n){a.call(this,n,t,i)}),$.when.apply($,n).then(function(){s(),n.length=0},t)},getSvgImage:a}},function(e,t,i){"use strict";var n=i(14).getInstance();Odigeo.defineWidget("waiting_pages",Odigeo.Widget.extend({viewClass:Odigeo.View.extend({selectors:{cities:".waiting_cities",departureDate:".waiting_departure_date",returnDate:".waiting_return_date",multipleDate:".waiting_multiple_date",passengers:".waiting_passengers",destCity:".waiting_loading_destination",itineraryBox:".itinerary_box",pluralizeKey:".pluralize_key"},cleanElements:function(e){_.each(e,function(e){this.$cachedSelectors[e].html("")},this)},fillSearchWaitingPage:function(e){this.cleanElements(["destCity","returnDate","departureDate","multipleDate"]),_.includes(["oneWayTrip","roundTrip"],e.tripType)?this.setTripData(e):(this.$cachedSelectors.cities.html(Odigeo.UIElements.translations.waitings.multipleCities),this.$cachedSelectors.multipleDate.html(Odigeo.UIElements.translations.waitings.multipleDates)),this.replaceTexts("passengers",e.numAdults+e.numChildren+e.numInfants),this.$cachedSelectors.itineraryBox.addClass("active")},setTripData:function(e){this.$cachedSelectors.cities.html(e.depCity+" - "+e.destCity),this.fillDates(e.departureDate,e.returnDate),this.replaceTexts("destCity",e.destCity),this.widget.options.isWaitingMessagesActive&&this.replaceTexts("pluralizeKey","oneWayTrip"===e.tripType?1:0)},parseDate:function(e){return Odigeo.Utils.formatDate(Odigeo.Utils.parseDate(e),this.widget.options.format,!0)},fillDates:function(e,t){this.$cachedSelectors.departureDate.text(e),this.$cachedSelectors.returnDate.text(t)},replaceText:function(e,t){e.html(Odigeo.Utils.pluralizeAll(e.data("key"),t))},replaceTexts:function(e,t){_.each(this.$cachedSelectors[e],function(e){this.replaceText($(e),t)},this)}}),init:function(){this.options=Odigeo.parseOptions(this.options)},initSearchWaiting:function(e){var t=this;if(_.isObject(e)&&_.isArray(e.searchSegments)){var i=e.searchSegments[0],a=e.searchSegments[1];this.view.fillSearchWaitingPage({numAdults:parseInt(e.numAdults,10)||0,numChildren:parseInt(e.numChildren,10)||0,numInfants:parseInt(e.numInfants,10)||0,tripType:e.type,depCity:i.departure.city,destCity:i.destination.city,departureDate:this.view.parseDate(i.dateStr),returnDate:_.isObject(a)&&a.dateStr?" - "+this.view.parseDate(a.dateStr):""}),n.getLoadedPromise().then(function(e){if(e&&n.isCanxFreeCandidate()){var a=i.dateStr.replace(/-/g,"/"),s=new Date;1728e5<new Date(a)-s?(t.view.$el.find(".flex_waiting").removeClass("odf-hidden"),t.view.$el.find(".results_waiting").addClass("odf-hidden")):(t.view.$el.find(".results_waiting").removeClass("odf-hidden"),t.view.$el.find(".flex_waiting").addClass("odf-hidden"))}})}}}))},function(e,t,i){"use strict";t.byteLength=function(e){var t=d(e),i=t[0],n=t[1];return 3*(i+n)/4-n},t.toByteArray=function(e){for(var t,i=d(e),n=i[0],r=i[1],o=new s(3*(n+(h=r))/4-h),c=0,l=0<r?n-4:n,g=0;g<l;g+=4)t=a[e.charCodeAt(g)]<<18|a[e.charCodeAt(g+1)]<<12|a[e.charCodeAt(g+2)]<<6|a[e.charCodeAt(g+3)],o[c++]=t>>16&255,o[c++]=t>>8&255,o[c++]=255&t;var h;return 2===r&&(t=a[e.charCodeAt(g)]<<2|a[e.charCodeAt(g+1)]>>4,o[c++]=255&t),1===r&&(t=a[e.charCodeAt(g)]<<10|a[e.charCodeAt(g+1)]<<4|a[e.charCodeAt(g+2)]>>2,o[c++]=t>>8&255,o[c++]=255&t),o},t.fromByteArray=function(e){for(var t,i=e.length,a=i%3,s=[],r=0,o=i-a;r<o;r+=16383)s.push(l(e,r,o<r+16383?o:r+16383));return 1===a?(t=e[i-1],s.push(n[t>>2]+n[t<<4&63]+"==")):2===a&&(t=(e[i-2]<<8)+e[i-1],s.push(n[t>>10]+n[t>>4&63]+n[t<<2&63]+"=")),s.join("")};for(var n=[],a=[],s="undefined"!=typeof Uint8Array?Uint8Array:Array,r="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/",o=0,c=r.length;o<c;++o)n[o]=r[o],a[r.charCodeAt(o)]=o;function d(e){var t=e.length;if(0<t%4)throw new Error("Invalid string. Length must be a multiple of 4");var i=e.indexOf("=");return-1===i&&(i=t),[i,i===t?0:4-i%4]}function l(e,t,i){for(var a,s,r=[],o=t;o<i;o+=3)a=(e[o]<<16&16711680)+(e[o+1]<<8&65280)+(255&e[o+2]),r.push(n[(s=a)>>18&63]+n[s>>12&63]+n[s>>6&63]+n[63&s]);return r.join("")}a["-".charCodeAt(0)]=62,a["_".charCodeAt(0)]=63},function(e,t){t.read=function(e,t,i,n,a){var s,r,o=8*a-n-1,c=(1<<o)-1,d=c>>1,l=-7,g=i?a-1:0,h=i?-1:1,u=e[t+g];for(g+=h,s=u&(1<<-l)-1,u>>=-l,l+=o;0<l;s=256*s+e[t+g],g+=h,l-=8);for(r=s&(1<<-l)-1,s>>=-l,l+=n;0<l;r=256*r+e[t+g],g+=h,l-=8);if(0===s)s=1-d;else{if(s===c)return r?NaN:1/0*(u?-1:1);r+=Math.pow(2,n),s-=d}return(u?-1:1)*r*Math.pow(2,s-n)},t.write=function(e,t,i,n,a,s){var r,o,c,d=8*s-a-1,l=(1<<d)-1,g=l>>1,h=23===a?Math.pow(2,-24)-Math.pow(2,-77):0,u=n?0:s-1,p=n?1:-1,f=t<0||0===t&&1/t<0?1:0;for(t=Math.abs(t),isNaN(t)||t===1/0?(o=isNaN(t)?1:0,r=l):(r=Math.floor(Math.log(t)/Math.LN2),t*(c=Math.pow(2,-r))<1&&(r--,c*=2),2<=(t+=1<=r+g?h/c:h*Math.pow(2,1-g))*c&&(r++,c/=2),l<=r+g?(o=0,r=l):1<=r+g?(o=(t*c-1)*Math.pow(2,a),r+=g):(o=t*Math.pow(2,g-1)*Math.pow(2,a),r=0));8<=a;e[i+u]=255&o,u+=p,o/=256,a-=8);for(r=r<<a|o,d+=a;0<d;e[i+u]=255&r,u+=p,r/=256,d-=8);e[i+u-p]|=128*f}},function(e,t){},function(e,t,i){"use strict";var n=i(2).Buffer,a=i(218);e.exports=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),this.head=null,this.tail=null,this.length=0}return e.prototype.push=function(e){var t={data:e,next:null};0<this.length?this.tail.next=t:this.head=t,this.tail=t,++this.length},e.prototype.unshift=function(e){var t={data:e,next:this.head};0===this.length&&(this.tail=t),this.head=t,++this.length},e.prototype.shift=function(){if(0!==this.length){var e=this.head.data;return 1===this.length?this.head=this.tail=null:this.head=this.head.next,--this.length,e}},e.prototype.clear=function(){this.head=this.tail=null,this.length=0},e.prototype.join=function(e){if(0===this.length)return"";for(var t=this.head,i=""+t.data;t=t.next;)i+=e+t.data;return i},e.prototype.concat=function(e){if(0===this.length)return n.alloc(0);if(1===this.length)return this.head.data;for(var t,i,a=n.allocUnsafe(e>>>0),s=this.head,r=0;s;)t=a,i=r,s.data.copy(t,i),r+=s.data.length,s=s.next;return a},e}(),a&&a.inspect&&a.inspect.custom&&(e.exports.prototype[a.inspect.custom]=function(){var e=a.inspect({length:this.length});return this.constructor.name+" "+e})},function(e,t){},function(e,t,i){(function(e){var n=void 0!==e&&e||"undefined"!=typeof self&&self||window,a=Function.prototype.apply;function s(e,t){this._id=e,this._clearFn=t}t.setTimeout=function(){return new s(a.call(setTimeout,n,arguments),clearTimeout)},t.setInterval=function(){return new s(a.call(setInterval,n,arguments),clearInterval)},t.clearTimeout=t.clearInterval=function(e){e&&e.close()},s.prototype.unref=s.prototype.ref=function(){},s.prototype.close=function(){this._clearFn.call(n,this._id)},t.enroll=function(e,t){clearTimeout(e._idleTimeoutId),e._idleTimeout=t},t.unenroll=function(e){clearTimeout(e._idleTimeoutId),e._idleTimeout=-1},t._unrefActive=t.active=function(e){clearTimeout(e._idleTimeoutId);var t=e._idleTimeout;0<=t&&(e._idleTimeoutId=setTimeout(function(){e._onTimeout&&e._onTimeout()},t))},i(220),t.setImmediate="undefined"!=typeof self&&self.setImmediate||void 0!==e&&e.setImmediate||this&&this.setImmediate,t.clearImmediate="undefined"!=typeof self&&self.clearImmediate||void 0!==e&&e.clearImmediate||this&&this.clearImmediate}).call(this,i(12))},function(e,t,i){(function(e,t){!function(e,i){"use strict";if(!e.setImmediate){var n,a,s,r,o,c=1,d={},l=!1,g=e.document,h=Object.getPrototypeOf&&Object.getPrototypeOf(e);h=h&&h.setTimeout?h:e,n="[object process]"==={}.toString.call(e.process)?function(e){t.nextTick(function(){p(e)})}:function(){if(e.postMessage&&!e.importScripts){var t=!0,i=e.onmessage;return e.onmessage=function(){t=!1},e.postMessage("","*"),e.onmessage=i,t}}()?(r="setImmediate$"+Math.random()+"$",o=function(t){t.source===e&&"string"==typeof t.data&&0===t.data.indexOf(r)&&p(+t.data.slice(r.length))},e.addEventListener?e.addEventListener("message",o,!1):e.attachEvent("onmessage",o),function(t){e.postMessage(r+t,"*")}):e.MessageChannel?((s=new MessageChannel).port1.onmessage=function(e){p(e.data)},function(e){s.port2.postMessage(e)}):g&&"onreadystatechange"in g.createElement("script")?(a=g.documentElement,function(e){var t=g.createElement("script");t.onreadystatechange=function(){p(e),t.onreadystatechange=null,a.removeChild(t),t=null},a.appendChild(t)}):function(e){setTimeout(p,0,e)},h.setImmediate=function(e){"function"!=typeof e&&(e=new Function(""+e));for(var t=new Array(arguments.length-1),i=0;i<t.length;i++)t[i]=arguments[i+1];var a={callback:e,args:t};return d[c]=a,n(c),c++},h.clearImmediate=u}function u(e){delete d[e]}function p(e){if(l)setTimeout(p,0,e);else{var t=d[e];if(t){l=!0;try{!function(e){var t=e.callback,n=e.args;switch(n.length){case 0:t();break;case 1:t(n[0]);break;case 2:t(n[0],n[1]);break;case 3:t(n[0],n[1],n[2]);break;default:t.apply(i,n)}}(t)}finally{u(e),l=!1}}}}}("undefined"==typeof self?void 0===e?this:e:self)}).call(this,i(12),i(16))},function(e,t,i){(function(t){function i(e){try{if(!t.localStorage)return!1}catch(e){return!1}var i=t.localStorage[e];return null!=i&&"true"===String(i).toLowerCase()}e.exports=function(e,t){if(i("noDeprecation"))return e;var n=!1;return function(){if(!n){if(i("throwDeprecation"))throw new Error(t);i("traceDeprecation"),n=!0}return e.apply(this,arguments)}}}).call(this,i(12))},function(e,t,i){"use strict";e.exports=s;var n=i(108),a=i(30);function s(e){if(!(this instanceof s))return new s(e);n.call(this,e)}a.inherits=i(1),a.inherits(s,n),s.prototype._transform=function(e,t,i){i(null,e)}},function(e,t,i){e.exports=i(67)},function(e,t,i){e.exports=i(19)},function(e,t,i){e.exports=i(66).Transform},function(e,t,i){e.exports=i(66).PassThrough},function(e,t,i){var n=i(3),a=n.Buffer;function s(e,t){for(var i in e)t[i]=e[i]}function r(e,t,i){return a(e,t,i)}a.from&&a.alloc&&a.allocUnsafe&&a.allocUnsafeSlow?e.exports=n:(s(n,t),t.Buffer=r),s(a,r),r.from=function(e,t,i){if("number"==typeof e)throw new TypeError("Argument must not be a number");return a(e,t,i)},r.alloc=function(e,t,i){if("number"!=typeof e)throw new TypeError("Argument must be a number");var n=a(e);return void 0!==t?"string"==typeof i?n.fill(t,i):n.fill(t):n.fill(0),n},r.allocUnsafe=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return a(e)},r.allocUnsafeSlow=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return n.SlowBuffer(e)}},function(e,t,i){var n=i(1),a=i(24),s=i(2).Buffer,r=[1518500249,1859775393,-1894007588,-899497514],o=new Array(80);function c(){this.init(),this._w=o,a.call(this,64,56)}n(c,a),c.prototype.init=function(){return this._a=1732584193,this._b=4023233417,this._c=2562383102,this._d=271733878,this._e=3285377520,this},c.prototype._update=function(e){for(var t,i,n,a,s,o,c=this._w,d=0|this._a,l=0|this._b,g=0|this._c,h=0|this._d,u=0|this._e,p=0;p<16;++p)c[p]=e.readInt32BE(4*p);for(;p<80;++p)c[p]=c[p-3]^c[p-8]^c[p-14]^c[p-16];for(var f=0;f<80;++f){var m=~~(f/20),_=0|((o=d)<<5|o>>>27)+(n=l,a=g,s=h,0===(i=m)?n&a|~n&s:2===i?n&a|n&s|a&s:n^a^s)+u+c[f]+r[m];u=h,h=g,g=(t=l)<<30|t>>>2,l=d,d=_}this._a=d+this._a|0,this._b=l+this._b|0,this._c=g+this._c|0,this._d=h+this._d|0,this._e=u+this._e|0},c.prototype._hash=function(){var e=s.allocUnsafe(20);return e.writeInt32BE(0|this._a,0),e.writeInt32BE(0|this._b,4),e.writeInt32BE(0|this._c,8),e.writeInt32BE(0|this._d,12),e.writeInt32BE(0|this._e,16),e},e.exports=c},function(e,t,i){var n=i(1),a=i(24),s=i(2).Buffer,r=[1518500249,1859775393,-1894007588,-899497514],o=new Array(80);function c(){this.init(),this._w=o,a.call(this,64,56)}n(c,a),c.prototype.init=function(){return this._a=1732584193,this._b=4023233417,this._c=2562383102,this._d=271733878,this._e=3285377520,this},c.prototype._update=function(e){for(var t,i,n,a,s,o,c,d=this._w,l=0|this._a,g=0|this._b,h=0|this._c,u=0|this._d,p=0|this._e,f=0;f<16;++f)d[f]=e.readInt32BE(4*f);for(;f<80;++f)d[f]=(t=d[f-3]^d[f-8]^d[f-14]^d[f-16])<<1|t>>>31;for(var m=0;m<80;++m){var _=~~(m/20),b=0|((c=l)<<5|c>>>27)+(a=g,s=h,o=u,0===(n=_)?a&s|~a&o:2===n?a&s|a&o|s&o:a^s^o)+p+d[m]+r[_];p=u,u=h,h=(i=g)<<30|i>>>2,g=l,l=b}this._a=l+this._a|0,this._b=g+this._b|0,this._c=h+this._c|0,this._d=u+this._d|0,this._e=p+this._e|0},c.prototype._hash=function(){var e=s.allocUnsafe(20);return e.writeInt32BE(0|this._a,0),e.writeInt32BE(0|this._b,4),e.writeInt32BE(0|this._c,8),e.writeInt32BE(0|this._d,12),e.writeInt32BE(0|this._e,16),e},e.exports=c},function(e,t,i){var n=i(1),a=i(109),s=i(24),r=i(2).Buffer,o=new Array(64);function c(){this.init(),this._w=o,s.call(this,64,56)}n(c,a),c.prototype.init=function(){return this._a=3238371032,this._b=914150663,this._c=812702999,this._d=4144912697,this._e=4290775857,this._f=1750603025,this._g=1694076839,this._h=3204075428,this},c.prototype._hash=function(){var e=r.allocUnsafe(28);return e.writeInt32BE(this._a,0),e.writeInt32BE(this._b,4),e.writeInt32BE(this._c,8),e.writeInt32BE(this._d,12),e.writeInt32BE(this._e,16),e.writeInt32BE(this._f,20),e.writeInt32BE(this._g,24),e},e.exports=c},function(e,t,i){var n=i(1),a=i(110),s=i(24),r=i(2).Buffer,o=new Array(160);function c(){this.init(),this._w=o,s.call(this,128,112)}n(c,a),c.prototype.init=function(){return this._ah=3418070365,this._bh=1654270250,this._ch=2438529370,this._dh=355462360,this._eh=1731405415,this._fh=2394180231,this._gh=3675008525,this._hh=1203062813,this._al=3238371032,this._bl=914150663,this._cl=812702999,this._dl=4144912697,this._el=4290775857,this._fl=1750603025,this._gl=1694076839,this._hl=3204075428,this},c.prototype._hash=function(){var e=r.allocUnsafe(48);function t(t,i,n){e.writeInt32BE(t,n),e.writeInt32BE(i,n+4)}return t(this._ah,this._al,0),t(this._bh,this._bl,8),t(this._ch,this._cl,16),t(this._dh,this._dl,24),t(this._eh,this._el,32),t(this._fh,this._fl,40),e},e.exports=c},function(e,t,i){"use strict";var n=i(1),a=i(2).Buffer,s=i(17),r=a.alloc(128);function o(e,t){s.call(this,"digest"),"string"==typeof t&&(t=a.from(t)),this._alg=e,64<(this._key=t).length?t=e(t):t.length<64&&(t=a.concat([t,r],64));for(var i=this._ipad=a.allocUnsafe(64),n=this._opad=a.allocUnsafe(64),o=0;o<64;o++)i[o]=54^t[o],n[o]=92^t[o];this._hash=[i]}n(o,s),o.prototype._update=function(e){this._hash.push(e)},o.prototype._final=function(){var e=this._alg(a.concat(this._hash));return this._alg(a.concat([this._opad,e]))},e.exports=o},function(e,t,i){e.exports=i(113)},function(e,t,i){(function(t,n){var a,s=i(115),r=i(116),o=i(117),c=i(2).Buffer,d=t.crypto&&t.crypto.subtle,l={sha:"SHA-1","sha-1":"SHA-1",sha1:"SHA-1",sha256:"SHA-256","sha-256":"SHA-256",sha384:"SHA-384","sha-384":"SHA-384","sha-512":"SHA-512",sha512:"SHA-512"},g=[];function h(e,t,i,n,a){return d.importKey("raw",e,{name:"PBKDF2"},!1,["deriveBits"]).then(function(e){return d.deriveBits({name:"PBKDF2",salt:t,iterations:i,hash:{name:a}},e,n<<3)}).then(function(e){return c.from(e)})}e.exports=function(e,i,u,p,f,m){"function"==typeof f&&(m=f,f=void 0);var _,b,y=l[(f=f||"sha1").toLowerCase()];if(!y||"function"!=typeof t.Promise)return n.nextTick(function(){var t;try{t=o(e,i,u,p,f)}catch(t){return m(t)}m(null,t)});if(s(e,i,u,p),"function"!=typeof m)throw new Error("No callback provided to pbkdf2");c.isBuffer(e)||(e=c.from(e,r)),c.isBuffer(i)||(i=c.from(i,r)),_=function(e){if(t.process&&!t.process.browser)return Promise.resolve(!1);if(!d||!d.importKey||!d.deriveBits)return Promise.resolve(!1);if(void 0!==g[e])return g[e];var i=h(a=a||c.alloc(8),a,10,128,e).then(function(){return!0}).catch(function(){return!1});return g[e]=i}(y).then(function(t){return t?h(e,i,u,p,y):o(e,i,u,p,f)}),b=m,_.then(function(e){n.nextTick(function(){b(null,e)})},function(e){n.nextTick(function(){b(e)})})}}).call(this,i(12),i(16))},function(e,t,i){var n=i(236),a=i(72),s=i(73),r=i(252),o=i(46);function c(e,t,i){if(e=e.toLowerCase(),s[e])return a.createCipheriv(e,t,i);if(r[e])return new n({key:t,iv:i,mode:e});throw new TypeError("invalid suite type")}function d(e,t,i){if(e=e.toLowerCase(),s[e])return a.createDecipheriv(e,t,i);if(r[e])return new n({key:t,iv:i,mode:e,decrypt:!0});throw new TypeError("invalid suite type")}t.createCipher=t.Cipher=function(e,t){var i,n;if(e=e.toLowerCase(),s[e])i=s[e].key,n=s[e].iv;else{if(!r[e])throw new TypeError("invalid suite type");i=8*r[e].key,n=r[e].iv}var a=o(t,!1,i,n);return c(e,a.key,a.iv)},t.createCipheriv=t.Cipheriv=c,t.createDecipher=t.Decipher=function(e,t){var i,n;if(e=e.toLowerCase(),s[e])i=s[e].key,n=s[e].iv;else{if(!r[e])throw new TypeError("invalid suite type");i=8*r[e].key,n=r[e].iv}var a=o(t,!1,i,n);return d(e,a.key,a.iv)},t.createDecipheriv=t.Decipheriv=d,t.listCiphers=t.getCiphers=function(){return Object.keys(r).concat(a.getCiphers())}},function(e,t,i){var n=i(17),a=i(71),s=i(1),r=i(242).Buffer,o={"des-ede3-cbc":a.CBC.instantiate(a.EDE),"des-ede3":a.EDE,"des-ede-cbc":a.CBC.instantiate(a.EDE),"des-ede":a.EDE,"des-cbc":a.CBC.instantiate(a.DES),"des-ecb":a.DES};function c(e){n.call(this);var t,i=e.mode.toLowerCase(),a=o[i];t=e.decrypt?"decrypt":"encrypt";var s=e.key;r.isBuffer(s)||(s=r.from(s)),"des-ede"!==i&&"des-ede-cbc"!==i||(s=r.concat([s,s.slice(0,8)]));var c=e.iv;r.isBuffer(c)||(c=r.from(c)),this._des=a.create({key:s,iv:c,type:t})}o.des=o["des-cbc"],o.des3=o["des-ede3-cbc"],s(e.exports=c,n),c.prototype._update=function(e){return r.from(this._des.update(e))},c.prototype._final=function(){return r.from(this._des.final())}},function(e,t,i){"use strict";t.readUInt32BE=function(e,t){return(e[0+t]<<24|e[1+t]<<16|e[2+t]<<8|e[3+t])>>>0},t.writeUInt32BE=function(e,t,i){e[0+i]=t>>>24,e[1+i]=t>>>16&255,e[2+i]=t>>>8&255,e[3+i]=255&t},t.ip=function(e,t,i,n){for(var a=0,s=0,r=6;0<=r;r-=2){for(var o=0;o<=24;o+=8)a<<=1,a|=t>>>o+r&1;for(o=0;o<=24;o+=8)a<<=1,a|=e>>>o+r&1}for(r=6;0<=r;r-=2){for(o=1;o<=25;o+=8)s<<=1,s|=t>>>o+r&1;for(o=1;o<=25;o+=8)s<<=1,s|=e>>>o+r&1}i[n+0]=a>>>0,i[n+1]=s>>>0},t.rip=function(e,t,i,n){for(var a=0,s=0,r=0;r<4;r++)for(var o=24;0<=o;o-=8)a<<=1,a|=t>>>o+r&1,a<<=1,a|=e>>>o+r&1;for(r=4;r<8;r++)for(o=24;0<=o;o-=8)s<<=1,s|=t>>>o+r&1,s<<=1,s|=e>>>o+r&1;i[n+0]=a>>>0,i[n+1]=s>>>0},t.pc1=function(e,t,i,n){for(var a=0,s=0,r=7;5<=r;r--){for(var o=0;o<=24;o+=8)a<<=1,a|=t>>o+r&1;for(o=0;o<=24;o+=8)a<<=1,a|=e>>o+r&1}for(o=0;o<=24;o+=8)a<<=1,a|=t>>o+r&1;for(r=1;r<=3;r++){for(o=0;o<=24;o+=8)s<<=1,s|=t>>o+r&1;for(o=0;o<=24;o+=8)s<<=1,s|=e>>o+r&1}for(o=0;o<=24;o+=8)s<<=1,s|=e>>o+r&1;i[n+0]=a>>>0,i[n+1]=s>>>0},t.r28shl=function(e,t){return e<<t&268435455|e>>>28-t};var n=[14,11,17,4,27,23,25,0,13,22,7,18,5,9,16,24,2,20,12,21,1,8,15,26,15,4,25,19,9,1,26,16,5,11,23,8,12,7,17,0,22,3,10,14,6,20,27,24];t.pc2=function(e,t,i,a){for(var s=0,r=0,o=n.length>>>1,c=0;c<o;c++)s<<=1,s|=e>>>n[c]&1;for(c=o;c<n.length;c++)r<<=1,r|=t>>>n[c]&1;i[a+0]=s>>>0,i[a+1]=r>>>0},t.expand=function(e,t,i){var n=0,a=0;n=(1&e)<<5|e>>>27;for(var s=23;15<=s;s-=4)n<<=6,n|=e>>>s&63;for(s=11;3<=s;s-=4)a|=e>>>s&63,a<<=6;a|=(31&e)<<1|e>>>31,t[i+0]=n>>>0,t[i+1]=a>>>0};var a=[14,0,4,15,13,7,1,4,2,14,15,2,11,13,8,1,3,10,10,6,6,12,12,11,5,9,9,5,0,3,7,8,4,15,1,12,14,8,8,2,13,4,6,9,2,1,11,7,15,5,12,11,9,3,7,14,3,10,10,0,5,6,0,13,15,3,1,13,8,4,14,7,6,15,11,2,3,8,4,14,9,12,7,0,2,1,13,10,12,6,0,9,5,11,10,5,0,13,14,8,7,10,11,1,10,3,4,15,13,4,1,2,5,11,8,6,12,7,6,12,9,0,3,5,2,14,15,9,10,13,0,7,9,0,14,9,6,3,3,4,15,6,5,10,1,2,13,8,12,5,7,14,11,12,4,11,2,15,8,1,13,1,6,10,4,13,9,0,8,6,15,9,3,8,0,7,11,4,1,15,2,14,12,3,5,11,10,5,14,2,7,12,7,13,13,8,14,11,3,5,0,6,6,15,9,0,10,3,1,4,2,7,8,2,5,12,11,1,12,10,4,14,15,9,10,3,6,15,9,0,0,6,12,10,11,1,7,13,13,8,15,9,1,4,3,5,14,11,5,12,2,7,8,2,4,14,2,14,12,11,4,2,1,12,7,4,10,7,11,13,6,1,8,5,5,0,3,15,15,10,13,3,0,9,14,8,9,6,4,11,2,8,1,12,11,7,10,1,13,14,7,2,8,13,15,6,9,15,12,0,5,9,6,10,3,4,0,5,14,3,12,10,1,15,10,4,15,2,9,7,2,12,6,9,8,5,0,6,13,1,3,13,4,14,14,0,7,11,5,3,11,8,9,4,14,3,15,2,5,12,2,9,8,5,12,15,3,10,7,11,0,14,4,1,10,7,1,6,13,0,11,8,6,13,4,13,11,0,2,11,14,7,15,4,0,9,8,1,13,10,3,14,12,3,9,5,7,12,5,2,10,15,6,8,1,6,1,6,4,11,11,13,13,8,12,1,3,4,7,10,14,7,10,9,15,5,6,0,8,15,0,14,5,2,9,3,2,12,13,1,2,15,8,13,4,8,6,10,15,3,11,7,1,4,10,12,9,5,3,6,14,11,5,0,0,14,12,9,7,2,7,2,11,1,4,14,1,7,9,4,12,10,14,8,2,13,0,15,6,12,10,9,13,0,15,3,3,5,5,6,8,11];t.substitute=function(e,t){for(var i=0,n=0;n<4;n++)i<<=4,i|=a[64*n+(e>>>18-6*n&63)];for(n=0;n<4;n++)i<<=4,i|=a[256+64*n+(t>>>18-6*n&63)];return i>>>0};var s=[16,25,12,11,3,20,4,15,31,17,9,6,27,14,1,22,30,24,8,18,0,5,29,23,13,19,2,26,10,21,28,7];t.permute=function(e){for(var t=0,i=0;i<s.length;i++)t<<=1,t|=e>>>s[i]&1;return t>>>0},t.padSplit=function(e,t,i){for(var n=e.toString(2);n.length<t;)n="0"+n;for(var a=[],s=0;s<t;s+=i)a.push(n.slice(s,s+i));return a.join(" ")}},function(e,t,i){"use strict";var n=i(8);function a(e){this.options=e,this.type=this.options.type,this.blockSize=8,this._init(),this.buffer=new Array(this.blockSize),this.bufferOff=0}(e.exports=a).prototype._init=function(){},a.prototype.update=function(e){return 0===e.length?[]:"decrypt"===this.type?this._updateDecrypt(e):this._updateEncrypt(e)},a.prototype._buffer=function(e,t){for(var i=Math.min(this.buffer.length-this.bufferOff,e.length-t),n=0;n<i;n++)this.buffer[this.bufferOff+n]=e[t+n];return this.bufferOff+=i,i},a.prototype._flushBuffer=function(e,t){return this._update(this.buffer,0,e,t),this.bufferOff=0,this.blockSize},a.prototype._updateEncrypt=function(e){var t=0,i=0,n=(this.bufferOff+e.length)/this.blockSize|0,a=new Array(n*this.blockSize);0!==this.bufferOff&&(t+=this._buffer(e,t),this.bufferOff===this.buffer.length&&(i+=this._flushBuffer(a,i)));for(var s=e.length-(e.length-t)%this.blockSize;t<s;t+=this.blockSize)this._update(e,t,a,i),i+=this.blockSize;for(;t<e.length;t++,this.bufferOff++)this.buffer[this.bufferOff]=e[t];return a},a.prototype._updateDecrypt=function(e){for(var t=0,i=0,n=Math.ceil((this.bufferOff+e.length)/this.blockSize)-1,a=new Array(n*this.blockSize);0<n;n--)t+=this._buffer(e,t),i+=this._flushBuffer(a,i);return t+=this._buffer(e,t),a},a.prototype.final=function(e){var t,i;return e&&(t=this.update(e)),i="encrypt"===this.type?this._finalEncrypt():this._finalDecrypt(),t?t.concat(i):i},a.prototype._pad=function(e,t){if(0===t)return!1;for(;t<e.length;)e[t++]=0;return!0},a.prototype._finalEncrypt=function(){if(!this._pad(this.buffer,this.bufferOff))return[];var e=new Array(this.blockSize);return this._update(this.buffer,0,e,0),e},a.prototype._unpad=function(e){return e},a.prototype._finalDecrypt=function(){n.equal(this.bufferOff,this.blockSize,"Not enough data to decrypt");var e=new Array(this.blockSize);return this._flushBuffer(e,0),this._unpad(e)}},function(e,t,i){"use strict";var n=i(8),a=i(1),s=i(71),r=s.utils,o=s.Cipher;function c(){this.tmp=new Array(2),this.keys=null}function d(e){o.call(this,e);var t=new c;this._desState=t,this.deriveKeys(t,e.key)}a(d,o),(e.exports=d).create=function(e){return new d(e)};var l=[1,1,2,2,2,2,2,2,1,2,2,2,2,2,2,1];d.prototype.deriveKeys=function(e,t){e.keys=new Array(32),n.equal(t.length,this.blockSize,"Invalid key length");var i=r.readUInt32BE(t,0),a=r.readUInt32BE(t,4);r.pc1(i,a,e.tmp,0),i=e.tmp[0],a=e.tmp[1];for(var s=0;s<e.keys.length;s+=2){var o=l[s>>>1];i=r.r28shl(i,o),a=r.r28shl(a,o),r.pc2(i,a,e.keys,s)}},d.prototype._update=function(e,t,i,n){var a=this._desState,s=r.readUInt32BE(e,t),o=r.readUInt32BE(e,t+4);r.ip(s,o,a.tmp,0),s=a.tmp[0],o=a.tmp[1],"encrypt"===this.type?this._encrypt(a,s,o,a.tmp,0):this._decrypt(a,s,o,a.tmp,0),s=a.tmp[0],o=a.tmp[1],r.writeUInt32BE(i,s,n),r.writeUInt32BE(i,o,n+4)},d.prototype._pad=function(e,t){for(var i=e.length-t,n=t;n<e.length;n++)e[n]=i;return!0},d.prototype._unpad=function(e){for(var t=e[e.length-1],i=e.length-t;i<e.length;i++)n.equal(e[i],t);return e.slice(0,e.length-t)},d.prototype._encrypt=function(e,t,i,n,a){for(var s=t,o=i,c=0;c<e.keys.length;c+=2){var d=e.keys[c],l=e.keys[c+1];r.expand(o,e.tmp,0),d^=e.tmp[0],l^=e.tmp[1];var g=r.substitute(d,l),h=o;o=(s^r.permute(g))>>>0,s=h}r.rip(o,s,n,a)},d.prototype._decrypt=function(e,t,i,n,a){for(var s=i,o=t,c=e.keys.length-2;0<=c;c-=2){var d=e.keys[c],l=e.keys[c+1];r.expand(s,e.tmp,0),d^=e.tmp[0],l^=e.tmp[1];var g=r.substitute(d,l),h=s;s=(o^r.permute(g))>>>0,o=h}r.rip(s,o,n,a)}},function(e,t,i){"use strict";var n=i(8),a=i(1),s={};function r(e){n.equal(e.length,8,"Invalid IV length"),this.iv=new Array(8);for(var t=0;t<this.iv.length;t++)this.iv[t]=e[t]}t.instantiate=function(e){function t(t){e.call(this,t),this._cbcInit()}a(t,e);for(var i=Object.keys(s),n=0;n<i.length;n++){var r=i[n];t.prototype[r]=s[r]}return t.create=function(e){return new t(e)},t},s._cbcInit=function(){var e=new r(this.options.iv);this._cbcState=e},s._update=function(e,t,i,n){var a=this._cbcState,s=this.constructor.super_.prototype,r=a.iv;if("encrypt"===this.type){for(var o=0;o<this.blockSize;o++)r[o]^=e[t+o];for(s._update.call(this,r,0,i,n),o=0;o<this.blockSize;o++)r[o]=i[n+o]}else{for(s._update.call(this,e,t,i,n),o=0;o<this.blockSize;o++)i[n+o]^=r[o];for(o=0;o<this.blockSize;o++)r[o]=e[t+o]}}},function(e,t,i){"use strict";var n=i(8),a=i(1),s=i(71),r=s.Cipher,o=s.DES;function c(e,t){n.equal(t.length,24,"Invalid key length");var i=t.slice(0,8),a=t.slice(8,16),s=t.slice(16,24);this.ciphers="encrypt"===e?[o.create({type:"encrypt",key:i}),o.create({type:"decrypt",key:a}),o.create({type:"encrypt",key:s})]:[o.create({type:"decrypt",key:s}),o.create({type:"encrypt",key:a}),o.create({type:"decrypt",key:i})]}function d(e){r.call(this,e);var t=new c(this.type,this.options.key);this._edeState=t}a(d,r),(e.exports=d).create=function(e){return new d(e)},d.prototype._update=function(e,t,i,n){var a=this._edeState;a.ciphers[0]._update(e,t,i,n),a.ciphers[1]._update(i,n,i,n),a.ciphers[2]._update(i,n,i,n)},d.prototype._pad=o.prototype._pad,d.prototype._unpad=o.prototype._unpad},function(e,t,i){var n=i(3),a=n.Buffer;function s(e,t){for(var i in e)t[i]=e[i]}function r(e,t,i){return a(e,t,i)}a.from&&a.alloc&&a.allocUnsafe&&a.allocUnsafeSlow?e.exports=n:(s(n,t),t.Buffer=r),s(a,r),r.from=function(e,t,i){if("number"==typeof e)throw new TypeError("Argument must not be a number");return a(e,t,i)},r.alloc=function(e,t,i){if("number"!=typeof e)throw new TypeError("Argument must be a number");var n=a(e);return void 0!==t?"string"==typeof i?n.fill(t,i):n.fill(t):n.fill(0),n},r.allocUnsafe=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return a(e)},r.allocUnsafeSlow=function(e){if("number"!=typeof e)throw new TypeError("Argument must be a number");return n.SlowBuffer(e)}},function(e,t,i){var n=i(73),a=i(121),s=i(2).Buffer,r=i(122),o=i(17),c=i(45),d=i(46);function l(e,t,i){o.call(this),this._cache=new h,this._cipher=new c.AES(t),this._prev=s.from(i),this._mode=e,this._autopadding=!0}i(1)(l,o),l.prototype._update=function(e){var t,i;this._cache.add(e);for(var n=[];t=this._cache.get();)i=this._mode.encrypt(this,t),n.push(i);return s.concat(n)};var g=s.alloc(16,16);function h(){this.cache=s.allocUnsafe(0)}function u(e,t,i){var o=n[e.toLowerCase()];if(!o)throw new TypeError("invalid suite type");if("string"==typeof t&&(t=s.from(t)),t.length!==o.key/8)throw new TypeError("invalid key length "+t.length);if("string"==typeof i&&(i=s.from(i)),"GCM"!==o.mode&&i.length!==o.iv)throw new TypeError("invalid iv length "+i.length);return"stream"===o.type?new r(o.module,t,i):"auth"===o.type?new a(o.module,t,i):new l(o.module,t,i)}l.prototype._final=function(){var e=this._cache.flush();if(this._autopadding)return e=this._mode.encrypt(this,e),this._cipher.scrub(),e;if(!e.equals(g))throw this._cipher.scrub(),new Error("data not multiple of block length")},l.prototype.setAutoPadding=function(e){return this._autopadding=!!e,this},h.prototype.add=function(e){this.cache=s.concat([this.cache,e])},h.prototype.get=function(){if(15<this.cache.length){var e=this.cache.slice(0,16);return this.cache=this.cache.slice(16),e}return null},h.prototype.flush=function(){for(var e=16-this.cache.length,t=s.allocUnsafe(e),i=-1;++i<e;)t.writeUInt8(e,i);return s.concat([this.cache,t])},t.createCipheriv=u,t.createCipher=function(e,t){var i=n[e.toLowerCase()];if(!i)throw new TypeError("invalid suite type");var a=d(t,!1,i.key,i.iv);return u(e,a.key,a.iv)}},function(e,t){t.encrypt=function(e,t){return e._cipher.encryptBlock(t)},t.decrypt=function(e,t){return e._cipher.decryptBlock(t)}},function(e,t,i){var n=i(31);t.encrypt=function(e,t){var i=n(t,e._prev);return e._prev=e._cipher.encryptBlock(i),e._prev},t.decrypt=function(e,t){var i=e._prev;e._prev=t;var a=e._cipher.decryptBlock(t);return n(a,i)}},function(e,t,i){var n=i(2).Buffer,a=i(31);function s(e,t,i){var s=t.length,r=a(t,e._cache);return e._cache=e._cache.slice(s),e._prev=n.concat([e._prev,i?t:r]),r}t.encrypt=function(e,t,i){for(var a,r=n.allocUnsafe(0);t.length;){if(0===e._cache.length&&(e._cache=e._cipher.encryptBlock(e._prev),e._prev=n.allocUnsafe(0)),!(e._cache.length<=t.length)){r=n.concat([r,s(e,t,i)]);break}a=e._cache.length,r=n.concat([r,s(e,t.slice(0,a),i)]),t=t.slice(a)}return r}},function(e,t,i){var n=i(2).Buffer;t.encrypt=function(e,t,i){for(var a,s,r,o,c=t.length,d=n.allocUnsafe(c),l=-1;++l<c;)d[l]=(a=e,s=t[l],r=i,o=a._cipher.encryptBlock(a._prev)[0]^s,a._prev=n.concat([a._prev.slice(1),n.from([r?s:o])]),o);return d}},function(e,t,i){var n=i(2).Buffer;function a(e,t,i){for(var n,a,r=-1,o=0;++r<8;)n=t&1<<7-r?128:0,o+=(128&(a=e._cipher.encryptBlock(e._prev)[0]^n))>>r%8,e._prev=s(e._prev,i?n:a);return o}function s(e,t){var i=e.length,a=-1,s=n.allocUnsafe(e.length);for(e=n.concat([e,n.from([t])]);++a<i;)s[a]=e[a]<<1|e[a+1]>>7;return s}t.encrypt=function(e,t,i){for(var s=t.length,r=n.allocUnsafe(s),o=-1;++o<s;)r[o]=a(e,t[o],i);return r}},function(e,t,i){(function(e){var n=i(31);t.encrypt=function(t,i){for(;t._cache.length<i.length;)t._cache=e.concat([t._cache,(a=t,a._prev=a._cipher.encryptBlock(a._prev),a._prev)]);var a,s=t._cache.slice(0,i.length);return t._cache=t._cache.slice(i.length),n(i,s)}}).call(this,i(3).Buffer)},function(e,t,i){var n=i(2).Buffer,a=n.alloc(16,0);function s(e){var t=n.allocUnsafe(16);return t.writeUInt32BE(e[0]>>>0,0),t.writeUInt32BE(e[1]>>>0,4),t.writeUInt32BE(e[2]>>>0,8),t.writeUInt32BE(e[3]>>>0,12),t}function r(e){this.h=e,this.state=n.alloc(16,0),this.cache=n.allocUnsafe(0)}r.prototype.ghash=function(e){for(var t=-1;++t<e.length;)this.state[t]^=e[t];this._multiply()},r.prototype._multiply=function(){for(var e,t,i,n=[(e=this.h).readUInt32BE(0),e.readUInt32BE(4),e.readUInt32BE(8),e.readUInt32BE(12)],a=[0,0,0,0],r=-1;++r<128;){for(0!=(this.state[~~(r/8)]&1<<7-r%8)&&(a[0]^=n[0],a[1]^=n[1],a[2]^=n[2],a[3]^=n[3]),i=0!=(1&n[3]),t=3;0<t;t--)n[t]=n[t]>>>1|(1&n[t-1])<<31;n[0]=n[0]>>>1,i&&(n[0]=n[0]^225<<24)}this.state=s(a)},r.prototype.update=function(e){var t;for(this.cache=n.concat([this.cache,e]);16<=this.cache.length;)t=this.cache.slice(0,16),this.cache=this.cache.slice(16),this.ghash(t)},r.prototype.final=function(e,t){return this.cache.length&&this.ghash(n.concat([this.cache,a],16)),this.ghash(s([0,e,0,t])),this.state},e.exports=r},function(e,t,i){var n=i(121),a=i(2).Buffer,s=i(73),r=i(122),o=i(17),c=i(45),d=i(46);function l(e,t,i){o.call(this),this._cache=new g,this._last=void 0,this._cipher=new c.AES(t),this._prev=a.from(i),this._mode=e,this._autopadding=!0}function g(){this.cache=a.allocUnsafe(0)}function h(e,t,i){var o=s[e.toLowerCase()];if(!o)throw new TypeError("invalid suite type");if("string"==typeof i&&(i=a.from(i)),"GCM"!==o.mode&&i.length!==o.iv)throw new TypeError("invalid iv length "+i.length);if("string"==typeof t&&(t=a.from(t)),t.length!==o.key/8)throw new TypeError("invalid key length "+t.length);return"stream"===o.type?new r(o.module,t,i,!0):"auth"===o.type?new n(o.module,t,i,!0):new l(o.module,t,i)}i(1)(l,o),l.prototype._update=function(e){var t,i;this._cache.add(e);for(var n=[];t=this._cache.get(this._autopadding);)i=this._mode.decrypt(this,t),n.push(i);return a.concat(n)},l.prototype._final=function(){var e=this._cache.flush();if(this._autopadding)return function(e){var t=e[15];if(t<1||16<t)throw new Error("unable to decrypt data");for(var i=-1;++i<t;)if(e[i+(16-t)]!==t)throw new Error("unable to decrypt data");if(16!==t)return e.slice(0,16-t)}(this._mode.decrypt(this,e));if(e)throw new Error("data not multiple of block length")},l.prototype.setAutoPadding=function(e){return this._autopadding=!!e,this},g.prototype.add=function(e){this.cache=a.concat([this.cache,e])},g.prototype.get=function(e){var t;if(e){if(16<this.cache.length)return t=this.cache.slice(0,16),this.cache=this.cache.slice(16),t}else if(16<=this.cache.length)return t=this.cache.slice(0,16),this.cache=this.cache.slice(16),t;return null},g.prototype.flush=function(){if(this.cache.length)return this.cache},t.createDecipher=function(e,t){var i=s[e.toLowerCase()];if(!i)throw new TypeError("invalid suite type");var n=d(t,!1,i.key,i.iv);return h(e,n.key,n.iv)},t.createDecipheriv=h},function(e,t){t["des-ecb"]={key:8,iv:0},t["des-cbc"]=t.des={key:8,iv:8},t["des-ede3-cbc"]=t.des3={key:24,iv:8},t["des-ede3"]={key:24,iv:0},t["des-ede-cbc"]={key:16,iv:8},t["des-ede"]={key:16,iv:0}},function(e,t,i){(function(e){var n=i(123),a=i(256),s=i(257),r={binary:!0,hex:!0,base64:!0};t.DiffieHellmanGroup=t.createDiffieHellmanGroup=t.getDiffieHellman=function(t){var i=new e(a[t].prime,"hex"),n=new e(a[t].gen,"hex");return new s(i,n)},t.createDiffieHellman=t.DiffieHellman=function t(i,a,o,c){return e.isBuffer(a)||void 0===r[a]?t(i,"binary",a,o):(a=a||"binary",c=c||"binary",o=o||new e([2]),e.isBuffer(o)||(o=new e(o,c)),"number"==typeof i?new s(n(i,o),o,!0):(e.isBuffer(i)||(i=new e(i,a)),new s(i,o,!0)))}}).call(this,i(3).Buffer)},function(e,t){},function(e,t){},function(e){e.exports={modp1:{gen:"02",prime:"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a63a3620ffffffffffffffff"},modp2:{gen:"02",prime:"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece65381ffffffffffffffff"},modp5:{gen:"02",prime:"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece45b3dc2007cb8a163bf0598da48361c55d39a69163fa8fd24cf5f83655d23dca3ad961c62f356208552bb9ed529077096966d670c354e4abc9804f1746c08ca237327ffffffffffffffff"},modp14:{gen:"02",prime:"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece45b3dc2007cb8a163bf0598da48361c55d39a69163fa8fd24cf5f83655d23dca3ad961c62f356208552bb9ed529077096966d670c354e4abc9804f1746c08ca18217c32905e462e36ce3be39e772c180e86039b2783a2ec07a28fb5c55df06f4c52c9de2bcbf6955817183995497cea956ae515d2261898fa051015728e5a8aacaa68ffffffffffffffff"},modp15:{gen:"02",prime:"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece45b3dc2007cb8a163bf0598da48361c55d39a69163fa8fd24cf5f83655d23dca3ad961c62f356208552bb9ed529077096966d670c354e4abc9804f1746c08ca18217c32905e462e36ce3be39e772c180e86039b2783a2ec07a28fb5c55df06f4c52c9de2bcbf6955817183995497cea956ae515d2261898fa051015728e5a8aaac42dad33170d04507a33a85521abdf1cba64ecfb850458dbef0a8aea71575d060c7db3970f85a6e1e4c7abf5ae8cdb0933d71e8c94e04a25619dcee3d2261ad2ee6bf12ffa06d98a0864d87602733ec86a64521f2b18177b200cbbe117577a615d6c770988c0bad946e208e24fa074e5ab3143db5bfce0fd108e4b82d120a93ad2caffffffffffffffff"},modp16:{gen:"02",prime:"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece45b3dc2007cb8a163bf0598da48361c55d39a69163fa8fd24cf5f83655d23dca3ad961c62f356208552bb9ed529077096966d670c354e4abc9804f1746c08ca18217c32905e462e36ce3be39e772c180e86039b2783a2ec07a28fb5c55df06f4c52c9de2bcbf6955817183995497cea956ae515d2261898fa051015728e5a8aaac42dad33170d04507a33a85521abdf1cba64ecfb850458dbef0a8aea71575d060c7db3970f85a6e1e4c7abf5ae8cdb0933d71e8c94e04a25619dcee3d2261ad2ee6bf12ffa06d98a0864d87602733ec86a64521f2b18177b200cbbe117577a615d6c770988c0bad946e208e24fa074e5ab3143db5bfce0fd108e4b82d120a92108011a723c12a787e6d788719a10bdba5b2699c327186af4e23c1a946834b6150bda2583e9ca2ad44ce8dbbbc2db04de8ef92e8efc141fbecaa6287c59474e6bc05d99b2964fa090c3a2233ba186515be7ed1f612970cee2d7afb81bdd762170481cd0069127d5b05aa993b4ea988d8fddc186ffb7dc90a6c08f4df435c934063199ffffffffffffffff"},modp17:{gen:"02",prime:"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece45b3dc2007cb8a163bf0598da48361c55d39a69163fa8fd24cf5f83655d23dca3ad961c62f356208552bb9ed529077096966d670c354e4abc9804f1746c08ca18217c32905e462e36ce3be39e772c180e86039b2783a2ec07a28fb5c55df06f4c52c9de2bcbf6955817183995497cea956ae515d2261898fa051015728e5a8aaac42dad33170d04507a33a85521abdf1cba64ecfb850458dbef0a8aea71575d060c7db3970f85a6e1e4c7abf5ae8cdb0933d71e8c94e04a25619dcee3d2261ad2ee6bf12ffa06d98a0864d87602733ec86a64521f2b18177b200cbbe117577a615d6c770988c0bad946e208e24fa074e5ab3143db5bfce0fd108e4b82d120a92108011a723c12a787e6d788719a10bdba5b2699c327186af4e23c1a946834b6150bda2583e9ca2ad44ce8dbbbc2db04de8ef92e8efc141fbecaa6287c59474e6bc05d99b2964fa090c3a2233ba186515be7ed1f612970cee2d7afb81bdd762170481cd0069127d5b05aa993b4ea988d8fddc186ffb7dc90a6c08f4df435c93402849236c3fab4d27c7026c1d4dcb2602646dec9751e763dba37bdf8ff9406ad9e530ee5db382f413001aeb06a53ed9027d831179727b0865a8918da3edbebcf9b14ed44ce6cbaced4bb1bdb7f1447e6cc254b332051512bd7af426fb8f401378cd2bf5983ca01c64b92ecf032ea15d1721d03f482d7ce6e74fef6d55e702f46980c82b5a84031900b1c9e59e7c97fbec7e8f323a97a7e36cc88be0f1d45b7ff585ac54bd407b22b4154aacc8f6d7ebf48e1d814cc5ed20f8037e0a79715eef29be32806a1d58bb7c5da76f550aa3d8a1fbff0eb19ccb1a313d55cda56c9ec2ef29632387fe8d76e3c0468043e8f663f4860ee12bf2d5b0b7474d6e694f91e6dcc4024ffffffffffffffff"},modp18:{gen:"02",prime:"ffffffffffffffffc90fdaa22168c234c4c6628b80dc1cd129024e088a67cc74020bbea63b139b22514a08798e3404ddef9519b3cd3a431b302b0a6df25f14374fe1356d6d51c245e485b576625e7ec6f44c42e9a637ed6b0bff5cb6f406b7edee386bfb5a899fa5ae9f24117c4b1fe649286651ece45b3dc2007cb8a163bf0598da48361c55d39a69163fa8fd24cf5f83655d23dca3ad961c62f356208552bb9ed529077096966d670c354e4abc9804f1746c08ca18217c32905e462e36ce3be39e772c180e86039b2783a2ec07a28fb5c55df06f4c52c9de2bcbf6955817183995497cea956ae515d2261898fa051015728e5a8aaac42dad33170d04507a33a85521abdf1cba64ecfb850458dbef0a8aea71575d060c7db3970f85a6e1e4c7abf5ae8cdb0933d71e8c94e04a25619dcee3d2261ad2ee6bf12ffa06d98a0864d87602733ec86a64521f2b18177b200cbbe117577a615d6c770988c0bad946e208e24fa074e5ab3143db5bfce0fd108e4b82d120a92108011a723c12a787e6d788719a10bdba5b2699c327186af4e23c1a946834b6150bda2583e9ca2ad44ce8dbbbc2db04de8ef92e8efc141fbecaa6287c59474e6bc05d99b2964fa090c3a2233ba186515be7ed1f612970cee2d7afb81bdd762170481cd0069127d5b05aa993b4ea988d8fddc186ffb7dc90a6c08f4df435c93402849236c3fab4d27c7026c1d4dcb2602646dec9751e763dba37bdf8ff9406ad9e530ee5db382f413001aeb06a53ed9027d831179727b0865a8918da3edbebcf9b14ed44ce6cbaced4bb1bdb7f1447e6cc254b332051512bd7af426fb8f401378cd2bf5983ca01c64b92ecf032ea15d1721d03f482d7ce6e74fef6d55e702f46980c82b5a84031900b1c9e59e7c97fbec7e8f323a97a7e36cc88be0f1d45b7ff585ac54bd407b22b4154aacc8f6d7ebf48e1d814cc5ed20f8037e0a79715eef29be32806a1d58bb7c5da76f550aa3d8a1fbff0eb19ccb1a313d55cda56c9ec2ef29632387fe8d76e3c0468043e8f663f4860ee12bf2d5b0b7474d6e694f91e6dbe115974a3926f12fee5e438777cb6a932df8cd8bec4d073b931ba3bc832b68d9dd300741fa7bf8afc47ed2576f6936ba424663aab639c5ae4f5683423b4742bf1c978238f16cbe39d652de3fdb8befc848ad922222e04a4037c0713eb57a81a23f0c73473fc646cea306b4bcbc8862f8385ddfa9d4b7fa2c087e879683303ed5bdd3a062b3cf5b3a278a66d2a13f83f44f82ddf310ee074ab6a364597e899a0255dc164f31cc50846851df9ab48195ded7ea1b1d510bd7ee74d73faf36bc31ecfa268359046f4eb879f924009438b481c6cd7889a002ed5ee382bc9190da6fc026e479558e4475677e9aa9e3050e2765694dfc81f56e880b96e7160c980dd98edd3dfffffffffffffffff"}}},function(e,t,i){(function(t){var n=i(4),a=new(i(124)),s=new n(24),r=new n(11),o=new n(10),c=new n(3),d=new n(7),l=i(123),g=i(23);function h(e,i){return i=i||"utf8",t.isBuffer(e)||(e=new t(e,i)),this._pub=new n(e),this}function u(e,i){return i=i||"utf8",t.isBuffer(e)||(e=new t(e,i)),this._priv=new n(e),this}e.exports=f;var p={};function f(e,t,i){this.setGenerator(t),this.__prime=new n(e),this._prime=n.mont(this.__prime),this._primeLen=e.length,this._pub=void 0,this._priv=void 0,this._primeCode=void 0,i?(this.setPublicKey=h,this.setPrivateKey=u):this._primeCode=8}function m(e,i){var n=new t(e.toArray());return i?n.toString(i):n}Object.defineProperty(f.prototype,"verifyError",{enumerable:!0,get:function(){return"number"!=typeof this._primeCode&&(this._primeCode=function(e,t){var i=t.toString("hex"),n=[i,e.toString(16)].join("_");if(n in p)return p[n];var g,h=0;if(e.isEven()||!l.simpleSieve||!l.fermatTest(e)||!a.test(e))return h+=1,h+="02"===i||"05"===i?8:4,p[n]=h;switch(a.test(e.shrn(1))||(h+=2),i){case"02":e.mod(s).cmp(r)&&(h+=8);break;case"05":(g=e.mod(o)).cmp(c)&&g.cmp(d)&&(h+=8);break;default:h+=4}return p[n]=h}(this.__prime,this.__gen)),this._primeCode}}),f.prototype.generateKeys=function(){return this._priv||(this._priv=new n(g(this._primeLen))),this._pub=this._gen.toRed(this._prime).redPow(this._priv).fromRed(),this.getPublicKey()},f.prototype.computeSecret=function(e){var i=(e=(e=new n(e)).toRed(this._prime)).redPow(this._priv).fromRed(),a=new t(i.toArray()),s=this.getPrime();if(a.length<s.length){var r=new t(s.length-a.length);r.fill(0),a=t.concat([r,a])}return a},f.prototype.getPublicKey=function(e){return m(this._pub,e)},f.prototype.getPrivateKey=function(e){return m(this._priv,e)},f.prototype.getPrime=function(e){return m(this.__prime,e)},f.prototype.getGenerator=function(e){return m(this._gen,e)},f.prototype.setGenerator=function(e,i){return i=i||"utf8",t.isBuffer(e)||(e=new t(e,i)),this.__gen=e,this._gen=new n(e),this}}).call(this,i(3).Buffer)},function(e,t,i){(function(t){var n=i(29),a=i(64),s=i(1),r=i(259),o=i(295),c=i(113);function d(e){a.Writable.call(this);var t=c[e];if(!t)throw new Error("Unknown message digest");this._hashType=t.hash,this._hash=n(t.hash),this._tag=t.id,this._signType=t.sign}function l(e){a.Writable.call(this);var t=c[e];if(!t)throw new Error("Unknown message digest");this._hash=n(t.hash),this._tag=t.id,this._signType=t.sign}function g(e){return new d(e)}function h(e){return new l(e)}Object.keys(c).forEach(function(e){c[e].id=new t(c[e].id,"hex"),c[e.toLowerCase()]=c[e]}),s(d,a.Writable),d.prototype._write=function(e,t,i){this._hash.update(e),i()},d.prototype.update=function(e,i){return"string"==typeof e&&(e=new t(e,i)),this._hash.update(e),this},d.prototype.sign=function(e,t){this.end();var i=this._hash.digest(),n=r(i,e,this._hashType,this._signType,this._tag);return t?n.toString(t):n},s(l,a.Writable),l.prototype._write=function(e,t,i){this._hash.update(e),i()},l.prototype.update=function(e,i){return"string"==typeof e&&(e=new t(e,i)),this._hash.update(e),this},l.prototype.verify=function(e,i,n){"string"==typeof i&&(i=new t(i,n)),this.end();var a=this._hash.digest();return o(i,a,e,this._signType,this._tag)},e.exports={Sign:g,Verify:h,createSign:g,createVerify:h}}).call(this,i(3).Buffer)},function(e,t,i){(function(t){var n=i(111),a=i(74),s=i(5).ec,r=i(4),o=i(48),c=i(134);function d(e,i,a,s){if((e=new t(e.toArray())).length<i.byteLength()){var r=new t(i.byteLength()-e.length);r.fill(0),e=t.concat([r,e])}var o=a.length,c=function(e,i){e=(e=l(e,i)).mod(i);var n=new t(e.toArray());if(n.length<i.byteLength()){var a=new t(i.byteLength()-n.length);a.fill(0),n=t.concat([a,n])}return n}(a,i),d=new t(o);d.fill(1);var g=new t(o);return g.fill(0),g=n(s,g).update(d).update(new t([0])).update(e).update(c).digest(),d=n(s,g).update(d).digest(),{k:g=n(s,g).update(d).update(new t([1])).update(e).update(c).digest(),v:d=n(s,g).update(d).digest()}}function l(e,t){var i=new r(e),n=(e.length<<3)-t.bitLength();return 0<n&&i.ishrn(n),i}function g(e,i,a){var s,r;do{for(s=new t(0);8*s.length<e.bitLength();)i.v=n(a,i.k).update(i.v).digest(),s=t.concat([s,i.v]);r=l(s,e),i.k=n(a,i.k).update(i.v).update(new t([0])).digest(),i.v=n(a,i.k).update(i.v).digest()}while(-1!==r.cmp(e));return r}e.exports=function(e,i,n,h,u){var p=o(i);if(p.curve){if("ecdsa"!==h&&"ecdsa/rsa"!==h)throw new Error("wrong private key type");return function(e,i){var n=c[i.curve.join(".")];if(!n)throw new Error("unknown curve "+i.curve.join("."));var a=new s(n).keyFromPrivate(i.privateKey).sign(e);return new t(a.toDER())}(e,p)}if("dsa"===p.type){if("dsa"!==h)throw new Error("wrong private key type");return function(e,i,n){for(var a,s,o,c,h=i.params.priv_key,u=i.params.p,p=i.params.q,f=i.params.g,m=new r(0),_=l(e,p).mod(p),b=!1,y=d(h,p,e,n);!1===b;)s=a=g(p,y,n),o=u,c=p,m=f.toRed(r.mont(o)).redPow(s).fromRed().mod(c),0===(b=a.invm(p).imul(_.add(h.mul(m))).mod(p)).cmpn(0)&&(b=!1,m=new r(0));return function(e,i){e=e.toArray(),i=i.toArray(),128&e[0]&&(e=[0].concat(e)),128&i[0]&&(i=[0].concat(i));var n=[48,e.length+i.length+4,2,e.length];return n=n.concat(e,[2,i.length],i),new t(n)}(m,b)}(e,p,n)}if("rsa"!==h&&"ecdsa/rsa"!==h)throw new Error("wrong private key type");e=t.concat([u,e]);for(var f=p.modulus.byteLength(),m=[0,1];e.length+m.length+1<f;)m.push(255);m.push(0);for(var _=-1;++_<e.length;)m.push(e[_]);return a(m,p)},e.exports.getKey=d,e.exports.makeKey=g}).call(this,i(3).Buffer)},function(e){e.exports={_args:[["elliptic@6.4.1","/var/jenkins/workspace/rm-maven3-java8-release"]],_development:!0,_from:"elliptic@6.4.1",_id:"elliptic@6.4.1",_inBundle:!1,_integrity:"sha512-BsXLz5sqX8OHcsh7CqBMztyXARmGQ3LWPtGjJi6DiJHq5C/qvi9P3OqgswKSDftbu8+IoI/QDTAm2fFnQ9SZSQ==",_location:"/elliptic",_phantomChildren:{},_requested:{type:"version",registry:!0,raw:"elliptic@6.4.1",name:"elliptic",escapedName:"elliptic",rawSpec:"6.4.1",saveSpec:null,fetchSpec:"6.4.1"},_requiredBy:["/browserify-sign","/create-ecdh"],_resolved:"http://nexus-npm.services.odigeo.com/repository/npm-all/elliptic/-/elliptic-6.4.1.tgz",_spec:"6.4.1",_where:"/var/jenkins/workspace/rm-maven3-java8-release",author:{name:"Fedor Indutny",email:"fedor@indutny.com"},bugs:{url:"https://github.com/indutny/elliptic/issues"},dependencies:{"bn.js":"^4.4.0",brorand:"^1.0.1","hash.js":"^1.0.0","hmac-drbg":"^1.0.0",inherits:"^2.0.1","minimalistic-assert":"^1.0.0","minimalistic-crypto-utils":"^1.0.0"},description:"EC cryptography",devDependencies:{brfs:"^1.4.3",coveralls:"^2.11.3",grunt:"^0.4.5","grunt-browserify":"^5.0.0","grunt-cli":"^1.2.0","grunt-contrib-connect":"^1.0.0","grunt-contrib-copy":"^1.0.0","grunt-contrib-uglify":"^1.0.1","grunt-mocha-istanbul":"^3.0.1","grunt-saucelabs":"^8.6.2",istanbul:"^0.4.2",jscs:"^2.9.0",jshint:"^2.6.0",mocha:"^2.1.0"},files:["lib"],homepage:"https://github.com/indutny/elliptic",keywords:["EC","Elliptic","curve","Cryptography"],license:"MIT",main:"lib/elliptic.js",name:"elliptic",repository:{type:"git",url:"git+ssh://git@github.com/indutny/elliptic.git"},scripts:{jscs:"jscs benchmarks/*.js lib/*.js lib/**/*.js lib/**/**/*.js test/index.js",jshint:"jscs benchmarks/*.js lib/*.js lib/**/*.js lib/**/**/*.js test/index.js",lint:"npm run jscs && npm run jshint",test:"npm run lint && npm run unit",unit:"istanbul test _mocha --reporter=spec test/index.js",version:"grunt dist && git add dist/"},version:"6.4.1"}},function(e,t,i){"use strict";var n=t,a=i(4),s=i(8),r=i(126);n.assert=s,n.toArray=r.toArray,n.zero2=r.zero2,n.toHex=r.toHex,n.encode=r.encode,n.getNAF=function(e,t){for(var i=[],n=1<<t+1,a=e.clone();0<=a.cmpn(1);){var s;if(a.isOdd()){var r=a.andln(n-1);s=(n>>1)-1<r?(n>>1)-r:r,a.isubn(s)}else s=0;i.push(s);for(var o=0!==a.cmpn(0)&&0===a.andln(n-1)?t+1:1,c=1;c<o;c++)i.push(0);a.iushrn(o)}return i},n.getJSF=function(e,t){var i=[[],[]];e=e.clone(),t=t.clone();for(var n=0,a=0;0<e.cmpn(-n)||0<t.cmpn(-a);){var s,r,o,c=e.andln(3)+n&3,d=t.andln(3)+a&3;3===c&&(c=-1),3===d&&(d=-1),s=0==(1&c)?0:3!=(o=e.andln(7)+n&7)&&5!==o||2!==d?c:-c,i[0].push(s),r=0==(1&d)?0:3!=(o=t.andln(7)+a&7)&&5!==o||2!==c?d:-d,i[1].push(r),2*n===s+1&&(n=1-n),2*a===r+1&&(a=1-a),e.iushrn(1),t.iushrn(1)}return i},n.cachedProperty=function(e,t,i){var n="_"+t;e.prototype[t]=function(){return void 0!==this[n]?this[n]:this[n]=i.call(this)}},n.parseBytes=function(e){return"string"==typeof e?n.toArray(e,"hex"):e},n.intFromLE=function(e){return new a(e,"hex","le")}},function(e,t,i){"use strict";var n=i(4),a=i(5).utils,s=a.getNAF,r=a.getJSF,o=a.assert;function c(e,t){this.type=e,this.p=new n(t.p,16),this.red=t.prime?n.red(t.prime):n.mont(this.p),this.zero=new n(0).toRed(this.red),this.one=new n(1).toRed(this.red),this.two=new n(2).toRed(this.red),this.n=t.n&&new n(t.n,16),this.g=t.g&&this.pointFromJSON(t.g,t.gRed),this._wnafT1=new Array(4),this._wnafT2=new Array(4),this._wnafT3=new Array(4),this._wnafT4=new Array(4);var i=this.n&&this.p.div(this.n);!i||0<i.cmpn(100)?this.redN=null:(this._maxwellTrick=!0,this.redN=this.n.toRed(this.red))}function d(e,t){this.curve=e,this.type=t,this.precomputed=null}(e.exports=c).prototype.point=function(){throw new Error("Not implemented")},c.prototype.validate=function(){throw new Error("Not implemented")},c.prototype._fixedNafMul=function(e,t){o(e.precomputed);var i=e._getDoubles(),n=s(t,1),a=(1<<i.step+1)-(i.step%2==0?2:1);a/=3;for(var r=[],c=0;c<n.length;c+=i.step){var d=0;for(t=c+i.step-1;c<=t;t--)d=(d<<1)+n[t];r.push(d)}for(var l=this.jpoint(null,null,null),g=this.jpoint(null,null,null),h=a;0<h;h--){for(c=0;c<r.length;c++)(d=r[c])===h?g=g.mixedAdd(i.points[c]):d===-h&&(g=g.mixedAdd(i.points[c].neg()));l=l.add(g)}return l.toP()},c.prototype._wnafMul=function(e,t){var i=4,n=e._getNAFPoints(i);i=n.wnd;for(var a=n.points,r=s(t,i),c=this.jpoint(null,null,null),d=r.length-1;0<=d;d--){for(t=0;0<=d&&0===r[d];d--)t++;if(0<=d&&t++,c=c.dblp(t),d<0)break;var l=r[d];o(0!==l),c="affine"===e.type?0<l?c.mixedAdd(a[l-1>>1]):c.mixedAdd(a[-l-1>>1].neg()):0<l?c.add(a[l-1>>1]):c.add(a[-l-1>>1].neg())}return"affine"===e.type?c.toP():c},c.prototype._wnafMulAdd=function(e,t,i,n,a){for(var o=this._wnafT1,c=this._wnafT2,d=this._wnafT3,l=0,g=0;g<n;g++){var h=(T=t[g])._getNAFPoints(e);o[g]=h.wnd,c[g]=h.points}for(g=n-1;1<=g;g-=2){var u=g-1,p=g;if(1===o[u]&&1===o[p]){var f=[t[u],null,null,t[p]];0===t[u].y.cmp(t[p].y)?(f[1]=t[u].add(t[p]),f[2]=t[u].toJ().mixedAdd(t[p].neg())):0===t[u].y.cmp(t[p].y.redNeg())?(f[1]=t[u].toJ().mixedAdd(t[p]),f[2]=t[u].add(t[p].neg())):(f[1]=t[u].toJ().mixedAdd(t[p]),f[2]=t[u].toJ().mixedAdd(t[p].neg()));var m=[-3,-1,-5,-7,0,7,5,1,3],_=r(i[u],i[p]);l=Math.max(_[0].length,l),d[u]=new Array(l),d[p]=new Array(l);for(var b=0;b<l;b++){var y=0|_[0][b],v=0|_[1][b];d[u][b]=m[3*(y+1)+(v+1)],d[p][b]=0,c[u]=f}}else d[u]=s(i[u],o[u]),d[p]=s(i[p],o[p]),l=Math.max(d[u].length,l),l=Math.max(d[p].length,l)}var S=this.jpoint(null,null,null),C=this._wnafT4;for(g=l;0<=g;g--){for(var w=0;0<=g;){var O=!0;for(b=0;b<n;b++)C[b]=0|d[b][g],0!==C[b]&&(O=!1);if(!O)break;w++,g--}if(0<=g&&w++,S=S.dblp(w),g<0)break;for(b=0;b<n;b++){var T,P=C[b];0!==P&&(0<P?T=c[b][P-1>>1]:P<0&&(T=c[b][-P-1>>1].neg()),S="affine"===T.type?S.mixedAdd(T):S.add(T))}}for(g=0;g<n;g++)c[g]=null;return a?S:S.toP()},(c.BasePoint=d).prototype.eq=function(){throw new Error("Not implemented")},d.prototype.validate=function(){return this.curve.validate(this)},c.prototype.decodePoint=function(e,t){e=a.toArray(e,t);var i=this.p.byteLength();if((4===e[0]||6===e[0]||7===e[0])&&e.length-1==2*i)return 6===e[0]?o(e[e.length-1]%2==0):7===e[0]&&o(e[e.length-1]%2==1),this.point(e.slice(1,1+i),e.slice(1+i,1+2*i));if((2===e[0]||3===e[0])&&e.length-1===i)return this.pointFromX(e.slice(1,1+i),3===e[0]);throw new Error("Unknown point format")},d.prototype.encodeCompressed=function(e){return this.encode(e,!0)},d.prototype._encode=function(e){var t=this.curve.p.byteLength(),i=this.getX().toArray("be",t);return e?[this.getY().isEven()?2:3].concat(i):[4].concat(i,this.getY().toArray("be",t))},d.prototype.encode=function(e,t){return a.encode(this._encode(t),e)},d.prototype.precompute=function(e){if(this.precomputed)return this;var t={doubles:null,naf:null,beta:null};return t.naf=this._getNAFPoints(8),t.doubles=this._getDoubles(4,e),t.beta=this._getBeta(),this.precomputed=t,this},d.prototype._hasDoubles=function(e){if(!this.precomputed)return!1;var t=this.precomputed.doubles;return!!t&&t.points.length>=Math.ceil((e.bitLength()+1)/t.step)},d.prototype._getDoubles=function(e,t){if(this.precomputed&&this.precomputed.doubles)return this.precomputed.doubles;for(var i=[this],n=this,a=0;a<t;a+=e){for(var s=0;s<e;s++)n=n.dbl();i.push(n)}return{step:e,points:i}},d.prototype._getNAFPoints=function(e){if(this.precomputed&&this.precomputed.naf)return this.precomputed.naf;for(var t=[this],i=(1<<e)-1,n=1===i?null:this.dbl(),a=1;a<i;a++)t[a]=t[a-1].add(n);return{wnd:e,points:t}},d.prototype._getBeta=function(){return null},d.prototype.dblp=function(e){for(var t=this,i=0;i<e;i++)t=t.dbl();return t}},function(e,t,i){"use strict";var n=i(47),a=i(5),s=i(4),r=i(1),o=n.base,c=a.utils.assert;function d(e){o.call(this,"short",e),this.a=new s(e.a,16).toRed(this.red),this.b=new s(e.b,16).toRed(this.red),this.tinv=this.two.redInvm(),this.zeroA=0===this.a.fromRed().cmpn(0),this.threeA=0===this.a.fromRed().sub(this.p).cmpn(-3),this.endo=this._getEndomorphism(e),this._endoWnafT1=new Array(4),this._endoWnafT2=new Array(4)}function l(e,t,i,n){o.BasePoint.call(this,e,"affine"),this.inf=null===t&&null===i?(this.x=null,!(this.y=null)):(this.x=new s(t,16),this.y=new s(i,16),n&&(this.x.forceRed(this.curve.red),this.y.forceRed(this.curve.red)),this.x.red||(this.x=this.x.toRed(this.curve.red)),this.y.red||(this.y=this.y.toRed(this.curve.red)),!1)}function g(e,t,i,n){o.BasePoint.call(this,e,"jacobian"),this.z=null===t&&null===i&&null===n?(this.x=this.curve.one,this.y=this.curve.one,new s(0)):(this.x=new s(t,16),this.y=new s(i,16),new s(n,16)),this.x.red||(this.x=this.x.toRed(this.curve.red)),this.y.red||(this.y=this.y.toRed(this.curve.red)),this.z.red||(this.z=this.z.toRed(this.curve.red)),this.zOne=this.z===this.curve.one}r(d,o),(e.exports=d).prototype._getEndomorphism=function(e){if(this.zeroA&&this.g&&this.n&&1===this.p.modn(3)){var t,i;if(e.beta)t=new s(e.beta,16).toRed(this.red);else{var n=this._getEndoRoots(this.p);t=(t=n[0].cmp(n[1])<0?n[0]:n[1]).toRed(this.red)}if(e.lambda)i=new s(e.lambda,16);else{var a=this._getEndoRoots(this.n);0===this.g.mul(a[0]).x.cmp(this.g.x.redMul(t))?i=a[0]:(i=a[1],c(0===this.g.mul(i).x.cmp(this.g.x.redMul(t))))}return{beta:t,lambda:i,basis:e.basis?e.basis.map(function(e){return{a:new s(e.a,16),b:new s(e.b,16)}}):this._getEndoBasis(i)}}},d.prototype._getEndoRoots=function(e){var t=e===this.p?this.red:s.mont(e),i=new s(2).toRed(t).redInvm(),n=i.redNeg(),a=new s(3).toRed(t).redNeg().redSqrt().redMul(i);return[n.redAdd(a).fromRed(),n.redSub(a).fromRed()]},d.prototype._getEndoBasis=function(e){for(var t,i,n,a,r,o,c,d,l,g=this.n.ushrn(Math.floor(this.n.bitLength()/2)),h=e,u=this.n.clone(),p=new s(1),f=new s(0),m=new s(0),_=new s(1),b=0;0!==h.cmpn(0);){var y=u.div(h);d=u.sub(y.mul(h)),l=m.sub(y.mul(p));var v=_.sub(y.mul(f));if(!n&&d.cmp(g)<0)t=c.neg(),i=p,n=d.neg(),a=l;else if(n&&2==++b)break;u=h,h=c=d,m=p,p=l,_=f,f=v}r=d.neg(),o=l;var S=n.sqr().add(a.sqr());return 0<=r.sqr().add(o.sqr()).cmp(S)&&(r=t,o=i),n.negative&&(n=n.neg(),a=a.neg()),r.negative&&(r=r.neg(),o=o.neg()),[{a:n,b:a},{a:r,b:o}]},d.prototype._endoSplit=function(e){var t=this.endo.basis,i=t[0],n=t[1],a=n.b.mul(e).divRound(this.n),s=i.b.neg().mul(e).divRound(this.n),r=a.mul(i.a),o=s.mul(n.a),c=a.mul(i.b),d=s.mul(n.b);return{k1:e.sub(r).sub(o),k2:c.add(d).neg()}},d.prototype.pointFromX=function(e,t){(e=new s(e,16)).red||(e=e.toRed(this.red));var i=e.redSqr().redMul(e).redIAdd(e.redMul(this.a)).redIAdd(this.b),n=i.redSqrt();if(0!==n.redSqr().redSub(i).cmp(this.zero))throw new Error("invalid point");var a=n.fromRed().isOdd();return(t&&!a||!t&&a)&&(n=n.redNeg()),this.point(e,n)},d.prototype.validate=function(e){if(e.inf)return!0;var t=e.x,i=e.y,n=this.a.redMul(t),a=t.redSqr().redMul(t).redIAdd(n).redIAdd(this.b);return 0===i.redSqr().redISub(a).cmpn(0)},d.prototype._endoWnafMulAdd=function(e,t,i){for(var n=this._endoWnafT1,a=this._endoWnafT2,s=0;s<e.length;s++){var r=this._endoSplit(t[s]),o=e[s],c=o._getBeta();r.k1.negative&&(r.k1.ineg(),o=o.neg(!0)),r.k2.negative&&(r.k2.ineg(),c=c.neg(!0)),n[2*s]=o,n[2*s+1]=c,a[2*s]=r.k1,a[2*s+1]=r.k2}for(var d=this._wnafMulAdd(1,n,a,2*s,i),l=0;l<2*s;l++)n[l]=null,a[l]=null;return d},r(l,o.BasePoint),d.prototype.point=function(e,t,i){return new l(this,e,t,i)},d.prototype.pointFromJSON=function(e,t){return l.fromJSON(this,e,t)},l.prototype._getBeta=function(){if(this.curve.endo){var e=this.precomputed;if(e&&e.beta)return e.beta;var t=this.curve.point(this.x.redMul(this.curve.endo.beta),this.y);if(e){var i=this.curve,n=function(e){return i.point(e.x.redMul(i.endo.beta),e.y)};(e.beta=t).precomputed={beta:null,naf:e.naf&&{wnd:e.naf.wnd,points:e.naf.points.map(n)},doubles:e.doubles&&{step:e.doubles.step,points:e.doubles.points.map(n)}}}return t}},l.prototype.toJSON=function(){return this.precomputed?[this.x,this.y,this.precomputed&&{doubles:this.precomputed.doubles&&{step:this.precomputed.doubles.step,points:this.precomputed.doubles.points.slice(1)},naf:this.precomputed.naf&&{wnd:this.precomputed.naf.wnd,points:this.precomputed.naf.points.slice(1)}}]:[this.x,this.y]},l.fromJSON=function(e,t,i){"string"==typeof t&&(t=JSON.parse(t));var n=e.point(t[0],t[1],i);if(!t[2])return n;function a(t){return e.point(t[0],t[1],i)}var s=t[2];return n.precomputed={beta:null,doubles:s.doubles&&{step:s.doubles.step,points:[n].concat(s.doubles.points.map(a))},naf:s.naf&&{wnd:s.naf.wnd,points:[n].concat(s.naf.points.map(a))}},n},l.prototype.inspect=function(){return this.isInfinity()?"<EC Point Infinity>":"<EC Point x: "+this.x.fromRed().toString(16,2)+" y: "+this.y.fromRed().toString(16,2)+">"},l.prototype.isInfinity=function(){return this.inf},l.prototype.add=function(e){if(this.inf)return e;if(e.inf)return this;if(this.eq(e))return this.dbl();if(this.neg().eq(e))return this.curve.point(null,null);if(0===this.x.cmp(e.x))return this.curve.point(null,null);var t=this.y.redSub(e.y);0!==t.cmpn(0)&&(t=t.redMul(this.x.redSub(e.x).redInvm()));var i=t.redSqr().redISub(this.x).redISub(e.x),n=t.redMul(this.x.redSub(i)).redISub(this.y);return this.curve.point(i,n)},l.prototype.dbl=function(){if(this.inf)return this;var e=this.y.redAdd(this.y);if(0===e.cmpn(0))return this.curve.point(null,null);var t=this.curve.a,i=this.x.redSqr(),n=e.redInvm(),a=i.redAdd(i).redIAdd(i).redIAdd(t).redMul(n),s=a.redSqr().redISub(this.x.redAdd(this.x)),r=a.redMul(this.x.redSub(s)).redISub(this.y);return this.curve.point(s,r)},l.prototype.getX=function(){return this.x.fromRed()},l.prototype.getY=function(){return this.y.fromRed()},l.prototype.mul=function(e){return e=new s(e,16),this._hasDoubles(e)?this.curve._fixedNafMul(this,e):this.curve.endo?this.curve._endoWnafMulAdd([this],[e]):this.curve._wnafMul(this,e)},l.prototype.mulAdd=function(e,t,i){var n=[this,t],a=[e,i];return this.curve.endo?this.curve._endoWnafMulAdd(n,a):this.curve._wnafMulAdd(1,n,a,2)},l.prototype.jmulAdd=function(e,t,i){var n=[this,t],a=[e,i];return this.curve.endo?this.curve._endoWnafMulAdd(n,a,!0):this.curve._wnafMulAdd(1,n,a,2,!0)},l.prototype.eq=function(e){return this===e||this.inf===e.inf&&(this.inf||0===this.x.cmp(e.x)&&0===this.y.cmp(e.y))},l.prototype.neg=function(e){if(this.inf)return this;var t=this.curve.point(this.x,this.y.redNeg());if(e&&this.precomputed){var i=this.precomputed,n=function(e){return e.neg()};t.precomputed={naf:i.naf&&{wnd:i.naf.wnd,points:i.naf.points.map(n)},doubles:i.doubles&&{step:i.doubles.step,points:i.doubles.points.map(n)}}}return t},l.prototype.toJ=function(){return this.inf?this.curve.jpoint(null,null,null):this.curve.jpoint(this.x,this.y,this.curve.one)},r(g,o.BasePoint),d.prototype.jpoint=function(e,t,i){return new g(this,e,t,i)},g.prototype.toP=function(){if(this.isInfinity())return this.curve.point(null,null);var e=this.z.redInvm(),t=e.redSqr(),i=this.x.redMul(t),n=this.y.redMul(t).redMul(e);return this.curve.point(i,n)},g.prototype.neg=function(){return this.curve.jpoint(this.x,this.y.redNeg(),this.z)},g.prototype.add=function(e){if(this.isInfinity())return e;if(e.isInfinity())return this;var t=e.z.redSqr(),i=this.z.redSqr(),n=this.x.redMul(t),a=e.x.redMul(i),s=this.y.redMul(t.redMul(e.z)),r=e.y.redMul(i.redMul(this.z)),o=n.redSub(a),c=s.redSub(r);if(0===o.cmpn(0))return 0!==c.cmpn(0)?this.curve.jpoint(null,null,null):this.dbl();var d=o.redSqr(),l=d.redMul(o),g=n.redMul(d),h=c.redSqr().redIAdd(l).redISub(g).redISub(g),u=c.redMul(g.redISub(h)).redISub(s.redMul(l)),p=this.z.redMul(e.z).redMul(o);return this.curve.jpoint(h,u,p)},g.prototype.mixedAdd=function(e){if(this.isInfinity())return e.toJ();if(e.isInfinity())return this;var t=this.z.redSqr(),i=this.x,n=e.x.redMul(t),a=this.y,s=e.y.redMul(t).redMul(this.z),r=i.redSub(n),o=a.redSub(s);if(0===r.cmpn(0))return 0!==o.cmpn(0)?this.curve.jpoint(null,null,null):this.dbl();var c=r.redSqr(),d=c.redMul(r),l=i.redMul(c),g=o.redSqr().redIAdd(d).redISub(l).redISub(l),h=o.redMul(l.redISub(g)).redISub(a.redMul(d)),u=this.z.redMul(r);return this.curve.jpoint(g,h,u)},g.prototype.dblp=function(e){if(0===e)return this;if(this.isInfinity())return this;if(!e)return this.dbl();if(this.curve.zeroA||this.curve.threeA){for(var t=this,i=0;i<e;i++)t=t.dbl();return t}var n=this.curve.a,a=this.curve.tinv,s=this.x,r=this.y,o=this.z,c=o.redSqr().redSqr(),d=r.redAdd(r);for(i=0;i<e;i++){var l=s.redSqr(),g=d.redSqr(),h=g.redSqr(),u=l.redAdd(l).redIAdd(l).redIAdd(n.redMul(c)),p=s.redMul(g),f=u.redSqr().redISub(p.redAdd(p)),m=p.redISub(f),_=u.redMul(m);_=_.redIAdd(_).redISub(h);var b=d.redMul(o);i+1<e&&(c=c.redMul(h)),s=f,o=b,d=_}return this.curve.jpoint(s,d.redMul(a),o)},g.prototype.dbl=function(){return this.isInfinity()?this:this.curve.zeroA?this._zeroDbl():this.curve.threeA?this._threeDbl():this._dbl()},g.prototype._zeroDbl=function(){var e,t,i;if(this.zOne){var n=this.x.redSqr(),a=this.y.redSqr(),s=a.redSqr(),r=this.x.redAdd(a).redSqr().redISub(n).redISub(s);r=r.redIAdd(r);var o=n.redAdd(n).redIAdd(n),c=o.redSqr().redISub(r).redISub(r),d=s.redIAdd(s);d=(d=d.redIAdd(d)).redIAdd(d),e=c,t=o.redMul(r.redISub(c)).redISub(d),i=this.y.redAdd(this.y)}else{var l=this.x.redSqr(),g=this.y.redSqr(),h=g.redSqr(),u=this.x.redAdd(g).redSqr().redISub(l).redISub(h);u=u.redIAdd(u);var p=l.redAdd(l).redIAdd(l),f=p.redSqr(),m=h.redIAdd(h);m=(m=m.redIAdd(m)).redIAdd(m),e=f.redISub(u).redISub(u),t=p.redMul(u.redISub(e)).redISub(m),i=(i=this.y.redMul(this.z)).redIAdd(i)}return this.curve.jpoint(e,t,i)},g.prototype._threeDbl=function(){var e,t,i;if(this.zOne){var n=this.x.redSqr(),a=this.y.redSqr(),s=a.redSqr(),r=this.x.redAdd(a).redSqr().redISub(n).redISub(s);r=r.redIAdd(r);var o=n.redAdd(n).redIAdd(n).redIAdd(this.curve.a),c=o.redSqr().redISub(r).redISub(r);e=c;var d=s.redIAdd(s);d=(d=d.redIAdd(d)).redIAdd(d),t=o.redMul(r.redISub(c)).redISub(d),i=this.y.redAdd(this.y)}else{var l=this.z.redSqr(),g=this.y.redSqr(),h=this.x.redMul(g),u=this.x.redSub(l).redMul(this.x.redAdd(l));u=u.redAdd(u).redIAdd(u);var p=h.redIAdd(h),f=(p=p.redIAdd(p)).redAdd(p);e=u.redSqr().redISub(f),i=this.y.redAdd(this.z).redSqr().redISub(g).redISub(l);var m=g.redSqr();m=(m=(m=m.redIAdd(m)).redIAdd(m)).redIAdd(m),t=u.redMul(p.redISub(e)).redISub(m)}return this.curve.jpoint(e,t,i)},g.prototype._dbl=function(){var e=this.curve.a,t=this.x,i=this.y,n=this.z,a=n.redSqr().redSqr(),s=t.redSqr(),r=i.redSqr(),o=s.redAdd(s).redIAdd(s).redIAdd(e.redMul(a)),c=t.redAdd(t),d=(c=c.redIAdd(c)).redMul(r),l=o.redSqr().redISub(d.redAdd(d)),g=d.redISub(l),h=r.redSqr();h=(h=(h=h.redIAdd(h)).redIAdd(h)).redIAdd(h);var u=o.redMul(g).redISub(h),p=i.redAdd(i).redMul(n);return this.curve.jpoint(l,u,p)},g.prototype.trpl=function(){if(!this.curve.zeroA)return this.dbl().add(this);var e=this.x.redSqr(),t=this.y.redSqr(),i=this.z.redSqr(),n=t.redSqr(),a=e.redAdd(e).redIAdd(e),s=a.redSqr(),r=this.x.redAdd(t).redSqr().redISub(e).redISub(n),o=(r=(r=(r=r.redIAdd(r)).redAdd(r).redIAdd(r)).redISub(s)).redSqr(),c=n.redIAdd(n);c=(c=(c=c.redIAdd(c)).redIAdd(c)).redIAdd(c);var d=a.redIAdd(r).redSqr().redISub(s).redISub(o).redISub(c),l=t.redMul(d);l=(l=l.redIAdd(l)).redIAdd(l);var g=this.x.redMul(o).redISub(l);g=(g=g.redIAdd(g)).redIAdd(g);var h=this.y.redMul(d.redMul(c.redISub(d)).redISub(r.redMul(o)));h=(h=(h=h.redIAdd(h)).redIAdd(h)).redIAdd(h);var u=this.z.redAdd(r).redSqr().redISub(i).redISub(o);return this.curve.jpoint(g,h,u)},g.prototype.mul=function(e,t){return e=new s(e,t),this.curve._wnafMul(this,e)},g.prototype.eq=function(e){if("affine"===e.type)return this.eq(e.toJ());if(this===e)return!0;var t=this.z.redSqr(),i=e.z.redSqr();if(0!==this.x.redMul(i).redISub(e.x.redMul(t)).cmpn(0))return!1;var n=t.redMul(this.z),a=i.redMul(e.z);return 0===this.y.redMul(a).redISub(e.y.redMul(n)).cmpn(0)},g.prototype.eqXToP=function(e){var t=this.z.redSqr(),i=e.toRed(this.curve.red).redMul(t);if(0===this.x.cmp(i))return!0;for(var n=e.clone(),a=this.curve.redN.redMul(t);;){if(n.iadd(this.curve.n),0<=n.cmp(this.curve.p))return!1;if(i.redIAdd(a),0===this.x.cmp(i))return!0}},g.prototype.inspect=function(){return this.isInfinity()?"<EC JPoint Infinity>":"<EC JPoint x: "+this.x.toString(16,2)+" y: "+this.y.toString(16,2)+" z: "+this.z.toString(16,2)+">"},g.prototype.isInfinity=function(){return 0===this.z.cmpn(0)}},function(e,t,i){"use strict";var n=i(47),a=i(4),s=i(1),r=n.base,o=i(5).utils;function c(e){r.call(this,"mont",e),this.a=new a(e.a,16).toRed(this.red),this.b=new a(e.b,16).toRed(this.red),this.i4=new a(4).toRed(this.red).redInvm(),this.two=new a(2).toRed(this.red),this.a24=this.i4.redMul(this.a.redAdd(this.two))}function d(e,t,i){r.BasePoint.call(this,e,"projective"),null===t&&null===i?(this.x=this.curve.one,this.z=this.curve.zero):(this.x=new a(t,16),this.z=new a(i,16),this.x.red||(this.x=this.x.toRed(this.curve.red)),this.z.red||(this.z=this.z.toRed(this.curve.red)))}s(c,r),(e.exports=c).prototype.validate=function(e){var t=e.normalize().x,i=t.redSqr(),n=i.redMul(t).redAdd(i.redMul(this.a)).redAdd(t);return 0===n.redSqrt().redSqr().cmp(n)},s(d,r.BasePoint),c.prototype.decodePoint=function(e,t){return this.point(o.toArray(e,t),1)},c.prototype.point=function(e,t){return new d(this,e,t)},c.prototype.pointFromJSON=function(e){return d.fromJSON(this,e)},d.prototype.precompute=function(){},d.prototype._encode=function(){return this.getX().toArray("be",this.curve.p.byteLength())},d.fromJSON=function(e,t){return new d(e,t[0],t[1]||e.one)},d.prototype.inspect=function(){return this.isInfinity()?"<EC Point Infinity>":"<EC Point x: "+this.x.fromRed().toString(16,2)+" z: "+this.z.fromRed().toString(16,2)+">"},d.prototype.isInfinity=function(){return 0===this.z.cmpn(0)},d.prototype.dbl=function(){var e=this.x.redAdd(this.z).redSqr(),t=this.x.redSub(this.z).redSqr(),i=e.redSub(t),n=e.redMul(t),a=i.redMul(t.redAdd(this.curve.a24.redMul(i)));return this.curve.point(n,a)},d.prototype.add=function(){throw new Error("Not supported on Montgomery curve")},d.prototype.diffAdd=function(e,t){var i=this.x.redAdd(this.z),n=this.x.redSub(this.z),a=e.x.redAdd(e.z),s=e.x.redSub(e.z).redMul(i),r=a.redMul(n),o=t.z.redMul(s.redAdd(r).redSqr()),c=t.x.redMul(s.redISub(r).redSqr());return this.curve.point(o,c)},d.prototype.mul=function(e){for(var t=e.clone(),i=this,n=this.curve.point(null,null),a=[];0!==t.cmpn(0);t.iushrn(1))a.push(t.andln(1));for(var s=a.length-1;0<=s;s--)0===a[s]?(i=i.diffAdd(n,this),n=n.dbl()):(n=i.diffAdd(n,this),i=i.dbl());return n},d.prototype.mulAdd=function(){throw new Error("Not supported on Montgomery curve")},d.prototype.jumlAdd=function(){throw new Error("Not supported on Montgomery curve")},d.prototype.eq=function(e){return 0===this.getX().cmp(e.getX())},d.prototype.normalize=function(){return this.x=this.x.redMul(this.z.redInvm()),this.z=this.curve.one,this},d.prototype.getX=function(){return this.normalize(),this.x.fromRed()}},function(e,t,i){"use strict";var n=i(47),a=i(5),s=i(4),r=i(1),o=n.base,c=a.utils.assert;function d(e){this.twisted=1!=(0|e.a),this.mOneA=this.twisted&&-1==(0|e.a),this.extended=this.mOneA,o.call(this,"edwards",e),this.a=new s(e.a,16).umod(this.red.m),this.a=this.a.toRed(this.red),this.c=new s(e.c,16).toRed(this.red),this.c2=this.c.redSqr(),this.d=new s(e.d,16).toRed(this.red),this.dd=this.d.redAdd(this.d),c(!this.twisted||0===this.c.fromRed().cmpn(1)),this.oneC=1==(0|e.c)}function l(e,t,i,n,a){o.BasePoint.call(this,e,"projective"),null===t&&null===i&&null===n?(this.x=this.curve.zero,this.y=this.curve.one,this.z=this.curve.one,this.t=this.curve.zero,this.zOne=!0):(this.x=new s(t,16),this.y=new s(i,16),this.z=n?new s(n,16):this.curve.one,this.t=a&&new s(a,16),this.x.red||(this.x=this.x.toRed(this.curve.red)),this.y.red||(this.y=this.y.toRed(this.curve.red)),this.z.red||(this.z=this.z.toRed(this.curve.red)),this.t&&!this.t.red&&(this.t=this.t.toRed(this.curve.red)),this.zOne=this.z===this.curve.one,this.curve.extended&&!this.t&&(this.t=this.x.redMul(this.y),this.zOne||(this.t=this.t.redMul(this.z.redInvm()))))}r(d,o),(e.exports=d).prototype._mulA=function(e){return this.mOneA?e.redNeg():this.a.redMul(e)},d.prototype._mulC=function(e){return this.oneC?e:this.c.redMul(e)},d.prototype.jpoint=function(e,t,i,n){return this.point(e,t,i,n)},d.prototype.pointFromX=function(e,t){(e=new s(e,16)).red||(e=e.toRed(this.red));var i=e.redSqr(),n=this.c2.redSub(this.a.redMul(i)),a=this.one.redSub(this.c2.redMul(this.d).redMul(i)),r=n.redMul(a.redInvm()),o=r.redSqrt();if(0!==o.redSqr().redSub(r).cmp(this.zero))throw new Error("invalid point");var c=o.fromRed().isOdd();return(t&&!c||!t&&c)&&(o=o.redNeg()),this.point(e,o)},d.prototype.pointFromY=function(e,t){(e=new s(e,16)).red||(e=e.toRed(this.red));var i=e.redSqr(),n=i.redSub(this.c2),a=i.redMul(this.d).redMul(this.c2).redSub(this.a),r=n.redMul(a.redInvm());if(0===r.cmp(this.zero)){if(t)throw new Error("invalid point");return this.point(this.zero,e)}var o=r.redSqrt();if(0!==o.redSqr().redSub(r).cmp(this.zero))throw new Error("invalid point");return o.fromRed().isOdd()!==t&&(o=o.redNeg()),this.point(o,e)},d.prototype.validate=function(e){if(e.isInfinity())return!0;e.normalize();var t=e.x.redSqr(),i=e.y.redSqr(),n=t.redMul(this.a).redAdd(i),a=this.c2.redMul(this.one.redAdd(this.d.redMul(t).redMul(i)));return 0===n.cmp(a)},r(l,o.BasePoint),d.prototype.pointFromJSON=function(e){return l.fromJSON(this,e)},d.prototype.point=function(e,t,i,n){return new l(this,e,t,i,n)},l.fromJSON=function(e,t){return new l(e,t[0],t[1],t[2])},l.prototype.inspect=function(){return this.isInfinity()?"<EC Point Infinity>":"<EC Point x: "+this.x.fromRed().toString(16,2)+" y: "+this.y.fromRed().toString(16,2)+" z: "+this.z.fromRed().toString(16,2)+">"},l.prototype.isInfinity=function(){return 0===this.x.cmpn(0)&&(0===this.y.cmp(this.z)||this.zOne&&0===this.y.cmp(this.curve.c))},l.prototype._extDbl=function(){var e=this.x.redSqr(),t=this.y.redSqr(),i=this.z.redSqr();i=i.redIAdd(i);var n=this.curve._mulA(e),a=this.x.redAdd(this.y).redSqr().redISub(e).redISub(t),s=n.redAdd(t),r=s.redSub(i),o=n.redSub(t),c=a.redMul(r),d=s.redMul(o),l=a.redMul(o),g=r.redMul(s);return this.curve.point(c,d,g,l)},l.prototype._projDbl=function(){var e,t,i,n=this.x.redAdd(this.y).redSqr(),a=this.x.redSqr(),s=this.y.redSqr();if(this.curve.twisted){var r=(d=this.curve._mulA(a)).redAdd(s);if(this.zOne)e=n.redSub(a).redSub(s).redMul(r.redSub(this.curve.two)),t=r.redMul(d.redSub(s)),i=r.redSqr().redSub(r).redSub(r);else{var o=this.z.redSqr(),c=r.redSub(o).redISub(o);e=n.redSub(a).redISub(s).redMul(c),t=r.redMul(d.redSub(s)),i=r.redMul(c)}}else{var d=a.redAdd(s);o=this.curve._mulC(this.z).redSqr(),c=d.redSub(o).redSub(o),e=this.curve._mulC(n.redISub(d)).redMul(c),t=this.curve._mulC(d).redMul(a.redISub(s)),i=d.redMul(c)}return this.curve.point(e,t,i)},l.prototype.dbl=function(){return this.isInfinity()?this:this.curve.extended?this._extDbl():this._projDbl()},l.prototype._extAdd=function(e){var t=this.y.redSub(this.x).redMul(e.y.redSub(e.x)),i=this.y.redAdd(this.x).redMul(e.y.redAdd(e.x)),n=this.t.redMul(this.curve.dd).redMul(e.t),a=this.z.redMul(e.z.redAdd(e.z)),s=i.redSub(t),r=a.redSub(n),o=a.redAdd(n),c=i.redAdd(t),d=s.redMul(r),l=o.redMul(c),g=s.redMul(c),h=r.redMul(o);return this.curve.point(d,l,h,g)},l.prototype._projAdd=function(e){var t,i,n=this.z.redMul(e.z),a=n.redSqr(),s=this.x.redMul(e.x),r=this.y.redMul(e.y),o=this.curve.d.redMul(s).redMul(r),c=a.redSub(o),d=a.redAdd(o),l=this.x.redAdd(this.y).redMul(e.x.redAdd(e.y)).redISub(s).redISub(r),g=n.redMul(c).redMul(l);return i=this.curve.twisted?(t=n.redMul(d).redMul(r.redSub(this.curve._mulA(s))),c.redMul(d)):(t=n.redMul(d).redMul(r.redSub(s)),this.curve._mulC(c).redMul(d)),this.curve.point(g,t,i)},l.prototype.add=function(e){return this.isInfinity()?e:e.isInfinity()?this:this.curve.extended?this._extAdd(e):this._projAdd(e)},l.prototype.mul=function(e){return this._hasDoubles(e)?this.curve._fixedNafMul(this,e):this.curve._wnafMul(this,e)},l.prototype.mulAdd=function(e,t,i){return this.curve._wnafMulAdd(1,[this,t],[e,i],2,!1)},l.prototype.jmulAdd=function(e,t,i){return this.curve._wnafMulAdd(1,[this,t],[e,i],2,!0)},l.prototype.normalize=function(){if(this.zOne)return this;var e=this.z.redInvm();return this.x=this.x.redMul(e),this.y=this.y.redMul(e),this.t&&(this.t=this.t.redMul(e)),this.z=this.curve.one,this.zOne=!0,this},l.prototype.neg=function(){return this.curve.point(this.x.redNeg(),this.y,this.z,this.t&&this.t.redNeg())},l.prototype.getX=function(){return this.normalize(),this.x.fromRed()},l.prototype.getY=function(){return this.normalize(),this.y.fromRed()},l.prototype.eq=function(e){return this===e||0===this.getX().cmp(e.getX())&&0===this.getY().cmp(e.getY())},l.prototype.eqXToP=function(e){var t=e.toRed(this.curve.red).redMul(this.z);if(0===this.x.cmp(t))return!0;for(var i=e.clone(),n=this.curve.redN.redMul(this.z);;){if(i.iadd(this.curve.n),0<=i.cmp(this.curve.p))return!1;if(t.redIAdd(n),0===this.x.cmp(t))return!0}},l.prototype.toP=l.prototype.normalize,l.prototype.mixedAdd=l.prototype.add},function(e,t,i){"use strict";var n,a=t,s=i(75),r=i(5),o=r.utils.assert;function c(e){"short"===e.type?this.curve=new r.curve.short(e):"edwards"===e.type?this.curve=new r.curve.edwards(e):this.curve=new r.curve.mont(e),this.g=this.curve.g,this.n=this.curve.n,this.hash=e.hash,o(this.g.validate(),"Invalid curve"),o(this.g.mul(this.n).isInfinity(),"Invalid curve, G*N != O")}function d(e,t){Object.defineProperty(a,e,{configurable:!0,enumerable:!0,get:function(){var i=new c(t);return Object.defineProperty(a,e,{configurable:!0,enumerable:!0,value:i}),i}})}a.PresetCurve=c,d("p192",{type:"short",prime:"p192",p:"ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff",a:"ffffffff ffffffff ffffffff fffffffe ffffffff fffffffc",b:"64210519 e59c80e7 0fa7e9ab 72243049 feb8deec c146b9b1",n:"ffffffff ffffffff ffffffff 99def836 146bc9b1 b4d22831",hash:s.sha256,gRed:!1,g:["188da80e b03090f6 7cbf20eb 43a18800 f4ff0afd 82ff1012","07192b95 ffc8da78 631011ed 6b24cdd5 73f977a1 1e794811"]}),d("p224",{type:"short",prime:"p224",p:"ffffffff ffffffff ffffffff ffffffff 00000000 00000000 00000001",a:"ffffffff ffffffff ffffffff fffffffe ffffffff ffffffff fffffffe",b:"b4050a85 0c04b3ab f5413256 5044b0b7 d7bfd8ba 270b3943 2355ffb4",n:"ffffffff ffffffff ffffffff ffff16a2 e0b8f03e 13dd2945 5c5c2a3d",hash:s.sha256,gRed:!1,g:["b70e0cbd 6bb4bf7f 321390b9 4a03c1d3 56c21122 343280d6 115c1d21","bd376388 b5f723fb 4c22dfe6 cd4375a0 5a074764 44d58199 85007e34"]}),d("p256",{type:"short",prime:null,p:"ffffffff 00000001 00000000 00000000 00000000 ffffffff ffffffff ffffffff",a:"ffffffff 00000001 00000000 00000000 00000000 ffffffff ffffffff fffffffc",b:"5ac635d8 aa3a93e7 b3ebbd55 769886bc 651d06b0 cc53b0f6 3bce3c3e 27d2604b",n:"ffffffff 00000000 ffffffff ffffffff bce6faad a7179e84 f3b9cac2 fc632551",hash:s.sha256,gRed:!1,g:["6b17d1f2 e12c4247 f8bce6e5 63a440f2 77037d81 2deb33a0 f4a13945 d898c296","4fe342e2 fe1a7f9b 8ee7eb4a 7c0f9e16 2bce3357 6b315ece cbb64068 37bf51f5"]}),d("p384",{type:"short",prime:null,p:"ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe ffffffff 00000000 00000000 ffffffff",a:"ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe ffffffff 00000000 00000000 fffffffc",b:"b3312fa7 e23ee7e4 988e056b e3f82d19 181d9c6e fe814112 0314088f 5013875a c656398d 8a2ed19d 2a85c8ed d3ec2aef",n:"ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff c7634d81 f4372ddf 581a0db2 48b0a77a ecec196a ccc52973",hash:s.sha384,gRed:!1,g:["aa87ca22 be8b0537 8eb1c71e f320ad74 6e1d3b62 8ba79b98 59f741e0 82542a38 5502f25d bf55296c 3a545e38 72760ab7","3617de4a 96262c6f 5d9e98bf 9292dc29 f8f41dbd 289a147c e9da3113 b5f0b8c0 0a60b1ce 1d7e819d 7a431d7c 90ea0e5f"]}),d("p521",{type:"short",prime:null,p:"000001ff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff",a:"000001ff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffc",b:"00000051 953eb961 8e1c9a1f 929a21a0 b68540ee a2da725b 99b315f3 b8b48991 8ef109e1 56193951 ec7e937b 1652c0bd 3bb1bf07 3573df88 3d2c34f1 ef451fd4 6b503f00",n:"000001ff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffa 51868783 bf2f966b 7fcc0148 f709a5d0 3bb5c9b8 899c47ae bb6fb71e 91386409",hash:s.sha512,gRed:!1,g:["000000c6 858e06b7 0404e9cd 9e3ecb66 2395b442 9c648139 053fb521 f828af60 6b4d3dba a14b5e77 efe75928 fe1dc127 a2ffa8de 3348b3c1 856a429b f97e7e31 c2e5bd66","00000118 39296a78 9a3bc004 5c8a5fb4 2c7d1bd9 98f54449 579b4468 17afbd17 273e662c 97ee7299 5ef42640 c550b901 3fad0761 353c7086 a272c240 88be9476 9fd16650"]}),d("curve25519",{type:"mont",prime:"p25519",p:"7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed",a:"76d06",b:"1",n:"1000000000000000 0000000000000000 14def9dea2f79cd6 5812631a5cf5d3ed",hash:s.sha256,gRed:!1,g:["9"]}),d("ed25519",{type:"edwards",prime:"p25519",p:"7fffffffffffffff ffffffffffffffff ffffffffffffffff ffffffffffffffed",a:"-1",c:"1",d:"52036cee2b6ffe73 8cc740797779e898 00700a4d4141d8ab 75eb4dca135978a3",n:"1000000000000000 0000000000000000 14def9dea2f79cd6 5812631a5cf5d3ed",hash:s.sha256,gRed:!1,g:["216936d3cd6e53fec0a4e231fdd6dc5c692cc7609525a7b2c9562d608f25d51a","6666666666666666666666666666666666666666666666666666666666666658"]});try{n=i(273)}catch(e){n=void 0}d("secp256k1",{type:"short",prime:"k256",p:"ffffffff ffffffff ffffffff ffffffff ffffffff ffffffff fffffffe fffffc2f",a:"0",b:"7",n:"ffffffff ffffffff ffffffff fffffffe baaedce6 af48a03b bfd25e8c d0364141",h:"1",hash:s.sha256,beta:"7ae96a2b657c07106e64479eac3434e99cf0497512f58995c1396c28719501ee",lambda:"5363ad4cc05c30e0a5261c028812645a122e22ea20816678df02967c1b23bd72",basis:[{a:"3086d221a7d46bcde86c90e49284eb15",b:"-e4437ed6010e88286f547fa90abfe4c3"},{a:"114ca50f7a8e2f3f657c1108d9d44cfd8",b:"3086d221a7d46bcde86c90e49284eb15"}],gRed:!1,g:["79be667ef9dcbbac55a06295ce870b07029bfcdb2dce28d959f2815b16f81798","483ada7726a3c4655da4fbfc0e1108a8fd17b448a68554199c47d08ffb10d4b8",n]})},function(e,t,i){"use strict";t.sha1=i(268),t.sha224=i(269),t.sha256=i(128),t.sha384=i(270),t.sha512=i(129)},function(e,t,i){"use strict";var n=i(11),a=i(32),s=i(127),r=n.rotl32,o=n.sum32,c=n.sum32_5,d=s.ft_1,l=a.BlockHash,g=[1518500249,1859775393,2400959708,3395469782];function h(){if(!(this instanceof h))return new h;l.call(this),this.h=[1732584193,4023233417,2562383102,271733878,3285377520],this.W=new Array(80)}n.inherits(h,l),(e.exports=h).blockSize=512,h.outSize=160,h.hmacStrength=80,h.padLength=64,h.prototype._update=function(e,t){for(var i=this.W,n=0;n<16;n++)i[n]=e[t+n];for(;n<i.length;n++)i[n]=r(i[n-3]^i[n-8]^i[n-14]^i[n-16],1);var a=this.h[0],s=this.h[1],l=this.h[2],h=this.h[3],u=this.h[4];for(n=0;n<i.length;n++){var p=~~(n/20),f=c(r(a,5),d(p,s,l,h),u,i[n],g[p]);u=h,h=l,l=r(s,30),s=a,a=f}this.h[0]=o(this.h[0],a),this.h[1]=o(this.h[1],s),this.h[2]=o(this.h[2],l),this.h[3]=o(this.h[3],h),this.h[4]=o(this.h[4],u)},h.prototype._digest=function(e){return"hex"===e?n.toHex32(this.h,"big"):n.split32(this.h,"big")}},function(e,t,i){"use strict";var n=i(11),a=i(128);function s(){if(!(this instanceof s))return new s;a.call(this),this.h=[3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428]}n.inherits(s,a),(e.exports=s).blockSize=512,s.outSize=224,s.hmacStrength=192,s.padLength=64,s.prototype._digest=function(e){return"hex"===e?n.toHex32(this.h.slice(0,7),"big"):n.split32(this.h.slice(0,7),"big")}},function(e,t,i){"use strict";var n=i(11),a=i(129);function s(){if(!(this instanceof s))return new s;a.call(this),this.h=[3418070365,3238371032,1654270250,914150663,2438529370,812702999,355462360,4144912697,1731405415,4290775857,2394180231,1750603025,3675008525,1694076839,1203062813,3204075428]}n.inherits(s,a),(e.exports=s).blockSize=1024,s.outSize=384,s.hmacStrength=192,s.padLength=128,s.prototype._digest=function(e){return"hex"===e?n.toHex32(this.h.slice(0,12),"big"):n.split32(this.h.slice(0,12),"big")}},function(e,t,i){"use strict";var n=i(11),a=i(32),s=n.rotl32,r=n.sum32,o=n.sum32_3,c=n.sum32_4,d=a.BlockHash;function l(){if(!(this instanceof l))return new l;d.call(this),this.h=[1732584193,4023233417,2562383102,271733878,3285377520],this.endian="little"}function g(e,t,i,n){return e<=15?t^i^n:e<=31?t&i|~t&n:e<=47?(t|~i)^n:e<=63?t&n|i&~n:t^(i|~n)}function h(e){return e<=15?0:e<=31?1518500249:e<=47?1859775393:e<=63?2400959708:2840853838}function u(e){return e<=15?1352829926:e<=31?1548603684:e<=47?1836072691:e<=63?2053994217:0}n.inherits(l,d),(t.ripemd160=l).blockSize=512,l.outSize=160,l.hmacStrength=192,l.padLength=64,l.prototype._update=function(e,t){for(var i=this.h[0],n=this.h[1],a=this.h[2],d=this.h[3],l=this.h[4],b=i,y=n,v=a,S=d,C=l,w=0;w<80;w++){var O=r(s(c(i,g(w,n,a,d),e[p[w]+t],h(w)),m[w]),l);i=l,l=d,d=s(a,10),a=n,n=O,O=r(s(c(b,g(79-w,y,v,S),e[f[w]+t],u(w)),_[w]),C),b=C,C=S,S=s(v,10),v=y,y=O}O=o(this.h[1],a,S),this.h[1]=o(this.h[2],d,C),this.h[2]=o(this.h[3],l,b),this.h[3]=o(this.h[4],i,y),this.h[4]=o(this.h[0],n,v),this.h[0]=O},l.prototype._digest=function(e){return"hex"===e?n.toHex32(this.h,"little"):n.split32(this.h,"little")};var p=[0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8,3,10,14,4,9,15,8,1,2,7,0,6,13,11,5,12,1,9,11,10,0,8,12,4,13,3,7,15,14,5,6,2,4,0,5,9,7,12,2,10,14,1,3,8,11,6,15,13],f=[5,14,7,0,9,2,11,4,13,6,15,8,1,10,3,12,6,11,3,7,0,13,5,10,14,15,8,12,4,9,1,2,15,5,1,3,7,14,6,9,11,8,12,2,10,0,4,13,8,6,4,1,3,11,15,0,5,12,2,13,9,7,10,14,12,15,10,4,1,5,8,7,6,2,13,14,0,3,9,11],m=[11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8,7,6,8,13,11,9,7,15,7,12,15,9,11,7,13,12,11,13,6,7,14,9,13,15,14,8,13,6,5,12,7,5,11,12,14,15,14,15,9,8,9,14,5,6,8,6,5,12,9,15,5,11,6,8,13,12,5,12,13,14,11,8,5,6],_=[8,9,9,11,13,15,15,5,7,7,8,11,14,14,12,6,9,13,15,7,12,8,9,11,7,7,12,7,6,15,13,11,9,7,15,11,8,6,6,14,12,13,5,14,13,13,7,5,15,5,8,11,14,14,6,14,6,9,12,9,12,5,15,8,8,5,12,9,12,5,14,6,8,13,6,5,15,13,11,11]},function(e,t,i){"use strict";var n=i(11),a=i(8);function s(e,t,i){if(!(this instanceof s))return new s(e,t,i);this.Hash=e,this.blockSize=e.blockSize/8,this.outSize=e.outSize/8,this.inner=null,this.outer=null,this._init(n.toArray(t,i))}(e.exports=s).prototype._init=function(e){e.length>this.blockSize&&(e=(new this.Hash).update(e).digest()),a(e.length<=this.blockSize);for(var t=e.length;t<this.blockSize;t++)e.push(0);for(t=0;t<e.length;t++)e[t]^=54;for(this.inner=(new this.Hash).update(e),t=0;t<e.length;t++)e[t]^=106;this.outer=(new this.Hash).update(e)},s.prototype.update=function(e,t){return this.inner.update(e,t),this},s.prototype.digest=function(e){return this.outer.update(this.inner.digest()),this.outer.digest(e)}},function(e,t){e.exports={doubles:{step:4,points:[["e60fce93b59e9ec53011aabc21c23e97b2a31369b87a5ae9c44ee89e2a6dec0a","f7e3507399e595929db99f34f57937101296891e44d23f0be1f32cce69616821"],["8282263212c609d9ea2a6e3e172de238d8c39cabd5ac1ca10646e23fd5f51508","11f8a8098557dfe45e8256e830b60ace62d613ac2f7b17bed31b6eaff6e26caf"],["175e159f728b865a72f99cc6c6fc846de0b93833fd2222ed73fce5b551e5b739","d3506e0d9e3c79eba4ef97a51ff71f5eacb5955add24345c6efa6ffee9fed695"],["363d90d447b00c9c99ceac05b6262ee053441c7e55552ffe526bad8f83ff4640","4e273adfc732221953b445397f3363145b9a89008199ecb62003c7f3bee9de9"],["8b4b5f165df3c2be8c6244b5b745638843e4a781a15bcd1b69f79a55dffdf80c","4aad0a6f68d308b4b3fbd7813ab0da04f9e336546162ee56b3eff0c65fd4fd36"],["723cbaa6e5db996d6bf771c00bd548c7b700dbffa6c0e77bcb6115925232fcda","96e867b5595cc498a921137488824d6e2660a0653779494801dc069d9eb39f5f"],["eebfa4d493bebf98ba5feec812c2d3b50947961237a919839a533eca0e7dd7fa","5d9a8ca3970ef0f269ee7edaf178089d9ae4cdc3a711f712ddfd4fdae1de8999"],["100f44da696e71672791d0a09b7bde459f1215a29b3c03bfefd7835b39a48db0","cdd9e13192a00b772ec8f3300c090666b7ff4a18ff5195ac0fbd5cd62bc65a09"],["e1031be262c7ed1b1dc9227a4a04c017a77f8d4464f3b3852c8acde6e534fd2d","9d7061928940405e6bb6a4176597535af292dd419e1ced79a44f18f29456a00d"],["feea6cae46d55b530ac2839f143bd7ec5cf8b266a41d6af52d5e688d9094696d","e57c6b6c97dce1bab06e4e12bf3ecd5c981c8957cc41442d3155debf18090088"],["da67a91d91049cdcb367be4be6ffca3cfeed657d808583de33fa978bc1ec6cb1","9bacaa35481642bc41f463f7ec9780e5dec7adc508f740a17e9ea8e27a68be1d"],["53904faa0b334cdda6e000935ef22151ec08d0f7bb11069f57545ccc1a37b7c0","5bc087d0bc80106d88c9eccac20d3c1c13999981e14434699dcb096b022771c8"],["8e7bcd0bd35983a7719cca7764ca906779b53a043a9b8bcaeff959f43ad86047","10b7770b2a3da4b3940310420ca9514579e88e2e47fd68b3ea10047e8460372a"],["385eed34c1cdff21e6d0818689b81bde71a7f4f18397e6690a841e1599c43862","283bebc3e8ea23f56701de19e9ebf4576b304eec2086dc8cc0458fe5542e5453"],["6f9d9b803ecf191637c73a4413dfa180fddf84a5947fbc9c606ed86c3fac3a7","7c80c68e603059ba69b8e2a30e45c4d47ea4dd2f5c281002d86890603a842160"],["3322d401243c4e2582a2147c104d6ecbf774d163db0f5e5313b7e0e742d0e6bd","56e70797e9664ef5bfb019bc4ddaf9b72805f63ea2873af624f3a2e96c28b2a0"],["85672c7d2de0b7da2bd1770d89665868741b3f9af7643397721d74d28134ab83","7c481b9b5b43b2eb6374049bfa62c2e5e77f17fcc5298f44c8e3094f790313a6"],["948bf809b1988a46b06c9f1919413b10f9226c60f668832ffd959af60c82a0a","53a562856dcb6646dc6b74c5d1c3418c6d4dff08c97cd2bed4cb7f88d8c8e589"],["6260ce7f461801c34f067ce0f02873a8f1b0e44dfc69752accecd819f38fd8e8","bc2da82b6fa5b571a7f09049776a1ef7ecd292238051c198c1a84e95b2b4ae17"],["e5037de0afc1d8d43d8348414bbf4103043ec8f575bfdc432953cc8d2037fa2d","4571534baa94d3b5f9f98d09fb990bddbd5f5b03ec481f10e0e5dc841d755bda"],["e06372b0f4a207adf5ea905e8f1771b4e7e8dbd1c6a6c5b725866a0ae4fce725","7a908974bce18cfe12a27bb2ad5a488cd7484a7787104870b27034f94eee31dd"],["213c7a715cd5d45358d0bbf9dc0ce02204b10bdde2a3f58540ad6908d0559754","4b6dad0b5ae462507013ad06245ba190bb4850f5f36a7eeddff2c27534b458f2"],["4e7c272a7af4b34e8dbb9352a5419a87e2838c70adc62cddf0cc3a3b08fbd53c","17749c766c9d0b18e16fd09f6def681b530b9614bff7dd33e0b3941817dcaae6"],["fea74e3dbe778b1b10f238ad61686aa5c76e3db2be43057632427e2840fb27b6","6e0568db9b0b13297cf674deccb6af93126b596b973f7b77701d3db7f23cb96f"],["76e64113f677cf0e10a2570d599968d31544e179b760432952c02a4417bdde39","c90ddf8dee4e95cf577066d70681f0d35e2a33d2b56d2032b4b1752d1901ac01"],["c738c56b03b2abe1e8281baa743f8f9a8f7cc643df26cbee3ab150242bcbb891","893fb578951ad2537f718f2eacbfbbbb82314eef7880cfe917e735d9699a84c3"],["d895626548b65b81e264c7637c972877d1d72e5f3a925014372e9f6588f6c14b","febfaa38f2bc7eae728ec60818c340eb03428d632bb067e179363ed75d7d991f"],["b8da94032a957518eb0f6433571e8761ceffc73693e84edd49150a564f676e03","2804dfa44805a1e4d7c99cc9762808b092cc584d95ff3b511488e4e74efdf6e7"],["e80fea14441fb33a7d8adab9475d7fab2019effb5156a792f1a11778e3c0df5d","eed1de7f638e00771e89768ca3ca94472d155e80af322ea9fcb4291b6ac9ec78"],["a301697bdfcd704313ba48e51d567543f2a182031efd6915ddc07bbcc4e16070","7370f91cfb67e4f5081809fa25d40f9b1735dbf7c0a11a130c0d1a041e177ea1"],["90ad85b389d6b936463f9d0512678de208cc330b11307fffab7ac63e3fb04ed4","e507a3620a38261affdcbd9427222b839aefabe1582894d991d4d48cb6ef150"],["8f68b9d2f63b5f339239c1ad981f162ee88c5678723ea3351b7b444c9ec4c0da","662a9f2dba063986de1d90c2b6be215dbbea2cfe95510bfdf23cbf79501fff82"],["e4f3fb0176af85d65ff99ff9198c36091f48e86503681e3e6686fd5053231e11","1e63633ad0ef4f1c1661a6d0ea02b7286cc7e74ec951d1c9822c38576feb73bc"],["8c00fa9b18ebf331eb961537a45a4266c7034f2f0d4e1d0716fb6eae20eae29e","efa47267fea521a1a9dc343a3736c974c2fadafa81e36c54e7d2a4c66702414b"],["e7a26ce69dd4829f3e10cec0a9e98ed3143d084f308b92c0997fddfc60cb3e41","2a758e300fa7984b471b006a1aafbb18d0a6b2c0420e83e20e8a9421cf2cfd51"],["b6459e0ee3662ec8d23540c223bcbdc571cbcb967d79424f3cf29eb3de6b80ef","67c876d06f3e06de1dadf16e5661db3c4b3ae6d48e35b2ff30bf0b61a71ba45"],["d68a80c8280bb840793234aa118f06231d6f1fc67e73c5a5deda0f5b496943e8","db8ba9fff4b586d00c4b1f9177b0e28b5b0e7b8f7845295a294c84266b133120"],["324aed7df65c804252dc0270907a30b09612aeb973449cea4095980fc28d3d5d","648a365774b61f2ff130c0c35aec1f4f19213b0c7e332843967224af96ab7c84"],["4df9c14919cde61f6d51dfdbe5fee5dceec4143ba8d1ca888e8bd373fd054c96","35ec51092d8728050974c23a1d85d4b5d506cdc288490192ebac06cad10d5d"],["9c3919a84a474870faed8a9c1cc66021523489054d7f0308cbfc99c8ac1f98cd","ddb84f0f4a4ddd57584f044bf260e641905326f76c64c8e6be7e5e03d4fc599d"],["6057170b1dd12fdf8de05f281d8e06bb91e1493a8b91d4cc5a21382120a959e5","9a1af0b26a6a4807add9a2daf71df262465152bc3ee24c65e899be932385a2a8"],["a576df8e23a08411421439a4518da31880cef0fba7d4df12b1a6973eecb94266","40a6bf20e76640b2c92b97afe58cd82c432e10a7f514d9f3ee8be11ae1b28ec8"],["7778a78c28dec3e30a05fe9629de8c38bb30d1f5cf9a3a208f763889be58ad71","34626d9ab5a5b22ff7098e12f2ff580087b38411ff24ac563b513fc1fd9f43ac"],["928955ee637a84463729fd30e7afd2ed5f96274e5ad7e5cb09eda9c06d903ac","c25621003d3f42a827b78a13093a95eeac3d26efa8a8d83fc5180e935bcd091f"],["85d0fef3ec6db109399064f3a0e3b2855645b4a907ad354527aae75163d82751","1f03648413a38c0be29d496e582cf5663e8751e96877331582c237a24eb1f962"],["ff2b0dce97eece97c1c9b6041798b85dfdfb6d8882da20308f5404824526087e","493d13fef524ba188af4c4dc54d07936c7b7ed6fb90e2ceb2c951e01f0c29907"],["827fbbe4b1e880ea9ed2b2e6301b212b57f1ee148cd6dd28780e5e2cf856e241","c60f9c923c727b0b71bef2c67d1d12687ff7a63186903166d605b68baec293ec"],["eaa649f21f51bdbae7be4ae34ce6e5217a58fdce7f47f9aa7f3b58fa2120e2b3","be3279ed5bbbb03ac69a80f89879aa5a01a6b965f13f7e59d47a5305ba5ad93d"],["e4a42d43c5cf169d9391df6decf42ee541b6d8f0c9a137401e23632dda34d24f","4d9f92e716d1c73526fc99ccfb8ad34ce886eedfa8d8e4f13a7f7131deba9414"],["1ec80fef360cbdd954160fadab352b6b92b53576a88fea4947173b9d4300bf19","aeefe93756b5340d2f3a4958a7abbf5e0146e77f6295a07b671cdc1cc107cefd"],["146a778c04670c2f91b00af4680dfa8bce3490717d58ba889ddb5928366642be","b318e0ec3354028add669827f9d4b2870aaa971d2f7e5ed1d0b297483d83efd0"],["fa50c0f61d22e5f07e3acebb1aa07b128d0012209a28b9776d76a8793180eef9","6b84c6922397eba9b72cd2872281a68a5e683293a57a213b38cd8d7d3f4f2811"],["da1d61d0ca721a11b1a5bf6b7d88e8421a288ab5d5bba5220e53d32b5f067ec2","8157f55a7c99306c79c0766161c91e2966a73899d279b48a655fba0f1ad836f1"],["a8e282ff0c9706907215ff98e8fd416615311de0446f1e062a73b0610d064e13","7f97355b8db81c09abfb7f3c5b2515888b679a3e50dd6bd6cef7c73111f4cc0c"],["174a53b9c9a285872d39e56e6913cab15d59b1fa512508c022f382de8319497c","ccc9dc37abfc9c1657b4155f2c47f9e6646b3a1d8cb9854383da13ac079afa73"],["959396981943785c3d3e57edf5018cdbe039e730e4918b3d884fdff09475b7ba","2e7e552888c331dd8ba0386a4b9cd6849c653f64c8709385e9b8abf87524f2fd"],["d2a63a50ae401e56d645a1153b109a8fcca0a43d561fba2dbb51340c9d82b151","e82d86fb6443fcb7565aee58b2948220a70f750af484ca52d4142174dcf89405"],["64587e2335471eb890ee7896d7cfdc866bacbdbd3839317b3436f9b45617e073","d99fcdd5bf6902e2ae96dd6447c299a185b90a39133aeab358299e5e9faf6589"],["8481bde0e4e4d885b3a546d3e549de042f0aa6cea250e7fd358d6c86dd45e458","38ee7b8cba5404dd84a25bf39cecb2ca900a79c42b262e556d64b1b59779057e"],["13464a57a78102aa62b6979ae817f4637ffcfed3c4b1ce30bcd6303f6caf666b","69be159004614580ef7e433453ccb0ca48f300a81d0942e13f495a907f6ecc27"],["bc4a9df5b713fe2e9aef430bcc1dc97a0cd9ccede2f28588cada3a0d2d83f366","d3a81ca6e785c06383937adf4b798caa6e8a9fbfa547b16d758d666581f33c1"],["8c28a97bf8298bc0d23d8c749452a32e694b65e30a9472a3954ab30fe5324caa","40a30463a3305193378fedf31f7cc0eb7ae784f0451cb9459e71dc73cbef9482"],["8ea9666139527a8c1dd94ce4f071fd23c8b350c5a4bb33748c4ba111faccae0","620efabbc8ee2782e24e7c0cfb95c5d735b783be9cf0f8e955af34a30e62b945"],["dd3625faef5ba06074669716bbd3788d89bdde815959968092f76cc4eb9a9787","7a188fa3520e30d461da2501045731ca941461982883395937f68d00c644a573"],["f710d79d9eb962297e4f6232b40e8f7feb2bc63814614d692c12de752408221e","ea98e67232d3b3295d3b535532115ccac8612c721851617526ae47a9c77bfc82"]]},naf:{wnd:7,points:[["f9308a019258c31049344f85f89d5229b531c845836f99b08601f113bce036f9","388f7b0f632de8140fe337e62a37f3566500a99934c2231b6cb9fd7584b8e672"],["2f8bde4d1a07209355b4a7250a5c5128e88b84bddc619ab7cba8d569b240efe4","d8ac222636e5e3d6d4dba9dda6c9c426f788271bab0d6840dca87d3aa6ac62d6"],["5cbdf0646e5db4eaa398f365f2ea7a0e3d419b7e0330e39ce92bddedcac4f9bc","6aebca40ba255960a3178d6d861a54dba813d0b813fde7b5a5082628087264da"],["acd484e2f0c7f65309ad178a9f559abde09796974c57e714c35f110dfc27ccbe","cc338921b0a7d9fd64380971763b61e9add888a4375f8e0f05cc262ac64f9c37"],["774ae7f858a9411e5ef4246b70c65aac5649980be5c17891bbec17895da008cb","d984a032eb6b5e190243dd56d7b7b365372db1e2dff9d6a8301d74c9c953c61b"],["f28773c2d975288bc7d1d205c3748651b075fbc6610e58cddeeddf8f19405aa8","ab0902e8d880a89758212eb65cdaf473a1a06da521fa91f29b5cb52db03ed81"],["d7924d4f7d43ea965a465ae3095ff41131e5946f3c85f79e44adbcf8e27e080e","581e2872a86c72a683842ec228cc6defea40af2bd896d3a5c504dc9ff6a26b58"],["defdea4cdb677750a420fee807eacf21eb9898ae79b9768766e4faa04a2d4a34","4211ab0694635168e997b0ead2a93daeced1f4a04a95c0f6cfb199f69e56eb77"],["2b4ea0a797a443d293ef5cff444f4979f06acfebd7e86d277475656138385b6c","85e89bc037945d93b343083b5a1c86131a01f60c50269763b570c854e5c09b7a"],["352bbf4a4cdd12564f93fa332ce333301d9ad40271f8107181340aef25be59d5","321eb4075348f534d59c18259dda3e1f4a1b3b2e71b1039c67bd3d8bcf81998c"],["2fa2104d6b38d11b0230010559879124e42ab8dfeff5ff29dc9cdadd4ecacc3f","2de1068295dd865b64569335bd5dd80181d70ecfc882648423ba76b532b7d67"],["9248279b09b4d68dab21a9b066edda83263c3d84e09572e269ca0cd7f5453714","73016f7bf234aade5d1aa71bdea2b1ff3fc0de2a887912ffe54a32ce97cb3402"],["daed4f2be3a8bf278e70132fb0beb7522f570e144bf615c07e996d443dee8729","a69dce4a7d6c98e8d4a1aca87ef8d7003f83c230f3afa726ab40e52290be1c55"],["c44d12c7065d812e8acf28d7cbb19f9011ecd9e9fdf281b0e6a3b5e87d22e7db","2119a460ce326cdc76c45926c982fdac0e106e861edf61c5a039063f0e0e6482"],["6a245bf6dc698504c89a20cfded60853152b695336c28063b61c65cbd269e6b4","e022cf42c2bd4a708b3f5126f16a24ad8b33ba48d0423b6efd5e6348100d8a82"],["1697ffa6fd9de627c077e3d2fe541084ce13300b0bec1146f95ae57f0d0bd6a5","b9c398f186806f5d27561506e4557433a2cf15009e498ae7adee9d63d01b2396"],["605bdb019981718b986d0f07e834cb0d9deb8360ffb7f61df982345ef27a7479","2972d2de4f8d20681a78d93ec96fe23c26bfae84fb14db43b01e1e9056b8c49"],["62d14dab4150bf497402fdc45a215e10dcb01c354959b10cfe31c7e9d87ff33d","80fc06bd8cc5b01098088a1950eed0db01aa132967ab472235f5642483b25eaf"],["80c60ad0040f27dade5b4b06c408e56b2c50e9f56b9b8b425e555c2f86308b6f","1c38303f1cc5c30f26e66bad7fe72f70a65eed4cbe7024eb1aa01f56430bd57a"],["7a9375ad6167ad54aa74c6348cc54d344cc5dc9487d847049d5eabb0fa03c8fb","d0e3fa9eca8726909559e0d79269046bdc59ea10c70ce2b02d499ec224dc7f7"],["d528ecd9b696b54c907a9ed045447a79bb408ec39b68df504bb51f459bc3ffc9","eecf41253136e5f99966f21881fd656ebc4345405c520dbc063465b521409933"],["49370a4b5f43412ea25f514e8ecdad05266115e4a7ecb1387231808f8b45963","758f3f41afd6ed428b3081b0512fd62a54c3f3afbb5b6764b653052a12949c9a"],["77f230936ee88cbbd73df930d64702ef881d811e0e1498e2f1c13eb1fc345d74","958ef42a7886b6400a08266e9ba1b37896c95330d97077cbbe8eb3c7671c60d6"],["f2dac991cc4ce4b9ea44887e5c7c0bce58c80074ab9d4dbaeb28531b7739f530","e0dedc9b3b2f8dad4da1f32dec2531df9eb5fbeb0598e4fd1a117dba703a3c37"],["463b3d9f662621fb1b4be8fbbe2520125a216cdfc9dae3debcba4850c690d45b","5ed430d78c296c3543114306dd8622d7c622e27c970a1de31cb377b01af7307e"],["f16f804244e46e2a09232d4aff3b59976b98fac14328a2d1a32496b49998f247","cedabd9b82203f7e13d206fcdf4e33d92a6c53c26e5cce26d6579962c4e31df6"],["caf754272dc84563b0352b7a14311af55d245315ace27c65369e15f7151d41d1","cb474660ef35f5f2a41b643fa5e460575f4fa9b7962232a5c32f908318a04476"],["2600ca4b282cb986f85d0f1709979d8b44a09c07cb86d7c124497bc86f082120","4119b88753c15bd6a693b03fcddbb45d5ac6be74ab5f0ef44b0be9475a7e4b40"],["7635ca72d7e8432c338ec53cd12220bc01c48685e24f7dc8c602a7746998e435","91b649609489d613d1d5e590f78e6d74ecfc061d57048bad9e76f302c5b9c61"],["754e3239f325570cdbbf4a87deee8a66b7f2b33479d468fbc1a50743bf56cc18","673fb86e5bda30fb3cd0ed304ea49a023ee33d0197a695d0c5d98093c536683"],["e3e6bd1071a1e96aff57859c82d570f0330800661d1c952f9fe2694691d9b9e8","59c9e0bba394e76f40c0aa58379a3cb6a5a2283993e90c4167002af4920e37f5"],["186b483d056a033826ae73d88f732985c4ccb1f32ba35f4b4cc47fdcf04aa6eb","3b952d32c67cf77e2e17446e204180ab21fb8090895138b4a4a797f86e80888b"],["df9d70a6b9876ce544c98561f4be4f725442e6d2b737d9c91a8321724ce0963f","55eb2dafd84d6ccd5f862b785dc39d4ab157222720ef9da217b8c45cf2ba2417"],["5edd5cc23c51e87a497ca815d5dce0f8ab52554f849ed8995de64c5f34ce7143","efae9c8dbc14130661e8cec030c89ad0c13c66c0d17a2905cdc706ab7399a868"],["290798c2b6476830da12fe02287e9e777aa3fba1c355b17a722d362f84614fba","e38da76dcd440621988d00bcf79af25d5b29c094db2a23146d003afd41943e7a"],["af3c423a95d9f5b3054754efa150ac39cd29552fe360257362dfdecef4053b45","f98a3fd831eb2b749a93b0e6f35cfb40c8cd5aa667a15581bc2feded498fd9c6"],["766dbb24d134e745cccaa28c99bf274906bb66b26dcf98df8d2fed50d884249a","744b1152eacbe5e38dcc887980da38b897584a65fa06cedd2c924f97cbac5996"],["59dbf46f8c94759ba21277c33784f41645f7b44f6c596a58ce92e666191abe3e","c534ad44175fbc300f4ea6ce648309a042ce739a7919798cd85e216c4a307f6e"],["f13ada95103c4537305e691e74e9a4a8dd647e711a95e73cb62dc6018cfd87b8","e13817b44ee14de663bf4bc808341f326949e21a6a75c2570778419bdaf5733d"],["7754b4fa0e8aced06d4167a2c59cca4cda1869c06ebadfb6488550015a88522c","30e93e864e669d82224b967c3020b8fa8d1e4e350b6cbcc537a48b57841163a2"],["948dcadf5990e048aa3874d46abef9d701858f95de8041d2a6828c99e2262519","e491a42537f6e597d5d28a3224b1bc25df9154efbd2ef1d2cbba2cae5347d57e"],["7962414450c76c1689c7b48f8202ec37fb224cf5ac0bfa1570328a8a3d7c77ab","100b610ec4ffb4760d5c1fc133ef6f6b12507a051f04ac5760afa5b29db83437"],["3514087834964b54b15b160644d915485a16977225b8847bb0dd085137ec47ca","ef0afbb2056205448e1652c48e8127fc6039e77c15c2378b7e7d15a0de293311"],["d3cc30ad6b483e4bc79ce2c9dd8bc54993e947eb8df787b442943d3f7b527eaf","8b378a22d827278d89c5e9be8f9508ae3c2ad46290358630afb34db04eede0a4"],["1624d84780732860ce1c78fcbfefe08b2b29823db913f6493975ba0ff4847610","68651cf9b6da903e0914448c6cd9d4ca896878f5282be4c8cc06e2a404078575"],["733ce80da955a8a26902c95633e62a985192474b5af207da6df7b4fd5fc61cd4","f5435a2bd2badf7d485a4d8b8db9fcce3e1ef8e0201e4578c54673bc1dc5ea1d"],["15d9441254945064cf1a1c33bbd3b49f8966c5092171e699ef258dfab81c045c","d56eb30b69463e7234f5137b73b84177434800bacebfc685fc37bbe9efe4070d"],["a1d0fcf2ec9de675b612136e5ce70d271c21417c9d2b8aaaac138599d0717940","edd77f50bcb5a3cab2e90737309667f2641462a54070f3d519212d39c197a629"],["e22fbe15c0af8ccc5780c0735f84dbe9a790badee8245c06c7ca37331cb36980","a855babad5cd60c88b430a69f53a1a7a38289154964799be43d06d77d31da06"],["311091dd9860e8e20ee13473c1155f5f69635e394704eaa74009452246cfa9b3","66db656f87d1f04fffd1f04788c06830871ec5a64feee685bd80f0b1286d8374"],["34c1fd04d301be89b31c0442d3e6ac24883928b45a9340781867d4232ec2dbdf","9414685e97b1b5954bd46f730174136d57f1ceeb487443dc5321857ba73abee"],["f219ea5d6b54701c1c14de5b557eb42a8d13f3abbcd08affcc2a5e6b049b8d63","4cb95957e83d40b0f73af4544cccf6b1f4b08d3c07b27fb8d8c2962a400766d1"],["d7b8740f74a8fbaab1f683db8f45de26543a5490bca627087236912469a0b448","fa77968128d9c92ee1010f337ad4717eff15db5ed3c049b3411e0315eaa4593b"],["32d31c222f8f6f0ef86f7c98d3a3335ead5bcd32abdd94289fe4d3091aa824bf","5f3032f5892156e39ccd3d7915b9e1da2e6dac9e6f26e961118d14b8462e1661"],["7461f371914ab32671045a155d9831ea8793d77cd59592c4340f86cbc18347b5","8ec0ba238b96bec0cbdddcae0aa442542eee1ff50c986ea6b39847b3cc092ff6"],["ee079adb1df1860074356a25aa38206a6d716b2c3e67453d287698bad7b2b2d6","8dc2412aafe3be5c4c5f37e0ecc5f9f6a446989af04c4e25ebaac479ec1c8c1e"],["16ec93e447ec83f0467b18302ee620f7e65de331874c9dc72bfd8616ba9da6b5","5e4631150e62fb40d0e8c2a7ca5804a39d58186a50e497139626778e25b0674d"],["eaa5f980c245f6f038978290afa70b6bd8855897f98b6aa485b96065d537bd99","f65f5d3e292c2e0819a528391c994624d784869d7e6ea67fb18041024edc07dc"],["78c9407544ac132692ee1910a02439958ae04877151342ea96c4b6b35a49f51","f3e0319169eb9b85d5404795539a5e68fa1fbd583c064d2462b675f194a3ddb4"],["494f4be219a1a77016dcd838431aea0001cdc8ae7a6fc688726578d9702857a5","42242a969283a5f339ba7f075e36ba2af925ce30d767ed6e55f4b031880d562c"],["a598a8030da6d86c6bc7f2f5144ea549d28211ea58faa70ebf4c1e665c1fe9b5","204b5d6f84822c307e4b4a7140737aec23fc63b65b35f86a10026dbd2d864e6b"],["c41916365abb2b5d09192f5f2dbeafec208f020f12570a184dbadc3e58595997","4f14351d0087efa49d245b328984989d5caf9450f34bfc0ed16e96b58fa9913"],["841d6063a586fa475a724604da03bc5b92a2e0d2e0a36acfe4c73a5514742881","73867f59c0659e81904f9a1c7543698e62562d6744c169ce7a36de01a8d6154"],["5e95bb399a6971d376026947f89bde2f282b33810928be4ded112ac4d70e20d5","39f23f366809085beebfc71181313775a99c9aed7d8ba38b161384c746012865"],["36e4641a53948fd476c39f8a99fd974e5ec07564b5315d8bf99471bca0ef2f66","d2424b1b1abe4eb8164227b085c9aa9456ea13493fd563e06fd51cf5694c78fc"],["336581ea7bfbbb290c191a2f507a41cf5643842170e914faeab27c2c579f726","ead12168595fe1be99252129b6e56b3391f7ab1410cd1e0ef3dcdcabd2fda224"],["8ab89816dadfd6b6a1f2634fcf00ec8403781025ed6890c4849742706bd43ede","6fdcef09f2f6d0a044e654aef624136f503d459c3e89845858a47a9129cdd24e"],["1e33f1a746c9c5778133344d9299fcaa20b0938e8acff2544bb40284b8c5fb94","60660257dd11b3aa9c8ed618d24edff2306d320f1d03010e33a7d2057f3b3b6"],["85b7c1dcb3cec1b7ee7f30ded79dd20a0ed1f4cc18cbcfcfa410361fd8f08f31","3d98a9cdd026dd43f39048f25a8847f4fcafad1895d7a633c6fed3c35e999511"],["29df9fbd8d9e46509275f4b125d6d45d7fbe9a3b878a7af872a2800661ac5f51","b4c4fe99c775a606e2d8862179139ffda61dc861c019e55cd2876eb2a27d84b"],["a0b1cae06b0a847a3fea6e671aaf8adfdfe58ca2f768105c8082b2e449fce252","ae434102edde0958ec4b19d917a6a28e6b72da1834aff0e650f049503a296cf2"],["4e8ceafb9b3e9a136dc7ff67e840295b499dfb3b2133e4ba113f2e4c0e121e5","cf2174118c8b6d7a4b48f6d534ce5c79422c086a63460502b827ce62a326683c"],["d24a44e047e19b6f5afb81c7ca2f69080a5076689a010919f42725c2b789a33b","6fb8d5591b466f8fc63db50f1c0f1c69013f996887b8244d2cdec417afea8fa3"],["ea01606a7a6c9cdd249fdfcfacb99584001edd28abbab77b5104e98e8e3b35d4","322af4908c7312b0cfbfe369f7a7b3cdb7d4494bc2823700cfd652188a3ea98d"],["af8addbf2b661c8a6c6328655eb96651252007d8c5ea31be4ad196de8ce2131f","6749e67c029b85f52a034eafd096836b2520818680e26ac8f3dfbcdb71749700"],["e3ae1974566ca06cc516d47e0fb165a674a3dabcfca15e722f0e3450f45889","2aeabe7e4531510116217f07bf4d07300de97e4874f81f533420a72eeb0bd6a4"],["591ee355313d99721cf6993ffed1e3e301993ff3ed258802075ea8ced397e246","b0ea558a113c30bea60fc4775460c7901ff0b053d25ca2bdeee98f1a4be5d196"],["11396d55fda54c49f19aa97318d8da61fa8584e47b084945077cf03255b52984","998c74a8cd45ac01289d5833a7beb4744ff536b01b257be4c5767bea93ea57a4"],["3c5d2a1ba39c5a1790000738c9e0c40b8dcdfd5468754b6405540157e017aa7a","b2284279995a34e2f9d4de7396fc18b80f9b8b9fdd270f6661f79ca4c81bd257"],["cc8704b8a60a0defa3a99a7299f2e9c3fbc395afb04ac078425ef8a1793cc030","bdd46039feed17881d1e0862db347f8cf395b74fc4bcdc4e940b74e3ac1f1b13"],["c533e4f7ea8555aacd9777ac5cad29b97dd4defccc53ee7ea204119b2889b197","6f0a256bc5efdf429a2fb6242f1a43a2d9b925bb4a4b3a26bb8e0f45eb596096"],["c14f8f2ccb27d6f109f6d08d03cc96a69ba8c34eec07bbcf566d48e33da6593","c359d6923bb398f7fd4473e16fe1c28475b740dd098075e6c0e8649113dc3a38"],["a6cbc3046bc6a450bac24789fa17115a4c9739ed75f8f21ce441f72e0b90e6ef","21ae7f4680e889bb130619e2c0f95a360ceb573c70603139862afd617fa9b9f"],["347d6d9a02c48927ebfb86c1359b1caf130a3c0267d11ce6344b39f99d43cc38","60ea7f61a353524d1c987f6ecec92f086d565ab687870cb12689ff1e31c74448"],["da6545d2181db8d983f7dcb375ef5866d47c67b1bf31c8cf855ef7437b72656a","49b96715ab6878a79e78f07ce5680c5d6673051b4935bd897fea824b77dc208a"],["c40747cc9d012cb1a13b8148309c6de7ec25d6945d657146b9d5994b8feb1111","5ca560753be2a12fc6de6caf2cb489565db936156b9514e1bb5e83037e0fa2d4"],["4e42c8ec82c99798ccf3a610be870e78338c7f713348bd34c8203ef4037f3502","7571d74ee5e0fb92a7a8b33a07783341a5492144cc54bcc40a94473693606437"],["3775ab7089bc6af823aba2e1af70b236d251cadb0c86743287522a1b3b0dedea","be52d107bcfa09d8bcb9736a828cfa7fac8db17bf7a76a2c42ad961409018cf7"],["cee31cbf7e34ec379d94fb814d3d775ad954595d1314ba8846959e3e82f74e26","8fd64a14c06b589c26b947ae2bcf6bfa0149ef0be14ed4d80f448a01c43b1c6d"],["b4f9eaea09b6917619f6ea6a4eb5464efddb58fd45b1ebefcdc1a01d08b47986","39e5c9925b5a54b07433a4f18c61726f8bb131c012ca542eb24a8ac07200682a"],["d4263dfc3d2df923a0179a48966d30ce84e2515afc3dccc1b77907792ebcc60e","62dfaf07a0f78feb30e30d6295853ce189e127760ad6cf7fae164e122a208d54"],["48457524820fa65a4f8d35eb6930857c0032acc0a4a2de422233eeda897612c4","25a748ab367979d98733c38a1fa1c2e7dc6cc07db2d60a9ae7a76aaa49bd0f77"],["dfeeef1881101f2cb11644f3a2afdfc2045e19919152923f367a1767c11cceda","ecfb7056cf1de042f9420bab396793c0c390bde74b4bbdff16a83ae09a9a7517"],["6d7ef6b17543f8373c573f44e1f389835d89bcbc6062ced36c82df83b8fae859","cd450ec335438986dfefa10c57fea9bcc521a0959b2d80bbf74b190dca712d10"],["e75605d59102a5a2684500d3b991f2e3f3c88b93225547035af25af66e04541f","f5c54754a8f71ee540b9b48728473e314f729ac5308b06938360990e2bfad125"],["eb98660f4c4dfaa06a2be453d5020bc99a0c2e60abe388457dd43fefb1ed620c","6cb9a8876d9cb8520609af3add26cd20a0a7cd8a9411131ce85f44100099223e"],["13e87b027d8514d35939f2e6892b19922154596941888336dc3563e3b8dba942","fef5a3c68059a6dec5d624114bf1e91aac2b9da568d6abeb2570d55646b8adf1"],["ee163026e9fd6fe017c38f06a5be6fc125424b371ce2708e7bf4491691e5764a","1acb250f255dd61c43d94ccc670d0f58f49ae3fa15b96623e5430da0ad6c62b2"],["b268f5ef9ad51e4d78de3a750c2dc89b1e626d43505867999932e5db33af3d80","5f310d4b3c99b9ebb19f77d41c1dee018cf0d34fd4191614003e945a1216e423"],["ff07f3118a9df035e9fad85eb6c7bfe42b02f01ca99ceea3bf7ffdba93c4750d","438136d603e858a3a5c440c38eccbaddc1d2942114e2eddd4740d098ced1f0d8"],["8d8b9855c7c052a34146fd20ffb658bea4b9f69e0d825ebec16e8c3ce2b526a1","cdb559eedc2d79f926baf44fb84ea4d44bcf50fee51d7ceb30e2e7f463036758"],["52db0b5384dfbf05bfa9d472d7ae26dfe4b851ceca91b1eba54263180da32b63","c3b997d050ee5d423ebaf66a6db9f57b3180c902875679de924b69d84a7b375"],["e62f9490d3d51da6395efd24e80919cc7d0f29c3f3fa48c6fff543becbd43352","6d89ad7ba4876b0b22c2ca280c682862f342c8591f1daf5170e07bfd9ccafa7d"],["7f30ea2476b399b4957509c88f77d0191afa2ff5cb7b14fd6d8e7d65aaab1193","ca5ef7d4b231c94c3b15389a5f6311e9daff7bb67b103e9880ef4bff637acaec"],["5098ff1e1d9f14fb46a210fada6c903fef0fb7b4a1dd1d9ac60a0361800b7a00","9731141d81fc8f8084d37c6e7542006b3ee1b40d60dfe5362a5b132fd17ddc0"],["32b78c7de9ee512a72895be6b9cbefa6e2f3c4ccce445c96b9f2c81e2778ad58","ee1849f513df71e32efc3896ee28260c73bb80547ae2275ba497237794c8753c"],["e2cb74fddc8e9fbcd076eef2a7c72b0ce37d50f08269dfc074b581550547a4f7","d3aa2ed71c9dd2247a62df062736eb0baddea9e36122d2be8641abcb005cc4a4"],["8438447566d4d7bedadc299496ab357426009a35f235cb141be0d99cd10ae3a8","c4e1020916980a4da5d01ac5e6ad330734ef0d7906631c4f2390426b2edd791f"],["4162d488b89402039b584c6fc6c308870587d9c46f660b878ab65c82c711d67e","67163e903236289f776f22c25fb8a3afc1732f2b84b4e95dbda47ae5a0852649"],["3fad3fa84caf0f34f0f89bfd2dcf54fc175d767aec3e50684f3ba4a4bf5f683d","cd1bc7cb6cc407bb2f0ca647c718a730cf71872e7d0d2a53fa20efcdfe61826"],["674f2600a3007a00568c1a7ce05d0816c1fb84bf1370798f1c69532faeb1a86b","299d21f9413f33b3edf43b257004580b70db57da0b182259e09eecc69e0d38a5"],["d32f4da54ade74abb81b815ad1fb3b263d82d6c692714bcff87d29bd5ee9f08f","f9429e738b8e53b968e99016c059707782e14f4535359d582fc416910b3eea87"],["30e4e670435385556e593657135845d36fbb6931f72b08cb1ed954f1e3ce3ff6","462f9bce619898638499350113bbc9b10a878d35da70740dc695a559eb88db7b"],["be2062003c51cc3004682904330e4dee7f3dcd10b01e580bf1971b04d4cad297","62188bc49d61e5428573d48a74e1c655b1c61090905682a0d5558ed72dccb9bc"],["93144423ace3451ed29e0fb9ac2af211cb6e84a601df5993c419859fff5df04a","7c10dfb164c3425f5c71a3f9d7992038f1065224f72bb9d1d902a6d13037b47c"],["b015f8044f5fcbdcf21ca26d6c34fb8197829205c7b7d2a7cb66418c157b112c","ab8c1e086d04e813744a655b2df8d5f83b3cdc6faa3088c1d3aea1454e3a1d5f"],["d5e9e1da649d97d89e4868117a465a3a4f8a18de57a140d36b3f2af341a21b52","4cb04437f391ed73111a13cc1d4dd0db1693465c2240480d8955e8592f27447a"],["d3ae41047dd7ca065dbf8ed77b992439983005cd72e16d6f996a5316d36966bb","bd1aeb21ad22ebb22a10f0303417c6d964f8cdd7df0aca614b10dc14d125ac46"],["463e2763d885f958fc66cdd22800f0a487197d0a82e377b49f80af87c897b065","bfefacdb0e5d0fd7df3a311a94de062b26b80c61fbc97508b79992671ef7ca7f"],["7985fdfd127c0567c6f53ec1bb63ec3158e597c40bfe747c83cddfc910641917","603c12daf3d9862ef2b25fe1de289aed24ed291e0ec6708703a5bd567f32ed03"],["74a1ad6b5f76e39db2dd249410eac7f99e74c59cb83d2d0ed5ff1543da7703e9","cc6157ef18c9c63cd6193d83631bbea0093e0968942e8c33d5737fd790e0db08"],["30682a50703375f602d416664ba19b7fc9bab42c72747463a71d0896b22f6da3","553e04f6b018b4fa6c8f39e7f311d3176290d0e0f19ca73f17714d9977a22ff8"],["9e2158f0d7c0d5f26c3791efefa79597654e7a2b2464f52b1ee6c1347769ef57","712fcdd1b9053f09003a3481fa7762e9ffd7c8ef35a38509e2fbf2629008373"],["176e26989a43c9cfeba4029c202538c28172e566e3c4fce7322857f3be327d66","ed8cc9d04b29eb877d270b4878dc43c19aefd31f4eee09ee7b47834c1fa4b1c3"],["75d46efea3771e6e68abb89a13ad747ecf1892393dfc4f1b7004788c50374da8","9852390a99507679fd0b86fd2b39a868d7efc22151346e1a3ca4726586a6bed8"],["809a20c67d64900ffb698c4c825f6d5f2310fb0451c869345b7319f645605721","9e994980d9917e22b76b061927fa04143d096ccc54963e6a5ebfa5f3f8e286c1"],["1b38903a43f7f114ed4500b4eac7083fdefece1cf29c63528d563446f972c180","4036edc931a60ae889353f77fd53de4a2708b26b6f5da72ad3394119daf408f9"]]}}},function(e,t,i){"use strict";var n=i(4),a=i(275),s=i(5),r=s.utils.assert,o=i(276),c=i(277);function d(e){if(!(this instanceof d))return new d(e);"string"==typeof e&&(r(s.curves.hasOwnProperty(e),"Unknown curve "+e),e=s.curves[e]),e instanceof s.curves.PresetCurve&&(e={curve:e}),this.curve=e.curve.curve,this.n=this.curve.n,this.nh=this.n.ushrn(1),this.g=this.curve.g,this.g=e.curve.g,this.g.precompute(e.curve.n.bitLength()+1),this.hash=e.hash||e.curve.hash}(e.exports=d).prototype.keyPair=function(e){return new o(this,e)},d.prototype.keyFromPrivate=function(e,t){return o.fromPrivate(this,e,t)},d.prototype.keyFromPublic=function(e,t){return o.fromPublic(this,e,t)},d.prototype.genKeyPair=function(e){e||(e={});for(var t=new a({hash:this.hash,pers:e.pers,persEnc:e.persEnc||"utf8",entropy:e.entropy||s.rand(this.hash.hmacStrength),entropyEnc:e.entropy&&e.entropyEnc||"utf8",nonce:this.n.toArray()}),i=this.n.byteLength(),r=this.n.sub(new n(2));;){var o=new n(t.generate(i));if(!(0<o.cmp(r)))return o.iaddn(1),this.keyFromPrivate(o)}},d.prototype._truncateToN=function(e,t){var i=8*e.byteLength()-this.n.bitLength();return 0<i&&(e=e.ushrn(i)),!t&&0<=e.cmp(this.n)?e.sub(this.n):e},d.prototype.sign=function(e,t,i,s){"object"==typeof i&&(s=i,i=null),s||(s={}),t=this.keyFromPrivate(t,i),e=this._truncateToN(new n(e,16));for(var r=this.n.byteLength(),o=t.getPrivate().toArray("be",r),d=e.toArray("be",r),l=new a({hash:this.hash,entropy:o,nonce:d,pers:s.pers,persEnc:s.persEnc||"utf8"}),g=this.n.sub(new n(1)),h=0;;h++){var u=s.k?s.k(h):new n(l.generate(this.n.byteLength()));if(!((u=this._truncateToN(u,!0)).cmpn(1)<=0||0<=u.cmp(g))){var p=this.g.mul(u);if(!p.isInfinity()){var f=p.getX(),m=f.umod(this.n);if(0!==m.cmpn(0)){var _=u.invm(this.n).mul(m.mul(t.getPrivate()).iadd(e));if(0!==(_=_.umod(this.n)).cmpn(0)){var b=(p.getY().isOdd()?1:0)|(0!==f.cmp(m)?2:0);return s.canonical&&0<_.cmp(this.nh)&&(_=this.n.sub(_),b^=1),new c({r:m,s:_,recoveryParam:b})}}}}}},d.prototype.verify=function(e,t,i,a){e=this._truncateToN(new n(e,16)),i=this.keyFromPublic(i,a);var s=(t=new c(t,"hex")).r,r=t.s;if(s.cmpn(1)<0||0<=s.cmp(this.n))return!1;if(r.cmpn(1)<0||0<=r.cmp(this.n))return!1;var o,d=r.invm(this.n),l=d.mul(e).umod(this.n),g=d.mul(s).umod(this.n);return this.curve._maxwellTrick?!(o=this.g.jmulAdd(l,i.getPublic(),g)).isInfinity()&&o.eqXToP(s):!(o=this.g.mulAdd(l,i.getPublic(),g)).isInfinity()&&0===o.getX().umod(this.n).cmp(s)},d.prototype.recoverPubKey=function(e,t,i,a){r((3&i)===i,"The recovery param is more than two bits"),t=new c(t,a);var s=this.n,o=new n(e),d=t.r,l=t.s,g=1&i,h=i>>1;if(0<=d.cmp(this.curve.p.umod(this.curve.n))&&h)throw new Error("Unable to find sencond key candinate");d=h?this.curve.pointFromX(d.add(this.curve.n),g):this.curve.pointFromX(d,g);var u=t.r.invm(s),p=s.sub(o).mul(u).umod(s),f=l.mul(u).umod(s);return this.g.mulAdd(p,d,f)},d.prototype.getKeyRecoveryParam=function(e,t,i,n){if(null!==(t=new c(t,n)).recoveryParam)return t.recoveryParam;for(var a=0;a<4;a++){var s;try{s=this.recoverPubKey(e,t,a)}catch(e){continue}if(s.eq(i))return a}throw new Error("Unable to find valid recovery factor")}},function(e,t,i){"use strict";var n=i(75),a=i(126),s=i(8);function r(e){if(!(this instanceof r))return new r(e);this.hash=e.hash,this.predResist=!!e.predResist,this.outLen=this.hash.outSize,this.minEntropy=e.minEntropy||this.hash.hmacStrength,this._reseed=null,this.reseedInterval=null,this.K=null,this.V=null;var t=a.toArray(e.entropy,e.entropyEnc||"hex"),i=a.toArray(e.nonce,e.nonceEnc||"hex"),n=a.toArray(e.pers,e.persEnc||"hex");s(t.length>=this.minEntropy/8,"Not enough entropy. Minimum is: "+this.minEntropy+" bits"),this._init(t,i,n)}(e.exports=r).prototype._init=function(e,t,i){var n=e.concat(t).concat(i);this.K=new Array(this.outLen/8),this.V=new Array(this.outLen/8);for(var a=0;a<this.V.length;a++)this.K[a]=0,this.V[a]=1;this._update(n),this._reseed=1,this.reseedInterval=281474976710656},r.prototype._hmac=function(){return new n.hmac(this.hash,this.K)},r.prototype._update=function(e){var t=this._hmac().update(this.V).update([0]);e&&(t=t.update(e)),this.K=t.digest(),this.V=this._hmac().update(this.V).digest(),e&&(this.K=this._hmac().update(this.V).update([1]).update(e).digest(),this.V=this._hmac().update(this.V).digest())},r.prototype.reseed=function(e,t,i,n){"string"!=typeof t&&(n=i,i=t,t=null),e=a.toArray(e,t),i=a.toArray(i,n),s(e.length>=this.minEntropy/8,"Not enough entropy. Minimum is: "+this.minEntropy+" bits"),this._update(e.concat(i||[])),this._reseed=1},r.prototype.generate=function(e,t,i,n){if(this._reseed>this.reseedInterval)throw new Error("Reseed is required");"string"!=typeof t&&(n=i,i=t,t=null),i&&(i=a.toArray(i,n||"hex"),this._update(i));for(var s=[];s.length<e;)this.V=this._hmac().update(this.V).digest(),s=s.concat(this.V);var r=s.slice(0,e);return this._update(i),this._reseed++,a.encode(r,t)}},function(e,t,i){"use strict";var n=i(4),a=i(5).utils.assert;function s(e,t){this.ec=e,this.priv=null,this.pub=null,t.priv&&this._importPrivate(t.priv,t.privEnc),t.pub&&this._importPublic(t.pub,t.pubEnc)}(e.exports=s).fromPublic=function(e,t,i){return t instanceof s?t:new s(e,{pub:t,pubEnc:i})},s.fromPrivate=function(e,t,i){return t instanceof s?t:new s(e,{priv:t,privEnc:i})},s.prototype.validate=function(){var e=this.getPublic();return e.isInfinity()?{result:!1,reason:"Invalid public key"}:e.validate()?e.mul(this.ec.curve.n).isInfinity()?{result:!0,reason:null}:{result:!1,reason:"Public key * N != O"}:{result:!1,reason:"Public key is not a point"}},s.prototype.getPublic=function(e,t){return"string"==typeof e&&(t=e,e=null),this.pub||(this.pub=this.ec.g.mul(this.priv)),t?this.pub.encode(t,e):this.pub},s.prototype.getPrivate=function(e){return"hex"===e?this.priv.toString(16,2):this.priv},s.prototype._importPrivate=function(e,t){this.priv=new n(e,t||16),this.priv=this.priv.umod(this.ec.curve.n)},s.prototype._importPublic=function(e,t){if(e.x||e.y)return"mont"===this.ec.curve.type?a(e.x,"Need x coordinate"):"short"!==this.ec.curve.type&&"edwards"!==this.ec.curve.type||a(e.x&&e.y,"Need both x and y coordinate"),void(this.pub=this.ec.curve.point(e.x,e.y));this.pub=this.ec.curve.decodePoint(e,t)},s.prototype.derive=function(e){return e.mul(this.priv).getX()},s.prototype.sign=function(e,t,i){return this.ec.sign(e,this,t,i)},s.prototype.verify=function(e,t){return this.ec.verify(e,t,this)},s.prototype.inspect=function(){return"<Key priv: "+(this.priv&&this.priv.toString(16,2))+" pub: "+(this.pub&&this.pub.inspect())+" >"}},function(e,t,i){"use strict";var n=i(4),a=i(5).utils,s=a.assert;function r(e,t){if(e instanceof r)return e;this._importDER(e,t)||(s(e.r&&e.s,"Signature without r or s"),this.r=new n(e.r,16),this.s=new n(e.s,16),void 0===e.recoveryParam?this.recoveryParam=null:this.recoveryParam=e.recoveryParam)}function o(){this.place=0}function c(e,t){var i=e[t.place++];if(!(128&i))return i;for(var n=15&i,a=0,s=0,r=t.place;s<n;s++,r++)a<<=8,a|=e[r];return t.place=r,a}function d(e){for(var t=0,i=e.length-1;!e[t]&&!(128&e[t+1])&&t<i;)t++;return 0===t?e:e.slice(t)}function l(e,t){if(t<128)e.push(t);else{var i=1+(Math.log(t)/Math.LN2>>>3);for(e.push(128|i);--i;)e.push(t>>>(i<<3)&255);e.push(t)}}(e.exports=r).prototype._importDER=function(e,t){e=a.toArray(e,t);var i=new o;if(48!==e[i.place++])return!1;if(c(e,i)+i.place!==e.length)return!1;if(2!==e[i.place++])return!1;var s=c(e,i),r=e.slice(i.place,s+i.place);if(i.place+=s,2!==e[i.place++])return!1;var d=c(e,i);if(e.length!==d+i.place)return!1;var l=e.slice(i.place,d+i.place);return 0===r[0]&&128&r[1]&&(r=r.slice(1)),0===l[0]&&128&l[1]&&(l=l.slice(1)),this.r=new n(r),this.s=new n(l),!(this.recoveryParam=null)},r.prototype.toDER=function(e){var t=this.r.toArray(),i=this.s.toArray();for(128&t[0]&&(t=[0].concat(t)),128&i[0]&&(i=[0].concat(i)),t=d(t),i=d(i);!(i[0]||128&i[1]);)i=i.slice(1);var n=[2];l(n,t.length),(n=n.concat(t)).push(2),l(n,i.length);var s=n.concat(i),r=[48];return l(r,s.length),r=r.concat(s),a.encode(r,e)}},function(e,t,i){"use strict";var n=i(75),a=i(5),s=a.utils,r=s.assert,o=s.parseBytes,c=i(279),d=i(280);function l(e){if(r("ed25519"===e,"only tested with ed25519 so far"),!(this instanceof l))return new l(e);e=a.curves[e].curve,this.curve=e,this.g=e.g,this.g.precompute(e.n.bitLength()+1),this.pointClass=e.point().constructor,this.encodingLength=Math.ceil(e.n.bitLength()/8),this.hash=n.sha512}(e.exports=l).prototype.sign=function(e,t){e=o(e);var i=this.keyFromSecret(t),n=this.hashInt(i.messagePrefix(),e),a=this.g.mul(n),s=this.encodePoint(a),r=this.hashInt(s,i.pubBytes(),e).mul(i.priv()),c=n.add(r).umod(this.curve.n);return this.makeSignature({R:a,S:c,Rencoded:s})},l.prototype.verify=function(e,t,i){e=o(e),t=this.makeSignature(t);var n=this.keyFromPublic(i),a=this.hashInt(t.Rencoded(),n.pubBytes(),e),s=this.g.mul(t.S());return t.R().add(n.pub().mul(a)).eq(s)},l.prototype.hashInt=function(){for(var e=this.hash(),t=0;t<arguments.length;t++)e.update(arguments[t]);return s.intFromLE(e.digest()).umod(this.curve.n)},l.prototype.keyFromPublic=function(e){return c.fromPublic(this,e)},l.prototype.keyFromSecret=function(e){return c.fromSecret(this,e)},l.prototype.makeSignature=function(e){return e instanceof d?e:new d(this,e)},l.prototype.encodePoint=function(e){var t=e.getY().toArray("le",this.encodingLength);return t[this.encodingLength-1]|=e.getX().isOdd()?128:0,t},l.prototype.decodePoint=function(e){var t=(e=s.parseBytes(e)).length-1,i=e.slice(0,t).concat(-129&e[t]),n=0!=(128&e[t]),a=s.intFromLE(i);return this.curve.pointFromY(a,n)},l.prototype.encodeInt=function(e){return e.toArray("le",this.encodingLength)},l.prototype.decodeInt=function(e){return s.intFromLE(e)},l.prototype.isPoint=function(e){return e instanceof this.pointClass}},function(e,t,i){"use strict";var n=i(5).utils,a=n.assert,s=n.parseBytes,r=n.cachedProperty;function o(e,t){this.eddsa=e,this._secret=s(t.secret),e.isPoint(t.pub)?this._pub=t.pub:this._pubBytes=s(t.pub)}o.fromPublic=function(e,t){return t instanceof o?t:new o(e,{pub:t})},o.fromSecret=function(e,t){return t instanceof o?t:new o(e,{secret:t})},o.prototype.secret=function(){return this._secret},r(o,"pubBytes",function(){return this.eddsa.encodePoint(this.pub())}),r(o,"pub",function(){return this._pubBytes?this.eddsa.decodePoint(this._pubBytes):this.eddsa.g.mul(this.priv())}),r(o,"privBytes",function(){var e=this.eddsa,t=this.hash(),i=e.encodingLength-1,n=t.slice(0,e.encodingLength);return n[0]&=248,n[i]&=127,n[i]|=64,n}),r(o,"priv",function(){return this.eddsa.decodeInt(this.privBytes())}),r(o,"hash",function(){return this.eddsa.hash().update(this.secret()).digest()}),r(o,"messagePrefix",function(){return this.hash().slice(this.eddsa.encodingLength)}),o.prototype.sign=function(e){return a(this._secret,"KeyPair can only verify"),this.eddsa.sign(e,this)},o.prototype.verify=function(e,t){return this.eddsa.verify(e,t,this)},o.prototype.getSecret=function(e){return a(this._secret,"KeyPair is public only"),n.encode(this.secret(),e)},o.prototype.getPublic=function(e){return n.encode(this.pubBytes(),e)},e.exports=o},function(e,t,i){"use strict";var n=i(4),a=i(5).utils,s=a.assert,r=a.cachedProperty,o=a.parseBytes;function c(e,t){this.eddsa=e,"object"!=typeof t&&(t=o(t)),Array.isArray(t)&&(t={R:t.slice(0,e.encodingLength),S:t.slice(e.encodingLength)}),s(t.R&&t.S,"Signature without R or S"),e.isPoint(t.R)&&(this._R=t.R),t.S instanceof n&&(this._S=t.S),this._Rencoded=Array.isArray(t.R)?t.R:t.Rencoded,this._Sencoded=Array.isArray(t.S)?t.S:t.Sencoded}r(c,"S",function(){return this.eddsa.decodeInt(this.Sencoded())}),r(c,"R",function(){return this.eddsa.decodePoint(this.Rencoded())}),r(c,"Rencoded",function(){return this.eddsa.encodePoint(this.R())}),r(c,"Sencoded",function(){return this.eddsa.encodeInt(this.S())}),c.prototype.toBytes=function(){return this.Rencoded().concat(this.Sencoded())},c.prototype.toHex=function(){return a.encode(this.toBytes(),"hex").toUpperCase()},e.exports=c},function(e,t,i){"use strict";var n=i(33);t.certificate=i(292);var a=n.define("RSAPrivateKey",function(){this.seq().obj(this.key("version").int(),this.key("modulus").int(),this.key("publicExponent").int(),this.key("privateExponent").int(),this.key("prime1").int(),this.key("prime2").int(),this.key("exponent1").int(),this.key("exponent2").int(),this.key("coefficient").int())});t.RSAPrivateKey=a;var s=n.define("RSAPublicKey",function(){this.seq().obj(this.key("modulus").int(),this.key("publicExponent").int())});t.RSAPublicKey=s;var r=n.define("SubjectPublicKeyInfo",function(){this.seq().obj(this.key("algorithm").use(o),this.key("subjectPublicKey").bitstr())});t.PublicKey=r;var o=n.define("AlgorithmIdentifier",function(){this.seq().obj(this.key("algorithm").objid(),this.key("none").null_().optional(),this.key("curve").objid().optional(),this.key("params").seq().obj(this.key("p").int(),this.key("q").int(),this.key("g").int()).optional())}),c=n.define("PrivateKeyInfo",function(){this.seq().obj(this.key("version").int(),this.key("algorithm").use(o),this.key("subjectPrivateKey").octstr())});t.PrivateKey=c;var d=n.define("EncryptedPrivateKeyInfo",function(){this.seq().obj(this.key("algorithm").seq().obj(this.key("id").objid(),this.key("decrypt").seq().obj(this.key("kde").seq().obj(this.key("id").objid(),this.key("kdeparams").seq().obj(this.key("salt").octstr(),this.key("iters").int())),this.key("cipher").seq().obj(this.key("algo").objid(),this.key("iv").octstr()))),this.key("subjectPrivateKey").octstr())});t.EncryptedPrivateKey=d;var l=n.define("DSAPrivateKey",function(){this.seq().obj(this.key("version").int(),this.key("p").int(),this.key("q").int(),this.key("g").int(),this.key("pub_key").int(),this.key("priv_key").int())});t.DSAPrivateKey=l,t.DSAparam=n.define("DSAparam",function(){this.int()});var g=n.define("ECPrivateKey",function(){this.seq().obj(this.key("version").int(),this.key("privateKey").octstr(),this.key("parameters").optional().explicit(0).use(h),this.key("publicKey").optional().explicit(1).bitstr())});t.ECPrivateKey=g;var h=n.define("ECParameters",function(){this.choice({namedCurve:this.objid()})});t.signature=n.define("signature",function(){this.seq().obj(this.key("r").int(),this.key("s").int())})},function(e,t,i){var n=i(33),a=i(1);function s(e,t){this.name=e,this.body=t,this.decoders={},this.encoders={}}t.define=function(e,t){return new s(e,t)},s.prototype._createNamed=function(e){var t;try{t=i(283).runInThisContext("(function "+this.name+"(entity) {\n  this._initNamed(entity);\n})")}catch(e){t=function(e){this._initNamed(e)}}return a(t,e),t.prototype._initNamed=function(t){e.call(this,t)},new t(this)},s.prototype._getDecoder=function(e){return e=e||"der",this.decoders.hasOwnProperty(e)||(this.decoders[e]=this._createNamed(n.decoders[e])),this.decoders[e]},s.prototype.decode=function(e,t,i){return this._getDecoder(t).decode(e,i)},s.prototype._getEncoder=function(e){return e=e||"der",this.encoders.hasOwnProperty(e)||(this.encoders[e]=this._createNamed(n.encoders[e])),this.encoders[e]},s.prototype.encode=function(e,t,i){return this._getEncoder(t).encode(e,i)}},function(module,exports,__webpack_require__){var indexOf=__webpack_require__(284),Object_keys=function(e){if(Object.keys)return Object.keys(e);var t=[];for(var i in e)t.push(i);return t},forEach=function(e,t){if(e.forEach)return e.forEach(t);for(var i=0;i<e.length;i++)t(e[i],i,e)},defineProp=function(){try{return Object.defineProperty({},"_",{}),function(e,t,i){Object.defineProperty(e,t,{writable:!0,enumerable:!1,configurable:!0,value:i})}}catch(e){return function(e,t,i){e[t]=i}}}(),globals=["Array","Boolean","Date","Error","EvalError","Function","Infinity","JSON","Math","NaN","Number","Object","RangeError","ReferenceError","RegExp","String","SyntaxError","TypeError","URIError","decodeURI","decodeURIComponent","encodeURI","encodeURIComponent","escape","eval","isFinite","isNaN","parseFloat","parseInt","undefined","unescape"];function Context(){}Context.prototype={};var Script=exports.Script=function(e){if(!(this instanceof Script))return new Script(e);this.code=e};Script.prototype.runInContext=function(e){if(!(e instanceof Context))throw new TypeError("needs a 'context' argument.");var t=document.createElement("iframe");t.style||(t.style={}),t.style.display="none",document.body.appendChild(t);var i=t.contentWindow,n=i.eval,a=i.execScript;!n&&a&&(a.call(i,"null"),n=i.eval),forEach(Object_keys(e),function(t){i[t]=e[t]}),forEach(globals,function(t){e[t]&&(i[t]=e[t])});var s=Object_keys(i),r=n.call(i,this.code);return forEach(Object_keys(i),function(t){(t in e||-1===indexOf(s,t))&&(e[t]=i[t])}),forEach(globals,function(t){t in e||defineProp(e,t,i[t])}),document.body.removeChild(t),r},Script.prototype.runInThisContext=function(){return eval(this.code)},Script.prototype.runInNewContext=function(e){var t=Script.createContext(e),i=this.runInContext(t);return forEach(Object_keys(t),function(i){e[i]=t[i]}),i},forEach(Object_keys(Script.prototype),function(e){exports[e]=Script[e]=function(t){var i=Script(t);return i[e].apply(i,[].slice.call(arguments,1))}}),exports.createScript=function(e){return exports.Script(e)},exports.createContext=Script.createContext=function(e){var t=new Context;return"object"==typeof e&&forEach(Object_keys(e),function(i){t[i]=e[i]}),t}},function(e,t){var i=[].indexOf;e.exports=function(e,t){if(i)return e.indexOf(t);for(var n=0;n<e.length;++n)if(e[n]===t)return n;return-1}},function(e,t,i){var n=i(1);function a(e){this._reporterState={obj:null,path:[],options:e||{},errors:[]}}function s(e,t){this.path=e,this.rethrow(t)}(t.Reporter=a).prototype.isError=function(e){return e instanceof s},a.prototype.save=function(){var e=this._reporterState;return{obj:e.obj,pathLen:e.path.length}},a.prototype.restore=function(e){var t=this._reporterState;t.obj=e.obj,t.path=t.path.slice(0,e.pathLen)},a.prototype.enterKey=function(e){return this._reporterState.path.push(e)},a.prototype.exitKey=function(e){var t=this._reporterState;t.path=t.path.slice(0,e-1)},a.prototype.leaveKey=function(e,t,i){var n=this._reporterState;this.exitKey(e),null!==n.obj&&(n.obj[t]=i)},a.prototype.path=function(){return this._reporterState.path.join("/")},a.prototype.enterObject=function(){var e=this._reporterState,t=e.obj;return e.obj={},t},a.prototype.leaveObject=function(e){var t=this._reporterState,i=t.obj;return t.obj=e,i},a.prototype.error=function(e){var t,i=this._reporterState,n=e instanceof s;if(t=n?e:new s(i.path.map(function(e){return"["+JSON.stringify(e)+"]"}).join(""),e.message||e,e.stack),!i.options.partial)throw t;return n||i.errors.push(t),t},a.prototype.wrapResult=function(e){var t=this._reporterState;return t.options.partial?{result:this.isError(e)?null:e,errors:t.errors}:e},n(s,Error),s.prototype.rethrow=function(e){if(this.message=e+" at: "+(this.path||"(shallow)"),Error.captureStackTrace&&Error.captureStackTrace(this,s),!this.stack)try{throw new Error(this.message)}catch(e){this.stack=e.stack}return this}},function(e,t,i){var n=i(34).Reporter,a=i(34).EncoderBuffer,s=i(34).DecoderBuffer,r=i(8),o=["seq","seqof","set","setof","objid","bool","gentime","utctime","null_","enum","int","objDesc","bitstr","bmpstr","charstr","genstr","graphstr","ia5str","iso646str","numstr","octstr","printstr","t61str","unistr","utf8str","videostr"],c=["key","obj","use","optional","explicit","implicit","def","choice","any","contains"].concat(o);function d(e,t){var i={};(this._baseState=i).enc=e,i.parent=t||null,i.children=null,i.tag=null,i.args=null,i.reverseArgs=null,i.choice=null,i.optional=!1,i.any=!1,i.obj=!1,i.use=null,i.useDecoder=null,i.key=null,i.default=null,i.explicit=null,i.implicit=null,i.contains=null,i.parent||(i.children=[],this._wrap())}e.exports=d;var l=["enc","parent","children","tag","args","reverseArgs","choice","optional","any","obj","use","alteredUse","key","default","explicit","implicit","contains"];d.prototype.clone=function(){var e=this._baseState,t={};l.forEach(function(i){t[i]=e[i]});var i=new this.constructor(t.parent);return i._baseState=t,i},d.prototype._wrap=function(){var e=this._baseState;c.forEach(function(t){this[t]=function(){var i=new this.constructor(this);return e.children.push(i),i[t].apply(i,arguments)}},this)},d.prototype._init=function(e){var t=this._baseState;r(null===t.parent),e.call(this),t.children=t.children.filter(function(e){return e._baseState.parent===this},this),r.equal(t.children.length,1,"Root node can have only one child")},d.prototype._useArgs=function(e){var t=this._baseState,i=e.filter(function(e){return e instanceof this.constructor},this);e=e.filter(function(e){return!(e instanceof this.constructor)},this),0!==i.length&&(r(null===t.children),(t.children=i).forEach(function(e){e._baseState.parent=this},this)),0!==e.length&&(r(null===t.args),t.args=e,t.reverseArgs=e.map(function(e){if("object"!=typeof e||e.constructor!==Object)return e;var t={};return Object.keys(e).forEach(function(i){i==(0|i)&&(i|=0);var n=e[i];t[n]=i}),t}))},["_peekTag","_decodeTag","_use","_decodeStr","_decodeObjid","_decodeTime","_decodeNull","_decodeInt","_decodeBool","_decodeList","_encodeComposite","_encodeStr","_encodeObjid","_encodeTime","_encodeNull","_encodeInt","_encodeBool"].forEach(function(e){d.prototype[e]=function(){var t=this._baseState;throw new Error(e+" not implemented for encoding: "+t.enc)}}),o.forEach(function(e){d.prototype[e]=function(){var t=this._baseState,i=Array.prototype.slice.call(arguments);return r(null===t.tag),t.tag=e,this._useArgs(i),this}}),d.prototype.use=function(e){r(e);var t=this._baseState;return r(null===t.use),t.use=e,this},d.prototype.optional=function(){return this._baseState.optional=!0,this},d.prototype.def=function(e){var t=this._baseState;return r(null===t.default),t.default=e,t.optional=!0,this},d.prototype.explicit=function(e){var t=this._baseState;return r(null===t.explicit&&null===t.implicit),t.explicit=e,this},d.prototype.implicit=function(e){var t=this._baseState;return r(null===t.explicit&&null===t.implicit),t.implicit=e,this},d.prototype.obj=function(){var e=this._baseState,t=Array.prototype.slice.call(arguments);return e.obj=!0,0!==t.length&&this._useArgs(t),this},d.prototype.key=function(e){var t=this._baseState;return r(null===t.key),t.key=e,this},d.prototype.any=function(){return this._baseState.any=!0,this},d.prototype.choice=function(e){var t=this._baseState;return r(null===t.choice),t.choice=e,this._useArgs(Object.keys(e).map(function(t){return e[t]})),this},d.prototype.contains=function(e){var t=this._baseState;return r(null===t.use),t.contains=e,this},d.prototype._decode=function(e,t){var i=this._baseState;if(null===i.parent)return e.wrapResult(i.children[0]._decode(e,t));var n,a=i.default,r=!0,o=null;if(null!==i.key&&(o=e.enterKey(i.key)),i.optional){var c=null;if(null!==i.explicit?c=i.explicit:null!==i.implicit?c=i.implicit:null!==i.tag&&(c=i.tag),null!==c||i.any){if(r=this._peekTag(e,c,i.any),e.isError(r))return r}else{var d=e.save();try{null===i.choice?this._decodeGeneric(i.tag,e,t):this._decodeChoice(e,t),r=!0}catch(i){r=!1}e.restore(d)}}if(i.obj&&r&&(n=e.enterObject()),r){if(null!==i.explicit){var l=this._decodeTag(e,i.explicit);if(e.isError(l))return l;e=l}var g=e.offset;if(null===i.use&&null===i.choice){i.any&&(d=e.save());var h=this._decodeTag(e,null!==i.implicit?i.implicit:i.tag,i.any);if(e.isError(h))return h;i.any?a=e.raw(d):e=h}if(t&&t.track&&null!==i.tag&&t.track(e.path(),g,e.length,"tagged"),t&&t.track&&null!==i.tag&&t.track(e.path(),e.offset,e.length,"content"),a=i.any?a:null===i.choice?this._decodeGeneric(i.tag,e,t):this._decodeChoice(e,t),e.isError(a))return a;if(i.any||null!==i.choice||null===i.children||i.children.forEach(function(i){i._decode(e,t)}),i.contains&&("octstr"===i.tag||"bitstr"===i.tag)){var u=new s(a);a=this._getUse(i.contains,e._reporterState.obj)._decode(u,t)}}return i.obj&&r&&(a=e.leaveObject(n)),null===i.key||null===a&&!0!==r?null!==o&&e.exitKey(o):e.leaveKey(o,i.key,a),a},d.prototype._decodeGeneric=function(e,t,i){var n=this._baseState;return"seq"===e||"set"===e?null:"seqof"===e||"setof"===e?this._decodeList(t,e,n.args[0],i):/str$/.test(e)?this._decodeStr(t,e,i):"objid"===e&&n.args?this._decodeObjid(t,n.args[0],n.args[1],i):"objid"===e?this._decodeObjid(t,null,null,i):"gentime"===e||"utctime"===e?this._decodeTime(t,e,i):"null_"===e?this._decodeNull(t,i):"bool"===e?this._decodeBool(t,i):"objDesc"===e?this._decodeStr(t,e,i):"int"===e||"enum"===e?this._decodeInt(t,n.args&&n.args[0],i):null!==n.use?this._getUse(n.use,t._reporterState.obj)._decode(t,i):t.error("unknown tag: "+e)},d.prototype._getUse=function(e,t){var i=this._baseState;return i.useDecoder=this._use(e,t),r(null===i.useDecoder._baseState.parent),i.useDecoder=i.useDecoder._baseState.children[0],i.implicit!==i.useDecoder._baseState.implicit&&(i.useDecoder=i.useDecoder.clone(),i.useDecoder._baseState.implicit=i.implicit),i.useDecoder},d.prototype._decodeChoice=function(e,t){var i=this._baseState,n=null,a=!1;return Object.keys(i.choice).some(function(s){var r=e.save(),o=i.choice[s];try{var c=o._decode(e,t);if(e.isError(c))return!1;n={type:s,value:c},a=!0}catch(s){return e.restore(r),!1}return!0},this),a?n:e.error("Choice not matched")},d.prototype._createEncoderBuffer=function(e){return new a(e,this.reporter)},d.prototype._encode=function(e,t,i){var n=this._baseState;if(null===n.default||n.default!==e){var a=this._encodeValue(e,t,i);if(void 0!==a&&!this._skipDefault(a,t,i))return a}},d.prototype._encodeValue=function(e,t,i){var a=this._baseState;if(null===a.parent)return a.children[0]._encode(e,t||new n);var s=null;if(this.reporter=t,a.optional&&void 0===e){if(null===a.default)return;e=a.default}var r=null,o=!1;if(a.any)s=this._createEncoderBuffer(e);else if(a.choice)s=this._encodeChoice(e,t);else if(a.contains)r=this._getUse(a.contains,i)._encode(e,t),o=!0;else if(a.children)r=a.children.map(function(i){if("null_"===i._baseState.tag)return i._encode(null,t,e);if(null===i._baseState.key)return t.error("Child should have a key");var n=t.enterKey(i._baseState.key);if("object"!=typeof e)return t.error("Child expected, but input is not object");var a=i._encode(e[i._baseState.key],t,e);return t.leaveKey(n),a},this).filter(function(e){return e}),r=this._createEncoderBuffer(r);else if("seqof"===a.tag||"setof"===a.tag){if(!a.args||1!==a.args.length)return t.error("Too many args for : "+a.tag);if(!Array.isArray(e))return t.error("seqof/setof, but data is not Array");var c=this.clone();c._baseState.implicit=null,r=this._createEncoderBuffer(e.map(function(i){var n=this._baseState;return this._getUse(n.args[0],e)._encode(i,t)},c))}else null!==a.use?s=this._getUse(a.use,i)._encode(e,t):(r=this._encodePrimitive(a.tag,e),o=!0);if(!a.any&&null===a.choice){var d=null!==a.implicit?a.implicit:a.tag,l=null===a.implicit?"universal":"context";null===d?null===a.use&&t.error("Tag could be omitted only for .use()"):null===a.use&&(s=this._encodeComposite(d,o,l,r))}return null!==a.explicit&&(s=this._encodeComposite(a.explicit,!1,"context",s)),s},d.prototype._encodeChoice=function(e,t){var i=this._baseState,n=i.choice[e.type];return n||r(!1,e.type+" not found in "+JSON.stringify(Object.keys(i.choice))),n._encode(e.value,t)},d.prototype._encodePrimitive=function(e,t){var i=this._baseState;if(/str$/.test(e))return this._encodeStr(t,e);if("objid"===e&&i.args)return this._encodeObjid(t,i.reverseArgs[0],i.args[1]);if("objid"===e)return this._encodeObjid(t,null,null);if("gentime"===e||"utctime"===e)return this._encodeTime(t,e);if("null_"===e)return this._encodeNull();if("int"===e||"enum"===e)return this._encodeInt(t,i.args&&i.reverseArgs[0]);if("bool"===e)return this._encodeBool(t);if("objDesc"===e)return this._encodeStr(t,e);throw new Error("Unsupported tag: "+e)},d.prototype._isNumstr=function(e){return/^[0-9 ]*$/.test(e)},d.prototype._isPrintstr=function(e){return/^[A-Za-z0-9 '\(\)\+,\-\.\/:=\?]*$/.test(e)}},function(e,t,i){var n=i(131);t.tagClass={0:"universal",1:"application",2:"context",3:"private"},t.tagClassByName=n._reverse(t.tagClass),t.tag={0:"end",1:"bool",2:"int",3:"bitstr",4:"octstr",5:"null_",6:"objid",7:"objDesc",8:"external",9:"real",10:"enum",11:"embed",12:"utf8str",13:"relativeOid",16:"seq",17:"set",18:"numstr",19:"printstr",20:"t61str",21:"videostr",22:"ia5str",23:"utctime",24:"gentime",25:"graphstr",26:"iso646str",27:"genstr",28:"unistr",29:"charstr",30:"bmpstr"},t.tagByName=n._reverse(t.tag)},function(e,t,i){var n=t;n.der=i(132),n.pem=i(289)},function(e,t,i){var n=i(1),a=i(3).Buffer,s=i(132);function r(e){s.call(this,e),this.enc="pem"}n(r,s),(e.exports=r).prototype.decode=function(e,t){for(var i=e.toString().split(/[\r\n]+/g),n=t.label.toUpperCase(),r=/^-----(BEGIN|END) ([^-]+)-----$/,o=-1,c=-1,d=0;d<i.length;d++){var l=i[d].match(r);if(null!==l&&l[2]===n){if(-1!==o){if("END"!==l[1])break;c=d;break}if("BEGIN"!==l[1])break;o=d}}if(-1===o||-1===c)throw new Error("PEM section not found for: "+n);var g=i.slice(o+1,c).join("");g.replace(/[^a-z0-9\+\/=]+/gi,"");var h=new a(g,"base64");return s.prototype.decode.call(this,h,t)}},function(e,t,i){var n=t;n.der=i(133),n.pem=i(291)},function(e,t,i){var n=i(1),a=i(133);function s(e){a.call(this,e),this.enc="pem"}n(s,a),(e.exports=s).prototype.encode=function(e,t){for(var i=a.prototype.encode.call(this,e).toString("base64"),n=["-----BEGIN "+t.label+"-----"],s=0;s<i.length;s+=64)n.push(i.slice(s,s+64));return n.push("-----END "+t.label+"-----"),n.join("\n")}},function(e,t,i){"use strict";var n=i(33),a=n.define("Time",function(){this.choice({utcTime:this.utctime(),generalTime:this.gentime()})}),s=n.define("AttributeTypeValue",function(){this.seq().obj(this.key("type").objid(),this.key("value").any())}),r=n.define("AlgorithmIdentifier",function(){this.seq().obj(this.key("algorithm").objid(),this.key("parameters").optional())}),o=n.define("SubjectPublicKeyInfo",function(){this.seq().obj(this.key("algorithm").use(r),this.key("subjectPublicKey").bitstr())}),c=n.define("RelativeDistinguishedName",function(){this.setof(s)}),d=n.define("RDNSequence",function(){this.seqof(c)}),l=n.define("Name",function(){this.choice({rdnSequence:this.use(d)})}),g=n.define("Validity",function(){this.seq().obj(this.key("notBefore").use(a),this.key("notAfter").use(a))}),h=n.define("Extension",function(){this.seq().obj(this.key("extnID").objid(),this.key("critical").bool().def(!1),this.key("extnValue").octstr())}),u=n.define("TBSCertificate",function(){this.seq().obj(this.key("version").explicit(0).int(),this.key("serialNumber").int(),this.key("signature").use(r),this.key("issuer").use(l),this.key("validity").use(g),this.key("subject").use(l),this.key("subjectPublicKeyInfo").use(o),this.key("issuerUniqueID").implicit(1).bitstr().optional(),this.key("subjectUniqueID").implicit(2).bitstr().optional(),this.key("extensions").explicit(3).seqof(h).optional())}),p=n.define("X509Certificate",function(){this.seq().obj(this.key("tbsCertificate").use(u),this.key("signatureAlgorithm").use(r),this.key("signatureValue").bitstr())});e.exports=p},function(e){e.exports={"2.16.840.1.101.3.4.1.1":"aes-128-ecb","2.16.840.1.101.3.4.1.2":"aes-128-cbc","2.16.840.1.101.3.4.1.3":"aes-128-ofb","2.16.840.1.101.3.4.1.4":"aes-128-cfb","2.16.840.1.101.3.4.1.21":"aes-192-ecb","2.16.840.1.101.3.4.1.22":"aes-192-cbc","2.16.840.1.101.3.4.1.23":"aes-192-ofb","2.16.840.1.101.3.4.1.24":"aes-192-cfb","2.16.840.1.101.3.4.1.41":"aes-256-ecb","2.16.840.1.101.3.4.1.42":"aes-256-cbc","2.16.840.1.101.3.4.1.43":"aes-256-ofb","2.16.840.1.101.3.4.1.44":"aes-256-cfb"}},function(e,t,i){(function(t){var n=/Proc-Type: 4,ENCRYPTED[\n\r]+DEK-Info: AES-((?:128)|(?:192)|(?:256))-CBC,([0-9A-H]+)[\n\r]+([0-9A-z\n\r\+\/\=]+)[\n\r]+/m,a=/^-----BEGIN ((?:.* KEY)|CERTIFICATE)-----/m,s=/^-----BEGIN ((?:.* KEY)|CERTIFICATE)-----([0-9A-z\n\r\+\/\=]+)-----END \1-----$/m,r=i(46),o=i(72);e.exports=function(e,i){var c,d=e.toString(),l=d.match(n);if(l){var g="aes"+l[1],h=new t(l[2],"hex"),u=new t(l[3].replace(/[\r\n]/g,""),"base64"),p=r(i,h.slice(0,8),parseInt(l[1],10)).key,f=[],m=o.createDecipheriv(g,p,h);f.push(m.update(u)),f.push(m.final()),c=t.concat(f)}else{var _=d.match(s);c=new t(_[2].replace(/[\r\n]/g,""),"base64")}return{tag:d.match(a)[1],data:c}}}).call(this,i(3).Buffer)},function(e,t,i){(function(t){var n=i(4),a=i(5).ec,s=i(48),r=i(134);function o(e,t){if(e.cmpn(0)<=0)throw new Error("invalid sig");if(e.cmp(t)>=t)throw new Error("invalid sig")}e.exports=function(e,i,c,d,l){var g=s(c);if("ec"===g.type){if("ecdsa"!==d&&"ecdsa/rsa"!==d)throw new Error("wrong public key type");return function(e,t,i){var n=r[i.data.algorithm.curve.join(".")];if(!n)throw new Error("unknown curve "+i.data.algorithm.curve.join("."));var s=new a(n),o=i.data.subjectPrivateKey.data;return s.verify(t,e,o)}(e,i,g)}if("dsa"===g.type){if("dsa"!==d)throw new Error("wrong public key type");return function(e,t,i){var a=i.data.p,r=i.data.q,c=i.data.g,d=i.data.pub_key,l=s.signature.decode(e,"der"),g=l.s,h=l.r;o(g,r),o(h,r);var u=n.mont(a),p=g.invm(r);return 0===c.toRed(u).redPow(new n(t).mul(p).mod(r)).fromRed().mul(d.toRed(u).redPow(h.mul(p).mod(r)).fromRed()).mod(a).mod(r).cmp(h)}(e,i,g)}if("rsa"!==d&&"ecdsa/rsa"!==d)throw new Error("wrong public key type");i=t.concat([l,i]);for(var h=g.modulus.byteLength(),u=[1],p=0;i.length+u.length+2<h;)u.push(255),p++;u.push(0);for(var f=-1;++f<i.length;)u.push(i[f]);u=new t(u);var m=n.mont(g.modulus);e=(e=new n(e).toRed(m)).redPow(new n(g.publicExponent)),e=new t(e.fromRed().toArray());var _=p<8?1:0;for(h=Math.min(e.length,u.length),e.length!==u.length&&(_=1),f=-1;++f<h;)_|=e[f]^u[f];return 0===_}}).call(this,i(3).Buffer)},function(e,t,i){(function(t){var n=i(5),a=i(4);e.exports=function(e){return new r(e)};var s={secp256k1:{name:"secp256k1",byteLength:32},secp224r1:{name:"p224",byteLength:28},prime256v1:{name:"p256",byteLength:32},prime192v1:{name:"p192",byteLength:24},ed25519:{name:"ed25519",byteLength:32},secp384r1:{name:"p384",byteLength:48},secp521r1:{name:"p521",byteLength:66}};function r(e){this.curveType=s[e],this.curveType||(this.curveType={name:e}),this.curve=new n.ec(this.curveType.name),this.keys=void 0}function o(e,i,n){Array.isArray(e)||(e=e.toArray());var a=new t(e);if(n&&a.length<n){var s=new t(n-a.length);s.fill(0),a=t.concat([s,a])}return i?a.toString(i):a}s.p224=s.secp224r1,s.p256=s.secp256r1=s.prime256v1,s.p192=s.secp192r1=s.prime192v1,s.p384=s.secp384r1,s.p521=s.secp521r1,r.prototype.generateKeys=function(e,t){return this.keys=this.curve.genKeyPair(),this.getPublicKey(e,t)},r.prototype.computeSecret=function(e,i,n){return i=i||"utf8",t.isBuffer(e)||(e=new t(e,i)),o(this.curve.keyFromPublic(e).getPublic().mul(this.keys.getPrivate()).getX(),n,this.curveType.byteLength)},r.prototype.getPublicKey=function(e,t){var i=this.keys.getPublic("compressed"===t,!0);return"hybrid"===t&&(i[i.length-1]%2?i[0]=7:i[0]=6),o(i,e)},r.prototype.getPrivateKey=function(e){return o(this.keys.getPrivate(),e)},r.prototype.setPublicKey=function(e,i){return i=i||"utf8",t.isBuffer(e)||(e=new t(e,i)),this.keys._importPublic(e),this},r.prototype.setPrivateKey=function(e,i){i=i||"utf8",t.isBuffer(e)||(e=new t(e,i));var n=new a(e);return n=n.toString(16),this.keys=this.curve.genKeyPair(),this.keys._importPrivate(n),this}}).call(this,i(3).Buffer)},function(e,t,i){t.publicEncrypt=i(298),t.privateDecrypt=i(299),t.privateEncrypt=function(e,i){return t.publicEncrypt(e,i,!0)},t.publicDecrypt=function(e,i){return t.privateDecrypt(e,i,!0)}},function(e,t,i){var n=i(48),a=i(23),s=i(29),r=i(135),o=i(136),c=i(4),d=i(137),l=i(74),g=i(49).Buffer;e.exports=function(e,t,i){var h;h=e.padding?e.padding:i?1:4;var u,p=n(e);if(4===h)u=function(e,t){var i=e.modulus.byteLength(),n=t.length,d=s("sha1").update(g.alloc(0)).digest(),l=d.length,h=2*l;if(i-h-2<n)throw new Error("message too long");var u=g.alloc(i-n-h-2),p=i-l-1,f=a(l),m=o(g.concat([d,u,g.alloc(1,1),t],p),r(f,p)),_=o(f,r(m,l));return new c(g.concat([g.alloc(1),_,m],i))}(p,t);else if(1===h)u=function(e,t,i){var n,s=t.length,r=e.modulus.byteLength();if(r-11<s)throw new Error("message too long");return n=i?g.alloc(r-s-3,255):function(e){for(var t,i=g.allocUnsafe(e),n=0,s=a(2*e),r=0;n<e;)r===s.length&&(s=a(2*e),r=0),(t=s[r++])&&(i[n++]=t);return i}(r-s-3),new c(g.concat([g.from([0,i?1:2]),n,g.alloc(1),t],r))}(p,t,i);else{if(3!==h)throw new Error("unknown padding");if(0<=(u=new c(t)).cmp(p.modulus))throw new Error("data too long for modulus")}return i?l(u,p):d(u,p)}},function(e,t,i){var n=i(48),a=i(135),s=i(136),r=i(4),o=i(74),c=i(29),d=i(137),l=i(49).Buffer;e.exports=function(e,t,i){var g;g=e.padding?e.padding:i?1:4;var h,u=n(e),p=u.modulus.byteLength();if(t.length>p||0<=new r(t).cmp(u.modulus))throw new Error("decryption error");h=i?d(new r(t),u):o(t,u);var f=l.alloc(p-h.length);if(h=l.concat([f,h],p),4===g)return function(e,t){var i=e.modulus.byteLength(),n=c("sha1").update(l.alloc(0)).digest(),r=n.length;if(0!==t[0])throw new Error("decryption error");var o=t.slice(1,r+1),d=t.slice(r+1),g=s(o,a(d,r)),h=s(d,a(g,i-r-1));if(function(e,t){e=l.from(e),t=l.from(t);var i=0,n=e.length;e.length!==t.length&&(i++,n=Math.min(e.length,t.length));for(var a=-1;++a<n;)i+=e[a]^t[a];return i}(n,h.slice(0,r)))throw new Error("decryption error");for(var u=r;0===h[u];)u++;if(1===h[u++])return h.slice(u);throw new Error("decryption error")}(u,h);if(1===g)return function(e,t,i){for(var n=t.slice(0,2),a=2,s=0;0!==t[a++];)if(a>=t.length){s++;break}var r=t.slice(2,a-1);if(("0002"!==n.toString("hex")&&!i||"0001"!==n.toString("hex")&&i)&&s++,r.length<8&&s++,s)throw new Error("decryption error");return t.slice(a)}(0,h,i);if(3===g)return h;throw new Error("unknown padding")}},function(e,t,i){"use strict";(function(e,n){function a(){throw new Error("secure random number generation not supported by this browser\nuse chrome, FireFox or Internet Explorer 11")}var s=i(2),r=i(23),o=s.Buffer,c=s.kMaxLength,d=e.crypto||e.msCrypto,l=Math.pow(2,32)-1;function g(e,t){if("number"!=typeof e||e!=e)throw new TypeError("offset must be a number");if(l<e||e<0)throw new TypeError("offset must be a uint32");if(c<e||t<e)throw new RangeError("offset out of range")}function h(e,t,i){if("number"!=typeof e||e!=e)throw new TypeError("size must be a number");if(l<e||e<0)throw new TypeError("size must be a uint32");if(i<e+t||c<e)throw new RangeError("buffer too small")}function u(e,t,i,a){if(n.browser){var s=e.buffer,o=new Uint8Array(s,t,i);return d.getRandomValues(o),a?void n.nextTick(function(){a(null,e)}):e}if(!a)return r(i).copy(e,t),e;r(i,function(i,n){if(i)return a(i);n.copy(e,t),a(null,e)})}d&&d.getRandomValues||!n.browser?(t.randomFill=function(t,i,n,a){if(!(o.isBuffer(t)||t instanceof e.Uint8Array))throw new TypeError('"buf" argument must be a Buffer or Uint8Array');if("function"==typeof i)a=i,i=0,n=t.length;else if("function"==typeof n)a=n,n=t.length-i;else if("function"!=typeof a)throw new TypeError('"cb" argument must be a function');return g(i,t.length),h(n,i,t.length),u(t,i,n,a)},t.randomFillSync=function(t,i,n){if(void 0===i&&(i=0),!(o.isBuffer(t)||t instanceof e.Uint8Array))throw new TypeError('"buf" argument must be a Buffer or Uint8Array');return g(i,t.length),void 0===n&&(n=t.length-i),h(n,i,t.length),u(t,i,n)}):(t.randomFill=a,t.randomFillSync=a)}).call(this,i(12),i(16))},function(e,t,i){"use strict";var n=i(160),a=i(161),s=i(302),r=i(76),o=i(21),c=i(86).getAbParametersForSmartblock,d={ED:"edreams",OP:"opodo",TL:"travel-link",GV:"go-voyages"};Object.freeze(d),e.exports={carsTemplates:{xsellProductTemplate:_.template($(".xsell_product_banner_template").html(),Odigeo.Utils.getTmplSettings()),xsellCartrawlerSmartblockWidgetTemplate:_.template($(".xsell_ct_cars_smartblock_widget").html(),Odigeo.Utils.getTmplSettings())},generateCartrawlerData:function(e,t){var i=r(o.confirmation_cars_smartblock),l=n(e.myTrip),g=a(e.myTrip.buyer),h=s.getFirstFlightData(e.myTrip),u=s.getItineraryDataFromSegments(e.myTrip.itineraries[0].segments),p={brand:d[Odigeo.SessionScope.brand],product:"widget",clientId:i,currency:e.myTrip.currency,residence:g.getCountryCode(),language:Odigeo.SessionScope.tmParam.language,passengerNo:e.xsellingData.nPassengers,driversAge:l.getAge(),flightNumber:h.getFlightNumber(),pnr:h.getPnr(),context:t,itinerarySegments:u};return _.assign(p,c()),p}}},function(e,t,i){"use strict";var n=i(27),a="UTC:yyyy-mm-dd'T'HH:MM:ss";e.exports={getFirstFlightData:function(e){var t={},i=_.get(e,"itineraries[0].segments[0]"),n=e.bookingConfirmationSections[0];return t.getFlightNumber=function(){return i.carrier.code+i.id},t.getPnr=function(){return n.pnr},t},getItineraryDataFromSegments:function(e){var t={};return _.each(e,function(e,i){var s,r;t[i]={IATAS:(r=e,{departureIATA:r.departureLocation.iata,departureCityIATA:r.departureLocation.cityIataCode,arrivalIATA:r.arrivalLocation.iata,arrivalCityIATA:r.arrivalLocation.cityIataCode}),flightDates:(s=e,{departureDateTime:n.getFormattedDate(s.departureDate,a),arrivalDateTime:n.getFormattedDate(s.arrivalDate,a)})}}),t}}},function(e,t,i){"use strict";var n=i(0);e.exports={hotelsTemplates:{xsellWidgetTemplate:_.template($(".xsell_hotels_widget_template").html(),Odigeo.Utils.getTmplSettings()),xsellWidgetHotelItemTemplate:_.template($(".xsell_hotel_item_widget_template").html(),Odigeo.Utils.getTmplSettings())},hotelsConfig:{sortingRule:"price",minScore:8},loadHotelsBanner:function(e){var t,i,a=$(e.bannerSelector),s=e.trackingCategory,r=a.find(".hotels_items_container");if(r.html(""),e.hotels=_.filter(e.hotels,function(e){return 3<=e.stars&&e.stars<=5}).slice(0,3),1<e.hotels.length){for(var o=0;o<e.hotels.length;o++)r.append(this.hotelsTemplates.xsellWidgetHotelItemTemplate(_.extend({},(t=e.hotels[o],i=!_.isEmpty(t)&&!_.isNull(t.pricePerDay),_.extend(t,{pricePerDayFormatted:i?Odigeo.Utils.formatCurrency(t.pricePerDay):"",starsFull:parseInt(t.stars,10),halfCategory:!_.isEqual(t.stars%1,0)})),{index:o})));n.trackEventWithCategory(s,"xsell_widget","hotel_appearances")}else this.loadHotelsNoResultsBanner(e)},loadHotelsNoResultsBanner:function(e){var t=$(e.bannerSelector),i=e.trackingCategory,a=t.find(".hotels_items_container"),s=t.find(".hotels_no_results_container"),r=t.find(".xsell_hotels_tracking_link_more_clicks"),o=t.find(".xsell_hotels_tracking_button_change_search");a.addClass("odf-hidden"),s.removeClass("odf-hidden"),r[0].setAttribute("data-label","hotels_more_clicks_no-results"),o[0].setAttribute("data-label","hotels_change_search_no-results"),n.trackEventWithCategory(i,"xsell_widget","hotels_appearances_no-results")}}},function(e,t,i){"use strict";Odigeo.defineWidget("dp_error_management",Odigeo.Widget.extend({viewClass:i(305),init:_.noop,open:function(){this.view.render.apply(this.view,arguments),this.view.toggleOpenClose.call(this.view,!0)},close:function(){this.view.toggleOpenClose.apply(this.view,[!1])}}))},function(e,t,i){"use strict";var n=i(55),a=i(9),s={sessionExpired:n("error_management_sessionExpired"),packageNotAvailable:n("error_management_packageNotAvailable"),noResults:n("error_management_noResults")},r={NO_ACCOMMODATION_RESULTS:"hotels",NO_ITINERARIES_RESULTS:"flights",BROKEN_FLOW_ERROR:"broken_flow_error",BACKEND_SEARCH_ERROR:"backend_search_error",INVALID_SEARCH:"invalid_search",FAIL_LOAD:"fail_load"},o={NO_ACCOMMODATION_RESULTS:"hotel",NO_ITINERARIES_RESULTS:"flight",BROKEN_FLOW_ERROR:"broken_flow_error",BACKEND_SEARCH_ERROR:"backend_search_error",INVALID_SEARCH:"invalid_search",FAIL_LOAD:"fail_load"};e.exports=Odigeo.View.extend({slctrs:{errorManagement:".error_management"},events:{"tap .no_results_new_search":"onNewSearch","tap .package_not_available_new_search":"onNewSearch","tap .package_not_available_same_search":"onSameSearch","tap .session_expire_new_search":"onNewSearch","tap .session_expire_same_search":"onSameSearchExpiredSession","tap .session_expire_dialog_phone":"onDialogPhone"},preRender:function(e,t){this.template=e,this.errorCode=t,this.tracking=s[e],this.tracking.load(o[this.errorCode],r[this.errorCode]),Odigeo.once("routeChange",function(){this.toggleOpenClose(!1)},this)},beforeInsertTemplate:function(){var e={};switch(this.template){case"sessionExpired":e=function(){var e=Odigeo.Utils.parseJson(Odigeo.Session.get("searchParameters")),t=e.searchSegments[0],i=e.searchSegments[e.searchSegments.length-1];return _.extend({formatDate:_.partial(Odigeo.Utils.formatDate,_,Odigeo.SessionScope.websiteDateFormats.dialogDateExpireErrorCallUsFormat),departureCity:t.departure.city,destinationCity:t.destination.city,firstFlightDate:t.dateStr,lastFlightDate:i.dateStr,paxToString:_.partial(a.getPassengerTranslations,_.pick(e,"numAdults","numChildren","numInfants"),this.keys)})}.call(this)}return _.extend(e,this.widget.options)},render:function(e,t){this.preRender(e,t),this.setTemplate(this.$el,e)},toggleOpenClose:function(e){this.$el.find(this.slctrs.errorManagement).toggleClass("open",e)},onNewSearch:function(){this.tracking.click(o[this.errorCode],r[this.errorCode]),Odigeo.Utils.goToApplicationHome(Odigeo.Utils.isRequestApp("dp"))},onSameSearch:function(){this.tracking.clickSameSearch(o[this.errorCode],r[this.errorCode]),Odigeo.Router.reload()},onSameSearchExpiredSession:function(){this.tracking.clickSameSearch(o[this.errorCode],r[this.errorCode]),!Odigeo.AB.isDynpackMobileNewProductSelection&&App.Flights.isDpFlightsResults(Odigeo.History.getPageNameFromFragment())?Odigeo.Router.reload():Odigeo.trigger("sessionExpireDialog:repeatSearchDynpack")},onDialogPhone:function(){this.tracking.clickDialogPhone()}})},function(e,t,i){"use strict";Odigeo.defineWidget("membership_login_feedback",Odigeo.Widget.extend({viewClass:i(307),openLightBox:function(e){this.view.renderLoginFeedback(e)}}))},function(e,t,i){"use strict";e.exports=Odigeo.View.extend({events:{"tap @continueBtn":"toggleLightBox"},selectors:{feedbackPopup:".membership_login_feedback",continueBtn:".continue_btn"},renderLoginFeedback:function(e){this.keys=_.extend(this.keys,{primeLoginFeedbackTitle:Odigeo.Utils.replaceCmsKeyArgs(this.keys.primeLoginFeedbackTitle,e)}),this.setTemplate(this.$el,"membershipLoginFeedback",this.widget.options),this.toggleLightBox()},toggleLightBox:function(){this.$cachedSelectors.feedbackPopup.toggleClass("open")}})},function(e,t,i){"use strict";Odigeo.defineWidget("usersmanager",Odigeo.Widget.extend({modelClass:i(309),getUserDTO:function(){return this.model.get("userDTO")},exposedMethods:{submitUserRequest:"addUserRequest",loadTripBags:"loadTripBags",loadTripSeats:"loadTripSeats",clearUser:"clearUser",savePassenger:"savePassenger",saveAllPassenger:"saveAllPassenger",saveUserProfile:"saveUserProfile",saveAllPassengersData:"saveAllPassengersData",updateUserData:"updateUserData",deletePassenger:"deletePassenger",mixUserAndMember:"mixUserAndMember"},execute:function(e,t){return this.exposedMethods[e]&&this.model[this.exposedMethods[e]](t),this}}))},function(e,t,i){"use strict";var n=i(50),a=i(163);e.exports=Odigeo.Model.extend({dataURL:null,action:null,timeout:null,method:null,userDTO:null,userUrls:{register:{dataURL:"register"},registerFullUser:{dataURL:"registerfulluser"},activateAccount:{dataURL:"activateaccount"},login:{dataURL:"login",data:{class:"PasswordUserCredentialsDTO"}},loginWithToken:{dataURL:"login",data:{class:"AutoLoginTokenUserCredentialsDTO"}},loginWithFacebook:{dataURL:"login",data:{class:"FacebookUserCredentialsDTO"}},logInAndUpdateAccount:{dataURL:"loginandupdateaccount"},registerWithFacebook:{dataURL:"login",data:{class:"FacebookUserCredentialsDTO"}},registerWithGoogle:{dataURL:"login",data:{class:"GoogleIdUserCredentialsDTO"}},loginWithGoogle:{dataURL:"login",data:{class:"GoogleIdUserCredentialsDTO"}},isLoggedIn:{dataURL:"isloggedin"},recoverPassword:{dataURL:"recoverpassword"},changePassword:{dataURL:"changepassword"},changePasswordWithCode:{dataURL:"changepasswordwithcode"},changeEmail:{dataURL:"changeemail"},getAccountInfo:{dataURL:"getaccountinfo"},updateAccountInfo:{dataURL:"updateaccountinfo"},cancelAccount:{dataURL:"cancelaccount"},logOut:{dataURL:"logout"},getTagmanInfo:{dataURL:"gettagmaninfo"},getMyTrips:{dataURL:"mytrips",timeout:2e4},removeSession:{dataURL:"mytrips",type:"DELETE"},getCreditCard:{dataURL:"getcreditcardinfo"},addCreditCards:{dataURL:"creditcard",type:"PUT"},deleteCreditCards:{dataURL:"deleteCreditcard",type:"POST"},setLastUsageCreditCards:{dataURL:"creditcard"},isUserRegistered:{dataURL:"isuserregistered"},getTrip:{dataURL:"trip",type:"GET"},getBags:{dataURL:"ancillaries",type:"GET"},getSeats:{dataURL:"ancillaries",type:"GET"},getSearches:{dataURL:"searches",type:"GET"},deleteSearches:{dataURL:"deleteSearches",type:"POST"},addSearch:{dataURL:"searches",type:"PUT"},getEncryptedTrip:{dataURL:"encryptedTrip",type:"GET"},getManageBookingToken:{dataURL:"managebookingtoken",type:"GET"}},loginType:{login:"mail",changePasswordWithCode:"mail",loginWithFacebook:"facebook",registerWithFacebook:"facebook",logInAndUpdateAccount:"facebook",loginWithGoogle:"google",registerWithGoogle:"google"},afterLoadData:Function.prototype,getDataRequestSettings:function(){var e=this._formatRequestData(),t=this.userUrls[this.action]&&this.userUrls[this.action].type?this.userUrls[this.action].type:"POST";return{type:t,timeout:this.timeout?this.timeout:1e4,data:"GET"!==t?"string"==typeof e?e:JSON.stringify(e):"",contentType:"application/json;charset=UTF-8",dataType:"json",cache:!1,success:_.bind(this.requestSuccessHandler,this,this.action),error:_.bind(this.requestErrorHandler,this,this.action)}},_formatRequestData:function(){return _.isNull(this.action)||_.isUndefined(this.userUrls[this.action])?null:this.userUrls[this.action].data?_.extend(this.userUrls[this.action].data,this.get("data")):this.get("data")},addUserRequest:function(e){this.set({data:e&&e.data?e.data:{}}),this.set("isMemberAction",e&&e.isMemberAction,{silent:!0}),e&&e.action&&!_.isEmpty(this.userUrls[e.action])?(this.dataURL=this.userUrls[e.action].dataURL,_.isEmpty(this.get("data").queryParams)||(this.dataURL+="/?"+_.map(this.get("data").queryParams,function(e,t){return t+"="+e}).join("&")),this.isEmptyData=!1,this.action=e.action,this.timeout=this.userUrls[e.action].timeout,this.method=this.userUrls[e.action].method,this.refresh()):e.action},url:function(){return Odigeo.Settings.getProperty("serviceUsersFormatter")(this.dataURL)},requestSuccessHandler:function(e,t){var i=!1,n="WithError",a=_.isObject(t)&&_.isObject(t.attributes)?t.attributes:t;(!0===a||_.isObject(a)&&a.responseOK)&&(a&&!_.isEmpty(a.userDTO)&&(i=a.membership,this.set("userDTO",a.userDTO),this.triggerMembershipEvent("login"===e&&i,"membershipLogInServerConfirmation")),"logOut"===e?(Odigeo.Utils.eraseCookie("sso_remember_me"),Odigeo.Session.set("dontDisplayGoogleOneTap",!0),this.triggerMembershipEvent(this.get("isMemberAction"),"membershipLogoutServerConfirmation")):_.has(this.loginType,e)&&Odigeo.Utils.createCookie("sso_remember_me",encodeURIComponent(this.get("userDTO").email+";"+this._getUserName()+";"+i+";"+this.loginType[e]),30),n="Ok"),this.triggerResponse(e+n,a)},triggerMembershipEvent:function(e,t){return e?this.triggerResponse(t):null},requestErrorHandler:function(e,t){this.triggerResponse(e+"Error",_.extend(t,{action:e}))},triggerResponse:function(e,t){Odigeo.trigger(this.widget.id+":"+e,_.extend(!0===t?{}:t,{action:e}))},clearUser:function(){this.clear(),this.dataURL=null,this.isEmptyData=!0},saveAllData:function(e){_.each(e.passengers,_.bind(function(e){this.savePassenger(e)},this)),this.saveContactDetails(e.contactDetails)},updateUserModel:function(){this.get("userDTO").traveller=_.without(this.get("userDTO").traveller,_.findWhere(this.get("userDTO").traveller,{id:0}))},saveAllPassengersData:function(e){this.updateUserModel(),this.saveAllData(e),this.updateUserData()},mixUserAndMember:function(e){var t;n.isUserDTOMember(e)&&!_.isEqual(Odigeo.Utils.getAppInGlobalScope(),"dp")&&(t=e.membershipInfoDTO.membershipDTO,e.traveller.push($.extend(!0,{},a,{id:0,typeOfTraveller:"ADULT",profile:{title:"MR",name:t.name,firstLastName:t.lastNames}})))},_getDefaultTraveller:function(){var e=this.get("userDTO").traveller;return _.find(e,function(e){return!!e.profile&&e.profile.isDefault})},_updateContactDetails:function(e,t){e.profile.address=t.profile.address,e.profile.prefixPhoneNumber=t.profile.prefixPhoneNumber,e.profile.phoneNumber=t.profile.phoneNumber,e.profile.firstLastName=_.isEmpty(e.profile.firstLastName)?t.profile.firstLastName:e.profile.firstLastName},_getUserName:function(){var e=this._getDefaultTraveller();return _.isUndefined(e)?this.get("userDTO").email.split("@")[0]:e.profile.name},saveContactDetails:function(e){var t;_.isEmpty(this.get("userDTO"))||_.isEmpty(e)||(_.isNumber(e.id)&&-1!==e.id&&0!==e.id?(t=_.find(this.get("userDTO").traveller,{id:e.id}),this._updateContactDetails(t,e)):(t=this._getDefaultTraveller(),_.isObject(t)&&(_.isUndefined(t.id)?this._updateContactDetails(t,e):this.get("userDTO").traveller.push(e))))},savePassenger:function(e){var t,i=e.traveller,n=!!e.saveAfterUpdate&&e.saveAfterUpdate;_.isEmpty(this.get("userDTO"))||_.isEmpty(i)||(_.isNumber(i.id)?(t=_.find(this.get("userDTO").traveller,{id:i.id}),_.extend(t,i)):(i.profile.isDefault=!!_.isEmpty(this.get("userDTO").traveller)||i.profile.isDefault,this.get("userDTO").traveller.push(i))),n&&this.updateUserData()},saveUserProfile:function(e){var t=e.profile,i=e.saveAfterUpdate;_.isEmpty(this.get("userDTO"))||_.isEmpty(t)||(this.get("userDTO").profile=t),i&&this.updateUserData()},updateUserData:function(){this.addUserRequest({data:this.get("userDTO"),action:"updateAccountInfo"})},loadTripAncillaries:function(e,t,i){var n={data:{queryParams:{email:t,bookingid:e}},action:i};this.addUserRequest(n)},loadTripBags:function(e){this.loadTripAncillaries(e.bookingBasicInfo.id,e.buyer.mail,"getBags")},loadTripSeats:function(e){this.loadTripAncillaries(e.bookingBasicInfo.id,e.buyer.mail,"getSeats")},deletePassenger:function(e){!_.isEmpty(this.get("userDTO"))&&e&&e.id&&(this.get("userDTO").traveller=_.without(this.get("userDTO").traveller,_.find(this.get("userDTO").traveller,{id:e.id})),e.saveAfterUpdate&&this.updateUserData())}})},function(e,t,i){"use strict";!function(){window.App=Odigeo.extendNamespace(window.App,"Accommodations");var e=App.Accommodations,t=i(311);function n(e,t,i){return _.reduce(t.aliases,function(n,a,s){return _.each(_.range(t.number[s]),function(r,o){var c="room"+i+a+o+"Age";n[c]=_.isUndefined(e[c])?t.defaultAge[s]:e[c]}),n},{})}function a(e,i){var n,a,s=(n=parseInt(i.code,10),a=-1,_.find(t,function(e,t){return a=t,_.includes(e,n)}),a);return e[s]=_.isUndefined(e[s])?[i]:e[s].concat(i),e}e.searchParamsDefaults={numberOfRooms:1,checkInDate:"",checkOutDate:"",rooms:[{numAdults:2,kidsAges:[],infantsAges:[]}]},e.allocateRooms=function(e){var t,i=App.Flights.validateRooms(e),a=i.length,s=function(e,t,i){0<i&&(e[t]=i)};return{numberOfRooms:a,rooms:_.reduce(_.range(0,a),function(e,a){var r;return r=i[a].split("_"),t={nAdults:+r[0],nKids:+r[1],nInfants:+r[2]},e["roomAdults"+a]=t.nAdults,s(e,"roomKids"+a,t.nKids),s(e,"roomInfants"+a,t.nInfants),_.extend(e,n({},{aliases:["Kid","Infant"],number:[t.nKids,t.nInfants],defaultAge:[6,1]},a)),e},{})}},e.searchParamsParser=function(t){var i=_.clone(e.searchParamsDefaults),n=t.match(/roomAdults[0-3]=/gi),a=n?n.length:0,s=t.match(/checkInDate=(\d{4}-\d{2}-\d{2})($|;)/i),r=t.match(/checkOutDate=(\d{4}-\d{2}-\d{2})($|;)/i),o=t.match(/providerId=(\w{2})($|;)/i),c=t.match(/providerHotelId=(\d{1,12})($|;)/i),d=t.match(/dedupId=(\d{1,12})($|;)/i),l=t.match(/roomsId=(.+?)($|;)/i),g=function(e,i){for(var n=[],a=i.exec(t);!_.isNull(a);)n.push(+a[1]),a=i.exec(t);return n};return i.rooms=_.reduce(_.range(a),function(e,i){var n=new RegExp("roomAdults"+i+"=([1-4])(;|$)","i"),a=t.match(n)[1],s=g(0,new RegExp("room"+i+"Infant[0-1]Age=([0-2])(;|$)","gi")),r=g(0,new RegExp("room"+i+"Kid[0-1]Age=([2-9]|10|11)(;|$)","gi"));return e.concat({numAdults:+a,kidsAges:r,infantsAges:s})},[]),_.isEmpty(i.rooms)&&(i.rooms=_.clone(e.searchParamsDefaults.rooms)),i.numAdults=_.reduce(_.pluck(i.rooms,"numAdults"),_.add,0),i.numberOfRooms=i.rooms.length,i.checkInDate=_.isNull(s)?"":s[1],i.checkOutDate=_.isNull(r)?"":r[1],i.externalSelectionRequest={providerId:_.isNull(o)?"":o[1],providerHotelId:_.isNull(c)?"":c[1],dedupId:_.isNull(d)?"":d[1]},l&&(i.externalSelectionRequest.roomsId=window.decodeURIComponent(l[1])),i},e.searchParamsStringify=function(t){var i,a,s,r,o,c={},d=(i=t,a=c,s=_.pick(i,_.keys({checkInDate:"checkInDate",checkOutDate:"checkOutDate",rooms:"rooms",providerId:"providerId",providerHotelId:"providerHotelId",roomsId:"roomsId",dedupId:"dedupId",newSearchId:"newSearchId"})),r=i.numberOfRooms||0,o=!_.isUndefined(i.providerId)&&!_.isUndefined(i.providerHotelId),_.reduce(s,function(t,i,s){switch(s){case"checkInDate":case"checkOutDate":case"dedupId":case"newSearchId":_.isUndefined(i)||(t[s]=i);break;case"rooms":c=i,i=_.isArray(c)?_.reduce(c,function(e,t,i){var n;return _.isUndefined(t.infantsAges)&&_.isUndefined(t.kidsAges)&&((n=t).infantsAges=[],n.kidsAges=[],_.each(n.childrenAges,function(e){e<2?n.infantsAges.push(e):n.kidsAges.push(e)})),e["roomAdults"+i]=t.numAdults,e["roomInfants"+i]=t.infantsAges.length,e["roomKids"+i]=t.kidsAges.length,_.each(_.range(e["roomInfants"+i]),function(n,a){e["room"+i+"Infant"+a+"Age"]=t.infantsAges[a]}),_.each(_.range(e["roomKids"+i]),function(n,a){e["room"+i+"Kid"+a+"Age"]=t.kidsAges[a]}),e},{}):c,_.each(_.range(r),function(s){var r="roomAdults"+s,o=i[r],c=i["roomInfants"+s],d=i["roomKids"+s];e.updatePassengersNum(a,[o,d,c]),t[r]=o,_.extend(t,n(i,{aliases:["Kid","Infant"],number:[d,c]},s))});break;case"providerId":case"providerHotelId":!_.isUndefined(i)&&o&&(t[s]=i);break;case"roomsId":_.isUndefined(i)||(t[s]=window.encodeURIComponent(i))}var c;return t},{}));return{updatedParamObj:_.extend(t,c),stringifiedParams:_.chain(d).reduce(function(e,t,i){return e+i+"="+t+";"},"").tap(encodeURI).value().slice(0,-1)}},e.updatePassengersNum=function(e,t){var i=_.reduce(t,function(e,t){var i=_.isNaN(+t)?0:+t;return e.concat(i)},[]);e.numAdults=e.numAdults+i[0]||i[0],e.numChildren=e.numChildren+i[1]||i[1],e.numInfants=e.numInfants+i[2]||i[2]},e.getPaxNumBasedOnRooms=function(t,i){var n={};return _.each(_.range(i),function(i){var a=t["roomAdults"+i],s=t["roomKids"+i],r=t["roomInfants"+i];e.updatePassengersNum(n,[a,s,r])}),n},e.convertFacilities=function(e,i){return t=i||t,_.reduce(e,a,{})}}()},function(e,t,i){"use strict";e.exports=[[645,401,652,212,46,123,139,640,639,648,622,624,626,628,646,630,617,455,107,615,417],[321,320,43,455,5,826],[8,422,111,206,507,124,53,158,427,23,508,509,49,46,619,492,44,428,515,245,22,486,91,13,2,127,161,300,504,67,89,78,675,134,52],[660,667,820,249,27,11,601,417,210,204,79,230,232,454,138,821,63,803,103,604,603,55,104,605,651,805,822,10,602,50,54,496,672,200,802,418],[7,72,301,462,464,633,102,478,497,536,305,632,24,471,485,482,159,674,475,311,312,520,473,677,73,223,510,467,3,116,115,241,438,439,516,117,444,133,824,441,135],[224,814,107,615,818,816,670,47,809,453,166,518,220,808,810,819,96,164,163,483,616],[17,140,642,641,649,65,123,75,668,623,535,468,415,625,627,139,640,639,648,622,624,626,628,646,630,617,609,215,461,629,128,129,611,647,631,643,503],[487,423,488,502,472,493,208,211,146,426,77,69,404,465,531,469,235,76,490,62,314,82,19,806,495,12,413,506,491,70,86,306,456,447,97,476,307,501,807,406,407,114,436,233,437,480,130,505,131,100,99,637,610,132,26,90,457,225,87,500,9,440,494,148,219,137,474,61],[30,411,804,499,125,147,645,59,621,513,126,470],[149,530,213,659,650,218,240,534,514,150,523,532,537,528,529,401,644,652,656,212,654,636,815,538,98,98,60,522,525,614,153,154,512,540,539,527,429,511,246,653,317,222,145,430,431,432,433,434,238,658,498,635,4,608,400,214,203,152,526,620,655,151,92,448,452,533,524,155,156,637,613,416],[109,517,823,101,226,420,57,45,813,71,313,88,110,207,811,25,28,239,29,14,80,66,48,142,142,221,606,435,108,16,676,801,167,638,51,141,463,612,64,118,58,15,812,143,477,41,817,157],[662,825,21,309,144,664,56,202,661,663,665,481,634,666],[618,20,607,302,669,671,81,6,303,521,519]]},function(e,t,i){"use strict";!function(){window.App=Odigeo.extendNamespace(window.App,"Dynpack");var e=App.Dynpack,t={roomselection:"DYNPACK_EXPIRED_ROOMSELECTION_POPUP",dpresults:"DYNPACK_EXPIRED_SEARCH_POPUP"};e.getSearchData=function(t,i){return App.Flights.getSearchData(t,i,e.searchParamsParser)},e.searchParamsStringify=function(e,t){var i=App.Accommodations.searchParamsStringify(e),n=[App.Flights.searchParamsStringify(_.extend({},e,i.updatedParamObj),t),i.stringifiedParams],a=0<_(n).compact().size()?";":"";return n.join(a)},e.searchParamsParser=function(e){return $.extend(!0,App.Flights.searchParamsParser(e),App.Accommodations.searchParamsParser(e))},e.convertRequest=function(e){var t,a=_.isObject(e)&&_.has(e,"type")&&e.type,o=a?_.extend({},e,{cabinClass:"TOURIST",directFlightsOnly:!1}):e,c=o;if(a){var d=r(o.searchSegments);c={dynPackSearchRequest:{oneWaySegmentRequest:d.segmentRequests[0],returnSegmentRequest:d.segmentRequests[1],departure:d.departure,destination:d.destination,itineraryDestination:i(d.destination),cabinClass:o.cabinClass,directFlightsOnly:o.directFlightsOnly,resident:o.resident||!1,itinerarySearchMainProductType:"FLIGHT",excludedCarriers:o.airlinesCodes||[],accommodationCheckInDate:o.checkInDate||d.segmentRequests[0].date,accommodationCheckOutDate:o.checkOutDate||d.segmentRequests[1].date,roomRequests:s(o.rooms),externalSelectionRequest:_.extend({},o.externalSelectionRequest,{landingPageType:o.landingPageType})},buyPath:Odigeo.Session.get("upsellBuyPath")||o.buyPath,collectionMethod:o.collectionMethod,forceNewSearch:(t=Odigeo.Session.get("dpForceNewSearch"),Odigeo.Session.remove("dpForceNewSearch"),!_.isNull(t))},c=$.extend(!0,{},App.Flights.convertRequest(o),c,n(o))}return c};var i=function(e){return e&&e.iata?{iata:e.iata}:null},n=function(e){var t=a(e.rooms);return _.isEqual(t,_.pick(e,"numAdults","numChildren","numInfants"))?{}:{itinerarySearchRequest:{numAdults:-1,numChildren:-1,numInfants:-1}}},a=function(e){return _.reduce(e,function(e,t){return App.Accommodations.updatePassengersNum(e,[t.numAdults,t.kidsAges.length,t.infantsAges.length]),e},{})},s=function(e){return _.reduce(e,function(e,t){return t.childrenAges=t.kidsAges.concat(t.infantsAges),e.concat(_.pick(t,"numAdults","childrenAges"))},[])},r=function(e){var t="",i="";return{segmentRequests:_.reduce(e,function(e,n){return t=t||n.departure,i=i||n.destination,e.concat({date:n.dateStr})},[]),departure:t,destination:i}},o=function(t){var i=_.extend({},Odigeo.Utils.parseJson(Odigeo.Session.get("searchParameters")),t),n=["segmentKey0","segmentKey1","fareItineraryKey"];return e.searchParamsStringify(i,_.zipObject(n,n))};e.getBuyPath=function(e){return t[e]||"UNKNOWN"},e.getHomeBuyPath=function(e,t){return e?t?"DYNPACK_HOME_DYNPACK_TAB":"DYNPACK_HOME_FLIGHTS_TAB":t?"FLIGHTS_HOME_DYNPACK_TAB":"FLIGHTS_HOME_FLIGHTS_TAB"},e.getMobileBuyPath=function(){var e=Odigeo.Session.get("mobileBuyPath");return Odigeo.Session.remove("mobileBuyPath"),e||"DYNPACK_DIRECT_URL"},e.setMobileBuyPath=function(){var e=function(){return Odigeo.Utils.isRequestApp("dp")?"DYNPACK_MOBILE_HOME":"DYNPACK_MOBILE_FLIGHTS_TAB"},t={"":e(),home:e(),dpresults:"DYNPACK_MOBILE_RESULTS_CHANGE_SEARCH",dpresults_flights:"DYNPACK_MOBILE_RESULTS_CHANGE_SEARCH",dpresults_accommodation:"DYNPACK_MOBILE_ACCOMMODATION_CHANGE_SEARCH",booking:"DYNPACK_MOBILE_BOOKING_CHANGE_SEARCH"}[Odigeo.History.getPageNameFromFragment()]||"";return Odigeo.Session.set("mobileBuyPath",t),t},e.purgeExpiredSearch=function(e){var t,i,n=Odigeo.Utils.getToday();return!_.isEmpty(e)&&(t=e,0<_.size(t.searchSegments)&&_.isDate(i=Odigeo.Utils.parseDate(t.searchSegments[0].dateStr))&&i.getTime()>=n)?e:null},e.getDeeplinkWithPreselected=function(e){return o(_.pick({dedupId:e.accommodation.dedupId,providerHotelId:e.accommodation.providerHotelId,providerId:e.accommodation.providerId,fareItineraryKey:e.fareItinerary.id,segmentKey0:e.fareItinerary.outboundFlight,segmentKey1:e.fareItinerary.returnFlight,roomsId:e.roomsId},_.identity))},e.getDeeplinkWithoutPreselected=o,e.getPath=function(e){return Odigeo.Utils.templateLiteral("${protocol}//${host}${path}/dp/${pageParams}#${page}/${searchParams}${tabProduct}",{protocol:window.location.protocol,host:window.location.hostname,path:Odigeo.Settings.getProperty("appContext"),pageParams:_.isString(e.pageParams)?"?"+e.pageParams:"",page:e.page||Odigeo.History.getPageNameFromFragment(),searchParams:e.searchParams,tabProduct:_.isString(e.tabProduct)?e.tabProduct:""})},e.getLabelTrackRooms=function(e){return _.reduce(e.rooms,function(e,t,i){return e+"_num:"+(i+1)+"_adu:"+t.numAdults+"_child:"+_.size(t.kidsAges)+"_baby:"+_.size(t.infantsAges)},"rooms:"+e.numberOfRooms)}}()},function(e,t,i){"use strict";!function(){window.App=Odigeo.extendNamespace(window.App,"Flights");var e,t,i=App.Flights,n=window.tv4=window.tv4||Odigeo.require("tv4"),a={PARAMS_PARSER:{class:"cabinClass",direct:"directFlightsOnly",resident:"resident",adults:"numAdults",children:"numChildren",infants:"numInfants",kid0Age:"kid0Age",kid1Age:"kid1Age",kid2Age:"kid2Age",kid3Age:"kid3Age",kid4Age:"kid4Age",kid5Age:"kid5Age",infant0Age:"infant0Age",infant1Age:"infant1Age",infant2Age:"infant2Age",infant3Age:"infant3Age",collectionmethod:"collectionMethod",airlinescodes:"airlinesCodes",fareItineraryKey:"fareItineraryKey",searchId:"searchId",buyPath:"buyPath",internalSearch:"internalSearch",landingPageType:"landingPageType",flexibleDates:"flexibleDates",mainairports:"mainAirportsOnly"},PARAMS_STRINGIFY:{type:"type",searchSegments:"searchSegments",directFlightsOnly:"direct",resident:"resident",cabinClass:"class",numAdults:"adults",numChildren:"children",numInfants:"infants",kid0Age:"kid0Age",kid1Age:"kid1Age",kid2Age:"kid2Age",kid3Age:"kid3Age",kid4Age:"kid4Age",kid5Age:"kid5Age",infant0Age:"infant0Age",infant1Age:"infant1Age",infant2Age:"infant2Age",infant3Age:"infant3Age",collectionMethod:"collectionmethod",airlinesCodes:"airlinescodes",internalSearch:"internalSearch",flexibleDates:"flexibleDates",mainAirportsOnly:"mainairports"},TYPES:{O:"oneWayTrip",R:"roundTrip",M:"multipleTrip"}},s=function(e,t,i){r(i),i.externalSelectionRequest.segmentKeys[e]=t},r=function(e){_.isUndefined(e.externalSelectionRequest.segmentKeys)&&(e.externalSelectionRequest.segmentKeys=[])},o=function(e){return/^(dpresults|dpresults_flights)$/.test(e)};function c(e,t,i){return _.reduce(e,function(e,n,a){return function(e,t,i){var n=d("kid",e),a=d("infant",e);return 0<=n?n<t:0<=a&&a<i}(a,t,i)&&(e[a]=n),e},{})}function d(e,t){var i=(new RegExp("^"+e+"(\\d+)Age$").exec(t)||[])[1];return _.isUndefined(i)?-1:_.parseInt(i)}i.isDpFlightsResults=o,i.searchParamsDefaults={cabinClass:"TOURIST",directFlightsOnly:!1,numAdults:1,numChildren:0,numInfants:0},i.searchParamsAgeSelector={kid0Age:0,kid1Age:0,kid2Age:0,kid3Age:0,kid4Age:0,kid5Age:0,infant0Age:0,infant1Age:0,infant2Age:0,infant3Age:0},i.composeParametrizedDate=function(e,t,i){var n,a,s,r,o,c;return a=(n="dep"===e?new Date:(s=i.split("-"),new Date(s[0],s[1]-1,s[2]))).getDate()+parseInt(t,10),n.setDate(a),o=(r=n).getDate(),c=r.getMonth()+1,r.getFullYear()+"-"+(c<10?"0"+c:c)+"-"+(o<10?"0"+o:o)},i.searchParamsParser=function(e,t){var n,r,o,c=decodeURI(e),d=Odigeo.Utils.parseHashParameters(c),l=_.extend({},a.PARAMS_PARSER,t),g=_.clone(App.Flights.searchParamsDefaults);if(Odigeo.AB.isOfferChildrenAgeDesktop&&(g=_.extend(g,App.Flights.searchParamsAgeSelector)),g.searchSegments=[],g.externalSelectionRequest={},g.multipleDestinationCities=[],n=function(e,t,i,n){var a,s,r={from:"departure",to:"destination",timewindow:"timeWindow",time:"time"};switch(a=g.searchSegments[t]||{},e){case"from":case"to":s=a[r[e]]||{},n?("id"===n&&(n="geoNodeId"),s[n]=i):i.match(/^\d+$/)?s.geoNodeId=i:s.iata=i,a[r[e]]=s;break;case"dep":case"ret":n?a[r[n]]=i:a.dateStr=i}g.searchSegments[t]=a},!_.isUndefined(d.to)&&-1!==d.to.indexOf(",")){var h=d.to.split(",");d.to=h[0],g.multipleDestinationCities=h.slice(1)}switch(g.type=a.TYPES[d.type],_.each(_.omit(d,"type"),function(e,t){var i;switch(t){case"resident":case"direct":case"buyPath":case"landingPageType":case"internalSearch":case"mainairports":switch(e){case"":case"false":i=!1;break;case"true":i=!0;break;default:i=e}g[l[t]]=i;break;case"flexibleDates":g[l[t]]="true"===e;break;case"kid0Age":case"kid1Age":case"kid2Age":case"kid3Age":case"kid4Age":case"kid5Age":case"infant0Age":case"infant1Age":case"infant2Age":case"infant3Age":i=parseInt(e,10),_.isNaN(i)||(g[t]=i);break;case"adults":case"children":case"infants":case"collectionmethod":i=parseInt(e,10),_.isNaN(i)||(g[l[t]]=i);break;case"airlinescodes":switch(e){case"":case"false":break;default:g[l[t]]=e.split(",")}break;case"class":g[l[t]]=e;break;case"segmentKey0":s(0,e,g);break;case"segmentKey1":s(1,e,g);break;case"fareItineraryKey":g.externalSelectionRequest.fareItineraryKey=e}}),r=function(e,t,a){n(e,t,i.composeParametrizedDate(e,a,g.searchSegments[0].dateStr))},g.type){case"oneWayTrip":o=/^(from|to|dep|X)(\d+)?(\.([a-zA-Z]+))?$/,_.each(d,function(e,t){var i=o.exec(t);if(!_.isNull(i))switch(i[1]){case"X":r("dep",0,e);break;default:n(i[1],i[2]||0,e,i[4])}});break;case"multipleTrip":o=/^(from|to|dep)(\d+)?(\.([a-zA-Z]+))?$/,_.each(d,function(e,t){var i=o.exec(t);_.isNull(i)||n(i[1],i[2]||0,e,i[4])});break;case"roundTrip":o=/^(from|to|dep|ret|X|Y)(\.([a-zA-Z]+))?$/,_.each(d,function(e,t){var i=o.exec(t);if(!_.isNull(i))switch(i[1]){case"from":n("from",0,e,i[3]),n("to",1,e,i[3]);break;case"to":n("from",1,e,i[3]),n("to",0,e,i[3]);break;case"dep":n("dep",0,e,i[3]);break;case"ret":n("ret",1,e,i[3]);break;case"X":r("dep",0,e);break;case"Y":r("ret",1,e)}})}return i.addMapiParamsToSearch(g,Odigeo.Utils.decodeParams(window.location.search.substring(1))),g},i.addMapiParamsToSearch=function(e,t){var i=/^(segmentKey)(\d+)?(\.([a-zA-Z]+))?$/;_.isUndefined(t.segmentKey0)||(e.externalSelectionRequest.searchId=t.searchId,e.externalSelectionRequest.fareItineraryKey=t.fareItineraryKey,_.each(t,function(t,n){var a=i.exec(n);_.isNull(a)||s(a[2],t,e)}))},i.completeWithGeographicInformation=function(e){var t,i,n=$.Deferred(),a=[],s=[],r=_.clone(e),o=["dateStr","time","timeWindow"];return t=_.chain(e.searchSegments).map(_.flowRight(_.values,_.partial(_.omit,_,o))).flatten().value(),_.each(t,function(e){_.has(e,"geoNodeId")?s.push(e.geoNodeId):_.has(e,"iata")&&a.push(e.iata)}),_.isEmpty(e.multipleDestinationCities)||(a=a.concat(e.multipleDestinationCities)),a=_.uniq(a),s=_.uniq(s),(i=_.map(a,function(e){return"iatas="+e}).concat(_.map(s,function(e){return"ids="+e})).join(";"))?$.ajax({url:Odigeo.Settings.options.geoServiceUrlFormatter("locations")+";"+i,dataType:"json",method:"GET"}).then(function(t){t.length||n.reject("WRONG_SEARCH");var i=_.map(e.searchSegments,function(e){return _.each(e,function(e,i,r){var c;_.includes(o,i)||(_.includes(a,e.iata)?c=_.find(t,_.matches({iata:e.iata})):_.includes(s,e.geoNodeId)&&(c=_.find(t,_.matches({geoNodeId:parseInt(e.geoNodeId,10)}))),c?e=_.defaults(e,c):n.reject("WRONG_SEARCH")),r[i]=e}),e});r.searchSegments=i,r.multipleDestinationCities=_.map(e.multipleDestinationCities,function(e){if(_.includes(a,e))return _.find(t,_.matches({iata:e}))}),n.resolve(r)},function(e){n.reject("WRONG_SEARCH",e)}):n.resolve(r),n.promise()},i.getPath=function(e){return Odigeo.Utils.templateLiteral("${host}${path}/${flightData}#${page}/${searchParams}",{host:location.hostname,path:Odigeo.Settings.getProperty("appContext"),page:e.page||Odigeo.History.getPageNameFromFragment(),flightData:e.flightData,searchParams:e.searchParams})},i.searchParamsStringify=function(e,t){var n="",a=i.stringifiedURLParams(_.extend({},e,n.updatedParamObj),t);return Odigeo.AB.isOfferChildrenAgeDesktop&&(a+=";"+(n=i.stringifyChildAges(e)).stringifiedParams),a},i.stringifyChildAges=function(e){var t={},n=i.normalizeParamsObject(e,t);return{updatedParamObj:_.extend(e,t),stringifiedParams:_.chain(n).reduce(function(e,t,i){return e+i+"="+t+";"},"").tap(encodeURI).value().slice(0,-1)}},i.normalizeParamsObject=function(e){return c(_.extend({},e.kids,e.infants),e.numChildren,e.numInfants)},i.stringifiedURLParams=function(e,t){var i=_.extend({},a.PARAMS_STRINGIFY,t),n=_.invert(a.TYPES),s=_.pick(e,_.keys(i)),r=1===e.numAdults&&0===e.numChildren&&0===e.numInfants;return _.chain(s).reduce(function(t,a,s){var o;switch(s){case"searchSegments":return t+";"+_.chain(a).map(function(t,i){var n="dep",a="from",s="to",r=".timewindow",o=t.departure.iata||t.departure.geoNodeId,c=t.destination.iata||t.destination.geoNodeId,d=[];return"roundTrip"===e.type&&1===i?(d.push("ret="+t.dateStr),t.time&&d.push("ret.time="+t.time),t.timeWindow&&d.push("ret"+r+"="+t.timeWindow)):("multipleTrip"===e.type&&(n+=String(i),a+=String(i),s+=String(i)),_.isEmpty(e.multipleDestinationCities)||(c=_.reduce(_.map(e.multipleDestinationCities,"iata"),function(e,t){return e+","+t},c)),d.push(n+"="+t.dateStr),d.push(a+"="+o),d.push(s+"="+c),t.time&&d.push(n+".time="+t.time),t.timeWindow&&d.push(n+r+"="+t.timeWindow)),d}).flatten().value().join(";");case"type":o=n[a];break;case"numAdults":case"numChildren":case"numInfants":if(r||0===a)return t;o=String(a);break;default:if(a===App.Flights.searchParamsDefaults[s])return t;o=String(a)||"false"}return t+";"+i[s]+"="+o},"").tap(encodeURI).value().substring(1)},i.completeLocations=function(e,t){var i=_.isObject(e)&&e.multipleDestinationCities?e.multipleDestinationCities.length:0,n=_.isObject(t)&&t.multipleDestinationCities?t.multipleDestinationCities.length:0;return _.isObject(e)&&_.isObject(t)&&e.searchSegments.length===t.searchSegments.length&&_.every(e.searchSegments,function(e,i){var n=t.searchSegments[i];return!(!_.matches(n.departure)(e.departure)||!_.matches(n.destination)(e.destination)||(n.departure=e.departure,n.destination=e.destination,0))})&&i===n&&_.every(e.multipleDestinationCities,function(e,i){var n=t.multipleDestinationCities[i];return _.isObject(n)&&_.matches(n)(e)})},i.getSearchData=function(e,t,n){var a=null,s=null,r=_.isFunction(n)?n:i.searchParamsParser,c=o(t)?App.Dynpack.getMobileBuyPath():"FLIGHTS_DIRECT_URL",d=function(){return Odigeo.Session.set("dpForceNewSearch","true"),c},l=function(t){if(s=Odigeo.Session.get("searchParameters"),!_.isNull(s))try{s=JSON.parse(s)}catch(t){s=null}return _.isEmpty(e)||(a=r(e)),_.isNull(a)?_.isEmpty(s)?$.Deferred().reject("NO_SEARCH"):$.Deferred().resolve(s):t&&i.completeLocations(s,a)?(a.buyPath=a.buyPath||d(),$.Deferred().resolve(a)):!_.isNull(s)&&i.completeLocations(s,a)?(a.buyPath=a.buyPath||s.buyPath,$.Deferred().resolve(a)):(a.buyPath=a.buyPath||d(),i.completeWithGeographicInformation(a))};if(_.isEmpty(e)||-1!==e.toString().indexOf("type=M")||-1!==e.toString().indexOf("from.")||-1!==e.toString().indexOf("from=")||"results"!==t&&"flights"!==t)return l();var g=$.Deferred();return navigator.geolocation&&"desktop"!==Odigeo.SessionScope.flow&&App.Flights.getClosestAirports().done(function(t){var i,n=t,a=n.airports[0]||n.cities[0]||!1;a&&(i=_.extend(_.pick(a,["city","text","geoNodeId","iata","country","countryCode","name","type"])),e+=";from="+i.iata+";")}).done(function(){l(!0).then(function(e){g.resolve(e)},function(){g.reject("NO_SEARCH")})}).fail(function(){if("flights"===t)_.isEmpty(e)||(a=r(e)),a.buyPath=d(),i.completeWithGeographicInformation(a).then(function(e){g.resolve(e)},function(e){g.reject(e)});else{var n,s={},o=[];_.each(e.split(";"),function(e){var t=e.split("=");s[t[0]]=t[1]}),_.has(s,"dep")?n=s.dep:_.has(s,"X")&&(n=i.composeParametrizedDate("dep",s.X),s.dep=n,delete s.X),_.has(s,"Y")&&(s.ret=i.composeParametrizedDate("ret",s.Y,n),delete s.Y),_.each(s,function(e,t){void 0!==e&&(o[o.length]=t+"="+e)}),Odigeo.Router.navigate("home",{replace:!0,params:o.join(";")})}}),g.promise()},i.purgePreviousSearches=function(e){var t;if(e)try{t=JSON.parse(e)}catch(e){t=[]}else t=[];return t=n.validate(t,App.Flights.Schemas.searchDataSchema)?(_.each(t,function(e,i){n.validate(e,App.Flights.Schemas.searchData)||delete t[i]}),_.compact(t)):[]},i.purgeTravellers=function(e){var t;if(e)try{t=JSON.parse(e)}catch(e){t={}}else t={};if(n.validate(t,App.Flights.Schemas.travellersSchema)){for(var i in t)if(t[i])for(var a in t[i])"defaultTraveler"!==i&&("adults"===i?n.validate(t[i][a],App.Flights.Schemas.travellerAdults)||delete t[i][a]:n.validate(t[i][a],App.Flights.Schemas.travellerChildren)||delete t[i][a])}else t={adults:{},children:{},infants:{}};return t},i.onRouteChange=function(e,t){"confirmation"===t.from.name&&t.to.name===e&&Odigeo.UIElements.showSessionExpiredError("alert",!0)},i.checkCookies=function(){if(!Odigeo.Device.navigator.hasCookies){var e={text:Odigeo.UIElements.translations.errCookies.button,style:"od-ui-dialog-button-default",handler:function(){window.location.reload()}},t=Odigeo.UIElements.createDialog({headerText:Odigeo.UIElements.translations.errCookies.text,content:Odigeo.UIElements.translations.errCookies.content,buttons:[e],dialogClasses:"dialog_error"});Odigeo.UIElements.showDialog(t)}return Odigeo.Device.navigator.hasCookies},i.roomSetUpMap={"1-0-0":["1_0_0"],"1-0-1":["1_0_1"],"1-0-2":["1_0_2"],"1-1-0":["1_1_0"],"1-1-1":["1_1_1"],"1-2-0":["1_2_0"],"2-0-0":["2_0_0"],"2-0-1":["2_0_1"],"2-0-2":["2_0_2"],"2-1-0":["2_1_0"],"2-1-1":["2_1_1"],"2-1-2":["1_0_2","1_1_0"],"2-2-0":["2_2_0"],"2-2-1":["1_1_0","1_1_1"],"2-2-2":["1_2_0","1_0_2"],"2-3-0":["1_2_0","1_1_0"],"2-3-1":["1_2_0","1_1_1"],"2-4-0":["1_2_0","1_2_0"],"3-0-0":["3_0_0"],"3-0-1":["3_0_1"],"3-0-2":["2_0_2","1_0_0"],"3-1-0":["2_0_0","1_1_0"],"3-1-1":["2_0_1","1_1_0"],"3-1-2":["2_1_1","1_0_1"],"3-2-0":["2_1_0","1_1_0"],"3-2-1":["2_1_0","1_1_1"],"3-2-2":["2_1_1","1_1_1"],"3-2-3":["1_0_1","1_1_1","1_1_1"],"3-3-0":["2_2_0","1_1_0"],"3-3-1":["2_2_0","1_1_1"],"3-3-2":["1_1_1","1_1_1","1_1_0"],"3-4-0":["2_2_0","1_2_0"],"3-4-1":["1_2_0","1_2_0","1_0_1"],"3-4-2":["1_2_0","1_2_0","1_0_2"],"3-5-0":["1_2_0","1_2_0","1_1_0"],"3-5-1":["1_2_0","1_2_0","1_1_1"],"3-6-0":["1_2_0","1_2_0","1_2_0"],"4-0-0":["2_0_0","2_0_0"],"4-0-1":["2_0_0","2_0_1"],"4-0-2":["2_0_1","2_0_1"],"4-1-0":["2_1_0","2_0_0"],"4-1-1":["2_1_0","2_0_1"],"4-1-2":["2_1_1","2_0_1"],"4-2-0":["2_1_0","2_1_0"],"4-2-1":["2_1_0","2_1_1"],"4-2-2":["2_1_1","2_1_1"],"4-3-0":["2_2_0","2_1_0"],"4-3-1":["2_2_0","2_1_1"],"4-3-2":["2_1_0","1_2_0","1_0_2"],"4-4-0":["2_2_0","2_2_0"],"4-4-1":["2_0_1","1_2_0","1_2_0"],"4-5-0":["2_2_0","1_2_0","1_1_0"],"5-0-0":["3_0_0","2_0_0"],"5-0-1":["3_0_0","2_0_1"],"5-0-2":["2_0_1","2_0_1","1_0_0"],"5-1-0":["3_0_0","2_1_0"],"5-1-1":["3_0_0","2_1_1"],"5-1-2":["2_0_1","2_1_1","1_0_0"],"5-2-0":["3_1_0","2_1_0"],"5-2-1":["3_1_0","2_1_1"],"5-2-2":["2_1_1","2_1_1","1_0_0"],"5-3-0":["3_1_0","2_2_0"],"5-3-1":["2_1_1","2_2_0","1_0_0"],"5-4-0":["2_1_0","2_1_0","1_2_0"],"6-0-0":["2_0_0","2_0_0","2_0_0"],"6-0-1":["2_0_0","2_0_0","2_0_1"],"6-0-2":["2_0_0","2_0_1","2_0_1"],"6-1-0":["2_1_0","2_0_0","2_0_0"],"6-1-1":["2_1_0","2_0_0","2_0_1"],"6-1-2":["2_1_0","2_0_1","2_0_1"],"6-2-0":["2_1_0","2_1_0","2_0_0"],"6-2-1":["2_1_0","2_1_0","2_0_1"],"6-3-0":["2_1_0","2_1_0","2_1_0"],"7-0-0":["3_0_0","2_0_0","2_0_0"],"7-0-1":["3_0_0","2_0_0","2_0_1"],"7-0-2":["3_0_0","2_0_1","2_0_1"],"7-1-0":["3_0_0","2_1_0","2_0_0"],"7-1-1":["3_0_0","2_1_0","2_0_1"],"7-2-0":["3_0_0","2_1_0","2_1_0"],"8-0-0":["2_0_0","2_0_0","2_0_0","2_0_0"],"8-0-1":["2_0_0","2_0_0","2_0_0","2_0_1"],"8-1-0":["2_1_0","2_0_0","2_0_0","2_0_0"],"9-0-0":["3_0_0","3_0_0","3_0_0"]},i.getDPUpsellSearchUrl=function(e,t){var i=Odigeo.SessionScope?Odigeo.SessionScope.dynPackMode:"",n=Odigeo.Session.get("searchParameters"),a=JSON.parse(n),s="",r="true"===Odigeo.SessionScope.dynpackEnabled;if(t)switch(i){case"GO":case"OP":s={landingPageType:"PASSENGER"}}return r?(Odigeo.Session.set("upsellBuyPath",function(e){switch(e){case 5004:return"UPSELL_DYNPACK_EMERGING_LAYER_REDIRECTION";default:return e}}(e)),this.upsellOneFrontDynpackParamsStringify(a)):(a=_.extend(a,{upsellBuyPath:e}),this.dynpackParamsStringify(a)+(_.isEmpty(s)?"":"&"+$.param(s)))},i.validateRooms=function(e){var t,n,a,s=i.roomSetUpMap[e.numAdults+"-"+e.numChildren+"-"+e.numInfants];return _.isUndefined(s)&&2<e.numChildren&&(n=i.roomSetUpMap["1-2-0"],t=i.roomSetUpMap[e.numAdults-1+"-"+(e.numChildren-2)+"-"+e.numInfants],s=_.isUndefined(t)?s:n.concat(t)),_.isUndefined(s)&&2<e.numInfants&&(a=_.isUndefined(n)?[1,0]:[2,2],n=i.roomSetUpMap[a[0]+"-"+a[1]+"-2"],t=i.roomSetUpMap[e.numAdults-a[0]+"-"+(e.numChildren-a[1])+"-"+(e.numInfants-2)],s=_.isUndefined(t)?s:n.concat(t)),s},i.getRoomsParams=function(e){var t=App.Flights.validateRooms(e),i=_.size(t),n="";return _.each(t,function(e,t){n=n.concat("&q-room-").concat(t).concat("-adults=").concat(e.split("_")[0])}),i.toString().concat(n)},i.getDynpackSearchFunction=function(e,t,i){var n=Odigeo.SessionScope?Odigeo.SessionScope.dynPackMode:"";switch(_.isUndefined(t)&&(t=function(){return"#"}),_.isUndefined(i)&&(i=Odigeo.SessionScope?Odigeo.SessionScope.dynPackUrlBase:""),n){case"GO":case"OP":return function(a){var s,r={typ:"flighthotel",idpart:Odigeo.SessionScope.idpart,locked_iata:"",dpdapi:"B",rooms:1,adt0:2,enf0:0,ae01:0,ae02:0,adt1:2,enf1:0,ae11:0,ae12:0,adt2:2,enf2:0,ae21:0,ae22:0,adt3:2,enf3:0,ae31:0,ae32:0};return 2===a.searchSegments.length&&"roundTrip"===a.type?(r=e(a,r,n),s=_.extend(r,{vil_dep:a.searchSegments[0].departure.city,iata_dep:a.searchSegments[0].departure.iata,geo_vil_dep:a.searchSegments[0].departure.geoNodeId,vil_arr:a.searchSegments[0].destination.city,dte_dep:a.searchSegments[0].dateStr,dte_ret:a.searchSegments[1].dateStr,cls:{BUSINESS:"aff",FIRST:"fst",TOURIST:"eco",PREMIUM_ECONOMY:"pre"}[a.cabinClass]||"eco",direct:a.directFlightsOnly?"oui":"non"}),_.has(a,"upsellBuyPath")&&(s=_.extend(s,{buyPath:a.upsellBuyPath})),_.isNull(a.collectionMethod)||(s=_.extend(s,{collectionMethodId:a.collectionMethod})),"OP"===n&&a.checkInDate&&a.checkOutDate&&(s=_.extend(s,{htl_arr:Odigeo.Utils.formatDateFromString(a.checkInDate,"yyyy-mm-dd","dd/mm/yyyy"),htl_dep:Odigeo.Utils.formatDateFromString(a.checkOutDate,"yyyy-mm-dd","dd/mm/yyyy")})),i+"?"+$.param(s)):t};default:return function(a){var s,r={action:"engine/DynPackSearch/search",buyPath:95,auxOrBt:0,searchMainProductTypeName:"DYNPACK",departureTime:"0000",returnTime:"0000",numberOfRooms:1,room0Adults:2,room1Adults:2,room2Adults:2,room3Adults:2,room0Childs:0,room0Child0Age:0,room0Child1Age:0,room1Childs:0,room1Child0Age:0,room1Child1Age:0,room2Childs:0,room2Child0Age:0,room2Child1Age:0,room3Childs:0,room3Child0Age:0,room3Child1Age:0};return 2===a.searchSegments.length&&"roundTrip"===a.type?(r=e(a,r,n),s=_.extend(r,{departureLocation:a.searchSegments[0].departure.name,departureDate:a.searchSegments[0].dateStr.split("-").reverse().join("/"),arrivalLocation:a.searchSegments[0].destination.name,departureLocationGeoNodeId:a.searchSegments[0].departure.geoNodeId,arrivalLocationGeoNodeId:a.searchSegments[0].destination.geoNodeId,returnDate:a.searchSegments[1].dateStr.split("-").reverse().join("/"),filterDirectFlights:a.directFlightsOnly}),_.has(a,"upsellBuyPath")&&(s=_.extend(s,{buyPath:a.upsellBuyPath})),_.isNull(a.collectionMethod)||(s=_.extend(s,{collectionMethodId:a.collectionMethod})),a.checkInDate&&a.checkOutDate&&(s=_.extend(s,{accommodationCheckInDate:Odigeo.Utils.formatDateFromString(a.checkInDate,"yyyy-mm-dd","dd/mm/yyyy"),accommodationCheckOutDate:Odigeo.Utils.formatDateFromString(a.checkOutDate,"yyyy-mm-dd","dd/mm/yyyy")})),i+"?"+$.param(s)):t}}},i.parseDynpackParams=function(e,t,n){var a,s,r,o,c,d=e.rooms,l=e.numberOfRooms;for(t[i.getNumberOfRoomsItem(n)]=l,a=0;a<l;a++){for(o=d["roomKids"+a],c=d["roomInfants"+a],t[i.getRoomConfigItem(!0,a,n)]=d["roomAdults"+a],t[i.getRoomConfigItem(!1,a,n)]=o+c,s=0;s<o;s++)t[i.getRoomChildAge(a,s,n)]=d["room"+a+"Kid"+s+"Age"];for(r=0;r<c;r++)t[i.getRoomChildAge(a,r+s,n)]=d["room"+a+"Infant"+r+"Age"]}return t},i.getRoomConfigItem=function(e,t,i){switch(i){case"GO":case"OP":return(e?"adt":"enf")+t;default:return"room"+t+(e?"Adults":"Childs")}},i.getRoomChildAge=function(e,t,i){switch(i){case"GO":case"OP":return"ae"+(t+1)+e;default:return"room"+e+"Child"+t+"Age"}},i.getNumberOfRoomsItem=function(e){switch(e){case"GO":case"OP":return"rooms";default:return"numberOfRooms"}},i.upsellOneFrontDynpackParamsStringify=function(e){return _.extend(e,App.Accommodations.allocateRooms(e)),App.Dynpack.getPath({page:"dpresults",searchParams:App.Dynpack.searchParamsStringify(e)})},i.dynpackParamsStringify=(t=function(){return"#"},(e=Odigeo.SessionScope?Odigeo.SessionScope.dynPackUrlBase:"")?i.getDynpackSearchFunction(function(e,t,n){var a,s,r,o,c,d,l=i.validateRooms(e),g=l.length;for(t[i.getNumberOfRoomsItem(n)]=g,a=0;a<g;a++){for(o=l[a].split("_"),c=parseInt(o[1],10),d=parseInt(o[2],10),t[i.getRoomConfigItem(!0,a,n)]=parseInt(o[0],10),t[i.getRoomConfigItem(!1,a,n)]=c+d,s=0;s<c;s++)t[i.getRoomChildAge(a,s,n)]=6;for(r=c;r<c+d;r++)t[i.getRoomChildAge(a,r,n)]=1}return t},t,e):t),i.getClosestAirports=function(){return Odigeo.Device.location.get().then(function(e){var t=Odigeo.Settings.property("geoServiceUrlFormatter")("geocomplete")+";latitude="+e.coords.latitude+";longitude="+e.coords.longitude;return $.ajax({url:t})})},i.convertRequest=function(e){var t=[],i=e;if(_.isObject(e)&&_.has(e,"type")){if(t=_.reduce(e.searchSegments,function(e,t){return e.concat({dateStr:t.dateStr,date:t.dateStr,departure:t.departure,destination:t.destination,time:t.time||"0000",timeWindow:t.timeWindow||null})},[]),i={itinerarySearchRequest:{type:e.type,numAdults:e.numAdults,numChildren:e.numChildren,numInfants:e.numInfants,cabinClass:e.cabinClass,mainAirportsOnly:e.mainAirportsOnly||!1,directFlightsOnly:e.directFlightsOnly,resident:e.resident,searchMainProductType:"FLIGHT",airlinesCodes:e.airlinesCodes||[],externalSelectionRequest:e.externalSelectionRequest,dynpackSearch:!1,segmentRequests:t},extraItinerarySearchRequestList:[],buyPath:e.buyPath,collectionMethod:e.collectionMethod},Odigeo.AB.isOfferChildrenAgeDesktop){var n=c(e,6,4);_.extend(i.itinerarySearchRequest,n)}_.isUndefined(e.flexibleDates)||_.isNull(e.flexibleDates)||(i.flexibleDates=e.flexibleDates),_.isEmpty(e.multipleDestinationCities)||(i.extraItinerarySearchRequestList=_.map(e.multipleDestinationCities,function(e){return App.Flights.getExtraItinerary(e,"departureCity",i.itinerarySearchRequest)}),i.multipleOriginDestination=!0)}return i},i.convertXsellAccommodationRequest=function(e){var t=e.data;return{itinerarySearchRequest:{externalSelectionRequest:{fareItineraryKey:t.fareItineraryKey,searchId:t.searchId,segmentKeys:e.flightNumbers,flightNumbers:t.flightNumbers,priceWithoutDiscountSelected:t.priceWithoutDiscountSelected,fareFamilyAmount:t.fareFamilyAmount,truncateAccommodationDates:e.truncateAccommodationDates}}}},i.convertXsellNewSearchAccommodationRequest=function(e){var t,i=e.accommodationDestination||e.searchSegments[0].destination;return{accommodationSearchRequest:{destination:{iata:i.iata,name:i.name,geoNodeId:i.geoNodeId,type:i.type},checkInDate:e.checkInDate||e.searchSegments[0].dateStr,checkOutDate:e.checkOutDate||(t=e.searchSegments,1<t.length?t[1].dateStr:Odigeo.Utils.getNextDay(t[0].dateStr))}}},i.getExtraItinerary=function(e,t,i){var n=jQuery.extend(!0,{},i);return"departureCity"===t&&(n.segmentRequests[0].destination=e,1<i.segmentRequests.length&&(n.segmentRequests[1].departure=e)),n},i.isAnywhereLocation=function(e){return _.isObject(e)&&"INSP"===e.iata&&0===e.geoNodeId},i.hasAnywhereDestination=function(e){return 0<e.length&&i.isAnywhereLocation(e[0].destination)},i.getCollectionMethod=function(){var e=Odigeo.Utils.parseJson(Odigeo.Session.get("searchParameters"));return _.isNull(e)||_.isNaN(+e.collectionMethod)?0:+e.collectionMethod}}()},function(e,t,i){"use strict";var n;(n=((window.App=window.App||{}).Flights=window.App.Flights=window.App.Flights||{}).Schemas=window.App.Flights.Schemas=window.App.Flights.Schemas||{}).searchDataSchema={$schema:"http://json-schema.org/draft-04/schema#",id:"http://www.odigeo.com/schemas/searchData#",type:"array",title:"root",description:"Search Data object",minItems:0,uniqueItems:!0,additionalProperties:!1,items:{},required:["http://www.odigeo.com/schemas/searchData"]},n.searchData={$schema:"http://json-schema.org/draft-04/schema#",id:"http://www.odigeo.com/schemas/searchData/search#",type:"object",additionalProperties:!0,properties:{searchId:{type:"integer"},collectionMethod:{type:"integer"},cabinClass:{enum:["BUSINESS","FIRST","TOURIST","PREMIUM_ECONOMY","ECONOMIC_DISCOUNTED","SHOW_ALL"]},directFlightsOnly:{type:"boolean"},numAdults:{type:"integer",minimum:1,maximum:9},numChildren:{type:"integer",minimum:0,maximum:5},numInfants:{type:"integer",minimum:0,maximum:3},cheapestItineraryPrice:{type:"number"},cheapestItineraryPriceTimestamp:{type:"integer"},resident:{type:"boolean"},type:{enum:["oneWayTrip","roundTrip","multipleTrip"]},internalSearch:{type:"boolean"},flexibleDates:{type:"boolean"},creationDate:{type:"integer"},kid0Age:{type:"integer"},kid1Age:{type:"integer"},kid2Age:{type:"integer"},kid3Age:{type:"integer"},kid4Age:{type:"integer"},kid5Age:{type:"integer"},infant0Age:{type:"integer"},infant1Age:{type:"integer"},infant2Age:{type:"integer"},infant3Age:{type:"integer"},fromUserAccount:{type:"boolean"},searchSegments:{id:"http://www.odigeo.com/schemas/searchData/searchSegments#",type:"array",minItems:1,uniqueItems:!0,additionalProperties:!1,items:{id:"http://www.odigeo.com/schemas/searchData/searchSegments/segment#",type:"object",title:"Segment",description:"Segment of a trip",additionalProperties:!1,properties:{dateStr:{type:"string",pattern:"^(19[0-9]{2}|2[0-9]{3})-(0[1-9]|1[012])-([123]0|[012][1-9]|31)$"},departure:{type:"object",additionalProperties:!0,properties:{city:{type:"string"},iata:{type:"string"},name:{type:"string"},geoNodeId:{type:"integer"},country:{type:"string"},countryCode:{type:"string"},text:{type:"string"},type:{enum:["AIRPORT","IATA_CODE","CITY","BUS_STATION","TRAIN_STATION","COUNTRY"]}},required:["city","iata","name","geoNodeId"]},destination:{type:"object",additionalProperties:!0,properties:{city:{type:"string"},iata:{type:"string"},name:{type:"string"},geoNodeId:{type:"integer"},country:{type:"string"},countryCode:{type:"string"},text:{type:"string"},type:{enum:["AIRPORT","IATA_CODE","CITY","BUS_STATION","TRAIN_STATION","COUNTRY"]}},required:["city","iata","name","geoNodeId"]}},required:["dateStr","departure","destination"]},required:["http://www.odigeo.com/schemas/searchData/searchSegments/segment"]},externalSelectionRequest:{type:"object",additionalProperties:!0,properties:{fareItineraryKey:{type:"string"},segmentKeys:{id:"http://www.odigeo.com/schemas/searchData/segmentKey#",type:"array",minItems:1,additionalProperties:!1,items:{id:"http://www.odigeo.com/schemas/searchData/segmentKey/string#",type:"string"}},searchId:{type:"string"}}},multipleDestinationCities:{minItems:0,maxItems:3,uniqueItems:!0,type:"array",additionalProperties:!1,items:{type:"object",additionalProperties:!0,properties:{city:{type:"string"},iata:{type:"string"},name:{type:"string"},geoNodeId:{type:"integer"},country:{type:"string"},countryCode:{type:"string"},text:{type:"string"},type:{enum:["AIRPORT","IATA_CODE","CITY","BUS_STATION","TRAIN_STATION"]}}}}},required:["cabinClass","directFlightsOnly","numAdults","numChildren","numInfants","searchSegments","type"]},n.travellersSchema={$schema:"http://json-schema.org/draft-04/schema#",id:"http://www.odigeo.com/schemas/travellers#",type:"object",additionalProperties:!0,properties:{adults:{type:"object",items:{}},children:{type:"object",items:{}},infants:{type:"object",items:{}},defaultTraveler:{anyOf:[{type:"null"},{type:"object"}]}},required:["adults","children","infants"]},n.travellerAdults={$schema:"http://json-schema.org/draft-04/schema#",id:"http://www.odigeo.com/schemas/travellers/adult",type:"object",additionalProperties:!0,properties:{travellerType:{enum:["ADULT"]},travellerTitle:{enum:["MR","MRS","MS"]},name:{type:"string"},firstLastName:{type:"string"},lastName:{type:"string"},mail:{type:"string"},country:{type:"string"},phoneCode1:{type:"string"},phoneNumber1:{type:"string"},address:{type:"string"},cityName:{type:"string"},zipCode:{type:"string"},meal:{type:"string"},localityCodeOfResidence:{type:"string"},localityNameOfResidence:{type:"string"},identificationType:{enum:["PASSPORT","NIE","NIF","CIF","NATIONAL_ID_CARD","BIRTH_DATE"]},identification:{type:"string"},documents:{id:"http://www.odigeo.com/schemas/travellers/identification",minItem:1,uniqueItems:!0,type:"array",additionalProperties:!1,items:{id:"http://www.odigeo.com/schemas/travellers/identification/document#",type:"object",additionalProperties:!1,properties:{identificationType:{enum:["PASSPORT","NIE","NIF","CIF","NATIONAL_ID_CARD","BIRTH_DATE"]},identification:{type:"string"}},required:["identificationType","identification"]},required:["http://www.odigeo.com/schemas/travellers/identification/document"]},frequentFlyerCardCodes:{id:"http://www.odigeo.com/schemas/travellers/frequentFlyerCardCodes#",minItem:0,uniqueItems:!0,type:"array",additionalProperties:!1,items:{type:"object",additionalProperties:!1,properties:{carrierCode:{type:"string"},passengerCardNumber:{type:"string"}},required:["carrierCode","passengerCardNumber"]},required:["http://www.odigeo.com/schemas/travellers/frequentFlyerCardCodes#"]}},required:["travellerType","travellerTitle","name","firstLastName"]},n.travellerChildren={$schema:"http://json-schema.org/draft-04/schema#",id:"http://www.odigeo.com/schemas/travellers/children",type:"object",additionalProperties:!0,properties:{travellerType:{enum:["CHILD","INFANT"]},travellerTitle:{enum:["MR","MRS","MS"]},name:{type:"string"},firstLastName:{type:"string"},dateOfBirth:{type:"string",pattern:"^(19[0-9]{2}|2[0-9]{3})-(0[1-9]|1[012])-([123]0|[012][1-9]|31)$"}},required:["travellerType","travellerTitle","name","firstLastName","dateOfBirth"]}},function(e,t,i){"use strict";e.exports=Backbone.Model.extend({connectorsInitialized:!1,actualConnector:null,firstLogin:!1,logged:!1,loggedOnHttps:!1,isLegacyUser:!1,isBlockedUser:!1,isMembership:!1,isDynpack:Odigeo.Utils.isRequestApp("dp"),membershipDisplayName:"",activeUrl:"",trackCategory:"",recaptchaLoginWidgetID:null,recaptchaPassRecoveryWidgetID:null,recaptchaWidgetID:{},recaptchaRendered:{},requestData:{},loginType:null,socialToken:null,action:null,models:{user:{},login:{password:""}},loginActions:{password:"login",facebook:"loginWithFacebook",google:"loginWithGoogle"},defaults:{recaptchaLogin:!1,recaptchaPassRecovery:!1},errors:{STA_003:"notverifiedaccount",STA_011:"notverifiedaccount",STA_009:"accountBlocked",STA_000:"accountBlocked",STA_002:"legacyUser",FND_000:"emailError",FND_001:"emailError",AUTH_000:"loginError",VAL_000:"empty",VAL_002:"invalid",VAL_003:"invalid",VAL_024:"invalid",VAL_052:"remoteError",STA_006:"socialErrorFacebook",STA_007:"socialErrorGoogle",STA_008:"socialError",AUTH_002:"permissions",AUTH_005:"authErrorFacebook",AUTH_006:"authErrorGoogle",AUTH_008:"socialPass",AUTH_010:"tokenError",AUTH_100:"remoteError",AUTH_101:"remoteError",VAL_028:"format",VAL_008:"tokenError",FB:"tokenError",RCP_001:"recaptchaError",STO_000:"remoteError",UNL_007:"velocityRules",facebook:"tokenErrorFacebook",google:"tokenErrorGoogle",default:"requestError"},trackErrors:{permisions:"sso_email_authentication_facebook_error",default:"sso_email_already_used_facebook_error"},libs:{auth2:null}})},function(e,t,i){"use strict";var n=i(39),a=i(81),s=i(0),r=i(93),o={facebook:i(164),google:i(165)},c=i(13),d=i(18),l="navigateToMyTrips",g=function(e){var t=e?"A":"B";s.trackEventWithCategory("my_area_trips_details","access_my_trips_details","access_my_trips_successful_"+t)},h=function(e,t){var i=(t?"":"not_")+"logged";s.trackEventWithCategory(e+"_confirmation_page_confirmed","next_steps","my_trips_clicks_"+i)},u=function(e,t){("recaptchaLogin"!==e?Odigeo.AB.isRecaptchaEnabled:Odigeo.AB.isRecaptchaLoginEnabled)&&n.isGRecaptchaLoaded&&!this.model.get(e)&&(this.model.recaptchaWidgetID[e]=n.gRecaptchaRender(this.$el.find(this.selectors[e]).get(0),_.bind(this.recaptchaExecutionCallback,this,e,t),Odigeo.UserArea.recaptchaSiteKey),this.model.set(e,!0))};e.exports=d(c.extend({name:"login",initialize:function(){this.model.trackCategory="my-trips-login-form"===this.id?"sso_sign_in_trips":"sso_module",r.init(_.bind(this._login,this),_.bind(this._showSocialLoginError,this),this.id,this.$el.find(this.selectors.socialLoginContainer).data("pattern")),!Odigeo.AB.isRecaptchaEnabled&&!Odigeo.AB.isRecaptchaLoginEnabled||n.isGRecaptchaLoaded||n.init(),this.$el.find(this.selectors.loginUserWithFacebook).html(this.getSocialLoginButtonTemplate("facebook")),this.$el.find(this.selectors.loginUserWithGoogle).html(this.getSocialLoginButtonTemplate("google")),this.checkLogged()},selectors:{createUserButton:".create_user_button",socialLogginError:".social_login_error",modalView:".modal_view",userLogin:".user_login",closeLogin:".close_login",recoverPassword:".recover_password",forgotPassword:".forgot_password",backToLogin:".back_to_login",emailRecoverPasswordInput:".email_recover_password_input",recoverPasswordButton:".recover_password_button",recoverPasswordEmail:".recover_password_email",userEmail:".user_email",recoverPasswordForm:".recover_password_form",recoverPasswordWaiting:".recover_password_waiting",recoverPasswordInformation:".recover_password_information",loginSubmit:".login_button",loginUserWithPassword:".loginUserWithPassword",emailInput:".email_input",passwordInput:".password_input",passwordIcon:".password_icon",loginNameIcon:".login_name_icon",loginWaiting:".login_waiting",loginSuccess:".login_success",loginConnectors:".login_connectors",loginConnectorsClose:".login_connectors_close",registerFooter:".register_footer",headerDialog:".header_dialog",loginFacebookButton:".login_facebook_button",loginGoogleButton:".login_google_button",loginFacebookError:".login_facebook_error",loginGoogleError:".login_google_error",loginSocialError:".login_social_error",socialError:".social_error",socialLoginContainer:".social_login_container",emailLoginContainer:".email_login_container",emails:'input[data-name="email"]',recaptchaLogin:".g_recaptcha_login",recaptchaPassRecovery:".g_recaptcha_pass_recovery",loginError:".login_error",passRecoveryError:".pass_recovery_error",modalArtifacts:".modal_artifact",loginUserSocial:".login_user_social",loginUserWithFacebook:".login_user_with_facebook",loginUserWithGoogle:".login_user_with_google"},events:{"tap .login_connectors_close":"closeConnectorsLayer","tap .close_login":"closeConnectorsLayer","input .password_input":"showPasswordCharsIcon","tap .password_icon":"changePasswordCharsViewer","tap .modal_view":"closeConnectorsLayer","tap .forgot_password":"openRecoverPasswordForm","tap .back_to_login":"onBackToLogin","tap .recover_password_button":"recoverPassword","tap .login_button":"onLoginSubmit","keyup .user_login":"keyPressed","tap .register_footer":"openRegisterForm","tap .login_facebook_button":"onLoginFacebook","tap .login_google_button":"onLoginGoogle"},getSocialLoginButtonTemplate:function(e){return _.template(o[e],Odigeo.Utils.getTmplSettings({variable:"data"}))({keys:this.keys})},_tracktCustomVar:function(e){Odigeo.trigger("analytics:tracking",{type:"trackCustomVariable",data:{index:50,name:"SSO",value:"SSO_"+(e?"1":"0"),scope:2,customDimension:15}})},openRegisterForm:function(){s.trackEventWithCategory(this.model.trackCategory,"sign_in","go_to_register"),Odigeo.trigger(this.id+":openRegister")},keyPressed:function(e){13===(e.keyCode?e.keyCode:e.which)&&this.loginWithPassword()},_trackError:function(e){var t="email"===e.index?"sso_email_incorrect_format_error":"sso_pwd_pci_compliance_error";s.trackEventWithCategory(this.model.trackCategory,"sign_in",t)},_addHiddenInput:function(e,t){this.$el.find(this.selectors.loginUserWithPassword).append($("<input />").attr("type","hidden").attr("name",e).attr("value",t))},loginError:function(e){return Odigeo.AB.isRecaptchaLoginEnabled&&n.gRecaptchaReset(this.model.recaptchaWidgetID.recaptchaLogin),_.startsWith(e&&e.messageError,"UNL")?this.dealWithUnlError():this.dealWithSsoError(e)},dealWithUnlError:function(){var e=Odigeo.UIElements.translations.unl.lightboxTextsVelocityRules;Odigeo.UIElements.showLightboxWarning("od-passenger-lightbox-logout",_.bind(this.removeAllLayers,this),_.bind(this.removeAllLayers,this),_.extend({},e,{description:e.description}))},removeAllLayers:function(){Odigeo.trigger("closeAllPopUps"),this.$el.find(this.selectors.loginWaiting).addClass("hidden"),this.closeConnectorsLayer()},dealWithSsoError:function(e){var t=this.model.errors[e&&e.messageError]||"requestError",i=Odigeo.Session.get("loginRequested");"loginError"!==t||i!==r.socialLoginType.facebook&&i!==r.socialLoginType.google||(t=this.model.errors.AUTH_010);var n=_.includes(["notverifiedaccount","legacyUser","emailError","socialError","socialErrorFacebook","socialErrorGoogle"],t)?this.$el.find(this.selectors).emailInput:this.$el.find(this.selectors.passwordInput),o=this.options.lastLoginEmailUsed||this.$el.find(this.selectors.emailInput).val(),c=_.includes(["permissions","authErrorFacebook","authErrorGoogle","format","tokenError","tokenErrorFacebook","tokenErrorGoogle"],t)||"requestError"===t&&-1<e.action.toLowerCase().indexOf("facebook");if("legacyUser"===t&&!_.isEmpty(o)&&0<o.length&&(this.model.isLegacyUser=!0),this.showModalLoginForm(),-1!==t.indexOf("recaptcha"))this.showGenericError(this.$el.find(this.selectors.loginError),"recaptchaerror"),this.trackRecaptchaError("odigeo_recaptcha_error_sign-on");else if("remoteError"===t)this.showGenericError(this.$el.find(this.selectors.loginError),"remoteerror");else if(c){var d=Odigeo.Session.get("loginRequested");-1!==t.indexOf("Error")&&(t="error"),s.trackEventWithCategory(this.model.trackCategory,"sign_in","sso_email_authentication_"+d+"_error"),this._showSocialLoginError(t,d)}else a.showError(n.data(t),n.closest(".input_wrapper")),s.trackEventWithCategory(this.model.trackCategory,"sign_in",this._findLabelTracking(t))},showGenericError:function(e,t){var i=e.data(t);e.find(".msg_content").text(i),e.removeClass("odf-hidden")},hideGenericError:function(){this.$el.find(this.selectors.loginError).addClass("odf-hidden"),this.$el.find(this.selectors.passRecoveryError).addClass("odf-hidden")},trackRecaptchaError:function(e){s.trackEventWithCategory(Odigeo.Utils.isHomePage()?"home":Odigeo.History.getPageNameFromFragment(),"recaptcha_error",e)},_findLabelTracking:function(e){switch(e){case"legacyUser":return"sso_legacy_login_error";case"invalid":return"sso_pwd_pci_compliance_error";case"socialErrorFacebook":return"sso_email_already_used_facebook_error";case"socialErrorGoogle":return"sso_email_already_used_google_error";case"socialError":return"sso_email_already_used_social_error";default:return"sso_wrong_signin_credentials_error"}},requestRecoverPasswordError:function(e){var t=e.messageError&&this.model.errors[e.messageError]||"";Odigeo.AB.isRecaptchaEnabled&&n.gRecaptchaReset(this.model.recaptchaWidgetID.recaptchaPassRecovery),this.$el.find(this.selectors.recoverPasswordWaiting).addClass("hidden"),this.$el.find(this.selectors.recoverPassword).removeClass("hidden"),-1!==t.indexOf("recaptcha")?(this.showGenericError(this.$el.find(this.selectors.passRecoveryError),"recaptchaerror"),this.trackRecaptchaError("odigeo_recaptcha_error_forgot-pass")):"remoteError"===t?this.showGenericError(this.$el.find(this.selectors.passRecoveryError),"remoteerror"):(a.showError(this.$el.find(this.selectors.emailRecoverPasswordInput).data("requestError"),this.$el.find(this.selectors.recoverPasswordEmail)),s.trackEventWithCategory(this.model.trackCategory,"sign_in","sso_request_error"))},isAccountBlocked:function(e){if("accountBlocked"!==this.model.errors[e&&e.messageError])return!1;this.model.set("isBlockedUser",!0);var t=this.$el.find(this.selectors.emailInput).val();return this.$el.find(this.selectors.loginWaiting).addClass("hidden"),Odigeo.Session.set("loginDetails",t),Odigeo.Router.navigate("accountblocked"),!0},openLoginForm:function(){this.$el.find(this.selectors.passwordInput).val(""),this.$el.find(this.selectors.recoverPassword).addClass("hidden"),this.$el.find(this.selectors.userLogin).removeClass("hidden"),this.$el.find(this.selectors.recoverPasswordForm).removeClass("hidden"),this.$el.find(this.selectors.recoverPasswordWaiting).addClass("hidden"),this.$el.find(this.selectors.recoverPasswordInformation).addClass("hidden"),this.$el.find(this.selectors.emailInput).focus(),u.call(this,"recaptchaLogin",this.resumeLoginSubmitRequest)},renderCaptcha:function(e){e?u.call(this,"recaptchaLogin",this.resumeLoginSubmitRequest):u.call(this,"recaptchaPassRecovery",this.resumeRecoverPasswordSubmitRequest)},recaptchaExecutionCallback:function(e,t){this.model.requestData.recaptchaResponse=n.gRecaptchaGetResponse(this.model.recaptchaWidgetID[e]),t.call(this),Odigeo.Session.set("loginRequested",!0)},loginWithPassword:function(){var e,t=void 0,i=this.$el.find(this.selectors.loginUserWithPassword).find('[data-name]:not([type="hidden"])');a.clearErrors(i,this.$el.find(this.selectors.socialError)),e=a.checkValidity(i,this.$el),Odigeo.Session.set("loginWidget",this.id),_.each(e,function(e){this._trackError(e)},this),!1===this.model.logged&&_.isEmpty(e)&&(t={login:this.$el.find(this.selectors.emailInput).val(),password:this.$el.find(this.selectors.passwordInput).val(),loginType:"password"},this._login(t))},openRecoverPasswordForm:function(){s.trackEventWithCategory(this.model.trackCategory,"sign_in","forgot_password_clicks"),this.$el.find(this.selectors.userLogin).addClass("hidden"),this.$el.find(this.selectors.recoverPassword).removeClass("hidden"),this.$el.find(this.selectors.recoverPasswordEmail).removeClass("invalid invalid-long"),this.$el.find(this.selectors.emailRecoverPasswordInput).val(this.$el.find(this.selectors.emailInput).val()).focus(),u.call(this,"recaptchaPassRecovery",this.resumeRecoverPasswordSubmitRequest)},recoverPassword:function(){this.hideGenericError();var e=this.$el.find(this.selectors.emailRecoverPasswordInput).val();if(this.$el.find(this.selectors.recoverPasswordEmail).removeClass("invalid invalid-long"),this.$el.find(this.selectors.recoverPasswordEmail).find(".error_long_message").text(""),this.$el.find(this.selectors.recoverPasswordEmail).find(".error_message").text(""),Odigeo.Session.set("loginWidget",this.id),Odigeo.Utils.isValidEmail(e))Odigeo.AB.isRecaptchaEnabled?n.gRecaptchaExecute(this.model.recaptchaWidgetID.recaptchaPassRecovery):this.resumeRecoverPasswordSubmitRequest();else{s.trackEventWithCategory(this.model.trackCategory,"password_recovery","sso_email_incorrect_format_error");var t=this.$el.find(this.selectors.emailRecoverPasswordInput).data(""===e?"empty":"invalid"),i=a.errorLenghtOverMax(t);this.$el.find(this.selectors.recoverPasswordEmail).addClass(i?"invalid-long":"invalid"),this.$el.find(this.selectors.recoverPasswordEmail).find(i?".error_long_message":".error_message").text(t)}},goToMyTrips:function(){var e=this.model.logged;e?(Odigeo.trigger(this.id+":"+l),g(e)):this.openModalLogin(),h("flights",e)},fromDeepLinkToDetails:function(e){var t=this.model.logged,i=t?l:"navigateToTripDetails";g(t),h(e,t),Odigeo.trigger(this.id+":"+i)},resumeRecoverPasswordSubmitRequest:function(){var e=this.model.get("isBlockedUser")?this.model.requestData.login:this.$el.find(this.selectors.emailRecoverPasswordInput).val();_.each(this.$el.find(this.selectors.userEmail),function(t){t.innerHTML=e}),this.$el.find(this.selectors.recoverPasswordWaiting).removeClass("hidden"),this.model.requestData.email=e,this.model.action="recoverPassword",s.trackEventWithCategory(this.model.trackCategory,"password_recovery","send_instructions"),this.options.noModalDialogs||this.$el.find(this.selectors.recoverPassword).addClass("hidden"),this.model.isLegacyUser=!1,this.triggerSubmitRequest()},recoverPasswordSuccess:function(){Odigeo.Session.remove("loginRequested"),Odigeo.AB.isRecaptchaEnabled&&n.gRecaptchaReset(this.model.recaptchaWidgetID.recaptchaPassRecovery),s.trackEventWithCategory(this.model.trackCategory,"password_recovery_email","pwd_recovery_email_sent"),this.$el.find(this.selectors.recoverPasswordWaiting).addClass("hidden"),this.$el.find(this.selectors.recoverPasswordForm).addClass("hidden"),this.$el.find(this.selectors.recoverPasswordInformation).removeClass("hidden"),this.$el.find(this.selectors.recoverPassword).removeClass("hidden"),this.model.get("isBlockedUser")&&Odigeo.Router.navigate("accountblocked")},recoverPasswordError:function(e){Odigeo.Session.remove("loginRequested"),Odigeo.AB.isRecaptchaEnabled&&n.gRecaptchaReset(this.model.recaptchaWidgetID.recaptchaPassRecovery);var t=e.messageError&&this.model.errors[e.messageError],i=this.$el.find(this.selectors.emailRecoverPasswordInput).data(t?this.model.errors[e.messageError]:"notverifiedaccount");this.$el.find(this.selectors.recoverPasswordWaiting).addClass("hidden"),this.$el.find(this.selectors.recoverPasswordForm).removeClass("hidden"),this.$el.find(this.selectors.recoverPassword).removeClass("hidden"),a.clearErrors(this.$el.find(this.selectors.loginUserWithPassword).find('[data-name]:not([type="hidden"])')),_.isUndefined(t)||-1===t.indexOf("recaptcha")?"remoteError"===t?this.showGenericError(this.$el.find(this.selectors.passRecoveryError),"remoteerror"):(this.$el.find(this.selectors.recoverPasswordEmail).addClass("invalid"),this.showErrorNoTrack(i,this.$el.find(this.selectors.emailRecoverPasswordInput).closest(".input_wrapper"))):(this.showGenericError(this.$el.find(this.selectors.passRecoveryError),"recaptchaerror"),this.trackRecaptchaError("odigeo_recaptcha_error_forgot-pass"))},showSocialErrorNoTrack:function(e,t){var i=a.errorLenghtOverMax(e);this.$el.find(this.selectors.loginSocialError).find(i?".error_long_message":".error_message").text(e),this.$el.find(this.selectors.loginSocialError).addClass("invalid"),t.addClass("invalid")},showErrorNoTrack:function(e,t){var i=a.errorLenghtOverMax(e);t.find(i?".error_long_message":".error_message").text(e),t.addClass(i?"invalid invalid-long":"invalid")},showModalLoginForm:function(){Odigeo.trigger("closeAllPopUps"),a.clearErrors(this.$el.find(this.selectors.loginUserWithPassword).find('[data-name]:not([type="hidden"])'),this.$el.find(this.selectors.socialError)),this.openLoginForm(),this.options.noModalDialogs||this.$el.find(this.selectors.modalView).addClass("active"),this.$el.find(this.selectors.loginSuccess).addClass("hidden"),this.$el.find(this.selectors.loginWaiting).addClass("hidden"),this.$el.find(this.selectors.loginConnectors).addClass("opened"),this.$el.find(this.selectors.emailInput).focus()},closeConnectorsLayer:function(){this.$el.find(this.selectors.passwordInput).val(""),this.$el.find(this.selectors.loginConnectors).removeClass("opened"),this.$el.find(this.selectors.modalView).removeClass("active")},changePasswordCharsViewer:function(){this.$el.find(this.selectors.passwordIcon).find(".password_char_viewer").toggleClass("odf-hidden"),this.$el.find(this.selectors.passwordInput).attr("type","password"===this.$el.find(this.selectors.passwordInput).attr("type")?"text":"password")},showPasswordCharsIcon:function(e){this.$el.find(this.selectors.passwordIcon).removeClass("odf-hidden"),$(e.target).off()},loginWithFacebookOk:function(e){this.hideUserLogin(),r.addTravellerToAccount(e,this.id),this._anyLoginOk(e,"sso_successful_login_facebook")},loginWithGoogleOk:function(e){this.hideUserLogin(),r.addTravellerToAccount(e,this.id),this._anyLoginOk(e,"sso_successful_login_google")},loginOk:function(e){this._anyLoginOk(e,"sso_successful_login_odigeo")},loginWithError:function(e){this.model.logged=!1,this.model.models.user=null,this.isAccountBlocked(e)?this.closeConnectorsLayer():(this.loginError(e),Odigeo.trigger(this.id+":userNotLogged")),Odigeo.Session.remove("loginRequested")},successfullLogin:function(e){this.showModalLoginForm(),this.$el.find(this.selectors.loginUserWithPassword).addClass("hidden"),this.$el.find(this.selectors.headerDialog).addClass("hidden"),this.loginOk(e)},_anyLoginOk:function(e,t,i){Odigeo.AB.isRecaptchaLoginEnabled&&n.gRecaptchaReset(this.model.recaptchaWidgetID.recaptchaLogin),this.model.loggedOnHttps=!0,this.setEmailValues(e);var a=Odigeo.Membership.isMembershipProductEnabled&&e.membership;i||a||this.showLoginSuccess(),this.isLoggedInOk(e,t),_.delay(_.bind(function(){this.closeConnectorsLayer(),this.hideLoginSuccess()},this),1500)},isLoggedInOk:function(e,t){var i=t||"sso_successful_login_"+Odigeo.Session.get("loginPassword");this.model.models.user=e,this.model.trackCategory="my-trips-login-form"===Odigeo.Session.get("loginWidget")?"sso_sign_in_trips":"sso_module",this.model.logged||(this.model.logged=!0,this.model.membershipDisplayName=e.displayName,this.model.isMembership=e.membership,this.hideLoginWaiting(),(this.options.firstLogin||this.model.loggedOnHttps)&&(this.model.loggedOnHttps=!1),this._tracktCustomVar(!0)),t&&s.trackEventWithCategory(this.model.trackCategory,"sign_in",i),Odigeo.Utils.ensighten.updateDatalayer({membership_login:this.model.logged?"logged_in":"logged_out",membership_subscription:this.model.isMembership?"subscriber":_.get(window,"tmParam.membership_subscription","non_subscriber")}),this.setMembershipCustomDimension(this.model.isMembership),Odigeo.Session.remove("loginRequested"),Odigeo.trigger(this.id+":userLogged",e,!0)},setMembershipCustomDimension:function(e){var t="ua_dimension31",i="subscriber"===Odigeo.Utils.readCookie(t),n=e||i?"subscriber":"non-subscriber";Odigeo.Utils.createCookie(t,n,30),s.setCustomDimension(31,n)},openModalLogin:function(){_.delay(_.bind(function(){this.showModalLoginForm()},this),250)},openModalLogout:function(e){this.model.isMembership&&!this.model.isDynpack?this.launchLogoutModal(e):Odigeo.trigger(this.id+":userLogoutConfirmed",e)},launchLogoutModal:function(e){var t={headerTitle:this.keys.lightboxTextsHeader,description:this.keys.lightboxTextsDescription,primaryButton:this.keys.lightboxTextsPrimary,secondaryButton:this.keys.lightboxTextsSecondary},i=Odigeo.Utils.replaceCmsKeyArgs(t.description,this.model.membershipDisplayName);s.trackEvent("unlocked","nag_logout_displayed",null,!0),Odigeo.UIElements.showLightboxWarning("od-passenger-lightbox-logout",_.bind(this.onLaunchLogoutModalAction,this,e),_.bind(this.onLaunchLogoutModalCancel,this),_.extend({},t,{description:i}))},onLaunchLogoutModalAction:function(e){s.trackEvent("unlocked","nag_logout_confirm"),Odigeo.trigger(this.id+":membershipLogoutPopUpConfirmation",_.extend({isMembershipLogout:!0},e))},onLaunchLogoutModalCancel:function(e){var t=!0===e?"nag_logout_cancel":"nag_logout_close";s.trackEvent("unlocked",t),Odigeo.trigger("closeAllPopUps")},recoverPasswordOk:function(){this.model.isLegacyUser||this.recoverPasswordSuccess()},_logoutActions:function(){this.model.logged=!1,Odigeo.Session.remove("loginRequested"),Odigeo.Session.remove("loginPassword"),Odigeo.trigger(this.id+":userNotLogged"),this._tracktCustomVar(!1)},checkLogged:function(){_.isEmpty(this.options.loginError)?Odigeo.trigger(this.id+":submitUserRequest",{data:"",action:"isLoggedIn"}):this.loginWithError({messageError:this.options.loginError}),_.isEmpty(this.options.lastLoginEmailUsed)||this.updateEmailInput()},_showSocialLoginError:function(e,t){var i=_.startCase(t);a.clearErrors(this.$el.find(this.selectors.loginUserWithPassword).find('[data-name]:not([type="hidden"])'),this.$el.find(this.selectors.socialError)),s.trackEventWithCategory(this.model.trackCategory,"sign_in","sso_email_authentication_"+t+"_error"),this.showSocialErrorNoTrack(this.$el.find(this.selectors["login"+i+"Button"]).data(e),this.$el.find(this.selectors["login"+i+"Error"]))},checkLoginFacebookState:function(){r.getLoginStatus(this.id),a.clearErrors(this.$el.find(this.selectors.loginUserWithPassword).find('[data-name]:not([type="hidden"])'),this.$el.find(this.selectors.socialError))},checkLoginGoogleState:function(){r.getLoginStatusGoogle(this.id),a.clearErrors(this.$el.find(this.selectors.loginUserWithPassword).find('[data-name]:not([type="hidden"])'),this.$el.find(this.selectors.socialError))},_login:function(e){this.model.requestData=_.omit(e,["loginType"]),this.model.action=this.model.loginActions[e.loginType],this.model.loginType=e.loginType.toUpperCase(),this.model.socialToken=e.token,this.hideGenericError(),Odigeo.AB.isRecaptchaLoginEnabled&&!this.model.socialToken&&"http:"!==location.protocol?n.gRecaptchaExecute(this.model.recaptchaWidgetID.recaptchaLogin):this.resumeLoginSubmitRequest()},resumeLoginSubmitRequest:function(){var e=this.model.loginType.toLowerCase();this.options.noModalDialogs||this.$el.find(this.selectors.userLogin).addClass("hidden"),this.$el.find(this.selectors.loginWaiting).removeClass("hidden"),this.$el.find(this.selectors.modalView).off();var t=Odigeo.Session.get("loginRequested");this.model.socialToken&&!t?Odigeo.Session.set("loginPassword",e):Odigeo.Session.set("loginPassword","odigeo"),Odigeo.Session.set("loginRequested",e),Odigeo.Session.remove("feedbackPrime"),"http:"===location.protocol?(this._addHiddenInput("login_type",this.model.loginType),_.isUndefined(this.model.socialToken)||this._addHiddenInput("accessToken",this.model.socialToken),this._addHiddenInput("url",document.URL),this.$el.find(this.selectors.loginUserWithPassword).attr("action","https://"+document.domain+Odigeo.Settings.property("appContext")+"/secure/login"),this.$el.find(this.selectors.loginUserWithPassword).submit()):t||Odigeo.trigger(this.id+":submitUserRequest",{data:this.model.requestData,action:this.model.loginActions[this.model.loginType.toLowerCase()]})},triggerSubmitRequest:function(){Odigeo.trigger(this.id+":submitUserRequest",{data:this.model.requestData,action:this.model.action})},setEmailValues:function(e){_.each(this.$el.find(this.selectors.userEmail),function(t){t.innerHTML=e.displayName})},onBackToLogin:function(){var e=this.$el.find(this.selectors.recoverPasswordForm).hasClass("hidden")?"password_recovery_email":"password_recovery";s.trackEventWithCategory(this.model.trackCategory,e,"go_to_login"),this.openLoginForm()},onLoginSubmit:function(){s.trackEventWithCategory(this.model.trackCategory,"sign_in","sign_in"),this.loginWithPassword()},onLoginFacebook:function(){s.trackEventWithCategory(this.model.trackCategory,"sign_in","sign_in_facebook"),this.checkLoginFacebookState()},onLoginGoogle:function(){s.trackEventWithCategory(this.model.trackCategory,"sign_in","sign_in_google"),this.checkLoginGoogleState()},displayLoginOk:function(e){this.showModalLoginForm(),this.$el.find(this.selectors.userLogin).addClass("hidden"),this.$el.find(this.selectors.loginSuccess).removeClass("hidden"),this.setEmailValues(e),_.delay(_.bind(function(){this.$el.find(this.selectors.loginWaiting).addClass("hidden"),this.$el.find(this.selectors.loginSuccess).addClass("hidden")},this),1500)},embedWidget:function(){this.$el.find(this.selectors.loginConnectors).toggleClass("od-login-content-wrapper",!this.options.noModalDialogs),this.$el.find(this.selectors.userLogin).toggleClass("od-hint-content",!this.options.noHint),this.$el.find(this.selectors.modalArtifacts).toggleClass("odf-hidden",this.options.noModalDialogs)},hideShowRegisterFooterLink:function(e){this.$el.find(this.selectors.registerFooter).toggleClass("hidden",!e)},hideEmailLogin:function(e){this.$el.find(this.selectors.emailLoginContainer).toggleClass("hidden",e)},showSocialLoginButton:function(e){this.$el.find(this.selectors.loginUserSocial).addClass("odf-hidden"),this.$el.find(this.selectors["loginUserWith"+Odigeo.Utils.capitalize(e)]).removeClass("odf-hidden")},updateEmailInput:function(){this.$el.find(this.selectors.emailInput).val(this.options.lastLoginEmailUsed)},hideLoginWaiting:function(){this.$el.find(this.selectors.loginWaiting).addClass("hidden")},hideLoginSuccess:function(){this.$el.find(this.selectors.loginSuccess).addClass("hidden")},showLoginSuccess:function(){this.$el.find(this.selectors.loginSuccess).removeClass("hidden")},hideUserLogin:function(){this.$el.find(this.selectors.userLogin).addClass("hidden")},checkMembershipFastMenu:function(e){Odigeo.trigger(this.id+":setMembershipStar",this.isMembership||e),Odigeo.trigger(this.id+":setMembershipFastMenu",this.isMembership||e)},initEmbedView:function(e){this.hideShowRegisterFooterLink(!1),this.hideEmailLogin(!0),this.showSocialLoginButton(e),this.embedWidget()},performUserRequestIfLogged:function(e,t){this.model.logged?Odigeo.trigger(this.id+":performUserRequest",e):_.isFunction(t)&&t()}}))},function(e,t,i){"use strict";function n(e){return 1===e.quantity}function a(e){return null!==e}e.exports={getUrl:function(){return"updatemembershipproduct"},getMethod:function(){return"POST"},requestSuccess:function(e){_.isEmpty(e)&&Odigeo.Session.set("membershipProductPreviousRequest",JSON.stringify(this.get("request"))),Odigeo.trigger(this.widget.id+":addMembershipOk",e)},requestError:function(e){Odigeo.trigger(this.widget.id+":addMembershipFail",e)},requestComplete:function(){Odigeo.trigger(this.widget.id+":addMembershipComplete")},formatData:function(e){return JSON.stringify({email:e.email,password:e.password,quantity:e.quantity,name:e.name,lastNames:e.lastName})},hasToPerformRequest:function(e){var t,i,s,r=Odigeo.Utils.parseJson(Odigeo.Session.get("membershipProductPreviousRequest"));return s=e,!a(r)&&n(s)||(i=e,a(t=r)&&function(e,t){return s=t,e.quantity!==s.quantity||(i=e,n(a=t)&&!_.isEqual(_.omit(i,"password"),_.omit(a,"password")));var i,a,s}(t,i))},clearMembershipSessionValues:function(){Odigeo.Session.remove("membershipProductPreviousRequest"),Odigeo.Session.remove("membershipSubscriptionPriceItem"),Odigeo.Session.storage.removeItem("isUserSubscribedItem")}}},function(e,t,i){"use strict";var n=i(0);e.exports={stopRenderMetric:function(){var e,t,i,a=3===Odigeo.AB.preloadPartition,s=a?"RENDER_FLIGHTS_B":"RENDER_FLIGHTS",r=a?"RENDER_SECURE_B":"RENDER_SECURE",o=a?"RENDER_SECURE_META_B":"RENDER_SECURE_META";n.trackStop((e=s,t=r,i=o,Odigeo.SessionScope.isSecure?Odigeo.SessionScope.hasMktPortal?i:t:e))}}},function(e,t,i){"use strict";var n=i(0);e.exports={afterLoadData:function(e){var t=null,i=!0,a=["error.validate.toManyPassengers","error.validate.toManyChildren","error.validate.toManyInfants"],s=["FLEXIBLE_DATES_ERROR"];if(e){var r,o=!_.isEmpty(Odigeo.Utils.getFunnelInGlobalScope());switch(e.status){case 0:if("abort"!==e.statusText){var c="timeout"===e.statusText?"timeout":"0";n.trackEvent("request_errors",c,Odigeo.History.getPageNameFromFragment()),Odigeo.UIElements.show0Error()}break;case 404:n.trackPage(Odigeo.History.getPageNameFromFragment(),{funnel:o,error:{type:"default",message:"404"}}),this.error404();break;case 500:n.trackPage(Odigeo.History.getPageNameFromFragment(),{funnel:o,error:{type:"default",message:"500"}}),this.error500();break;case 501:n.trackPage(Odigeo.History.getPageNameFromFragment(),{funnel:o,error:{type:"default",message:"501"}}),"mobile"===Odigeo.SessionScope.flow?Odigeo.trigger("sessionExpiredError:open"):Odigeo.UIElements.showSessionExpiredError();break;default:if(t=e.responseJSON,_.isEmpty(t))try{t=JSON.stringify(e.responseText)}catch(e){return}else t.analyticsSearchInfo&&Odigeo.Session.set("analyticsSearchInfo",JSON.stringify(t.analyticsSearchInfo)),Odigeo.trigger("generic:analyticsSearchInfoReady"),(r=t).tmParam&&!_.includes(["flights_flexible_dates","dynpack_flexible_dates","flights_insurances","dynpack_insurances","flights_cancellation","dynpack_cancellation","flights_service_options","dynpack_service_options"],_.get(r,"tmParam.page_name"))&&this.reloadEnsighten(t);if(!t)return;if(!(_.has(t,"errors")&&_.isArray(t.errors)&&0<t.errors.length))return;_.each(t.errors,function(e){switch(e.code){case"META_BOOKING_ERROR":if("desktop"===Odigeo.SessionScope.flow){i=!1;break}case"BOOKING_ERROR":case"INVALID_DESTINATION_ERROR":case"NO_ACCOMMODATION_RESULTS":case"NO_ITINERARIES_RESULTS":break;case"FLEXIBLE_DATES_ERROR":i=!1;break;case"VALIDATION_ERROR":Odigeo.UIElements.showValidationError(this.pagesList);break;case"BROKEN_FLOW_ERROR":this.brokenFlowError(e);break;case"SEARCH_EXPIRED_ERROR":Odigeo.UIElements.showSearchExpiredError();break;case"SESSION_EXPIRED_ERROR":this.sessionExpiredError();break;case"DUPLICATED_BOOKING_ERROR":Odigeo.UIElements.showBookingAlreadyDone("alert");break;case"SEATMAP_SELECTION_RETRY_ERROR":Odigeo.requireWidget(this.seatmapSelectionWidget.id,this.seatmapSelectionWidget.name,function(t){t.execute("onSeatMapSelectionRetryError",e.details)});break;case"UPDATE_BOOKING_ERROR":if("desktop"===Odigeo.SessionScope.flow)break;default:this.defaultError()}var t;_.includes(s,e.code)||n.trackPage(Odigeo.History.getPageNameFromFragment(),{funnel:o,error:{type:"default",message:_.isUndefined(e.code)?"error":e.code.toLowerCase()}}),_.includes(a,e.message)||n.trackEvent("request_errors",(t=e,"error:"+(_.isString(t.message)?t.message.split(":")[0].substring(0,35):"")+"-code:"+(_.isString(t.code)?t.code.toLowerCase():"")))},this)}i&&this.hideLoading()}}}},function(e,t){var i="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(i){var n=new Uint8Array(16);e.exports=function(){return i(n),n}}else{var a=new Array(16);e.exports=function(){for(var e,t=0;t<16;t++)0==(3&t)&&(e=4294967296*Math.random()),a[t]=e>>>((3&t)<<3)&255;return a}}},function(e,t){for(var i=[],n=0;n<256;++n)i[n]=(n+256).toString(16).substr(1);e.exports=function(e,t){var n=t||0,a=i;return[a[e[n++]],a[e[n++]],a[e[n++]],a[e[n++]],"-",a[e[n++]],a[e[n++]],"-",a[e[n++]],a[e[n++]],"-",a[e[n++]],a[e[n++]],"-",a[e[n++]],a[e[n++]],a[e[n++]],a[e[n++]],a[e[n++]],a[e[n++]]].join("")}},function(e,t,i){"use strict";var n="policiesOffered",a="policiesAdded",s={desktop:["details","ancillaries","payment"],mobile:["passengersinfo","canx","insurance","flex","selection","servicepack","payment"]};function r(e){return Odigeo.Utils.parseJson(Odigeo.Session.storage.getItem(e))||{}}function o(e,t){Odigeo.Session.storage.setItem(e,JSON.stringify(t))}function c(e){var t,i,o={},c=(t=e,i=s[Odigeo.SessionScope.flow],_.take(i,_.indexOf(i,t)+1)),d=r(n);return _.each(c,function(e){_.forIn(d[e],function(e,t){var i=function(e){return _.filter(e,function(e){return t=e,_.some(r(a),_.partial(_.includes,_,t));var t})}(e);i=_.union(i,o[t]),_.set(o,t,i)})}),o}e.exports.registerOfferedPolicy=function(e,t,i){var a=r(n),s=_.get(a,[i,e],[]);s=_.union(s,_.isArray(t)?_.compact(t):[t]),_.set(a,[i,e],s),o(n,a)},e.exports.getRegisteredOfferedPolicies=function(e){var t=r(n);return _.get(t,e)},e.exports.track=function(e,t,n){var s=r(a);s[n||e]=_.compact(t),o(a,s);var d=c(e);_.forIn(d,function(t,n){var a;(a=n,i(140)(a)).continue(t,e)})},e.exports.resetPolicySession=function(){_.forEach([a,n],function(e){_.isNull(Odigeo.Session.storage.getItem(e))||Odigeo.Session.storage.removeItem(e)})}},function(e,t,i){"use strict";var n={AX:/(\d{4})?(?:\s)?(\d{6})?(?:\s)?(\d{1,5})?/,default:/(\d{4})?(?:\s)?(\d{4})?(?:\s)?(\d{4})?(?:\s)?(\d{1,4})?/},a="default",s={latinCharacters:function(e){var t=RegExp("[^- 'A-Za-zÀÁÂÃÄÅàáâãäåÆæßÈÉÊËèéêëÌÍÎÏIİìíîïıiŒœÒÓÔÕÖØøòóôõöøÙÚÛÜùúûüŸÝýÿÇçÑñÐþÞµŠšSsŞşGĞgğƒ]","gi");return e.replace(t,"")},numbers:function(e){return e.replace(/[^0-9]/gi,"")},ccnumber:function(e){return e.replace(/^[ 0\/-]*/,"").replace(/[^0-9 \-\/]/gi,"")},ccNumberFormatted:function(e){var t=this.numbers(e),i=n[a].exec(t);return _.filter(_.tail(i),function(e){return!isNaN(e)}).join(" ")}},r=function(e,t){var i=this.selectionStart,n=e.val(),a=s[t](n);n!==a&&(e.val(a)," "===a[i-1]&&a[i-1]!==n[i-1]&&(i+=1),"mobile"!==Odigeo.SessionScope.flow?e[0].setSelectionRange(i,i):_.delay(function(){e[0].setSelectionRange(i,i)},0),e.trigger(Odigeo.Events.change))};e.exports={setSelectedCreditCard:function(e){a="AX"===e?"AX":"default"},formatCreditCard:r,initInputPattern:function(e){var t=e instanceof $?e:$(e),i=t.data("pattern-type")?t.data("pattern-type"):t.data("pattern");t.length&&i&&s[i]&&t.on(Odigeo.Events.input,_.partial(r,t,i))}}},function(e,t,i){"use strict";var n=i(77),a={seatMapSelection:"seatmap-selection",getModel:function(e){return _.get(e,"models.seats",{})},getCallBacks:function(e){return _.get(e,"callbacks",{})},getCloseCallBack:function(e){return this.getCallBacks(e).closeCallBack||_.noop},isSeatMapActive:function(e){return 0<_.size(e)},getSelectionRequest:function(e){return _.get(e,"priceData.seatMapSelectionRequests")},isSeatMapEmpty:function(e){return 0===_.size(this.getSelectionRequest(e))},isSelectionEmpty:function(e){return!this.isSeatMapActive(e)||this.isSeatMapEmpty(e)},getType:function(e){return this.isSeatMapActive(e)?this.seatMapSelection:""},getSelectionInfo:function(e){return{seatsSelected:!this.isSelectionEmpty(e),type:this.getType(e),data:e}},seatsSelectionInfo:function(e){return this.getSelectionInfo(this.getSeatMapSelection(e))},getSeatMapSelection:function(e){return _.get(this.getModel(e),this.seatMapSelection,{})}};e.exports={create:function(e){return n.create(_.extend({},e,a))}}},function(e,t,i){"use strict";var n=i(0);e.exports=Odigeo.Model.extend({selectionAccommodationProductErrorMessage:"INT-003",specifiedAccommodationKeyDifferentFromPreviouslySelectedCode:"ERR-011",selectionItineraryProductErrorMessage:"SELECTION_ITINERARY_PRODUCT_ERROR",isEmptyData:!0,lastShoppingCart:null,dataURL:"createshoppingcart",data:{},url:function(){return Odigeo.Settings.getProperty("serviceUrlFormatter")(this.dataURL)},getBookedFlight:function(e){n.stopMetric("LOAD_CREATE_SHOPPING_CART"),this.isEmptyData=!1,this.cancelBookedFlight(),this.lastShoppingCart=this.clear().save(e,{success:_.bind(this.requestSuccessHandler,this),error:_.bind(this.requestErrorHandler,this)}),Odigeo.trigger(this.widget.id+":bookRequestPerformed")},cancelBookedFlight:function(){this.lastShoppingCart&&(this.isEmptyData=!0,this.lastShoppingCart.abort())},requestSuccessHandler:function(e,t){if(t.errors){var i=t.errors[0];"SESSION_EXPIRED_ERROR"===i.code||"SEARCH_EXPIRED_ERROR"===i.code?(Odigeo.trigger(this.widget.id+":searchExpiredError"),Odigeo.UIElements.showSearchExpiredError(),n.counterMetric("CREATE_SHOPPING_CART_OK_EXPIRED_ERRROR_COUNTER")):!Odigeo.Utils.startsWith(i.message,this.selectionAccommodationProductErrorMessage)&&!Odigeo.Utils.startsWith(i.message,this.specifiedAccommodationKeyDifferentFromPreviouslySelectedCode)||_.contains(i.message,this.selectionItineraryProductErrorMessage)?(n.counterMetric("CREATE_SHOPPING_CART_OK_BROKEN_FLOW_COUNTER"),Odigeo.trigger(this.widget.id+":brokenFlowError"),Odigeo.UIElements.showBrokenFlowError()):(Odigeo.trigger(this.widget.id+":selectionAccommodationProductError",{accommodationDealKey:this.widget.model.get("accommodationDealKey"),roomGroupDealKey:this.widget.model.get("roomGroupDealKey")}),n.counterMetric("CREATE_SHOPPING_CART_OK_ACCOMMODATION_ERRROR_COUNTER")),Odigeo.UIElements.enhanceLoading($(".waiting_page")).hideLoading()}else n.stopMetric("LOAD_CREATE_SHOPPING_CART"),n.counterMetric("CREATE_SHOPPING_CART_OK_COUNTER"),Odigeo.Utils.sessionTimer.reset(),Odigeo.trigger(this.widget.id+":shoppingCartCreated",_.omit(t,"errors"))},requestErrorHandler:function(e,t){n.counterMetric("CREATE_SHOPPING_CART_KO_COUNTER"),this.isEmptyData||(Odigeo.trigger(this.widget.id+":bookRequestError",t),this.isEmptyData=!0,Odigeo.UIElements.showBrokenFlowError())}})},function(e,t,i){"use strict";var n=i(78),a=i(0),s="flexibility_disruption";e.exports=Backbone.View.extend({initialize:function(e){this.template=e.template,this.templateData=e.translations,this.page=e.page,this.initModal(),this.trackOnload()},events:{"tap .close_icon":"onCloseClick","tap .ack_button":"onAckClick","tap .know_more_button":"onKnowMoreClick"},initModal:function(){Odigeo.Templates.getGenericTemplates([s]).then(_.bind(function(e){if(_.isObject(e)){var t=_.get(e,s),i=e.getStaticTemplatesKeys(s),a=_.get(t,"modals/modal",_.noop),r=_.get(t,"modals/content",_.noop),o=$(".flexibility_disruption_popup");this.modal=new n(o,{content:r(i),button:_.get(i,"flexibilityDisruptionPopUpCloseButton","")},{template:a,fillThePage:!1,preventContainerTap:!1,open:{analytics:{action:"free-cancellation_onload-nag",label:"free-cancellation_onload-nag_pag:"+this.page}},close:{analytics:{action:"free-cancellation_onload-nag",label:"free-cancellation_close-nag_pag:"+this.page}},button:{analytics:{action:"free-cancellation_onload-nag",label:"free-cancellation_close-info_pag:"+this.page}}}),o.find(".flex_when_option").on("click",_.bind(this.trackWhenOnClick,this)),o.find(".flex_what_option").on("click",_.bind(this.trackWhatOnClick,this)),o.find(".flex_how_option").on("click",_.bind(this.trackHowOnClick,this)),o.removeClass("odf-hidden"),this.render()}},this))},render:function(){this.$el.html(this.template(this.templateData))},trackWhenOnClick:function(){a.trackEvent("free-cancellation_nag","free-cancellation_open-info_when_pag:"+this.page)},trackWhatOnClick:function(){a.trackEvent("free-cancellation_nag","free-cancellation_open-info_what_pag:"+this.page)},trackHowOnClick:function(){a.trackEvent("free-cancellation_nag","free-cancellation_open-info_how_pag:"+this.page)},trackOnload:function(){a.trackEvent("free-cancellation_onload-popup","free-cancellation_onload-popup_pag:"+this.page)},trackOnclick:function(e){a.trackEvent("free-cancellation_popup","free-cancellation_"+e+"-popup_pag:"+this.page)},onKnowMoreClick:function(){this.trackOnclick("more"),this.modal.open(!0,!0),this.hide()},onAckClick:function(){this.trackOnclick("ok"),this.hide()},onCloseClick:function(){this.trackOnclick("close"),this.hide()},hide:function(){this.$el.addClass("odf-hidden"),Odigeo.Session.set("FlexSystemAlertClosed",!0)}})},,function(e,t,i){"use strict";var n={PAYMENT:"PLUS_LOAD_ANCILLARIES_MODULE_PAYMENT",PAYMENTFLEX:"PLUS_LOAD_ANCILLARIES_MODULE_PAYMENT_FLEX",CANX:"PLUS_LOAD_ANCILLARIES_MODULE_CANX",INSURANCE:"PLUS_LOAD_ANCILLARIES_MODULE_INSURANCE",FLEX:"PLUS_LOAD_ANCILLARIES_MODULE_FLEX",ADDITIONS:"PLUS_LOAD_ANCILLARIES_MODULE_ADDITIONS",SELECTION:"PLUS_LOAD_ANCILLARIES_MODULE_SELECTION"},a={PAYMENT:"PLUS_ERROR_COUNT_ANCILLARIES_MODULE_PAYMENT",PAYMENTFLEX:"PLUS_ERROR_COUNT_ANCILLARIES_MODULE_PAYMENT_FLEX",CANX:"PLUS_ERROR_COUNT_ANCILLARIES_MODULE_CANX",INSURANCE:"PLUS_ERROR_COUNT_ANCILLARIES_MODULE_INSURANCE",FLEX:"PLUS_ERROR_COUNT_ANCILLARIES_MODULE_FLEX",ADDITIONS:"PLUS_ERROR_COUNT_ANCILLARIES_MODULE_ADDITIONS",SELECTION:"PLUS_ERROR_COUNT_ANCILLARIES_MODULE_SELECTION"},s={PASSENGERSINFO:{ANCILLARIESCANX:"PLUS_LOAD_PASSENGERSINFO_TO_ANCILLARIESCANX",ANCILLARIESINSURANCE:"PLUS_LOAD_PASSENGERSINFO_TO_ANCILLARIESINSURANCE",ANCILLARIESFLEX:"PLUS_LOAD_PASSENGERSINFO_TO_ANCILLARIESFLEX",ANCILLARIESADDITIONS:"PLUS_LOAD_PASSENGERSINFO_TO_ANCILLARIESADDITIONS",ANCILLARIESSELECTION:"PLUS_LOAD_PASSENGERSINFO_TO_ANCILLARIESSELECTION",SERVICEPACK:"PLUS_LOAD_PASSENGERSINFO_TO_SERVICEPACK",PAYMENT:"PLUS_LOAD_PASSENGERSINFO_TO_PAYMENT"},ANCILLARIESCANX:{ANCILLARIESINSURANCE:"PLUS_LOAD_ANCILLARIESCANX_TO_ANCILLARIESINSURANCE",ANCILLARIESFLEX:"PLUS_LOAD_ANCILLARIESCANX_TO_ANCILLARIESFLEX",ANCILLARIESADDITIONS:"PLUS_LOAD_ANCILLARIESCANX_TO_ANCILLARIESADDITIONS",SERVICEPACK:"PLUS_LOAD_ANCILLARIESCANX_TO_SERVICEPACK",PAYMENT:"PLUS_LOAD_ANCILLARIESCANX_TO_PAYMENT"},ANCILLARIESINSURANCE:{ANCILLARIESFLEX:"PLUS_LOAD_ANCILLARIESINSURANCE_TO_ANCILLARIESFLEX",ANCILLARIESADDITIONS:"PLUS_LOAD_ANCILLARIESINSURANCE_TO_ANCILLARIESADDITIONS",SERVICEPACK:"PLUS_LOAD_ANCILLARIESINSURANCE_TO_SERVICEPACK",PAYMENT:"PLUS_LOAD_ANCILLARIESINSURANCE_TO_PAYMENT"},ANCILLARIESFLEX:{ANCILLARIESADDITIONS:"PLUS_LOAD_ANCILLARIESFLEX_TO_ANCILLARIESADDITIONS",SERVICEPACK:"PLUS_LOAD_ANCILLARIESFLEX_TO_SERVICEPACK",PAYMENT:"PLUS_LOAD_ANCILLARIESADDITIONS_TO_PAYMENT"},ANCILLARIESADDITIONS:{SERVICEPACK:"PLUS_LOAD_ANCILLARIESADDITIONS_TO_SERVICEPACK",PAYMENT:"PLUS_LOAD_ANCILLARIESFLEX_TO_PAYMENT"},ANCILLARIESSELECTION:{SERVICEPACK:"PLUS_LOAD_ANCILLARIESSELECTION_TO_SERVICEPACK",PAYMENT:"PLUS_LOAD_ANCILLARIESSELECTION_TO_PAYMENT"},SERVICEPACK:{PAYMENT:"PLUS_LOAD_SERVICEPACK_TO_PAYMENT"}};e.exports={LOAD_METRIC_ANCILLARIES_MODULE_PER_PAGE:n,ERROR_METRIC_ANCILLARIES_MODULE_PER_PAGE:a,getTransitionMapFromPage:function(e,t){return _.get(s,e+"."+t,"")},getLoadMetricKey:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"";return _.get(n,e.toUpperCase(),"")},getErrorMetricKey:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:"";return _.get(a,e.toUpperCase(),"")}}},,function(e,t,i){"use strict";var n=i(0),a=i(156),s={mapTypeControl:!0,center:0,zoom:17,mapTypeId:"",scrollwheel:!1,disableDefaultUI:!1,mapTypeControlOptions:{},draggable:!0,disableDoubleClickZoom:!1,mockType:"ui_map",hasAvuxiHeatMap:!1,grafanaKeyAvuxiError:"",hasIconMarkerBrand:!1,fullscreenControl:!1,latitude:0,longitude:0,mapView:null};function r(e){this.googleMap=null,this.heatMap=null,this.map=null,this.options=_.extend({},s,e)}function o(){this.googleMap.event.trigger(this.map,"resize"),this.map.setCenter(this.marker.position)}function c(){_.isEmpty(this.options.grafanaKeyAvuxiError)||n.counterMetric(this.options.grafanaKeyAvuxiError)}r.prototype.update=function(e){var t=$.Deferred();return _.extend(this.options,e),Odigeo.require(function(){return _.compact(["googleMaps",this.options.hasAvuxiHeatMap&&"avuxi"])}.call(this),_.bind(function(e){(function(e){this.marker=null,this.googleMap=e,this.options.center=new this.googleMap.LatLng(this.options.latitude,this.options.longitude),this.options.mapTypeId=this.googleMap.MapTypeId.ROADMAP,this.map=new this.googleMap.Map(this.options.mapView,this.options)}).call(this,e),function(){var e=this.options.hasIconMarkerBrand?i(347):this.googleMap.Marker;this.marker=new e({map:this.map,position:this.options.center})}.call(this),function(){this.options.hasAvuxiHeatMap&&(this.heatMap=new a(this.map))}.call(this),t.resolve(this.map.getDiv())},this),t.reject),t.promise()},r.prototype.refreshMap=function(){$.Deferred().resolve().then(this.options.hasAvuxiHeatMap?_.bind(this.heatMap.load,this.heatMap):_.noop).fail(_.bind(c,this)).always(_.bind(o,this))},r.prototype.hasMapElement=function(e){var t=function(){return _.result(this.map,"getDiv",null)}.call(this);return t===e&&_.isElement(t.firstChild)},e.exports=r},function(e,t,i){"use strict";var n=["dateOfBirth","identificationExpirationDate"],a=["password","frequentFlyerCompanyName","cvv2","travellerId","saveCardData","travellerType","paymentType","loginPassword"],s=!1,r=function(e,t,i){s=e,_.each(t,function(t){var s,r,o,c=$(t),d=c.prop("name")||c.data("name"),l=c.val(),g="radio"===c.attr("type");d&&-1===_.indexOf(a,d)&&_.size(c.parents(".hidden"))+_.size(c.parents('[data-status="hidden"]'))===0&&(e&&(g&&l===i[d]||!g)?(s=c,o=d,(r=i[d])&&("radio"===s.attr("type")?s.prop("checked",s.val()===r):s.val(r),"ccnumber"===o&&s.trigger(Odigeo.Events.input),s.trigger(Odigeo.Events.blur).trigger(Odigeo.Events.change),-1<_.indexOf(n,o)&&Odigeo.UIElements.enhanceDateWithSelects&&Odigeo.UIElements.enhanceDateWithSelects.setDate(s,r))):!e&&(g&&c.prop("checked")||!g)&&l&&"-1"!==l&&(i[d]=l))}),s=!1},o=function(e){var t=Odigeo.Utils.parseJson(Odigeo.Session.get(e));return t||Odigeo.Utils.parseJson(Odigeo.Storage.get(e))};e.exports={check:function(e){return!!o(e)},get:function(e,t){var i=o(e);return _.isObject(i)&&i[t]?i[t]:void 0},restore:function(e,t,i,n){var a,s,o,c=Odigeo.Utils.parseJson(Odigeo.Session.get(e));(c=c&&c[i]?c:Odigeo.Utils.parseJson(Odigeo.Storage.get(e)))&&c[i]&&(_.isEmpty(n)||(a=n,s=c,o=i,_.each(a,function(e,t){s[o][t]&&!e.is(":checked")&&e.click()})),r(!0,t,c[i]))},save:function(e,t,i,n,a){if(!s){var o=_.extend({},a),c=Odigeo.Utils.parseJson(Odigeo.Session.get(t))||{};r(!1,i,o),c[n]=_.extend(c[n]||{},o),Odigeo.Session.set(t,JSON.stringify(c)),e&&Odigeo.Storage.set(t,JSON.stringify(c))}},removeStorageOnNotSelected:function(e,t){e.on(Odigeo.Events.change,function(){e.prop("checked")||Odigeo.Storage.remove(t)})},removeStorageOff:function(e){e.off(Odigeo.Events.change)}}},function(e,t,i){"use strict";var n,a,s,r,o,c=i(0),d={css:{container:"od-passengers-manager-suggestion-container",element:"od-passengers-manager-suggestion-elem odf-text-md odf-clickable od-new-suggestion"},hasEvents:!0},l={},g={},h=function(e){o=e},u=function(e,t){var i=l[e];clearTimeout(r),i&&(i.input.val($(t.target).text()).change().blur(),"email"===i.name&&h(!0),p(i.container),c.trackEvent("customer_details",e.toLowerCase()+"_autocomplete_clicks"))},p=function(e){e.find(".mail_suggestion_element").off(Odigeo.Events.mousedown,s),e.html("")},f=function(e,t,i,n,a,s){var r=m(s,a);_.isArray(r)&&r.length?(g[i]=s,b(e,n,a,r)):C(e)},m=function(e,t){return t=t.toLowerCase(),_.filter(e,function(e){return _.isEmpty(t)||_.startsWith(e,t)&&e!==t})},b=function(e,t,i,n){var a=l[e],r=$("<ul>",{class:"mail_suggestion_container "+a.css.container});_.each(_.slice(n,0,4),function(e){r.append($("<li>",{class:"mail_suggestion_element "+a.css.element}).text(t+"@"+e))},this),s=_.partial(u,e,_),a.container.html(r).removeClass("odf-hidden").find(".mail_suggestion_element").on(Odigeo.Events.mousedown,s)},y=function(e){return e instanceof $},v=function(e,t){S(e,t.target.value)},S=function(e,t){_.includes(t,"@")?function(e,t){var i=t.split("@"),n=i[0],a=i[1],s=(_.first(a)||"").toLowerCase();_.isArray(g[s])?b(e,n,a,m(g[s],a)):$.ajax({url:Odigeo.Settings.options.suggestionServiceUrlFormmater("getEmailSuggestions"),data:{email:s},success:_.bind(f,this,e,t,s,n,a)})}(e,t):C(e)},C=function(e){var t=l[e];t&&t.container.addClass("odf-hidden")};e.exports={initEmailSuggestion:function(e,t,i,s,o){if(h=t,u=i,p=d,(f=!(g=e)||y(h)||y(u))&&(l[g]={name:g,input:h,container:u,hasChangeValue:!1,cb:null,css:{container:"",element:""}},l[g]=_.merge(l[g],p||{})),f&&_.isObject(d)&&d.hasEvents){var c=_.isFunction(o)?o:v;n=_.partial(c,e,_),a=function(){r=_.delay(_.partial(C,e),500)},t.on(Odigeo.Events.keyup,n).on(Odigeo.Events.blur,a),_.isObject(s)&&"mobile"===Odigeo.SessionScope.flow&&t.off(Odigeo.Events.focus,_.partial(this.focusFieldEvent,t,s)).on(Odigeo.Events.focus,_.partial(this.focusFieldEvent,t,s))}var g,h,u,p,f},focusFieldEvent:function(e,t){var i,n=Odigeo.getRelativeScreenPosition(e);!($(window).height()/2<n)&&(i=n,160<$(window).height()-i)||Odigeo.Utils.scrollToElement(t,{avoidDefaultOffset:!0})},checkEmailValue:function(e,t){l[e]&&v(e,t)},checkEmailValueByText:function(e,t){l[e]&&S(e,t)},getDomainByName:function(e){return l[e]?function(e){return function(e){var t;if(_.isString(e)){var i=e.split("@");1<_.size(i)&&0<_.size(i[1])&&(t=i[1])}return t}(e instanceof $?e.val():null)}(l[e].input):null},closeSuggestions:function(e){C(e)},removeBinds:function(e){_.each(_.isArray(e)?e:[e],function(e){var t=l[e];t&&(p(t.container),t.input.off(Odigeo.Events.keyup,n).off(Odigeo.Events.blur,a),C(e),t=null)})},getClickedMailSuggestions:function(){return o},setClickedMailSuggestions:h}},function(e,t,i){"use strict";e.exports={AX:{type:"amex",name:"American Express"},AB:{type:"amex",name:"American Express consumer card"},TA:{type:"amex",name:"American Express BTA"},"3V":{type:"visa",name:"Visa 3V"},DL:{type:"visa",name:"Visa Delta"},E1:{type:"visa",name:"Visa Entropay"},EA:{type:"visa",name:"Visa Agos Edreams"},VD:{type:"visa",name:"Visa Debit"},VI:{type:"visa",name:"Visa Credit"},VV:{type:"visa",name:"Visa Vueling"},RV:{type:"visa",name:"Visa"},TV:{type:"visa",name:"Visa Iberia"},VE:{type:"electron",name:"Visa Electron"},CA:{type:"mastercard",name:"Mastercard"},EC:{type:"mastercard",name:"Mastercard Eurocard"},MD:{type:"mastercard",name:"Mastercard Debit"},MC:{type:"mastercard",name:"Mastercard"},M6:{type:"mastercard",name:"Mastercard"},M4:{type:"mastercard",name:"Mastercard"},MP:{type:"mastercard",name:"Mastercard"},MI:{type:"mastercard",name:"Mastercard"},RM:{type:"mastercard",name:"Mastercard"},CM:{type:"mastercard",name:"Mastercard"},VB:{type:"mastercard",name:"ViaBuy"},TE:{type:"mastercard",name:"Eurocard"},TF:{type:"mastercard",name:"First Card"},DM:{type:"mastercard",name:"Mastercard Debit"},EY:{type:"mastercard",name:"Edreams Prepaid"},MA:{type:"maestro",name:"Maestro"},CB:{type:"cartebleuenationale",name:"Carte Bleue"},DC:{type:"dinersclub",name:"Diners Club"},DS:{type:"discover",name:"Discover Card"},JC:{type:"jcb",name:"Japan Credit Bureau"},ER:{type:"enroute",name:"Diners Club enRoute"},TD:{type:"diners",name:"Diners TAC"},TP:{type:"utap",name:"UATP/Airplus corporate card"},CF:{type:"unknown",name:"Cofinoga"},CO:{type:"unknown",name:"Cofinoga Opodo"},TC:{type:"unknown",name:"Thalys TheCard"}}},function(e,t,i){"use strict";var n=i(325);Odigeo.defineWidget("book_flight_manager",Odigeo.Widget.extend({modelClass:n,bookFlightHandler:function(e){return this.model.getBookedFlight(e),!0},cancelBookFlightHandler:function(){this.model.cancelBookedFlight()},isShopingCartExecuted:function(){return!_.isNull(this.model.lastShoppingCart)},selectionAccommodationProductErrorMessage:function(){return this.model.selectionAccommodationProductErrorMessage},getSpecifiedAccommodationKeyDifferentFromPreviouslySelectedCode:function(){return this.model.specifiedAccommodationKeyDifferentFromPreviouslySelectedCode},execute:function(e,t){if(_.isFunction(this[e]))return this[e](t)}}))},,,function(e,t,i){"use strict";$(function(){Odigeo.defineWidget("searchsummary",Odigeo.Widget.extend({trackingUtils:i(0),isExpanded:!1,animating:!1,modelClass:Odigeo.Model.extend({getData:function(){return Odigeo.Utils.parseJson(Odigeo.Session.get("searchParameters"))}}),viewClass:Odigeo.View.extend({init:function(){this.cacheDomSelectors(),this.bindToDom()},cacheDomSelectors:function(){this.addSelectorToCache("widgetWrapper",this.$widget.find(".od-searchSummary-wrapper")),this.addSelectorToCache("summaryDataFlights",this.$widget.find(".summary_data_flights_labels")),this.addSelectorToCache("summaryTemplate",this.$widget.find(".summary_template")),this.addSelectorToCache("summaryChangeSearch",this.$widget.find(".collapsed_summary_link")),this.addSelectorToCache("content",this.$widget.find(".collapsed_summary")),this.addSelectorToCache("summaryPax",this.$widget.find(".search_summary_passengers")),this.addSelectorToCache("editHeaderButton",this.$widget.find(".edit_header_button")),this.addSelectorToCache("detailsHeaderWrapper",this.$widget.find(".details_header_wrapper"))},updateView:function(e){this.$cachedSelectors.summaryDataFlights.empty().append(e),this.removeSelectorFromCache("summaryPax"),this.addSelectorToCache("summaryPax",this.$widget.find(".search_summary_passengers"))},updatePassengers:function(e){var t={adults:{num:e.numAdults,key:this.$cachedSelectors.summaryPax.data("adult-plural")},children:{num:e.numChildren,key:this.$cachedSelectors.summaryPax.data("child-plural")},infants:{num:e.numInfants,key:this.$cachedSelectors.summaryPax.data("infant-plural")}},i=this.$cachedSelectors.summaryDataFlights.find(".od-searchSummary-passengers"),n=_.chain(t).map(function(e){return 0!==e.num&&Odigeo.Utils.pluralizeAll(e.key,e.num)},{$el:i}).compact().value(),a=e.numAdults+e.numChildren+e.numInfants,s=2<e.numAdults||0<e.numChildren||0<e.numInfants,r=Odigeo.Utils.pluralizeAll(this.$cachedSelectors.summaryPax.data("traveller-plural"),a);i.html(s?r:n.join(", "))},bindToDom:function(){this.$cachedSelectors.summaryChangeSearch.on(Odigeo.Events.tap,_.bind(this.toggleChangeSearch,this,"summaryChangeSearch")),this.$cachedSelectors.summaryDataFlights.on(Odigeo.Events.tap,_.bind(this.toggleChangeSearch,this,"summaryDataFlights")),this.$cachedSelectors.detailsHeaderWrapper.on(Odigeo.Events.tap,_.bind(this.onClickDetails,this))},toggleChangeSearch:function(e){var t="open_change_search",i="searcher_flights";"summaryChangeSearch"===e?t="click_trip_information":"results-search-summary"!==this.widget.id&&(i="header",t="click_trip_information"),this.widget.options.isDynpack?this.widget.trackingUtils.trackEvent("searcher_dynpack","click_change_search"):(this.widget.trackingUtils.trackEvent(i,t),this.widget.trackingUtils.trackEvent("searcher_flights","click_change_search")),!0===this.widget.options.isInDetailsPage?Odigeo.Router.navigate("results"):Odigeo.trigger(this.widget.id+":toggleChangeSearch"),Odigeo.trigger("results-remove-filters:showFilterBox",!1)},onClickDetails:function(){Odigeo.trigger("searchsummary:clickDetails")},showContent:function(){this.$cachedSelectors.content.removeClass("hidden")},hideContent:function(){this.$cachedSelectors.content.addClass("hidden")},showInDetailsPage:function(){this.$cachedSelectors.widgetWrapper.addClass("od-show-detail-search-summary"),Odigeo.trigger(this.widget.id+":showHeaderBackgroundSearchSummary")},toggleEditHeaderButtonHidden:function(e){this.$cachedSelectors.editHeaderButton.toggleClass("odf-hidden",e)},updateDetailsButtonDisplay:function(e){this.$cachedSelectors.summaryChangeSearch.toggleClass("odf-hidden",e),e?this.$cachedSelectors.detailsHeaderWrapper.off(Odigeo.Events.tap):this.$cachedSelectors.detailsHeaderWrapper.on(Odigeo.Events.tap,_.bind(this.onClickDetails,this))}}),init:function(){_.templateSettings={evaluate:/\{\{#(.+?)\}\}/g,interpolate:/\{\{([^#].*?)\}\}/g},this.options=Odigeo.parseOptions(this.options),this.template=_.template(this.view.$cachedSelectors.summaryTemplate.html()),this.refresh(),this.options.isInDetailsPage&&!Odigeo.Session.storage.getItem("changeSearchMetaShown")&&(Odigeo.Session.storage.setItem("changeSearchMetaShown",!0),this.view.showInDetailsPage())},refresh:function(){var e,t=this.options.loadFlightInfoFromSession?this.model.getData():this.options;_.isNull(t)||(e=this.constructTemplate(t),this.view.updateView(e),this.view.updatePassengers(t))},getOneLegData:function(e){var t=e.destinationCity,i=e.destinationIata;return _.isEmpty(e.multipleDestinationCities)||(t=_.reduce(_.map(e.multipleDestinationCities,"city"),function(e,t){return e+", "+t},t),i=_.reduce(_.map(e.multipleDestinationCities,"iata"),function(e,t){return e+", "+t},i)),{origin:e.origin,destination:e.destination,originIata:e.originIata,destinationIata:i,originCity:e.originCity,destinationCity:t}},getMultiTripLegData:function(e,t){var i=null,n=t?"iata":"name";return _.map(e,function(e){var t=e.destination[n],a=e.departure[n],s=i===a;return{origin:a,destination:i=t,originIata:e.departure.iata,repeat_air:s,destinationIata:e.destination.iata,originCity:_.isNull(e.departure.city)?e.departure.name:e.departure.city,destinationCity:e.destination.city||e.destination.name}})},getDetailedLegData:function(e){return _.map(e.searchSegments,function(t,i){return{originIata:t.departure.iata,destinationIata:t.destination.iata,date:Odigeo.Utils.parseDate(t.dateStr),legIndex:i,type:e.type}})},constructTemplate:function(e){if(_.isEmpty(e)||!e.searchSegments.length)return!1;var t,i,n,a,s=e.searchSegments[0].departure.name&&14<e.searchSegments[0].departure.name.length||e.searchSegments[0].destination.name&&14<e.searchSegments[0].destination.name.length,r={passengers:e.numAdults+e.numChildren+e.numInfants,type:e.type,toLabel:this.options.to,origin:s?e.searchSegments[0].departure.iata:e.searchSegments[0].departure.name,destination:s?e.searchSegments[0].destination.iata:e.searchSegments[0].destination.name,originCity:e.searchSegments[0].departure.city||e.searchSegments[0].departure.name,destinationCity:e.searchSegments[0].destination.city||e.searchSegments[0].destination.name,originIata:e.searchSegments[0].departure.iata,destinationIata:e.searchSegments[0].destination.iata,flexibleDates:e.flexibleDates,multipleDestinationCities:e.multipleDestinationCities};if(this.options.showDetailedItineraryInfo)t=this.getDetailedLegData(e);else switch(e.type){case"oneWayTrip":t=[this.getOneLegData(r)],n=[Odigeo.Utils.parseDate(e.searchSegments[0].dateStr)];break;case"roundTrip":t=[this.getOneLegData(r)],n=[Odigeo.Utils.parseDate(e.searchSegments[0].dateStr),Odigeo.Utils.parseDate(e.searchSegments[1].dateStr)],a=Odigeo.Utils.getDifferenceInDays(n[0],n[1]);break;case"multipleTrip":i=e.searchSegments.length,t=this.getMultiTripLegData(e.searchSegments,this.options.show_multiple_destination_with_iata),!_.isUndefined(this.options.wantAllDates)&&this.options.wantAllDates?(n=[],_.each(e.searchSegments,function(e){n.push(Odigeo.Utils.parseDate(e.dateStr))})):n=[Odigeo.Utils.parseDate(e.searchSegments[0].dateStr),Odigeo.Utils.parseDate(e.searchSegments[i-1].dateStr)]}return this.template({legs:t,type:r.type,toLabel:r.toLabel,dates:n,passengers:r.passengers,formatDate:Odigeo.Utils.formatDate,flexibleDates:r.flexibleDates,isMultidestination:!_.isEmpty(r.multipleDestinationCities),differenceInDays:a})},expand:function(){$(this.view.$cachedSelectors.widgetWrapper).removeClass("hidden")},collapse:function(){$(this.view.$cachedSelectors.widgetWrapper).addClass("hidden")},repaint:function(){this.view.$el.find(".searchPanel_nonexpandible").addClass("hidden"),this.view.$el.find(".searchPanel_expandible").removeClass("hidden")},toggleEditHeaderButtonHidden:function(e){this.view.toggleEditHeaderButtonHidden(e)},_boldString:function(e){return'<span class="od-searchPanel-bold">'+e+"</span>"},execute:function(e){var t=[].slice.call(arguments,1);switch(e){case"show":this.view.showContent.apply(this.view,t);break;case"hide":this.view.hideContent.apply(this.view,t);break;case"refresh":this.refresh.apply(this,t);break;case"repaint":this.repaint.apply(this,t);break;case"toggleEditHeaderButtonHidden":this.toggleEditHeaderButtonHidden.apply(this,t);break;case"updateDate":this.updateDate.apply(this,t);break;case"refreshAndShow":this.refresh.apply(this,t),this.view.showContent.apply(this.view,t);break;case"toggleFlightInfoPageButtonVisibility":this.view.toggleFlightInfoPageButtonVisibility.apply(this.view,t);break;case"updateDetailsButtonDisplay":this.view.updateDetailsButtonDisplay.apply(this.view,t)}return this},updateDate:function(e){this.view.$el.find(".flight_date").html(e)}}))})},function(e,t,i){"use strict";$(function(){var e=i(0),t=i(339),n=i(99),a=/\s*,\s*/;Odigeo.defineWidget("persuasiveMessaging",Odigeo.Widget.extend({modelClass:Odigeo.Model.extend({defaults:{ids:{}},ids:{searchId:function(){var e=Odigeo.Utils.parseJson(Odigeo.Session.get("searchParameters"));return _.map(e.searchSegments,function(e){return e.dateStr+":"+e.departure.iata+":"+e.destination.iata}).join(",")}},init:function(){this.widget.options=Odigeo.parseOptions(this.widget.options)},addId:function(){var e=this.widget.options.onceShownPerIdType;if(_.isString(e)){var t=this.ids[e],i=_.isFunction(t)?t():t,n=this.getIdCollection();n[i]||(n[i]=!0,this.setIdCollection(n),this.trigger("new:id"))}else this.trigger("new:id")},getIdCollection:function(){var e=this.get("ids");if(_.isEmpty(e)){var t=Odigeo.Session.get(this.widget.id+":ids");e=t&&Odigeo.Utils.parseJson(t)||{}}return e},setIdCollection:function(e){Odigeo.Session.set(this.widget.id+":ids",JSON.stringify(e))},getSessionValue:function(e){if(!_.isUndefined(e)){var t=e.indexOf("."),i=-1===t?e.length:t,a=e.substring(1,i),s=e.substring(i+1),r=Odigeo.Utils.parseJson(Odigeo.Session.get(a));return n(r,s)}}}),viewClass:Odigeo.View.extend({translations:{},templateSettings:Odigeo.Utils.getTmplSettings({variable:""}),events:{"tap .persuasive_message_close":"closeMessage","mouseenter .persuasive_message":"clearShownLimitTime","mouseleave .persuasive_message":"applyShownLimitTime"},selectors:{persuasiveMessage:".persuasive_message"},init:function(){var e=this.widget.options.template.split(a),t=$(_.sample(e)).html();this.shownLimitTimeId=null,this.translations=_.extend({},Odigeo.UIElements.translations.persuasiveMessages),this.template=_.template(t,this.templateSettings),this.model.on("new:id",this.showMessage,this),this.$cachedSelectors.persuasiveMessage.toggleClass("odf-hidden",!!this.widget.options.stayClosed),this.widget.options.autoload&&this.updatePageAndMessage(this.widget.options.autoload),this.$cachedSelectors.persuasiveMessage.hasClass("closed")&&this.$cachedSelectors.persuasiveMessage.addClass("odf-hidden"),Odigeo.trigger(this.widget.name+":removeMessages",this.page)},computeTemplateParams:function(e){var i=this.widget.options.idWidget,n=i?this.translations[i]:this.translations[e];return _.extend(n,{clusterText:n.default}),_.reduce(_.keys(n),_.bind(function(e,i){var a=n[i];return _.isEmpty(a)||"$"!==a[0]||(a=this.model.getSessionValue(a)),e[i]=t(a),e},this),{})},activateMessage:function(e){this.page=e,this.isShowable()&&(this.$cachedSelectors.persuasiveMessage.attr("data-page",""),this.model.addId())},closeMessage:function(){var t=this.widget.options.trackAction;this.shownLimitTimeId=null,this.$cachedSelectors.persuasiveMessage.addClass("closed").removeClass("active"),this.page&&this.isShowable()&&(this.translations[this.page].closed=!0),t&&e.trackEvent(t,t+"_layer_closed")},deactivateMessage:function(){this.$cachedSelectors.persuasiveMessage.removeClass("active closed")},isShowable:function(){var e=!1;return this.widget.options.showOncePerSearch&&(e="false"===Odigeo.Session.storage.getItem("isFirstSearch")),!e&&this.translations&&this.template&&this.translations[this.page]},updatePageAndMessage:function(e){this.page=e,this.isShowable()&&!this.translations[e].closed?(this.$cachedSelectors.persuasiveMessage.attr("data-page",""),this.model.addId()):this.$cachedSelectors.persuasiveMessage.addClass("closed")},showMessage:function(){var e=this.widget.options.appearanceDelayTime;e=_.isNumber(e)?e:0,_.delay(_.bind(function(){this.createMessage()},this),e)},createMessage:function(){var e=this.computeTemplateParams(this.page);this.$cachedSelectors.persuasiveMessage.empty().append(this.template(e)),this.$cachedSelectors.persuasiveMessage.addClass("active").attr("data-page",this.page),this.applyShownLimitTime()},applyShownLimitTime:function(){_.isNull(this.shownLimitTimeId)&&_.isNumber(this.widget.options.shownLimitTime)&&(this.shownLimitTimeId=_.delay(_.bind(this.closeMessage,this),this.widget.options.shownLimitTime))},clearShownLimitTime:function(){_.isNumber(this.shownLimitTimeId)&&(clearTimeout(this.shownLimitTimeId),this.shownLimitTimeId=null)},updateKey:function(t,i){var n=this.widget.options.idWidget||this.page,a=this.widget.options.trackAction;this.translations[n][t]=i,this.createMessage(),this.$cachedSelectors.persuasiveMessage.removeClass("odf-hidden closed"),this.widget.options.stayClosed=!1,Odigeo.trigger(this.widget.name+":removeMessages",this.page),a&&e.trackEvent(a,a+"_layer_appearances")},hide:function(){this.$cachedSelectors.persuasiveMessage.addClass("odf-hidden")}}),activateMessage:function(e){this.view.activateMessage(e)},deactivateMessage:function(){this.view.deactivateMessage()},closeMessage:function(){this.view.closeMessage()},updateKey:function(e,t){this.view.updateKey(e,t)},hideWidget:function(){this.view.hide()},init:function(){this.options=Odigeo.parseOptions(this.options)}}))})},function(e,t,i){"use strict";e.exports=function(e){return _.isArray(e)?_.sample(e):_.isObject(e)&&_.isNumber(e.min)&&_.isNumber(e.max)?_.random(e.min,e.max):e}},function(e,t,i){"use strict";Odigeo.defineWidget("collapsible_flight_summary",Odigeo.Widget.extend({modelClass:i(341),viewClass:i(342),expandSummaryPanel:function(e){this.view.expandOrCollapseFlightDetails(e,"expandPanel")},enableChangeSearch:function(e){this.view.enableChangeSearch(e)},toggleFlightDetails:function(){this.view.toggleFlightDetails()},getUnfoldedFlightDetails:function(e,t){return this.view.fillUnfoldedSummary(e,t)},showFlightInfo:function(e){this.model.setData(e),this.view.toggleResultsPopup(!0)},closePopup:function(){this.view.onResultsCloseButton()},showBoardingOptions:function(e){this.model.storeBoardingOptions(e),this.view.showBoardingOptions()},updateFareUpgradePrices:function(e,t){this.view.updateFareUpgradePrices(e,t),this.model.setPrices(e),this.model.setFareUpgradeSelected(t)}}))},function(e,t,i){"use strict";var n=i(6),a=i(52),s=i(14).getInstance(),r=i(83);e.exports=Odigeo.Model.extend(a.extend({dataUrl:"getcollapsibleflightsummarydata",getData:function(){this.options=Odigeo.parseOptions(this.widget.options),this.fetch(this.getDataRequestSettings())},url:function(){return Odigeo.Settings.getProperty("serviceUrlFormatter")(this.dataUrl)},getDataRequestSettings:function(){return{type:"GET",processData:!0,success:_.bind(this.requestSuccessHandler,this)}},parse:function(e){var t=e;return e.flightDetailsDTO||(e.segments=this.processResponseForResults(e),t={flightDetailsDTO:e,tripType:n.toResultsType(Odigeo.Utils.parseJson(Odigeo.Session.get("searchParameters")).type)}),t},processResponseForResults:function(e){var t=this.get("bookingData").segmentPositions;return _.map(e.itineraryGroupsList,function(e,i){return delete(e=_.merge({},e,e.segments[t[i].segment])).segments,e})},setFareUpgradeSelected:function(e){this.set("isRefundableFareUpgradeSelected",e)},setPrices:function(e){this.set("prices",e)},setData:function(e){this.set("bookingData",e),this.dataUrl="result/flightdetails/"+e.itinerary.mainItineraryId,this.getData()},getBookingData:function(){var e=this.get("bookingData");return{searchID:e.itinerary.fareItinerarySearchId,itineraryID:e.itinerary.mainItineraryId,segmentPositions:e.segmentPositions,selectedSegments:this.getSelectedSegments(e.segmentIndex,e.itinerary),selectedItinerary:e.itinerary,isPriceWithoutDiscountSelected:e.isPriceWithoutDiscountSelected}},getSelectedSegments:function(e,t){return _.map(e,function(e,i){return t.itineraryGroupsList[i].segItems[e]})},getNumPassengers:function(){return this.getPriceCollectionData().numPassengers},getFooterData:function(){return this.get("bookingData")},requestSuccessHandler:function(e){var t=this.isCandidateForFareUpgrade();this.set("isCandidateForFareUpgrade",t),this.options.hideUpgradeFare||(this.isInFareUpgradeScope()&&this.trackRefundableFareUpgradeInScope(),t&&this.loadFareUpgradePanelData())},loadFareUpgradePanelData:function(){this.on("priceCollection.repaintPrices",this.updateTotalPrice),s.isLoaded()?this.updateFareUpgradePrice():this.listenTo(s,"productCatalogueCollectionIsOk",this.updateFareUpgradePrice)},updateTotalPrice:function(){this.checkIfDataIsLoaded()},updateFareUpgradePrice:function(){this.set("fareUpgradePrice",this.getRefundableFare().totalPrice),this.set("fareUpgradePassengerPrice",this.getRefundableFare().passengerPrice),this.checkIfDataIsLoaded()},getTotalPrice:function(){var e=this.getRefundableFare();return this.getPriceCollectionData().totalPrice-(e.preselected?e.totalPrice:0)},isDataLoaded:function(){var e=!_.isNull(this.getTotalPrice()),t=!_.isNull(this.get("fareUpgradePrice"));return e&&t&&this.widget.view},checkIfDataIsLoaded:function(){this.isCandidateForFareUpgrade()&&this.isDataLoaded()&&this.widget.view.renderFareUpgradePanel()},getRefundableFare:function(){return s.getInsuranceByPolicy("CANXSELF")},isCandidateForFareUpgrade:function(){return Odigeo.AB.isFareC4ARinPaxEnabled&&!_.isUndefined(this.getRefundableFare().totalPrice)&&this.isInFareUpgradeScope()},isInFareUpgradeScope:function(){return!this.options.isDynpack&&this.areAllSegmentsFlights()&&!this.isDepartureLessThan48HoursAhead()},areAllSegmentsFlights:function(){var e=_.get(this.get("flightDetailsDTO"),"allSections",[]);return 0<e.length&&_.every(e,function(e){return e.flight})},isDepartureLessThan48HoursAhead:function(){var e=_.get(this.get("flightDetailsDTO"),"allSections.0.departureTime",(new Date).getTime());return Odigeo.Utils.getDifferenceInDays((new Date).getTime(),e)<3},trackRefundableFareUpgradeInScope:function(){r.trackOnClickSelectFairUpgradePanel({action:"on_load_widgets",shown:!0})},storeBoardingOptions:function(e){this.set("boardingOptions",e)}}))},function(e,t,i){"use strict";var n=i(0),a=i(170),s=i(343),r=i(345),o=i(82),c=i(41),d=i(6),l=i(78),g=i(14).getInstance(),h="flexibility_disruption",u=!1,p=!1,f=void 0,m=void 0;e.exports=Odigeo.View.extend({init:function(){this.options=Odigeo.parseOptions(this.widget.options),this.loadFareUpgradePanel(),this.renderDetails(),this.updateDomSelectorsToCache(),this.viewListeners(),u=this.options.isFolded,this.options.isResults||this.model.getData(),this.updateDomSelectorsToCache(),this.bindViewEvents()},viewListeners:function(){this.listenTo(this.model,"change:flightDetailsDTO",this.initTemplate),this.listenTo(this.model,"change:bookingData",this.initTemplate)},events:{"mouseover @airlineLogo":"onAirlineLogoHover","mouseout @airlineLogo":"onAirlineLogoHover","tap @flightDetailsWrapper":"toggleFlightDetails","tap @collapsibleFlightDetailsWrapper":"toggleFlightDetails","tap @toggleFlightDetails":"toggleFlightDetails","tap @resultsCloseButton":"onResultsCloseButton","tap @resultsContinueButton":"onResultsContinueButton","tap @changeFlight":"onChangeSearchButton","tap @launchPopup":"launchPopup","tap @flexibilityDisruptionModalIcon":"openFlexibilityDisruptionModal"},selectors:{flightDetailsWrapper:".flight_details_wrapper",collapsibleFlightDetailsWrapper:".collapsible_flight_details_wrapper",toggleFlightDetails:".toggle_flight_details",priceCollapsible:".price_collapsible",decimalPriceCollapsible:".decimal_price_collapsible",toggleRowButtons:".collapse_arrow_buttons",flightDetailsPopup:".flight_details_popup",collapsibleButton:".collapsible_button",fareUpgradeSelectorContainer:".details_fare_upgrade_selector_container",collapsibleContainer:".collapsible_container",importantInfo:".important_info_message_popup",flexibilityDisruptionBanner:".flexibility_disruption_banner",collapsibleResultsPopupContainer:".collapsible_popup_container",collapsibleResultsPopup:".flight_summary_popup_container",collapsibleNewResultsPopup:".details_as_page .flight_summary_popup_container",resultsCloseButton:".flight_summary_popup_close",resultsContinueButton:".flight_summary_popup_continue",resultsFooterContainer:".flight_summary_popup_footer",collapseBaggageSection:".collapsible_flight_details_wrapper .collapse_baggage_section",collapseBaggageIncluded:".collapsible_flight_details_wrapper .collapse_baggage_included",airlineLogo:".airline_logo",airlineLogoTooltip:".airline_logo_tooltip",tripTo:".your_trip_to",popupContainer:".popup_container",popupNag:".collapsible_popup_container",yourTripToNag:".your_trip_to_nag",changeFlight:".change_flight_button",changeFlightButtonText:".change_flight_button_text",launchPopup:".collapsible_launch_popup",flexibilityDisruptionModalIcon:".flexibility_disruption_modal_icon",itineraryDetailsWrapper:".itinerary_details_wrapper",collapsibleFlightMainWrapper:".collapsible_flight_main_wrapper",carrierSeatTypeInfo:".carrier_seat_type_info"},renderDetails:function(){this.setTemplate(this.$el,this.options.template),this.renderFlexibilityDisruptionBanner(),this.showBoardingOptions()},renderFlexibilityDisruptionBanner:function(){var e=this;g.getLoadedPromise().then(_.bind(function(t){t&&g.isCanxFree()&&Odigeo.Templates.getGenericTemplates([h]).then(_.bind(function(e){if(_.isObject(e)){var t=_.get(e,h),i=e.getStaticTemplatesKeys(h);this.initFlexibilityDisruptionModal(t,i),this.setFlexibilityDisruptionBanner(t,i)}},e))},this))},trackWhenOnClick:function(){n.trackEvent("free-cancellation_nag","free-cancellation_open-info_when_pag:pax")},trackWhatOnClick:function(){n.trackEvent("free-cancellation_nag","free-cancellation_open-info_what_pag:pax")},trackHowOnClick:function(){n.trackEvent("free-cancellation_nag","free-cancellation_open-info_how_pag:pax")},initFlexibilityDisruptionModal:function(e,t){var i=_.get(e,"modals/modal",_.noop),n=_.get(e,"modals/content",_.noop),a=$(".flexibility_disruption_popup");this.modal=new l(a,{content:n(t),button:_.get(t,"flexibilityDisruptionPopUpCloseButton","")},{template:i,fillThePage:!1,preventContainerTap:!1,open:{analytics:{action:"free-cancellation_onload-nag",label:"free-cancellation_onload-nag_pag:pax"}},close:{analytics:{action:"free-cancellation_onload-nag",label:"free-cancellation_close-nag_pag:pax"}},button:{analytics:{action:"free-cancellation_onload-nag",label:"free-cancellation_close-info_pag:pax"}}}),a.removeClass("odf-hidden"),a.find(".flex_when_option").on("click",this.trackWhenOnClick),a.find(".flex_what_option").on("click",this.trackWhatOnClick),a.find(".flex_how_option").on("click",this.trackHowOnClick)},setFlexibilityDisruptionBanner:function(e,t){var i=_.get(e,"flexibilityDisruptionBanner",_.noop)({texts:t});this.$cachedSelectors.flexibilityDisruptionBanner.html(i),this.$cachedSelectors.flexibilityDisruptionBanner.removeClass("odf-hidden")},openFlexibilityDisruptionModal:function(){n.trackEvent("free-cancellation_trip","free-cancellation_more-trip_pag:pax"),this.modal.open(!0,!0)},isSmVersion:function(){return"collapsibleMainSm"===this.options.template},getTemplateName:function(e){return e+(this.isSmVersion()&&!this.popupRender?"Sm":"")},onAirlineLogoHover:function(e){$(e.currentTarget).prev(this.selectors.airlineLogoTooltip).toggleClass("open","mouseover"===e.type)},renderDestination:function(e,t){if(this.options.tripToOnWidget){var i=this.keys.yourTripInfo,n=Odigeo.Utils.replaceCmsKeyArgs(this.keys.yourTripInfo,this.options.destination),a=this.options.isMultidestination,s=Odigeo.Utils.pluralizeAll(this.keys.changeSearch,this.model.get("flightDetailsDTO").segments.length);this.setTemplate(e||this.$cachedSelectors.tripTo,t||this.getTemplateName("tripDestination"),{destination:n,key:i,change:s,isMultidestination:a})}},activatePopUp:function(){var e=this.getSegments();this.setTemplate(this.$cachedSelectors.popupContainer,this.getTemplateName("popupMain")),this.popupRender=!0,this.fillUnfoldedSummary(e,this.$cachedSelectors.flightDetailsWrapper),this.popupRender=!1,this.renderDestination(this.$cachedSelectors.yourTripToNag,"tripDestinationPopup"),this.flightDetailsPopup=new Odigeo.UIElements.Lightbox(this.$cachedSelectors.popupNag,{closeOnOuterClick:!0,overFullPage:!0})},launchPopup:function(){this.flightDetailsPopup.toggle(!0)},fillTechnicalStops:function(e,t,i){i.append(this.fillFlightRowTemplate(e,t,null,e.technicalStops[0],!1)),_.each(e.technicalStops,function(t,n){if(Odigeo.AB.isFlightSummaryImprovementsV1){var a=new r({section:t,keys:this.keys});i.append(a.$el),a.render()}else i.append(this.fillStopInfoTemplate(t,"tech"));1<e.technicalStops.length&&n<e.technicalStops.length-1&&i.append(this.fillFlightRowTemplate(e,n,t,e.technicalStops[n+1],!0))},this),i.append(this.fillFlightRowTemplate(e,t,e.technicalStops[e.technicalStops.length-1],null,!0))},buildTime:function(e,t){return t.timesUndefined?"--:--":Odigeo.Utils.formatDate(e,Odigeo.SessionScope.websiteDateFormats.itineraryDetailsTimeFormatMobile,!0)},fillFlightRowTemplate:function(e,t,i,n,a){var s=i&&i.departureTime?i.departureTime:e.departureTime,r=n&&n.arrivalTime?n.arrivalTime:e.arrivalTime,c=o.createAirlineSectionInfo(e);return $(this.templates.flightRow({section:e,airline:c,transportLogo:e.flight?"odf-icon-flight-right":"odf-icon-train-right",departureTime:this.buildTime(s,e),arrivalTime:this.buildTime(r,e),departureDate:Odigeo.Utils.formatDate(s,Odigeo.SessionScope.websiteDateFormats.itineraryDetailsDateFormatMobile,!0),arrivalDate:Odigeo.Utils.formatDate(r,Odigeo.SessionScope.websiteDateFormats.itineraryDetailsDateFormatMobile,!0),duration:_.isString(e.duration)?e.duration:Odigeo.Utils.convertMinutesToPattern(e.duration,this.keys.durationShortPattern),departureLocation:i&&i.location?i.location:e.departureLocation,arrivalLocation:n&&n.location?n.location:e.arrivalLocation,departureTerminal:i?null:e.departureTerminal,arrivalTerminal:n?null:e.arrivalTerminal,isTechnicalStop:a,keys:this.keys,showDate:!e.charter||e.charter&&0!==e.duration||e.charter&&0===e.duration&&0===t,isFlightSummaryImprovementsV1:Odigeo.AB.isFlightSummaryImprovementsV1}))},fillHubOrSmartHubTemplate:function(){var e=this.model.get("flightDetailsDTO"),t=_.isObject(e)&&e.smartHub;return $(this.templates.hubOrSmarthub({importantText:t?this.keys.smartHubImportantText:this.keys.hubImportantText,infoText:t?this.keys.smarthubText:this.keys.hubText}))},containsHubSections:function(e,t,i,n){var a=this.model.get("flightDetailsDTO"),s=a[e]||this.model.get(e),r=a[t]||this.model.get(t);return _.includes(s,i)&&_.includes(r,n)},onChangeSearchButton:function(){p||(p=!0,this.$cachedSelectors.changeFlightButtonText.attr("disabled","true"),this.$cachedSelectors.changeFlight.addClass("disabled"),Odigeo.trigger(this.widget.id+":changeCurrentSearch",p))},enableChangeSearch:function(e){e||(this.$cachedSelectors.changeFlightButtonText.removeAttr("disabled"),this.$cachedSelectors.changeFlight.removeClass("disabled"),p=!1)},areHubSections:function(e,t){var i="hubArrivalSectionsFlightNumbers",n="hubDepartureSectionsFlightNumbers";return this.containsHubSections(i,n,e,t)||this.containsHubSections(n,i,e,t)},isHubOrSmarthub:function(){var e=this.model.get("flightDetailsDTO");return _.isObject(e)&&(e.hub||e.smartHub)},fillStopInfoTemplate:function(e,t,i){var n=$(this.templates.stopInfo({section:e,stopDuration:Odigeo.Utils.convertMinutesToPattern(e.stopDuration,this.keys.durationShortPattern)||e.stopDuration,stopInfoTypeText:t?this.keys.technicalStopInfoType:this.keys.changePlaneStopInfoType}));return this.isHubOrSmarthub()&&this.areHubSections(i,e.flightNumber)&&n.closest(".hub_wrapper").append(this.fillHubOrSmartHubTemplate(e)),n},fillSectionTemplate:function(e,t,i,n){if(0!==e)if(Odigeo.AB.isFlightSummaryImprovementsV1){var a=t.sections[e-1],r=this.model.get("flightDetailsDTO"),o=_.isObject(r)&&r.hubInsuranceOfferDTO?r.hubInsuranceOfferDTO:{},c=new s({previousSection:a,section:i,isHubOrSmarthub:this.isHubOrSmarthub()&&this.areHubSections(a.flightNumber,i.flightNumber),hubInsurance:o,keys:this.keys});n.append(c.$el),c.render()}else n.append(this.fillStopInfoTemplate(i,null,t.sections[e-1].flightNumber));_.isEmpty(i.technicalStops)?n.append(this.fillFlightRowTemplate(i,e)):this.fillTechnicalStops(i,e,n)},getBaggageMessage:function(e){return"CHECK_IN_INCLUDED"===e?this.keys.baggageIncluded:this.keys.baggageNotIncluded},fillItineraryDetailsTemplate:function(e){var t=$(this.templates.itineraryDetails({itinerary:"itinerary"})),i=t.find(".section_wrapper"),n=e.carrier?e.carrier.code:"",a=o.isCarrierWithSmallBagInCabin(n),s=e.baggage?e.baggage.includedType:"",r="CHECK_IN_INCLUDED"===s?"odf-text-positive":"odf-text-mono-color-05",c=a?this.keys.smallBaggageIncluded:this.getBaggageMessage(s),d=t.find(".baggage_detail_wrapper");return _.each(e.sections,function(t,n){this.fillSectionTemplate(n,e,t,i)},this),Odigeo.AB.isFlightSummaryImprovementsV1&&this.isHubOrSmarthub()||this.setTemplate(d,"baggageDetail",{baggageMessageColor:r,baggageMessageText:c}),t},isCharter:function(e){return e.charter&&e.charterType&&"NOT_CHARTER"!==e.charterType},fillSegmentItemTemplate:function(e,t){var i=$(this.templates.segmentItem({segment:e,isCharter:this.isCharter(e),hasToShow:(0<e.allStops||this.options.showOnlyDetails)&&this.options.isDesktop})),n=void 0;return i.find(".itinerary_details_wrapper").append(this.fillItineraryDetailsTemplate(e)),(n=i.find(".unfolded_details_desktop")).length&&n.append(this.createFoldedSegmentTemplate(e,t)),i},getSegmentName:function(e,t){var i=this.keys[("MULTIPLE_DESTINATIONS"===t?"multipleDestination":"segmentname")+e];return"MULTIPLE_DESTINATIONS"===t?Odigeo.Utils.replaceCmsKeyArgs(this.keys.segmentname,i):i},fillSegmentHeaderTemplate:function(e,t,i){var n=$(this.templates.segmentHeader({segmentName:this.getSegmentName(t,i),duration:Odigeo.Utils.convertMinutesToPattern(e.duration,this.keys.durationShortPattern)}));return e.visible&&n.closest(".collapsible_segment_wrapper").append(this.fillSegmentItemTemplate(e,t)),n},fillCollapsibleBottomTemplate:function(){this.$cachedSelectors.collapsibleButton.append(this.templates[this.getTemplateName("collapsibleBottom")]({shallShowDetails:f?"":"odf-hidden"}))},fillFooterTemplate:function(e){if("resultsNewPopupAb"===this.options.template){var t=this.keys;this.$cachedSelectors.resultsFooterContainer.html(this.templates.resultsNewFooterAb({data:e,keys:t}))}else this.$cachedSelectors.resultsFooterContainer.html(this.templates.resultsFooter({data:e}))},createFoldedSegmentTemplate:function(e,t){var i,n=e.sections[0],a=e.sections[e.sections.length-1],s=2===Odigeo.AB.noStopsCopyTestPartition?this.keys.stopsKey2:this.keys.stopsKey,r=_.get(e,"carrier.code"),c=o.createAirlineSectionInfo(n),d=o.isBannedAirline(r,Odigeo.AB.hideBaggageInfoEnabled),l=o.isCarrierWithSmallBagInCabin(r);return i=(m=m||0<e.allStops)||this.isHubOrSmarthub()||this.isCharter(e),f=i&&this.options.isDesktop,$(this.templates[this.getTemplateName("foldedSegment")]({departureDate:Odigeo.Utils.formatDate(n.departureTime,"extendedDayDayMonth",!0),arrivalDate:Odigeo.Utils.formatDate(a.arrivalTime,"extendedDayDayMonth",!0),differenceInDays:Odigeo.Utils.getDifferenceInDays(n.departureTime,a.arrivalTime),departureTime:this.buildTime(n.departureTime,n),departureCity:n.departureLocation.city,departureCountry:n.departureLocation.country,departureIata:n.departureLocation.iata,arrivalTime:this.buildTime(a.arrivalTime,a),arrivalCity:a.arrivalLocation.city,arrivalCountry:a.arrivalLocation.country,arrivalIata:a.arrivalLocation.iata,arrivalLocation:a.arrivalLocation,departureLocation:n.departureLocation,arrivalTerminal:a.arrivalTerminal,departureTerminal:n.departureTerminal,stops:Odigeo.Utils.pluralizeAll(s,e.allStops),stopsNumber:e.allStops,numStopsColorClass:0===e.allStops&&this.options.isDirectInGreen?"odf-text-positive":"",segmentName:this.getSegmentName(t,this.model.get("tripType")),airline:c,carrierCode:n.carrier.code,carrierName:n.carrier.name,section:n,isHubOrSmarthub:this.isHubOrSmarthub(),hubOrSmartHubIcon:this.getHubOrSmartHubIconClass(t,this.model.get("tripType")),isCharter:this.isCharter(e),keys:this.keys,hideBaggage:Odigeo.AB.isFlightSummaryImprovementsV1?d||this.isHubOrSmarthub():d,hasSmallBagInCabin:l,shallShowDetails:f?"":"odf-hidden",baggageIncluded:e.baggage.includedType,duration:_.isString(e.duration)?e.duration:Odigeo.Utils.convertMinutesToPattern(e.duration,this.keys.durationShortPattern),onlyDetails:this.options.showOnlyDetails}))},getHubOrSmartHubIconClass:function(e,t){return d.isMultipleDestinations(t)?"odf-icon-flight":["odf-icon-plane-going","odf-icon-plane-returning"][e]},fillFoldedSegmentTemplate:function(e,t){var i=this.createFoldedSegmentTemplate(e,t);return e.visible&&!this.isSmVersion()&&i.closest(".collapsible_segment_wrapper").append(this.fillSegmentItemTemplate(e)),i},fillFoldedSummary:function(e,t){var i=t||this.$el.find(".collapsible_flight_details_wrapper .collapsible_content");return _.each(e,function(e,t){i.append(this.fillFoldedSegmentTemplate(e,t))},this),i},fillUnfoldedSummary:function(e,t){var i=t||this.$el.find(".flight_details_wrapper .collapsible_content").empty();return _.each(e,function(e,t){i.append(this.fillSegmentHeaderTemplate(e,t,this.model.get("tripType")))},this),this.updateDomSelectorsToCache(),i},getSegments:function(){var e=this.model.get("flightDetailsDTO");return _.isObject(e)&&e.segments?e.segments:null},initTemplate:function(){var e=this.getSegments();_.isObject(e)&&(this.renderComponents(e),this.updateDomSelectorsToCache(),this.bindViewEvents(),this.options.manualDisplay||this.expandOrCollapseFlightDetails(!u,"expandPanel"),this.toggleFoldedElements(u),this.options.isResults&&(this.toggleViewPortLock(!0),this.toggleResultsPopup(!0)),this.enhanceHint(),this.isSmVersion()&&this.activatePopUp(),this.showBoardingOptions()),this.renderDestination()},renderComponents:function(e){this.$cachedSelectors.flightDetailsWrapper=Odigeo.UIElements.collapsive.enhance(this.$cachedSelectors.flightDetailsWrapper,{triggerLauncher:"expanded-summary",triggerEvents:!0,initiallyExpanded:this.options.hideCollapsible}),this.$cachedSelectors.collapsibleFlightDetailsWrapper=Odigeo.UIElements.collapsive.enhance(this.$cachedSelectors.collapsibleFlightDetailsWrapper,{triggerLauncher:"collapsed-summary",triggerEvents:!0,initiallyExpanded:this.options.isResults}),this.fillUnfoldedSummary(e),this.setAdditionalStyles(),this.options.hideCollapsible||(this.fillFoldedSummary(e),this.fillCollapsibleBottomTemplate(),this.updateDomSelectorsToCache(),this.bindViewEvents(),this.expandOrCollapseFlightDetails(!u,"expandPanel"),this.toggleFoldedElements(u),this.enhanceHint()),!0===this.model.get("isCandidateForFareUpgrade")&&this.renderFareUpgradePanel(),this.options.isResults&&(this.fillFooterTemplate(this.model.getFooterData()),Odigeo.trigger(this.widget.id+":pushState",{}),Odigeo.trigger(this.widget.id+":listenRouteChangeToClosePopup"))},trackingOnce:_.once(function(){n.trackEvent("on_load","xfaring_info_loaded")}),enhanceHint:function(){this.$cachedSelectors.importantInfo.length&&this.widget.options.importantInfoTracking&&this.trackingOnce(),Odigeo.UIElements.hint.enhance(Odigeo.History.getPageNameFromFragment(),this.$el.find(".owc_special_rules"),{events:{tap:!0},googleAnalyticsOnOpen:{type:"trackEvent",data:{action:"xfaring_info",label:"xfaring_info_clicked"}},trigger:"flightDetails:owcSpecialRules"})},scrollToTop:function(e){e||Odigeo.Utils.scrollToElement(this.$el)},toggleFoldedElements:function(e){this.$cachedSelectors.toggleFlightDetails.toggleClass("folded",e),this.$cachedSelectors.toggleRowButtons.toggleClass("folded",e)},isDisabledCollapsible:function(){return this.options.isResults||this.options.disableCollapsible},toggleFlightDetails:function(e){!m&&"mobile"!==Odigeo.SessionScope.flow||this.isDisabledCollapsible()||$(e.target).hasClass("prevent_toggle")||(n.trackEvent("summary_widget",u?"summary_details_open":"summary_details_close"),this.expandOrCollapseFlightDetails(!u,"collapsePanel"),this.scrollToTop(u),u=!u,this.toggleFoldedElements(u))},expandOrCollapseFlightDetails:function(e,t){(e?this.$cachedSelectors.flightDetailsWrapper:this.$cachedSelectors.collapsibleFlightDetailsWrapper).trigger(t)},loadFareUpgradePanel:function(){_.extend(this.templates,Odigeo.Utils.getTemplates($(".global_templates"),{panel:".fare_upgrade_panel_template"}))},createFareUpgradePanelView:function(e){return new a({model:e,template:this.templates.panel,className:"panel"})},getFareUpgradeModel:function(e){var t=e.pricePerPassenger,i=void 0===t?0:t;return new Backbone.Model({passengerPrice:i,refundablePassengerPrice:i+this.model.get("fareUpgradePassengerPrice"),fareItinerarySearchId:"",rating:"",freeCancellationHoursApart:this.options.freeCancellationHoursApart,isFreeCancellation:this.options.isFreeCancellation,showSelectedStatus:!0,styles:{titleStyle:"odf-text-positive",titleSize:"odf-text-xl",descriptionSize:"odf-text-md",descriptionMargin:"odf-space-outer-bottom-l",priceSize:"odf-text-xl",btnSize:"odf-btn-lg",btnTextSize:"odf-text-md"}})},toggleResultsPopup:function(e){this.$cachedSelectors.collapsibleResultsPopup.toggleClass("open opened",e)},onResultsCloseButton:function(){this.toggleViewPortLock(!1),this.toggleResultsPopup(!1),this.trackCloseEvent()},onResultsContinueButton:function(){var e=this.model.getBookingData();this.toggleViewPortLock(!1),Odigeo.trigger(this.widget.id+":bookFlight",e),this.toggleResultsPopup(!1)},trackCloseEvent:function(){n.trackEvent("show_details","show_details_close_popup")},toggleViewPortLock:function(e){Odigeo.trigger(this.widget.id+":toggleViewPortLock",e)},renderFareUpgradePanel:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=this.createFareUpgradePanelView(this.getFareUpgradeModel(e)).render();this.$cachedSelectors.fareUpgradeSelectorContainer.html(t.$el),_.isUndefined(this.model.get("prices"))||this.updateFareUpgradePrices(this.model.get("prices"),this.model.get("isRefundableFareUpgradeSelected"))},showBoardingOptions:function(){var e=this.model.get("boardingOptions"),t=_.get(e,"carrierList",[]),i=_.map(t,function(e){return this.$cachedSelectors.collapseBaggageSection.filter(".collapse_baggage_section_"+e.toLowerCase())},this);_.isUndefined(e)||(this.updateDomSelectorsToCache(),this.setBoardingOptionsContainers(e,i),this.hideBaggageIncludedLabel(),this.initBoardingOptionsHint(e,i))},setBoardingOptionsContainers:function(e,t){var i=e.showWarning||!1,n=e.hint;_.forEach(t,function(t){t.find(".collapse_baggage_warning").removeClass("odf-hidden"),t.find(".collapse_baggage_warning_icon").toggleClass("odf-hidden",!i),t.find(".collapse_baggage_warning_content").html(e.text),t.find(".collapse_baggage_warning_hint").toggleClass("odf-hidden",_.isEmpty(n)),t.find(".collapse_baggage_warning_hint_content").html(n),t.find(".collapse_baggage_warning_hint_title").html(e.hint_title)})},hideBaggageIncludedLabel:function(){var e=this,t=this.model.get("boardingOptions");_.get(t,"carrierList",[]).forEach(function(t){e.$cachedSelectors.collapseBaggageIncluded.filter(".collapse_baggage_included_"+t.toLowerCase()).addClass("odf-hidden")})},initBoardingOptionsHint:function(e,t){var i=this;_.isEmpty(e.hint)||_.forEach(t,function(t){return i.initBoardingOptionsHintSection(e,t)},this)},initBoardingOptionsHintSection:function(e,t){_.isEmpty(e.hint)||_.each(t.find(".collapse_baggage_warning_hint"),function(t){Odigeo.UIElements.hint.enhance(Odigeo.History.getPageNameFromFragment(),t,{events:{tap:!0},googleAnalyticsOnOpen:this.getBoardingOptionsTrackingData(e)})},this)},getBoardingOptionsTrackingData:function(e){var t=_.get(e,"trackingData",{});return{type:"trackEvent",data:{action:"ryanair_message",label:["ryanair_message_info-",c.getTypeTrackingConstant(t.selectedType),"_legs:",t.totalNumber,"-",e.carrierCode,":",t.carrierNumber].join("")}}},computeFareUpgradePrices:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=arguments[1],i=this.model.get("fareUpgradePassengerPrice"),n=e.sumTotalPrice/this.model.getNumPassengers(),a=t?n-i:n;return{standardPrice:a,refundablePrice:a+i}},updateFareUpgradePrices:function(e,t){var i=this.computeFareUpgradePrices(e,t),n=i.standardPrice,a=i.refundablePrice;this.$el.find(".fare_upgrade_panel_button_not_selected_container .total_price").html(Odigeo.Utils.formatCurrency(n)),this.$el.find(".fare_upgrade_panel_button_selected_container .total_price").html(Odigeo.Utils.formatCurrency(a))},setAdditionalStyles:function(){this.$cachedSelectors.collapsibleFlightMainWrapper.toggleClass("odf-box odf-box-primary",!this.options.notShowAsBox),this.$cachedSelectors.flightDetailsWrapper.toggleClass("od-collapsible-cursor-default",!!this.options.defaultCursor),this.$cachedSelectors.itineraryDetailsWrapper.toggleClass("odf-bg-base",!!this.options.whiteBackground),this.$cachedSelectors.carrierSeatTypeInfo.toggleClass("odf-space-outer-top-s",!!this.options.spaceDurationCarrier)}})},function(e,t,i){"use strict";var n=i(344);e.exports=Backbone.View.extend({selectors:{stopInfoHub:".stop_info_hub"},initialize:function(e){var t=this;this.options=e,this.keys=_.clone(e.keys),this.previousSection=e.previousSection,this.section=e.section,Odigeo.Templates.getGenericTemplates(["flightsummary"]).then(function(e){var i=e.flightsummary,n=i.stopInfo,a=i.stopInfoItem;t.template=n,t.renderStop({stopInfoItem:a})})},renderStop:function(e){var t=this.options.isHubOrSmarthub;this.prepareKeys(),this.templateData={stopInfoItem:e.stopInfoItem,stopDuration:this.getStopDuration(),flight:this.isFlight(),airlineChanged:this.hasAirlineChanged(),airportChanged:this.hasAirportChanged(),terminalChanged:this.hasTerminalChanged(),isHubOrSmarthub:t,keys:this.keys}},renderHub:function(){new n({el:this.$el.find(this.selectors.stopInfoHub),hubInsurance:this.options.hubInsurance,keys:this.keys})},render:function(){this.$el.html(this.template(this.templateData)),this.options.isHubOrSmarthub&&this.renderHub()},getStopDuration:function(){return Odigeo.Utils.convertMinutesToPattern(this.section.stopDuration,this.keys.durationShortPattern)||this.section.stopDuration},isTrain:function(){return"TRN"===this.previousSection.aircraft||"TRN"===this.section.aircraft},isFlight:function(){return this.previousSection.flight&&this.section.flight&&!this.isTrain()},hasAirlineChanged:function(){return this.previousSection.carrier.code!==this.section.carrier.code},hasAirportChanged:function(){return this.previousSection.arrivalLocation.geoNodeId!==this.section.departureLocation.geoNodeId},hasTerminalChanged:function(){return!this.hasAirportChanged()&&!_.isEmpty(this.previousSection.arrivalTerminal)&&!_.isEmpty(this.section.departureTerminal)&&this.previousSection.arrivalTerminal!==this.section.departureTerminal},prepareKeys:function(){this.keys.missedConnection=Odigeo.Utils.replaceCmsKeyArgs(this.keys.missedConnection,this.previousSection.carrier.name)}})},function(e,t,i){"use strict";var n=i(0),a=i(14),s="NEWHUB162",r={results:"res",details:"pax",flightsummary:"sum",flightinfo:"info",payment:"pay"};e.exports=Backbone.View.extend({events:{"mousedown .conditions_link":"onConditionsLinkClick"},onConditionsLinkClick:function(){var e=Odigeo.History.getPageNameFromFragment(),t=this.getProductPageIdentifier(),i="open_conditions_footer_guarantee_"+s+"_pag:"+(r[e]+t);n.trackEvent("guarantee_product_information",i)},initialize:function(e){var t=this;this.options=e,this.keys=_.clone(e.keys),Odigeo.Templates.getGenericTemplates(["flightsummary"]).then(function(e){var i=e.flightsummary,n=i.stopInfoHub,a=i.stopInfoItem;t.template=n,t.renderHubStop({stopInfoItem:a})})},renderHubStop:function(e){this.templateData={stopInfoItem:e.stopInfoItem,insuranceHub:this.formatInsuranceLink(),keys:this.keys},this.render()},render:function(){this.$el.html(this.template(this.templateData))},getProductPageIdentifier:function(){return Odigeo.Utils.isRequestApp("dp")?"dp":"fl"},getInsuranceHubPolicyLink:function(){var e="results"===Odigeo.History.getPageNameFromFragment()?this.getInsuranceFromResults():this.getInsuranceFromShoppingCart();return e[_.isEmpty(e.conditionsUrlExtended)?"conditionsUrl":"conditionsUrlExtended"]||Odigeo.JCMS.hubInsurancePolicyDetailsUrl},getInsuranceFromResults:function(){var e=this.options.hubInsurance;return _.isEmpty(e)||e.policy!==s?{}:e},getInsuranceFromShoppingCart:function(){var e=a.getInstance();return e.isLoaded()?e.getInsuranceByPolicy(s):{}},formatInsuranceLink:function(){var e=this.keys,t=e.insuranceHub,i=e.policyDetails,n=this.getInsuranceHubPolicyLink(),a=_.isEmpty(n)?i:"<a class='odf-link-legal odf-link-sm odf-bold prevent_toggle conditions_link' href='"+n+"' target='_blank' data-policy='"+s+"'>"+i+"</a>";return Odigeo.Utils.replaceCmsKeyArgs(t,a)}})},function(e,t,i){"use strict";e.exports=Backbone.View.extend({initialize:function(e){var t=this;this.options=e,this.keys=e.keys,this.section=e.section,Odigeo.Templates.getGenericTemplates(["flightsummary"]).then(function(e){var i=e.flightsummary,n=i.stopInfoTechnical,a=i.stopInfoItem;t.template=n,t.renderTechnicalStop({stopInfoItem:a})})},renderTechnicalStop:function(e){this.templateData={stopInfoItem:e.stopInfoItem,stopDuration:this.getStopDuration(),keys:this.keys}},render:function(){this.$el.html(this.template(this.templateData))},getStopDuration:function(){return Odigeo.Utils.convertMinutesToPattern(this.section.stopDuration,this.keys.durationShortPattern)||this.section.stopDuration}})},function(e,t,i){"use strict";e.exports={PRICE_RANGE:{type:"accommodationFilterByPrice",label:Odigeo.Utils.capitalize(Odigeo.UIElements.translations.dynpackProduct.filterTags.PRICE_RANGE)},GUEST_REVIEWS:{type:"accommodationFilterByReview",label:Odigeo.Utils.capitalize(Odigeo.UIElements.translations.dynpackProduct.filterTags.GUEST_REVIEWS)},DISTANCE_CENTER:{type:"accommodationFilterByDistance",label:Odigeo.Utils.capitalize(Odigeo.UIElements.translations.dynpackProduct.filterTags.DISTANCE_CENTER)},HOTEL_NAME:{type:"accommodationFilterByName",label:Odigeo.Utils.capitalize(Odigeo.UIElements.translations.dynpackProduct.filterTags.HOTEL_NAME)},OUR_SELECTION:{type:"accommodationFilterByOurSelection",label:Odigeo.Utils.capitalize(Odigeo.UIElements.translations.dynpackProduct.filterTags.OUR_SELECTION)},NEIGHBOURHOOD:{type:"accommodationFilterByNeighbourhood",label:Odigeo.Utils.capitalize(Odigeo.UIElements.translations.dynpackProduct.filterTags.NEIGHBOURHOOD)},GUEST_RATING:{type:"accommodationFilterByCategory",label:Odigeo.Utils.capitalize(Odigeo.UIElements.translations.dynpackProduct.filterTags.GUEST_RATING)},AC:{type:"accommodationFilterByCustomFacilityGroups",label:Odigeo.Utils.capitalize(Odigeo.UIElements.translations.dynpackProduct.filterTags.AC)},BAR_RESTAURANT:{type:"accommodationFilterByCustomFacilityGroups",label:Odigeo.Utils.capitalize(Odigeo.UIElements.translations.dynpackProduct.filterTags.BAR_RESTAURANT)},LIFT:{type:"accommodationFilterByCustomFacilityGroups",label:Odigeo.Utils.capitalize(Odigeo.UIElements.translations.dynpackProduct.filterTags.LIFT)},FREE_AIRPORT_SHUTTLE:{type:"accommodationFilterByCustomFacilityGroups",label:Odigeo.Utils.capitalize(Odigeo.UIElements.translations.dynpackProduct.filterTags.FREE_AIRPORT_SHUTTLE)},FREE_PARKING:{type:"accommodationFilterByCustomFacilityGroups",label:Odigeo.Utils.capitalize(Odigeo.UIElements.translations.dynpackProduct.filterTags.FREE_PARKING)},FREE_WIFI:{type:"accommodationFilterByCustomFacilityGroups",label:Odigeo.Utils.capitalize(Odigeo.UIElements.translations.dynpackProduct.filterTags.FREE_WIFI)},GYM:{type:"accommodationFilterByCustomFacilityGroups",label:Odigeo.Utils.capitalize(Odigeo.UIElements.translations.dynpackProduct.filterTags.GYM)},HANDICAPPED:{type:"accommodationFilterByCustomFacilityGroups",label:Odigeo.Utils.capitalize(Odigeo.UIElements.translations.dynpackProduct.filterTags.HANDICAPPED)},HEATING:{type:"accommodationFilterByCustomFacilityGroups",label:Odigeo.Utils.capitalize(Odigeo.UIElements.translations.dynpackProduct.filterTags.HEATING)},PETS_ALLOWED:{type:"accommodationFilterByCustomFacilityGroups",label:Odigeo.Utils.capitalize(Odigeo.UIElements.translations.dynpackProduct.filterTags.PETS_ALLOWED)},ROOM_SERVICE:{type:"accommodationFilterByCustomFacilityGroups",label:Odigeo.Utils.capitalize(Odigeo.UIElements.translations.dynpackProduct.filterTags.ROOM_SERVICE)},SPA_SAUNA:{type:"accommodationFilterByCustomFacilityGroups",label:Odigeo.Utils.capitalize(Odigeo.UIElements.translations.dynpackProduct.filterTags.SPA_SAUNA)},SWIMMING_POOL:{type:"accommodationFilterByCustomFacilityGroups",label:Odigeo.Utils.capitalize(Odigeo.UIElements.translations.dynpackProduct.filterTags.SWIMMING_POOL)},APARTAMENT:{type:"accommodationFilterByType",label:Odigeo.Utils.capitalize(Odigeo.UIElements.translations.dynpackProduct.filterTags.APARTAMENT)},GUEST_HOUSE:{type:"accommodationFilterByType",label:Odigeo.Utils.capitalize(Odigeo.UIElements.translations.dynpackProduct.filterTags.GUEST_HOUSE)},HOSTEL:{type:"accommodationFilterByType",label:Odigeo.Utils.capitalize(Odigeo.UIElements.translations.dynpackProduct.filterTags.HOSTEL)},BED_AND_BREAKFAST:{type:"accommodationFilterByType",label:Odigeo.Utils.capitalize(Odigeo.UIElements.translations.dynpackProduct.filterTags.BED_AND_BREAKFAST)},HOTEL:{type:"accommodationFilterByType",label:Odigeo.Utils.capitalize(Odigeo.UIElements.translations.dynpackProduct.filterTags.HOTEL)},MOTEL:{type:"accommodationFilterByType",label:Odigeo.Utils.capitalize(Odigeo.UIElements.translations.dynpackProduct.filterTags.MOTEL)},RESIDENCE:{type:"accommodationFilterByType",label:Odigeo.Utils.capitalize(Odigeo.UIElements.translations.dynpackProduct.filterTags.RESIDENCE)},RESORT:{type:"accommodationFilterByType",label:Odigeo.Utils.capitalize(Odigeo.UIElements.translations.dynpackProduct.filterTags.RESORT)},RYOKAN:{type:"accommodationFilterByType",label:Odigeo.Utils.capitalize(Odigeo.UIElements.translations.dynpackProduct.filterTags.RYOKAN)},UNKNOWN:{type:"accommodationFilterByType",label:Odigeo.Utils.capitalize(Odigeo.UIElements.translations.dynpackProduct.filterTags.UNKNOWN)}}},function(e,t,i){"use strict";var n={className:"od-custom-marker od-custom-marker-pin",width:25,height:37};function a(e){this.el=null,this.point=null,this.position=e.position,this.config=_.extend({},n,e.config),this.setMap(e.map)}a.prototype=new window.google.maps.OverlayView,_.extend(a.prototype,{constructor:a,onAdd:function(){this.el=document.createElement("div"),this.el.className=this.config.className,this.getPanes().overlayImage.appendChild(this.el)},draw:function(){this.point=this.getProjection().fromLatLngToDivPixel(this.position),this.el.style.left=this.point.x-this.config.width/2+"px",this.el.style.top=this.point.y-this.config.height+"px"},onRemove:function(){this.el.parentNode.removeChild(this.el),this.el=null}}),e.exports=a},function(e,t,i){"use strict";var n=i(149),a="visible",s="next",r="prev",o={selectors:{container:".od-swiper-container",mask:" .od-swiper-mask",slides:" .od-swiper-slides",slide:" .od-swiper-slide"},eventMode:Odigeo.Events.tap,autoplay:!1,autoplayOptions:{intevalTime:6e3,pong:!1},direction:"horizontal",draggable:!1,draggableOptions:{dragRange:100},infinite:!1,containerModifierClass:"od-swiper-container",pagination:!1,paginationElement:"div",paginationItemElement:"label",paginationItemElementNumber:"span",paginationOptions:{paginationType:"bullets",paginationClickable:!1},paginationSelectorClass:"swiper_pagination",paginationModifierClass:"od-swiper-pagination",paginationModificatorClass:{inputClass:"input",bulletsClass:"bullet",bulletsActiveClass:"bullet-active",numbersClass:"number",numbersActiveClass:"number-active"},arrowButtons:!1,arrowElement:"div",arrowModifierClass:"od-swiper-button",arrowModificatorClass:{next:"next",prev:"prev"},arrowIcon:{class:"od-swiper-button-icon odf-icon odf-text-2lg odf-icon-arrow",element:"span",type:{next:"right",prev:"left"}}},c=function(e,t){this.idContainer=e.swiperContainer,this.$el=$(this.idContainer),this.$window=$(window),this.opts=this.getOptions(t),this.init()};c.prototype=n.extend({init:function(){return this.setSelectors(),this.setupContainer(),this.isInfinite()&&this.repositionLastSlide(),this},getOptions:function(e){return _.extend({},o,this.opts,e)},bindEvents:function(){this.$window.resize(_.bind(this.setSlideAndGoTofirst,this)),this.$slides.on(Odigeo.Events.transitionEnd,_.bind(this.onSlideMove,this))},setSelectors:function(){this.setSlide(),this.setSlidesWidth(),this.setStatusValue(this.$el,a),this.setPagination(),this.setArrowButtons(),this.bindEvents()},setSlide:function(){this.$slides=this.$el.find(this.opts.selectors.slides),this.$slide=this.$el.find(this.opts.selectors.slide),this.nSlides=this.$slide.size(),this.slidePosition=0,this.firstPostion=0,this.lastPostion=this.nSlides-1},setPagination:function(){1<=this.nSlides?(this.setPaginationNav(),this.setPaginationNavItems(),this.bindPaginationEvents(),this.setupPagination()):this.$pagination=$(),!0!==this.opts.pagination&&this.$pagination instanceof $&&this.$pagination.addClass("odf-hidden")},setPaginationNav:function(){var e=this.opts.paginationModifierClass,t="<"+this.opts.paginationElement+' class="'+e+'"></'+this.opts.paginationElement+">";this.$pagination=this.appendDomElement(this.$el,t,e)},setPaginationNavItems:function(){for(var e,t=this.opts.paginationModifierClass+"-"+this.opts.paginationModificatorClass.inputClass,i=" checked",n=this.opts.paginationOptions.paginationType,a=this.opts.paginationModifierClass+"-"+this.opts.paginationModificatorClass[n+"Class"],s="",r=0;r<this.nSlides;r++)s='<input type="radio" name="swiper-nav"  class="'+t+'" id="swiper-slide'+r+'" '+i+"/><"+this.opts.paginationItemElement+' class="'+a+" "+this.opts.paginationSelectorClass+'" for="swiper-slide'+r+'" data-slide="'+r+'"><'+this.opts.paginationItemElementNumber+' class="'+this.opts.paginationModifierClass+'-item-span"></'+this.opts.paginationItemElementNumber+"></"+this.opts.paginationItemElement+">",i="",e=this.appendDomElement(this.$pagination,s,a);this.$paginationNavItems=e},bindPaginationEvents:function(){this.$paginationNavItems.on(this.opts.eventMode,_.bind(this.onTap,this))},setArrowButtons:function(){this.opts.arrowButtons&&1<this.nSlides&&(this.$nextButton=this.setupAndGetButton(s),this.$prevButton=this.setupAndGetButton(r),this.bindArrowButtonsEvents())},bindArrowButtonsEvents:function(){this.$nextButton.on(this.opts.eventMode,_.bind(this.onNextButtonNavTap,this)),this.$prevButton.on(this.opts.eventMode,_.bind(this.onPrevButtonNavTap,this))},setupAndGetButton:function(e){var t=this.opts.arrowModifierClass+"-"+this.opts.arrowModificatorClass[e],i=this.opts.arrowIcon.class+"-"+this.opts.arrowIcon.type[e],n=$("<"+this.opts.arrowElement+">",{class:t}).append($("<"+this.opts.arrowIcon.element+">",{class:i}));return this.appendDomElement(this.$el,n,t)},setupContainer:function(){var e=[];e.push(this.getDirection()),this.addingClasses(this.$el,e),this.setAutoplay(),this.setDraggable()},getDirection:function(){return"horizontal"===this.opts.direction||"vertical"===this.opts.direction?this.opts.containerModifierClass+"-"+this.opts.direction:this.opts.containerModifierClass+"-horizontal"},setAutoplay:function(){this.opts.autoplay&&this.startAutoplay()},setDraggable:function(){this.opts.draggable&&this.initDraggable(this.$slides,this.opts.direction)},setupPagination:function(){var e=[];this.opts.pagination&&1<=this.nSlides&&(e.push(this.getPaginationPaginationType()),this.addingClasses(this.$pagination,e),this.setStatusValue(this.$pagination,a))},getPaginationPaginationType:function(){var e=this.opts.paginationOptions.paginationType;return"bullets"===e||"numbers"===e?this.opts.paginationModifierClass+"-"+e:null},startAutoplay:function(){clearInterval(this.intervalSwipper),this.intervalDirection=s,this.opts.autoplayOptions.pong?this.startAutoplayPong():this.startAutoplayNotPong()},startAutoplayPong:function(){this.intervalSwipper=setInterval(_.bind(this.autoplayPongNext,this),this.opts.autoplayOptions.intevalTime)},startAutoplayNotPong:function(){this.intervalSwipper=setInterval(_.bind(this.autoplayNotPongNext,this),this.opts.autoplayOptions.intevalTime)},autoplayPongNext:function(){!this.isAutoplayInRange()&&(this.intervalDirection=this.intervalDirection===s?r:s),this.buttonNavTap(this.intervalDirection)},autoplayNotPongNext:function(){this.isAutoplayInRange()?this.buttonNavTap(this.intervalDirection):this.gotoFirstSlide()},gotoFirstSlide:function(){this.goToSlide(0)},goToSlide:function(e){(e<this.nSlides?this.getSlideElement(e):this.getSlideElement(0)).trigger(this.opts.eventMode,this.slidePosition!=e?this.slidePosition<e?s:r:null),this.isInfinite()&&(_.parseInt(e)===this.firstPostion?this.resetFirstSlidePosition():_.parseInt(e)===this.lastPostion&&this.resetLastSlidePosition())},isAutoplayInRange:function(){var e=this.getNextStepByType(this.intervalDirection);return this.isInPosRange(e)},stopAutoplay:function(){clearInterval(this.intervalSwipper)},onTap:function(e,t){var i=this.$el.find(e.currentTarget),n=parseInt(i.attr("data-slide"),10);_.isUndefined(e.originalEvent)||(this.stopAutoplay(),this.trigger("swiper:swip",n)),this.moveSlide(n,t),e.stopPropagation()},onNextButtonNavTap:function(){this.buttonNavTap(s)},onPrevButtonNavTap:function(){this.buttonNavTap(r)},buttonNavTap:function(e){var t=this.getNextStepByType(e),i=this.isInPosRange(t),n=this.getSlideElement(t);i&&(n.trigger(this.opts.eventMode,e),this.trigger("swiper:nav",e))},moveSlide:function(e,t,i){var n=this.getSlideWidth()*e*-1;this.isInfinite()&&!i&&(n=t===s&&this.slidePosition===this.lastPostion?-1*this.getSlideWidth()-this.getSlideWidth()*this.lastPostion:t===r&&this.slidePosition===this.firstPostion?this.getSlideWidth():n),this.addTick(this.moveDragg,n,"end"),this.slidePosition=e},appendDomElement:function(e,t,i){return e.append(t),this.findElement(i)},addingClasses:function(e,t){e.addClass(t.join(" "))},setStatusValue:function(e,t){e.attr("data-status",t)},getSlideElement:function(e){return this.$pagination.find('*[data-slide="'+e+'"]')},findElement:function(e){return this.$el.find(" ."+e)},onStart:function(){this.stopAutoplay(),n.getMixin().onStart.apply(this,arguments),this.setInitialPosition()},onSlideMove:function(){var e=_.bind(function(e,t){var i=setTimeout(function(){e.css({transition:""}),clearTimeout(i)},25);e.css({transition:"none"}),this.setTranslateX(e[0],t)},this);this.isInfinite()&&(this.slidePosition<2?(this.resetFirstSlidePosition(),this.repositionLastSlide()):(this.resetLastSlidePosition(),this.slidePosition>this.lastPostion-2&&this.repositionFirstSlide()),0===this.slidePosition?e(this.$slides,0):this.slidePosition===this.lastPostion&&e(this.$slides,this.lastPostion*this.getSlideWidth()*-1)),this.trigger("swiper:swiped",{index:this.slidePosition})},onEnd:function(){this.finishMovement(arguments),n.getMixin().onEnd.apply(this,arguments)},onDrag:function(e){var t=this.calcultePosition(e.move);return this.setTranslateX(this.$slides[0],t),this},finishMovement:function(e){var t=e[0].move.x,i=t<0?s:r,n=this.getNextStepByType(i),a=this.isInDragRange(i,t),o=this.isInPosRange(n);return a&&(this.isInfinite()||o)?(this.buttonNavTap(i),this.trigger("swiper:swip",n)):this.moveSlide(this.slidePosition,i,!0),this},moveDragg:function(e){return this.setTranslateX(this.$slides[0],e),this},setInitialPosition:function(){return this.initialPosition=this.getTranslateX(),this},getNextStepByType:function(e){return this.isInfinite()?e===s?this.slidePosition===this.lastPostion?this.firstPostion:this.slidePosition+1:this.slidePosition===this.firstPostion?this.lastPostion:this.slidePosition-1:e===s?this.slidePosition+1:this.slidePosition-1},isInPosRange:function(e){return e>=this.firstPostion&&e<=this.lastPostion},isInDragRange:function(e,t){return e===s?t<-1*this.opts.draggableOptions.dragRange:t>this.opts.draggableOptions.dragRange},setSlidesWidth:function(){this.$slides.css("width",this.getSlideWidth()*this.nSlides+"px")},setSlideAndGoTofirst:function(){this.$slides.css("width",this.getSlideWidth()*this.nSlides+"px"),this.gotoFirstSlide()},getSlideWidth:function(){return this.$window.width()},calcultePosition:function(e){return this.initialPosition+e.x},isInfinite:function(){return this.opts.infinite?2<this.nSlides:this.opts.infinite},hasOnlyOneSlide:function(){return 1===this.nSlides},repositionFirstSlide:function(){this.$slide.first().css({left:this.nSlides*this.getSlideWidth()+"px"})},repositionLastSlide:function(){this.hasOnlyOneSlide()||this.$slide.last().css({left:"-100%"})},resetFirstSlidePosition:function(){this.$slide.first().css({left:""})},resetLastSlidePosition:function(){this.$slide.last().css({left:""})}},Backbone.Events),e.exports=c.prototype.constructor=c},,function(e,t,i){"use strict";var n=i(39);Odigeo.defineWidget("share_selection",Odigeo.Widget.extend({modelClass:i(351),viewClass:i(352),init:_.noop,reset:function(){this.model.reset.apply(this.model,arguments)},setShareSelectionEl:function(){this.view.setShareSelectionEl.apply(this.view,arguments)},initLauncher:function(){this.view.initLauncher.apply(this.view,arguments)},toggleLauncher:function(){this.view.toggleLauncher.apply(this.view,arguments)},renderCaptcha:function(){this.model.get("captchaEnabledWithInit")?this.enableCaptcha():this.model.set("captchaEnabled",!0)},enableCaptcha:function(){this.model.get("reCaptchaWidgetId")||(this.model.set("reCaptchaWidgetId",n.gRecaptchaRender(this.view.$cachedSelectors.captchaWrapper.get(0),_.bind(this.view.reCaptchaExecutionCallback,this.view),this.options.reCaptchaSiteKey)),this.view.$cachedSelectors.captchaWrapper.removeClass("odf-hidden"))}}))},function(e,t,i){"use strict";e.exports=Odigeo.Model.extend({defaults:{captchaEnabled:!1},dataURL:"send",url:function(){return Odigeo.Settings.getProperty("emailServiceUrlFormmater")(this.dataURL)},sendLinkByEmail:function(e){return this.fetch({data:JSON.stringify(e),dataType:"json",contentType:"application/json",type:"POST",success:_.bind(this.requestSuccessHandler,this),error:_.bind(this.requestErrorHandler,this)})},requestSuccessHandler:function(e,t){var i;i=t,_.isObject(i)&&_.contains(["SENT","QUEUED"],i.status)?this.trigger("emailSent"):this.requestErrorHandler()},requestErrorHandler:function(){this.trigger("emailSentError")},reset:function(e){var t=_.pick(this.attributes,"reCaptchaWidgetId","captchaEnabled");this.clear().set(_.extend(e,t)).trigger("resetShare")}})},function(e,t,i){"use strict";var n=i(0),a=i(39),s={copyLinkSelect:"share_link_copy_ctrlC",copyLinkClick:"share_link_copy_CTA",emailValidation:_.template("share_email_<%= type %>"),emailSent:_.template("<%= labelFunnel %>_<%= labelSent %>"),openLauncher:"share_click"},r={shareOptions:".share_options",link:".share_link",email:".share_email",shareSocialLinks:".share_social_links",shareDeeplink:".share_deeplink"},o={openLayer:{className:"active",delay:200},loading:{className:"loading",delay:1e3},finish:{className:"finish",delay:3e3},error:{className:"finish error",delay:4e3}};function c(e){this.$cachedSelectors.wrapper.toggleClass("open",e)}function d(e){var t=this.templates[e](function(){return _.defaults({shareLinksTemplate:this.templates[this.model.get("shareLinksTemplate")]},this.model.toJSON())}.call(this));this.$cachedSelectors.wrapper.html(t),c.call(this,!0)}function l(){this.model.reset(_.extend(this.model.toJSON(),{defaultPassenger:this.$cachedSelectors.inputName.val(),emailReceiver:this.$cachedSelectors.inputEmail.val(),emailComment:this.$cachedSelectors.inputComment.val()}))}function g(e,t,i,n){return e.toggleClass(t,n).delay(i).promise()}function h(e){return g(this.$shareSelectionEl,o.openLayer.className,o.openLayer.delay,e)}function u(){return g(this.$el.find(this.slctrs.content),o.loading.className,o.loading.delay,!0)}function p(){return g(this.$el.find(this.slctrs.content),o.finish.className,o.finish.delay,!0).then(_.bind(c,this,!1))}function f(){this.$el.find(this.slctrs.actionButton).addClass("disabled")}function m(e){$(this).parent().toggleClass("invalid",e)}function b(){this.$el.find(this.slctrs.inputValidation).on("blur",_.partial(m,!1)).on("blur",_.method("currentTarget.checkValidity")).on("invalid",_.partial(m,!0))}function y(e){this.setShareSelectionEl(e.currentTarget),this.model.reset(this.opts),this.trackEvent(s.openLauncher)}e.exports=Odigeo.View.extend({templates:{},opts:{},$shareSelectionEl:null,trackEvent:null,events:{"click .link_share_selection:not(.disabled)":"copyShareSelection","select .share_selection_input_deeplink":"trackEventOnUserSelection","click .email_share_selection:not(.disabled)":"checkCaptcha","click .select_share_selection":"openShareSelection","click .select_social_network":"closeShareSelection","click .share_selection_box":_.method("stopPropagation"),"click @wrapper":"closeShareSelection","click .close_share_selection":"closeShareSelection"},selectors:{wrapper:".share_selection_wrapper",inputEmail:".share_selection_input_email",inputName:".share_selection_input_name",inputComment:".share_selection_input_text",captchaWrapper:".captcha_wrapper"},slctrs:{box:".share_selection_box",content:".share_selection_content",actionButton:".share_selection_action",deepLink:".share_selection_input_deeplink",form:"#shareSelectionForm",inputValidation:".share_selection_input_email,.share_selection_input_name"},trackEventOnUserSelection:_.once(function(){this.$el.find(this.slctrs.actionButton).hasClass("disabled")||this.trackEvent(s.copyLinkSelect)}),init:function(){this.opts=Odigeo.parseOptions(this.widget.options),this.trackEvent=_.bind(n.trackEvent,n,this.opts.trackingAction),this.templates=Odigeo.Utils.getTemplates(this.$el,r),this.on("after_render_email",_.bind(b,this)),this.listenTo(this.model,"emailSent",this.onEmailSent),this.listenTo(this.model,"emailSentError",this.onEmailSentError),this.listenTo(this.model,"resetShare",this.render)},render:function(){var e=this.$shareSelectionEl.data("templateView");return h.call(this,!0).then(_.bind(d,this,e)).then(_.bind(this.updateDomSelectorsToCache,this)).then(_.bind(this.trigger,this,"after_render_"+e)).then(_.bind(h,this,!1)).then(_.bind(this.initOrRenderCaptcha,this))},initOrRenderCaptcha:function(){var e=this.model.get("captchaEnabled");this.model.set("captchaEnabledWithInit",!e),e?this.widget.enableCaptcha():(a.init(),this.model.set("captchaEnabled",!0))},copyShareSelection:function(){f.call(this),function(){u.call(this).then(_.bind(p,this))}.call(this),function(){Odigeo.Utils.copyToClipboard(this.$el.find(this.slctrs.deepLink))}.call(this),this.trackEvent(s.copyLinkClick)},onEmailSent:function(){p.call(this),this.trackEvent(s.emailSent({labelFunnel:this.opts.trackingLabelSentEmail,labelSent:"successful"}))},onEmailSentError:function(){this.opts.hasErrorConfirmation?function(){return g(this.$el.find(this.slctrs.content),o.error.className,o.error.delay,!0).then(_.bind(l,this))}.call(this):c.call(this,!1),this.trackEvent(s.emailSent({labelFunnel:this.opts.trackingLabelSentEmail,labelSent:"unsuccessful"}))},sendEmailShareSelection:function(){f.call(this),u.call(this),this.model.sendLinkByEmail(function(){return{captchaResponse:this.model.get("reCaptchaResponse"),from:function(){var e=this.opts.senderEmail||this.$cachedSelectors.inputName.val();return Odigeo.Utils.isValidEmail(e)?e:null}.call(this),to:[this.$cachedSelectors.inputEmail.val()],templateId:this.model.get("templateId"),parameters:_.extend(this.model.get("emailTemplateParams"),{comment:this.$cachedSelectors.inputComment.val(),from:this.$cachedSelectors.inputName.val()})}}.call(this)),this.trackEvent(s.emailValidation({type:"sent"}))},checkCaptcha:function(){!function(){return _.every(this.$el.find(this.slctrs.form).get(0).elements,_.method("checkValidity"))}.call(this)?this.trackEvent(s.emailValidation({type:"error"})):a.gRecaptchaExecute(this.model.get("reCaptchaWidgetId"))},reCaptchaExecutionCallback:function(){var e=this.model.get("reCaptchaWidgetId");this.model.set("reCaptchaResponse",a.gRecaptchaGetResponse(e)),this.resetReCaptcha(e),this.sendEmailShareSelection()},resetReCaptcha:function(e){this.$cachedSelectors.captchaWrapper.addClass("odf-hidden"),e&&a.gRecaptchaReset(e),this.model.set("reCaptchaWidgetId","")},setShareSelectionEl:function(e){this.$shareSelectionEl=$(e)},openShareSelection:function(e){this.setShareSelectionEl(e.currentTarget),this.trackEvent(this.$shareSelectionEl.data("trackEventLabel")),Odigeo.trigger(this.widget.id+":onUpdateShareSelection")},closeShareSelection:function(e){this.resetReCaptcha(this.model.get("reCaptchaWidgetId")),c.call(this,!1),this.trackEvent($(e.currentTarget).data("trackEventLabel"))},initLauncher:function(e){_.extend(this.opts,e),this.toggleLauncher(!0),$(this.opts.launchButton).off(Odigeo.Events.click).on(Odigeo.Events.click,_.bind(y,this))},toggleLauncher:function(e){$(this.opts.launchButton).toggleClass("odf-hidden",!e)}})},function(e,t,i){"use strict";e.exports.get=function(){return $.extend(!0,{},{cabinClass:"TOURIST",directFlightsOnly:!1,internalSearch:!0,numAdults:2,numChildren:0,numInfants:0,numberOfRooms:1,rooms:[{childrenAges:[],infantsAges:[],kidsAges:[],numAdults:2}],searchSegments:[{dateStr:"",departure:{city:"",country:"",countryCode:"",geoNodeId:null,geoNodeType:"",iata:"",itemLevel:"",matchType:"",name:"",numRelatedLocations:null,region:"",text:"",type:""},destination:{city:"",country:"",countryCode:"",geoNodeId:null,geoNodeType:"",iata:"",itemLevel:"",matchType:"",name:"",numRelatedLocations:null,region:"",text:"",type:""}},{dateStr:"",departure:{city:"",country:"",countryCode:"",geoNodeId:null,geoNodeType:"",iata:"",itemLevel:"",matchType:"",name:"",numRelatedLocations:null,region:"",text:"",type:""},destination:{city:"",country:"",countryCode:"",geoNodeId:null,geoNodeType:"",iata:"",itemLevel:"",matchType:"",name:"",numRelatedLocations:null,region:"",text:"",type:""}}],type:"roundTrip"})}},,,function(e,t,i){"use strict";$(function(){Odigeo.defineWidget("dp_upsell_activation_rules_manager",Odigeo.Widget.extend({modelClass:Odigeo.Model.extend({init:function(){this.widget.options=Odigeo.Utils.parseOptions(this.widget.options)},isTripTypeFlightAccomplished:function(e){return"roundTrip"===e.type},isOneToMaxNightsAccomplished:function(e){var t,i,n=e.searchSegments,a=Odigeo.AB.isIntermediatePageForOwDesktop&&1===n.length?1:0,s=this.widget.options.maxNights;return 1<n.length&&(t=new Date(n[0].dateStr),i=new Date(n[1].dateStr),a=Odigeo.Utils.getDifferenceInDays(t.getTime(),i.getTime())),0<a&&a<=s},isMaxDaysToDepartureAccomplished:function(e){var t=e.searchSegments,i=new Date(t[0].dateStr);return Odigeo.Utils.getDifferenceInDays((new Date).getTime(),i.getTime())<=this.widget.options.maxDaysToDeparture||0===this.widget.options.maxDaysToDeparture},isDepartureOnlyAccomplished:function(e){var t=(new Date(e.searchSegments[0].dateStr).getDay()+1).toString(),i=this.widget.options.departureOnly;return _.includes(i,t)},isMaxPassengersAccomplished:function(e){var t=Odigeo.Utils.parseOptions({numAdults:e.numAdults,numChildren:e.numChildren,numInfants:e.numInfants});return t.numAdults+t.numChildren+t.numInfants<=this.widget.options.maxPassengers},isCurrentLessThanMaxAppearancesPerSessionAccomplished:function(){var e=Odigeo.Session.get("dpupsellactivationrules-manager-appearances");return 0===this.widget.options.maxAppearancesPerSession||_.isEmpty(e)||e<this.widget.options.maxAppearancesPerSession},areAirlinesIncludedToShowIP:function(e){var t=this.widget.options.excludedAirlines;return _.every(t,function(t){return _.every(e.flightNumbers,function(e){return!_.includes(e,","+t)})})},areDatesRestrictionsAccomplished:function(e){return this.isOneToMaxNightsAccomplished(e)&&this.isMaxDaysToDepartureAccomplished(e)},isMktPortal:function(){return Odigeo.SessionScope.mktPortal.toLowerCase()===this.widget.options.mktPortal&&Odigeo.AB.isIntermediatePageForOwDesktop},checkRules:function(e){return this.areDatesRestrictionsAccomplished(e)&&this.isTripTypeFlightAccomplished(e)&&this.isDepartureOnlyAccomplished(e)&&this.isMaxPassengersAccomplished(e)&&this.isCurrentLessThanMaxAppearancesPerSessionAccomplished()&&this.areAirlinesIncludedToShowIP(e)},areActivationRulesAccomplished:function(e){var t=e.searchParams;return"multipleTrip"!==t.type&&(this.isMktPortal()||this.checkRules(t))}}),dic:{areActivationRulesAccomplished:"areActivationRulesAccomplished",set:"set"},execute:function(e,t){if(_.includes(this.dic,e)&&_.isFunction(this.model[this.dic[e]])){var i=this.model[this.dic[e]](t);switch(e){case"areActivationRulesAccomplished":return i;default:return this}}}}))})},function(e,t,i){"use strict";var n=i(707),a=i(708),s=i(160),r=i(27),o={ED:"edreams",OP:"opodo",TL:"travel-link",GV:"go-voyages"};e.exports=function(e){var t={},i=r.getPassengers(e.travellers);return t.flights={arrival:n(e.itineraryBookings),departure:a(e.itineraryBookings)},t.client=s(e),t.trip={getNumberOfPassengers:function(){return e.travellers.length},getDurationInDays:function(){var e=t.flights.arrival.getDate(),i=t.flights.departure.getDate();return Odigeo.Utils.getDifferenceInDays(e,i)},getType:function(){return e.itineraryBookings.bookingItinerary.tripType},getPassengers:function(){return i},getCurrencyCode:function(){return e.price.currency},getPrice:function(){return e.price.amount},hasHotelBooked:function(){return!_.isEmpty(e.accomodationBooking)}},t.appContext={getBrand:function(){var e=Odigeo.SessionScope.brand;return _.get(o,e,"")},getLanguage:function(){return _.get(Odigeo.SessionScope,"tmParam.language","en")}},t}},function(e,t,i){"use strict";var n,a=i(0),s="nagClass_";(n=function(e,t){t=t||document.body,this.$parent=t instanceof $?t:$(t),e=_.merge({selectors:{acceptButtonSelector:".nag_btn_accept",rejectButtonSelector:".nag_btn_reject"},template:"",doNotShowIfSameNagClassAlreadyShown:!0,showThisInstanceJustOnce:!0,nagClass:"",instanceID:"",tracking:{accept:"",reject:"",appears:""},translations:{image:"",title:"",subtitle:"",subtitleBold:"",button1:"",button2:""}},e),this.type=null,this.translations=e.translations,this.selectors=e.selectors,this.templateBuilder=_.isFunction(e.template)?e.template:_.template(e.template,Odigeo.Utils.getTmplSettings()),this.instanceID=e.instanceID,this.sessionStorageInstanceID=_.isEmpty(this.instanceID)?null:"nagInstance_"+e.instanceID,this.class=e.nagClass,this.sessionStorageClass=_.isEmpty(this.class)?null:s+this.class,this.updateTracking(e.tracking),this.initSessionStorageData(),this.showThisInstanceJustOnce=!0===e.showThisInstanceJustOnce,this.doNotShowIfSameNagClassAlreadyShown=!_.isEmpty(this.class)&&!0===e.doNotShowIfSameNagClassAlreadyShown}).NAG_LOCAL_EVENTS=new Odigeo.Enum(["onAcceptNag","onRejectNag","onNagDisposed"]),n.NAG_TYPE=new Odigeo.Enum(["reject","continuance","confirmation"]),n.NAG_STATES=new Odigeo.Enum(["accept","reject","appears"]),n.NAG_EVENTS_ID="nag",n.NAG_TRACKING_ACTION="nags",n.getNagClassSessionStorageData=function(e){return Odigeo.Utils.parseJson(Odigeo.Session.storage.getItem(s+e))},n.setNagClassSessionStorageData=function(e,t){!_.isUndefined(t)&&_.isObject(t)&&Odigeo.Session.storage.setItem(s+e,JSON.stringify(t))},n.isNagClassAlreadyBeenShown=function(e){var t=n.getNagClassSessionStorageData(e);return!_.isEmpty(t)&&!0===t.classShown},_.extend(n.prototype,{initSessionStorageData:function(){var e=_.isEmpty(this.class)?null:_.extend({classShown:!1},n.getNagClassSessionStorageData(this.class));_.isEmpty(this.sessionStorageInstanceID)||(e[this.sessionStorageInstanceID]={shown:!1}),this.sessionStorageData=e},generateHtml:function(){_.isUndefined(this.$nagContainer)&&(this.$nagContainer=$(this.templateBuilder({translations:this.translations})),this.$buttonAccept=this.$nagContainer.find(this.selectors.acceptButtonSelector),this.$buttonReject=this.$nagContainer.find(this.selectors.rejectButtonSelector),this.bindNagButton(this.$buttonAccept,n.NAG_STATES.accept,_.bind(this.trigger,this,n.NAG_LOCAL_EVENTS.onAcceptNag,this.type)),this.bindNagButton(this.$buttonReject,n.NAG_STATES.reject,_.bind(this.trigger,this,n.NAG_LOCAL_EVENTS.onRejectNag,this.type)),this.$parent.append(this.$nagContainer))},clean:function(){this.type=null,this.lightBox.off(),this.lightBox=null,this.$nagContainer.empty(),this.$nagContainer=null,this.$buttonAccept.off(),this.$buttonAccept=null,this.$buttonReject.off(),this.$buttonReject=null},show:function(e){this.type=n.NAG_TYPE[e];var t=!_.isUndefined(this.type),i=this.showThisInstanceJustOnce&&this.hasBeenInstanceShown||this.doNotShowIfSameNagClassAlreadyShown&&this.hasBeenNagClassShown;return!(!t||i||(_.isUndefined(this.$nagContainer)&&this.generateHtml(),this.lightBox=new Odigeo.UIElements.Lightbox(this.$nagContainer,{closeOnOuterClick:!1,focusClass:".nag_btn_reject"}),this.hasBeenInstanceShown=!0,this.lightBox.toggle(!0),this.trackByState(n.NAG_STATES.appears),0))},dispose:function(){_.isUndefined(this.lightBox)||(this.lightBox.on("remove",_.bind(this.onNagDisposed,this)),this.lightBox.remove())},onNagDisposed:function(){this.clean(),this.trigger(n.NAG_LOCAL_EVENTS.onNagDisposed)},bindNagButton:function(e,t,i){e.on(Odigeo.Events.tap,_.bind(function(e){e.preventDefault(),e.stopPropagation(),this.trackByState(t),this.dispose(),(i||_.noop)()},this))},updateTracking:function(e,t){this.tracking=_.isPlainObject(e)&&!_.isEmpty(e)?e:this.tracking,this.tracking.page=_.isString(t)?t:this.tracking.page},getTrackingData:function(e){var t=this.tracking[e],i=this.tracking.page||Odigeo.History.getPageNameFromFragment();return{action:t.action||n.NAG_TRACKING_ACTION,label:t.label,page:i,optimize:t.optimize}},trackByState:function(e){if(!_.isUndefined(n.NAG_STATES[e])&&!_.isEmpty(this.tracking[e])){var t=this.getTrackingData(e);a.trackEvent(t.action,t.label,t.page,t.optimize)}}},Odigeo.Events),Object.defineProperty(n.prototype,"sessionStorageData",{get:function(){return n.getNagClassSessionStorageData(this.class)},set:function(e){n.setNagClassSessionStorageData(this.class,e)}}),Object.defineProperty(n.prototype,"hasBeenNagClassShown",{get:function(){return!_.isEmpty(this.sessionStorageData)&&!0===this.sessionStorageData.classShown},set:function(){if(!_.isEmpty(this.sessionStorageData)){var e=this.sessionStorageData;e.classShown=!0,this.sessionStorageData=e}}}),Object.defineProperty(n.prototype,"hasBeenInstanceShown",{get:function(){return!_.isEmpty(this.sessionStorageData)&&!_.isEmpty(this.sessionStorageData[this.sessionStorageInstanceID])&&!0===this.sessionStorageData[this.sessionStorageInstanceID].shown},set:function(){if(!_.isEmpty(this.sessionStorageData)){var e=this.sessionStorageData;_.isEmpty(e[this.sessionStorageInstanceID])||(e[this.sessionStorageInstanceID].shown=!0,this.sessionStorageData=e),this.hasBeenNagClassShown=!0}}}),e.exports=n.prototype.constructor=n},function(e,t,i){"use strict";var n,a=function(){var e,t,i,n,a={ancillary:Odigeo.Settings.getProperty("ancillariesUrlFormatter")("addancillaries"),serviceOptions:Odigeo.Settings.getProperty("serviceOptionsUrlFormatter")("addserviceoption")},s={};function r(){s={}}function o(e){s={tmParam:e}}function c(t){$.ajax({url:t,dataType:"json",type:"post",contentType:"application/json",data:JSON.stringify(e),success:d,error:l})}function d(e){_.has(e,"errors")&&_.isArray(e.errors)&&0<e.errors.length?Odigeo.trigger("radicalShoppingCart:requestError",e):(o(e.tmParam),Odigeo.trigger(i+":navigateToNextPage",n))}function l(e){Odigeo.Model.prototype.afterLoadData(e)}return{configureShoppingCart:function(a,s,r,o){t=a,i=s,e={bookingId:r,insuranceOffers:["none"],nextPage:"payment"===(n=o).path?"PAYMENT_PAGE":"PRODUCT_PAGE",promotionalCodes:[],removeAncillaryServices:!0,serviceOptions:{postsellServiceOptionRequest:{}},pageToGo:_.isUndefined(o.params)?o.path:o.params}},setServiceOption:function(t){e.serviceOptions=t},removeServiceOptions:function(){e.serviceOptions={postsellServiceOptionRequest:{}}},setAncillary:function(t){this.removeAncillary("none",!1),_.isEmpty(t)||-1!==e.insuranceOffers.indexOf(t)||e.insuranceOffers.push(t)},removeAncillary:function(t,i){i=!1!==i;var n=e.insuranceOffers.indexOf(t);-1!==n&&e.insuranceOffers.splice(n,1),i&&!e.insuranceOffers.length&&e.insuranceOffers.push("none")},submitProduct:function(){r(),c(a[t])},submitProductPerPage:function(){r();var e=Odigeo.History.getFragment(),i=Odigeo.History.getPageNameFromFragment(),n=e.replace(i,"").replace(/\//g,"");c(a[t]+"/"+n)},sendEnsightenTagmanData:function(e){Odigeo.Utils.ensighten(s.tmParam,null,null,e)},setTagmanData:o}};e.exports=a,e.exports.getInstance=function(){return _.isUndefined(n)&&(n=new a),n}},function(e,t,i){"use strict";var n=i(496);e.exports={renderPremiumBubble:function(e){var t,i,a,s,r,o=e.$cachedSelectors,c=e.options,d=e.membershipSettings;r=d,_.isEqual(Odigeo.Utils.getAppInGlobalScope(),"dp")||!r.isMemberLogged&&Odigeo.Membership.isMembershipPrimePaymentD&&"details"===Odigeo.History.getPageNameFromFragment()||(this.premiumBubbleTmpl=_.template(o.premiumBubbleTemplate.html(),e.templateSettings),_.isUndefined(d.membershipPrice)||(i=Odigeo.Utils.formatCurrency(d.membershipPrice),t=Odigeo.Utils.replaceCmsKeyArgs(c.translations.premiumBubble.positiveText,i)),o.premiumBubbleContent.html(this.premiumBubbleTmpl({data:{status:n.getStatus(d,c.page),texts:{positiveText:t||"",warningText:c.translations.premiumBubble.warningText,informativeText:c.translations.premiumBubble.informativeText}}})),Odigeo.Membership.isMembershipPrimePaymentD&&o.primePersuasionMessage&&o.primePersuasionMessage.toggleClass("odf-hidden",(a=d,s=c.page,!(Odigeo.Membership.isMembershipPrimePaymentD&&"payment"===s&&a.isCheapestPriceSelected&&!a.isSubscriptionAdded&&!a.isMemberLogged))))},updatePriceMemberDisplayPrices:function(e){var t,i,n=Odigeo.Utils,a="discount"===e.action||e.isSubscriptionAdded?"login":e.action,s=e.options,r="login"===a,o="noDiscount"===a,c=s.membershipCcFee<0?s.membershipCcTextNeg:s.membershipCcTextPos,d=r||o?s.membershipDiscountText:c,l=Odigeo.Membership.isMembershipProductEnabled&&!Odigeo.Utils.isRequestApp("dp")&&!Odigeo.SessionScope.isMeta&&o,g=!r&&!o||l?s.membershipCcFee:s.membershipDiscount,h=Odigeo.AB.isMemberSmoothSubscription||l||!o?g:0;(i=(t={isLogin:r,isNoDiscount:o,showPbDisclaimers:"login"!==e.action&&!e.isSubscriptionAdded,feeText:d,disclaimerText:o?s.membershipDisclaimerDiscountNotApplied:s.membershipDisclaimerDiscountApplied,fee:o&&Odigeo.AB.isPriceWidgetOnTop&&Odigeo.SessionScope.mktPortal&&"details"===Odigeo.History.getPageNameFromFragment()?s.membershipCcFee:h,formattedFee:n.formatCurrency(+g,_.extend({},n.Currency,{negationSymbol:"- "})),$cachedSelectors:e.$cachedSelectors,$widget:e.$widget}).$cachedSelectors).membershipPriceDisplayCcFee.toggleClass("od-pricebreakdown-membership-discount-fee",t.isLogin).toggleClass("od-pricebreakdown-membership-discount-fee-warning",t.isNoDiscount),i.membershipPriceDisplayFeeText.html(t.feeText),i.membershipPriceDisplayFeeValue.attr("data-fee",t.fee),i.membershipPriceDisplayFeeValue.toggleClass("od-pricebreakdown-membership-discount-fee-slashed",t.isNoDiscount).html('<span class="odf-icon odf-icon-star odf-icon-left od-pricebreakdown-table-content-infotable-star-color"></span>'+t.formattedFee),i.membershipPriceDisplayDisclaimerTxt.text(t.disclaimerText),i.membershipPriceDisplayDisclaimer.toggleClass("odf-hidden",!t.showPbDisclaimers),Odigeo.trigger("getTotalByFullprice",t.$widget)},updatePromocode:function(e){var t,i=e.$cachedSelectors.promocodeContainer,n=_.isEmpty(e.promoCode)?0:e.promoCode.allPrice;i.toggleClass("odf-hidden",0===n),(t=i.find(".od-js-all-price")).html(Odigeo.Utils.formatCurrency(n)),t.attr("data-all-price-promocode",n),Odigeo.trigger("getTotalByFullprice",e.$widget)}}},function(e,t,i){"use strict";var n=i(0),a={0:"cheapest_payment_method",1:"visa_credit",2:"mastercard_credit",4:"visa_debit",8:"mastercard_debit",9:"american_express",12:"visa_entropay",15:"agos_edreams"},s={date0:"date_departure_leg_1_error",date1:"date_arrival_leg_1_error",departure:"location_departure_leg_1_error",destination:"location_arrival_leg_1_error",checkSeparateStay:"separate_stay_search_",getError:function(e){return"search_"+e+"_FE_error"},directFlights:"direct_flights_checked",cabinClass:"cabin_class_",numPax:"number_pax_"},r=function(e){this.opts=e,this.action=e.action};_.extend(r.prototype,{getRoomsLabel:function(e){return _.reduce(e.rooms,function(e,t,i){return e+"_num:"+ ++i+"_adu:"+t.numAdults+"_child:"+t.childrenAges.length},"rooms:"+e.numberOfRooms)},getPayMethodLabel:function(e){return"payment_method_apply_"+_.property(e.collectionMethod)(a)},getCheckBoxSeparateStayLabel:function(e){var t=e.checkInDate!==e.searchSegments[0].dateStr||e.checkOutDate!==e.searchSegments[1].dateStr?"YES":"NO";return s.checkSeparateStay+t},getPaxLabel:function(e){var t=e.numAdults+"_"+e.numChildren+"_"+e.numInfants,i=Odigeo.Utils.parseJson(Odigeo.Session.get("oldSearchParameters")),n="_old_"+i.numAdults+"_"+i.numChildren+"_"+i.numInfants;return s.numPax+t+n},getCabinClassLabel:function(e){return s.cabinClass+e.cabinClass.toLowerCase()},getDirectFlightsOnlyLabel:function(){return s.directFlights},getInvalidErrorLabel:function(e){var t="date"===e.key?e.key+e.index:e.key;return s[t]},setAction:function(e){this.action=e},isValidPaymentMethod:function(e){var t=parseInt(e,10);return!_.isNaN(t)&&_.isNumber(t)&&_.includes(_.keys(a),e)&&_.includes(["home","flights","dp","upsell"],Odigeo.Utils.getAppInGlobalScope())},getInvalidTypeErrors:function(e){return _.filter(e,function(e){return"date"===e.key||"invalid"===e.type})},trackEventsOnSubmit:function(e){"searcher_flights"===this.action?(n.trackEvent(this.action,this.getPaxLabel(e),this.opts.page),n.trackEvent(this.action,this.getCabinClassLabel(e),this.opts.page),$(".ip_direct_flight_switcher").is(":checked")&&n.trackEvent(this.action,this.getDirectFlightsOnlyLabel(),this.opts.page)):(n.trackEvent(this.action,this.getRoomsLabel(e),this.opts.page),$("#check-separatestay").is(":checked")&&n.trackEvent(this.action,this.getCheckBoxSeparateStayLabel(e),this.opts.page))},trackEventsOnError:function(e,t){var i=this.getInvalidTypeErrors(e);n.trackEvent(this.action,s.getError(t),this.opts.page),_.each(i,function(e){n.trackEvent(this.action,this.getInvalidErrorLabel(e),this.opts.page)},this)}}),e.exports=function(e){return new r(e||{})}},function(e,t,i){"use strict";e.exports={didTabClose:function(e,t){var i=$.Deferred();return _.delay(function(){i.resolve(!e||e.closed||void 0===e.closed)},t),i.promise()},searchExtensionShown:function(){Odigeo.Session.set("isSearchExtensionShown","true")}}},,function(e,t,i){"use strict";e.exports=function(e){return Odigeo.Router.handlers.dpredirect=function(t,i){$(function(){return Odigeo.Router.navigate(_.get(e,t+".to"),{params:i.concat(_.get(e,t+".params","")),trigger:!0,replace:!0})})}}},function(e,t,i){"use strict";e.exports=function(){var e=[],t=void 0,i=void 0,n=void 0,a=!1,s=void 0,r=void 0,o=!1,c=[],d={dep:{},ret:{}};this.process=function(e){var i=e.$cal,n=e.options,o=this.getOppositeFlight(n),c=!1;_.defer(function(){Odigeo.trigger("CalendarFaresManager:process",a)}),a=!(!n.faresInCalendar||n.type!==t||n.hideFaresInCalendar)&&(this.bindCalendarClickEvent(i,n.index),(r=n.hasFaresInCalendarLegendWithAmount)?c=this.addFaresWithAmount(i,o,n.index):(s=this.filter(o),_.each(s,_.bind(function(e){var t=i.find(".day_"+e.date+":not(.disabled)");t.addClass("od-fares od-fares-"+e.fare+" fares_"+e.fare),c=this.dayHasFares(t,e)},this))),c||a)},this.dayHasFares=function(e,t){return e.attr("data-fare",t.fare).attr("data-amount",t.amount).length&&("cheaper"===t.fare||"expensive"===t.fare)},this.addFaresWithAmount=function(e,t,i){var n=!1,a=1;return t&&0===i?(e.find("[data-range=end]").addClass("od-fares-range-hidden"),a=.4):t&&1===i&&(e.find("[data-range=start]").addClass("od-fares-range-hidden"),a=.6),e.find(".calendar_day").addClass("od-fares-amount"),s=this.filter(t),_.each(s,_.bind(function(t){var i,s,r,o,c,d,l=Odigeo.Utils.formatCurrency(a*t.amount,{decimalPlaces:0}),g=l.length;g<=4&&((i=e.find(".day_"+t.date+":not(.disabled)")).attr("data-range")&&!i.hasClass("od-fares-range-hidden")||(s="cheaper"===t.fare?"odf-text-positive":"odf-text-soft"),r=4===g?"od-fares-currency-hidden":"",o=$("<div>",{class:"odf-text-sm odf-strong "+s}),c=$("<span>",{text:l}),d=$("<span>",{class:r,html:Odigeo.Utils.Currency.currencySign}),"back"===Odigeo.Utils.Currency.currencyPosition?o.append([c,d]):o.append([d,c]),i.addClass("fares_"+t.fare),i.append(o),n=this.dayHasFares(i,t))},this),a),n},this.bindCalendarEvent=function(){Odigeo.on("Odigeo.ui.calendar:renderMonth",_.bind(this.process,this))},this.bindCalendarClickEvent=function(e,t){var i=Odigeo.Events.tap+".calendarFaresManager",n=_.bind(this.onDayCellClick,this,t);e.off(i).on(i,".od-ui-calendar-day",n)},this.onDayCellClick=function(e,t){var i=$(t.target).closest(".calendar_day"),n=i.attr("data-amount");c[e]=i.attr("data-fare"),this.updateSelectedAmountTracking(n,e),Odigeo.trigger("CalendarFaresManager:onDateSelect",{available:a,cheaper:this.hasSelectedAnyCheaperFare(),trackingFaresSearchData:d})},this.updateSelectedAmountTracking=function(e,t){var i="N/A",n="N/A";"cheaper"===c[t]?n="G":"expensive"===c[t]&&(n="R"),0===t?(o&&r?(i=e?.4*e:null,_.isEmpty(d.ret)||(d.ret.selectedAmount=e?.6*e:null)):i=r?e||null:n,d.dep.selectedAmount=i):(r?(i=e?.6*e:null,_.isEmpty(d.dep)||(d.dep.selectedAmount=e?.4*e:null)):i=n,d.ret.selectedAmount=i)},this.parseFares=function(i){t=_.some(i,"returnDate")?"dual":"single",e=_.map(i,function(e){return{departureDate:e.departureDate||null,returnDate:e.returnDate||null,amount:e.apparentPrices.amount}}),Odigeo.AB.faresInCalendar===Odigeo.Utils.Partition.D||Odigeo.AB.faresInCalendarMobile===Odigeo.Utils.Partition.D?this.setCurrentAmountInFareFromCurrentSearch():this.removeFareFromCurrentSearch()},this.removeFareFromCurrentSearch=function(){_.isObject(n)&&_.remove(e,function(e){return e.departureDate===n.departureDate&&(!e.returnDate||e.returnDate===n.returnDate)})},this.setCurrentAmountInFareFromCurrentSearch=function(){_.isObject(n)&&i&&_.each(e,function(e){e.departureDate!==n.departureDate||e.returnDate&&e.returnDate!==n.returnDate||(e.amount=i)})},this.filter=function(t){var n=_(e);if(!i)return[];if(_.isObject(t)){var a=t.departureDate?"returnDate":"departureDate";n=_(e).filter(t).map(function(e){return{date:e[a],amount:e.amount}})}return Odigeo.AB.faresInCalendar!==Odigeo.Utils.Partition.D&&Odigeo.AB.faresInCalendarMobile!==Odigeo.Utils.Partition.D||this.setCurrentAmountInFareFromCurrentSearch(),n.map(function(e){var t=parseInt(Odigeo.Utils.formatCurrency(e.amount,{decimalPlaces:0})),n=parseInt(Odigeo.Utils.formatCurrency(i,{decimalPlaces:0}));return{date:e.date||e.departureDate,fare:t<=n?"cheaper":"expensive",amount:e.amount}}).value()},this.getOppositeFlight=function(e){if("single"===e.type)return o=!1,null;o=!0;var t=function(e){return Odigeo.Utils.formatDate(e,Odigeo.Utils.formatDate.masks.isoDate)};return 0===e.index?{returnDate:t(e.dates[1])}:{departureDate:t(e.dates[0])}},this.setFares=function(t){e=t},this.getFares=function(){return e},this.hasSelectedAnyCheaperFare=function(){return _.includes(c,"cheaper")},this.setCurrentAmount=function(e){i=e},this.setCurrentSearch=function(e){n={departureDate:_.get(e,"searchSegments[0].dateStr"),returnDate:_.get(e,"searchSegments[1].dateStr")}},this.bindCalendarEvent(),this.cleanFares=function(){e=[]},this.getMinPriceInCalendar=function(e){var t=s.length?_.min(s,"amount").amount:0;return parseInt(t*e,10)},this.getMaxPriceInCalendar=function(e){var t=s.length?_.max(s,"amount").amount:0;return parseInt(t*e,10)},this.getAveragePriceInCalendar=function(e){var t=s.length?_.sum(s,"amount")/s.length:0;return parseInt(t*e,10)},this.openCalendarFaresTrackingLabel=function(e){var t,n=s?s.length:0,a="N/A",c="N/A",l="N/A",g=Odigeo.Storage.get("numSearchFares"),h=1;return o&&"dep"===e?h=.4:o&&"ret"===e&&(h=.6),r&&(a=this.getMinPriceInCalendar(h),c=this.getMaxPriceInCalendar(h),l=this.getAveragePriceInCalendar(h)),t=parseInt(i*h,10),g?10<g&&(g=10):g=1,d[e]={currentPrice:t,cheapestPrice:a,mostExpensivePrice:c},"open_change_dates_"+e+"_op:"+n+"_pr:"+t+"_pc:"+a+"_pe:"+c+"_pa:"+l+"_"+g}}},function(e,t,i){"use strict";var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),a=i(0),s=i(322),r=new Odigeo.Enum(["add","remove"]),o=["CONFIRMATION_SMS","BAGGAGE_ASSISTANCE","POSTED_TICKET","EVISA","ESTA"],c=function(e,t,i){return e.replace(d.PARAM_REGEXP,(n=t,_.includes(o,n)?n.replace(/_/g,""):n)).replace(d.PRODUCT_REGEXP,i);var n},d=function(){function e(t,i,n,a,s,r){!function(t,i){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this),this.product=t,this.eventsDictionary=i||{},this.ancillaryClassByPolicyMap=n||{},this.ancillaryClasses=a||[],this.pages=s||{},this.nagTrackEvents=r||{},this.initOnLoadProductsTrackingArray()}return n(e,[{key:"trackEvent",value:function(e,t,i){var n=this;if(_.isArray(t))_.isEmpty(t)?this.trackEvent(e,"0",i):_.each(t,function(t){n.trackEvent(e,t,i)});else{var s=this.getTrackData(e,t,i);a.trackEvent(s.action,s.label,s.page)}}},{key:"getPageToTrack",value:function(){var e=Odigeo.History.getFragment().replace(/^\/|\/$/g,""),t=Odigeo.History.getPageNameFromFragment().split("/")[0],i=_.get(this.pages,"['"+Odigeo.SessionScope.flow+"']['"+t+"']",t),n=_.get(this.pages,"['"+Odigeo.SessionScope.flow+"']['"+e+"']",i);return _.isUndefined(n)?t:n}},{key:"getTrackData",value:function(e,t,i){var n,a,s,r=(n=t,_.includes(o,n)?"extra":"guarantee"),l=this.eventsDictionary[e];return{page:i||this.getPageToTrack(),action:(a=l.action,s=r,a.replace(d.PRODUCT_REGEXP,s)),label:c(l.label,t,r)}}},{key:"getNagTrackData",value:function(e,t){return _.get(this.nagTrackEvents,"['"+e+"']['"+t+"']","")}},{key:"initOnLoadProductsTrackingArray",value:function(){var e=this.ancillaryClasses||[];this.onLoadProductsTrackingArray=function(e){for(var t=[],i=0;i<e;i++)t.push(0);return t}(e.length),this.waitingForOnLoadTracking=0}},{key:"willTrackOnLoadOfSomeProducts",value:function(){this.waitingForOnLoadTracking++}},{key:"hasTrackedOnLoadOfSomeProducts",value:function(){this.waitingForOnLoadTracking--,this.waitingForOnLoadTracking<0&&(this.waitingForOnLoadTracking=0)}},{key:"trackOfferedProducts",value:function(t,i){var n,a,r;i&&(n=this.getPageToTrack(),a=this.product,r=s.getRegisteredOfferedPolicies(n),t=_.get(r,a,[])),_.isArray(t)||(t=[]);var o=!0,c=!1,d=void 0;try{for(var l,g=t[Symbol.iterator]();!(o=(l=g.next()).done);o=!0){var h=l.value,u=this.ancillaryClassByPolicyMap[h]||e.UNKNOWN_CLASSES_ENUM.UNKNOWN,p=this.ancillaryClasses.indexOf(u);this.onLoadProductsTrackingArray[p]=1}}catch(t){c=!0,d=t}finally{try{!o&&g.return&&g.return()}finally{if(c)throw d}}if(this.hasTrackedOnLoadOfSomeProducts(),0===this.waitingForOnLoadTracking){var f=this.onLoadProductsTrackingArray.join("-");this.onLoadProduct(f),this.initOnLoadProductsTrackingArray()}}},{key:"registerOffer",value:function(e){s.registerOfferedPolicy(this.product,e,this.getPageToTrack())}},{key:"prepareTrackEventFunction",value:function(e){return _.partial(this.trackEvent,e)}},{key:"addOrRemoveProduct",value:function(e,t,i){var n=i?"_after_mandatory":"",a=""+(t?r.add:r.remove)+n;this.trackEvent(a,e)}}]),e}();d.UNKNOWN_CLASSES_ENUM=new Odigeo.Enum(["UNKNOWN"]),d.PARAM_STRING="<param>",d.PRODUCT_STRING="<productStringValue>",d.PARAM_REGEXP=new RegExp(d.PARAM_STRING,"g"),d.PRODUCT_REGEXP=new RegExp(d.PRODUCT_STRING,"g"),d.prototype.onLoadProduct=d.prototype.prepareTrackEventFunction("onload"),d.prototype.addProduct=d.prototype.prepareTrackEventFunction("add"),d.prototype.removeProduct=d.prototype.prepareTrackEventFunction("remove"),d.prototype.openDetails=d.prototype.prepareTrackEventFunction("open_details"),d.prototype.closeDetails=d.prototype.prepareTrackEventFunction("close_details"),d.prototype.continue=d.prototype.prepareTrackEventFunction("continue"),d.prototype.addedBubble=d.prototype.prepareTrackEventFunction("added_bubble"),e.exports=d},function(e,t,i){"use strict";e.exports={create:function(e){var t,i=e.model;return t={getModel:function(){return i}},_.extend(t,e.exposedMethods,{exposedMethods:_.transform(e.exposedMethods,function(e,t,i){e[i]=i})})}}},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,i){"use strict";var n=i(0),a=i(13);e.exports=a.extend({name:"app_touchpoint",initialize:function(){this.$el.append(this.templates.appTouchpoint({keys:this.keys,selector:this.options.selector,backgroundStyleTag:this.getStyleAttr(this.options.selector,"Background"),starsImage:this.getStyleAttr(this.options.selector,"Image"),btnClass:"resultsbottom"===this.options.selector||"findyourbooking"===this.options.selector?"odf-btn-sm":""}))},selectors:{appStatus:".app_touchpoint_status"},events:{"tap .app_touchpoint_button":"onTapAppButton"},onTapAppButton:function(e){e.preventDefault(),n.trackEvent("app_banner",this.options.trackLabel,this.options.trackCategory),location.replace(n.decorateAppTouchpointUrl($(e.target).data("url")))},getStyleAttr:function(e,t){var i="",n=this.keys[e+t];return _.isEmpty(n)||"Image"!==t?_.isEmpty(n)||"Background"!==t||(i="style=\"background-image: url('"+Odigeo.UserArea.brandedImagePath+n+"')\""):i=Odigeo.UserArea.brandedImagePath+n,i}})},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,i){"use strict";var n={multipleTrip:"MD",oneWayTrip:"OW",roundTrip:"RT"};function a(e,t){return _.isEqual(e,t)?"0":"1"}function s(e,t){var i,n,s=a(e,t);return"0"===s?s:(i=Odigeo.Utils.parseDate(e).getTime(),n=Odigeo.Utils.parseDate(t).getTime(),"1-"+(0<(s=Odigeo.Utils.getDifferenceInDays(i,n))?"+"+s:s))}function r(e,t,i){var n="0";return i.available?n=i.cheaper?"1":"0":e===t&&"0"===e&&(n="N/A"),Number(!!i.available)+"-"+n}function o(e,t){return"N/A"===_.get(t,e,"N/A")?"N/A":"G"===t[e]||"R"===t[e]?t[e]:Odigeo.Utils.formatCurrency(t[e],{decimalPlaces:0})}function c(e,t){var i,n,s=a(e,t);return"0"===s?s:(i=Odigeo.Utils.parseDate(e).getTime(),n=Odigeo.Utils.parseDate(t).getTime(),0<(s=Odigeo.Utils.getDifferenceInDays(i,n))?"+"+s:s)}e.exports={changesInRequest:function(e,t,i){var o,c,d,l=e.searchSegments,g=t.searchSegments,h=t.type!==e.type,u=a(l[0].departure,g[0].departure),p=a(l[0].destination,g[0].destination),f=s(l[0].dateStr,g[0].dateStr),m=h||"roundTrip"!==t.type?"0":s(l[1].dateStr,g[1].dateStr),_=e.type===(o=t.type)?"0":n[o];return"change_search_orig:"+u+"_dest:"+p+"_dep:"+f+"_ret:"+m+"_pax:"+(d=t,(c=e).numAdults===d.numAdults&&c.numChildren===d.numChildren&&c.numInfants===d.numInfants?"0":"1")+"_tip:"+_+"_dir:"+a(e.directFlightsOnly,t.directFlightsOnly)+"_cheap:"+r(f,m,i)},changesDatesWithFaresInRequest:function(e,t,i,n){var a,d=e.searchSegments,l=t.searchSegments,g=t.type!==e.type,h=s(d[0].dateStr,l[0].dateStr),u=g||"roundTrip"!==t.type?"0":s(d[1].dateStr,l[1].dateStr),p=n.trackingFaresSearchData?n.trackingFaresSearchData[i]:null,f=r(h,u,n),m=o("selectedAmount",p),_=o("cheapestPrice",p),b=o("mostExpensivePrice",p),y=o("currentPrice",p);return g?null:"0"===(a="dep"===i?c(d[0].dateStr,l[0].dateStr):c(d[1].dateStr,l[1].dateStr))?null:"change_dates_"+i+"_days:"+a+"_cal:"+f+"_pc:"+_+"_pe:"+b+"_pr:"+y+"_pf:"+m}}},,,,function(e,t,i){"use strict";$(function(){var e=i(0);Odigeo.defineWidget("accommodation_search_manager",Odigeo.Widget.extend({modelClass:Odigeo.Model.extend({mode:"default",dataUrl:"accommodation/upsell/search",dataResultsUrl:"accommodation/upsell/getaccommodationresults",propensityUrl:"accommodation/upsell/getpropensity",postbookingUrl:"accommodationpostbooking/upsell/getpostbooking",defaults:{itinerarySearchRequest:"",accommodationSearchRequest:""},url:function(){return Odigeo.Settings.getProperty("serviceUrlFormatter")(this.dataUrl)},getResultsUrl:function(){return Odigeo.Settings.getProperty("serviceUrlFormatter")(this.dataResultsUrl)},getPropensityUrl:function(){return Odigeo.Settings.getProperty("serviceUrlFormatter")(this.propensityUrl)},getPostBookingUrl:function(){return Odigeo.Settings.getProperty("serviceUrlFormatter")(this.postbookingUrl)},getAccommodationResults:function(){return this.fetch({url:this.getResultsUrl(),success:_.bind(this.successGetResults,this),error:_.bind(this.errorGetResults,this)})},successGetResults:function(t,i){_.isNull(i)||_.isUndefined(i)?(Odigeo.trigger(this.widget.id+":resultsNotAvailable"),e.counterMetric("IP_ACCOMMODATION_GETRESULTS_OK_NO_HOTELS_COUNTER")):(Odigeo.trigger(this.widget.id+":resultsLoaded",i),e.counterMetric("IP_ACCOMMODATION_GETRESULTS_OK_COUNTER"))},successGetPropensity:function(e,t){Odigeo.trigger(this.widget.id+":successGetPropensity",t)},errorGetResults:function(){e.counterMetric("IP_ACCOMMODATION_GETRESULTS_KO_COUNTER"),Odigeo.trigger(this.widget.id+":resultsNotAvailable")},getRequestParams:function(e){return"newSearch"===this.mode?App.Flights.convertXsellNewSearchAccommodationRequest(e):App.Flights.convertXsellAccommodationRequest(e)},getPropensity:function(e,t){this.mode=t;var i=this.getRequestParams(e);this.clear().save(i,{url:this.getPropensityUrl(),success:_.bind(this.successGetPropensity,this),error:_.bind(this.requestErrorHandler,this)}),Odigeo.Session.set("accommodationSearchParameters",JSON.stringify(i))},search:function(t,i,n){e.startMetric("LOAD_SEARCH_ACCOMMODATION"),this.mode=n;var a=this.getRequestParams(t);this.clear().save(a,{timeout:i,success:_.bind(this.requestSuccessHandler,this),error:_.bind(this.requestErrorHandler,this)}),Odigeo.Session.set("accommodationSearchParameters",JSON.stringify(a))},postBooking:function(t,i){e.startMetric("LOAD_SEARCH_ACCOMMODATION_PB"),this.mode=i?(t=this.prepareRequestParams(t),"newSearch"):"accommodationPostBooking",this.clear().save(t,{url:this.getPostBookingUrl(),success:_.bind(this.requestSuccessHandler,this),error:_.bind(this.requestErrorHandler,this)}),Odigeo.Session.set("accommodationSearchParameters",JSON.stringify(t))},prepareRequestParams:function(e){var t=Odigeo.Utils.parseJson(Odigeo.Session.get("accommodationSearchParameters"));return(e=App.Flights.convertXsellNewSearchAccommodationRequest(e)).accommodationSearchRequest.searchType="POST_BOOKING",e.itinerarySearchRequest=t.itinerarySearchRequest,e},afterLoadData:function(){Odigeo.trigger(this.widget.id+":dataLoaded")},requestSuccessHandler:function(e,t){var i;i="newSearch"===this.mode?":successNewAccommodationSearch":"accommodationPostBooking"===this.mode?":successPostBookingAccommodationSearch":":successAccommodationSearch",this.manageSuccesssMetrics(),Odigeo.trigger(this.widget.id+i,t)},requestErrorHandler:function(){var e;e="newSearch"===this.mode?":errorNewAccommodationSearch":"accommodationPostBooking"===this.mode?":errorNewAccommodationSearch":":errorAccommodationSearch",Odigeo.trigger(this.widget.id+e)},manageSuccesssMetrics:function(){e.stopMetric("LOAD_SEARCH_ACCOMMODATION"),e.stopMetric("LOAD_SEARCH_ACCOMMODATION_PB")}}),search:function(e,t,i){this.model.search(e,t,i)},postBooking:function(e,t){this.model.postBooking(e,t)},getAccommodationResults:function(){this.model.getAccommodationResults()},getPropensity:function(e,t){this.model.getPropensity(e,t)}}))})},function(e,t,i){"use strict";$(function(){var e=i(0),t=i(78),n=i(14).getInstance(),a="flexibility_disruption";Odigeo.defineWidget("flight_details",Odigeo.Widget.extend({modelClass:Odigeo.Model.extend({dataURL:null,passengersInfoUrl:"shortPaxInfo",getDataRequestSettings:function(){return{type:"GET",cache:!1,success:_.bind(this.requestSuccessHandler,this),error:_.bind(this.requestErrorHandler,this)}},url:function(){return Odigeo.Settings.getProperty("widgetPartUrlFormatter")(this.widget.name,this.passengersInfoUrl)},requestSuccessHandler:function(e){this.widget.view.updatePassengers(e)},requestErrorHandler:function(e){Odigeo.trigger(this.widget.id+":requestError",e)},refreshPaxData:function(){this.isEmptyData=!1,this.refresh()}}),viewClass:Odigeo.View.extend({flightTemplate:null,popup:null,expandPanelDuration:400,isExpanded:!1,isInProcess:!1,extraHeight:0,isDomBinded:!1,init:function(){this.widget.options=Odigeo.parseOptions(this.widget.options),_.templateSettings={interpolate:/\{\{(.+?)\}\}/g},this.flightTemplate=_.template(0!==this.$cachedSelectors.expandArea.length?this.$cachedSelectors.expandArea.find(".flight_template").html():"<div></div>"),this.$cachedSelectors.itineraryDetails.addClass("expanded"),this.$cachedSelectors.headRow.addClass(this.widget.options.inSideSummary?"od-side-summary-row":""),this.model.widget.options.notAnimate?this.$cachedSelectors.flightDetails.removeClass("hidden"):(this.enhanceCollapsive(),this.bindToDom()),this.model.widget.options.showPaxInfo||this.fillPax(),this.prepareAccommodationCancelPolicies(),this.renderFlexibilityDisruptionBanner()},events:{"tap .accommodation_toggle_details":"accommodationToggleDetails","tap .expand_area_text":"toggleViewPanel","tap @flexibilityDisruptionModalIcon":"openFlexibilityDisruptionModal"},selectors:{flightDetails:".flight_details",headRow:".head_row",expandArea:".expand_area",expandAreaText:".expand_area_text",paxSummary:".pax_summary",paxCount:".pax_count",paxList:".pax_list",itineraryDetails:".itinerary_details",lightboxContent:".flight_details_content_lightbox",roomDetailsPopup:".room_details_popup",owcSpecialRules:".owc_special_rules",flexibilityDisruptionBanner:".flexibility_disruption_banner",flexibilityDisruptionModalIcon:".flexibility_disruption_modal_icon"},bindToDom:function(){this.isDomBinded||(this.isDomBinded=!0)},renderFlexibilityDisruptionBanner:function(){var e=this;n.getLoadedPromise().then(_.bind(function(t){t&&n.isCanxFree()&&Odigeo.Templates.getGenericTemplates([a]).then(_.bind(function(e){if(_.isObject(e)){var t=_.get(e,a),i=e.getStaticTemplatesKeys(a);this.initFlexibilityDisruptionModal(t,i),this.setFlexibilityDisruptionBanner(t,i)}},e))},this))},trackWhenOnClick:function(){e.trackEvent("free-cancellation_nag","free-cancellation_open-info_when_pag:pax")},trackWhatOnClick:function(){e.trackEvent("free-cancellation_nag","free-cancellation_open-info_what_pag:pax")},trackHowOnClick:function(){e.trackEvent("free-cancellation_nag","free-cancellation_open-info_how_pag:pax")},initFlexibilityDisruptionModal:function(e,i){var n=_.get(e,"modals/modal",_.noop),a=_.get(e,"modals/content",_.noop),s=$(".flexibility_disruption_popup");this.modal=new t(s,{content:a(i),button:_.get(i,"flexibilityDisruptionPopUpCloseButton","")},{template:n,fillThePage:!1,preventContainerTap:!1,open:{analytics:{action:"free-cancellation_onload-nag",label:"free-cancellation_onload-nag_pag:pax"}},close:{analytics:{action:"free-cancellation_onload-nag",label:"free-cancellation_close-nag_pag:pax"}},button:{analytics:{action:"free-cancellation_onload-nag",label:"free-cancellation_close-info_pag:pax"}}}),s.removeClass("odf-hidden"),s.on("click",this.trackWhenOnClick),s.on("click",this.trackWhatOnClick),s.on("click",this.trackHowOnClick)},setFlexibilityDisruptionBanner:function(e,t){var i=_.get(e,"flexibilityDisruptionBanner",_.noop)({texts:t});this.$cachedSelectors.flexibilityDisruptionBanner.html(i),this.$cachedSelectors.flexibilityDisruptionBanner.removeClass("odf-hidden")},openFlexibilityDisruptionModal:function(){e.trackEvent("free-cancellation_trip","free-cancellation_more-trip_pag:pax"),this.modal.open(!0,!0)},accommodationToggleDetails:function(t){var i=_.clone($(t.currentTarget).data("details")),n=$(t.currentTarget).data("label"),a=Odigeo.History.getPageNameFromFragment()+"_flights_container",s=this.$("#"+a).hasClass("open");t.stopPropagation(),i.target=a,Odigeo.trigger(this.widget.id+":toggleDetails",i),!s&&n&&e.trackEvent("trip_information",n)},prepareAccommodationCancelPolicies:function(){_.each(this.$el.find(this.selectors.roomDetailsPopup),function(e){Odigeo.UIElements.hint.enhance(Odigeo.History.getPageNameFromFragment(),e,{events:{tap:!0}})})},enhanceModalDialog:function(){this.popup=Odigeo.UIElements.createDialog({content:this.$cachedSelectors.lightboxContent.html(),dialogClasses:"od-dialog-flight-details",hasCloseButton:!0,closeOnTapOuterBox:!0,closeOnNavigate:!0})},showInModalDialog:function(){this.enhanceModalDialog(),Odigeo.UIElements.showDialog(this.popup)},enhanceCollapsive:function(){Odigeo.UIElements.collapsive.enhance(this.$cachedSelectors.flightDetails,{expandPanelDuration:this.expandPanelDuration,collapsePanelDuration:this.expandPanelDuration,extraHeight:this.extraHeight,googleAnalyticsOnOpen:{type:"trackEvent",data:{page:Odigeo.History.getPageNameFromFragment(),action:"trip_information",label:"open_trip_details"}},googleAnalyticsOnOpenAutomatic:{type:"trackEvent",data:{page:Odigeo.History.getPageNameFromFragment(),action:"trip_information",label:"onload_trip_information_displayed"}},triggerLauncher:this.widget.id,triggerEvents:!0}),Odigeo.on(this.widget.id+":panelExpanded "+this.widget.id+":panelCollapsed",_.bind(function(){this.isInProcess=!1},this))},fillPax:function(){var e,t=Odigeo.Session.get("booking_pax_list");t&&(t=JSON.parse(t),this.$cachedSelectors.paxCount.text("("+t.length+")"),e=_.map(t,function(e){return e.name+" "+(e.firstLastName||e.lastName)}).join(", "),this.$cachedSelectors.paxList.text(e),this.$cachedSelectors.paxSummary.removeClass("hidden"))},paxDetailsUpdated:function(){_.each(this.$widget.find(".baggage_repricing"),function(e){Odigeo.UIElements.hint.enhance(Odigeo.History.getPageNameFromFragment(),e,{events:{tap:!0}})})},toggleViewPanel:function(e,t){var i=this.$cachedSelectors.expandAreaText;this.isInProcess||(this.isExpanded=!this.isExpanded,this.$cachedSelectors.flightDetails.trigger("togglePanel",{isOpenedAutomatic:!1,hasToTrack:t}),i.text(i.data(this.isExpanded?"open":"hide")),this.$cachedSelectors.expandArea.toggleClass("open",this.isExpanded),Odigeo.trigger(this.widget.id+":closeAccommodation"),this.isInProcess=!0)},updatePassengers:function(e){this.$cachedSelectors.paxList.html(e)}}),dic:{fillPax:"fillPax",toggleViewPanel:"toggleViewPanel",paxDetailsUpdated:"paxDetailsUpdated"},execute:function(e){var t=_.rest(arguments);return this.view[this.dic[e]]&&this.view[this.dic[e]].apply(this.view,t),this}}))})},function(e,t,i){"use strict";var n=i(10);e.exports=n({viewClass:i(714)})},function(e,t,i){var n=i(492),a=i(493),s=a;s.v1=n,s.v4=a,e.exports=s},function(e,t,i){var n,a,s=i(320),r=i(321),o=0,c=0;e.exports=function(e,t,i){var d=t&&i||0,l=t||[],g=(e=e||{}).node||n,h=void 0!==e.clockseq?e.clockseq:a;if(null==g||null==h){var u=s();null==g&&(g=n=[1|u[0],u[1],u[2],u[3],u[4],u[5]]),null==h&&(h=a=16383&(u[6]<<8|u[7]))}var p=void 0!==e.msecs?e.msecs:(new Date).getTime(),f=void 0!==e.nsecs?e.nsecs:c+1,m=p-o+(f-c)/1e4;if(m<0&&void 0===e.clockseq&&(h=h+1&16383),(m<0||o<p)&&void 0===e.nsecs&&(f=0),1e4<=f)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");o=p,a=h;var _=(1e4*(268435455&(p+=122192928e5))+(c=f))%4294967296;l[d++]=_>>>24&255,l[d++]=_>>>16&255,l[d++]=_>>>8&255,l[d++]=255&_;var b=p/4294967296*1e4&268435455;l[d++]=b>>>8&255,l[d++]=255&b,l[d++]=b>>>24&15|16,l[d++]=b>>>16&255,l[d++]=h>>>8|128,l[d++]=255&h;for(var y=0;y<6;++y)l[d+y]=g[y];return t||r(l)}},function(e,t,i){var n=i(320),a=i(321);e.exports=function(e,t,i){var s=t&&i||0;"string"==typeof e&&(t="binary"===e?new Array(16):null,e=null);var r=(e=e||{}).random||(e.rng||n)();if(r[6]=15&r[6]|64,r[8]=63&r[8]|128,t)for(var o=0;o<16;++o)t[s+o]=r[o];return t||a(r)}},function(e,t,i){"use strict";var n,a=i(0),s=i(51),r={ccnumber:"creditCardNumber",cardExpirationMonth:"expirationDateMonth",cardExpirationYear:"expirationDateYear",nameoncard:"owner",code:"creditCardType.creditCardCode",name:"creditCardType.creditCardName",method:"creditCardType.creditCardType"},o=["nameoncard","ccnumber","cardExpirationMonth","cardExpirationYear"],c=function(e){return e.stopPropagation(),e.preventDefault(),$(e.target)},d=function(e,t,i){return{id:i.id,code:i.creditCardType.creditCardCode,name:i.creditCardType.creditCardName,ccnumber:i.creditCardNumber,cardExpirationMonth:i.expirationDateMonth,cardExpirationYear:i.expirationDateYear,nameoncard:i.owner,ccvLimit:this.getCvvLength(i.creditCardType.creditCardCode),isValid:-1<_.indexOf(t,i.creditCardType.creditCardCode),lastCCNumbers:_.reduce(_.takeRight(i.creditCardNumber,4),function(e,t){return e.concat(t)}),fee:(_.find(e,{code:i.creditCardType.creditCardCode})||{}).fee}},l=function(e,t){this.$cachedSelectors.removeCCModal.toggleClass("active",e).one("transitionend",t)};e.exports={controller:{initController:function(){this.model.set({saveCardDataAcceptance:!1,selectedStorageCreditCard:null}),this.model.on("change:storedCCList",this.model.updateCards,this.model).on("change:availablePaymentCCList",this.model.updateCards,this.model).on("change:selectedStorageCreditCard",this.model.selectStorageCreditCard,this.model).on("change:storedCCListValid",this.view.displayStoredCC,this.view).on("change:chosenMethod",this.view.chosenMethodChanged,this.view)}},model:{setCreditCards:function(e){var t=[];_.isObject(e)&&_.isObject(e.userDTO)&&(t=_.filter(e.userDTO.creditCards,function(e){return t=e.expirationDateYearFormated,i=e.expirationDateMonth,n=new Date,new Date(n.getFullYear(),n.getMonth()+1)<=new Date("20"+t,i);var t,i,n}),_.isArray(t)&&!t.length&&this.widget.view.trackPaymentsDisplayed(!1,!0)),this.set("storedCCList",t)},updateCards:function(){var e=this.get("availablePaymentCCList"),t=_.pluck(e,"code"),i=this.get("storedCCList"),n=[];_.isArray(i)&&i.length&&_.isArray(t)&&t.length&&(n=_.map(i,function(i){return _.bind(d,this,e,t,i)()}.bind(this))),this.set("storedCCListValid",n)},isStoredCardsAvailability:function(){return!!(this.get("storedCCListValid")||[]).length},getSelectedStorageCreditCard:function(){return this.get("selectedStorageCreditCard")},selectStorageCreditCard:function(){var e=this.get("selectedStorageCreditCard"),t=_.reduce(o,function(t,i){return t[i]=e?e[i]:"",t},this.get("creditCardData"));this.set("creditCardData",t),e=e||this.defaultCreditCard||{},this.widget.setCreditCardType(e.code),this.addItemToPricemanagerCollection({concept:e.code,allPrice:e.fee,onePrice:e.fee,method:"CREDITCARD",quantity:this.widget.options.numTravellers,type:"CC_FEE"}),Odigeo.trigger(this.widget.id+":storedCardChanged",e.name)},isStoredCardSelected:function(){var e=this.get("selectedStorageCreditCard");_.isObject(e)&&!_.isEmpty(e)&&Odigeo.trigger(this.widget.id+":storedCardChanged",e.name)},isNewCreditCard:function(e){return _.isEmpty(this.get("storedCCListValid"))||_.some(this.get("storedCCListValid"),_.bind(function(t){return!_.isEqual(this.cardPropPicker(t),this.cardPropPicker(e))||this.checkFourLastDigits(e.ccnumber,t.ccnumber)},this))},cardPropPicker:function(e){return _.pick(e,["cardExpirationMonth","cardExpirationYear","code"])},checkFourLastDigits:function(e,t){return e.substring(e.length-4)===t.substring(t.length-4)},newChecker:function(e){return this.widget.options.isHideCards?this.isNewCreditCard(e):!_.findWhere(this.get("storedCCListValid"),{ccnumber:e.ccnumber})},saveCard:function(){var e,t,i=_.extend({},this.get("creditCardData"),this.get("chosenCard"));i.ccnumber=s.trimCreditCardNumber(i.ccnumber),t=0===(this.get("storedCCListValid")||[]).length,e={creditCardNumber:"",expirationDateMonth:"",expirationDateYear:"",owner:"",creationDate:Date.now(),modifiedDate:null,lastUsageDate:null,isDefault:t,creditCardType:{creditCardType:"",creditCardName:"",creditCardCode:""}},!_.isEmpty(i)&&this.newChecker(i)&&this.get("saveCardDataAcceptance")&&!this.get("selectedStorageCreditCard")&&"CREDITCARD"===this.get("chosenMethod")&&(_.each(r,function(t,n){r[n]&&Odigeo.Utils.setNestedProperty(e,r[n],i[n])}),Odigeo.trigger(this.widget.id+":addCreditCards",[e]))},saveCreditCardData:function(e){this.set("creditCardData",_.extend(this.get("creditCardData"),e))}},selectors:{storedCardsWrapper:".stored_cards_wrapper",saveCardData:'[name="saveCardData"]',deleteCardProcessing:".delete-card-processing",deleteCardSuccess:".delete-card-success",creditCardForm:".credit_card_form",savedCardRemove:".saved_card_remove",creditCardTemplateList:".stored_credit_card_template",storageCreditCardContainer:".storage_credit_card_container",storedCreditCard:'[name="storedCreditCard"]',storedCreditCardCVV:'[name="storedCvv3Digits"],[name="storedCvv4Digits"]',storedCardLabel:".stored_card_label",removeCardButton:".remove_card_button",discardRemoveCardButton:".discard_remove_card_button",savedCardRemoverTemplate:".saved_card_remover_template",storedCardsHintContainer:".stored_cards_hint_container",removeCreditCardModal:".remove_credit_card_modal",removeCCModal:".remove_cc_modal",noValidCardMoreInfo:".no_valid_card_more_info",paymentMethodCreditcard:"#payment-method-creditcard"},view:{initView:function(){this.templates={},_.each(["savedCardRemoverTemplate","creditCardTemplateList"],function(e){this.templates[e]=_.template(this.$cachedSelectors[e].html(),this.tmplSettings)},this),this.$cachedSelectors.saveCardData.on(Odigeo.Events.change+" "+Odigeo.Events.click,_.bind(this.saveCardDataAcceptanceChanged,this))},toggleEvents:function(e){var t=e?"on":"off";this.$cachedSelectors.storedCreditCard[t](Odigeo.Events.change,_.bind(this.storedCreditCardSelected,this)),this.$cachedSelectors.storedCreditCardCVV[t](Odigeo.Events.blur,_.bind(this.cvvChanged,this)),this.$cachedSelectors.savedCardRemove[t](Odigeo.Events.tap,_.bind(this.openRemoveStoredCreditCard,this)),this.$cachedSelectors.removeCCModal[t](Odigeo.Events.tap,c)},creditCardNotAllowedHint:function(){_.each(this.$cachedSelectors.noValidCardMoreInfo,function(e){Odigeo.UIElements.hint.enhance("payment",$(e),{closeButton:{show:!1},generateHtml:!0,wrapperClass:"od-payment-cardstored-hint od-hint-notitle",arrowClass:"od-hint-arrow-flex",hintTriggerButton:{hintTriggerButtonClass:"od-payment-cardstored-hint-btn odf-text-xl",hintTriggerButtonText:"]"},events:{hover:!0,tap:!1}})})},showHideSaveDataCardAgree:function(e){this.$cachedSelectors.cardSaverManager.toggleClass("odf-hidden",!e)},openRemoveStoredCreditCard:function(e){var t=c(e).data("id"),i=_.findWhere(this.model.get("storedCCListValid"),{id:t});l.call(this,!0,_.bind(function(){(n=Odigeo.UIElements.hint.enhance("payment",this.templates.savedCardRemoverTemplate({cc:i}),{trigger:"deleteStoredCreditCard",events:{tap:!0}})).find(".discard_remove_card_button").on(Odigeo.Events.tap,this.closeStoredCreditCardHint),n.find(".remove_card_button").on(Odigeo.Events.tap,_.bind(this.removeStoredCreditCardRequest,this)),this.$cachedSelectors.storedCardsHintContainer.html(n),n.trigger("showHint")},this)),a.trackEvent("payment_details","delete_payment_clicks",!1)},removeStoredCreditCardRequest:function(e){var t;n.attr("data-state","waiting"),t=c(e).data("id"),Odigeo.trigger(this.widget.id+":deleteCreditCards",[t]),a.trackEvent("payment_details","delete_payment_confirm",!1)},removeStoredCreditCardSuccess:function(){n instanceof $&&(n.attr("data-state","done"),_.delay(_.bind(this.closeStoredCreditCardHint,this),2e3))},closeStoredCreditCardHint:function(){n instanceof $&&n.trigger("hideHint")},removeStoredCreditCardHintClosed:function(){l.call(this,!1,_.bind(function(){this.$cachedSelectors.storedCardsHintContainer.empty(),n=null},this))},displayStoredCC:function(){var e=this.model.get("storedCCListValid"),t=_.filter(e,function(e){return e.isValid}),i="CREDITCARD"===this.model.get("chosenMethod"),n=!!t.length,a=t.length===e.length&&n;n||this.model.saveCreditCardData({cvv2:"",ccnumber:"",nameoncard:"",cardExpirationMonth:"-1",cardExpirationYear:"-1"}),this.$cachedSelectors.root.toggleClass("od-stored-cards-visible",i),this.$cachedSelectors.storedCardsWrapper.html(this.templates.creditCardTemplateList({data:e})),this.updateDomSelectorsToCache(),this.$cachedSelectors.creditCardForm.trigger("togglePanelByParameter",!n),this.creditCardNotAllowedHint(),this.toggleEvents(n),this.showHideSaveDataCardAgree(!n);var s=this.$el.find(n?"#creditcard-"+t[0].id:"#newCreditCard");Odigeo.AB.isCvvCleanedAfterRepricing?s.trigger("change",[!0]):s.click(),this.trackPaymentsDisplayed(n,a)},trackPaymentsDisplayed:function(e,t){var i=e?"1":"0",n=t?"0":"1";a.trackEvent("payment_details","saved_payment_displayed_"+i+"_"+n)},fillCvv:function(){if(Odigeo.AB.isCvvCleanedAfterRepricing){var e=this.$cachedSelectors.cvv2;this.widget.options.isDesktop&&(e=this.$cachedSelectors.storedCreditCardCVV).val(this.model.get("cvv")),e.val()&&e.trigger("blur")}},storedCreditCardSelected:function(e,t){var i=c(e),n=_.findWhere(this.model.get("storedCCListValid"),{id:i.data("id")}),s=_.get(n,"id")?this.$el.find(".stored_card_cvv_"+n.id):this.$el.find(".mobile_form_cvv_container"),r=this.$el.find(".mobile_form_cvv");this.widget.options.bigCvv&&(this.$cvvTemplate=r.length?r:this.$cvvTemplate,s.html(this.$cvvTemplate),this.updateDomSelectorsToCache()),this.fillCvv(),this.$cachedSelectors.storedCardLabel.removeClass("selected"),this.$cachedSelectors.creditCardForm.trigger("togglePanelByParameter",!i.val()),this.showHideSaveDataCardAgree(!n),i.siblings(".stored_card_label").addClass("selected"),this.model.set("selectedStorageCreditCard",n),Odigeo.AB.isCvvCleanedAfterRepricing&&t||(this.model.saveCreditCardData({cvv2:i.siblings().find(".stored_credit_card_cvv").val()}),this.cleanInputs(!0)),n||a.trackEvent("payment_details","new_credit_card_clicks",!1)},chosenMethodChanged:function(){this.widget.options.isCreditCardLabelHidden&&("CREDITCARD"!==this.model.get("chosenMethod")?(this.$cachedSelectors.storedCardLabel.removeClass("selected"),this.$cachedSelectors.storedCreditCard.prop("checked",!1),this.$cachedSelectors.creditCardForm.trigger("collapsePanel")):this.$cachedSelectors.paymentMethodCreditcard.prop("checked",!0))},cvvChanged:function(e){var t=c(e);this.fields.setStateAndShowError(t,!0),this.model.saveCreditCardData({cvv2:t.val()||""}),this.model.set("cvv",t.val())},validateStoredCreditCardCvv:function(){var e=this.model.get("selectedStorageCreditCard")||{},t=this.$el.find('.stored_cvv_wrapper[data-id="'+e.id+'"] input');t.length&&this.fields.setStateAndShowError(t,!1)},saveCardDataAcceptanceChanged:function(e){var t=$(e.target);this.model.set("saveCardDataAcceptance",t.prop("checked"))}}}},function(e,t,i){"use strict";$(function(){var e=i(0),t=i(36),n=i(52),a=i(360),s=i(37).getInstance();Odigeo.defineWidget("trip_summary_price",Odigeo.Widget.extend(t.extend({modelClass:Odigeo.Model.extend(n.extend({dataURL:null,passengersInfoUrl:"passengersInfo",finalPrice:null,init:function(){this.bindPriceCollection(),this.on("priceCollection.repaintPrices",this.refreshView)},refreshView:function(){this.trigger("render",this.getPriceCollectionData()),this.updatePrices()},updatePrices:function(){this.trigger("updatePrices",this.getFinalPrice(),this.getPricePerPassenger(),this.getSHPrice(),this.getPriceCollectionData())},getDataRequestSettings:function(){return{type:"GET",cache:!1,success:_.bind(this.requestSuccessHandler,this),error:_.bind(this.requestErrorHandler,this)}},url:function(){return Odigeo.Settings.getProperty("widgetPartUrlFormatter")(this.widget.name,this.passengersInfoUrl)},requestSuccessHandler:function(e){this.widget.view.updatePassengers(e)},requestErrorHandler:function(e){Odigeo.trigger(this.widget.id+":requestError",e)},refreshPaxData:function(){this.isEmptyData=!1,this.refresh()}})),viewClass:Odigeo.View.extend({initialTop:0,finalTop:0,fullBarHeight:0,events:{"tap .change_details":"changeToPassengerDetails","tap .change_suggestion":"sendUserToResults","tap .remove_hotel":"removeHotel","tap .accommodation_toggle_details":"accommodationToggleDetails","tap .change_search":"changeResults","tap @addpaxAction":"onAddpaxAction","mouseenter .amount_discounted_tooltip":"toggleTooltip","mouseleave .amount_discounted_tooltip":"toggleTooltip"},selectors:{totalPrice:".total_price",totalPriceWithoutDiscount:".total_price_without_discount",dynpackFareDiscount:".dynpack_fare_discount",paxPrice:".pax_price",SH_price:".SH_price",baggageTable:".baggage_table",pax_list:".pax_list",seatmap_table:".seatmap_table",seat_map_all_price:".seat_map_all_price",seat_map_concept:".seat_map_concept",popup_disclaimer:".popUpDisclaimer",popup_trip_disclosure:".trip_disclosure",popup_pricebreakdown:".result_price_breakdown",help_desk_icon:".help_desk_icon",help_desk_label:".help_desk_label",hint_price_details:".hint_price_details",show_cc_type:".show_cc_type",show_cc_name:".show_cc_name",wrapper:".wrapper_summary",price_summary:".price_summary",pax_summary:".pax_summary",flights_summary:".flights_summary",accommodation_summary:".accommodation_summary",title_summary:".title_summary",removeHotel:".remove_hotel",owcSpecialRules:".owc_special_rules",trip_baggage_repricing:".trip_baggage_repricing",cheapestPaymentmethodDisclaimer:".cheapest_paymentmethod_disclaimer",baggagesTemplate:".baggage_template",baggagesTemplateSplitted:".baggage_template_splitted",baggagesDisclaimer:".baggage_disclaimer",passengersSection:".passengers_tripsummary",premiumPassengerSection:".premium_passenger_tripsummary",premiumPassengerName:".premium_passenger_name_tripsummary",membershipPriceDisplayCcFee:".paymentfee.membership_price_display_cc_fee",membershipPriceDisplayFeeText:".membership_price_display_fee_text",membershipPriceDisplayFeeValue:".membership_price_display_fee_value",membershipPriceDisplayDisclaimer:".membership_price_display_disclaimer",membershipPriceDisplayDisclaimerNoBtwnTrav:".membership_price_display_disclaimer_no_btwn_trav",membershipPriceDisplayDisclaimerTxt:".disclaimer_txt",addpaxAction:".details_add_adults_button",tripSummaryPriceWrapper:".wrapper_summary.tripSummaryPriceWrapper",premiumBubbleContent:".bubble_sidebar_member_content",premiumBubbleTemplate:".bubble_sidebar_member_tmpl",promocodeContainer:".promocode_table",priorityBoardingContainer:".priority_boarding_container"},init:function(){"details"===this.widget.options.page&&(this.baggagesTemplate=_.template(this.$cachedSelectors.baggagesTemplate.html(),this.getTemplateSettings()),this.baggagesTemplateSplitted=_.template(this.$cachedSelectors.baggagesTemplateSplitted.html(),this.getTemplateSettings())),this.bindEvents(),this.bindToDom(),this.showPriceWithoutDiscountSelectedDisclaimer()},getTemplateSettings:function(){return Odigeo.Utils.getTmplSettings({variable:"priceDescriptorsArray"})},bindEvents:function(){this.listenTo(this.model,"updatePrices",this.repaintPrices)},repaintPrices:function(e,t,i,n){var a=parseFloat(this.$cachedSelectors.dynpackFareDiscount.data("dynpackfarediscount"))||0,s=Odigeo.Utils.formatCurrency(n.totalPrice+a);"payment"===this.widget.options.page&&this.$cachedSelectors.wrapper.data("sticky")&&"table-footer-group"===this.$cachedSelectors.price_summary.css("display")?(this.$cachedSelectors.totalPrice.hide().html(e).fadeIn(200),_.isUndefined(this.$cachedSelectors.paxPrice)||this.$cachedSelectors.paxPrice.hide().html(t).fadeIn(200)):(this.$cachedSelectors.totalPrice.html(e),_.isUndefined(this.$cachedSelectors.paxPrice)||this.$cachedSelectors.paxPrice.html(t)),_.isUndefined(this.$cachedSelectors.SH_price)||this.$cachedSelectors.SH_price.html(i),_.isUndefined(this.$cachedSelectors.totalPriceWithoutDiscount)||this.$cachedSelectors.totalPriceWithoutDiscount.html(s)},bindToDom:function(){var t=this,i=Odigeo.History.getPageNameFromFragment();this.isDomBinded||(_.isEmpty(this.$cachedSelectors.popup_trip_disclosure)||Odigeo.UIElements.hint.enhance(i,this.$cachedSelectors.popup_trip_disclosure,{events:{tap:!0},googleAnalyticsOnOpen:{type:"trackEvent",data:{page:i,action:"trip_information",label:"open_notes_tooltip"}}}),_.isEmpty(this.$cachedSelectors.popup_disclaimer)||Odigeo.UIElements.hint.enhance(i,this.$cachedSelectors.popup_disclaimer,{events:{tap:!0},googleAnalyticsOnOpen:{type:"trackEvent",data:{page:i,action:"trip_information",label:"open_secure_payment_tooltip"}}}),_.isEmpty(this.$cachedSelectors.popup_pricebreakdown)||Odigeo.UIElements.hint.enhance(i,this.$cachedSelectors.popup_pricebreakdown,{events:{tap:!0},googleAnalyticsOnOpen:{type:"trackEvent",data:{page:i,action:"trip_information",label:"open_price_breakdown"}}}),this.$cachedSelectors.owcSpecialRules.length&&(e.trackEvent("on_load","xfaring_info_loaded"),Odigeo.UIElements.hint.enhance(Odigeo.History.getPageNameFromFragment(),this.$cachedSelectors.owcSpecialRules,{events:{tap:!0},googleAnalyticsOnOpen:{type:"trackEvent",data:{action:"xfaring_info",label:"xfaring_info_clicked"}}})),this.bindBaggageRepricing(),this.$cachedSelectors.help_desk_icon.on(Odigeo.Events.mouseover,function(){t.$cachedSelectors.help_desk_label.removeClass("hidden")}),this.$cachedSelectors.help_desk_icon.on(Odigeo.Events.mouseout,function(){t.$cachedSelectors.help_desk_label.addClass("hidden")}),this.isDomBinded=!0)},toggleTooltip:function(e){$(e.currentTarget).toggleClass("open")},bindBaggageRepricing:function(){_.each(this.$cachedSelectors.trip_baggage_repricing,function(e){Odigeo.UIElements.hint.enhance(Odigeo.History.getPageNameFromFragment(),e,{events:{tap:!0}})})},unbindFromDom:function(){this.isDomBinded&&(this.$cachedSelectors.help_desk_icon.off(Odigeo.Events.mouseover),this.$cachedSelectors.help_desk_icon.off(Odigeo.Events.mouseout),this.$cachedSelectors.hint_price_details.off(Odigeo.Events.mouseover),this.$cachedSelectors.hint_price_details.off(Odigeo.Events.mouseout),$(window).off(Odigeo.Events.scroll),this.isDomBinded=!1)},toggleCcType:function(e){this.$cachedSelectors.show_cc_type.toggleClass("odf-hidden",!e)},setCcSelected:function(e){this.$cachedSelectors.show_cc_name.html(e)},updateBaggagesView:function(){var e,t=Odigeo.AB.isItineraryBagPriceSplitDesktop?this.baggagesTemplateSplitted:this.baggagesTemplate;_.isFunction(t)&&(e=this.getBaggage(),this.$cachedSelectors.baggagesDisclaimer.toggleClass("odf-hidden",0===this.widget.getBaggageSelectedPieces()),this.$cachedSelectors.baggageTable.html(t(this.getBaggageTemplateData(e)))),this.$cachedSelectors.baggageTable.attr("data-all-price-baggage",this.widget.getBaggageSelectedTotalPrice()),Odigeo.trigger("getTotalByFullprice",this.$widget)},getBaggage:function(){return Odigeo.AB.isItineraryBagPriceSplitDesktop?this.widget.getAllBaggagePriceBreakDownItems():this.widget.getBaggagePriceBreakDownItems()},getBaggageTemplateData:function(e){if(!Odigeo.AB.isItineraryBagPriceSplitDesktop)return e;var t=s.getRequestType();return{baggageInfo:this.widget.extendItineraryBaggage(e),price:this.widget.getTotalPrice(e),translations:this.widget.options.translations.flightTypes[t]}},showIncludedSeatMap:function(e){var t,i,n,a=this.$cachedSelectors.seatmap_table;0<e.quantity?(t=this.$cachedSelectors.seat_map_concept,i=this.$cachedSelectors.seat_map_all_price,a.removeClass("hidden"),a.data("quantity-seatmap",e.quantity),i.html(Odigeo.Utils.formatCurrency(e.allprice)),i.attr("data-allprice-seatmap",e.allprice),n=Odigeo.Utils.pluralizeAll(t.attr("data-plural"),e.quantity),t.html(n)):a.addClass("hidden")},showIncludedBaggages:function(e){this.$cachedSelectors.baggageTable.data("quantity-baggage",e),this.$cachedSelectors.baggageTable.text(e)},fillPax:function(){this.widget.model.refreshPaxData()},updatePassengers:function(e){this.$widget.find(".pax_list").html(e),this.$widget.find(".pax_list").removeClass("hidden"),this.updateDomSelectorsToCache(),this.bindBaggageRepricing()},changeToPassengerDetails:function(){Odigeo.trigger(this.widget.id+":changeBackPage")},sendUserToResults:function(e){$(e.target).data("isUpsell")?Odigeo.Router.navigate("results"):this.sendUserToDpResults(e)},changeResults:function(t){var i=$(t.target).data("to");e.trackEventWithCategory(i,"searcher_flights","open_change_search"),"flights_pax_page"!==i&&Odigeo.Router.navigate("results")},sendUserToDpResults:function(e){Odigeo.Session.remove("before-page"),Odigeo.trigger(this.widget.id+":sendUserToDpResults",$(e.target).data("product"))},removeHotel:function(){var e=this.$el.find(".xsell_hotel_image").attr("src");this.$cachedSelectors.removeHotel.data("disabled")||Odigeo.trigger(this.widget.id+":removeHotel",e)},accommodationToggleDetails:function(t){var i=_.clone($(t.currentTarget).data("details")),n=$(t.currentTarget).data("label"),a=Odigeo.History.getPageNameFromFragment()+"_flights_container",s=this.$("#"+a).hasClass("open");t.stopPropagation(),i.target=a,Odigeo.trigger(this.widget.id+":toggleDetails",i),!s&&n&&e.trackEvent("trip_information",n)},disableRemoveHotel:function(){this.$cachedSelectors.removeHotel.data("disabled",!0)},enableRemoveHotel:function(){this.$cachedSelectors.removeHotel.data("disabled",!1)},confirmHotelRemoved:function(){this.$cachedSelectors.wrapper.addClass("hotel_removed")},showPriceWithoutDiscountSelectedDisclaimer:function(){if(!_.isEmpty(this.$cachedSelectors.cheapestPaymentmethodDisclaimer)){var e=this.$cachedSelectors.cheapestPaymentmethodDisclaimer.data("isPriceWithoutDiscountSelected");this.$cachedSelectors.cheapestPaymentmethodDisclaimer.toggleClass("odf-hidden",e)}},changePassengerSection:function(e){this.$cachedSelectors.passengersSection.toggleClass("odf-hidden",e),this.$cachedSelectors.premiumPassengerSection.toggleClass("odf-hidden",!e)},displayPremiumDisclaimers:function(e,t){var i="discount"===t||"noDiscount"===t||e;this.$cachedSelectors.membershipPriceDisplayDisclaimerNoBtwnTrav.toggleClass("odf-hidden",i),this.$cachedSelectors.membershipPriceDisplayDisclaimer.toggleClass("odf-hidden",!0)},updatePriceMemberDisplayPrices:function(e,t){a.updatePriceMemberDisplayPrices({action:e,isSubscriptionAdded:!!t,options:this.widget.options,$cachedSelectors:this.$cachedSelectors,$widget:this.$widget})},renderPremiumBubble:function(e){a.renderPremiumBubble({membershipSettings:e,$cachedSelectors:this.$cachedSelectors,options:this.widget.options,templateSettings:Odigeo.Utils.getTmplSettings({variable:""})})},updatePriceMemberDisplay:function(e,t){var i="login"===e||t||"discount"===e;this.displayPremiumDisclaimers(i,e)},updatePromocode:function(e){a.updatePromocode({$cachedSelectors:this.$cachedSelectors,promoCode:e,$widget:this.$widget})},updateTravellersName:function(e){var t=!_.isUndefined(e.id)&&0===e.id&&1===Number(this.widget.options.numTravellers);this.$cachedSelectors.premiumPassengerName.html(e.name),this.changePassengerSection(t)},onAddpaxAction:function(){Odigeo.trigger(this.widget.id+":addPaxSidebar")},updatePricesWithMembershipSubscription:function(e){var t=this.$el.find(".membership_subscription_table"),i=0===e.allPrice;t.toggleClass("odf-hidden",i),t.find(".od-js-all-price").attr("data-all-price",e.allPrice),t.find(".od-js-one-price").html(Odigeo.Utils.formatCurrency(e.onePrice)),t.find(".od-js-quantity").html(e.quantity),t.find(".od-js-all-price").html(Odigeo.Utils.formatCurrency(e.allPrice))},toggleClassToCachedSelectors:function(e,t,i){_.each(e,_.bind(function(e){this.$cachedSelectors[e].toggleClass(t,i)},this))},manageScroll:function(e){if(this.$cachedSelectors.wrapper.data("sticky")){var t,i=["title_summary","pax_summary","flights_summary","accommodation_summary"],n=e.scrollTop,a=e.bodyHeight,s=e.footerTop;0===this.initialTop&&(this.initialTop=this.$cachedSelectors.price_summary.offset().top),0===this.fullBarHeight&&(this.fullBarHeight=this.$cachedSelectors.tripSummaryPriceWrapper.height()),n>this.initialTop&&e.paymentMainHeight>this.$el.height()?(this.$cachedSelectors.wrapper.addClass("sticky"),this.toggleClassToCachedSelectors(i,"hidden",!0),this.finalTop=s-this.$cachedSelectors.price_summary.height(),t=0!==this.finalTop&&n>this.finalTop,this.$cachedSelectors.wrapper.toggleClass("sticky-footer",t),this.$cachedSelectors.wrapper.css({top:t?a-this.fullBarHeight:""}),t&&this.toggleClassToCachedSelectors(i,"hidden",!1)):(this.$cachedSelectors.wrapper.removeClass("sticky sticky-footer"),this.toggleClassToCachedSelectors(i,"hidden",!1))}}}),init:function(){this.bindEvents()},bindEvents:function(){this.suscribeBaggagesCollectionEvents()},onCollectionBuilt:function(){},onBaggageLoaded:function(){this.view.updateBaggagesView()},onBaggageChange:function(e){e.currentOption.get("selected")&&this.view.updateBaggagesView()},execute:function(e,t){switch(e){case"showIncludedBaggages":this.view.showIncludedBaggages(t);break;case"fillPax":this.view.fillPax();break;case"disableRemoveHotel":this.view.disableRemoveHotel();break;case"enableRemoveHotel":this.view.enableRemoveHotel();break;case"confirmHotelRemoved":this.view.confirmHotelRemoved();break;case"showIncludedSeatMap":this.view.showIncludedSeatMap(t);break;case"setCcSelected":this.view.setCcSelected(t);break;case"toggleCcType":this.view.toggleCcType(t);break;case"updateTravellersName":this.view.updateTravellersName(t);break;case"updatePriceMemberDisplay":this.view.updatePriceMemberDisplay.apply(this.view,_.tail(arguments));break;case"updatePriceMemberDisplayPrices":this.view.updatePriceMemberDisplayPrices.apply(this.view,_.tail(arguments));break;case"updatePromocode":this.view.updatePromocode.apply(this.view,_.tail(arguments));break;case"updatePrices":this.model.updatePrices();break;case"updatePremiumDisclaimers":this.view.displayPremiumDisclaimers(t);break;case"updatePremiumSidebarView":var i=t,n=i.isIncludedInPrice;i.isMembershipPriceDisplay&&(this.view.displayPremiumDisclaimers(n),this.view.changePassengerSection(n&&1==+this.options.numTravellers),this.view.renderPremiumBubble({isMemberTestActive:i.isMembershipPriceDisplay,isMemberLogged:i.isMemberLoggedIn,memberInTravellers:i.isIncludedInPrice,membershipPrice:i.membershipPrice}));break;case"updateBubblePremium":this.view.renderPremiumBubble(t);break;case"updatePricesWithMembershipSubscription":this.view.updatePricesWithMembershipSubscription(t);break;case"manageScroll":this.view.manageScroll(t)}}})))})},function(e,t,i){"use strict";var n={DEFAULT:"default",INFORMATIVE:"informative",POSITIVE:"positive-dark",WARNING:"warning"},a={DEFAULT:"default",LOGGED_APPLIED:"logged-applied",MEMBER_NOT_TRAVELERS:"member-not-travelers",LOGGED_PRIME_BLOCKED:"logged-prime-blocked",APPLIED:"applied",LOGGED_FREE_APPLIED:"logged-free-applied",NOT_APPLIED:"not-applied",SUBSCRIPTION_ADDED:"subscription-added"};function s(e){return"details"===e}function r(e){return"payment"===e}function o(e,t,i){return e&&t&&!i}function c(e,t,i){return e&&t&&!i}e.exports={getStatus:function(e,t){return function(e,t,i,d,l,g,h,u,p){var f,m,_,b,y,v,S,C,w,O,T,P={bubble:n.DEFAULT,primeSidebar:a.DEFAULT};return r(p)&&Odigeo.Membership.isMembershipPrimePaymentD&&!e?P={bubble:(T=i)?n.POSITIVE:n.DEFAULT,primeSidebar:T?a.SUBSCRIPTION_ADDED:a.DEFAULT}:r(p)&&u?P={bubble:n.WARNING,primeSidebar:a.LOGGED_PRIME_BLOCKED}:t&&i||(C=e,w=t,O=d,r(p)&&!C&&w&&O)?P={bubble:n.POSITIVE,primeSidebar:a.SUBSCRIPTION_ADDED}:(f=e,m=d,_=h,b=g,v=s(y=p)&&f&&!b&&(m||!_),S=r(y)&&f&&m,v||S?P={bubble:n.INFORMATIVE,primeSidebar:a.LOGGED_APPLIED}:o(l,t,i)&&c(t,e,d)&&g?P={bubble:n.INFORMATIVE,primeSidebar:a.LOGGED_FREE_APPLIED}:c(t,e,d)?P={bubble:n.WARNING,primeSidebar:a.MEMBER_NOT_TRAVELERS}:o(l,t,i)&&s(p)||!e&&d&&t&&r(p)?P={bubble:n.INFORMATIVE,primeSidebar:a.APPLIED}:t&&!i&&(P={bubble:n.WARNING,primeSidebar:a.NOT_APPLIED})),P}(e.isMemberLogged,e.isMemberTestActive,e.isSubscriptionAdded,e.memberInTravellers,e.isCheapestPriceSelected,e.isFreeAccount,e.isPrimeTravellerUnselected,e.isPrimeBlocked,t)}}},function(e,t,i){"use strict";var n=i(0);Odigeo.defineWidget("download_app_banner",Odigeo.Widget.extend({modelClass:Odigeo.Model.extend({categoryItem:null}),viewClass:Odigeo.View.extend({templateSettings:{evaluate:/\{\{#([\s\S]+?)\}\}/g,interpolate:/\{\{[^#{]([\s\S]+?)[^}]\}\}/g,escape:/\{\{\{([\s\S]+?)\}\}\}/g},selectors:{linkFooter:".footer_image_link"},init:function(){this.$cachedSelectors.linkFooter.off().on(Odigeo.Events.tap,_.bind(this.linkFooterTrack,this))},linkFooterTrack:function(e){var t,i,a;e.preventDefault(),t=$(e.currentTarget),i=_.property(t.data("type"))({apple:"apps_open_market_apple",android:"apps_open_market_android"}),a={category:this.model.categoryItem?this.model.categoryItem:t.data("track-category"),action:"apps_download",label:i},Odigeo.trigger("analytics:tracking",{type:"trackEvent",data:a}),window.open(n.decorateAppTouchpointUrl(t.data("url")))}}),trackEventCategory:function(e){this.model.categoryItem=e},dataTrack:function(e){this.view.$cachedSelectors.linkFooter.data("track-category",e)}}))},function(e,t,i){"use strict";e.exports={fillWaitingPage:function(e){var t=$("#page");if($(".waiting_flight_info")){var i=e.searchSegments[0];if($(".waiting_dep").css("margin-right",""),$(".waiting_depDate").removeClass("od-ui-waiting-one-date-field"),"oneWayTrip"===e.type||"roundTrip"===e.type){var n,a,s=i.departure.city,r=i.destination.city,o=i.departure.name,c=i.destination.name,d=i.destination.iata;if(!_.isEmpty(e.multipleDestinationCities)){var l=function(e,t,i){return _.reduce(_.map(t,e),function(e,t){return e+" - "+t},i)};r=l("city",e.multipleDestinationCities,r),c=l("name",e.multipleDestinationCities,c),d=l("iata",e.multipleDestinationCities,d)}!_.isEmpty(s)&&!_.isEmpty(r)&&s.length+r.length<26?(t.find(".waiting_dep").html(s),t.find(".waiting_arr").html(r)):!_.isEmpty(o)&&!_.isEmpty(c)&&o.length+c.length<26&&"CITY"===i.departure.type&&"CITY"===i.destination.type?(t.find(".waiting_dep").html(o),t.find(".waiting_arr").html(c)):(t.find(".waiting_dep").html(i.departure.iata),t.find(".waiting_arr").html(d)),"roundTrip"===e.type?(n=Odigeo.Utils.parseDate(i.dateStr),a=Odigeo.Utils.parseDate(e.searchSegments[1].dateStr),$(".waiting_depDate").each(function(e,t){var i=$(t);i.html(Odigeo.Utils.formatDate(n,i.data("format"),!0))}),$(".waiting_arrDate").each(function(e,t){var i=$(t);i.html(Odigeo.Utils.formatDate(a,i.data("format"),!0))})):(n=Odigeo.Utils.parseDate(i.dateStr),$(".waiting_depDate").each(function(e,t){var i=$(t);i.html(Odigeo.Utils.formatDate(n,i.data("format"),!0)).addClass("od-ui-waiting-one-date-field").siblings().addClass("hidden")}))}else $(".waiting_dep").html(Odigeo.UIElements.translations.waitings.multipleCities).css("margin-right","20px").siblings().addClass("hidden"),$(".waiting_depDate").html(Odigeo.UIElements.translations.waitings.multipleDates).addClass("od-ui-waiting-one-date-field").siblings().addClass("hidden");var g=parseInt(e.numAdults,10)+parseInt(e.numChildren,10)+parseInt(e.numInfants,10),h=$(".waiting_travellers"),u=Odigeo.Utils.pluralizeAll(h.data("plurals"),g);h.html(u);var p=$(".waiting_companies_list").text().split("|"),f=$(".waiting_companies_animation").attr("data-initialized");0<p.length&&"false"===f&&(setInterval(function(){var e=Math.floor(Math.random()*(p.length-1));$(".waiting_companies_animation").text(p[e])},80),$(".waiting_companies_animation").attr("data-initialized","true")),_.isEmpty(i.departure.name)||_.isEmpty(i.destination.name)||!(20<i.departure.name.length||20<i.destination.name.length)||$(".page-title").addClass("od-pagetitle-results-reduced-font")}}}},function(e,t,i){"use strict";e.exports={},e.exports.processError=function(e){var t=!_.isUndefined(e)&&e.messageError;Odigeo.Router.navigate(_.includes(["AUTH_005","AUTH_006","SSO_005","VAL_052","AUTH_100","AUTH_101"],t)?"loginexpired":"")}},function(e,t,i){"use strict";var n=i(555);e.exports=n.extend({buttonSelectedClass:"",buttonUnselectedClass:"odf-icon-plus",buttonSelectedKeyName:"buttonAdded",buttonUnselectedKeyName:"buttonAdd",selectors:_.extend({ancillariesSelectedBubble:".ancillaries_selected_bubble",hintContainer:".hint_container",seeFullCoverage:".see_full_coverage"},n.prototype.selectors),setButtonData:function(e){var t=this.model.isSelected(_.get(e,"policy"));_.extend(e,{buttonOptions:{buttonIconClass:t?this.buttonSelectedClass:this.buttonUnselectedClass,buttonText:t?this.keys[this.buttonSelectedKeyName]:this.keys[this.buttonUnselectedKeyName]}})},initSelectedBubble:function(){var e=this.$cachedSelectors.ancillariesSelectedBubble;e.toggleClass("odf-shake",!1),_.delay(function(){e.toggleClass("odf-shake",!0)},5)},toggleModalHandler:function(e){var t=this.getPolicyFromTarget(e),i=this.modals[t];if(!_.isEmpty(i)){var n=!this.model.isSelected(t);i.modal.open(n,!0)}}})},,,,function(e,t,i){"use strict";e.exports={};var n,a=[],s=function(){Odigeo.Utils.sessionTimer.resetTimeoutCounter(n+6e4)};e.exports.refreshSession=function(e,t){var i=0;n=!_.isEmpty(Odigeo.JCMS.extendSessionTime)&&$.isNumeric(Odigeo.JCMS.extendSessionTime)?Number(Odigeo.JCMS.extendSessionTime):102e4,_.isUndefined(a[t])||clearInterval(a[t]),Odigeo.Utils.sessionTimer.resetTimeoutCounter(n+6e4),a[t]=setInterval(function(){var n;Odigeo.Session.get("page")===t&&i<3?(i+=1,n=e,$.ajax({url:Odigeo.Settings.property("serviceUrlFormatter")("refreshSession"),contentType:"application/json",dataType:"json",method:"GET",data:{bookingId:Odigeo.Utils.trim(n)},success:s})):clearInterval(a[t])},n)}},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,i){"use strict";e.exports={getNumberOfPassengers:function(){return(Odigeo.Utils.parseJson(Odigeo.Session.get("booking_pax_list"))||[]).length}}},function(e,t,i){"use strict";var n=i(10);e.exports=n({viewClass:i(704),options:{"app-checkin-desktop-confirmation":{templateToRender:"appCheckInConfirmation",context:"ConfirmationPage"},"app-checkin-desktop-my-trips":{templateToRender:Odigeo.AB.getMyTripsPhase1QrDesktop>Odigeo.Utils.Partition.A?"appCheckInByQr":"appCheckInByEmail",context:"MyTripsDetails"}}})},function(e,t,i){"use strict";var n=i(10),a=i(706);e.exports=n({viewClass:a})},function(e,t,i){"use strict";var n=i(27),a=i(76),s="UTC:yyyy-mm-dd'T'HH:MM:ss";e.exports=function(e,t){var i,r,o,c,d,l;return r=t,o=2<arguments.length&&void 0!==arguments[2]?arguments[2]:"unknown",c=(i=e).trip.getNumberOfPassengers()-1,d={brand:i.appContext.getBrand().replace("-",""),language:i.appContext.getLanguage(),arrivalIataCode:i.flights.arrival.getDestinationAirportIata(),departureIataCode:i.flights.departure.getOriginAirpotIata(),clientResidenceId:i.client.getResidenceId(),clientAge:i.client.getAge(),arrivalDateTime:n.getEncodedDate(i.flights.arrival.getArrivalDate(),s),departureDateTime:n.getEncodedDate(i.flights.departure.getDepartureDate(),s),currency:i.trip.getCurrencyCode(),nOfPassengers:c,sourceCountry:i.flights.arrival.getOriginCountryCode(),destinationCountry:i.flights.arrival.getDestinationCountryCode(),oneWay:(l=i.trip.getType(),"ONE_WAY"===l?1:0),nOfBaggages:i.client.getNumberOfBaggagesInArrival()},Odigeo.Utils.replaceCmsKeyArgsByName(r,d)+"&clientId="+a(o)}},function(e,t,i){"use strict";var n=i(10);e.exports=n({viewClass:i(709)})},function(e,t,i){"use strict";var n=i(27),a="mm/dd/yyyy HH:MM";e.exports=function(e,t){var i,s,r,o,c,d,l="ONE_WAY"===e.trip.getType();return Odigeo.Utils.replaceCmsKeyArgs(t,n.isMyTripsHome()?"link-mytrips-out":"link-mytrips-in","MULTI_SEGMENT"===(d=e).trip.getType()?"one_way":d.trip.getType().toLowerCase(),e.trip.getNumberOfPassengers(),e.flights.arrival.getDestinationAirportIata(),(o=e.flights.arrival.getArrivalDate(),c=Odigeo.Utils.roundDateMinutesToQuarterHours(o),c=Odigeo.Utils.addMins(c,30),Odigeo.Utils.formatDate(c,a)),(i=e.flights.departure.getDepartureDate(),s=l?1:-3,r=Odigeo.Utils.roundDateMinutesToQuarterHours(i),r=Odigeo.Utils.addHours(r,s),Odigeo.Utils.formatDate(r,a)))}},function(e,t,i){"use strict";var n=i(10);e.exports=n({viewClass:i(715)})},,function(e,t,i){"use strict";var n="ancillaries_yesno_remove_button",a="ancillaries_yesno_add_button",s="mandatory_selection_validation_changed",r=i(358),o=i(78),c=Odigeo.View,d=["widget","options","model"],l="show_modal_dual_contract",g="modal_dual_contract";e.exports=c.extend({tagName:"div",modals:null,modalTemplateName:null,hasMandatorySelectionDisplayedAtLeastOnce:!1,events:{"click .ancillaries_add_button":"onAncillariesButtonClickToggle","click .see_modal":"toggleModalHandler","mousedown .conditions_link":"onConditionsLinkClick","mousedown .ipid_link":"onIpidLinkClick","click @noButton":"onAncillariesYesNoButtonClick","click @yesButton":"onAncillariesYesNoButtonClick"},selectors:{mandatorySelectionWrapper:".mandatory_selection_error_wrapper",noButton:"."+n,yesButton:"."+a},initialize:function(e){_.extend(e,_.pick(this,["el"])),c.prototype.initialize.call(this,e),_.extend(this,_.pick(e,d)),this.modals={},this.listenTo(this.model,"change",this.refresh),this.listenTo(this.model,"nagAccepted",this.onNagAccepted),this.listenTo(this.model,"nagRejected",this.onNagRejected),this.on("refresh",this.handleMandatorySelectionAnimation)},handleMandatorySelectionAnimation:function(){var e=this.$cachedSelectors.mandatorySelectionWrapper,t=this.model.getValidationFailed();e.hasClass(s)&&setTimeout(function(){e.removeClass(s).toggleClass("od-ancillaries-module-mandatory-selection-error-disposed",!t)},0)},getTemplateName:function(e){return e||this.model.getTemplate()},parseTextsAndAttributes:function(e){this.parseBenefits(e),this.parseFreeFlag(e),this.model.hasIpid(e)&&this.parseFooterIpidLink(e)},setButtonData:function(){return null},setYesNoData:function(e){var t=this.model.isSelected(),i=this.model.isInPreRejectedState()||this.model.isRejected(),n=this.model.isPrecheckedMarket(),a=this.model.changedAttributes(),r=_.has(a,"validationFailed");this.hasMandatorySelectionDisplayedAtLeastOnce=this.hasMandatorySelectionDisplayedAtLeastOnce||this.model.isContinuanceValidationFailed();var o=this.hasMandatorySelectionDisplayedAtLeastOnce&&r;_.extend(e,{mandatorySelectionWrapperClass:o?s:"odf-hidden",buttonGroupClass:this.model.isContinuanceValidationFailed()?"focus-error":"",yesButtonClass:this.getYesNoButtonClass(t,n,!0),noButtonClass:this.getYesNoButtonClass(i,n,!1)})},getYesNoButtonClass:function(e,t,i){return e?t?"selected":i?"selected-positive selected":"selected-negative selected":""},parseBenefits:function(e){_.extend(_.get(e,"texts"),{parsedBenefits:_.get(e,"texts.parsedBenefits")||this.parseBenefitsHtml(_.get(e,"texts.benefits","")),parsedFullBenefits:_.get(e,"texts.parsedFullBenefits")||this.parseBenefitsHtml(_.get(e,"texts.benefitsFull"))})},parseBenefitsHtml:function(e,t){t=t||"odf-ul-mark odf-ul-mark-md";var i=$("<div>");i.html(e);var n=$("ul > li",i);return $("li",i).not(n).addClass("invalid_li"),$(".invalid_li:first-child, *:not(.invalid_li) + .invalid_li, * > .invalid_li",i).each(function(){$(this).nextUntil(":not(.invalid_li)").addBack().wrapAll("<ul/>")}),$("ul",i).addClass(t),$("li",i).removeClass("invalid_li").addClass("odf-li"),i.html()},extendModelBeforeRender:function(){var e=this.model.toJSON(),t=this.model.isMultiOffer()?e.products:[e];return _.each(t,this.parseTextsAndAttributes,this),e},beforeInsertTemplate:function(e){return this.parseDataBeforeInsertTemplate(e),{tmpl:e}},parseDataBeforeInsertTemplate:function(e){this.setButtonData(e),this.setYesNoData(e),this.setTranslationsData(e)},setTranslationsData:function(e){_.extend(e,{translations:this.keys||{}})},preRender:function(){this.lastParsedModelData=this.extendModelBeforeRender()},render:function(){return this.setTemplate(this.$el,this.getTemplateName(),this.lastParsedModelData),this},postRender:function(){this.initModals(this.lastParsedModelData),Odigeo.trigger("optimize:hasRendered",this.className)},initModals:function(e){if(_.isObject(e)){var t=this.model.isMultiOffer()?_.get(e,"products"):[e];_.each(t,this.initOrRefreshModal,this)}},initOrRefreshModal:function(e){var t=_.get(e,"policy"),i=this.modals[t];if(this.model.hasModal())if(_.isEmpty(i))this.initModal(e),this.bindModalEvents(e);else{var n=this.getModalContainerByPolicy(t);_.isNull(n)||(i.modal.updateContainer(n),i.container=n,this.bindModalEvents(e))}},initModal:function(e){var t=_.get(e,"policy"),i=this.getModalContainerByPolicy(t);if(!_.isNull(i)){var n=_.get(e,"isFree"),a=n?"modals/common/priceDisplayFree":"modals/common/priceDisplay",s=this.getModalData(e,n),r=new o(i,{header:s.header,content:this.getParsedTemplateContent("modals/modalContent",s),priceTemplate:this.getParsedTemplateContent(a,s),button:s.button},{fillThePage:!1,template:this.getTemplateBuilder(this.modalTemplateName),button:{analytics:this.widget.tracking.getTrackData("add_from_coverage",t),callback:_.bind(function(){this.toggleSelected(t)},this.model),hide:!this.model.canAddOfferFromModal(e)},open:{analytics:this.widget.tracking.getTrackData("open_details",t)},close:{analytics:this.widget.tracking.getTrackData("close_details",t)}});this.modals[t]={modal:r,container:i}}},getModalData:function(e,t){var i={hasModalExclusion:this.model.hasModalExclusion(e),hasModalBenefits:this.model.hasModalBenefits(e),hasDualContract:this.model.hasDualContract(e),header:_.get(e,"texts.modal.header",""),button:_.get(e,"texts.modal.button",""),prices:{text:t?_.get(this.keys,"pricePerBooking"):_.get(e.prices,"text"),priceToDisplayFormatted:t?_.get(e,"texts.slashedPrice"):_.get(e.prices,"priceToDisplayFormatted"),pillPrice:t?_.get(e,"texts.pillPrice"):""}};return this.generateModalExclusions(i,e),this.generateModalBenefits(i,e),i},generateModalBenefits:function(e,t){var i=_.get(t,"texts.parsedFullBenefits","")||_.get(t,"texts.parsedBenefits","");e.hasModalBenefits&&!_.isEmpty(i)&&(e.benefits=i)},generateModalExclusions:function(e,t){var i=_.get(t,"texts.modal.exclusions");if(e.hasModalExclusion&&!_.isEmpty(i)){_.merge(e,{summary:_.get(t,"texts.modal.summary",""),exclusions:this.parseExclusions(i),links:{summary:_.get(t,"texts.modal.summaryLink",""),extended:_.get(t,"texts.modal.extendedLink",""),summaryUrl:this.model.get("url"),extendedUrl:this.model.get("urlExtended")}});var n=_.get(t,"texts.modal.dualContract","");e.hasDualContract&&!_.isEmpty(n)&&_.merge(e,{constants:{dualContractLinkClass:l,dualContractClass:g},dualContract:n,links:{dualContract:_.get(t,"texts.modal.dualContractLink","")}})}},parseExclusions:function(e){var t=void 0;try{var i=(t=$("<div>",{html:e})).children();i.filter("li").addClass("odf-li"),i.filter("p").find("> b").addClass("odf-row-fluid odf-space-inner-top-s odf-space-inner-top-m"),i.filter("ul").addClass("odf-ul-mark odf-ul-mark-md")}catch(i){t=$("<div>",{text:e})}return t.html()},toggleModalHandler:function(e){var t=this.getPolicyFromTarget(e.target),i=this.modals[t];if(!_.isEmpty(i)){var n=!this.model.isSelected(t);i.modal.open(n,!1)}},bindModalEvents:function(e){var t=_.get(e,"policy"),i=_.get(this.modals,t,!1),n=void 0;i&&((n=i.container).find(".link_conditions").on(Odigeo.Events.tap,_.bind(function(e){this.trackModalConditionsLinkClick(e,t)},this)),this.model.hasDualContract(e)&&n.find("."+l).on(Odigeo.Events.tap,_.bind(function(){this.showModalDualContract(n,t)},this)))},trackModalConditionsLinkClick:function(e,t){e.stopPropagation(),"short"===$(e.target).data("type")?this.widget.tracking.openConditionsShort(t):this.widget.tracking.openConditionsLong(t)},showModalDualContract:function(e,t){var i=e.find("."+l),n=e.find("."+g);i.addClass("odf-hidden"),n.removeClass("odf-hidden"),this.widget.tracking.openConditionsMore(t)},getModalContainerByPolicy:function(e){var t=void 0;return _.isFunction(_.get(this.$el,"find"))&&(t=this.$el.find('.modal_container[data-policy="'+e+'"]')),t&&t.length?t:null},onAncillariesButtonClickToggle:function(e){e.preventDefault(),e.stopPropagation(),this.model.toggleSelected(this.getPolicyFromTarget(e.target))},onAncillariesYesNoButtonClick:function(e){e.preventDefault(),e.stopPropagation();var t=$(e.target),i=this.model.getPolicyFromSimpleOffer(),n=this.model.getRejectedPolicy(),a=this.model.hasMandatorySelectionErrorBeenShown();this.model.setLastPolicyInteractedWith(i),this.hasClickedYesButton(t)?(this.widget.tracking.addOrRemoveProduct(i,!0,a),this.model.checkNagAndSelectProduct(!0,i)):this.hasClickedNoButton(t)&&(this.widget.tracking.addOrRemoveProduct(i,!1,a),this.model.checkNagAndSelectProduct(!1,n))},hasClickedYesButton:function(e){var t=this.model.getSelectedPolicy(),i=this.model.getRejectedPolicy(),n=e.hasClass(a),s=t===i,r=_.isEmpty(t);return n&&(r||s)},hasClickedNoButton:function(e){var t=this.model.getSelectedPolicy(),i=this.model.getRejectedPolicy();return e.hasClass(n)&&t!==i},getPolicyFromTarget:function(e){return this.model.isMultiOffer()?e.value:this.model.get("policy")},onConditionsLinkClick:function(e){var t=this.model.isMultiOffer()?$(e.target).data("policy"):this.model.get("policy");this.widget.tracking.openConditionsFromFooter(t)},onIpidLinkClick:function(e){var t=this.model.isMultiOffer()?$(e.target).data("policy"):this.model.get("policy");this.widget.tracking.openIpid(t)},onNagAccepted:function(e){e===r.NAG_TYPE.continuance&&Odigeo.trigger(this.widget.name+":onContinuanceNagAccepted",this.$el),e===r.NAG_TYPE.confirmation&&this.model.selectProduct(!0,this.model.getLastPolicyInteractedWith())},onNagRejected:function(e){e===r.NAG_TYPE.continuance&&Odigeo.trigger(this.widget.name+":onContinuanceNagRejected"),e!==r.NAG_TYPE.reject&&e!==r.NAG_TYPE.confirmation||(this.model.selectProduct(!1,this.model.getRejectedPolicy()),this.model.setValidationFailed(!1))},parseFooterIpidLink:function(e){var t=this.getTemplateBuilder("links/ipidLink")({tmpl:e});_.extend(e.texts,{parsedFooterIpid:Odigeo.Utils.replaceCmsKeyArgs(e.texts.footerIpid,t)})},parseFreeFlag:function(e){_.extend(e,{isFree:this.model.isFree(e)})}})},,function(e,t,i){"use strict";var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),a=i(366),s=new Odigeo.Enum(["short","long","more","disclosure"]),r=["CANC","CANCASS","COMPREH","ANYREASON","FLEX","ASS","HUB","LUG","ADDITIONAL",a.UNKNOWN_CLASSES_ENUM.UNKNOWN],o=new Odigeo.Enum(r),c={"1-26-5251592":o.CANC,CNXFLT151:o.CANC,CNXFHL157:o.CANC,"G-AIRI01":o.CANC,CNXFHL154:o.CANC,CNXHOT155:o.CANC,"55-0009760":o.CANCASS,CNXAST152:o.CANCASS,CNXAST158:o.CANCASS,"G-AIRD01":o.CANCASS,COMPREH163:o.COMPREH,CANXSELF:o.ANYREASON,FLEXSELF:o.FLEX,FLEXRB156:o.FLEX,FLEXRB160:o.FLEX,ASTONL162:o.ASS,NEWHUB162:o.HUB,INSLUG159:o.LUG,LUGPRM161:o.LUG,CONFIRMATION_SMS:o.ADDITIONAL,BAGGAGE_ASSISTANCE:o.ADDITIONAL,POSTED_TICKET:o.ADDITIONAL,EVISA:o.ADDITIONAL,ESTA:o.ADDITIONAL,AUTO_CHECKIN:o.ADDITIONAL},d=a.PARAM_STRING,l=a.PRODUCT_STRING,g={onload:{action:"on_load_ancillaries",label:"ancillary_onload_"+d},add:{action:l+"_product_selection",label:l+"_product_add_"+d},add_from_details:{action:l+"_product_selection",label:l+"_details_add_"+d},add_from_coverage:{action:l+"_product_selection",label:l+"_coverage_add_"+d},add_after_mandatory:{action:l+"_product_selection",label:l+"_mandatory_add_"+d},remove:{action:l+"_product_selection",label:l+"_product_remove_"+d},remove_after_mandatory:{action:l+"_product_selection",label:l+"_mandatory_remove_"+d},open_details:{action:l+"_product_information",label:"open_details_"+l+"_"+d},close_details:{action:l+"_product_information",label:"close_details_"+l+"_"+d},open_coverage:{action:l+"_product_information",label:"open_coverage_"+l+"_"+d},close_coverage:{action:l+"_product_information",label:"close_coverage_"+l+"_"+d},conditions_short:{action:l+"_product_information",label:"open_conditions_short_"+l+"_"+d},conditions_long:{action:l+"_product_information",label:"open_conditions_long_"+l+"_"+d},conditions_more:{action:l+"_product_information",label:"open_conditions_more_"+l+"_"+d},conditions_from_footer:{action:l+"_product_information",label:"open_conditions_footer_"+l+"_"+d},conditions_disclosure:{action:l+"_product_information",label:"open_conditions_disclosure_"+l+"_"+d},ipid:{action:l+"_product_information",label:"open_ipid_"+l+"_"+d},continue:{action:l+"_product_selection",label:l+"_product_selected_"+d},choose_bubble:{action:"possible_CTA",label:l+"_choose_bubble_"+d},recommended_bubble:{action:"possible_CTA",label:l+"_recommended_bubble_"+d},available_only_now_bubble:{action:"possible_CTA",label:l+"_available_only_now_bubble_"+d},added_bubble:{action:"possible_CTA",label:l+"_added_bubble_"+d},error:{action:"back_end_errors",label:d+"_error"},mandatory_selection_error:{action:"back_and_errors",label:l+"_mandatory_error_"+d}},h={desktop:{payment:"ancillaries"},mobile:{"ancillaries/canx":"canx","ancillaries/flex":"flex","ancillaries/insurance":"insurance","ancillaries/selection":"selection","ancillaries/additions":"additions"}},u={insurances:{reject:{appears:{label:"nag_insurance_removal_appearances",action:"nags",optimize:!0},accept:{label:"nag_insurance_removal_add",action:"nags"},reject:{label:"nag_insurance_removal_continue",action:"nags"}},continuance:{appears:{label:"nag_insurance_submit_appearances",action:"nags",optimize:!0},accept:{label:"nag_insurance_submit_add",action:"nags"},reject:{label:"nag_insurance_submit_continue",action:"nags"}},confirmation:{appears:{label:"nag_CANCASS_removal_appearances",action:"nags",optimize:!0},accept:{label:"nag_CANCASS_removal_add",action:"nags"},reject:{label:"nag_CANCASS_removal_continue",action:"nags"}}},flex:{reject:{appears:{label:"nag_flexible_removal_appearances",action:"nags"},accept:{label:"nag_flexible_removal_add",action:"nags"},reject:{label:"nag_flexible_removal_continue",action:"nags"}}},CANXSELF:{reject:{appears:{label:"nag_CANXSELF_removal_appearances",action:"nags"},accept:{label:"nag_CANXSELF_removal_add",action:"nags"},reject:{label:"nag_CANXSELF_removal_continue",action:"nags"}}}},p={NEWHUB162:u.insurances,CNXFLT151:u.insurances,CNXAST152:u.insurances,CNXFHL154:u.insurances,ASTONL162:u.insurances,"G-AIRI01":u.insurances,"G-AIRD01":u.insurances,CNXFHL157:u.insurances,CNXAST158:u.insurances,"1-26-5251592":u.insurances,"56-0009760":u.insurances,COMPREH163:u.insurances,FLEXSELF:u.flex,FLEXRB156:u.flex,FLEXRB160:u.flex,CANXSELF:u.CANXSELF},f=function(e){function t(e){return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,t),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,g,c,r,h,p))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a),n(t,[{key:"clickConditionsFromPopup",value:function(e,t){var i=void 0;switch(t){case s.short:case s.long:case s.more:case s.disclosure:i=t;break;default:i=s.long}this.trackEvent("conditions_"+i,e)}}]),t}();f.prototype.addProductFromDetails=f.prototype.prepareTrackEventFunction("add_from_details"),f.prototype.addProductFromCoverage=f.prototype.prepareTrackEventFunction("add_from_coverage"),f.prototype.openCoverage=f.prototype.prepareTrackEventFunction("open_coverage"),f.prototype.closeCoverage=f.prototype.prepareTrackEventFunction("close_coverage"),f.prototype.openConditionsShort=f.prototype.prepareTrackEventFunction("conditions_short"),f.prototype.openConditionsLong=f.prototype.prepareTrackEventFunction("conditions_long"),f.prototype.openConditionsDisclosure=f.prototype.prepareTrackEventFunction("conditions_disclosure"),f.prototype.openIpid=f.prototype.prepareTrackEventFunction("ipid"),f.prototype.openConditionsMore=f.prototype.prepareTrackEventFunction("conditions_more"),f.prototype.openConditionsFromFooter=f.prototype.prepareTrackEventFunction("conditions_from_footer"),f.prototype.chooseBubble=f.prototype.prepareTrackEventFunction("choose_bubble"),f.prototype.recommendedBubble=f.prototype.prepareTrackEventFunction("recommended_bubble"),f.prototype.availableOnlyNowBubble=f.prototype.prepareTrackEventFunction("available_only_now_bubble"),f.prototype.error=f.prototype.prepareTrackEventFunction("error"),f.prototype.mandatorySelectionError=f.prototype.prepareTrackEventFunction("mandatory_selection_error"),e.exports=f},function(e,t,i){"use strict";var n=function(){function e(e,t){for(var i=0;i<t.length;i++){var n=t[i];n.enumerable=n.enumerable||!1,n.configurable=!0,"value"in n&&(n.writable=!0),Object.defineProperty(e,n.key,n)}}return function(t,i,n){return i&&e(t.prototype,i),n&&e(t,n),t}}(),a=i(366),s=new Odigeo.Enum(["basic","standard","premium"]),r=["SO",a.UNKNOWN_CLASSES_ENUM.UNKNOWN],o=new Odigeo.Enum(r),c={STANDARD:o.SO,PREMIUM:o.SO,BASIC:o.SO},d=a.PARAM_STRING,l={onload:{action:"on_load_service_options",label:"service_options_onload_"+d},add:{action:"service_options_selection",label:"service_options_add_"+d},remove:{action:"service_options_selection",label:"service_options_remove_"+d},open_details:{action:"service_options_information",label:"open_basic_summary_"+d},close_details:{action:"service_options_information",label:"close_basic_summary_"+d},modify:{action:"service_options_information",label:"modify_service_option"},change_phone:{action:"service_options_information",label:"change_phone_unfolded"},change_phone_ok:{action:"service_options_information",label:"change_phone_done"},change_phone_incorrect:{action:"service_options_information",label:"change_phone_incorrect_number"},continue:{action:"service_options_selection",label:"service_options_selected_"+d},popular_bubble:{action:"possible_CTA",label:"service_options_popular_bubble_"+d},added_bubble:{action:"possible_CTA",label:"service_options_added_bubble_"+d},continue_without_so_error:{action:"service_options_selection",label:"service_options_error_message"},evo_open_details:{action:"service_options_information",label:"open_details_so_"+d},evo_close_details:{action:"service_options_information",label:"close_details_so_"+d},close_coverage:{action:"service_options_coverage",label:"service_options_close_"+d},add_from_coverage:{action:"service_options_coverage",label:"service_options_add_"+d},open_coverage:{action:"service_options_information",label:"open_coverage_so_"+d}},g={desktop:{payment:"ancillaries"},mobile:{servicepack:"servicepack"}},h=function(e){function t(e){return function(e,i){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this),function(e,t){if(!e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!t||"object"!=typeof t&&"function"!=typeof t?e:t}(this,(t.__proto__||Object.getPrototypeOf(t)).call(this,e,l,c,r,g,null))}return function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function, not "+typeof t);e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,enumerable:!1,writable:!0,configurable:!0}}),t&&(Object.setPrototypeOf?Object.setPrototypeOf(e,t):e.__proto__=t)}(t,a),n(t,[{key:"getTrackData",value:function(e,i,n){return i=function(e){var t=_.isString(e)?e.toLowerCase():e,i=void 0;if(_.isEmpty(s[t]))i=e;else switch(t){case s.basic:i="0";break;default:i=e[0].toUpperCase()}return i}(i),function e(t,i,n){null===t&&(t=Function.prototype);var a=Object.getOwnPropertyDescriptor(t,i);if(void 0===a){var s=Object.getPrototypeOf(t);return null===s?void 0:e(s,i,n)}if("value"in a)return a.value;var r=a.get;return void 0!==r?r.call(n):void 0}(t.prototype.__proto__||Object.getPrototypeOf(t.prototype),"getTrackData",this).call(this,e,i,n)}}]),t}();h.prototype.modifySelection=h.prototype.prepareTrackEventFunction("modify"),h.prototype.changePhoneNumber=h.prototype.prepareTrackEventFunction("change_phone"),h.prototype.changePhoneNumberOk=h.prototype.prepareTrackEventFunction("change_phone_ok"),h.prototype.changePhoneIncorrect=h.prototype.prepareTrackEventFunction("change_phone_incorrect"),h.prototype.popularBubble=h.prototype.prepareTrackEventFunction("popular_bubble"),h.prototype.continueWithoutSoError=h.prototype.prepareTrackEventFunction("continue_without_so_error"),e.exports=h},function(e,t,i){"use strict";var n=i(734),a={TEXT_BOX:"klarnaTextBoxTemplate",COMBO_BOX:"klarnaComboBoxTemplate",CHECK_BOX:"klarnaCheckBoxTemplate"},s=function(e){return _.reduce(e,_.bind(function(e,t,i){var n=t.informationFieldOptions.boxType,s=function(e,t){return _.template(this.$cachedSelectors[a[e]].html(),this.tmplSettings)(t)}.call(this,n,t);return e[i]=_.extend({},t,{contentBox:s}),e},this),{})};e.exports={controller:{initKlarnaController:function(){this.model.set("klarna_json",n)}},model:{},selectors:{klarnaTemplate:".klarna_template",klarnaCheckBoxTemplate:".klarna_check_box_template",klarnaComboBoxTemplate:".klarna_combo_box_template",klarnaTextBoxTemplate:".klarna_text_box_template",klarnaContainer:".klarna_container",klarnaFields:".klarna_form input, .klarna_form select"},view:{initView:function(){this.templateKlarna=_.template(this.$cachedSelectors.klarnaTemplate.html(),this.tmplSettings),this.$cachedSelectors.klarnaContainer.html(this.templateKlarna({data:function(e){return _.merge({},e,{options:{form:{form:s.call(this,e.options.form.form)}}})}.call(this,n)})),this.updateDomSelectorsToCache(),this.$cachedSelectors.klarnaFields.on(Odigeo.Events.change,_.bind(this.klarnaFieldChanged,this))},klarnaFieldChanged:function(e){this.validate(e.target)},validate:function(e){e.validity.valid&&$(e).parent().addClass("valid")}}}},function(e,t,i){"use strict";var n,a,s,r,o;e.exports=(n=i(94),a=i(52),s=i(333),r=i(0),o="CREDITCARD",a.extend(n.extend({paymentOptionsUrl:Odigeo.Settings.property("serviceUrlFormatter")("paymentoptions"),confirmPaymentUrl:Odigeo.Settings.property("serviceUrlFormatter")("confirm"),confirmShoppingBasketUrl:Odigeo.Settings.property("serviceUrlFormatter")("accommodationpostbooking/confirmshoppingbasket"),amexType:["AB","AX","TA"],defaultCreditCard:null,defaults:{creditCardData:{},bookingUserComments:"",showCCDropdown:!1},validationRegExps:{creditCardData:{},invoiceRequestDTO:{}},init:function(){this.widget.options=_.extend({isDynpack:!1},Odigeo.parseOptions(this.widget.options)),this.set({defaultDataStorage:null,storedCCList:[],availablePaymentCCList:[],storedCCListValid:[]})},setUserData:function(e){this.set("user",e)},isValidCreditCardWithSpaces:function(e,t){var i=new RegExp(this.widget.view.$cachedSelectors.ccnumber.data("pattern")),n=e.replace(/\s|\/|-/g,"");return!!i.test(e)&&Odigeo.Utils.isValidCreditCard(n,t)},getPaymentMethod:function(){return this.get("chosenMethod")},getCreditCardTypeError:function(e,t){return this.get("showCCDropdown")&&!e.cardTypeSelector&&(t.cardTypeSelector="empty"),t},getCreditCardNameError:function(e,t){var i=this.validationRegExps.creditCardData;return(_.isEmpty(e.nameoncard)||i.nameoncard instanceof RegExp&&!i.nameoncard.test(e.nameoncard))&&(t.nameoncard=_.isEmpty(e.nameoncard)?"empty":"invalid"),t},getCreditCardNumberError:function(e,t,i){var n={};return n[s[e.code]?s[e.code].type:"unknown"]=!0,!_.isEmpty(t.ccnumber)&&this.isValidCreditCardWithSpaces(t.ccnumber,n)||(i.ccnumber=_.isEmpty(t.ccnumber)?"empty":"invalid"),i},getCreditCardExpirationError:function(e,t){var i=new Date,n=Number("20"+e.cardExpirationYear);return _.isUndefined(e.cardExpirationYear)||_.isUndefined(e.cardExpirationMonth)||_.isNaN(n)||"-1"===e.cardExpirationYear||"-1"===e.cardExpirationMonth?t.creditCardExpiration="empty":(i.getUTCFullYear()>n||i.getUTCFullYear()===n&&i.getUTCMonth()+1>Number(e.cardExpirationMonth))&&(t.creditCardExpiration="invalid"),t},getCreditCardCvvError:function(e,t,i){var n=this.getCvvLength(e.code),a=_.isEmpty(t.cvv2),s=new RegExp("^\\d{"+n+"}$");return!a&&s.test(t.cvv2)||(i.cvv2=a?"empty":"invalid"),i},validate:function(e){var t,i,n,a={};if(_.isEmpty(e.paymentMethods)?a.paymentMethods="empty":_.isNumber(e.bookingId)?e.chosenMethod===o&&(i=e.chosenCard,n=_.chain(e.paymentMethods).find(_.matches({method:o})).result("info").result("cardTypes").pluck("code").value(),t=e.creditCardData,_.isUndefined(i)||!_.contains(n,i.code)?a.chosenCard="invalid":this.getSelectedStorageCreditCard()?a=this.getCreditCardCvvError(i,t,a):i.method!==o&&"SECURE3D"!==i.method||(a=this.getCreditCardTypeError(t,a),a=this.getCreditCardNameError(t,a),a=this.getCreditCardNumberError(i,t,a),a=this.getCreditCardExpirationError(t,a),a=this.getCreditCardCvvError(i,t,a))):a.bookingId="invalid",this.widget.options.enableButtonWhenFormIsValid&&Odigeo.trigger(this.widget.id+":toogleButton",_.isEmpty(a)),!_.isEmpty(a))return a},getCvvLength:function(e){return-1<_.indexOf(this.amexType,e)?4:3},parse:function(e,t){var i,n,a=[];return n=Odigeo.Utils.parseJson(Odigeo.Session.get("isAccommodationPostBooking"))?this.confirmShoppingBasketUrl:this.confirmPaymentUrl,t.url===n?this.set("response",e):_.isUndefined(e)||_.isEmpty(e.paymentMethods)?this.widget.bookingAlreadyDone||Odigeo.trigger(this.widget.id+":noPaymentMethodsAvailable"):(a=_.chain(e.paymentMethods).findWhere({method:o}).result("info").result("cardTypes").value(),i=_.findWhere(a,{code:e.chosenCard}),e.presetCard=e.chosenCard=i,e.chosenCard=this.attributes.chosenCard?this.attributes.chosenCard:e.chosenCard),this.set("availablePaymentCCList",a),e},setRegExp:function(e,t,i){var n;_.includes(e,o)&&(n=this.validationRegExps.creditCardData),n&&(n[t]=new RegExp(i))},setCardType:function(e){var t;t=e&&""!==e?_.chain(this.get("paymentMethods")).find({method:o}).result("info").result("cardTypes").find({code:e}).value():this.get("presetCard"),this.set("chosenCard",t)},setCardData:function(e,t){if(!e)return!1;var i,n,a,s=e.split("|");return _.includes(s,o)&&(i="creditCardData"),!!i&&(n=_.clone(this.get(i)),_.extend(n,t),a=this.set(i,n),this.isValid(),this.trigger("cardChanges",{changes:_.keys(t),errors:this.validationError}),Odigeo.trigger(this.widget.id+":updateCardMethod"),a)},getPaymentOptions:function(){r.startMetric("LOAD_PAYMENT_OPTIONS"),this.fetch({url:this.paymentOptionsUrl})},changePaymentMethod:function(e){e?this.set("chosenMethod",e):e=this.get("chosenMethod",e);var t,i,n=this.get("paymentMethods");if(_.some(n,_.matches({method:e}))){if(this.set({chosenMethod:e}),e===o&&this.isStoredCardsAvailability()&&this.selectStorageCreditCard(),(t=this.toJSON()).chosenMethod===o)i={concept:t.chosenCard.code,onePrice:t.chosenCard.fee/this.widget.options.numTravellers,allPrice:t.chosenCard.fee,quantity:this.widget.options.numTravellers,type:"CC_FEE",method:e};else{var a=_.find(t.paymentMethods,_.matches({method:t.chosenMethod}));i={concept:a.description.name,allPrice:a.fee,onePrice:a.fee,quantity:this.widget.options.numTravellers,type:"CC_FEE",method:e}}this.trigger("feeChanges",t),this.addItemToPricemanagerCollection(i)}},changeCreditCard:function(e,t){var i=_.find(this.get("paymentMethods"),{method:o}).info.cardTypes,n=_.find(i,_.matches({code:e}));n&&(this.set({chosenCard:n,ccResolved:t}),this.trigger("feeChanges",this.toJSON()))},setInvoiceRequestDTO:function(e){this.set("invoiceRequestDTO",e)},setBookingUserComments:function(e){this.set("bookingUserComments",e)},buildBuyerRequestDTO:function(e,t){var i={};return i.bookingId=e,i.buyer=t,i.buyer.countryCode=_.get(t,"country"),i},getExpectedPrice:function(e){var t="mobile"===Odigeo.SessionScope.flow?_.get(e,"expectedPrice"):this.getUnformattedFinalPrice();return parseFloat(t||0).toFixed(2)},getRequest:function(e){var t,i,n,a,s,r,c=this.getSelectedStorageCreditCard(),d=Odigeo.Utils.parseJson(Odigeo.Session.get("isAccommodationPostBooking")),l=_.get(e,"addBuyerInformationRequestDTO");return this.isValid()?(a=(t=this.toJSON()).chosenMethod===o?t.chosenCard.method:t.chosenMethod,n=d?{paymentMethod:a,invoiceRequestDTO:t.invoiceRequestDTO}:{bookingId:t.bookingId,bookingUserComments:t.bookingUserComments,expectedAmmount:this.getExpectedPrice(e),expectedCurency:Odigeo.Utils.Currency.currencyCode,invoiceRequestDTO:t.invoiceRequestDTO,addBuyerInformationRequestDTO:l?this.buildBuyerRequestDTO(t.bookingId,l):{},newsletterSubscription:Odigeo.Storage.get("changeNewsletterSubscriptionToken")?Odigeo.Storage.get("changeNewsletterSubscriptionToken")+"_true":"U_false",paymentDetails:{method:a}},t.chosenMethod===o&&(s=t.chosenCard.method.split("|"),_.includes(s,o)&&(i=t.creditCardData,r=this.widget.options.isHideCards&&c?c:{},d?n.creditCardDetails={name:this.getCreditCardType(),typeCode:this.getCreditCardTypeCode(),owner:i.nameoncard?i.nameoncard:i.owner,number:i.ccnumber.replace(/\s|\/|-/g,""),securityNumber:i.cvv2,expirationMonth:i.cardExpirationMonth?i.cardExpirationMonth:i.expirationDateMonth,expirationYear:i.cardExpirationYear?i.cardExpirationYear:i.expirationDateYearFormated,storeCreditCardId:r.id}:n.paymentDetails.creditCardDetails={name:this.getCreditCardType(),typeCode:this.getCreditCardTypeCode(),owner:i.nameoncard?i.nameoncard:i.owner,number:i.ccnumber.replace(/\s|\/|-/g,""),securityNumber:i.cvv2,expirationMonth:i.cardExpirationMonth?i.cardExpirationMonth:i.expirationDateMonth,expirationYear:i.cardExpirationYear?i.cardExpirationYear:i.expirationDateYearFormated,storeCreditCardId:r.id})),n):null},getCommitTrackingSuffixLabel:function(e,t,i){var n,a={CREDITCARD:"CC",BANKTRANSFER:"BT",PAYPAL:"PP",SOFORT:"SF"}[e],s="";return"userAccount"===t?s=this.widget.view.$cachedSelectors.cardSaverManager.hasClass("odf-hidden")?"_saved_used":"_standard_stored":"localStorage"===t&&e===o&&(s=(n=Odigeo.Utils.parseJson(Odigeo.Storage.get("paymentData")))&&n.paymentMethod&&n.paymentMethod.ccnumber===i?"_saved_local_used":"_standard_stored_local"),a+=s,this.widget.view.$cachedSelectors.cardSaverManager.hasClass("odf-hidden")||this.widget.view.$cachedSelectors.saveCardData.is(":checked")||""===s||(a+="_not"),a},commit:function(e){var t=e.simulate||!1,i=e.showErrorsResume||!1,n=e.displayErrors||!1,a=Odigeo.Utils.parseJson(Odigeo.Session.get("isAccommodationPostBooking")),s=this.getRequest(e),c=this;if(s){if(this.getPaymentMethod()===o&&this.saveUserData(),!t){var d,l;a?Odigeo.UIElements.enhanceLoading($(".waiting_page")).showLoading(["waiting_post_booking_accommodation_confirmation"]):this.widget.options.isDynpack||Odigeo.UIElements.enhanceLoading($(".waiting_page")).showLoading(["waiting_confirmation"]),Odigeo.Storage.set("fromContinueButton",!0),Odigeo.trigger(this.widget.id+":confirmationLoading"),Odigeo.Router.navigate("confirmation",{isSecured:!0,replace:!0}),r.startMetric("LOAD_CONFIRM_SHOPPINGBASKET"),_.delay(function(){c.save({},{attrs:s,url:Odigeo.Utils.parseJson(Odigeo.Session.get("isAccommodationPostBooking"))?c.confirmShoppingBasketUrl:c.confirmPaymentUrl})},750),l=a?(d=s.creditCardDetails,s.paymentMethod):(d=s.paymentDetails.creditCardDetails,s.paymentDetails.method);var g=d?d.number:null;this.widget.view._trackEvent("payment_details","payment_method_selected_"+this.getCommitTrackingSuffixLabel(l,this.get("defaultDataStorage"),g))}}else this.widget.view.showErrors({errors:this.validationError,opts:{all:!0},showErrorsResume:i,displayErrors:n,fullValidation:!0})},getCreditCardType:function(){return this.get("chosenCard").name},getCreditCardTypeCode:function(){return this.get("chosenCard").code},saveUserData:function(){"userAccount"===this.get("defaultDataStorage")?this.widget.model.saveCard():this.widget.view.storePaymentLocally(!0)}})))},function(e,t,i){"use strict";var n,a,s,r,o,c;e.exports=(n=i(494),a=i(559),s=i(323),r=i(0),o=i(7),c=i(547),{hasShowDecimals:!0,storeData:i(331),fields:i(51),templateSettings:{evaluate:/\{\{#([\s\S]+?)\}\}/g,interpolate:/\{\{[^#{]([\s\S]+?)[^}]\}\}/g,escape:/\{\{\{([\s\S]+?)\}\}\}/g,variable:"tmpl"},paymentTemplateMap:{BANKTRANSFER:"withoutTemplate",CREDITCARD:"withoutTemplate",PAYPAL:"withoutTemplate",SOFORT:"withoutTemplate"},events:{"tap .template_others_container .info_hint":"onTapOtherContainerInfoHint",'change .template_others_container input[type="radio"]':"onTapOtherContainerRadio"},selectors:_.extend(n.selectors,a.selectors,{root:".paymentmanager_root",methodSelector:'[name="paymentType"]',cardSaverManager:".card_saver_manager",ccCardTypeShowed:'select[data-name="cardTypeSelector"]',acceptedCards:"#acceptedCards",acceptedBrandCards:"#acceptedBrandCards",ccTypeIcon:".cc_type_icon",methodIcon:".method-icon",paymentFailureMessage:".od-paymentmanager-failure",paymentForms:".payment_form",cardForms:".card_form",cardInputs:'input[name="nameoncard"], input[name="ccnumber"], select[data-name="cardExpirationYear"], select[data-name="cardExpirationMonth"], select[data-name="cardTypeSelector"], input[name="cvv2"]',cardRows:".card_form .paymentmanager_row",inputWithClearOption:".clear_input input",datepickers:".card_form .paymentmanager_datepicker",acceptedCardsTemplate:".accepted-cards-template",acceptedBrandCardsTemplate:".accepted-brand-cards-template",ccCcvHint:".cc_ccv_hint",paymentmanager_tooltip:".paymentmanager_tooltip",clearInput:".clear_input",ccnumber:'[data-name="ccnumber"]',nameoncard:"[data-name=nameoncard]",cardExpirationMonth:'[data-name="cardExpirationMonth"]',cardExpirationYear:'[data-name="cardExpirationYear"]',cvv2:'[data-name="cvv2"]',ccNotDetected:".cc_not_detected",saveCardData:"#saveCardData",cvvFieldContainer:".cvv_field_container",cvvHelpContainer:".cvv_help_container",cvvCloseDialog:".close_cvv_help",templateOthersContainer:".template_others_container",templateOthersScript:".template_others_script",confirmationMessageContainer:".pba_confirmation_container_message",confirmationMessageEmail:".pba_confirmation_email"}),tmplSettings:{evaluate:/\{\{#([\s\S]+?)\}\}/g,interpolate:/\{\{([^#][\s\S]+?)\}\}/g},inputLabelCorrespondences:{creditCardHolder:"cccard_owner",nameoncard:"cccard_owner",creditCardNumber:"cccard_number",ccnumber:"cccard_number",creditCardExpiration:"cccard_expiration",expiration_date:"cccard_expiration",creditCardCVV:"cccard_cvv",cvv2:"cccard_cvv",cardType:"cccard_notselected"},init:function(){this.model.set("bookingId",this.$cachedSelectors.root.data("bookingId")),this.hasShowDecimals=!!this.widget.options.hasShowDecimals,this.paymentTemplates={templateOthers:_.template(this.$cachedSelectors.templateOthersScript.html(),this.templateSettings)},this.$cachedSelectors.acceptedCardsTemplate.length&&(this.acceptedCardsTemplate=_.template(this.$cachedSelectors.acceptedCardsTemplate.html(),this.tmplSettings)),this.$cachedSelectors.acceptedBrandCardsTemplate.length&&(this.acceptedBrandCardsTemplate=_.template(this.$cachedSelectors.acceptedBrandCardsTemplate.html(),this.tmplSettings)),n.view.initView.call(this),a.view.initView.call(this),Odigeo.UIElements.collapsive.enhance(this.$cachedSelectors.creditCardForm,{initiallyExpanded:!0}),this.$cachedSelectors.methodSelector.on("change",_.bind(function(e){var t=$(e.target);t.is('input[type="radio"]')&&!t.is(":checked")||this.model.changePaymentMethod(e.target.value)},this)),this.$cachedSelectors.paymentForms.on(Odigeo.Events.blur,'input[name]:not([name="paymentType"]), select[name], select[data-name]',_.bind(this.cardChangeHandler,this)).on(Odigeo.Events.change,"select[name], select[data-name]",_.bind(this.cardChangeHandler,this)).on(Odigeo.Events.focus,"input[name], select[name], select[data-name]",_.bind(function(e){var t=$(e.target),i=t.closest(".paymentmanager_row");t.closest(".validation_field").attr("data-state","init"),-1<_.indexOf(["text","tel"],t.attr("type"))&&this.fields.showHidePlaceholder(t,!0),i.addClass("focused"),"cvv2"===t.attr("name")&&(i.removeClass("od-cvv-closed"),this.widget.options.bigCvv&&this.toggleCvvHelp(!0),this._setCvvState(e,i,i.data("state")))},this)),this.widget.options.bigCvv&&this.$cachedSelectors.cvv2.on(Odigeo.Events.blur,_.bind(this.onBlurCvv,this)),this.$cachedSelectors.methodSelector.toggleClass("is-iOS",Odigeo.Device.navigator.isIOS),this.$cachedSelectors.datepickers.on("focus",function(e){$(e.target).parent().removeClass("placeholder")}).on("change",_.bind(function(e){var t=$(e.target);t.parent().toggleClass("placeholder",_.isEmpty(t.val())),Odigeo.trigger(this.widget.id+":expirationDateChange",t)},this)),_.each(this.$cachedSelectors.cardForms,function(e){var t=$(e).data("card").split("|");_.each($("[name]",e),function(e){var i=$(e).data("pattern");i&&this.model.setRegExp(t,e.name,i)},this)},this),this.$cachedSelectors.ccTypeIcon.attr("data-card",""),this.$cachedSelectors.inputWithClearOption.on(Odigeo.Events.blur,_.bind(this.onToggleFocused,this,!1)),this.$cachedSelectors.cvv2.on(Odigeo.Events.input,_.bind(this.onCvvChange,this)),this.$cachedSelectors.clearInput.on(Odigeo.Events.tap,_.partial(this.fields.clearField,_)),!_.isEmpty(this.$cachedSelectors.ccCcvHint)&&Odigeo.UIElements.hint&&Odigeo.UIElements.hint.enhance(Odigeo.History.getPageNameFromFragment(),this.$cachedSelectors.ccCcvHint,{events:{tap:!0}}),this._setInputsPattern(),Odigeo.Utils.parseJson(Odigeo.Session.get("isAccommodationPostBooking"))&&this.showConfirmationEmailMessage()},_setInputsPattern:function(){s.initInputPattern(this.$cachedSelectors.nameoncard),s.initInputPattern(this.$cachedSelectors.ccnumber),s.initInputPattern(this.$cachedSelectors.cvv2)},toggleSaveDataCheck:function(e){this.$cachedSelectors.cardSaverManager.toggleClass("odf-hidden",e)},onToggleFocused:function(e,t){var i=$(t.target),n=i.closest(".paymentmanager_row");n.toggleClass("focused",e),"cvv2"===i.attr("name")&&(n.removeClass("od-cvv-closed"),this._setCvvState(t,n,n.data("state"),!1))},_setCvvState:function(e,t,i,n){var a=this.model.getCvvLength(this.model.attributes.chosenCard.code);e.target.value.length===a&&n?e.target.blur():i="validating",t.attr("data-state",i)},toggleCvvHelp:function(e){this.$cachedSelectors.cvvHelpContainer.toggleClass("odf-hidden",!e),this.$cachedSelectors.cvvFieldContainer.toggleClass("od-cvv-container-form",e)},onBlurCvv:function(){this.toggleCvvHelp(!1)},onCvvChange:function(e){this._setCvvState(e,$(e.target).closest(".paymentmanager_row"),"valid",!0)},cardDataChanged:function(e,t,i){var n={};n[e]=Odigeo.Utils.trim(t.val()),Odigeo.Utils.apply(t),this.trigger("change:cardData",i,n)},creditCardExpirationChanged:function(e,t,i,n){var a=this.widget.enhancedElementsList.ccExpiration.checkInputValues();("valid"===n||"-1"!==a.year&&"-1"!==a.month)&&this.cardDataChanged(t,e,i)},cardChangeHandler:function(e){var t=$(e.target),i=t.attr("data-name"),n=t.closest(".card_form").data("card"),a=t.closest(".validation_field"),s=Odigeo.Utils.trim(t.val());a.removeClass("focused"),"cardType"===i?(s&&a.attr("data-state","valid"),this.trigger("change:cardType",s)):"creditCardExpiration"!==i||_.isUndefined(this.widget.enhancedElementsList.ccExpiration)?(this.cardDataChanged(i,t,n),this.trackError(-1<_.indexOf(["cardExpirationMonth","cardExpirationYear"],i)?"expiration_date":i,a.attr("data-state"),"inline"),this.fields.showHidePlaceholder(t,!1)):this.creditCardExpirationChanged(t,i,n,a.attr("data-state"))},enhancedElementsList:function(e){this.widget.enhancedElementsList[e.uielement]=e.element},trackFormErrorEvents:function(e){_.each(e,function(e,t){this.trackError(t,e,"submit")},this)},trackError:function(e,t,i){"invalid"!==t&&"empty"!==t||"post-booking-payment"===this.widget.id||this._trackEvent("payment_details_error",this.inputLabelCorrespondences[e]+("inline"===i?"_inline":"_submit")+("empty"===t?"_missing_error":"_invalid_error"))},updatePaymentOptions:function(e){var t,i,n=e.get("paymentMethods"),a=e.get("chosenMethod");this.$cachedSelectors.templateOthersContainer.empty(),_.each(n,function(e){t=e.method?e.method.toUpperCase():"",(i=this.paymentTemplateMap[t])&&"others"!==i||(Odigeo.AB.isKlarnaSkeleton?"KLARNA"!==t&&this.$cachedSelectors.templateOthersContainer.append(this.paymentTemplates.templateOthers({methodUpperCase:t,methodLowerCase:t.toLowerCase(),description:e.description?e.description:{}})):this.$cachedSelectors.templateOthersContainer.append(this.paymentTemplates.templateOthers({methodUpperCase:t,methodLowerCase:t.toLowerCase(),description:e.description?e.description:{}})))},this);var s=this.$cachedSelectors.root.find(".payment_form");_.each(s,_.flowRight(function(e){var t=e.data("method"),i=_.find(n,{method:t}),a=_.isObject(i);e.toggleClass("enabled",a),a&&e.find(".paymentmanager_method_fee").html((0<i.fee?"+":"")+Odigeo.Utils.formatCurrency(i.fee))},$)),s.filter('[data-method="'+a+'"]').find('input[name="paymentType"]').prop("checked",!0).trigger("change",!0);var o=_.find(n,{method:"CREDITCARD"});if(!_.isUndefined(o)){var c=this.$cachedSelectors,d=e.get("chosenCard");if(this.model.defaultCreditCard=d||o.info.cardTypes[0],Odigeo.trigger(this.widget.id+":paymentOptionsUpdated",{cards:o.info.cardTypes,defaultCc:this.model.defaultCreditCard,chosenMethod:a}),this.model.set("chosenCard",this.model.defaultCreditCard),c.acceptedCards.length&&c.acceptedCardsTemplate.length){var l=_.chain(o.info.cardTypes).uniq(_.property("code")),g=this.removeDuplicateCards(l);c.acceptedCards.html(g)}if(c.acceptedBrandCards.length&&c.acceptedBrandCardsTemplate.length){var h=[{brand:"VISA",cards:["VE","VD","VI","HS","VV","VB"]},{brand:"AMEX",cards:["AX","DL"]},{brand:"MASTERCARD",cards:["CA","MP","MD","E1","MA","EY","EA"]},{brand:"JCB",cards:["JC"]},{brand:"DINERS",cards:["DC"]},{brand:"DISCOVER",cards:["DS"]},{brand:"SOLO",cards:["PP"]},{brand:"CB",cards:["CB"]}],u=_.chain(o.info.cardTypes).uniq(_.property("code")).map(function(e){return _.find(h,function(t){return _.contains(t.cards,e.code)})}).value(),p=_.uniq(u).map(this.acceptedBrandCardsTemplate);c.acceptedBrandCards.html(p)}}Odigeo.trigger(this.widget.id+":ready"),r.stopMetric("LOAD_PAYMENT_OPTIONS")},removeDuplicateCards:function(e){var t=e.map(function(e){return e.code}).value();return e.filter(function(e){return!("MF"===e.code&&_.includes(t,"MF")&&_.includes(t,"MD"))}).filter(function(e){return!("EY"===e.code&&_.includes(t,"EY")&&_.includes(t,"EA"))}).filter(function(e){return"EC"!==e.code}).filter(function(e){return!("AB"===e.code&&_.includes(t,"AB")&&_.includes(t,"AX"))}).map(this.acceptedCardsTemplate).value()},updatePaymentMethod:function(e){var t=e.get("chosenMethod"),i=this.$cachedSelectors.root.find(".payment_form");this.$cachedSelectors.methodIcon.toggle("PAYPAL"===t),this.$cachedSelectors.methodSelector.toggleClass("paymentType","PAYPAL"===t),i.removeClass("active").filter('[data-method="'+t+'"]').addClass("active"),this.$cachedSelectors.root.attr("data-state",e.isValid()?"valid":"invalid"),this.$cachedSelectors.root.toggleClass("od-stored-cards-visible","CREDITCARD"===t&&_.isObject(this.model.get("user"))),Odigeo.trigger(this.widget.id+":paymentMethodChanged",t)},updateCreditCard:function(e){var t,i=e.get("chosenCard"),n=e.get("chosenMethod");t=_.isUndefined(i)?"":i.method;for(var a=this.$cachedSelectors.paymentForms,s=0,r=a.length;s<r;s++){var o=$(a[s]);o.toggleClass("active",o.data("method")===n)}if(t)for(var c=this.$cachedSelectors.cardForms,d=0,l=c.length;d<l;d++){var g=$(c[d]),h=g.data("card").split("|");g.toggleClass("active",0<=h.indexOf(t))}if("CREDITCARD"===t){var u=e.get("creditCardData"),p=[];_.each(["ccnumber","cvv2","nameoncard","cardExpirationMonth","cardExpirationYear","cardTypeSelector"],function(e){u[e]&&p.push(e)}),this.model.isValid(),this.showErrors({changes:p,errors:this.model.validationError,fullValidation:!1})}},showNegativeFee:function(){this.$cachedSelectors.paymentFailureMessage.toggleClass("is-iOS",Odigeo.Device.navigator.isIOS).removeClass("hidden")},showErrors:function(e){var t,i,n,a=e.changes||[],s=e.errors||{},r=e.opts||this.widget.options.errorHandling||{},o=e.showErrorsResume||!1,c={},d=e.fullValidation||!1;if(t=this.$cachedSelectors.cardInputs.filter(function(e,t){return _.includes(a,$(t).attr("data-name"))}),i=this.$cachedSelectors.cardInputs.index(t.last()),n=r.all?this.$cachedSelectors.cardInputs:r.previous?_.take(this.$cachedSelectors.cardInputs,i+1):t,t.last().removeAttr("data-init"),null!==s&&s.hasOwnProperty("creditCardExpiration")&&!o&&(this.$cachedSelectors.cardExpirationYear.attr("data-init")||this.$cachedSelectors.cardExpirationMonth.attr("data-init")||!d&&this.isExpirationCreditCardNotInitialized())&&(!r.previous||i<=this.$cachedSelectors.cardInputs.index(this.$cachedSelectors.cardExpirationYear))&&(s=_.omit(s,"creditCardExpiration"),t=t.not(this.$cachedSelectors.cardExpirationYear).not(this.$cachedSelectors.cardExpirationMonth)),this.$cachedSelectors.ccNotDetected.hasClass("odf-hidden")||""!==this.$cachedSelectors.ccCardTypeShowed.val()||(c.cardTypeSelector="empty",s.cardTypeSelector="empty"),_.each(n,function(e){var t=$(e),i=this.getEquivalenceErrorName(t),n=t.closest(".validation_field");null!==s&&s.hasOwnProperty(i)?(n.attr("data-state",s[i]),this.fields.showError(n,!1),c[i]=s[i]):"valid"!==n.attr("data-state")&&n.attr("data-state","")},this),_.isObject(s)&&s.hasOwnProperty("cvv2")&&d&&this.validateStoredCreditCardCvv(),!this.$cachedSelectors.cardExpirationYear.attr("data-init")||!this.$cachedSelectors.cardExpirationMonth.attr("data-init")){var l=this.$el.find(".field_month"),g=this.$el.find(".field_year"),h=s.creditCardExpiration?s.creditCardExpiration:"valid";l.attr("data-state",h),g.attr("data-state",h),this.fields.showError(l,!1)}t.length&&_.each(t,function(e){var t=$(e),i=this.getEquivalenceErrorName(t),n=null===s||!s.hasOwnProperty(i);t.closest(".validation_field").attr("data-state",n?"valid":s[i])},this),this.$cachedSelectors.root.attr("data-state",_.isEmpty(s)?"valid":"invalid"),this.$cachedSelectors.paymentmanager_tooltip.toggleClass("hidden",_.isEmpty(c)),o&&0<_.keys(c).length&&(this.trackFormErrorEvents(c),Odigeo.trigger(this.widget.id+":showErrorsResume",c))},getEquivalenceErrorName:function(e){var t=e.attr("data-name");return{cardExpirationYear:"creditCardExpiration",cardExpirationMonth:"creditCardExpiration"}[t]||t},isExpirationCreditCardNotInitialized:function(){return!this.$cachedSelectors.cardExpirationYear.val()||!this.$cachedSelectors.cardExpirationMonth.val()},showDialog:function(e,t,i){var n=Odigeo.UIElements.createDialog("<b>"+e+"</b>",'<div class="od-ui-dialog-confirmation">'+t+"</div>",i);return Odigeo.UIElements.showDialog(n),n},showErrorPaymentRetryDialog:function(e){this.widget.isPaymentMethodRetry=!0;var t,i,n,a,s=this.widget.options,o=s.error_retry_description,c=!_.isUndefined(e)&&!_.isUndefined(e.flowErrors)&&!_.isEmpty(e.flowErrors),d={UNAVAILABLE_ONLINE_COLLECTION_METHOD:{fn:function(e){return s.hasNegativeOrZeroPayment&&(o=s.error_retry_negative_payment_collection),e.showDialog(s.error_retry_title,o,i)}},FORBIDDEN_ATTEMPT_NEGATIVE_COLLECTION:{fn:function(e){_.templateSettings={evaluate:/\{\{#(.+?)\}\}/g,interpolate:/\{\{([^#].*?)\}\}/g};var t=_.template(e.$widget.find(".forbidden_attempt_negative_collection").html()),a=Odigeo.Utils.createDateFromString(n.messages.NEXT_AVAILABLE_DATE),r={type:"description",next_available_date:Odigeo.Utils.formatDate(n.messages.NEXT_AVAILABLE_DATE,e.widget.options.velocityMessagesDateFormat),credit_card_type_name:n.messages.CREDIT_CARD_TYPE_NAME,days_to_date:Odigeo.Utils.getRemainingDays(a.getTime()),credit_card_number:n.messages.CREDIT_CARD_NUMBER};return e.showDialog(s.error_retry_title,t(r),i)}},CART_TYPE_NOT_MATCH:{fn:function(t){var i=e.myTrip.paymentRetryInfo;_.isNull(i.newCreditCard)||_.isNull(i.paymentDetails.creditCardDetails)||(Odigeo.Router.navigate("payment",{isSecured:!0,replace:!0}),t.widget.execute("fillForm",i.paymentDetails.creditCardDetails),t.showPaymentRetryPopUp("sm",i))}},COLLECTION_WRONG_CVV2:{text:"error_retry_wrongcvv_description"},COLLECTION_CARD_EXPIRED:{text:"error_retry_cardexp_description"},COLLECTION_INVALID_CARD_NUMBER:{text:"error_retry_invcardnum_description"},COLLECTION_DECLINED:{text:"error_retry_colldeclined_description"},COLLECTION_BUYERS_FUNDING_SOURCE_FAILED:{text:"buyersFundingSourceFailed"},FRAUD_NON_CHARGEABLE_ATTEMPT:{text:"error_retry_fraudnoncharg_description"},ITINERARY_PROVIDER_2:{text:"error_retry_itineraryprov_description"},COLLECTION_FRAUD_SUSPECT:{text:"error_retry_fraudsuspect_description"},COLLECTION_UNSUPPORTED_GATEWAY_COLLECTION_METHOD:{text:"error_retry_forbgate_description"},COLLECTION_INSUFFICIENT_CREDIT:{text:"error_retry_insuficientcredit_description"},COLLECTION_WRONG_CREDITCARD_EXPIRATION_DATE:{text:"error_retry_wrongexpirationdate_description"},COLLECTION_WRONG_ELV_ACCOUNT:{text:"error_retry_wrongelv_description"},COLLECTION_ORDER_NOT_AUTHORIZE:{text:"error_retry_ordernotauthorize_description"},COLLECTION_CARD_NOT_IN_AUTHORIZERS_DB:{text:"error_retry_cardnotinauthorizersdb_description"},COLLECTION_ACQUIRER_UNAVAILABLE:{text:"error_retry_acquirerunavailable_description"},COLLECTION_DATA_VALIDATION_ERROR:{text:"error_retry_datavalidation_description"},COLLECTION_INVALID_AMOUNT:{text:"error_retry_invalidamount_description"},COLLECTION_INVALID_CURRENCY:{text:"error_retry_invalidcurrency_description"},COLLECTION_AMOUNT_HIGHER_THAN_ALLOWED:{text:"error_retry_amounthigher_description"},BOOKING_PAYMENT_RETRY:{text:"error_retry_paymentretry_description"},COLLECTION_UNKNOWN:{text:"error_retry_collectionunknown_description"},COLLECTION_UNKNOWN_ORDER:{text:"error_retry_unknownorder_description"},COLLECTION_UNKNOWN_ORIGIN_IP:{text:"error_retry_unknownorigin_description"},COLLECTION_ORDER_ALREADY_USED:{text:"error_retry_orderalreadyused_description"},COLLECTION_TRANSACTION_NO_EXIST:{text:"error_retry_transactionnoexists_description"},BOOKING_STOP:{text:"error_retry_bookingstop_description"}};i=[{text:s.error_retry_retry,style:"od-ui-dialog-button-default",handler:_.bind(function(){Odigeo.UIElements.hideDialog(t),Odigeo.requireWidget("payment-manager","paymentmanager",function(e){e.execute("paymentRetry")}),Odigeo.Router.navigate("payment",{isSecured:!0,replace:!0}),this._trackVirtualPage("payment",!0)},this)}],c&&((n=_.first(_.values(e.flowErrors))||{}).errorMessageKey&&r.trackEventWithCategory("flights_pay_page","payment_details_error",n.errorMessageKey),a=d[n.errorMessageKey]||{},t=a.fn?a.fn(this):a.text?this.showDialog(s.error_retry_title,s[a.text],i):this.showDialog(s.error_retry_title,o,i))},showErrorPaymentRetryInline:function(e){this.widget.isPaymentMethodRetry=!0;var t,i,n=!_.isUndefined(e)&&!_.isUndefined(e.flowErrors)&&!_.isEmpty(e.flowErrors);if(this.$widget.find(".od-payment-credit-card-mismatch").toggleClass("odf-hidden",!0),this.$widget.find(".od-payment-validate-title").toggleClass("odf-hidden",!1),n){if(t=_.first(_.values(e.flowErrors)),Odigeo.trigger(this.widget.id+":manageError",t.errorMessageKey),t.errorMessageKey)switch(r.trackEventWithCategory("flights_pay_page","payment_details_error",t.errorMessageKey),t.errorMessageKey){case"FORBIDDEN_ATTEMPT_NEGATIVE_COLLECTION":var a;_.templateSettings={evaluate:/\{\{#(.+?)\}\}/g,interpolate:/\{\{([^#].*?)\}\}/g};var s=_.template(this.$widget.find(".forbidden_attempt_negative_collection").html()),o=Odigeo.Utils.createDateFromString(t.messages.NEXT_AVAILABLE_DATE);a=s({type:"description",next_available_date:Odigeo.Utils.formatDate(t.messages.NEXT_AVAILABLE_DATE,this.widget.options.velocityMessagesDateFormat),credit_card_type_name:t.messages.CREDIT_CARD_TYPE_NAME,days_to_date:Odigeo.Utils.getRemainingDays(o.getTime()),credit_card_number:t.messages.CREDIT_CARD_NUMBER}),$('.paymentmanager_error_message[data-error-type="negative"]').html(a);break;case"CART_TYPE_NOT_MATCH":this.showPaymentRetryPopUp("dt",e.myTrip.paymentRetryInfo),this.$cachedSelectors.paymentFailureMessage.addClass("hidden")}i={UNAVAILABLE_ONLINE_COLLECTION_METHOD:{type:"unavaicoll"},FORBIDDEN_ATTEMPT_NEGATIVE_COLLECTION:{type:"negative"},CART_TYPE_NOT_MATCH:{type:""},COLLECTION_WRONG_CVV2:{type:"wrongcvv"},COLLECTION_CARD_EXPIRED:{type:"cardexp"},COLLECTION_INVALID_CARD_NUMBER:{type:"invcardnum"},COLLECTION_DECLINED:{type:"colldeclined"},FRAUD_NON_CHARGEABLE_ATTEMPT:{type:"fraudnoncharg"},ITINERARY_PROVIDER_2:{type:"itineraryprov"},COLLECTION_FRAUD_SUSPECT:{type:"fraudsuspect"},COLLECTION_BUYERS_FUNDING_SOURCE_FAILED:{type:"buyersFundingSourceFailed"},COLLECTION_UNSUPPORTED_GATEWAY_COLLECTION_METHOD:{type:"forbgate"},COLLECTION_INSUFFICIENT_CREDIT:{type:"insufficientCredit"},COLLECTION_WRONG_CREDITCARD_EXPIRATION_DATE:{type:"wrongCcExpDate"},COLLECTION_WRONG_ELV_ACCOUNT:{type:"wrongElvAccount"},COLLECTION_ORDER_NOT_AUTHORIZE:{type:"orderNotAuth"},COLLECTION_CARD_NOT_IN_AUTHORIZERS_DB:{type:"cardNotInAuthDb"},COLLECTION_ACQUIRER_UNAVAILABLE:{type:"acquirerUnavailable"},COLLECTION_DATA_VALIDATION_ERROR:{type:"dataValidationError"},COLLECTION_INVALID_AMOUNT:{type:"invalidAmount"},COLLECTION_INVALID_CURRENCY:{type:"invalidCurrency"},COLLECTION_AMOUNT_HIGHER_THAN_ALLOWED:{type:"amountHigherThanAllowed"},BOOKING_PAYMENT_RETRY:{type:"bookingPaymentRetry"},COLLECTION_UNKNOWN:{type:"collectionUnknown"},COLLECTION_UNKNOWN_ORDER:{type:"unknownOrder"},COLLECTION_UNKNOWN_ORIGIN_IP:{type:"unknownOriginIp"},COLLECTION_ORDER_ALREADY_USED:{type:"orderAlreadyUsed"},COLLECTION_TRANSACTION_NO_EXIST:{type:"transactionNoExist"},BOOKING_STOP:{type:"bookingStop"}}[t.errorMessageKey]||{},this.isNotCollectionRetryError(t.errorMessageKey)&&(this.widget.error=i.type?i:{type:"retry"})}else this.widget.error={type:"retry"}},showPaymentRetryPopUp:function(e,t){var i,n,a,s,r,o,c,d,l,g=this,h=g.$cachedSelectors.ccCardTypeShowed;_.templateSettings={evaluate:/\{\{#(.+?)\}\}/g,interpolate:/\{\{([^#].*?)\}\}/g},l=_.template(g.$widget.find(".retry_card_not_match_template").html()),"sm"===e?c=[{text:Odigeo.UIElements.translations.ubulayer.btn_check_ccinfo,style:"od-ui-dialog-button-cancel",handler:function(){h.val(t.newCreditCard.code).trigger(Odigeo.Events.change),g.$widget.find(".od-payment-credit-card-message").text(l({type:"msg",credit_card_found:t.newCreditCard.name})),g.$widget.find(".od-payment-credit-card-mismatch").toggleClass("hidden",!1),g.$widget.find(".od-payment-validate-title").toggleClass("hidden",!0),Odigeo.UIElements.hideDialog(i)}},{text:Odigeo.UIElements.translations.ubulayer.btn_book_now,style:"od-ui-dialog-button-default",handler:_.bind(function(){h.val(t.newCreditCard.code).trigger(Odigeo.Events.change),this.model.commit.apply(this.model,{showErrorsResume:!0}),Odigeo.UIElements.hideDialog(i),this._trackVirtualPage("payment",!0)},this)}]:(c=[{text:Odigeo.UIElements.translations.ubulayer.btn_book_now,style:"od-ui-dialog-button-default",handler:_.bind(function(){h.val(t.newCreditCard.code).trigger(Odigeo.Events.change),this.widget.execute("fillForm",t.paymentDetails.creditCardDetails),Odigeo.UIElements.hideDialog(i),this.model.commit.apply(this.model,{showErrorsResume:!0}),this._trackVirtualPage("payment",!0)},this)},{text:Odigeo.UIElements.translations.ubulayer.btn_check_ccinfo,style:"od-ui-dialog-button-cancel",handler:function(){h.val(t.newCreditCard.code).trigger(Odigeo.Events.change),g.$widget.find(".od-payment-credit-card-message").text(l({type:"msg",credit_card_found:t.newCreditCard.name})),g.$widget.find(".od-payment-credit-card-mismatch").toggleClass("hidden",!1),g.$widget.find(".od-payment-validate-title").toggleClass("hidden",!0),g.widget.execute("fillForm",t.paymentDetails.creditCardDetails),Odigeo.trigger(g.widget.id+":resetAddingInsurance"),Odigeo.UIElements.hideDialog(i)}}],o={type:"finalPrice",total_price:Odigeo.Utils.formatCurrency(parseFloat(t.totalPrice))}),a=_.template(g.$widget.find(".retry_card_not_match_template").html()),n=_.template(g.$widget.find(".retry_card_not_match_template").html()),s=_.template(g.$widget.find(".retry_card_not_match_template").html()),d=0<=t.differencePrice?"price_higher":"price_lower",r={type:"description",credit_card_found:t.newCreditCard.name||"",credit_card_selected:t.oldCreditCard.name||"",price_difference:s({type:d,price:Odigeo.Utils.formatCurrency(parseFloat(t.differencePrice))}),total_price:Odigeo.Utils.formatCurrency(parseFloat(t.totalPrice))},i=Odigeo.UIElements.createDialog("<b>"+Odigeo.UIElements.translations.ubulayer.title+"</b>",'<div class="od-ui-dialog-confirmation">'+a(r)+"</div>"+(_.isEmpty(o)?"":n(o)),c,"dialog-card-type-not-match",!1,"info"),Odigeo.UIElements.showDialog(i),$(".dialog-card-type-not-match").find(".ubu_layer_more_details").one("click",function(){$(".dialog-card-type-not-match").find(".final-price").removeClass("hidden"),$(this).addClass("hidden")})},hideDialogs:function(){_.isUndefined(this.$cachedSelectors.ccCcvHint)||this.$cachedSelectors.ccCcvHint.trigger("hideTooltip")},fillForm:function(e){var t=this.$cachedSelectors.root,i=parseInt(e.expirationMonth,10),n=i<10?"0"+i:i,a=t.find("input[name=agree]");t.find("#payment-method-creditcard").prop("checked",!0),t.find("#payment-method-creditcard").trigger("change"),t.find('input[data-name="nameoncard"]').val(e.owner),t.find('input[data-name="ccnumber"]').val(e.number).trigger(Odigeo.Events.input).trigger(Odigeo.Events.keydown),t.find('input[data-name="creditCardExpiration"]').val("20"+e.expirationYear+"-"+n),t.find('input[data-name="cvv2"]').val(e.securityNumber),a&&a.prop("checked",!0)},loadRepricingMessage:function(e){this.widget.isRepricing=!0;var t=e.data.newPrice-e.data.oldPrice;t=Number(t).toFixed(2);var i="",n=Math.abs(+(100-e.data.newPrice/e.data.oldPrice*100).toFixed(0));i=(i=0<t?e.textPositive:(i=e.textNegative).replace("_price_ratio_",n)).replace("_price_",t),this.widget.error={type:"repricing",description:i},r.trackEvent("back_end_errors","repricing_appearances_"+this.getRepricingTrackingLabel(e.data.oldPrice,e.data.newPrice))},loadRepricingMessagePopUp:function(e){this.widget.isRepricing=!0,r.trackEvent("back_end_errors","repricing_appearances_"+this.getRepricingTrackingLabel(e.data.oldPrice,e.data.newPrice))},getRepricingTrackingLabel:function(e,t){return"iprice:"+e+"_fprice:"+t+"_pax:"+c.getNumberOfPassengers()},setManualPaymentRetry:function(e){this.widget.isPaymentMethodRetry=e},storePaymentLocally:function(e){this.widget.options.isStorePaymentStorageData&&this.storeData.save(!1,"paymentData",this.$cachedSelectors.cardInputs,"paymentMethod",{})},restoreFieldsLocalStorage:function(){this.widget.options.isStorePaymentStorageData&&this.storeData.restore("paymentData",this.$cachedSelectors.cardInputs,"paymentMethod",{})},cleanInputs:function(e){_.each(this.$cachedSelectors.cardForms.parent().find(".active").find('input[type="text"][name], input[type="tel"][name], select[name], select[data-name]'),_.bind(function(t){var i=$(t);e&&i.val([]),(_.isEmpty(i.val())||"-1"===i.val())&&i.closest(".validation_field").attr("data-state","")},this))},blurAllInputs:function(){this.$cachedSelectors.cardInputs.filter(":visible").blur()},cvvTypeChanged:function(e){this.$cachedSelectors.cvvHelpContainer.attr("data-cvv",e?"cvv4":"cvv3"),this.$cachedSelectors.cvv2.attr("data-cvv",e?"cvv4":"cvv3")},_trackEvent:function(e,t){r.trackEventWithCategory("flights_pay_page",e,t)},_trackVirtualPage:function(e,t){r.trackPage(e,{funnel:t}),o.updateDatalayer()},onTapOtherContainerInfoHint:function(e){e.preventDefault(),window.open(e.target.getAttribute("data-url"),"_blank","scrollbars=1,resizable=1,height=300,width=450")},onTapOtherContainerRadio:function(e){this.changePaymentMethod(e.target.value)},changePaymentMethod:function(e){this.$cachedSelectors.templateOthersContainer.find('[data-method="'+e+'"]').addClass("active"),this.model.changePaymentMethod(e)},isNotCollectionRetryError:function(e){return!_.startsWith(e,"COLLECTION_")},showConfirmationEmailMessage:function(){var e=Odigeo.Utils.parseJson(Odigeo.Session.storage.bookingInfo).buyer.mail;this.$cachedSelectors.confirmationMessageContainer.removeClass("odf-hidden"),this.$cachedSelectors.confirmationMessageEmail.append(e)}})},function(e,t,i){"use strict";var n,a=Odigeo.Model.extend({defaults:{paymentDetails:{}}});e.exports.getInstance=function(){return _.isUndefined(n)&&(n=new a),n}},function(e,t,i){"use strict";function n(e,t){var i;return _.isArray(e)&&!_.isEmpty(e)&&(i=_.find(e,"segmentIndex",t)),i}var a={LOADING:"LOADING",SHOPPING:"SHOPPING",CHECKOUT:"CHECKOUT",PAYMENT:"PAYMENT",BUYING:"BUYING",SUCCESS:"SUCCESS",FAILURE:"FAILURE",PAYMENT_FAILURE:"PAYMENT_FAILURE"};e.exports=Odigeo.Model.extend({defaults:{phase:a.LOADING,bookingInfo:null,ancillaryInfo:null,showFlightInfo:!1,baggageAdded:!1},phases:a,baggageConditionsMap:null,currencyConfigMap:null,baggageSelection:null,initialize:function(){this.set("phase",a.LOADING),this.set("bookingInfo",null),this.set("ancillaryInfo",null),this.set("showFlightInfo",!1),this.baggageConditionsMap=null,this.currencyConfigMap=null},loadInfo:function(e,t,i){this.set("bookingInfo",e),this.set("flightDetails",e),this.set("ancillaryInfo",t),this.set("showFlightInfo",i)},hasInfo:function(){return!_.isEmpty(this.get("bookingInfo"))&&!_.isEmpty(this.get("ancillaryInfo"))},getTravelers:function(){return this.get("ancillaryInfo").travellers},getTraveler:function(e){return _.find(this.getTravelers(),"travellerNumber",e)},getBookingId:function(){return this.get("bookingInfo").bookingBasicInfo.id},getBuyerEmail:function(){return _.get(this.get("bookingInfo"),"buyer.mail")},getBaggageConditions:function(){if(_.isNull(this.baggageConditionsMap)){var e=this.get("ancillaryInfo").ancillaryOptionsContainer.baggageResultsResponse;this.baggageConditionsMap=(t=e,_.reduce(t,function(e,t){return e[t.travellerType.toUpperCase()]=t.baggageConditions,e},{}))}var t;return this.baggageConditionsMap},getCurrencyConfig:function(){if(_.isNull(this.currencyConfigMap)){var e=this.get("ancillaryInfo").currencyConfig;this.currencyConfigMap=(t=e,_.reduce(t,function(e,t){return t.currencySign=t.currencySymbol,t.currencyPosition=t.currencyInFront?"front":"back",e[t.currencyCode.toUpperCase()]=t,e},{}))}var t;return this.currencyConfigMap},getSegmentBaggageConditions:function(e,t){return n(this.getBaggageConditions()[e],t)},getSegmentsInfo:function(){return this.get("bookingInfo").itineraryBookings.itinerarySegments},getItineraryInfo:function(){return this.get("bookingInfo").itineraryBookings.bookingItinerary},hasIncludedBags:function(e,t){var i=this.getIncludedBags(e,t);return!_.isUndefined(i.pieces)&&0<i.pieces},getIncludedBags:function(e,t){var i=this.getSegmentBaggageConditions(e,t),n={};return _.isUndefined(i)||_.isUndefined(i.includedBaggage)||(n={pieces:i.includedBaggage.numPieces,kilos:i.includedBaggage.numKilos}),n},getAllIncludedBagsCount:function(){var e=this.getBaggageConditions(),t=null;return _.keys(e).map(function(i){var n=e[i].map(function(e){return e.includedBaggage.numPieces});n=_.reduce(n,function(e,t){return e+t},0),t+=n}),t},hasSelectableBagsForSegment:function(e,t){return!_.isEmpty(this.getSelectableBagsForSegment(e,t))},getSelectableBagsForSegment:function(e,t){var i=this.getSegmentBaggageConditions(e,t),n=this.getCurrencyConfig(),a=0,s=[],r={};return _.isUndefined(i)||_.isUndefined(i.selectableBaggage)||(_.isUndefined(i.includedBaggage)||(a=i.includedBaggage.numPieces),_.isUndefined(i.baggageFee)||(r={amount:i.baggageFee.amount,currencyCode:i.baggageFee.currencyCode,currencyConfig:n[i.baggageFee.currencyCode]}),s=_.map(i.selectableBaggage,function(e){return{pieces:e.baggageDescriptor.numPieces-a,kilos:e.baggageDescriptor.numKilos,amount:e.money.amount,currencyCode:e.money.currencyCode,currencyConfig:n[e.money.currencyCode],baggageFee:r}}),s=_.filter(s,function(e){return 0<e.pieces})),s},hasPaidBagsForSegment:function(e,t){var i=n(e.baggageSelections,t);return!_.isUndefined(i)&&0<i.pieces},getPaidBagsForSegment:function(e,t){var i=n(e.baggageSelections,t);return _.isUndefined(i)?{}:_.pick(i,"pieces","kilos")},getSelectableBag:function(e,t,i){var n=this.getSelectableBagsForSegment(e,t)[i];return _.isUndefined(n)?{}:n},showFlightInfo:function(){return this.get("showFlightInfo")}})},function(e,t,i){"use strict";var n,a=Backbone.Collection.extend({model:i(760),dataUrl:"gettravellers",nTravellers:0,initialize:function(){},getPassenger:function(e){return this.findWhere(e)},url:function(){return Odigeo.Settings.getProperty("serviceUrlFormatter")(this.dataUrl)},parse:function(e){return _.map(e,function(e,t){return{index:t,numPassenger:t+1,name:"",defaultName:""+(t+1),firstLastName:"",shortName:"P"+(t+1),defaultShortName:"P"+(t+1),travellerType:e.travellerType}})},populatePassengers:function(){this.fetch(this.getDataRequestSettings())},getDataRequestSettings:function(){return{type:"GET",cache:!1,dataType:"json",contentType:"application/json",success:_.bind(this.requestSuccessHandler,this)}},requestSuccessHandler:function(){this.trigger("passengerCollectionIsOk")},setUp:function(){this.populatePassengers()},updatePassengers:function(){var e=Odigeo.Storage.get("passengersData")||Odigeo.Session.get("passengersData")||null;return _.isNull(e)||_.each(this.getPassengersStorageInfo(e),function(e){this.setPassengerNewData(e)},this),this.models},getPassengersStorageInfo:function(e){var t=JSON.parse(e),i=[];return _.each(t,_.bind(function(e){_.isEmpty(e.name)||_.isEmpty(e.firstLastName)||i.push({name:e.name,firstLastName:e.firstLastName,shortName:e.name.charAt(0)+e.firstLastName.charAt(0),numPassenger:parseInt(e.travellerId,10),travellerType:e.travellerType})},this)),i},setPassengerNewData:function(e){var t=this.getPassenger({numPassenger:e.numPassenger+1});_.isUndefined(t)||t.set({name:e.name,firstLastName:e.firstLastName,shortName:e.shortName})},updatePassengersManager:function(){var e=Odigeo.Storage.get("passengersData")||Odigeo.Session.get("passengersData")||null;return _.isNull(e)||_.each(this.getPassengersManagerStorageInfo(e),function(e){this.setPassengerNewData(e)},this),this.models},getLastNumPassengerExcludingType:function(e){return this.reduceRight(function(t,i){return i.get("travellerType")!==e&&0===t?i.get("numPassenger"):t},0)},getPassengersManagerStorageInfo:function(e){var t=JSON.parse(e),i=[];return _.each(_.filter(t,function(e){return!!e.name}),function(e){i.push({name:e.name,numPassenger:i.length})}),i},containPassengerType:function(e){return 0<this.where({travellerType:e}).length},passengerCountByType:function(e){return this.where({travellerType:e}).length}});e.exports.getInstance=function(){return _.isUndefined(n)&&(n=new a),n}},function(e,t,i){"use strict";var n=Odigeo.AB.isSmartNagManager?i(566).manager:i(584);Odigeo.defineWidget("nagmanager",n)},function(e,t,i){"use strict";var n=i(567),a={seatMap:i(568),baggage:i(569)},s={continuePrimeUserBlocked:i(570),continuePrime:i(571),continuePriorityBoarding:i(572),continueSmartBag:i(573),continueDefaultBag:i(574),continueEvenUpBag:i(575),continueSeat:i(576),changedBagExtend:i(577),changedBagRemove:i(578),recommendedEvoServiceOptions:i(579),basicEvoServiceOptions:i(580),seatMapNoSelection:i(581),seatMapRemove:i(582),hotelBasic:i(583)},r={modelClass:Odigeo.Model.extend({defaults:{shownNags:{}}}),observers:[a.baggage,a.seatMap],queues:{removeSeatNagQueue:[s.seatMapRemove],changedBagNagQueue:[s.changedBagRemove,s.changedBagExtend],noSeatNagQueue:[s.seatMapNoSelection],hotelQueue:[s.hotelBasic],continueNagQueue:[s.continuePrimeUserBlocked,s.continuePrime,s.continuePriorityBoarding,s.continueSmartBag,s.continueEvenUpBag,s.continueDefaultBag,s.continueSeat],basicServiceOptionEvoNagQueue:[s.recommendedEvoServiceOptions,s.basicEvoServiceOptions]},nagInstanceSubscribedMethods:{},init:function(){this.parseOptions(),this.initQueues(),this.loadStateFromSession(),this.registerBaggageObserver()},parseOptions:function(){this.options=Odigeo.Utils.parseOptions(this.options)},initQueues:function(){var e=this;_.forEach(this.queues,function(t,i){e.queues[i]=(new n).create(_.map(t,function(t){return e.initNag(t)}))})},registerBaggageObserver:function(){a.baggage.register(_.bind(function(e){return this.shootQueue(this.queues.changedBagNagQueue,e)},this))},initNag:function(e){var t=e.start({view:this.view,options:this.options,proceedToPayment:_.bind(this.proceedToPayment,this),triggerSender:this.id});return this.initSubscriptions(t),t},proceedToPayment:function(){Odigeo.trigger(this.id+":continue")},initSubscriptions:function(e){var t=this;_.forEach(e.exposedMethods,function(i,n){t.nagInstanceSubscribedMethods[n]=e})},shootOnContinueToPayment:function(){return this.shootQueue(this.queues.continueNagQueue)},shootQueue:function(e){var t=1<arguments.length&&void 0!==arguments[1]?arguments[1]:{},i=e.shoot(this.getShootOptions(t));return this.setShownCategory(i),this.saveStateToSession(),_.get(i,"success",!1)},getShootOptions:function(e){return _.extend(this.getShownNagBooleans(),e,{shownNags:this.getShownNags(),hasAnyNagBeenShown:0<_.size(this.model.get("shownNags")),models:{seats:a.seatMap.getModel(),baggage:a.baggage.getModel()}})},getShownNagBooleans:function(){return _.transform(this.getShownNags(),function(e,t,i){e[_.camelCase("has_"+i+"_nag_been_shown")]=!0},{})},setShownCategory:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};if(e.success){var t=this.getShownNags(),i=_.get(e,"nag.category",""),n=i.split(":")[0];t[i]=!0,t[n]=!0,this.model.set("shownNags",t)}},getShownNags:function(){return this.model.get("shownNags")||{}},shootOnRemoveSeat:function(e){return this.shootQueue(this.queues.removeSeatNagQueue,{callbacks:e})},shootOnNoSeatSelected:function(e){return this.shootQueue(this.queues.noSeatNagQueue,{callbacks:e})},shootBasicServiceOptionEvo:function(e){return this.shootQueue(this.queues.basicServiceOptionEvoNagQueue,{price:e})},shootHotelReminder:function(){return this.shootQueue(this.queues.hotelQueue)},loadStateFromSession:function(){this.model.set({shownNags:this.getStateFromSession()})},getStateFromSession:function(){var e=Odigeo.Session.storage.getItem("nagsState");return _.isEmpty(e)?{}:Odigeo.Utils.parseJson(e)},saveStateToSession:function(){Odigeo.Session.storage.setItem("nagsState",JSON.stringify(this.model.shownNags))},exposedMethods:{shootNags:"shootOnContinueToPayment",updateState:"loadStateFromSession",saveNagsStateToSession:"saveStateToSession",showRemoveSeatsNags:"shootOnRemoveSeat",showNoSeatsSelectedNags:"shootOnNoSeatSelected",showBasicServiceOptionEvoNag:"shootBasicServiceOptionEvo",showHotelsReminderNag:"shootHotelReminder"},execute:function(e){var t=this.findInObservers(e)||this.findInSubscribedMethods(e)||{},i=t.exposedMethods||t;return Odigeo.Utils.executeInternalMethods(t,i,e,_.toArray(arguments).slice(1))},findInObservers:function(e){return this.findExecute(this.observers,e)},findInSubscribedMethods:function(e){var t=this.findExecute([this.nagInstanceSubscribedMethods,this.exposedMethods],e);return this.isSubscriberANagInstance(t,e)?t[e]:this},isSubscriberANagInstance:function(e,t){return e&&!_.isString(e[t])},findExecute:function(e,t){return _.find(e,function(e){return _.has(e,t)})}};e.exports={manager:Odigeo.Widget.extend(r),nags:s}},function(e,t,i){"use strict";e.exports=function(){var e=void 0;return{create:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:[];return e=t,this},shoot:function(){var t=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},i=e.find(function(e){return e.shoot(t)});return{success:!_.isUndefined(i),nag:i||{}}}}}},function(e,t,i){"use strict";var n=i(367);e.exports=n.create({model:{},exposedMethods:{updateSeats:function(e,t){var i,n,a,s=function(e,t){return _.get(e,t,{})};a=t,function(e,t){return _.size(s(e,t))}(i=this.getModel(),n=e)&&function(e,t,i){e[t]=_.extend(s(e),{priceData:i})}(i,n,a)},subscribeWidget:function(e){this.getModel()[e.widgetId]=e.details||{}}}})},function(e,t,i){"use strict";var n=i(367),a=i(36),s=i(168);e.exports=n.create({model:new(Odigeo.Model.extend(a.extend(s.extend({callback:_.noop,initialize:function(){this.suscribeBaggagesCollectionEvents()},register:function(e){this.callback=e},onBaggageChange:function(e){this.callback(e)}})))),exposedMethods:{register:function(e){this.getModel().register(e)}}})},function(e,t,i){"use strict";var n=i(77),a=i(35),s={trackingLoad:"nag_prime_user_blocked_appearances",trackingAdd:"nag_prime_user_blocked_add",trackingContinue:"nag_prime_user_blocked_continue"},r={isPrimeUserBlocked:!1,primeName:""},o=void 0;e.exports=n.create({category:"continue:prime",should:function(){var e=this.getParameters().options;return this.isBlockedUser()&&this.isMembershipTestEnabled(e)&&this.isDualPriceTestEnabled(e)},shoot:function(){return o=a.show({view:this.getView(),translations:this.getTranslations(),tracking:s,actionBtnFunction:this.close,ignoreBtnFunction:_.bind(this.continueToPayment,this),shouldRebindContinueButtonAfterActionBtnPressed:!0})},isBlockedUser:function(){return r.isPrimeUserBlocked},isMembershipTestEnabled:function(e){return _.get(e,"tests.isMembershipProductSellingEnabled",!1)},isDualPriceTestEnabled:function(e){return _.get(e,"tests.isMembershipDualPriceDisplay",!1)},getTranslations:function(){var e=this.getUserBlockTranslation(this.getParameters().options);return{title:Odigeo.Utils.replaceCmsKeyArgs(e.title,r.primeName),subtitle:e.subtitle,button1:e.button1,button2:e.button2,icon:e.icon,usingNotBrandedIcon:!0}},getUserBlockTranslation:function(e){return _.get(e,"nagTranslations.prime.userBlocked",{})},updatePrimeUserBlocked:function(e,t){_.extend(r,{isPrimeUserBlocked:e,primeName:t})},continueToPayment:function(){this.storeInSession(),this.getParameters().proceedToPayment()},storeInSession:function(){return Odigeo.Session.set("isPrimeBlocked",r.isPrimeUserBlocked)},close:function(){return o.close()},exposedMethods:{updatePrimeUserBlocked:"updatePrimeUserBlocked"}})},function(e,t,i){"use strict";var n=i(77),a=i(35),s={isUserLoggedIn:!1};e.exports=n.create({category:"continue:prime",addPrime:function(){Odigeo.trigger(this.getParameters().triggerSender+":addPrime")},should:function(){var e=s.membership,t=this.getParameters().options;return t.tests.isMembershipProductSellingEnabled&&(this.isDesktopEnabled(t)||this.isMobileEnabled(t))&&t.tests.isMembershipDualPriceDisplay&&!_.isUndefined(e)&&!e.added&&(this.shouldShowInDesktop(t)||this.shouldShowInMobile(t))&&!e.isMember},shoot:function(){return a.show({view:this.getView(),translations:this.getTranslations(this.getParameters().options),tracking:this.getTracking(),actionBtnFunction:_.bind(this.addPrime,this),ignoreBtnFunction:this.getProceedToPayment(),shouldRebindContinueButtonAfterActionBtnPressed:!0})},shouldShowInDesktop:function(e){return this.isDesktopEnabled(e)&&this.shouldShowMembershipNagDesktop(e)},shouldShowInMobile:function(e){return this.isMobileEnabled(e)&&2===this.getModelGroup()},isDesktopEnabled:function(e){return this.isDesktopTestEnabled(e)&&this.isDesktop()},isMobileEnabled:function(e){return this.isMobileTestEnabled(e)&&this.isMobile()},shouldShowMembershipNagDesktop:function(e){return this.isMemberShipTestEnabled(e)?2===this.getModelGroup():_.includes([2,3],this.getModelGroup())},isDesktopTestEnabled:function(e){return _.get(e,"tests.isMembershipPrimeNagDesktopEnabled",!1)},isMobileTestEnabled:function(e){return _.get(e,"tests.isMembershipPrimeNagMobileEnabled",!1)},isDesktop:function(){return"desktop"===Odigeo.SessionScope.flow},isMobile:function(){return"mobile"===Odigeo.SessionScope.flow},isMemberShipTestEnabled:function(e){return _.get(e,"tests.isShowMembershipNagOnlyForProfitabilityAtFirst",!1)},getModelGroup:function(){return _.get(s,"membership.group")},getTracking:function(){var e=this.getTrackingLabel();return{trackingLoad:"nag_prime_appearances_"+e+"_sce:"+(s.isLoggedIn?"login-no-prime":"no-prime"),trackingAdd:"prime_mem_view_"+(s.isLoggedIn?"log-no-sub":"no-log-no-sub")+"_nag",trackingContinue:"nag_prime_continue_"+e+"_sce:"+(s.isLoggedIn?"login-no-prime":"no-prime")}},getTrackingLabel:function(){return["profitability","other"][this.getMemberData().group%2]},getTranslations:function(e){var t=this.getGroup(e)||{},i=this.getNoPrimeSelected(e);return _.extend(t,{title:Odigeo.Utils.replaceCmsKeyArgs(t.title,_.get(i,"discount","").substring(1)),subtitle:Odigeo.Utils.replaceCmsKeyArgs(t.subtitle,i.price)})},getMemberData:function(){return s.membership||{}},getGroup:function(e){return this.getNoPrimeSelected(e)["group"+_.get(this.getMemberData(),"group")]},getNoPrimeSelected:function(e){return _.get(e,"nagTranslations.prime.noPrimeSelected",{})},updateMembership:function(e){return s.membership=e},loginDone:function(){return s.isUserLoggedIn=!0},logoutDone:function(){return s.isUserLoggedIn=!1},exposedMethods:{updateMembership:"updateMembership",loginDone:"loginDone",logoutDone:"logoutDone"}})},function(e,t,i){"use strict";var n=i(59).getInstance(),a=i(88);e.exports=a.create({category:"continue:priority",should:function(e){return n.mustShowNag()&&this.getModel(e).hasNoBagBeenSelected()},shoot:function(){return Odigeo.trigger("boarding-options:showPriorityBoardingNag")}})},function(e,t,i){"use strict";var n=i(88);e.exports=n.create({category:"continue:bag",should:function(e){var t=this.getModel(e);return!e.hasAnyNagBeenShown&&t.hasAnySelectableBaggage()&&t.hasNoBagBeenSelected()&&t.doBaggageAllowSmartNag()&&this.getNumPassengersWithBaggage()<=2&&!t.isBaggagePropensityLow()},shoot:function(){return Odigeo.trigger("smart-nag-baggage:showSmartNagBaggage")},getNumPassengersWithBaggage:function(){var e=this.getParameters().options;return e.numAdults+e.numChildren}})},function(e,t,i){"use strict";var n=i(35),a=i(88);e.exports=a.create({category:"continue:bag",should:function(e){var t=this.getModel(e);return!e.hasAnyNagBeenShown&&t.hasAnySelectableBaggage()&&t.hasNoBagBeenSelected()&&!t.isBaggagePropensityLow()},shoot:function(e){return n.show({view:this.getView(),translations:this.getTranslations(e),tracking:this.getDialogOptions(e),actionBtnFunction:_.bind(this.addBaggage,this),ignoreBtnFunction:this.getProceedToPayment(),shouldRebindContinueButtonAfterActionBtnPressed:!0})},isExtraBaggage:function(e){return 0<this.getModel(e).getPassengerIncludedAndSelectableRows(0).length},getTranslations:function(e){var t=this.getParameters().options;return this.isExtraBaggage(e)?_.get(t,"nagTranslations.baggages.noBagsExtraSelected"):_.get(t,"nagTranslations.baggages.noBagsSelected")},getDialogOptions:function(e){return{typeBaggage:this.getBaggageType(e),trackingLoad:this.getTrackingLabel(e,"_appearances"),trackingAdd:this.getTrackingLabel(e,"_add"),trackingContinue:this.getTrackingLabel(e,"_continue")}},getBaggageType:function(e){return this.isExtraBaggage(e)?"baggages-noselection-extra":"baggages-noselection"},getTrackingLabel:function(e,t){return"nag_baggage"+this.getTrackingSuffix(e)+"_submit"+t},getTrackingSuffix:function(e){return this.isExtraBaggage(e)?"_extra":""},addBaggage:function(){Odigeo.trigger(this.getParameters().triggerSender+":addBaggages")}})},function(e,t,i){"use strict";var n=i(35),a=i(88),s={trackingLoad:"nag_baggage_xfaringextend_appearances",trackingAdd:"nag_baggage_xfaringextend_add",trackingContinue:"nag_baggage_xfaringextend_continue"};e.exports=a.create({category:"continue:bag",should:function(e){return this.hasAnySelectableBaggage(e)&&this.hasNoBagBeenSelected(e)&&!e.hasAnyNagBeenShown&&this.isTestEnabled()&&this.doBaggageAllowEvenUpNag(e)&&!this.isBaggagePropensityLow(e)},shoot:function(e){return n.show({view:this.getView(),translations:this.getTranslations(e,this.getContentKeys(this.getParameters())),tracking:s,actionBtnFunction:_.bind(this.doSelection,this),ignoreBtnFunction:this.getProceedToPayment()})},getCurrencyFormat:function(){return _.extend({},Odigeo.Utils.Currency,{decimalPlaces:2})},getPrice:function(e){return Odigeo.Utils.formatCurrency(this.getBagData(e).price,this.getCurrencyFormat())},hasAnySelectableBaggage:function(e){return this.getModel(e).hasAnySelectableBaggage()},hasNoBagBeenSelected:function(e){return this.getModel(e).hasNoBagBeenSelected()},doBaggageAllowEvenUpNag:function(e){return this.getModel(e).doBaggageAllowEvenUpNag()},isBaggagePropensityLow:function(e){return this.getModel(e).isBaggagePropensityLow()},isTestEnabled:function(){return _.get(this.getParameters(),"options.tests.evenUpBaggageNag")},getContentKeys:function(e){return _.get(e,"options.nagTranslations.baggages.evenUpBaggage",{})},getTranslations:function(e,t){return _.extend(t,{subtitle:this.getSubtitle(e,t)})},getSubtitle:function(e,t){return 0<this.getBagData(e).kilos?this.getKeyWithKilos(e,t):this.getKeyWithoutKilos(e,t)},getKeyWithKilos:function(e,t){return this.getPluralKey(e,t.subtitleWithKilos,this.getPiecesToShow(e),this.getBagData(e).kilos)},getKeyWithoutKilos:function(e,t){return this.getPluralKey(e,t.subtitleWithoutKilos,this.getPiecesToShow(e))},getPiecesToShow:function(e){return this.getBagData(e).piecesToShow},getPluralKey:function(e){for(var t,i=arguments.length,n=Array(1<i?i-1:0),a=1;a<i;a++)n[a-1]=arguments[a];return(t=Odigeo.Utils).pluralizeAll.apply(t,function(e){if(Array.isArray(e)){for(var t=0,i=Array(e.length);t<e.length;t++)i[t]=e[t];return i}return Array.from(e)}(n).concat([this.getPrice(e)]))},getBagData:function(e){return this.getModel(e).getFirstSelectableBaggageData()},doSelection:function(){Odigeo.trigger(this.getParameters().triggerSender+":evenUpBaggageSelection")}})},function(e,t,i){"use strict";var n=i(35),a=i(324),s={trackingLoad:"nag_seats_submit_appearances",trackingAdd:"nag_seats_submit_add",trackingContinue:"nag_seats_submit_continue"};e.exports=a.create({category:"continue:seat",should:function(e){return this.isSeatMapEnabled(e)&&this.isNoSeatSelected(e)},shoot:function(){return n.show({view:this.getView(),translations:_.get(this.getParameters(),"options.nagTranslations.seats.continues"),tracking:s,actionBtnFunction:_.bind(this.goToSeats,this),ignoreBtnFunction:this.getProceedToPayment(),shouldRebindContinueButtonAfterActionBtnPressed:!0})},isNoSeatSelected:function(e){return!!this.isSeatMapEnabled(e)&&this.isSeatSelectionEmpty(e)&&this.haveSeatMapNagsNotBeenShown(e)},isSeatMapEnabled:function(e){return""!==this.seatsSelectionInfo(e).type},isSeatSelectionEmpty:function(e){return!this.seatsSelectionInfo(e).seatsSelected},haveSeatMapNagsNotBeenShown:function(e){return!e.hasContinueSeatNagBeenShown&&!e.hasSeatMapNagBeenShown},goToSeats:function(){return Odigeo.trigger(this.getParameters().triggerSender+":goToSeats")}})},function(e,t,i){"use strict";var n=i(35),a=i(88),s={trackingLoad:"nag_baggage_extend_appearances",trackingAdd:"nag_baggage_extend_add",trackingContinue:"nag_baggage_extend_continue"};e.exports=a.create({category:"changed_bag:extend",should:function(e){return!this.isThereAnInfant(this.getParameters().options)&&this.areConditionsMet(e)},shoot:function(e){_.delay(_.bind(this.showBaggagesExtendNag,this,e),500)},isThereAnInfant:function(e){return 2===e.numTravellers&&1===e.numInfants},areConditionsMet:function(e){return!e.hasContinueBagNagBeenShown&&!e.hasChangedBagExtendNagBeenShown&&1<this.getParameters().options.numTravellers&&0!==this.getModel(e).getBaggageSelectedPieces()&&this.hasPassengerAllRowsSelected(e)&&this.isThereAnyPassengerToExtend(e)},showBaggagesExtendNag:function(e){var t=this.getIsOfferNag(e),i=this.getModel(e).getDiscountedPart();n.show({view:this.getView(),translations:_.get(this.getParameters(),t?"options.nagTranslations.baggages.extendOfferSelection":"options.nagTranslations.baggages.extendSelection"),tracking:s,actionBtnFunction:_.bind(this.extendBaggageSelection,this,e),ignoreBtnFunction:null,data:{totalDiscount:i,discountPercentage:this.getModel(e).getBaggagesDiscount(),formattedTotalDiscount:Odigeo.Utils.formatCurrency(i)},isOfferNag:t})},getIsOfferNag:function(e){return 0<this.getModel(e).getBaggagesDiscount()&&Odigeo.AB.isBaggageDiscountEnabled},hasPassengerAllRowsSelected:function(e){var t=this.getModel(e),i=this.getNumberSelectablePiecesSelected(e);return!_.isUndefined(t.getPassengerRows(e.idPassenger))&&t.getPassengerSelectableRows(e.idPassenger).length===i},getNumberSelectablePiecesSelected:function(e){return _.size(_.filter(this.getSelectablePiecesSelected(e),function(e){return 0<e.get("piecesToShow")}))},getSelectablePiecesSelected:function(e){return this.getModel(e).getAllBaggagesOptions({idPassenger:e.idPassenger,isSelectableBaggage:!0,selected:!0})},isThereAnyPassengerToExtend:function(e){var t=this.sortSelectedPiecesByPassengerAndSegment(e),i=this.getOtherPassengerIds(t,e.idPassenger),n=t[e.idPassenger];return!!_.isEmpty(i)||!_.every(i,function(e){return this.comparePassengerOptions(n,t[e])},this)},getOtherPassengerIds:function(e,t){return _.chain(e).keys().filter(function(e){return e.toString()!==t.toString()}).value()},sortSelectedPiecesByPassengerAndSegment:function(e){return _.transform(this.getAllSelectedSelectablePieces(e),function(e,t){var i=t.get("idPassenger");e[i]=e[i]||{},0<t.get("piecesToShow")&&(e[i][t.get("idRow")]=t)})},getAllSelectedSelectablePieces:function(e){return this.getModel(e).getAllBaggagesOptions({isSelectableBaggage:!0,selected:!0})},comparePassengerOptions:function(e,t){return _.every(e,function(e,i){return t[i]&&_.isEqual(this.getRawOptData(e),this.getRawOptData(t[i]))},this)},getRawOptData:function(e){return _.pick(e?e.attributes:{},"kilos","pieces","piecesToShow","price")},extendBaggageSelection:function(e){_.each(this.getPassengerCurrentSelection(e),function(t){this.getModel(e).updateAllMatchingBaggagesOptions(this.getSelectionPattern(t),e.idPassenger)},this)},getPassengerCurrentSelection:function(e){return this.getModel(e).getAllBaggagesOptions({idPassenger:e.idPassenger,isSelectableBaggage:!0,selected:!0})},getSelectionPattern:function(e){return _.pick(e.getAll(),"idRow","pieces","kilos","price")}})},function(e,t,i){"use strict";var n=i(35),a=i(88),s=void 0;e.exports=a.create({category:"changed_bag:remove",should:function(e){return e.isBaggageBeingRemoved&&!e.hasChangedBagRemoveNagBeenShown&&!e.hasContinueNagBeenShown&&e.isUserAction&&_.isObject(e.previousOption)},shoot:function(e){return s=e.previousOption,n.show({view:this.getView(),translations:this.getTranslations(e),tracking:this.getDialogOptions(e),actionBtnFunction:_.bind(this.restoreSelection,this,e),ignoreBtnFunction:null})},getTranslations:function(e){return this.isExtraBaggage(e)?this.getTranslationKey("nagTranslations.baggages.removeBagsExtra"):this.getTranslationKey("nagTranslations.baggages.removeBags")},getTranslationKey:function(e){return _.get(this.getParameters().options,e,"")},getDialogOptions:function(e){return{typeBaggage:this.getBaggageType(e),trackingLoad:this.getTrackingKey(e,"_removal_appearances"),trackingAdd:this.getTrackingKey(e,"_removal_add"),trackingContinue:this.getTrackingKey(e,"_removal_continue")}},getTrackingKey:function(e,t){return"nag_baggage"+this.getTrackingExtraKey(e)+t},getTrackingExtraKey:function(e){return this.isExtraBaggage(e)?"_extra":""},getBaggageType:function(e){return this.isExtraBaggage(e)?"baggages-remove-extra":"baggages-remove"},isExtraBaggage:function(e){return!(_.isUndefined(e.idPassenger)||!e.isBaggageBeingRemoved)&&0<this.getModel(e).getPassengerIncludedAndSelectableRows(e.idPassenger).length},restoreSelection:function(e){this.getModel(e).updateBaggageSelection({newOptionCid:s,isUserAction:!1,triggerEvents:!0})}})},function(e,t,i){"use strict";var n=i(77),a=i(35),s=i(140)("guarantees"),r={trackingLoad:"nag_so_push_appearances",trackingAdd:"nag_so_push_add",trackingContinue:"nag_so_push_continue"};e.exports=n.create({category:"service_options:basic",should:function(e){return!e.hasServiceOptionsBasicNagBeenShown},shoot:function(e){return a.show({view:this.getView(),translations:this.getTranslations(this.getGroup(this.getParameters()),e),tracking:_.extend({page:s.getPageToTrack()},r),actionBtnFunction:_.bind(this.addRecommendedSoEvo,this),ignoreBtnFunction:_.bind(this.addBasicSoEvo,this)})},getTranslations:function(e,t){return _.extend(e,{subtitle:this.getSubtitle(e,t),icon:"../icons/spot/customer_care.svg"})},getSubtitle:function(e,t){return Odigeo.Utils.replaceCmsKeyArgs(e.subtitle,t.price)},getGroup:function(e){return _.get(e,"options.nagTranslations.serviceOptionsEvo.basicSoSelected",{})},addRecommendedSoEvo:function(){Odigeo.trigger(this.getParameters().triggerSender+":addRecommendedSoEvo")},addBasicSoEvo:function(){Odigeo.trigger(this.getParameters().triggerSender+":addBasicSoEvo")}})},function(e,t,i){"use strict";var n=i(77);e.exports=n.create({category:"service_options:basic",should:function(){return!0},shoot:function(){Odigeo.trigger(this.getParameters().triggerSender+":addBasicSoEvo")}})},function(e,t,i){"use strict";var n=i(35),a=i(324),s={trackingLoad:"nag_seats_close_seatmap_appearances",trackingAdd:"nag_seats_close_seatmap_add",trackingContinue:"nag_seats_close_seatmap_continue"};e.exports=a.create({category:"seat_map:no_selection",should:function(e){return this.launchClose(e),this.mustShowNag(e)},shoot:function(e){return n.show({view:this.getView(),translations:_.get(this.getParameters(),"options.nagTranslations.seats.continues"),tracking:s,actionBtnFunction:null,ignoreBtnFunction:this.getCloseCallBack(e)})},launchClose:function(e){this.getClose(e)()},getClose:function(e){return this.mustShowNag(e)?_.noop:this.getCloseCallBack(e)},mustShowNag:function(e){return!e.hasContinueSeatNagBeenShown&&!e.hasSeatMapNagBeenShown}})},function(e,t,i){"use strict";var n=i(35),a=i(324),s={trackingLoad:"nag_seats_removal_appearances",trackingAdd:"nag_seats_removal_add",trackingContinue:"nag_seats_removal_continue"},r={trackingLoad:"nag_seats_close_seatmap_appearances",trackingAdd:"nag_seats_close_seatmap_add",trackingContinue:"nag_seats_close_seatmap_continue"};e.exports=a.create({category:"seat_map:remove",should:function(e){return this.processCallBacks(e),this.mustBeShown(e)},shoot:function(e){var t=this;return _.find([this.shootRemoveNag,this.shootNoSelectedSeatNag],function(i){return i.call(t,e)})},shootRemoveNag:function(e){return this.areThereSelectedSeats(e)&&this.launchNag(this.launchRemoveNag,e)},shootNoSelectedSeatNag:function(e){return this.isSelectionEmpty(e)&&this.launchNag(this.launchNoSelectedSeatNag,e)},launchNag:function(e,t){return e.call(this,t),!0},launchRemoveNag:function(e){n.show({view:this.getView(),translations:this.getTranslations("options.nagTranslations.seats.remove"),tracking:s,actionBtnFunction:this.getKeepCallBack(e),ignoreBtnFunction:this.getRemoveCallBack(e)})},getKeepCallBack:function(e){return this.getCallBacks(e).keepCallBack},getRemoveCallBack:function(e){return this.getCallBacks(e).removeCallBack},processCallBacks:function(e){this.mustNotBeShown(e)&&this.performCallbacks(e)},performCallbacks:function(e){this.performRemoveCallBack(e),this.performCloseCallBack(e)},performCloseCallBack:function(e){this.getCloseCallBack(e).call(this)},performRemoveCallBack:function(e){this.getRemoveCallBack(e).call(this)},mustNotBeShown:function(e){return!this.mustBeShown(e)},mustBeShown:function(e){return!this.isSelectionEmpty(e)||this.hasAnySeatMapNagNotBeenShown(e)},isSelectionEmpty:function(e){return!this.areThereSelectedSeats(e)},areThereSelectedSeats:function(e){return this.getSelectedSeats(this.seatsSelectionInfo(e))},hasAnySeatMapNagNotBeenShown:function(e){return!e.hasSeatMapRemoveNagBeenShown&&!e.hasContinueSeatNagBeenShown},getSelectedSeats:function(e){return e.seatsSelected},launchNoSelectedSeatNag:function(e){n.show({view:this.getParameters().view,translations:this.getTranslations("nagTranslations.seats.continues"),tracking:r,actionBtnFunction:null,ignoreBtnFunction:this.getCloseCallBack(e)})},getTranslations:function(e){return _.get(this.getParameters(),e)}})},function(e,t,i){"use strict";var n=i(77),a=i(35),s={trackingLoad:"nag_hotel_upsell_appearances_",trackingAdd:"nag_hotel_upsell_add",trackingContinue:"nag_hotel_upsell_continue"};e.exports=n.create({category:"hotel:basic",should:function(){return!0},shoot:function(){return this.storeInSession(),a.show({view:this.getView(),translations:this.getTranslations(this.getGroup(this.getParameters())),tracking:this.getTracking(),actionBtnFunction:_.bind(this.performXSell,this),ignoreBtnFunction:null})},getTracking:function(){return _.extend({trackingLoad:this.getTrackingLoad()},s)},getTrackingLoad:function(){return s.trackingLoad+Odigeo.Session.get("reasonIntermediate")},getTranslations:function(e){return _.extend(e,{title:e.title,subtitle:e.subtitle,icon:"../icons/spot/hotel.svg"})},storeInSession:function(){return Odigeo.Session.set("ipHotelReminderNagShown",!0)},getGroup:function(e){return _.get(e,"options.nagTranslations.hotelsReminder.continues",{})},performXSell:function(){Odigeo.trigger(this.getParameters().triggerSender+":requestXsellAccommodationResults")}})},function(e,t,i){"use strict";var n,a=i(168),s=i(36),r=i(0),o=i(140)("guarantees"),c=i(59).getInstance(),d="baggages-remove",l="baggages-noselection",g=!1,h={};e.exports=Odigeo.Widget.extend(s.extend(a.extend({modelClass:Odigeo.Model.extend({insurancesNoSelectionAlreadyShown:!1,defaults:{primeNagAlreadyShown:!1,primeUserBlockedNagAlreadyShown:!1,baggagesContinueNagAlreadyShown:!1,baggagesRemoveNagAlreadyShown:!1,baggagesExtendNagAlreadyShown:!1,flexNagAlreadyShown:!1,insurances:{},flex:null,isUserLoggedIn:!1},update:function(){var e=Odigeo.Utils.parseJson(Odigeo.Session.storage.getItem("nagsState"));_.isObject(e)&&_.each(e,function(e,t){this.set(t,e)},this)},getSessionFormat:function(){return _.pick(this.toJSON(),"baggagesContinueNagAlreadyShown","baggagesRemoveNagAlreadyShown","baggagesExtendNagAlreadyShown")},disableInsurancesNoSelectionNag:function(){this.insurancesNoSelectionAlreadyShown=!0},seatsSelectionInfo:function(){var e=this.get("seatmap-selection")||{},t=0<_.size(e),i=t?"seatmap-selection":"";return{seatsSelected:!(!t||0===_.size(e.priceData.seatMapSelectionRequests)),type:i,data:e}},noSeatsSelected:function(){var e=this.seatsSelectionInfo(),t=""!==e.type,i=!e.data.seatsContinueNagAlreadyShown&&!e.data.seatsRemoveNagAlreadyShown,n=!!t&&!e.seatsSelected&&i;return t&&n&&this.widget.showContinueSeatsNags(),n}}),init:function(){this.options=Odigeo.Utils.parseOptions(this.options),this.bindEvents()},bindEvents:function(){this.suscribeBaggagesCollectionEvents()},onBaggageChange:function(e){var t=e.currentOption,i=e.previousOption,n=t.get("selected")&&0===t.get("price")&&0!==i.get("price"),a=t.get("idPassenger");!_.isUndefined(a)&&n&&(g=0<this.getPassengerIncludedAndSelectableRows(a).length),this.shootOnChangedBaggagesNags({isBaggageBeingRemoved:n,idPassenger:a,previousOption:e.previousOption,isUserAction:e.isUserAction})},shootOnChangedBaggagesNags:function(e){e.isBaggageBeingRemoved&&this.shouldShowRemoveBaggagesNag()?e.isUserAction&&_.isObject(e.previousOption)&&(n=e.previousOption,this.showRemoveBaggagesNag()):this.shouldShowExtendBaggagesNag(e.idPassenger)&&_.delay(_.bind(this.showBaggagesExtendNag,this),500,e.idPassenger)},removedInsuranceSelected:function(e){e.nagName="nag_insurance_removal",this.noInsuranceSelected(e)},noInsuranceSelected:function(e){var t=this.model.get("insurances"),i=_.isEmpty(t)||this.model.insurancesNoSelectionAlreadyShown;i||(this.model.insurancesNoSelectionAlreadyShown=!0,e.nagName=e.nagName||"nag_insurance_submit",this.showNoInsuranceSelectedNag(e)),e.doNotTriggerContinue||Odigeo.trigger(this.id+":insuranceMustContinue",i)},checkNoInsuranceSelectionIfRejected:function(e){this.model.insurancesNoSelectionAlreadyShown?Odigeo.trigger(this.id+":insurancesNagContinueWithoutChecking"):(this.model.insurancesNoSelectionAlreadyShown=!0,e.nagName="nag_insurance_submit",this.showNoInsuranceSelectedNag(e))},showNoInsuranceSelectedNag:function(e){var t=Odigeo.Utils.parseJson(Odigeo.Session.storage.getItem("insuranceNagAlreadyShown")),i=o.getPageToTrack();if(_.isNull(t)&&!e.shouldAvoidNag){var n=e.nagName;this.showNag(this.options.nagTranslations.insurances.noInsuranceSelected,{page:i,trackingLoad:n+"_appearances",trackingAdd:n+"_add",trackingContinue:n+"_continue"},_.bind(function(){Odigeo.trigger(this.id+":addInsurance",e.insuranceId)},this),function(e){switch(e.continuanceMode){case"DO_NOTHING":return null;case"SCROLL":return _.partial(function(){Odigeo.trigger("nagmanager:insurancesNagScroll")});case"UNCHECK":return _.partial(function(){Odigeo.trigger("nagmanager:uncheckProduct",e.insuranceId)});default:return _.partial(function(){Odigeo.trigger("nagmanager:insurancesNagContinue",e.checkRejectInsuranceOnContinue)})}}(e)),Odigeo.Session.storage.setItem("insuranceNagAlreadyShown",!0)}},checkIfFlexNagShouldBeShown:function(e,t){var i=this.model.get("flex"),n=_.isUndefined(i)||i!==e,a=o.getPageToTrack();n||t||this.model.get("flexNagAlreadyShown")||(this.showNag(this.options.nagTranslations.flex.noFlexSelected,{page:a,trackingLoad:"nag_flexible_removal_appearances",trackingAdd:"nag_flexible_removal_add",trackingContinue:"nag_flexible_removal_continue"},_.bind(function(){Odigeo.trigger(this.id+":addFlex")},this)),this.model.set("flexNagAlreadyShown",!0))},getDialogOptions:function(e,t){var i=t?"_extra":"",n="nag_baggage",a="";switch(e){case d:h.typeBaggage=t?"baggages-remove-extra":d,a="_removal";break;case l:h.typeBaggage=t?"baggages-noselection-extra":l,a="_submit"}h.trackingLoad=n+i+a+"_appearances",h.trackingAdd=n+i+a+"_add",h.trackingContinue=n+i+a+"_continue"},showDefaultBaggageContinueNag:function(){g=0<this.getPassengerIncludedAndSelectableRows(0).length,this.getDialogOptions(l,g),this.setBaggageContinueNagAlreadyShown(),this.showNag(g?this.options.nagTranslations.baggages.noBagsExtraSelected:this.options.nagTranslations.baggages.noBagsSelected,h,_.bind(this.addBaggages,this),_.bind(this.proceedToPayment,this),!1,null,!0)},addBaggages:function(){Odigeo.trigger(this.id+":addBaggages")},evenUpBaggageSelection:function(){Odigeo.trigger(this.id+":evenUpBaggageSelection")},addPrime:function(){Odigeo.trigger(this.id+":addPrime")},proceedToPayment:function(){Odigeo.trigger(this.id+":continue")},enableContinueButton:function(){Odigeo.trigger("passengers_manager:continueButtonBinding")},setBaggageContinueNagAlreadyShown:function(){this.model.set("baggagesContinueNagAlreadyShown",!0)},setPrimeNagAlreadyShown:function(){this.model.set("primeNagAlreadyShown",!0)},setPrimeUserBlockedNagAlreadyShown:function(){this.model.set("primeUserBlockedNagAlreadyShown",!0)},setPrimeUserBlockedNagToShownAgain:function(){this.model.set("primeUserBlockedNagAlreadyShown",!1)},setBaggageNagsToDisplayed:function(){this.setBaggageExtendNagAlreadyShown(),this.setBaggageRemoveNagAlreadyShown(),this.setBaggageContinueNagAlreadyShown()},updateBaggageNagAvailability:function(){var e=this.getBaggagePropensity(),t=_.isNumber(e)&&e<=.2;this.options.tests.bagPropensityNag&&t&&this.setBaggageNagsToDisplayed()},shouldShowContinueNag:function(){return this.noNagHasBeenShown()&&this.hasAnySelectableBaggage()&&this.hasNoBagBeenSelected()},shouldShowPriorityBoardingNag:function(){return c.mustShowNag()&&this.hasNoBagBeenSelected()},shouldShowSmartNagBaggage:function(){var e=this.options.numAdults+this.options.numChildren;return this.doBaggageAllowSmartNag()&&e<=2&&!c.mustShowNag()},shouldShowEvenUpNag:function(){return this.options.tests.evenUpBaggageNag&&this.doBaggageAllowEvenUpNag()},noNagHasBeenShown:function(){return!(this.hasPrimeNagBeenShown()||this.hasPrimeUserBlockedNagBeenShown()||this.hasContinueNagBeenShown()||this.hasRemoveNagBeenShown()||this.hasExtendNagBeenShown())},hasContinueNagBeenShown:function(){return this.model.get("baggagesContinueNagAlreadyShown")},hasPrimeNagBeenShown:function(){return this.model.get("primeNagAlreadyShown")},hasPrimeUserBlockedNagBeenShown:function(){return this.model.get("primeUserBlockedNagAlreadyShown")},showBaggagesExtendNag:function(e){var t,i={},n=this.getBaggageBundleDiscountPercentage(),a=0<n&&Odigeo.AB.isBaggageDiscountEnabled,s=a?this.options.nagTranslations.baggages.extendOfferSelection:this.options.nagTranslations.baggages.extendSelection;a&&(t=this.getDiscountedPart(),i.totalDiscount=t,i.discountPercentage=n,i.formattedTotalDiscount=Odigeo.Utils.formatCurrency(t)),this.hasExtendNagBeenShown()||(this.setBaggageExtendNagAlreadyShown(),this.showNag(s,{trackingLoad:"nag_baggage_extend_appearances",trackingAdd:"nag_baggage_extend_add",trackingContinue:"nag_baggage_extend_continue"},_.bind(this.extendBaggageSelection,this,e),null,a,i))},extendBaggageSelection:function(e){var t=this.getAllBaggagesOptions({idPassenger:e,isSelectableBaggage:!0,selected:!0});_.each(t,function(t){var i=_.pick(t.getAll(),"idRow","pieces","kilos","price");this.updateAllMatchingBaggagesOptions(i,e)},this)},setBaggageExtendNagAlreadyShown:function(){this.model.set("baggagesExtendNagAlreadyShown",!0)},shouldShowExtendBaggagesNag:function(e){return(2!==this.options.numTravellers||1!==this.options.numInfants)&&1<this.options.numTravellers&&0!==this.getBaggageSelectedPieces()&&!this.hasExtendNagBeenShown()&&this.hasPassengerAllRowsSelected(e)&&this.isThereAnyPassengerToExtend(e)},hasPassengerAllRowsSelected:function(e){var t=this.getAllBaggagesOptions({idPassenger:e,isSelectableBaggage:!0,selected:!0});return t=_.filter(t,function(e){return 0<e.get("piecesToShow")}),!_.isUndefined(this.getPassengerRows(e))&&this.getPassengerSelectableRows(e).length===t.length},isThereAnyPassengerToExtend:function(e){var t=this.sortSelectedPiecesByPassengerAndSegment(),i=_.chain(t).keys().filter(function(t){return t.toString()!==e.toString()}).value(),n=t[e];return!!_.isEmpty(i)||!_.every(i,function(e){return this.comparePassengerOptions(n,t[e])},this)},getAllSelectedSelectablePieces:function(){return this.getAllBaggagesOptions({isSelectableBaggage:!0,selected:!0})},sortSelectedPiecesByPassengerAndSegment:function(){var e,t=this.getAllSelectedSelectablePieces(),i={};return _.each(t,function(t){e=t.get("idPassenger"),i[e]=i[e]||{},0<t.get("piecesToShow")&&(i[e][t.get("idRow")]=t)}),i},comparePassengerOptions:function(e,t){return _.every(e,function(e,i){return t[i]&&_.isEqual(this.getRawOptData(e),this.getRawOptData(t[i]))},this)},getRawOptData:function(e){return _.pick(e?e.attributes:{},"kilos","pieces","piecesToShow","price")},hasExtendNagBeenShown:function(){return this.model.get("baggagesExtendNagAlreadyShown")},showRemoveBaggagesNag:function(){this.setBaggageRemoveNagAlreadyShown(),this.getDialogOptions(d,g),this.showNag(g?this.options.nagTranslations.baggages.removeBagsExtra:this.options.nagTranslations.baggages.removeBags,h,_.bind(this.restoreSelection,this),null)},restoreSelection:function(){this.updateBaggageSelection({newOptionCid:n,isUserAction:!1,triggerEvents:!0})},setBaggageRemoveNagAlreadyShown:function(){this.model.set("baggagesRemoveNagAlreadyShown",!0)},shouldShowRemoveBaggagesNag:function(){return!this.hasRemoveNagBeenShown()&&!this.hasContinueNagBeenShown()},hasRemoveNagBeenShown:function(){return this.model.get("baggagesRemoveNagAlreadyShown")},subscribeWidget:function(e){var t=this.model.get(e.widgetId)||{};t[e.widgetId]=e.details||{},this.model.set(e.widgetId,t[e.widgetId])},showRemoveSeatsNags:function(e){var t=this.model.get("seatmap-selection"),i=this.model.seatsSelectionInfo().seatsSelected,n=!i,a=i;n&&(t.seatsRemoveNagAlreadyShown||t.seatsContinueNagAlreadyShown)?n&&e.closeCallBack():a?(this.showNag(this.options.nagTranslations.seats.remove,{trackingLoad:"nag_seats_removal_appearances",trackingAdd:"nag_seats_removal_add",trackingContinue:"nag_seats_removal_continue"},e.keepCallBack,e.removeCallBack),t.seatsRemoveNagAlreadyShown=!0):n&&this.showNoSeatsSelectedNags(e)},showNoSeatsSelectedNags:function(e){var t=this.model.get("seatmap-selection");t.seatsRemoveNagAlreadyShown||t.seatsContinueNagAlreadyShown?e.closeCallBack():(this.showNag(this.options.nagTranslations.seats.continues,{trackingLoad:"nag_seats_close_seatmap_appearances",trackingAdd:"nag_seats_close_seatmap_add",trackingContinue:"nag_seats_close_seatmap_continue"},null,e.closeCallBack),t.seatsContinueNagAlreadyShown=!0)},showContinueSeatsNags:function(){this.model.get("seatmap-selection").seatsContinueNagAlreadyShown||(this.showNag(this.options.nagTranslations.seats.continues,{trackingLoad:"nag_seats_submit_appearances",trackingAdd:"nag_seats_submit_add",trackingContinue:"nag_seats_submit_continue"},_.bind(function(){Odigeo.trigger(this.id+":goToSeats")},this),_.bind(this.proceedToPayment,this),!1,null,!0),this.model.get("seatmap-selection").seatsContinueNagAlreadyShown=!0)},updateSeats:function(e,t){var i=this.model.get(e)||{};_.size(i)&&(i.priceData=t,this.model.set(e,i))},updateMembership:function(e){this.model.set("membership",e)},updatePrimeUserBlocked:function(e,t){this.model.set({isPrimeUserBlocked:e,primeName:t})},updateState:function(){this.model.update()},suscribeInsurancesWidget:function(e){this.model.set("insurances",e)},subscribeFlexWidget:function(e){this.model.set("flex",e)},shouldShowPrimeNag:function(){var e=this.model.get("membership");if(_.isUndefined(e))return!1;var t=this.options.tests.isMembershipPrimeNagDesktopEnabled&&"desktop"===Odigeo.SessionScope.flow,i=this.options.tests.isMembershipPrimeNagMobileEnabled&&"mobile"===Odigeo.SessionScope.flow,n=this.options.tests.isShowMembershipNagOnlyForProfitabilityAtFirst?2===e.group:_.includes([2,3],e.group);return this.options.tests.isMembershipProductSellingEnabled&&(t||i)&&this.options.tests.isMembershipDualPriceDisplay&&!e.added&&(t&&n||i&&2===e.group)&&!e.isMember&&this.noNagHasBeenShown()},shouldShowPrimeUserBlockedNag:function(){return this.model.get("isPrimeUserBlocked")&&this.options.tests.isMembershipProductSellingEnabled&&this.options.tests.isMembershipDualPriceDisplay&&this.noNagHasBeenShown()},showHotelsReminderNag:function(){Odigeo.Session.set("ipHotelReminderNagShown",!0);var e=this.options.nagTranslations.hotelsReminder.continues,t=_.extend(e,{title:e.title,subtitle:e.subtitle,icon:"../icons/spot/hotel.svg "});return this.showNag(t,{trackingLoad:"nag_hotel_upsell_appearances_"+Odigeo.Session.get("reasonIntermediate"),trackingAdd:"nag_hotel_upsell_add",trackingContinue:"nag_hotel_upsell_continue"},_.bind(function(){Odigeo.trigger(this.id+":requestXsellAccommodationResults")},this),null),!0},shootNags:function(){var e,t,i,n,a;return this.updateBaggageNagAvailability(),e=this.shouldShowContinueNag(),this.shouldShowPrimeUserBlockedNag()?a=this.showPrimeUserBlockedNag():this.shouldShowPrimeNag()?n=this.showPrimeNag():this.shouldShowContinueNag()&&this.showContinueBaggageNag(),t=!this.hasPrimeNagBeenShown()&&!this.hasPrimeUserBlockedNagBeenShown()&&e!==this.shouldShowContinueNag(),i=!(this.hasPrimeUserBlockedNagBeenShown()||this.hasPrimeNagBeenShown()||t)&&this.model.noSeatsSelected(),a||n||t||i},showContinueBaggageNag:function(){return this.shouldShowPriorityBoardingNag()?this.showPriorityBoardingNag():this.shouldShowSmartNagBaggage()?this.showSmartNagBaggage():this.shouldShowEvenUpNag()?this.showEvenUpBaggageNag():this.showDefaultBaggageContinueNag()},saveNagsStateToSession:function(){Odigeo.Session.storage.setItem("nagsState",JSON.stringify(this.model.getSessionFormat()))},exposedMethods:{updateMembership:"updateMembership",updatePrimeUserBlocked:"updatePrimeUserBlocked",checkIfFlexNagShouldBeShown:"checkIfFlexNagShouldBeShown",subscribeFlexWidget:"subscribeFlexWidget",suscribeInsurancesWidget:"suscribeInsurancesWidget",checkNoInsuranceSelection:"noInsuranceSelected",onDontWantInsuranceChecked:"removedInsuranceSelected",disableInsurancesNoSelectionNag:"model.disableInsurancesNoSelectionNag",subscribeWidget:"subscribeWidget",showRemoveSeatsNags:"showRemoveSeatsNags",showNoSeatsSelectedNags:"showNoSeatsSelectedNags",updateSeats:"updateSeats",showHotelsReminderNag:"showHotelsReminderNag",shootNags:"shootNags",checkNoInsuranceSelectionIfRejected:"checkNoInsuranceSelectionIfRejected",updateState:"updateState",saveNagsStateToSession:"saveNagsStateToSession",showBasicServiceOptionEvoNag:"showBasicServiceOptionEvoNag",setServiceOptionsEvoNagAlreadyShown:"setServiceOptionsEvoNagAlreadyShown"},showNag:function(e,t,i,n,a,s,o){var c,d=a?".nag_offer_template_container":".nag_template_container",l=_.template(this.view.$el.find(d).html(),Odigeo.Utils.getTmplSettings()),g=t.page||Odigeo.History.getPageNameFromFragment();this.view.$el.append(l({translations:e,data:s})),c=new Odigeo.UIElements.Lightbox(this.view.$el.find("#nag_container"),{closeOnOuterClick:!1,focusClass:".nag_btn_ignore"}),this.bindNagButton(c,".nag_btn_action",{action:t.trackingAdd,page:g},i,o),this.bindNagButton(c,".nag_btn_ignore",{action:t.trackingContinue,page:g},n,!1),c.toggle(!0),r.trackEvent("nags",t.trackingLoad,g,!0)},closeNag:function(){this.view.$el.find("#nag_container").removeClass("open")},bindNagButton:function(e,t,i,n,a){e.$container.on(Odigeo.Events.tap,t,_.bind(function(t){t.preventDefault(),t.stopPropagation(),r.trackEvent("nags",i.action,i.page),e.remove(),_.isFunction(n)&&n(),a&&this.enableContinueButton()},this))},showSmartNagBaggage:function(){this.setBaggageContinueNagAlreadyShown(),this.setBaggageExtendNagAlreadyShown(),Odigeo.trigger("smart-nag-baggage:showSmartNagBaggage")},showPriorityBoardingNag:function(){this.setBaggageContinueNagAlreadyShown(),this.setBaggageExtendNagAlreadyShown(),Odigeo.trigger("boarding-options:showPriorityBoardingNag")},setEvenUpNagTranslations:function(e){var t=this.getFirstSelectableBaggageData(),i=Odigeo.Utils.formatCurrency(t.price,_.extend({},Odigeo.Utils.Currency,{decimalPlaces:2}));return _.extend(e,{subtitle:0<t.kilos?Odigeo.Utils.pluralizeAll(e.subtitleWithKilos,t.piecesToShow,t.kilos,i):Odigeo.Utils.pluralizeAll(e.subtitleWithoutKilos,t.piecesToShow,i)})},showEvenUpBaggageNag:function(){var e=this.setEvenUpNagTranslations(this.options.nagTranslations.baggages.evenUpBaggage);this.setBaggageContinueNagAlreadyShown(),this.setBaggageExtendNagAlreadyShown(),this.showNag(e,{trackingLoad:"nag_baggage_xfaringextend_appearances",trackingAdd:"nag_baggage_xfaringextend_add",trackingContinue:"nag_baggage_xfaringextend_continue"},_.bind(this.evenUpBaggageSelection,this),_.bind(this.proceedToPayment,this))},showPrimeNag:function(){this.setPrimeNagAlreadyShown();var e=this.model.get("membership"),t=this.options.nagTranslations.prime.noPrimeSelected["group"+e.group],i=_.extend(t,{title:Odigeo.Utils.replaceCmsKeyArgs(t.title,this.options.nagTranslations.prime.noPrimeSelected.discount.substring(1)),subtitle:Odigeo.Utils.replaceCmsKeyArgs(t.subtitle,this.options.nagTranslations.prime.noPrimeSelected.price)}),n=["profitability","other"][e.group%2],a=this.model.get("isUserLoggedIn");return this.showNag(i,{trackingLoad:"nag_prime_appearances_"+n+"_sce:"+(a?"login-no-prime":"no-prime"),trackingAdd:"prime_mem_view_"+(a?"log-no-sub":"no-log-no-sub")+"_nag",trackingContinue:"nag_prime_continue_"+n+"_sce:"+(a?"login-no-prime":"no-prime")},_.bind(this.addPrime,this),_.bind(this.proceedToPayment,this),!1,null,!0),!0},continuePrimeUserBlockedNag:function(){Odigeo.Session.set("isPrimeBlocked",this.model.get("isPrimeUserBlocked")),this.proceedToPayment()},closePrimeUserBlockedNag:function(){this.closeNag(),this.setPrimeUserBlockedNagToShownAgain()},showPrimeUserBlockedNag:function(){this.setPrimeUserBlockedNagAlreadyShown();var e=this.model.get("primeName"),t={title:Odigeo.Utils.replaceCmsKeyArgs(this.options.nagTranslations.prime.userBlocked.title,e),subtitle:this.options.nagTranslations.prime.userBlocked.subtitle,button1:this.options.nagTranslations.prime.userBlocked.button1,button2:this.options.nagTranslations.prime.userBlocked.button2,icon:this.options.nagTranslations.prime.userBlocked.icon,usingNotBrandedIcon:!0};return this.showNag(t,{trackingLoad:"nag_prime_user_blocked_appearances",trackingAdd:"nag_prime_user_blocked_add",trackingContinue:"nag_prime_user_blocked_continue"},_.bind(this.closePrimeUserBlockedNag,this),_.bind(this.continuePrimeUserBlockedNag,this),!1,null,!0),!0},showBasicServiceOptionEvoNag:function(e){if(!this.model.get("basicServiceOptionEvoNagAlreadyShown")){this.setServiceOptionsEvoNagAlreadyShown();var t=this.options.nagTranslations.serviceOptionsEvo.basicSoSelected,i=_.extend(t,{subtitle:Odigeo.Utils.replaceCmsKeyArgs(t.subtitle,e),icon:"../icons/spot/customer_care.svg "}),n=o.getPageToTrack();return this.showNag(i,{page:n,trackingLoad:"nag_so_push_appearances",trackingAdd:"nag_so_push_add",trackingContinue:"nag_so_push_continue"},_.bind(this.addRecommendedSoEvo,this),_.bind(this.addBasicSoEvo,this)),!0}this.addBasicSoEvo()},addRecommendedSoEvo:function(){Odigeo.trigger(this.id+":addRecommendedSoEvo")},addBasicSoEvo:function(){Odigeo.trigger(this.id+":addBasicSoEvo")},setServiceOptionsEvoNagAlreadyShown:function(){this.model.set("basicServiceOptionEvoNagAlreadyShown",!0)},execute:function(e){return Odigeo.Utils.executeInternalMethods(this,this.exposedMethods,e,_.toArray(arguments).slice(1))},loginDone:function(){this.model.set("isUserLoggedIn",!0)},logoutDone:function(){this.model.set("isUserLoggedIn",!1)}})))},function(e,t,i){"use strict";e.exports={init:function(){this.options=Odigeo.Utils.parseOptions(this.options),this.view.trackOnPaxLoad()},loadData:function(e){this.model.loadData(e)},trackContinueToPayment:function(){this.view.trackContinueToPayment()},trackContinueToConfirmation:function(){this.view.trackContinueToConfirmation()}}},function(e,t,i){"use strict";var n=i(41);e.exports={selectors:{boardingOptionsMainContainer:".boarding_options_main_container",openButton:".boarding_options_open_button",termsTooltipHint:".terms_tooltip_hint"},events:{"tap @openButton":"onTapOpenButton","tap @nagBtnOption":"onNagBtnOption","tap @lightboxClose":"closeNag"},renderMainTemplate:function(){var e=this.getTemplateData();this.$cachedSelectors.boardingOptionsMainContainer.removeClass("odf-hidden").html(this.templates.boardingOptionsWidget(e)),this.updateDomSelectorsToCache(),this.loadWidgetHints()},renderPopupTemplate:function(e){var t=_.extend(this.getTemplateData(),e||{});this.$cachedSelectors.boardingOptionsPopupContainer.html(this.templates.boardingOptionsPopup(t)),this.updateDomSelectorsToCache(),this.loadPopupHints()},getCommonTemplateData:function(){var e=this.model.getFormattedCarrierCode(),t=this.model.getSelectedType().toLowerCase();return _.extend(this.model.getData(),{carrierLower:e,icon:this.getSelectedIcon(),confirmationIcon:this.getSelectedConfirmationIcon(),keys:this.keys,selectedType:t,isDefaultOptionSelected:this.model.isDefaultOptionSelected(),highlightedTypeIndex:this.model.getHighlightedTypeIndex(),keyIndex:e+"_"+t,debugInfo:this.getDebugInfo()})},getSelectedIcon:function(){return _.get(this.model.findByType(this.model.getSelectedType()),"icon")},getSelectedConfirmationIcon:function(){return _.get(this.model.findByType(this.model.getSelectedType()),"confirmationIcon")},getHintTrackingData:function(){var e=this.getTrackingData();return{type:"trackEvent",data:{action:"ryanair_widget",label:["ryanair_widget_info-",n.getSelectedTypeTrackingConstant({selectedType:e.selectedType}),"_legs:",e.totalNumber,"-",this.model.getCarrier(),":",e.carrierNumber].join("")}}},getPopupHintTrackingData:function(){var e=this.getTrackingData(),t=n.getPopupMode()?"popup":"nag";return{type:"trackEvent",data:{action:"ryanair_"+t,label:["ryanair_",t,"_info-",n.getSelectedTypeTrackingConstant({selectedType:e.selectedType}),"-none_legs:",e.totalNumber,"-",this.model.getCarrier(),":",e.carrierNumber].join("")}}},getTrackingData:function(){return _.get(this.model.getData(),"trackingData",{})},trackContinueToPayment:function(){this.trackContinue("pax")},trackOnPaxLoad:function(){this.isABEnabled()||n.trackOnPaxLoad()},trackContinueToConfirmation:function(){this.trackContinue("pay")},trackContinue:function(e){n.trackingBoardingOptionsContinue(_.extend(this.getTrackingData(),{page:e+this.getProductPageIdentifier()},this))},getProductPageIdentifier:function(){return Odigeo.Utils.isRequestApp("dp")?"dp":"fl"},getDebugInfo:function(){var e=this.model.get("collection"),t=[];return _.forEach(e,function(e){_.isNull(e.debugInfo)||t.push(e.debugInfo)}),t},getDesktopAB:function(){return _.get(Odigeo,"AB.getBoardingOptionsWidget",1)},getMobileAB:function(){return _.get(Odigeo,"AB.boardingOptionsMobile",1)},isABEnabled:function(){return"mobile"===Odigeo.SessionScope.flow?this.getMobileAB():_.includes([2,3],this.getDesktopAB())}}},function(e,t,i){"use strict";var n=i(59).getInstance(),a=new Odigeo.Enum(["BO_SB","BO_PB","BO_HB"]);e.exports={loadModel:function(e){this.set(e),this.setPriorityOptions(),this.setHighlightedType(),this.processStoredSelection(),this.widget.view.loadView()},extendOption:function(e){var t=e.type,i=this.getIcons();return _.extend(e,{type:t,name:this.getContentKey(t+"_title"),size:this.getContentKey(t+"_size"),services:this.getServices()[t],selectText:this.getContentKey(t+"_select"),selectedText:this.getContentKey(t+"_selected"),price:e.totalPrice,icon:_.get(i[t],"standard"),confirmationIcon:_.get(i[t],"confirmation")})},getCarrierSettings:function(e){return _.get(n.getCarrierSettings(),e,{})},getServices:function(){return this.getCarrierSettings("services")},getIcons:function(){return this.getCarrierSettings("icons")},getCarrierHighlightedType:function(){return this.getCarrierSettings("highlightedType")},getSortingConditions:function(){return this.getCarrierSettings("sortingConditions")},processStoredSelection:function(){var e=this.getStoredSelection();this.selectType(e||this.getDefaultType()),_.isEmpty(e)||(n.setSelectedByUser(),this.triggerUserInteraction())},getStoredSelection:function(){var e=this.getSessionSelection();return _.isEmpty(e)?this.getSelectionInCart():e},getSelectionInCart:function(){return _.get(this.get("selection")||[],"[0].type")},getSessionSelection:function(){return _.get(Odigeo.Utils.parseJson(Odigeo.Session.get("boardingOptionSelection")),this.getBookingId())},getBookingId:function(){return _.get(this.widget,"options.bookingId")},setPriorityOptions:function(){var e=_.mapValues(this.get("collection"),function(e){return this.extendOptionInfo(e)},this);this.set("options",e)},getHighlightedText:function(e,t){return t&&e===a.BO_PB?this.getContentKey("most_popular"):this.getContentKey("recommended")},getPriorityOptions:function(){var e=this.getHighlightedType();return _.mapValues(this.getValidOptions(),function(t){var i=t.type,n=e===i;return _.extend(this.extendOptionInfo(t),{isSelected:this.isSelected(i),isHighlighted:n,highlightedText:this.getHighlightedText(i,n)})},this)},transformArrayToObject:function(e){return _.transform(e,function(e,t){e[t.type]=t})},getPriorityOptionsObject:function(){return this.transformArrayToObject(this.getPriorityOptions())},getValidOptions:function(){return _.union(this.getFilteredOptions(),this.getAllMissingOptions())},getFilteredOptions:function(){return _.filter(this.get("options"),function(e){return!_.isEmpty(a[e.type])},this)},getAllMissingOptions:function(){var e=this.transformArrayToObject(this.get("options"));return _.map(_.filter(a,function(t){return!_.has(e,t)}),function(e){return{type:e,available:!1}})},getAvailableOptions:function(){return _.sortBy(this.getPriorityOptions(),function(e){return _.findKey(this.getSortingConditions(),function(t){return _.every(t,function(t,i){return e[i]===t})})},this)},isSelected:function(e){return this.getSelectedType()===e},setHighlightedType:function(){var e=this.getPriorityOptionsObject(),t=_.findKey(this.getCarrierHighlightedType(),function(t){return _.every(t,function(t){return _.get(e,[t.type,"available"])===t.available})});this.set("highlightedType",t)},getHighlightedType:function(){return this.get("highlightedType")},getHighlightedTypeIndex:function(){var e=this.getHighlightedType(),t=_.findIndex(this.getAvailableOptions(),function(t){return t.type===e});return 0<=t?t+1:""},isDefaultOptionSelected:function(){return this.getSelectedType()===this.getDefaultType()},selectType:function(e,t){this.set("selectedType",e),this.set("availableOptions",this.getAvailableOptions()),t&&this.storeSelectionInSession(e),this.triggerOptionChanged(e)},triggerOptionChanged:function(e){Odigeo.trigger(this.widget.id+":onBoardingOptionSelected",this.getTriggerData(e))},storeSelectionInSession:function(e){var t=_.set({},this.getBookingId(),e);Odigeo.Session.set("boardingOptionSelection",JSON.stringify(t))},getSelectedType:function(){return this.get("selectedType")||this.getDefaultType()||""},getDefaultType:function(){return this.get("defaultType")},getCarrierCode:function(){return this.get("carrierCode")||"default"},getFormattedCarrierCode:function(){return this.getCarrierCode().toLowerCase().replace(/\./g,"_")},getCarrierList:function(){return this.get("carriers")||[]},findByType:function(e){return _.find(this.getAvailableOptions(),function(t){return t.type===e})||{}},getPrice:function(e){return this.findByType(e).totalPrice},getFee:function(e){return this.findByType(e).fee},getTrackingData:function(){return n.getTrackData()},getCarrier:function(){return n.getCarrier()},getTriggerData:function(e){return{selectedType:e,carrierCode:this.getCarrierCode(),carrier:this.getCarrierCode(),carrierList:this.getCarrierList(),showWarning:this.getSelectedType()===this.getDefaultType(),text:this.getContentKey(e+"_included"),hint:this.getContentKey("hint"),hint_title:this.getContentKey("hint_title"),price:this.getPrice(e),isDefaultOptionSelected:this.isDefaultOptionSelected(),flightDetailsDTO:this.get("flightDetailsDTO"),tripType:this.get("tripType"),fee:this.getFee(e),trackingData:this.getTrackingData()}},triggerUserInteraction:function(){Odigeo.trigger(this.widget.id+":onBoardingOptionInteracted")}}},function(e,t,i){"use strict";var n=i(10);e.exports=n({viewClass:i(786),methods:{open:function(){this.open()}}})},function(e,t,i){"use strict";var n=i(175).getMemberDiscountParams,a=i(27),s="isoDate";e.exports=function(e,t){return Odigeo.AB.isExpediaLinksAndWidget?(c=t,g=o=e,h="",h+=Odigeo.Utils.formatDate(g.flights.arrival.getArrivalDate(),s)+"-",h+=Odigeo.Utils.formatDate(g.flights.departure.getDepartureDate(),s)+"-",h+=g.trip.getNumberOfPassengers()+"-",h+=g.flights.arrival.getOriginAirpotIata()+"-",d=h+=Odigeo.Utils.formatDate(new Date,s),l=Odigeo.Utils.replaceCmsKeyArgs(c.url,o.flights.arrival.getDestinationAirportIata(),c.expediaParams.id,Odigeo.Utils.formatDate(o.flights.arrival.getArrivalDate(),"yyyy-mm-dd",!0),Odigeo.Utils.formatDate(o.flights.departure.getDepartureDate(),"yyyy-mm-dd",!0),App.Flights.getRoomsParams(o.trip.getPassengers()),o.trip.getCurrencyCode(),o.trip.getNumberOfPassengers(),Odigeo.Utils.formatDate(o.flights.arrival.getArrivalDate(),"yyyy-mm-dd",!0),Odigeo.Utils.formatDate(o.flights.departure.getDepartureDate(),"yyyy-mm-dd",!0),o.flights.departure.getDestinationAirportIata(),Odigeo.Utils.formatDate(new Date,s),a.getToken(d,c.expediaParams.key)),l+=n()):(i=e,r=t,Odigeo.Utils.replaceCmsKeyArgs(r.url,i.flights.arrival.getDestinationAirportIata(),Odigeo.Utils.formatDate(i.flights.arrival.getArrivalDate(),"dd",!0),Odigeo.Utils.formatDate(i.flights.arrival.getArrivalDate(),"yyyy-mm",!0),Odigeo.Utils.formatDate(i.flights.departure.getDepartureDate(),"dd",!0),Odigeo.Utils.formatDate(i.flights.departure.getDepartureDate(),"yyyy-mm",!0)));var i,r,o,c,d,l,g,h}},function(e,t,i){"use strict";var n=i(148),a=i(0),s="desktop"===Odigeo.SessionScope.flow?"seatmap-desktop":"post-booking-seatmap",r="desktop"===Odigeo.SessionScope.flow?"seatmap_desktop":"seatmap",o=Odigeo.autoloadWidgetsAsync({getAircraftMap:["post-booking-aircraftmap","aircraftmap"],getAircraftMapDesktop:["aircraft-desktop","aircraftmap_manager"],getBags:["post-booking-bags","post_booking_bags"],getSeats:["post-booking-seats","post_booking_seats"],getBinDetectionSeats:["post-booking-bin-detection-seats","post_booking_bin_detection"],getBinDetectionBags:["post-booking-bin-detection-bags","post_booking_bin_detection"],getPaymentSeats:["post-booking-payment-seats","payment"],getPaymentBags:["post-booking-payment-bags","payment"],getSeatMap:[s,r]}),c=_.noop(),d=_.noop();e.exports={viewEvents:{"aircraftmap:closeAircraftMap":"onCloseAircraftMap","aircraftmap:moveToOtherSection":"onMoveToOtherSection","aircraftmap:hideErrors":"onSeatmapHideErrors","aircraftmap:showErrors":"onSeatmapShowErrors","aircraftmap_manager:updateSeatSelectionFees":"onUpdateSeatSelectionFees","aircraftmap_manager:tapNavigateButton":"onTapAircraftMapNavigateButton","aircraftmap_manager:closeAircraftMap":"onCloseAircraftMapDesktop","seatmap-desktop:openAircraftMap":"onOpenAircraftMapDesktop","seatmap-desktop:checkPassengerCollectionPopulated":"onCheckPassengerCollectionPopulated","seatmap-desktop:moveToShoppingPhase":"onMoveToShoppingPhaseSeatMap","my-trips:openAddBags":"onOpenAddBags","my-trips:openAddSeats":"onOpenAddSeats","post-booking-bags:closeAddBags":"onCloseAddBags","post-booking-bags:noBagsAvailable":"onOpenAddBagsFailure","post-booking-bags:purchaseOk":"onPurchaseOk","post-booking-bags:purchasePaymentError":"onPurchasePaymentError","post-booking-bags:purchaseError":"onPurchaseError","post-booking-seats:closeAddSeats":"onCloseAddSeats","post-booking-seats:closeAircraftMap":"onCloseAircraftMapDesktop","post-booking-seats:noSeatsAvailable":"onOpenAddSeatsFailure","post-booking-seats:purchaseOk":"onPurchaseOk","post-booking-seats:purchasePaymentError":"onPurchasePaymentError","post-booking-seats:purchaseError":"onPurchaseError","post-booking-bin-detection-seats:creditCardTypeCodeChanged":"onCreditCardTypeCodeChanged","post-booking-bin-detection-bags:creditCardTypeCodeChanged":"onCreditCardTypeCodeChanged","post-booking-payment-seats:cardDataChanged":"onCardDataChanged","post-booking-payment-bags:cardDataChanged":"onCardDataChanged","post-booking-seatmap:openAircraftMap":"onOpenAircraftMap","trip-details:openAddBags":"onOpenAddBags","trip-details:openAddSeats":"onOpenAddSeats","users-manager:getBagsOk":"onBagsLoaded","users-manager:getBagsError":"onOpenAddBagsFailure","users-manager:getBagsWithError":"onOpenAddBagsFailure","users-manager:getSeatsOk":"onSeatsLoaded","users-manager:getSeatsError":"onOpenAddSeatsFailure","users-manager:getSeatsWithError":"onOpenAddSeatsFailure"},eventHandlers:{onBagsLoaded:function(e){o.getBags().execute("checkAvailableBags",e)},onSeatsLoaded:function(e){o.getSeats().execute("checkAvailableSeats",e)},onOpenAddBags:function(e,t,i){var a=e.bookingBasicInfo.id,s=n.getCollectionMethods(t),r=n.getCreditCardTypeCodes(s);c(),o.getPaymentBags().execute("setPaymentOptions",a,s,r),o.getBags().execute("showAddBags",e,t,i)},onOpenAddBagsFailure:function(){c(),a.trackEventWithCategory("post_booking","baggage_offline_no-available","baggage_offline_no-available_appearances"),o.getBags().execute("showFailure")},onOpenAddSeats:function(e,t,i){var a=e.bookingBasicInfo.id,s=n.getCollectionMethods(t),r=n.getCreditCardTypeCodes(s);c(),o.getPaymentSeats().execute("setPaymentOptions",a,s,r),o.getSeats().execute("showAddSeats",e,t,i),o.getSeatMap().execute("loadFromParameters",e,t)},onMoveToShoppingPhaseSeatMap:function(){o.getSeats().execute("changePhase","SHOPPING"),o.getAircraftMap().execute("onCloseAircraftMap")},onOpenAddSeatsFailure:function(){c(),a.trackEventWithCategory("post_booking","seats_offline_no-available","seats_offline_no-available_appearances"),o.getSeats().execute("showFailure")},onCardDataChanged:function(e,t){o.getBags().execute("setCardData",e,t),o.getSeats().execute("setCardData",e,t)},onCreditCardTypeCodeChanged:function(e,t){o.getPaymentSeats().execute("setCreditCardTypeCode",e),o.getPaymentBags().execute("setCreditCardTypeCode",e),o.getBags().execute("setCreditCardTypeCode",e,t),o.getSeats().execute("setCreditCardTypeCode",e,t)},onPurchaseOk:function(e){"bags"===e?o.getBags().execute("showSuccess"):"seats"===e&&o.getSeats().execute("showSuccess")},onPurchasePaymentError:function(e){"bags"===e?o.getBags().execute("showPaymentFailure"):"seats"===e&&o.getSeats().execute("showPaymentFailure")},onPurchaseError:function(e){"bags"===e?o.getBags().execute("showFailure"):"seats"===e&&o.getSeats().execute("showFailure")},onCloseAddBags:function(){d(),o.getBags().execute("close")},onCloseAddSeats:function(){d(),o.getSeats().execute("close")},onOpenAircraftMap:function(e,t){o.getAircraftMap().execute("onOpenAircraftMap",e,t)},onOpenAircraftMapDesktop:function(e,t){o.getAircraftMapDesktop().execute("onOpenAircraftMap",e,t)},onCheckPassengerCollectionPopulated:function(){o.getAircraftMapDesktop().execute("checkPassengerCollectionPopulated")},onCloseAircraftMap:function(){o.getSeatMap().execute("onHideErrors"),o.getAircraftMap().execute("onCloseAircraftMap")},closeAircraft:function(){o.getAircraftMap().execute("onCloseAircraftMap")},onMoveToOtherSection:function(e){o.getSeatMap().execute("onMoveThroughOpenAircraftMap",e)},onSeatmapShowErrors:function(){o.getSeatMap().execute("onShowErrors")},onUpdateSeatSelectionFees:function(){o.getSeatMap().execute("updateSeatSelectionFees")},onTapAircraftMapNavigateButton:function(e,t,i){o.getSeatMap().execute("onTapNavigateButton",e,t,i)},onCloseAircraftMapDesktop:function(){o.getSeatMap().execute("onCloseAircraftMap"),o.getSeats().execute("scrollTop")},onSeatmapHideErrors:function(){o.getSeatMap().execute("onHideErrors")}},init:function(e,t){c=function(){e.addClass(t),Odigeo.Device.getViewport().addClass("od-viewport-no-vertical-scroll")},d=function(){e.removeClass(t),Odigeo.Device.getViewport().removeClass("od-viewport-no-vertical-scroll")},o.getBinDetectionSeats(),o.getBinDetectionBags()}}},function(e,t,i){"use strict";var n=i(139).getRememberMeCookieField,a=Odigeo.autoloadWidgetsAsync({getUsersManager:["users-manager","usersmanager"],getPostBookingBags:["post-booking-bags","post_booking_bags"],getOpenMyTrips:["openmytrips","my_trips"]}),s=function(e,t){return _.findIndex(e,function(e){return e.bookingBasicInfo.id===t})},r=function(e,t){var i=e.email;return _.isEmpty(i)||i===n("email")?_.isEmpty(i)||t<0?"TRC_003":void 0:"TRC_004"};e.exports={extractTokenFromDeeplink:function(e){try{var t=atob(e);t=JSON.parse('{"'+decodeURI(t).replace(/"/g,'\\"').replace(/&/g,'","').replace(/=/g,'":"')+'"}'),(_.isUndefined(t.email)||_.isUndefined(t.bookingid)||!Odigeo.Utils.isValidEmail(t.email))&&(t="")}catch(e){t=""}return t},requestMyTrips:function(){a.getUsersManager().execute("submitUserRequest",{data:"",action:"getMyTrips"})},requestTrip:function(e){var t={queryParams:{email:e.email,bookingid:e.bookingid}};a.getUsersManager().execute("submitUserRequest",{data:t,action:"getTrip"})},requestEncriptedTrip:function(e){var t={queryParams:{td:e}};a.getUsersManager().execute("submitUserRequest",{data:t,action:"getEncryptedTrip"})},findBooking:s,retrieveBookingInfoFromToken:function(e,t,i){var n,a,o;if(_.isEmpty(e)){if(!_.isEmpty(t)){var c=this.extractTokenFromDeeplink(t);n=_.parseInt(c.bookingid,10),o=s(i.userDTO.bookingDetail,n),a=r(c,o)}}else n=_.parseInt(e,10);return{bookingID:a?null:n,bookingDetailIndex:o,error:a}},navigateToBooking:function(e,t){var i=e.bookingDetailsIndex||s(t.userDTO.bookingDetail,e.bookingID);if(i<0)Odigeo.Utils.goToApplicationHome();else{var n=i.toString();Odigeo.Router.navigate("mytrips",{params:n})}}}},function(e,t,i){"use strict";var n=i(10);e.exports=n({viewClass:i(852),methods:{renderTemplate:function(e){this.renderTemplate(e)},emptyFindBookings:function(){this.emptyFindBookings()}}})},function(e,t,i){"use strict";var n=!1;function a(e){n=e}Odigeo.defineWidget("accommodation_details",Odigeo.Widget.extend({modelClass:i(85).AccommodationDetailsModel,viewClass:i(594),isInProcess:_.constant(n),execute:function(e){var t=_.rest(arguments);switch(e){case"process":return function(e,t,i){var s,r,o,c,d,l=null;return n||(c=e,d=i,a(!0),c.defaultTab=d.panel||null,e.updateTarget(i),!i.isLightbox&&i.toggle&&e.isOpen()?(e.close(),a(!1)):l=(s=e,r=t,o=i,s.update(o),r.update(o)).always(_.partial(a,!1))),_.isNull(l)?$.Deferred().resolve():l.promise()}(this.view,this.model,_.first(t));case"closeDetails":return this.view.close.apply(this.view,t);case"getRoomContainer":return this.view.getRoomContainer();case"setRoomSelectionTestPartition":return this.view.setRoomSelectionTestPartition(t[0]);case"clear":return this.model.clear()}return this}}))},function(e,t,i){"use strict";var n=i(0),a=i(330),s=i(172),r={slider:5e3,bgd_in:300,bgd_out:100};function o(){return Odigeo.UIElements.hint.hidePageHints(Odigeo.History.getPageNameFromFragment()),this}function c(e){return this.$el.toggleClass("open",e).closest(".accommodation_details_super_container").toggleClass("details-opened",e),Odigeo.trigger(m.call(this,"setPreselectedDetailsStatus"),{hasOpen:e,$boxDetail:this.$el}),this.settings.isLightbox&&this.lightBox.toggle(!0),this}function d(e){if(this.handlerUi){var t=this.handlerUi.getPanel(e||this.defaultTab);Odigeo.trigger(m.call(this,"panelOpen"),t),function(e){return-1<e.indexOf("map")?(function(){/_preselected_details_container$/.test(this.settings.target)&&Odigeo.trigger(m.call(this,"closeGeneralMap"))}.call(this),function(){var e=this.model.getCoordinates(),t=this.$cachedSelectors.map.get(0);this.uiMap.hasMapElement(t)?this.uiMap.refreshMap():this.uiMap.update({latitude:e.latitude,longitude:e.longitude,mapView:t}).then(_.bind(this.uiMap.refreshMap,this.uiMap))}.call(this)):h.call(this),this}.call(this,t)}}function l(){return Odigeo.UIElements.fade.unbind(this.$cachedSelectors.fadeSliderImage),this.$cachedSelectors.thumbnail.off("error load"),this.$cachedSelectors.sliderImage.off("error load"),this.$cachedSelectors.hoverImgElement.off("error load"),this}function g(e){var t=this.$cachedSelectors.fullscreenSliderImage,i=$.fx.muted?{}:r,n="url("+this.model.getImage(e).url+")";t.removeClass("loaded").delay(i.bgd_out).queue(function(){t.attr("data-img-index",e).data("imgIndex",e).css("background-image",n).dequeue()}).delay(i.bgd_in).queue(function(){t.addClass("loaded").dequeue()})}function h(){return _.isNull(this.intervalReference)||clearInterval(this.intervalReference),this}function u(){return this.setTemplate(this.$el,"loading"),this.open({silent:!0}),this}function p(){if(l.call(this),!this.model.getImagesLength()&&(0!==this.$cachedSelectors.tabGallery.length&&(this.$cachedSelectors.gallery.addClass("odf-hidden"),this.$cachedSelectors.tabGallery.remove()),"gallery"===this.settings.panel)){var e=b.call(this);d.call(this,e),function(e){this.handlerUi&&(this.handlerUi.setActiveTab(e),this.handlerUi.togglePanelWithName(e))}.call(this,b.call(this),e)}return this}function f(e){switch(e.status){case 200:"mobile"===Odigeo.SessionScope.flow?Odigeo.trigger("sessionExpiredError:open","alert",!0):Odigeo.UIElements.showSessionExpiredError("alert",!0);break;default:Odigeo.UIElements.showBrokenFlowError("alert",!0)}this.close()}function m(e){return this.widget.id+":"+e}function b(){return this.$cachedSelectors.tabs.not('[data-panel="gallery"]').first().data("panel")}e.exports=Odigeo.View.extend({events:{tap:"onTapInElement","change .accommodation_show_hotelpopup":"onChangeTab","tap .accommodation_close_hotelpopup":"close","tap .gallery_thumbnail":"trackEventImage","tap .fullscreen_slider_image":"trackEventImage","tap .fullscreen_gallery_thumbnail:not(.selected)":"toggleSliderImage","tap .gallery_arrow":"toggleSliderImageFromArrow"},selectors:{tabPanels:".tab_panel",tabs:".accommodation_show_hotelpopup",tabGallery:'.accommodation_show_hotelpopup[data-panel="gallery"]',map:".panel_map",gallery:".panel_gallery",hoverImg:".gallery_hover_img",hoverImgElement:".gallery_hover_img img",thumbnail:".gallery_thumbnail",sliderImage:".slider_image",fullscreenSliderImage:".fullscreen_slider_image",fadeSliderImage:".fade_slider_image",fullScreenGallery:".gallery_wrapper",panelSelector:".panel_container_accommodation_details",accommodationTabs:".accommodation_details_tabs",cancellationPoliciesPopups:".cancellation_policy_info"},defaults:{panel:null,target:null,key:null},templates:{},settings:{},sliderIndex:0,intervalReference:null,roomSelectionTestPartition:null,handlerUi:null,defaultTab:null,enhanceMap:null,lightbox:null,init:function(){(function(){Odigeo.Device.navigator.isTouchable()&&(this.events["touchstart .gallery_thumbnail"]=this.events["mouseenter .gallery_thumbnail"],this.events["touchend .gallery_thumbnail"]=this.events["mouseout .gallery_thumbnail"],delete this.events["mouseenter .gallery_thumbnail"],delete this.events["mouseout .gallery_thumbnail"])}).call(this),this.options=Odigeo.Utils.parseOptions(this.widget.options),this.trackEvent=_.bind(n.trackEvent,n,this.options.trackingAction),this.setElement(),this.uiMap=new a({hasAvuxiHeatMap:this.options.hasAvuxiHeatMap,grafanaKeyAvuxiError:this.options.grafanaKeyAvuxiError,hasIconMarkerBrand:this.options.hasIconMarkerBrand,draggable:this.options.isDraggable,disableDoubleClickZoom:this.options.isDisabledDoubleClickZoom}),function(){return Odigeo.on("ui-hint:show",_.bind(this.close,this)),this.listenTo(this.model,"loadDetails",this.refresh),this.listenTo(this.model,"failLoad",_.bind(f,this)),this.listenTo(this.model,"fetchDetails",_.bind(u,this)),this.listenTo(this.model,"remove:img",_.bind(p,this)),this.listenTo(Odigeo.Events.fake,"fake:blur",function(){this.isOpen()&&!this.widget.isInProcess()&&this.close()}),this}.call(this)},beforeInsertTemplate:function(){return _.extend(s.getAccommodationDetailsData(this.model,{roomSelectionTestPartition:this.roomSelectionTestPartition,isLightbox:this.settings.isLightbox}),{images:this.model.getImages(),sliderIndex:this.sliderIndex})},render:function(){return _.isElement(this.el)&&this.setTemplate(this.$el,this.options.mainDetailsTemplate),this},update:function(e){return this.settings=_.defaults({},e,this.defaults),l.call(this),this.setElement($("#"+this.settings.target)),"map_details_container"===this.settings.target&&this.$el.data("nights",e.nights),this},updateTarget:function(e){this.isCurrentTarget(e.target)||(this.close(),this.createLightBox(e))},postRender:function(){if(_.isElement(this.el)){var e={allowEmptySelection:!1,panelSelector:this.el,defaultTab:this.defaultTab};this.handlerUi=Odigeo.UIElements.enhanceTabs(this.selectors.accommodationTabs,e),this.updateDomSelectorsToCache(),p.call(this),function(){var e=this.model.getImagesLength(),t=[],i=_.bind(function(){0==--e&&(this.model.deleteImgs(t),g.call(this,this.sliderIndex))},this);return this.$cachedSelectors.thumbnail.on("error load",function(e){"error"===e.type&&t.push(parseInt($(e.target).data("imgIndex"),10)),i()}),this}.call(this),this.open({silent:!1}),d.call(this),function(e){(function(e){this.model.get("hasRoomSelection")&&Odigeo.trigger(m.call(this,"loadRoomSelection"),e)}).call(this,e)}.call(this,this.model.get("key"))}},onTapInElement:function(e){return e.stopPropagation(),o.call(this),this},onChangeTab:function(e){var t=$(e.currentTarget);this.trackEvent(t.data("label")),d.call(this,t.data("panel")),Odigeo.trigger(m.call(this,"toggleLinkDetailsStatus"),t.data("panel")),e.stopPropagation()},trackEventImage:function(e){this.trackEvent($(e.target).data("imgTracking"))},setRoomSelectionTestPartition:function(e){this.roomSelectionTestPartition=e},open:function(e){return c.call(this,!0),o.call(this),_.isObject(e)&&!e.silent&&Odigeo.trigger(m.call(this,"open"),this.settings,this.getElementTop()),this},hasToClose:function(e){return _.isUndefined(e)||_.isUndefined(e.element)||"true"===$(e.element).attr("data-has-to-close-container")},close:function(){return!this.settings.isLightbox&&this.hasToClose.apply(this,arguments)&&(function(){this.handlerUi&&this.handlerUi.setActivePanelIndex()}.call(this),Odigeo.trigger(m.call(this,"toggleLinkDetailsStatus")),function(){return this.$cachedSelectors.cancellationPoliciesPopups.removeClass("open").addClass("odf-hidden"),this}.call(this),c.call(this,!1),h.call(this),function(e){_.isObject(e)&&!_.isUndefined(e.originalEvent)&&this.trackEvent("close_hotel_information")}.apply(this,arguments),function(e){_.isObject(e)&&e.page===Odigeo.History.getPageNameFromFragment()&&Odigeo.trigger(m.call(this,"closeHints"))}.apply(this,arguments),Odigeo.trigger(m.call(this,"hidePanels"))),this},isOpen:function(){return this.$el.hasClass("open")},isCurrentTarget:function(e){return this.settings.target===e},getElementTop:function(){return this.$el.offset().top-Odigeo.Device.getScreenHeight()/2},getRoomContainer:function(){return this.$el.find(".panel_roomInfo")},createLightBox:function(e){e.isLightbox&&(this.lightBox=new Odigeo.UIElements.Lightbox($("#"+e.page+"_accommodation_details_lightbox")))},toggleSliderImage:function(e){var t=$(e.target);this.updateSliderImage(t)},updateSliderImage:function(e){this.$cachedSelectors.thumbnail.removeClass("selected").filter(e).addClass("selected"),g.call(this,e.data("imgIndex"))},toggleSliderImageFromArrow:function(e){var t=$(e.target),i=t.hasClass("next")?1:-1,n=this.$el.find(this.selectors.thumbnail+".selected"),a=parseInt(n.data("imgIndex"),10)+i,s=a<0?this.model.getImagesLength()-1:a,r=a>=this.model.getImagesLength()?0:s,o=this.$el.find(this.selectors.thumbnail+"[data-img-index="+r+"]");this.trackEvent(t.data("arrowTracking")),this.updateSliderImage(o)},updateDomSelectorsToCache:function(){_.each(this.selectors,function(e,t){this.removeSelectorFromCache(t),this.addSelectorToCache(t,this.$el.find(e))},this)}})},function(e,t,i){"use strict";var n=i(0);Odigeo.defineWidget("error_message_layer",Odigeo.Widget.extend({modelClass:Odigeo.Model.extend({defaults:{error:null}}),viewClass:Odigeo.View.extend({events:{"tap .dialog_close_hint_icon":"closeWindow","tap .try_again":"tryAgain","tap .pay_transfer":"payTransfer"},selectors:{errorContainer:".errormessage_container",errorTitle:".error_title",errorSubtitle:".error_subtitle"},init:function(){this.$cachedSelectors.paymentManager=$("#payment-manager")},trackMessageLayer:function(e){var t=this.widget.options.isDynpack?"dynpack_pay_page":"flights_pay_page",i="pay_error_popup_"+this.model.get("error")+"_"+e;n.trackEventWithCategory(t,"payment_error_popup",i)},closeWindow:function(){this.$cachedSelectors.errorContainer.addClass("odf-hidden"),this.trackMessageLayer("close")},tryAgain:function(){this.$cachedSelectors.errorContainer.addClass("odf-hidden"),Odigeo.Utils.scrollToElement(this.$cachedSelectors.paymentManager),this.trackMessageLayer("try_again")},setErrorMessages:function(e){var t=this.widget.options.translations.errorType[e];this.$cachedSelectors.errorTitle.html(t.errorTitle),this.$cachedSelectors.errorSubtitle.html(t.errorSubtitle)}}),manageError:function(e){_.startsWith(e,"COLLECTION_")&&(this.model.set("error",e),this.view.setErrorMessages(e),this.view.$cachedSelectors.errorContainer.removeClass("odf-hidden"),this.view.trackMessageLayer("loaded"))}}))},,,,function(e,t,i){"use strict";Odigeo.defineWidget("offline_sales_banner",Odigeo.Widget.extend({viewClass:Odigeo.View.extend({pages:["details","payment","results","xsellproductselection","dpresults","roomselection"],slctrs:{template:".offline-sales-banner-template",wrapper:".offline-sales-banner-wrapper"},init:function(){this.opts=Odigeo.Utils.parseOptions(this.widget.options),this.bindEvents(),this.update()},bindEvents:function(){Odigeo.bind("routeChange",_.bind(this.update,this))},update:function(){this.renderize(""),this.setTemplate()},renderize:function(e){this.$el.find(this.slctrs.wrapper).html(e)},setTemplate:function(){var e=Odigeo.Utils.getFunnelInGlobalScope(),t=Odigeo.History.getPageNameFromFragment(),i=_.isEmpty(t)?"home":t,n=_.template(this.$el.find(this.slctrs.template).html(),Odigeo.Utils.getTmplSettings());"home"!==this.opts.tmpl&&_.includes(this.pages,i)&&"true"===this.opts.translations.page[e][i].active&&!Odigeo.SessionScope.isBookingXSWhiteLabel?this.renderize(n({title:this.opts.translations.title,charge:this.opts.translations.charge,hours:this.opts.translations.hours,phone:this.opts.translations.page[e][i].phone,status:this.opts.translations.status})):i===this.opts.tmpl&&"true"===this.opts.translations.active&&this.renderize(n({title:this.opts.translations.title,charge:this.opts.translations.charge,hours:this.opts.translations.hours,phone:this.opts.translations.phone}))}})}))},function(e,t,i){"use strict";var n=i(0);Odigeo.defineWidget("country_links",Odigeo.Widget.extend({modelClass:Odigeo.Model.extend({defaults:{continentItems:[]},isEmptyData:!1,url:Odigeo.Settings.getProperty("countryLinksServiceUrlFormatter"),getDataRequestSettings:function(){return{success:_.bind(function(e){this.addLanguage(e),this.set(e)},this)}},addLanguage:function(e){e.language=2<e.websiteId.length?e.websiteId.substring(2,4):e.websiteId}}),viewClass:Odigeo.View.extend({selectors:{headerLauncher:".header_launcher",closeButton:".header_tooltip_close",countryLink:".country_link",internationalLink:".international_site_link",continentHeader:".continent_header",continentContent:".continent_content"},events:{"tap @countryLink":"onCountryLinkClick","tap @internationalLink":"onInternationalLinkClick","tap @closeButton":"onClose","tap @continentHeader":"onAccordion","tap @headerLauncher":"onOpen"},init:function(){this.listenTo(this.widget.model,"change",this.render)},render:function(){this.setTemplate(this.$el,"countryLinks",this.model.toJSON()),this.addDomSelectorsToCache()},onOpen:function(e){e.stopPropagation(),Odigeo.UIElements.hint.hideAllHints(),this.$cachedSelectors.headerLauncher.toggleClass("opened"),this.$el.find(".continent_header.unfolded").trigger(Odigeo.Events.tap)},onAccordion:function(e){var t,i,n,a=this.$cachedSelectors.continentHeader,s=this.$cachedSelectors.continentContent,r=$(e.target);a.removeClass("unfolded"),s.height(0),r.closest(".continent_header").addClass("unfolded"),i=(n=(t=a.filter(".unfolded").find(" + .continent_content")).find(".continent_countries")).height(),t.height(0<i?i:$(n.find("li")[0]).height())},onClose:function(){this.$cachedSelectors.headerLauncher.removeClass("opened")},onCountryLinkClick:function(e){var t=$(e.target).data("countryLabel");n.trackEvent("header","language_"+t,Odigeo.History.getPageNameFromFragment())},onInternationalLinkClick:function(){n.trackEvent("header","language_international",Odigeo.History.getPageNameFromFragment())},beforeInsertTemplate:function(e){var t=e||this.model.toJSON();return t.continentItems=_.chain(t.continentItems).filter("visibility").each(function(e){var t,i;e.className=e.defaultContinent?"unfolded":"",e.countryDTOs=_.chain(e.countryDTOs).filter("visibility").each(function(t,i){t.hasLanguages=!!t.countryDTOs.length,t.className=t.hasLanguages?" od-country-with-languages":"",t.className+=i>=e.indexLastLine?" od-country-last-row":""}).value(),i=(t=e.countryDTOs.length)%3||3,e.indexLastLine=t-i}).value(),_.last(t.continentItems).className+=" od-header-last-continent",{model:t,cms:this.keys||{}}}})}))},function(e,t,i){"use strict";var n=Odigeo.Widget.extend({modelClass:i(602),viewClass:i(603),init:function(){this.options=Odigeo.Utils.parseOptions(this.options)},updatePage:function(e){this.model.updateDataSource(e),this.view.reload()},onSeatmapChange:function(e){this.model.setSeatMapFromCollection(e)},updateConcept:function(e){_.get(e,"isSetup",!1)||this.model.updateItem(e)}});Odigeo.defineWidget("service_summary",n)},function(e,t,i){"use strict";var n,a;e.exports=(n=i(43),a=new Odigeo.Enum(["SERVICE_OPTIONS_MAP","ANCILLARIES_MAP"]),Odigeo.Model.extend({defaults:{page:"",price:-1,seatmap:{},paxNameList:[],baggagesInsuranceAdded:!1,serviceOptionSelected:{},ancillariesSelected:{},isSinglePremiumPassengerSelected:!1},updateDataSource:function(e){return{details:function(){this.set({page:e})},payment:function(){var t=Odigeo.Utils.parseJson(Odigeo.Session.storage.getItem("booking_pax_list"))||{},i=_.pluck(t,"name"),n=this.getSeatmapFromSession(),a=Odigeo.Utils.parseJson(Odigeo.Session.get("isPremiumPassengerSelected")),s=Odigeo.Utils.parseJson(Odigeo.Session.get("baggagesInsuranceAdded"));i=_.map(t,function(e){return{fullName:e.name+" "+e.firstLastName}}),this.set({page:e,seatmap:n,paxNameList:i,isSinglePremiumPassengerSelected:a,baggagesInsuranceAdded:s})}}[e].apply(this,arguments)},getSeatmapFromSession:function(){return{quantity:this.getSeatPreferenceSelection().length}},setSeatMapFromCollection:function(e){this.set({seatmap:{quantity:e.getSelectedSeatsLength()}})},getSeatPreferenceSelection:function(){return Odigeo.Utils.parseJson(Odigeo.Session.storage.getItem("seatPreferenceSelection"))||[]},isAnySelectedInMap:function(e){var t=this.get(e);return _.some(t,{added:!0})},isAnyServiceOptionsAdded:function(){return this.isAnySelectedInMap(a.SERVICE_OPTIONS_MAP)},isAnyAncillariesAdded:function(){return this.isAnySelectedInMap(a.ANCILLARIES_MAP)},hasSeats:function(){var e=this.get("seatmap");return _.gt(e.quantity,0)},updateItem:function(e){var t=_.get(e,"type")===n.SERVICE_OPTIONS?a.SERVICE_OPTIONS_MAP:a.ANCILLARIES_MAP;this.setItem(t,e),this.trigger(this.getAncillaryToggleEvent(),e)},setItem:function(e,t){var i=this.get(e)||{},n={};n[_.get(t,"id")]=t,_.merge(i,n),this.set(e,i)},loadCartAncillaries:function(e){_.each(e,function(e){if(_.get(e,"preselected")){var t=this.getAncillaryData(e);this.updateItem(t)}},this)},getAncillaryData:function(e){var t=_.get(e,"preselected",!1);return _.extend(_.pick(e,"id","name"),{added:t,type:n.CANX_INSURANCE})},getAncillaryToggleEvent:function(){return"onAncillaryToggled"}}))},function(e,t,i){"use strict";var n,a;e.exports=(n=i(43),a=i(14),Odigeo.View.extend({templateSettings:Odigeo.Utils.getTmplSettings({variable:""}),insuranceCatalogueCollection:null,selectors:{serviceWrapper:".service_summary_wrapper",seatmapWrapper:".seatmap_wrapper",noService:".no_service",insuranceWrapper:".insurances_wrapper",additionalAncillariesProductsWrapper:".additional_ancillary_products_wrapper",baggagesInsuranceWrapper:".baggages_insurance_wrapper",canxWrapper:".canx_wrapper",rebookingWrapper:".rebooking_wrapper",soWrapper:".so_wrapper"},onUpdateSeatmap:function(){var e=this.model.get("seatmap"),t=_.gt(e.quantity,0),i=_.isEmpty(e)?0:e.quantity,n=this.$cachedSelectors.seatmapWrapper,a=n.find(".text_seatmap"),s=Odigeo.Utils.pluralizeAll(this.keys.seatMapConcept,i);Odigeo.Session.set("numSelected_seats",i),a.html("- "+s),n.toggleClass("odf-hidden",!t),this.showNoServiceLabel()},onPageChange:function(){var e="details"===this.model.get("page");this.$cachedSelectors.insuranceWrapper.toggleClass("odf-hidden",e),this.$cachedSelectors.baggagesInsuranceWrapper.addClass("odf-hidden"),this.showNoServiceLabel()},showNoServiceLabel:function(){this.$cachedSelectors.noService.toggleClass("odf-hidden",this.mustHideNoServiceLabel())},mustHideNoServiceLabel:function(){return this.model.hasSeats()||this.model.isAnyAncillariesAdded()||this.model.isAnyServiceOptionsAdded()},getItemSelectorInWrapper:function(e,t){var i=e.find("."+t);return i.length||(i=$('<div class="'+t+'"></div>').appendTo(e)),i},onUpdateAncillary:function(e){var t,i=_.get(e,"id",""),a=_.get(e,"name",""),s=_.get(e,"added",!1);switch(e.type){case n.INSURANCE:case n.ASSISTANCE_INSURANCE:t=this.getItemSelectorInWrapper(this.$cachedSelectors.insuranceWrapper,"insurance_item_"+i);break;case n.REBOOKING_INSURANCE:t=this.$cachedSelectors.rebookingWrapper;break;case n.CANX_INSURANCE:t=this.$cachedSelectors.canxWrapper;break;case n.ADDITION:t=this.getItemSelectorInWrapper(this.$cachedSelectors.additionalAncillariesProductsWrapper,"additional_ancillary_product_item_"+i);break;case n.SERVICE_OPTIONS:a=_.get(e,"concept",""),t=this.$cachedSelectors.soWrapper.find(".text_so")}!_.isEmpty(t)&&t.length&&t.html("- "+a).toggleClass("odf-hidden",!s),this.showNoServiceLabel()},load:function(){this.insuranceCatalogueCollection.isLoaded()&&this.model.loadCartAncillaries(this.insuranceCatalogueCollection.getInsurances()),this.showNoServiceLabel()},init:function(){this.insuranceCatalogueCollection=a.getInstance(),this.listenTo(this.model,"change:page",this.onPageChange),this.listenTo(this.model,"change:seatmap",this.onUpdateSeatmap),this.listenTo(this.model,this.model.getAncillaryToggleEvent(),this.onUpdateAncillary),this.listenTo(this.insuranceCatalogueCollection,"productCatalogueCollectionIsOk",this.load),this.load()},reload:function(){this.insuranceCatalogueCollection?this.insuranceCatalogueCollection.load():this.init()}}))},function(e,t,i){"use strict";var n=i(0),a=i(7);Odigeo.defineWidget("price_alert_lightbox",Odigeo.Widget.extend({modelClass:Odigeo.Model.extend({defaults:{context:"",email:"",offers:!1},ensightenEvents:{results:{prices:{tmParam:{results_price_alert:{}},event:"results_price_alert"},newsletter:{tmParam:{results_price_alert_newsletter:{}},event:"results_price_alert_newsletter"}}},onSuccess:function(e,t){this.set("email",e),this.set("offer",t),this.trackSubscription("prices",e),this.trackSubscription("newsletter",!!t&&e)},trackSubscription:function(e,t){var i=this.ensightenEvents[this.get("context")][e],n=i.tmParam;n[_.findKey(n)]=t,Odigeo.Utils.ensighten(n,!0,i.event),a.fireEvent(i.event,i.event,t)}}),viewClass:Odigeo.View.extend({cons:{open:"open",invalid:"invalid",hidden:"odf-hidden",timeout:3e3},slctrs:{container:".price_alert_dialog_container",template:".price_alert_dialog_tmpl",email:".price_alert_dialog_email",emailContainer:".price_alert_dialog_email_container",input:".price_alert_dialog_input",btn:".price_alert_dialog_btn",closeBtn:".price_alert_dialog_close_btn",ready:".price_alert_dialog_ready",success:".price_alert_dialog_success"},events:{"tap .price_alert_dialog_btn":"onClickBtn","tap .price_alert_dialog_close_btn":"onClickCloseBtn","focus .price_alert_dialog_email":"onFocusInput"},openLightBox:function(){this.renderLightboxTemplate(),this.toggleLightBox(!0)},renderLightboxTemplate:function(){var e=_.template(this.$el.find(this.slctrs.template).html(),Odigeo.Utils.getTmplSettings());this.$el.find(this.slctrs.container).html(e())},toogleVisibility:function(e,t,i){this.$el.find(this.slctrs[e]).toggleClass(t,i)},toggleLightBox:function(e){Odigeo.UIElements.toggleWidgetsDialogs(this.widget.id,e),this.toogleVisibility("ready",this.cons.hidden,!1),this.toogleVisibility("success",this.cons.hidden,!0),this.toogleVisibility("container",this.cons.open,e)},onFocusInput:function(){this.toogleVisibility("emailContainer",this.cons.invalid,!1)},onClickCloseBtn:function(e){e.stopPropagation(),this.toggleLightBox(!1)},onClickBtn:function(e){e.preventDefault(),e.stopPropagation();var t=this.$el.find(this.slctrs.input),i=this.$el.find(this.slctrs.email),n=this.$el.find(this.slctrs.emailContainer),a=t.is(":checked"),s=i.val();_.isEmpty(s)||!Odigeo.Utils.isValidEmail(s)?(i.val(""),n.addClass(this.cons.invalid)):this.onSuccess(s,a)},onSuccess:function(e,t){this.widget.model.onSuccess(e,t),this.analyticsEventTracking("subscription"),this.toogleVisibility("ready",this.cons.hidden,!0),this.toogleVisibility("success",this.cons.hidden,!1),setTimeout(_.bind(this.toggleLightBox,this,!1),this.cons.timeout)},analyticsEventTracking:function(e){n.processTracking({action:"price_alert_lightbox",label:e},Odigeo.History.getPageNameFromFragment())}}),exposedMethods:{openLightBox:"openLightBox"},openLightBox:function(e){this.model.set("context",e),this.view.openLightBox()},execute:function(e){return Odigeo.Utils.executeInternalMethods(this,this.exposedMethods,e,_.rest(arguments))}}))},function(e,t,i){"use strict";Odigeo.defineWidget("xsell_products_iframes",Odigeo.Widget.extend({viewClass:i(606),renderIframes:function(e){this.view.renderIframes(e)}}))},function(e,t,i){"use strict";var n=i(158),a=i(175),s=a.getMemberDiscountParams,r=a.replaceWapb3ForAb,o=i(95),c=i(21);e.exports=Odigeo.View.extend({products:["car","hotel"],bookingStatus:"",xsellingData:"",prepareHotelsUrl:function(){return"true"===this.widget.options.expediaLinksAndWidget?this.prepareHotelExpediaUrl():this.prepareBookingUrl()},getXsellingData:function(){return n.getInstance().toJSON()},prepareHotelExpediaUrl:function(){var e=_.get(this.keys,"hotelExpediaUrl");e=r(e,c.mytripsdetails_hotels_emerginglayer,o.getRedirectionAbConfig()),e+=s(),e+="&showSearchBar=true";var t=this.xsellingData.hotel;return[e,t.checkin,t.checkout,this.xsellingData.departureIata,this.xsellingData.pickupIata,t.passengers.numAdults,t.passengers.numChildren+t.passengers.numInfants,t.currency,this.xsellingData.additionalInfo.pnr,this.xsellingData.additionalInfo.cabinClass,t.purchaseDate,"CP",Odigeo.UIElements.translations.expediaHotels.id]},prepareBookingUrl:function(){var e=this.xsellingData.hotel;return[_.get(this.keys,"hotelBookingUrl"),this.xsellingData.pickupIata,e.checkin_monthday,e.checkin_year_month,e.checkout_monthday,e.checkout_year_month]},prepareCarsParameters:function(){var e=this.xsellingData.cars,t=Odigeo.Utils.isRequestApp("dp")||"true"===Odigeo.Session.get("intermediatePageShown")?"rentalCarsDpUrl":"rentalCarsUrl";return t+="BOOKING_PENDING"===this.xsellingData.bookingStatus?"Pending":"",[_.get(this.keys,t),this.xsellingData.pickupIataAirport,e.pickupDay,e.pickupMonth,e.pickupYear,e.pickupHour,e.pickupMinute,e.returnDay,e.returnMonth,e.returnYear,e.returnHour,e.returnMinute,e.nPassengers,"",this.xsellingData.additionalInfo.pnr]},renderIframes:function(e){this.xsellingData=this.getXsellingData();var t={headerTitle:"BOOKING_PENDING"===this.xsellingData.bookingStatus?this.keys.pendingTitle:this.keys.title,hotel:{title:Odigeo.Utils.replaceCmsKeyArgs(this.keys.hotelTitle,_.get(this.xsellingData,"cityName")),domain:"true"===this.widget.options.expediaLinksAndWidget?"www.hotels.com":"www.booking.com",url:Odigeo.Utils.replaceCmsKeyArgs.apply(this,this.prepareHotelsUrl()),iframeClass:"true"===this.widget.options.expediaLinksAndWidget?"od-confirmation-hotel-iframe od-confirmation-hotel-iframe-expedia":"od-confirmation-hotel-iframe"},car:{title:Odigeo.Utils.replaceCmsKeyArgs(this.keys.carsTitle,_.get(this.xsellingData,"cityName")),domain:"www.rentalcars.com",url:Odigeo.Utils.replaceCmsKeyArgs.apply(this,this.prepareCarsParameters()),iframeClass:"od-confirmation-car-iframe"}};_.each(this.products,function(i){this.setTemplate(e.find(".iframe_container_"+i),"productIframeTemplate",{translation:t[i],product:i})},this)}})},function(e,t,i){"use strict";$(function(){var e=i(0),t=i(318),n=i(56),a=i(40),s=i(139).getRememberMeCookieField;if(App.Flights.checkCookies()){var r,o,c,d,l,g,h=i(50),u=i(362),p=i(608),f=i(609),m=i(610),b=i(20),y=Odigeo.Utils.getAppInGlobalScope(),v=Odigeo.Utils.isRequestApp("dp"),S="https:"===Odigeo.Utils.getWebProtocol(),C=$(".summary_panel"),w=$("#header"),O=$("#footer-wrapper"),T=C.find(".membership_icon"),P=C.find(".membership_fast_menu_item"),E=$(".my_trips_head"),k=$(".my_trips_head_button"),A=$(".brand_message"),D=$("#offline-sales-banner-header.offline-sales-banner-wrapper"),I=h.submitUserRequest,x=h.membershipRefreshPage,B=h.logoutUser,R=h.logoutMemberUser,M=Odigeo.autoloadWidgets({stopoverQuantityFilter:["stopover-quantity-filter-${0}","stopover_quantity_filter"],timeFilter:["time-filter-${0}","time_filter"],airlinesFilter:["airlines-filter-${0}","airlines_filter"],airportsFilter:["airports-filter-${0}","airports_filter"],stopoverDurationFilter:["stopover-duration-filter-${0}","stopover_duration_filter"],flightDurationFilter:["flight-duration-filter-${0}","flight_duration_filter"],bookFlightManager:v?["dpbook-manager","dp_book_manager"]:["book-flight-manager","book_flight_manager"]}),N=Odigeo.autoloadWidgetsAsync({getFilterByCities:["filter-by-cities","filter_by_cities"],getResultsManager:["results-manager","resultsmanager"],getFiltersManager:["filters-manager","filters_manager"],getMessageLayer:["error-message-layer","error_message_layer"],getDpErrorManagement:["dp-error-management","dp_error_management"]}),L=a({login:["login-header",n],loginExpired:["login-expired-login-form",n]}),U=function(){var e={execute:function(){}};return S||Odigeo.requireWidget("previous-searches-header","previoussearches",function(t){e=t}),e},F=i(99),W=i(361)(),H=M.bookFlightManager().get("selectionAccommodationProductErrorMessage"),q=M.bookFlightManager().execute("getSpecifiedAccommodationKeyDifferentFromPreviouslySelectedCode"),V=["payment","xsellproductselection"],G=i(319),j=function(t){"xsellproductselection"===Odigeo.History.getPageNameFromFragment()&&e.trackEvent("errors",t)},K=function(){var t=$("#results").find(".resultspage_section"),i=2===Odigeo.AB.noResultsCopyDesktop?"labelsearchops":"labelops",n=2===Odigeo.AB.noResultsCopyDesktop?"labelsearchnoresults":"labelnoresults",a=2===Odigeo.AB.noResultsCopyDesktop?"labelbutton-changesearch2":"labelbutton-changesearch",s={resetBtn:t.data(a),labelops:t.data(i),labelnoresults:t.data(n)};N.getResultsManager().execute("clearResults"),Odigeo.UIElements.enhanceLoading($(".waiting_page")).hideLoading(),Odigeo.trigger("collapseFilters"),Odigeo.UIElements.showNoResultsPopup(s),e.trackEvent("searcher_flights_error","no_results_for_this_search_error")};1<Odigeo.AB.preloadPartition&&!v&&t.stopRenderMetric(),_.extend(Odigeo.Model.prototype,{pagesList:["home","results","details","payment","confirmation"],seatmapSelectionWidget:{id:"seatmap-selection-manager",name:"seatmap_selection_manager"},error404:function(){Odigeo.Router.navigate("error")},error500:function(){j("500_internal_error"),Odigeo.UIElements.showBrokenFlowError()},reloadEnsighten:function(e){!Odigeo.Utils.parseJson(Odigeo.Session.get("avoidEnsightenReload"))&&Odigeo.Utils.ensighten(e.tmParam),Odigeo.Session.remove("avoidEnsightenReload")},brokenFlowError:function(e){Odigeo.Utils.startsWith(e.message,H)||Odigeo.Utils.startsWith(e.message,q)||Odigeo.UIElements.showBrokenFlowError("alert",!0)},sessionExpiredError:function(){Odigeo.UIElements.showSessionExpiredError("alert",!0)},defaultError:function(){Odigeo.UIElements.showBrokenFlowError("alert",!0)},hideLoading:function(){Odigeo.UIElements.enhanceLoading($(".waiting_page")).hideLoading()}},G),Odigeo.on("analytics:tracking",function(e){Odigeo.requireWidget("google-analytics","googleanalytics",function(t){t.execute(e.type,e.data)})}),o=function(e,t){var i=-1<_.indexOf(["home","confirmation","mytripslogin","mytrips","","/"],Odigeo.History.getPageNameFromFragment());C.find(".header_register_section").toggleClass("hidden",e||!t),C.find(".login_fast_menu").toggleClass("hidden",e||!t),L.get("login").execute("hideShowRegisterFooterLink",t),C.toggleClass("od-menu-user-logged",e).toggleClass("logged-on",e),k.toggleClass("my_trips_header_logged",e),E.toggleClass("hidden",!i)},c=function(){var e=U();$(".header_menu_list").find(".opened").removeClass("opened"),e.execute("isLuckyLayerBeingShown")&&(e.execute("updateBubbleCount"),e.execute("reload"))},d=function(e,t,i){C.find(".membership_soft_login").toggleClass("odf-hidden",!t),C.find(".login_name").text(_.isEmpty(e)||t?"":e),C.data("softLogin",t),L.get("login").execute("checkMembershipFastMenu",i)},Odigeo.on("notification:openLayer",function(){var t="true"===Odigeo.Session.get("messageOpen");if(Odigeo.SessionScope.openNotification&&!t){Odigeo.Session.set("messageOpen","true");var i=$(".notification_layer"),n=0<i.find(".notification_message.returnbooker_bags_and_seats_message.odf-hidden").length;i.trigger(Odigeo.Events.tap),n?setTimeout(function(){0===$(".notification_layer:hover").length&&i.trigger(Odigeo.Events.tap)},3e3):Odigeo.AB.isReturningBookersNotification&&e.trackEvent("on_load_events","add_bag_seat_notification","home")}}),Odigeo.on("notification:closeHeaderDialogs",function(){$(".header_launcher").removeClass("opened")}),Odigeo.start({settings:{isSearchExecuted:!1,pathNames:{home:Odigeo.Settings.property("appContext")+"/",flights:Odigeo.Settings.property("appContext")+"/flights/",dp:Odigeo.Settings.property("appContext")+"/dp/",secure:Odigeo.Settings.property("appContext")+"/secure/"},sessionTimerInitPages:["results","payment","details","detailsloading","confirmation","frequentpassengers","accountpreferences","mytrips","xsellproductselection"],sessionExpirePages:["results","payment","details","dpresults","roomselection","detailsloading","xsellproductselection"],sessionExpirePagesOnLoad:["payment","details","confirmation"],sessionAboutToExpirePages:["results","payment","details","xsellproductselection"],searchExpirePages:["results","dpresults","detailsloading","xsellproductselection"],sessionLoginExpirePages:["frequentpassengers","accountpreferences","mytrips"]},onBeforeWidgetLoading:function(){var e,t,i=Odigeo.Storage.get("search-data"),n=Odigeo.Storage.get("travellers");_.isNull(i)||(e=App.Flights.purgePreviousSearches(i),Odigeo.Storage.set("search-data",JSON.stringify(e))),_.isNull(n)||(t=App.Flights.purgeTravellers(n),Odigeo.Storage.set("travellers",JSON.stringify(t)))},onStart:function(){var t,n,a,o,d,l,g,h,u,p,f=$(window),m=$("#page"),w=$(".menu_list"),O={home:"home",dp:"flighthotel",flights:"flights"}[y],T=Odigeo.History.getPageNameFromFragment();i(611)();var P=function(){var i=h.data("page"),n=h.data("url"),a=h.data("target"),s=h.attr("id"),r=["menu_home","menu_flights","menu_flighthotel"];"myinfo"===h.data("view")?_.delay(function(){t(h)},400):n||t(h),e.trackEvent("header","menu_primary_"+Odigeo.Utils.removeBlankSpaces(h.text()).toLowerCase(),Odigeo.History.getPageNameFromFragment()),_.isEmpty(i)?_.isEmpty(n)||("_blank"===a?Odigeo.trigger("analytics:tracking",{type:"sendToPageBlank",data:{url:n,goOutside:!_.includes(r,s)}}):Odigeo.trigger("analytics:tracking",{type:"sendToPageSelf",data:{url:n,goOutside:!_.includes(r,s)}})):Odigeo.Router.navigate(i)};t=function(e){w.find(".current").removeClass("current"),w.find(".active").removeClass("active"),w.find(".submenu").addClass("hidden"),e.addClass("current"),a(e)},a=function(e){var t=e?e.parent():null;u&&(u.children(".menu_item_desc").remove(),u.removeClass("current").prepend(p),u.find(".menu_item").removeClass("hidden"),p=u=null),t&&t.hasClass("submenu")&&(u=t.parent(),p=u.children(".menu_item_desc").detach(),_.delay(function(){e.addClass("hidden"),u.prepend(e.children().clone()).addClass("current")},500))},d=function(){w.find("#menu_"+O).addClass("current")},n=function(){S&&v&&(Odigeo.Session.remove("before-page"),$("body").data("app","dp")),$(this).hasClass("disabled")||"true"!==$("#page").attr("data-waiting")&&(Odigeo.Session.set("page","home"),Odigeo.Utils.goToApplicationHome()),e.trackEventWithCategory("header","header","logo_clicks")},o=_.bind(function(e){var t=$(e.target);!r.length||!t.is(r.find(".accept_button"))&&t.closest("#cookie-disclaimer").length||(r.css({height:r.height()+"px"}),_.delay(function(){r.one(Odigeo.Events.transitionEnd,function(){r.parent().remove(),Odigeo.Utils.createCookie("CookiePolicyAccepted","1",365),r.find(".accept_button").off(Odigeo.Events.tap+".cookieDisclaimer",o)}).css({height:"0px"})},1))},this),f.on("hashchange",function(){Odigeo.Session.get("ipHotelReminderNagShown")||($(".dialog:visible").trigger("dialog:closeOnNavigate"),$("#nag_container:visible").trigger("lightbox:closeOnNavigate"),Odigeo.AB.isNewWarningPopup&&$(".ui_dialog_box.opened").trigger("dialog:closeOnNavigate"))}),l=function(){var e=Odigeo.Utils.sessionTimer.CONST,t=function(e,t){Odigeo.off(e).on(e,t)};Odigeo.Utils.sessionLifeTime=1140,Odigeo.Utils.timeBeforeExpireAlert=Odigeo.Utils.sessionTimerNagLongest?900:1020,_.includes(Odigeo.Settings.property("sessionTimerInitPages"),Odigeo.History.getPageNameFromFragment())&&(t("session:started",function(){Odigeo.Utils.sessionTimer.start()}),t(e.SESSION_EXPIRED_EVENT,function(){j("expired_session"),Odigeo.UIElements.showSessionExpiredError("alert",!0)}),Odigeo.bind("session:loginexpiration",function(){Odigeo.UIElements.showSessionLoginExpirationError()}),t("session:refreshed",function(){Odigeo.Utils.sessionTimer.reset()}),t("session:stopped",function(){Odigeo.Utils.sessionTimer.stop()}),t(e.SESSION_ABOUT_TO_EXPIRE_EVENT,function(){var e=Odigeo.AB.isNewWarningPopup?{removeClass:"opened"}:{};Odigeo.UIElements.showSessionAboutToExpireAlert(e)}),Odigeo.AB.isNewWarningPopup?Odigeo.Utils.sessionTimer.setTime(Odigeo.Utils.sessionLifeTime,180):Odigeo.Utils.sessionTimer.setTime(Odigeo.Utils.sessionLifeTime,Odigeo.Utils.sessionLifeTime-Odigeo.Utils.timeBeforeExpireAlert))},(r=$("#cookie-disclaimer").find(".cookiedsc_container")).length&&r.find(".accept_button").on(Odigeo.Events.tap+".cookieDisclaimer",o),m.on(Odigeo.Events.tap,function(e){0===$(e.target).closest(".prevent_close_on_tap").length&&c()}).on("toggle-waiting-page",function(e,t){$(this).attr("data-waiting",function(){return t||null})}),Odigeo.on("closeAllPopUps",function(){c()}),Odigeo.Session.set("lastRouteChange",JSON.stringify(null)),Odigeo.Session.set("messageOpen","false"),Odigeo.bind("routeChange",function(e){Odigeo.trigger("close:"+e.from.name),Odigeo.UIElements.hint.bindCloseHintsOnPageClick(e.to.name),Odigeo.Session.set("lastRouteChange",JSON.stringify(e)),App.Flights.onRouteChange("details",e),L.get("login").execute("isUserLogged")}),Odigeo.UIElements.hint.bindCloseHintsOnPageClick(T),w.on(Odigeo.Events.mousedown,".menu_item",_.bind(function(e){var t=$(e.currentTarget).find("a"),i=_.isEmpty(t)?"":t.data("link");_.isEmpty(i)||Odigeo.requireWidget("google-analytics","googleanalytics",function(e){var n=e.get("getUrlDecoratedWithCrossDomainParameters",i);t.attr("href",n)})},this)),w.on(Odigeo.Events.tap,".menu_item",_.bind(function(e){var t=w.find(".current.menu_item").data("view"),i=$("#"+t),n=(h=$(e.currentTarget)).data("page"),a=h.data("view"),s=h.data("url");e.stopImmediatePropagation(),_.isEmpty(n)&&_.isEmpty(a)&&_.isEmpty(s)&&!h.children().hasClass("protocol_switch")||(!_.isEmpty(t)&&i[0]&&i[0].beforeLeavePageHandler?i[0].beforeLeavePageHandler():P())},this)),Odigeo.SessionScope.isBookingXSWhiteLabel||$("#logo").on(Odigeo.Events.tap,n),Odigeo.bind("pageRedirect",P),Odigeo.bind("returnToHome",n),w.length&&d(),Odigeo.bind("fullStorage",function(){$(".home_main_layout").addClass("error")}),Odigeo.on("page:beforeSwitch",function(e){m.removeClass(function(e,t){$(this).attr("class",t.indexOf("waiting")<0?"":"waiting")}).addClass(e.attr("id"))}),!1===m.data("isSessionAlive")&&_.includes(Odigeo.Settings.property("sessionExpirePagesOnLoad"),T)&&Odigeo.UIElements.showSessionExpiredError("alert",!0),Odigeo.Router.bindAnyRoute(l),Odigeo.Router.bindAnyRoute(function(){$("#login-wrapper").toggleClass("odf-hidden",_.contains(V,Odigeo.History.getPageNameFromFragment()))}),Odigeo.Router.bindAnyRoute(function(){A.toggleClass("odf-text-left",!_.isEmpty(D.html()))}),$(".header_help_link").off().on(Odigeo.Events.tap,function(){e.trackEventWithCategory("header","header","help_clicks")}),$(".footer_conditions_link").off().on(Odigeo.Events.tap,function(){e.trackEventWithCategory("footer","footer","terms_and_conditions_clicks")}),$(".header_secondary_menu").off().on(Odigeo.Events.tap,function(){var t=$(this).data("promoLabel");e.trackEvent("header","menu_secondary_"+t,Odigeo.History.getPageNameFromFragment())}),$(".survey_link").off().on(Odigeo.Events.tap,function(){e.trackEvent("header","feedback_clicks",Odigeo.History.getPageNameFromFragment())}),$(".od-notification-wrapper-item a").off().on(Odigeo.Events.tap,function(){e.trackEventWithCategory("notification_center","header","notifications_center_notice_clicks")}),$(".footer_bottom_link, .footer_bottom_links a").off().on(Odigeo.Events.tap,function(t){e.trackEvent("footer","links_open_"+Odigeo.Utils.removeBlankSpaces($(t.target).text()).toLowerCase(),Odigeo.History.getPageNameFromFragment())});var E=$(".header_launcher",".header_menu_list"),I=Odigeo.UIElements.enhanceBubbleNotification($("#header").find(".header_notificationcenter_bubble"));_.each(E,function(t){var i,n=$(t),a=n.data("trigger"),s=E.not(n);if("hover"===a){var r=null;n.hover(function(){Odigeo.UIElements.hint.hideAllHints(),clearTimeout(r),n.addClass("opened"),s.removeClass("opened")},function(){r=setTimeout(function(){n.removeClass("opened")},150)})}else n.on(Odigeo.Events[a],function(t){Odigeo.UIElements.hint.hideAllHints();var a=$(t.currentTarget),r=Odigeo.getWidgetByID("previous-searches-header");$("#login-header").find(".login_root").hasClass("logged-on")&&$(n[0]).hasClass("login-info-wrapper")||(a.hasClass("previoussearches_header")?(r&&r.execute("isLuckyLayerBeingShown")?(r.execute("reload"),n.addClass("opened")):n.toggleClass("opened"),r&&r.execute("hideBubbleNotification")):(n.toggleClass("opened"),r&&r.execute("isLuckyLayerBeingShown")&&r.execute("updateBubbleCount")),s.removeClass("opened"),n.hasClass("login-info-wrapper")&&$("#login-header").find(".modal_view").toggleClass("active")),0<n.find(" + .header_tooltip_countries").length&&$(".continent_header.unfolded").trigger(Odigeo.Events.tap),n.hasClass("notification_layer")&&(I.trigger("hideBubble"),(i=$(t.target)).hasClass("close_notification")&&(i.parents(".notification_message").addClass("odf-hidden").removeClass("od-notification-message"),$(".notification_message").is(":visible")||$(".no_messages").removeClass("odf-hidden")),n.hasClass("opened")&&e.trackEventWithCategory("notification_center","header","notification_center_open")),t.stopPropagation()});((i=n.find(".header_dialog")).length||(i=n.next(".header_dialog")).length)&&(i.find(".header_tooltip_close").on(Odigeo.Events.tap,function(){n.removeClass("opened")}),i.find(".od-header-tooltip-call-title").find("a").on(Odigeo.Events.tap,function(){e.trackEvent("header","faq_clicks",Odigeo.History.getPageNameFromFragment())}))}),Odigeo.on("loading:show",function(e){var t=Odigeo.Utils.getFunnelTrackingLegacy();Odigeo.requireWidget("google-analytics","googleanalytics",function(i){var n="true"===Odigeo.Session.get("payment3ds")?"-3dsecure":"/"+e;i.execute("trackVirtualPage",{page:"waiting"+n,funnel:!0,legacy:"/waitPage/paso"+e+t})}),Odigeo.Session.set("payment3ds",!1)}),Odigeo.on("sessionExpireDialog:repeatSearch",function(e){var t=v?App.Dynpack.getSearchData():App.Flights.getSearchData(),i=v?"dp":"",n=i+"results",a=i+"search-manager",s=i+"searchmanager",r=v?App.Dynpack.searchParamsStringify:App.Flights.searchParamsStringify;Odigeo.UIElements.hideAllDialogs(),t.then(function(t){var i=!_.has(t,"internalSearch")||!1===t.internalSearch;t=_.extend(t,{buyPath:v?App.Dynpack.getBuyPath(e):"FLIGHTS_EXPIRED_SEARCH_POPUP",internalSearch:!0}),i||e!==n?("roomselection"===e&&b.getInstance().set(t),Odigeo.Router.navigate(n,{params:r(t)})):Odigeo.requireWidget(a,s,function(e){e.execute("search",t)})},function(){Odigeo.Router.navigate(n)})}),$(".initial_loader").addClass("hidden"),Odigeo.trigger("checkNewsletterVisibility"),Odigeo.on("previous-searches-header:rowSelected",function(e){Odigeo.requireWidget("previous-searches-header","previoussearches",function(e){e.execute("searchMadeFromPreviousSearches")}),e.buyPath="FLIGHTS_HOME_RECENT_SEARCHES",b.getInstance().set(e),Odigeo.Router.navigate("results",!1,!0,App.Flights.searchParamsStringify(e))}),U();var x=m.find("#notification-header"),B=x.find(".no_messages"),R=Odigeo.Utils.isHomePageStrict(),M=Odigeo.Utils.isWebmasterPage();function N(e){var t=$(e.currentTarget).data();e.stopPropagation(),g("header",t.tracking),"login"===t.action||t.softLogin?(Odigeo.Session.set("loginWidget","login-header"),L.get("login").execute("openModalLogin")):Odigeo.Router.navigate("register")}Odigeo.AB.isReturningBookersNotification&&R&&!M&&function(){var t=Odigeo.Utils.parseJson(Odigeo.Storage.get("infoHotelsHero"))||{};if(t.departureDate&&Odigeo.Utils.addDays(t.departureDate,1)>Date.now()){var i=x.find(".returnbooker_bags_and_seats_message");i.find("button").off(Odigeo.Events.tap).on(Odigeo.Events.tap,function(){var t=k.hasClass("my_trips_header_logged")?"mytrips":"mytripslogin";e.trackEvent("on_load_events","add_bag_seat_notification_selected","home"),Odigeo.Router.navigate(t)}),i.removeClass("odf-hidden").addClass("od-notification-message"),Odigeo.SessionScope.openNotification=!0}}(),0<x.find(".notification_message:visible").length&&B.addClass("odf-hidden"),g=function(t,i){e.trackEventWithCategory("sso_module",t,i)},$(".top_menu_options").find("[data-page]").on(Odigeo.Events.tap,function(e){var t=$(e.currentTarget),i=t.data("page"),n=t.data("tracking");g("header",n),"logout"===i?L.get("login").execute("openModalLogout",{data:"",action:"logOut"}):Odigeo.Router.navigate(i)}),C.find(".header_register_button, .header_login_button, .membership_soft_login ").off().on(Odigeo.Events.tap,N),"true"===s("isMembership")&&C.off().on(Odigeo.Events.tap,N),k.off(Odigeo.Events.tap).on(Odigeo.Events.tap,function(){var e=k.hasClass("my_trips_header_logged")?"mytrips":"mytripslogin";Odigeo.Router.navigate(e)}),L.get("login"),Odigeo.trigger("analytics:tracking",{type:"trackCustomVariable",data:{index:37,name:"Beta",value:m.data("beta"),scope:2}}),Odigeo.trigger("trackMainPageView")},router:{routes:{},routeMatches:{home:/^\/?(?:(?:travel\/(?:flights\/|dp\/))?home\/(.*)|travel\/(?:flights\/|dp\/)?|\/?)$/,resident:/^\/?(?:travel\/)?(?:flights\/)?resident\//,inspirational:/^\/?(?:travel\/)?(?:flights\/)?inspirational\//,results:/^\/?(?:travel\/)?(?:flights\/)?results\/(.*)/,xsellproductselection:/^\/?(?:travel\/)?(?:flights\/)?xsellproductselection\/(.*)/,detailsloading:/^\/?(?:travel\/)?(?:flights\/)?detailsloading\/(.*)/,dpresident:/^\/?(?:travel\/dp\/)?dpresident\//,dpresults:/^\/?(?:travel\/dp\/)?(?:dpresults)\/(.*)/,dpresults_accommodation:/^\/?(?:travel\/dp\/)?(?:dpresults_accommodation)\/(.*)/,dpresults_flights:/^\/?(?:travel\/dp\/)?(?:dpresults_flights)\/(.*)/,roomselection:/^\/?(?:travel\/dp\/)?(?:roomselection)\/(.*)/,details:/^\/?(?:travel\/secure\/)?(?:details)\/(.*)/,payment:/^\/?(?:travel\/secure\/)?payment\/(.*)/,pbpayment:/^\/?(?:travel\/secure\/)?pbpayment\/(.*)/,payment3ds:/^\/?(?:travel\/secure\/)?payment3ds\/(.*)/,confirmation:/^\/?(?:travel\/secure\/)?confirmation\//,register:/^\/?(?:travel\/secure\/)?register\//,loginexpired:/^\/?(?:travel\/secure\/)?loginexpired\//,accountblocked:/^\/?(?:travel\/secure\/)?accountblocked\//,accountpreferences:/^\/?(?:travel\/secure\/)?accountpreferences\//,resetpassword:/^\/?(?:travel\/secure\/)?resetpassword\/(.*)/,frequentpassengers:/^\/?(?:travel\/secure\/)?frequentpassengers\/(.*)/,mytrips:/^\/?(?:travel\/secure\/)?mytrips\/(.*)/,mytripslogin:/^\/?(?:travel\/secure\/)?mytripslogin\/(.*)/,tripdetails:/^\/?(?:travel\/secure\/)?tripdetails\/(.*)/,post_booking:/^\/?(?:travel\/secure\/)?post_booking\/(.*)/,error:/\/?error\//,metaancillaries:/^\/?(?:travel\/secure\/)?metaancillaries\/(.*)/,ofpreload:/\/?ofpreload\//,dpredirect:/^\/?((?:travel\/dp\/)?(?:dpresults_accommodation_details|booking)|(?:travel\/secure\/)?(?:passengersinfo))\/(.*)/},appChangePages:(l={home:{home:"home",dpresults:"dp",dpresults_flights:"dp",dpresults_accommodation:"dp",dpresident:"dp"},flights:{},dp:{results:"flights",dpresident:"dp",resident:"flights"},secure:{home:"home",results:"home",dpresults:"dp",dpresults_flights:"dp",dpresults_accommodation:"dp",roomselection:"dp"}},g={loginexpired:"secure",accountblocked:"secure",details:"secure",register:"secure",payment:"secure",pbpayment:"secure",payment3ds:"secure",confirmation:"secure",resetpassword:"secure",frequentpassengers:"secure",accountpreferences:"secure",mytrips:"secure",mytripslogin:"secure",tripdetails:"secure",post_booking:"secure"},_.extend(l.home,g),_.extend(l.dp,g),_.extend(l.flights,g),l),handlers:$.extend(Odigeo.Router.handlers,{userEventController:{globalEvents:{"login-header:submitUserRequest":"onSubmitUserRequest","login-header:userLogged":"onUserLogged","login-header:setMembershipStar":"onSetMembershipStar","login-header:setMembershipFastMenu":"onSetMembershipFastMenu","login-header:membershipLogoutPopUpConfirmation":"onMembershipLogoutPopUpConfirmation","login-header:userLogoutConfirmed":"onUserLogoutConfirmed","users-manager:updateAccountInfoOk":"onUpdateDisplayName","my-trips-login-form:userLogged":"onUserLoggedMyTrips","login-header:userNotLogged":"onUserNotLogged","login-header:userIsLogged":"onIsUserLogged","login-header:openRegister":"onOpenRegister","login-expired-manager:initEmbedLogin":"initEmbedLogin","users-manager:isLoggedInOk":"onLoginEvents","users-manager:isLoggedInWithError":"onLoginEvents","users-manager:isLoggedInError":"onLoginEvents","users-manager:loginOk":"onLoginEvents","users-manager:loginWithError":"onLoginEventsSeparately","users-manager:loginError":"onLoginEventsSeparately","users-manager:membershipLogInServerConfirmation":"onMembershipLogInServerConfirmation","users-manager:membershipLogoutServerConfirmation":"onMembershipLogoutServerConfirmation","users-manager:loginWithGoogleOk":"onLoginEventsSeparately","users-manager:loginWithGoogleWithError":"onLoginEventsSeparately","users-manager:loginWithGoogleError":"onLoginEventsSeparately","users-manager:loginWithFacebookOk":"onLoginEventsSeparately","users-manager:loginWithFacebookWithError":"onLoginEventsSeparately","users-manager:loginWithFacebookError":"onLoginEventsSeparately","users-manager:getAccountInfoWithError":"onGetDataError","users-manager:getAccountInfoError":"onGetDataError","users-manager:recoverPasswordOk":"onLoginEventsSeparately","users-manager:recoverPasswordWithError":"onLoginEventsSeparately","users-manager:recoverPasswordError":"onLoginEventsSeparately","users-manager:logOutOk":"onLogout","login-header:openLoginForm":"onOpenLoginForm","account-blocked:openLoginForm":"onOpenLoginForm","register-manager:openLoginForm":"onOpenLoginForm","register-manager:closeLoginForm":"onCloseLoginForm","register-manager:showHideModalLayer":"onShowHideModalLayer","reset-password:showHideModalLayer":"onShowHideModalLayer","payment-manager:showHideModalLayer":"onShowHideModalLayer","rememberme:submitUserRequest":"onSubmitUserRequest","frequent-passengers-manager:ssoRememberMeCookieUpdated":"onSsoRememberMeCookieUpdated","dp-error-management:open":"onOpenErrorManager"},viewEvents:{"sessionExpireDialog:repeatSearchDynpack":"onRepeatSearch"},eventHandlers:{onShowHideModalLayer:function(e){$("#login-header").find(".modal_view").toggleClass("active",e)},onIsUserLogged:function(e){_.isNull(Odigeo.Utils.readCookie("sso_remember_me"))||(e=!0),o(e,Odigeo.Utils.isHomePage())},onOpenRegister:function(){"register"===Odigeo.History.getPageNameFromFragment()?L.get("login").execute("closeConnectorsLayer"):Odigeo.Router.navigate("register")},onUserLogged:function(e,t,i){var n=e.displayName,a=e.membership;d(n,null,a),o(!0,!1),C.off().on(Odigeo.Events.tap,function(e){e.stopPropagation(),c(),C.find(".logged_fast_menu").toggleClass("opened")});var s=Odigeo.AB.isMembershipProductSellingEnabled&&!Odigeo.Utils.isRequestApp("dp");"isLoggedInOk"===e.action&&!Odigeo.Session.get("feedbackPrime")&&a&&s&&(Odigeo.Session.set("feedbackPrime",!0),Odigeo.requireWidget("membership-login-feedback","membership_login_feedback",function(e){e.execute("openLightBox",n)})),Odigeo.trigger(t||!i?"global:userLogged":i,_.isObject(e)?e:{})},onSetMembershipStar:function(e){T.toggleClass("odf-hidden",!e)},onSetMembershipFastMenu:function(e){var t=P.children(".membership_menu_item_txt"),i=P.children(".membership_menu_item_icon");t.text(e?t.data("member"):t.data("noMember")),i.toggleClass("odf-icon-star",e)},onUserLoggedMyTrips:function(e){L.get("login").execute("setLogged"),this.onUserLogged(e,!1,"my-trips-login-form:userLoggedMT")},onUpdateDisplayName:function(e){_.isEmpty(e.displayName)||d(e.displayName)},onUserNotLogged:function(){var e,t,i=Odigeo.Utils.isHomePage();_.isNull(Odigeo.Utils.readCookie("sso_remember_me"))?(o(!1,i),i&&C.off().on(Odigeo.Events.mouseover,function(){c(),C.addClass("opened")}).on(Odigeo.Events.mouseout,function(){c(),C.removeClass("opened")}),Odigeo.trigger("global:userNotLogged")):(e=s("name"),t="true"===s("isMembership"),d(e,t),o(!0,!1),t||C.off().on(Odigeo.Events.tap,function(e){e.stopPropagation(),C.find(".logged_fast_menu").toggleClass("opened")}),Odigeo.trigger("global:userNotLoggedRemembered")),Odigeo.Utils.ensighten.updateDatalayer({membership_login:"logged_out"})},onSubmitUserRequest:function(e){I(e)},onLogout:function(e){Odigeo.trigger("global:userLogout"),L.get("login").execute(e.action,e)},onLoginEvents:function(e){Odigeo.trigger("global:"+e.action,e),L.get("login").execute(e.action,e)},onLoginEventsSeparately:function(e){var t=Odigeo.Session.get("loginWidget")||"login-header";L.get("login",t).execute(e.action,e)},onOpenErrorManager:function(e,t){N.getDpErrorManagement().execute("open",e,t)},onRepeatSearch:function(){Odigeo.trigger("sessionExpireDialog:repeatSearch",Odigeo.History.getPageNameFromFragment())},onUserLogoutConfirmed:B,onMembershipLogoutPopUpConfirmation:R,onMembershipLogoutServerConfirmation:_.partial(x,"logout"),onMembershipLogInServerConfirmation:function(){x("login")},onOpenLoginForm:function(){L.get("login").execute("openModalLogin")},onCloseLoginForm:function(){L.get("login").execute("closeConnectorsLayer")},initEmbedLogin:function(e){L.get("loginExpired").execute("initEmbedView",e)},onGetDataError:function(){Odigeo.trigger("global:onGetDataError")},onSsoRememberMeCookieUpdated:function(){var e=s("name");d(e||"")}}},errorManagerEventController:{globalEvents:{"payment-manager:manageError":"onManageError"},eventHandlers:{onManageError:function(e){N.getMessageLayer().execute("manageError",e)}}},repriceManagerEventController:{globalEvents:{"reprice-manager:checkRepricing":"onCheckRepricing","reprice-manager:checkNoSecureRepricing":"onCheckNoSecureRepricing"},eventHandlers:{onCheckRepricing:function(t){var i=$(t);i.load(Odigeo.Settings.property("widgetUrlFormatter")("repricing-notification-payment","repricingnotification"),function(){var t,n=i.find(".repricing_notification_content");n.length&&0!==parseFloat(n.data("amount"))&&(t="repricing_amount:"+n.data("amount")+"_type:"+n.data("type")+"_pax:"+n.data("pax")+"_shown:"+n.find(".is_repricing").length,0<n.find(".is_repricing").length&&(Odigeo.trigger("global:repricingShown"),n.find(".close_repricing").on(Odigeo.Events.tap,function(e){e.stopPropagation(),e.preventDefault(),n.addClass("hidden")})),e.trackEvent("back_end_errors",t))})},onCheckNoSecureRepricing:function(e){var t=_.template($("#nosecure-repricing-template").html(),{evaluate:/\{\{#([\s\S]+?)\}\}/g,interpolate:/\{\{[^#\{]([\s\S]+?)[^\}]\}\}/g,escape:/\{\{\{([\s\S]+?)\}\}\}/g,variable:"repricing"}),i=F(e,"data.diff",0),n=Math.abs(i);$(e.container).html(t({isPositiveRepricing:0<i,hasToShowRepricing:.03<n,quantity:Odigeo.Utils.formatCurrency(n,_.extend({},Odigeo.Utils.Currency,{decimalPlaces:2}))}))}}},searchFlightsEventController:{globalEvents:{"airlines-filter:update":"updateAirlinesFilter","airports-filter:update":"updateAirportsFilter","airport_selector:trackEvent":"onTrackAutocomplete","change-search:search":"onSearch","onelinebutton_search_manager:search":"onSearch","calendar-grid:search":"onSearch","change-search:searchCompletedSuccessfully":"onSearchCompletedSuccessfully","change-search:searchCompletedWithError":"onSearchCompletedWithError","change-search:searchError":"onSearchError","change-search:searchPerformed":"onSearchPerformed","dpchange-search:search":"onDynpackSearch","filters-manager:allowToRefreshResults":"allowToRefreshResults","filter-by-cities:init":"initFilterByCities","filters-manager:check-non-stopover-filter":"doCheckNonStopsFilter","flexible-dates:search":"onSearch","flights-manager:dynpackSearch":"onDynpackSearch","flights-manager:search":"onFlightManagerSearch","inspirational-manager:search":"onSearch","ipchange-search:dpSearch":"onDynpackSearchFromFlights","ipchange-search:search":"onSearch","resident-discount:search":"onSearch","search-manager:analyticsTrackingEvents":"onAnalyticsTrackingEvents","search-manager:prepareResultsManager":"onPrepareResultsManager","search-manager:prepareSearchSummary":"onPrepareSearchSummary","search-manager:preSearchPerformed":"onPreSearchPerformed","search-manager:searchCompletedSuccessfully":"onSearchCompletedSuccessfully","search-manager:searchCompletedWithError":"onSearchCompletedWithError","search-manager:searchError":"onSearchError","search-manager:startMapiMetric":"onStartMapiMetric","search-manager:searchMapiCompletedSuccessfully":"onSearchMapiCompletedSuccessfully","search-manager:searchMapiCompletedWithError":"onSearchMapiCompletedWithError","search-manager:showWaitingPage":"onShowWaitingPage","search-manager:storeSearch":"onStoreSearch","stopover-duration-filter:update":"updateStopoverDurationFilter","time-filter:update":"updateTimeFilter","flight-duration-filter:update":"updateFlightDurationFilter"},eventHandlers:{onSearch:function(t,i,n){var a,s,o,c=Odigeo.History.getPageNameFromFragment(),d=$("#flights-manager"),l="dp"===d.find(".flightsManager_tab.active").data("value")&&"xsellproductselection"!==c,g=[],h=!1,y="results"===(i=_.isUndefined(i)?"results":i)?"resident":"dpresident";n=_.isFunction(n)?n:App.Flights.searchParamsStringify,W.isValidPaymentMethod(t.collectionMethod)&&(W.setAction("searcher_"+(l?"dynpack":"flights")),e.trackEvent(W.action,W.getPayMethodLabel(t)));var S=_.clone(t),C=new f(i,App.Dynpack.getHomeBuyPath(v,l),"FLIGHTS_HOME_SEARCH_FORM"),w=new f(i,"INTERMEDIATE_PAGE_DYNPACK_SEARCH","INTERMEDIATE_PAGE_FLIGHTS_SEARCH");S.buyPath={inspirational:new p("INSPIRATIONAL_SEARCH"),"":C,home:C,flights:C,details:S.comesFromPassenger?new p("PASSENGER_PAGE_SEARCH"):C,results:new m(S.isCalendarSearch),dpresults:new p("DYNPACK_RESULTS_SEARCH_FORM"),dpresults_accommodation:new p("DYNPACK_RESULTS_ACCOMMODATION_SEARCH_FORM"),dpresults_flights:new p("DYNPACK_RESULTS_FLIGHTS_SEARCH_FORM"),xsellproductselection:w,roomselection:new p("DYNPACK_ROOM_SELECTION_SEARCH_FORM")}[c].build(),(o="dpresults"===i&&(""===c||"flights"===c||"home"===c))&&(S.internalSearch=o),S.internalSearch=Odigeo.SessionScope.isFromAirlineWMP||S.internalSearch,S.isInspirationalSearch||Odigeo.requireWidget("resident-discount","residentdiscount",function(e){s=e.options.residentZones,_.isEmpty(s)||(a=_.chain(S.searchSegments).map(function(e){return h=e.departure.countryCode===e.destination.countryCode||e.departure.country===e.destination.country,[e.departure.iata,e.destination.iata]}).flatten().unique().value(),g=_.chain(s).pick(a).values().flatten().unique().value())}),(!g.length||0<S.numInfants+S.numChildren||"multipleTrip"===S.type||!_.isEmpty(S.multipleDestinationCities))&&(S=_.omit(S,"resident")),b.getInstance().set(S),r&&r.parent().remove();var O,T="",P=!1;!_.isUndefined(S.comesFromPassenger)&&S.comesFromPassenger&&(P=S.comesFromPassenger,S=_.omit(S,"comesFromPassenger"));var E=Odigeo.Utils.parseJson(Odigeo.Session.get("searchParameters"));Odigeo.AB.isFlexibleDatesOWActive&&E&&"oneWayTrip"===E.type&&Odigeo.requireWidget("calendar-grid","calendar_grid",function(e){e.execute("refreshData")}),S.isInspirationalSearch?O="inspirational":h&&g.length&&"multipleTrip"!==S.type&&S.numInfants+S.numChildren===0&&_.isEmpty(S.multipleDestinationCities)?(Odigeo.Session.set("residentZones",JSON.stringify(g)),O=y):(O=i,T={params:n(S),replace:c===i||P,isSecured:!1},-1===location.pathname.indexOf(Odigeo.Settings.getProperty("pathApiSearchplugin"))?T={isSecured:!1,replace:c===(O=i)||P,params:n(S,i)}:Odigeo.Router.goFromExternal(i,n(S,i)));var k=window.location.protocol+"//"+window.location.host+Odigeo.Settings.property("appContext")+"#"+O+"/"+(T.params?T.params:"");if(S.isNewTab){var A=window.open(decodeURIComponent(k));u.didTabClose(A,250).then(_.bind(function(i){i?(e.trackEvent("searcher_flights","new_tab_blocked"),Odigeo.Router.navigate(O,T)):(this.triggerCoSearch(t),e.trackEvent("searcher_flights","new_tab_continue"))},this))}S.isXsellTab?(d.find(".search_flight_link").attr("href",decodeURIComponent(k))[0].click(),this.triggerTabAndCoSearch(t,i),e.trackEvent("searcher_flights","new_tab_continue")):(this.triggerCoSearch(t),Odigeo.Router.navigate(O,T))},triggerTabAndCoSearch:function(e,t){this.triggerCoSearch(e),this.triggerXsellTab(t)},triggerXsellTab:function(e){"dpresults"!==e&&(Odigeo.AB.isXsellHomePageNewTab||Odigeo.AB.isSearchExtensionFilteredByBrowser)&&Odigeo.trigger("flights-manager:openXsellTab")},triggerCoSearch:function(e){e.coSearchAllowed&&Odigeo.trigger("flights-manager:open-cosearch",e)},onDynpackSearch:function(e){!0!==e.newRoomFormat&&_.extend(e,App.Accommodations.getPaxNumBasedOnRooms(e.rooms,e.numberOfRooms)),this.onSearch(_.omit(e,"newRoomFormat"),"dpresults",App.Dynpack.searchParamsStringify)},onFlightManagerSearch:function(e){e.isXsellTab=(Odigeo.AB.isXsellHomePageNewTab||Odigeo.AB.isSearchExtensionFilteredByBrowser)&&"true"!==Odigeo.Session.get("isSearchExtensionShown")&&!0===Odigeo.UIElements.translations.xsellHomePage.hasHotelTab&&!e.isInspirationalSearch,this.onSearch(e)},onDynpackSearchFromFlights:function(e){_.extend(e,App.Accommodations.allocateRooms(e)),this.onSearch(_.omit(e,"newRoomFormat"),"dpresults",App.Dynpack.searchParamsStringify)},onPreSearchPerformed:function(){U().execute("setHasToShowLuckyLayer")},onStoreSearch:function(e){Odigeo.requireWidget("previous-searches","previoussearches",function(t){t.execute("storeData",e)})},onPrepareSearchSummary:function(e){Odigeo.requireWidget("page-title","page_title",function(e){e.execute("refresh")}),Odigeo.requireWidget("results-search-summary","searchsummary",function(e){e.execute("refresh")}),Odigeo.AB.faresInCalendar!==Odigeo.Utils.Partition.C&&"multipleTrip"!==e.type&&Odigeo.requireWidget("itinerary_search_manager","itinerary_search_manager",function(t){t.updateFlexibleDates(e)})},onPrepareResultsManager:function(e){Odigeo.requireWidget("fullprice-manager","full_price_manager",function(t){t.execute("loadSelectorBaggage",e)}),Odigeo.trigger("fillWaitingPage",e),Odigeo.UIElements.enhanceCounter("#numbers-combinations",100,125e4,0,20),Odigeo.trigger("collapseSearchPanel"),Odigeo.trigger("collapseFilters")},onShowWaitingPage:function(){Odigeo.AB.isFixWaitingPageDesktop&&(w.removeClass("odf-hidden"),O.removeClass("odf-hidden")),Odigeo.UIElements.enhanceLoading($(".waiting_page")).showLoading(["waiting_searching","waiting_connection_container","waiting_bottom_gradient","waiting_ad_box"])},onAnalyticsTrackingEvents:function(t){if(t.buyPath&&-1<t.buyPath.indexOf("HOME")){var i=v?"dynpack_tab":"flights"===Odigeo.SessionScope.entryPoint?"flights_tab":"home";e.trackEvent("searcher_flights","number_pax_"+t.numAdults+"_"+t.numChildren+"_"+t.numInfants,i),t.flexibleDates&&e.trackEvent("searcher_flights","search_flexible_checked"),t.directFlightsOnly&&e.trackEvent("searcher_flights","direct_flights_checked",i)}},onSearchPerformed:function(e){Odigeo.requireWidget("search-manager","searchmanager",function(t){t.execute("throwSearchPerformedEvents",e)})},onSearchError:function(){var t=$(".flightspage_section").find("#results-manager"),i=$("#filters-manager"),n=$("#bread-crumbs");Odigeo.requireWidget("flights-manager","flightsmanager",function(e){e.execute("changeSearchButtonsState",!1)}),t.addClass("hidden"),i.addClass("hidden"),n.addClass("hidden"),$(".filters_container, .page-title").addClass("hidden"),K(),_.delay(function(){Odigeo.UIElements.enhanceLoading($(".waiting_page")).hideLoading()},500),e.trackPage("results",{funnel:!0,error:{type:"default",message:"search_error"}})},onSearchCompletedWithError:function(e){var t=_.first(e);t&&"NO_ITINERARIES_RESULTS"===t.code?K():Odigeo.UIElements.showBrokenFlowError()},onSearchCompletedSuccessfully:function(e){if(Odigeo.Storage.set("results_count",e.numResults),e.numResults<1)K();else{$(".flightspage_section #results-manager").removeClass("hidden"),$(".filters_container, .page-title").removeClass("hidden"),Odigeo.requireWidget("filters-manager","filters_manager",function(e){e.execute("loadFilters"),$("#filters-manager, .filters_container").removeClass("hidden")});var t=Odigeo.Utils.parseJson(Odigeo.Session.get("searchParameters"));e.tripType=_.isNull(t)?null:t.type,Odigeo.requireWidget("flexible-dates","flexible_dates",function(t){t.execute("updateView",_.pick(e,"cheapestItineraryPrice","fastestItineraryTaggingPrice","maxDurationThreshold","slowFlightsTaggingTabEnabled","tripType","cheapestItineraryProviderPrice","cheapestItinerarySH","cheapestItineraryCollectionMethodPrice","firstSortedByDurationTaggingPrice"))}),Odigeo.AB.isFlexibleDatesOWActive&&t&&"oneWayTrip"===t.type&&Odigeo.requireWidget("calendar-grid","calendar_grid",function(e){e.execute("refreshSearchPrice")}),Odigeo.AB.faresInCalendar!==Odigeo.Utils.Partition.C&&(Odigeo.requireWidget("itinerary_search_manager","itinerary_search_manager",function(t){t.setCheapestPrice(e.cheapestItineraryPrice)}),Odigeo.requireWidget("flights-manager","flightsmanager",function(t){t.trackSearchWithFares(e.cheapestItineraryPrice)}))}},onSearchMapiCompletedWithError:function(e){if("PASSENGER"===e){var t=JSON.parse(Odigeo.Session.get("searchParameters"));Odigeo.requireWidget("search-manager","searchmanager",function(e){e.execute("performSearch",{params:App.Flights.searchParamsStringify(t)})})}else"results"===Odigeo.History.getPageNameFromFragment()&&this.onSearchCompletedWithError()},onStartMapiMetric:function(t){var i={RESULT:"LOAD_META_RESULTS",PASSENGER:"LOAD_META_PASSENGERS",INTERMEDIATE:"LOAD_META_INTERMEDIATE"};e.startMetric(i[t]),"PASSENGER"===t&&e.startMetric(i.INTERMEDIATE)},onSearchMapiCompletedSuccessfully:function(e,t){"PASSENGER"===e?Odigeo.Router.navigate("details"):"INTERMEDIATE"===e?this.goToIntermediatePageMapi(t):this.onSearchCompletedSuccessfully(t)},goToIntermediatePageMapi:function(e){var t;App.Flights.getSearchData().then(function(i){var n,a;t={data:{fareItineraryKey:i.externalSelectionRequest.fareItineraryKey,segmentKeys:(n=i.externalSelectionRequest.segmentKeys,a=[],_.forEach(n,function(e){a.push(e.split(",",1))}),_.flatten(a)),searchId:i.externalSelectionRequest.searchId},flightNumbers:i.externalSelectionRequest.segmentKeys},Odigeo.Session.set("flightSelectionData",JSON.stringify(t)),Odigeo.Session.set("intPageAccommodationResults",JSON.stringify(e)),Odigeo.Session.set("isMetaForIntermediate",!0),Odigeo.Session.set("isAccommodationPostBooking",!1),Odigeo.Router.navigate("xsellproductselection")})},onTrackAutocomplete:function(t){var i="dp"===$("#flights-manager").find(".flightsManager_tab.active").data("value");e.trackEvent(t.action+(i?"dynpack":"flights"),t.label,t.page)},allowToRefreshResults:function(e){N.getResultsManager().execute("allowToRefresh",e)},doCheckNonStopsFilter:function(e){M.stopoverQuantityFilter(e.tabId).execute("doCheckNonStopsFilter",e)},updateStopoverDurationFilter:function(e,t){M.stopoverDurationFilter(e).execute("updateFilter",e,t)},updateTimeFilter:function(e,t,i){M.timeFilter(e).execute("updateFilter",e,t,i)},updateFlightDurationFilter:function(e,t){M.flightDurationFilter(e).execute("updateFilter",e,t)},updateAirlinesFilter:function(e,t,i){M.airlinesFilter(e).execute("updateFilter",e,t,i)},updateAirportsFilter:function(e,t){M.airportsFilter(e).execute("updateFilter",e,t)},initFilterByCities:function(){N.getFilterByCities()}}},searchAccommodationEventController:{globalEvents:{"dpsearch-manager:navigateHome":"onNavigateHome"},viewEvents:{"dp-automatic-refresh:openSessionExpired":"onOpenErrorManager","dp-search-no-results:launchNewSearch":"onNavigateHome"},eventHandlers:{onNavigateHome:function(){Odigeo.Session.set("page","home"),Odigeo.Utils.goToApplicationHome(Odigeo.Utils.isRequestApp("dp"))}}}})}})}})},function(e,t,i){"use strict";var n=function(e){this.buyPath=e};n.prototype.build=function(){return this.buyPath},e.exports=n},function(e,t,i){"use strict";var n=function(e,t,i){this.resultPage=e,this.dynpackBuyPath=t,this.flightsBuyPath=i};n.prototype.build=function(){return App.Flights.isDpFlightsResults(this.resultPage)?this.dynpackBuyPath:this.flightsBuyPath},e.exports=n},function(e,t,i){"use strict";var n=function(e){this.isCalendarSearch=e};n.prototype.build=function(){return this.isCalendarSearch?"CALENDAR_SEARCH_FLEXIBLE_DATES":"FLIGHTS_RESULTS_SEARCH_FORM"},e.exports=n},function(e,t,i){"use strict";e.exports=function(){var e=function(e){var t=window.tmParam,i=window.tc_vars;_.isFunction(window.usabilla_live)&&(t.usabilla_exit_var=e.type===Odigeo.Events.mouseLeave?1:0,window.usabilla_live("data",{custom:_.assign({},t,i)}))},t=function(t){t.clientY<=0&&e(t)},i=function(t){var i=.2*innerWidth,n=-1!==navigator.platform.indexOf("Linux")&&t.clientX<i||-1!==navigator.platform.indexOf("Win")&&t.clientX>innerWidth-i||-1!==navigator.platform.indexOf("Mac")&&t.clientX<i;t.clientY<=0&&n&&e(t)},n=$("body");switch(Odigeo.AB.exitSurveyTrigger){case 2:n.off(Odigeo.Events.mouseLeave,t).on(Odigeo.Events.mouseLeave,t);break;case 3:n.off(Odigeo.Events.mouseLeave,i).on(Odigeo.Events.mouseLeave,i);break;default:n.on(Odigeo.Events.mouseLeave+" "+Odigeo.Events.mouseEnter,e)}}},function(e,t,i){"use strict";function n(e,t){var i=e||"Notification"in window,n=t||window.Notification;return{ERROR:"Notification are not enabled in this browser",isEnabled:function(){return i},getPermission:function(){return i?n.permission:void 0},requestPermission:function(){var e=$.Deferred();if(i)if("granted"!==n.permission){var t=_.once(function(t){e.resolve(t)}),a=n.requestPermission(t);_.isFunction(a.then)&&a.then(t)}else e.resolve(n.permission);else e.reject(this.ERROR);return e.promise()},send:function(e,t,a,s){var r,o=$.Deferred(),c={icon:Odigeo.Utils.getImageFromCDN("onefront/bluestone/"+Odigeo.SessionScope.brand+"/OpenGraph.png")};return i&&"granted"===n.permission?(_.extend(c,t),r=new n(e,c),_.isFunction(a)&&(r.onclick=a),_.isFunction(s)&&(r.onclose=s),o.resolve(r)):o.reject(this.ERROR),o.promise()}}}var a;e.exports.Notification=n,e.exports.notificationService=function(){return _.isUndefined(a)&&(a=new n),a}},function(e,t,i){"use strict";var n=i(946);e.exports=Odigeo.View.extend({initialize:function(e){this.model=new n({},{departureOrArrival:e.departureOrArrival,showNearestLocations:e.showNearestLocations}),this.parent=e.parent,this.template=e.template||_.template(this.parent.$el.find("#airport_selector_template").html(),Odigeo.Utils.getTmplSettings({variable:null})),this.autocomplete=new Odigeo.UIElements.Autocomplete(this.$el,this.model,{tmpl:e.templateAutoComplete||_.template(this.parent.$el.find("#airport_autocomplete_template").html(),Odigeo.Utils.getTmplSettings({variable:null})),tmplZero:e.templateAutoCompleteZero||_.template(this.parent.$el.find("#airport_autocomplete_zero_results").html(),Odigeo.Utils.getTmplSettings({variable:null})),zeroMsg:e.errorMessages.zeroResults}),this.placeholder=e.placeholder,this.tabIndex=e.tabIndex,this.render(),this.setCallbacks(e.callbacks),this.$input=this.$el.find(this.selectors.input),this.$airportContainer=this.$input.parent(),this.listenTo(this.model,"change:selectedLocation",this.setInputValue),this.listenTo(this.model,"change:selectedLocation",this.updateSearchSegments),this.parent.model.listenSearchModelProperty("type",_.bind(this.updateInputWidth,this))},selectors:{input:".airport_selector_input"},events:{"focus .airport_selector_input":"onInputFocus","input .airport_selector_input":"onInputChange","blur .airport_selector_input":"onInputBlur","mousedown .autocomplete_item":"onSelectSuggestion","keyup .airport_selector_input":"onKeyPress"},skipInputBlur:!1,setCallbacks:function(e){this.onFocusCb=e.onFocus},render:function(){return this.$el.html(this.template({placeholder:this.placeholder,tabIndex:this.tabIndex,isOneWay:this.parent.model.isOneWay()})),this},updateInputWidth:function(){this.$el.toggleClass("one-way",this.parent.model.isOneWay())},setInputValue:function(){var e=(this.model.get("selectedLocation")||{}).name||"";this.$input.val(e)},updateSearchSegments:function(){this.parent.model.trigger("update")},onInputFocus:function(){var e=this.$input.val().trim();this.$input.select(),this.model.set({searchWord:e}),this.model.trigger("autocomplete"),this.onFocusCb&&this.onFocusCb(this)},showError:function(){this.$airportContainer.addClass("error")},removeError:function(){this.$airportContainer.removeClass("error")},onInputChange:function(e){this.model.set({searchWord:e.currentTarget.value.trim()})},onInputBlur:function(){_.delay(_.bind(function(){var e=this.model.get("autocompleteSuggestions"),t=this.$el.find(".autocomplete_item.hover"),i=this.model.get("searchWord"),n=this.model.get("selectedLocation"),a=t.data("index"),s=t.data("related-index");this.skipInputBlur?this.skipInputBlur=!1:(this.$el.removeClass("open empty"),3<=i.length&&!_.isEmpty(e)&&(n=e[a],s&&(n=n.relatedLocations[s]),this.model.set("selectedLocation",n)),this.setInputValue())},this),100)},onSelectSuggestion:function(e){e.preventDefault(),e.stopPropagation();var t=this.model.get("autocompleteSuggestions"),i=this.$el.find(e.currentTarget).data("index"),n=this.$el.find(e.currentTarget).data("related-index"),a=t[i];_.isNumber(n)&&(a=a.relatedLocations[n]),this.model.set("selectedLocation",a),this.skipInputBlur=!0,this.$el.find(this.selectors.input).trigger("blur"),this.trigger("fulfilled")},onKeyPress:function(e){var t=e.keyCode||e.which,i=[Odigeo.Events.keys.KEY_UP,Odigeo.Events.keys.KEY_DOWN,Odigeo.Events.keys.KEY_RETURN];_.contains(i,t)&&this.executeKey(t)},executeKey:function(e){var t={};t[Odigeo.Events.keys.KEY_RETURN]=_.bind(this.onReturnKeyPressed,this),t[Odigeo.Events.keys.KEY_UP]=_.bind(this.onUpDownKeyPressed,this),t[Odigeo.Events.keys.KEY_DOWN]=_.bind(this.onUpDownKeyPressed,this),t[e](e)},onReturnKeyPressed:function(){var e=this.$el.find(".autocomplete_item.hover");this.$el.find(this.selectors.input).trigger("blur"),this.$el.hasClass("open")&&0<e.length&&(e.trigger("tap"),this.$el.removeClass("open"))},onUpDownKeyPressed:function(e){var t,i=this.$el.find(".autocomplete_item"),n=this.$el.find(".autocomplete_item.hover").index();this.$el.hasClass("open")&&0<i.length&&(t=n+(e===Odigeo.Events.keys.KEY_UP?-1:1),i.eq(n).removeClass("hover"),i.eq(t).addClass("hover"))},isEmptyOrHasError:function(){return!this.model.get("selectedLocation")||this.$airportContainer.hasClass("error")},setFocus:function(){this.onInputFocus()}})},function(e,t,i){"use strict";var n=i(947);e.exports=Odigeo.View.extend({initialize:function(e){this.parent=e.parent,this.model=new n,this.tabIndex=e.tabIndex,this.template=e.template||_.template(this.parent.$el.find("#date_selector_template").html(),Odigeo.Utils.getTmplSettings({variable:null})),this.render(),this.$datepicker=this.$el.find(".date_selector_input");var t={format:e.format,index:e.index,faresInCalendar:e.faresInCalendar,hideFaresInCalendar:e.hideFaresInCalendar,hasFaresInCalendarLegend:e.hasFaresInCalendarLegend,hasFaresInCalendarLegendWithAmount:e.hasFaresInCalendarLegendWithAmount,closeDelay:0,permissible:!0,placeholder:e.placeholder,closeButton:e.closeButton,skipHide:!0,type:e.type};e.datepickerClasses&&(t=_.extend(t,e.datepickerClasses)),Odigeo.UIElements.enhanceDatepicker(this.$datepicker,t),this.setCallbacks(e.callbacks),this.setListeners(),this.updateCalendarDates()},setListeners:function(){this.$datepicker.on(Odigeo.Events.change,_.bind(this.onChangeDateSelector,this)),this.$datepicker.on(Odigeo.Events.blur,_.bind(this.checkErrors,this)),this.$datepicker.closest(".datepicker").on(Odigeo.Events.tap,_.bind(this.onClickDateSelector,this)),this.listenTo(this.model,"change:selectedDate",this.updateSearchSegments),this.listenTo(this.model,"change:selectedDate",this.setInputValue),Odigeo.on("DateSelectorView:updateDates",_.bind(this.updateCalendarDates,this))},onClickDateSelector:function(){_.isUndefined(this.onFocusCb)||this.onFocusCb(this)},onChangeDateSelector:function(e,t){this.model.set("selectedDate",t.selectedDate)},checkErrors:function(){_.isNull(this.model.get("selectedDate"))&&this.triggerError()},setCallbacks:function(e){this.onFocusCb=e.onFocus},setInputValue:function(){var e=this.model.get("selectedDate");this.$datepicker.trigger("config",{value:e}),Odigeo.trigger("DateSelectorView:updateDates"),e&&this.trigger("fulfilled")},updateCalendarDates:function(){var e=this.parent.model.getDates();this.$datepicker.trigger("config",{dates:e})},updateCalendarType:function(){var e={type:{oneWayTrip:"single",roundTrip:"dual",multiTrip:"multiple"}[this.parent.model.getOriginalData().type],permissible:!this.parent.model.isOneWay()};this.$datepicker.trigger("config",e),this.updateCalendarDates()},updateSearchSegments:function(){this.parent.model.trigger("update")},open:function(){this.$datepicker.trigger("open")},toggle:function(e){this.$el.toggleClass("odf-hidden",!e)},triggerError:function(){this.$datepicker.trigger("error","invalid")},removeError:function(){this.$datepicker.trigger("clearError")},render:function(){return this.$el.html(this.template({tabIndex:this.tabIndex})),this},isEmptyOrHasError:function(){return!this.model.get("selectedDate")||!!this.$datepicker.data("error")},setFocus:function(){this.open()}})},function(e,t,i){"use strict";e.exports=function(e){this.childrenViews=e,this.onChildFulfilled=function(){this.isEmptyOrHasError()&&this.setFocus()},this.isEmptyOrHasError=function(){return _.some(this.childrenViews,function(e){return e.isEmptyOrHasError()})},this.setFocus=function(){var e=_.chain(this.childrenViews).filter(function(e){return e.isEmptyOrHasError()}).head().value();e&&e.setFocus()}}},,,function(e,t,i){"use strict";var n=function(e){this.helper=e};n.prototype.getMixin=function(){return _.clone(this.helper)},n.prototype.extend=function(e){return _.extend({},this.helper,e)},e.exports=n},function(e,t,i){"use strict";var n={seatStatus:{unavailable:"unavailable",no_seat:"no_seat",aisle:"available",window:"available",middle:"available"},keys:{},seatMap:{}},a={EMPTY_ROW:-2,BLANK_SEATS:-1,NO_SEATS:0,LAVATORY:"LAVATORY",EXTRA_LEG:"EXTRA_LEG",BLANK_SPACE:" ",PREFERRED_TYPE:"preferred",EXTRA_LEG_TYPE:"extra",STANDARD_TYPE:"standard",CHEAPER_TYPE:"smart",CLASS_X_LEG:"aircraftmap_extra_leg_room",CLASS_PREFFERED:"aircraftmap_preferred_seat",CLASS_CHEAPER:"aircraftmap_cheaper_seat",CLASS_STANDARD:"aircraftmap_default_seat"};e.exports={defaults:n,constants:a,options:{},parseOptions:function(e){return _.extend({},n,e)},isNoSeat:function(e){return e.type===this.options.seatStatus.no_seat},isSeatLavatory:function(e){return _.contains(e,a.LAVATORY)},getNoSeatType:function(e){return this.isSeatLavatory(e)?"od-aircraftmap-noseat-lavatory odf-icon-lavatory ":""},hasExtraLegCharacteristic:function(e){return!_.isEmpty(e.characteristics.characteristic)&&_.contains(e.characteristics.characteristic,a.EXTRA_LEG)},hasPreferredSeatCharacteristic:function(e,t){return 0<t&&e.rawPrice>=t},getSeatRow:function(e){return _.find(e,function(e){return e.seatRow!==a.BLANK_SEATS}).seatRow},getSeatCharacteristicClassByType:function(e){var t;switch(e){case a.PREFERRED_TYPE:t=a.CLASS_PREFFERED;break;case a.EXTRA_LEG_TYPE:t=a.CLASS_X_LEG;break;case a.CHEAPER_TYPE:t=a.CLASS_CHEAPER;break;default:t=a.CLASS_STANDARD}return t},isRowWithoutSeats:function(e){return _.size(_.filter(e,{seatRow:a.BLANK_SEATS}))===_.size(e)},isExitRow:function(e,t){return _.gt(_.indexOf(e,t),-1)},isSeatExtraLeg:function(e,t,i){return _.gt(_.indexOf(e,t+i),-1)},getCustomRowElement:function(e,t){return _.isString(e)?e.split(t):""},getSeatRowFromSeatMapRow:function(e,t){var i=_.filter(e.seats.seat,{seatMapRow:t});return 0<_.size(i)?this.isRowWithoutSeats(i)?this.findLavatories(i):this.getSeatRow(i):a.NO_SEATS},findLavatories:function(e){return this.rowContainsLavatories(e)?a.BLANK_SEATS:a.EMPTY_ROW},rowContainsLavatories:function(e){return _.some(e,function(e){return!_.isUndefined(e.seatCharacteristics.characteristic)&&this.isSeatLavatory(e.seatCharacteristics.characteristic)},this)},addExitRow:function(e){var t=Odigeo.AB.isSeatmapMobileColors?"od-exit-row-color ":"";return $("<div>",{class:t+"aircraftmap_exit_row od-aircraftmap-exit-row"}).attr("data-exit-row",e).append($("<div>",{class:"odf-icon od-exit-row-icon odf-text-lg odf-icon-arrow-left-double od-exit-row-icon-left"})).append($("<div>",{class:"odf-icon od-exit-row-icon odf-text-lg odf-icon-arrow-right-double od-exit-row-icon-right"}))},getSeatCharacteristics:function(e,t,i,n){var s=_.find(e.seats.seat,{seatMapRow:i,column:n});_.isUndefined(s)&&(s=_.find(e.seats.seat,{seatRow:a.BLANK_SEATS,seatMapRow:i,column:n}));var r=!_.isUndefined(s),o=r?s.type.toLowerCase():this.options.seatStatus.unavailable,c=r?Odigeo.Utils.formatCurrency(s.totalPrice):"",d=r?s.totalPrice:"";return{row:t,seatMapRow:i,characteristics:r?s.seatCharacteristics:[],column:n,type:o,status:this.options.seatStatus[o],key:this.options.keys[o],price:c,rawPrice:d}},addDarkZone:function(e){var t=e.lastSeatsRow+1,i=e.lastSeatsRow+this.getNumRowsBetweenNeighborCabins(e),n=_.gt(this.getNumRowsBetweenNeighborCabins(e),1)?"darkzoneMultiRow":"darkzoneSingleRow",a=_.gt(this.getNumRowsBetweenNeighborCabins(e),1)?Odigeo.Utils.replaceCmsKeyArgs(this.options.keys[n],t,i):Odigeo.Utils.replaceCmsKeyArgs(this.options.keys[n],t);return $("<div>",{class:"od-aircraftmap-darkzone odf-text-sm"}).text(a)},getNumRowsBetweenNeighborCabins:function(e){var t=this.options.seatMap.cabin,i=t[_.findIndex(t,e)+1];return _.isUndefined(i)?0:i.firstSeatsRow-e.lastSeatsRow-1},isLastCabin:function(e){return _.eq(_.last(this.options.seatMap.cabin),e)},hasToShowDarkZone:function(e){return _.gt(_.size(this.options.seatMap.cabin),0)&&this.areSpacesBetweenCabins(e)&&!this.isLastCabin(e)},aircraftContainsDarkZones:function(e){return _.gt(_.size(e.cabin),1)&&_.reduce(e.cabin,function(e,t){return e||this.hasToShowDarkZone(t)},!1,this)},isExtraLegSeat:function(e){return 0<e.find(".aircraftmap_extra_leg_room").length},isEmergencyExitSeat:function(e){return e.parent().hasClass("emergency_exit")},isCheaperSeatCharacteristic:function(e){return e.rawPrice===this.cheaperSeatPrice&&2<=this.differentSeatPrices.length},areSpacesBetweenCabins:function(e){return!this.isLastCabin(e)&&_.gt(this.getNumRowsBetweenNeighborCabins(e),0)},setSeatPriceData:function(e){var t=_.reduce(e,function(e,t){var i=_.filter(t.seats.seat,function(e){return"NO_SEAT"!==e.type});return e.concat(i)},[]);this.differentSeatPrices=_.uniq(t,"totalPrice"),this.cheaperSeatPrice=_.min(_.map(t,"totalPrice"))},isUnavailableOrNoSeat:function(e){return this.isNoSeat(e)||e.type===this.options.seatStatus.unavailable}}},function(e,t,i){"use strict";e.exports={getUrl:function(){return"getusertype"},getMethod:function(){return"PUT"},requestSuccess:function(e){Odigeo.trigger(this.widget.id+":getUserTypeOk",e)},requestError:function(){Odigeo.trigger(this.widget.id+":getUserTypeFail")}}},function(e,t,i){"use strict";var n="sidebarsummary"===$(".side_summary_payment").data("type"),a=Odigeo.autoloadWidgetsAsync({getUsersManager:["users-manager","usersmanager"],getBinDetection:["payment-bin-detection-manager","bindetectionmanager"],getPaymentManager:["payment-manager","paymentmanager"],getInvoiceManager:["invoice-manager","invoice_manager"],getPriceManager:["price-breakdown-payments","pricemanager"],getCollapsibleSummary:["collapsible-flight-summary-payment","collapsible_flight_summary"],getSidebar:n?["sidebar-summary-payment","sidebar_summary"]:["trip-summary-price-payment","trip_summary_price"]});e.exports={viewEvents:function(){return{"global:userLogged":"onLoggedUser","global:userNotLogged":"onNotLoggedUser","global:userLogout":"onNotLoggedUser","repricing-popup-manager:confirmRepricing":"onConfirmRepricing","payment-manager:getCreditCards":"onGetCreditCards","payment-manager:addCreditCards":"onAddCreditCards","payment-manager:deleteCreditCards":"onDeleteCreditCards","payment-manager:storedCardChanged":"onCcMethodTypeSelected","expanded-summary:panelCollapsed":"onExpandedSummaryClosed","collapsed-summary:panelCollapsed":"onCollapsedSummaryClosed","users-manager:deleteCreditCardsOk":"onDeleteCreditCardsOK","users-manager:getCreditCardOk":"onStoredCreditCard","users-manager:addCreditCardsOk":"onStoredCreditCard","promotional-codes:updatePrices":"onPromotionalCodesUpdatePrices",deleteStoredCreditCardHide:"onCloseRemoveCreditCardHint"}},eventHandlers:function(){return{onGetCreditCards:function(){a.getUsersManager().execute("submitUserRequest",{action:"getCreditCard"})},onAddCreditCards:function(e){a.getUsersManager().execute("submitUserRequest",{action:"addCreditCards",data:e})},onDeleteCreditCards:function(e){a.getUsersManager().execute("submitUserRequest",{action:"deleteCreditCards",data:e})},onDeleteCreditCardsOK:function(e){var t=a.getPaymentManager();t.execute("creditCardRemoved"),t.execute("setCreditCards",e)},onStoredCreditCard:function(e){var t=a.getPaymentManager();t.execute("setCreditCards",e),t.execute("isStoredCardsAvailability")&&(Odigeo.AB.isCvvCleanedAfterRepricing||t.execute("cleanInputs",!0),a.getBinDetection().execute("triggerInputEventOnCreditCardInput"))},onCollapsedSummaryClosed:function(){a.getCollapsibleSummary().execute("expandSummaryPanel",!0)},onExpandedSummaryClosed:function(){a.getCollapsibleSummary().execute("expandSummaryPanel",!1)},onLoggedUser:function(e){if(a.getPaymentManager().execute("userLogged",e.userDTO),a.getInvoiceManager().execute("userLogged",e.userDTO),!_.isEmpty(e.userDTO.membershipInfoDTO.membershipDTO)&&!_.isEmpty(e.userDTO.membershipInfoDTO.errorDTOs)){var t=_.head(e.userDTO.membershipInfoDTO.errorDTOs),i=!_.isUndefined(t.code)&&"UNL_VELOCITY_RULES_EXCEDEED"===t.code;a.getSidebar().execute("updateIsPrimeBlocked",i)}},onNotLoggedUser:function(){a.getPaymentManager().execute("userNotLogged")},onCloseRemoveCreditCardHint:function(){a.getPaymentManager().execute("removeCreditCardHintClosed")},onConfirmRepricing:function(){a.getPaymentManager().execute("commit",!1)}}},isLoggedIn:function(){_.isNull(Odigeo.Session.storage.lastRouteChange)||a.getUsersManager().execute("submitUserRequest",{data:"",action:"isLoggedIn"})}}},function(e,t,i){"use strict";var n=i(500),a=i(358);e.exports=n.extend({className:"insurances",events:_.extend({"click @insuranceFooterLink":"onClickInsuranceFooterLegalLink","change .ancillaries_checkbox":"onAncillariesCheckBoxChange"},n.prototype.events),selectors:_.extend({insuranceElements:".insurance_element",insuranceFooterLink:".insurance_footer_link"},n.prototype.selectors),parseDataBeforeInsertTemplate:function(e){n.prototype.parseDataBeforeInsertTemplate.apply(this,arguments);var t=this.model.isInPreRejectedState()||this.model.isRejected();_.extend(e,{rejectAllCheckedAttribute:t?"checked":"",hasMandatoryProduct:this.model.hasMandatoryProductInMultiOffer(),inputAndLabelConfig:this.getInputAndLabelConfig()})},parseTextsAndAttributes:function(e){n.prototype.parseTextsAndAttributes.apply(this,arguments),this.parseCheckedAttribute(e),this.parseFooterLink(e),this.parseFooterInsuranceLink(e),this.parseFooterInsuranceLinkFr(e)},parseCheckedAttribute:function(e){e.checkedAttribute=this.model.isSelected(_.get(e,"policy"))?"checked":""},parseFooterLink:function(e){var t=$("<div>");t.append($("<a>",{class:"odf-link odf-link-sm odf-link-legal insurance_footer_link","data-policy":_.get(e,"policy"),href:_.get(e,"urlExtended"),target:"_blank",text:_.get(e,"texts.footerLink")})),_.extend(e.texts,{parsedFooter:Odigeo.Utils.replaceCmsKeyArgs(e.texts.footer,t.html())})},enhanceHintPopup:function(e){var t=this,i=$(e),n=i.find(".hint_container"),a=i.data("policy"),s=this.model.getPopupTextsByPolicy(a),r={clickConditions:function(e){t.widget.tracking.clickConditionsFromPopup(a,e)}};Odigeo.UIElements.enhanceConditionsPopup(n,s,r,{linkFontSizeModifierClass:"odf-link-sm"}),Odigeo.UIElements.hint.enhance(Odigeo.History.getPageNameFromFragment(),i,{events:{tap:!0},googleAnalyticsOnOpen:{type:"trackEvent",data:this.widget.tracking.getTrackData("open_coverage",a)},googleAnalyticsOnCloseButton:{type:"trackEvent",data:this.widget.tracking.getTrackData("close_coverage",a)},recalculate:!0})},onAncillariesButtonClickToggle:function(e){e.preventDefault(),e.stopPropagation();var t=this.model.isMultiOffer()?e.target.value:this.model.get("policy");this.model.isMultiOffer()&&this.model.isSelected(t)||n.prototype.onAncillariesButtonClickToggle.apply(this,arguments)},onClickInsuranceFooterLegalLink:function(e){var t=$(e.target).data("policy");this.widget.tracking.openConditionsLong(t)},onNagRejected:function(e){if(e===a.NAG_TYPE.reject){var t=this.model.getAddedPolicy()||this.model.getRejectedPolicy();this.model.selectProduct(!1,t)}else e===a.NAG_TYPE.continuance&&(_.isNull(this.model.getAddedPolicy())&&this.model.selectProduct(!1,this.model.getRejectedPolicy()),Odigeo.trigger(this.widget.name+":onContinuanceNagRejected"))},onAncillariesCheckBoxChange:function(e){e.preventDefault(),e.stopPropagation();var t=this.model.isMultiOffer()?e.target.value:this.model.get("policy");this.model.toggleSelected(t)},getInputAndLabelConfig:function(){return{checkBox:{inputType:"checkbox",inputSelector:"ancillaries_checkbox",labelBack:"odf-checkbox-back",labelFill:"odf-checkbox-fill"},radio:{inputType:"radio",inputSelector:"ancillaries_add_button",labelBack:"odf-radio-back",labelFill:"odf-radio-fill"}}[this.model.hasMandatoryProductInMultiOffer()?"checkBox":"radio"]},parseFooterInsuranceLink:function(e){var t=this.getTemplateBuilder("links/insuranceFooterLink")({tmpl:e});_.extend(e.texts,{parsedFooterInsurance:Odigeo.Utils.replaceCmsKeyArgs(e.texts.footer,t)})},parseFooterInsuranceLinkFr:function(e){var t=this.getTemplateBuilder("links/insuranceFooterLinkFr")({tmpl:e});_.extend(e.texts,{parsedFooterInsuranceFr:Odigeo.Utils.replaceCmsKeyArgs(e.texts.footer,t)})}})},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,i){"use strict";Odigeo.defineWidget("share_itinerary",Odigeo.Widget.extend({modelClass:i(700),viewClass:i(701)}))},function(e,t,i){"use strict";e.exports=Odigeo.Model.extend({defaultParams:{landingPageType:"PASSENGER",searchMainProductTypeName:"FLIGHT",utm_medium:"crm",utm_source:"sg",utm_campaign:"t",utm_term:"share_flight",mktportal:"T"},utmParams:{telesales:{utm_term:"share_flight_telesales"},whatsApp:{utm_term:"searchreminder_flight_whatsapp"}},keyMap:{searchId:"searchId",fareItineraryKey:"fareItineraryKey"},init:function(){this.set("linkType","telesales"===Odigeo.SessionScope.mktPortal.toLowerCase()?"telesales":"shareLink"),this.setShareLink()},addSegmentKeys:function(e){return _.reduce(e,function(e,t,i){return e["segmentKey"+i]=t,e},{})},addShareParams:function(){return{sharePrice:this.widget.options.price}},parseSelectionLinkParams:function(e,t,i){var n=_.extend({},this.defaultParams,t,_.pick(e,_.keys(this.keyMap)),this.addSegmentKeys(e.flightNumbers?e.flightNumbers:e.segmentKeys),this.addShareParams());return"?"+(i?decodeURIComponent($.param(n)):$.param(n))},parseSearchdata:function(e){this.buildlinks(e,e.externalSelectionRequest)},getLink:function(e,t,i,n){return location.protocol+"//"+App.Flights.getPath({searchParams:App.Flights.searchParamsStringify(e),flightData:this.parseSelectionLinkParams(t,i,n),page:"results"})},buildlinks:function(e,t){this.set({shareLink:this.getLink(e,t,null,!0),shareLinkWhatsapp:encodeURIComponent(this.getLink(e,t,this.utmParams.whatsApp,!1)),telesales:this.getLink(e,t,this.utmParams.telesales,!0)})},setShareLink:function(){var e;_.isNull(Odigeo.Session.get("flightSelectionData"))?App.Flights.getSearchData().then(_.bind(this.parseSearchdata,this)):(e=Odigeo.Utils.parseJson(Odigeo.Session.get("flightSelectionData"))||{},this.buildlinks(Odigeo.Utils.parseJson(Odigeo.Session.get("searchParameters")),e.data))}})},function(e,t,i){"use strict";var n=i(0);e.exports=Odigeo.View.extend({events:{"tap @deepLink":"onDeepLinkClick","tap @shareButtonEmail":"onShareButtonClick","tap @shareButtonTracking":"onShareButtonTracking"},selectors:{inputWrapper:".share_flight_wrapper",deepLink:".share_input_deeplink",tooltip:".share_tooltip",shareButtonEmail:".share_button_email",shareButtonTracking:".share_button_tracking",inputLink:".input_link"},tooltipTimeout:2e3,init:function(){var e=Odigeo.Utils.parseJson(Odigeo.Session.get("searchParameters"));_.isObject(e)&&_.includes(["oneWayTrip","roundTrip"],e.type)&&(this.widget.options=Odigeo.parseOptions(this.widget.options),this.renderTemplates(),this.updateDomSelectorsToCache())},renderTemplates:function(){this.$el.find(this.selectors.inputWrapper).html(this.templates.inputLink(this.getTemplateScope())),_.isFunction(this.templates.inputField)&&this.$el.find(this.selectors.inputLink).html(this.templates.inputField(this.getTemplateScope()))},toggleTooltip:function(e){this.$cachedSelectors.tooltip.toggleClass("active",e)},onDeepLinkClick:function(){Odigeo.Utils.copyToClipboard(this.$cachedSelectors.deepLink),this.showTooltip(),n.trackEvent("share_flight","copy_click")},onShareButtonTracking:function(e){n.trackEvent("share_flight",$(e.currentTarget).data("trackingButton"),null,!0)},onShareButtonClick:function(e){Odigeo.trigger(this.widget.id+":onShareEmailSearch",e,this.getEmailTemplateParams())},showTooltip:function(){this.toggleTooltip(!0),_.delay(_.bind(this.toggleTooltip,this,!1),this.tooltipTimeout)},plurarizeKeys:function(e){var t=Odigeo.Utils.parseJson(Odigeo.Session.get("searchParameters"));return e.shareTitle=Odigeo.Utils.pluralizeAll(e.shareTitle,t.searchSegments.length),e.emailTitleText=Odigeo.Utils.replaceCmsKeyArgs(e.emailTitleText,"sender_email_text",t.searchSegments.length),e.emailTitleText=Odigeo.Utils.pluralizeAll(e.emailTitleText,t.searchSegments.length),e},parsePriceToTemplate:function(e){var t=Odigeo.Utils.splitFormatedCurrency(e);return _.forEach(["sufix","prefix"],function(e){t[e]=t[e]?Odigeo.Utils.encodeToHtmlEntity(t[e]):""}),t},parseSearchParamsToTemplate:function(e){return _.forEach(e.searchSegments,function(e){e.dateStr=Odigeo.Utils.formatDate(e.dateStr,Odigeo.Utils.formatDate.masks.datepicker)}),e},checkDefaultEmail:function(){var e=Odigeo.Utils.parseJson(Odigeo.Session.get("passengersData"));return _.isObject(e)&&_.isObject(e.buyer)?e.buyer.mail:""},getEmailTemplateParams:function(){return{templateId:"share.deeplink",defaultPassenger:this.checkDefaultEmail(),emailTemplateParams:_.extend(this.keys,{link:this.model.get(this.model.get("linkType")),price:this.parsePriceToTemplate(this.widget.options.price),searchParams:this.parseSearchParamsToTemplate(Odigeo.Utils.parseJson(Odigeo.Session.get("searchParameters")))})}},getTemplateScope:function(){return{link:this.model.get(this.model.get("linkType")),whatsappLink:this.model.get("shareLinkWhatsapp"),keys:this.plurarizeKeys(this.keys)}}})},function(e,t,i){"use strict";var n=i(0),a=i(547),s=i(52);Odigeo.defineWidget("repricing_popup_manager",Odigeo.Widget.extend({concepts:{REPRICING:"r",ADULTS:"pa",CHILDREN:"pc",INFANTS:"pi",SERVICE_FEE:"fs",CC_FEE:"fc",INSURANCE:"i",BAGGAGES:"b",BAGGAGES_WEIGHT:"bw",PROMO_CODE:"cp",SERVICE_OPTIONS:"so",DISCOUNT_FEE:"fd",SEAT:"s",HOTEL:"h",MEMBERSHIP_SUBSCRIPTION:"ms"},modelClass:Odigeo.Model.extend(s.extend({init:function(){this.bindPriceSubscribers()},bindPriceSubscribers:function(){this.bindPriceCollection()},getCCFee:function(){var e=this.getItemByType("CC_FEE");return e&&Odigeo.AB.isDeactivateRepricingConcept?e.get("allPrice"):0},getRepricingValues:function(e){var t=this.get("repricing").newPrice,i=this.get("repricing").oldPrice;return Odigeo.AB.repricingPopupFromCollectionDataEnabled?t=_.isUndefined(e)?this.getPriceCollectionData().totalPrice:e:(t+=this.getCCFee(),i+=this.getCCFee()),{newPrice:Odigeo.Utils.splitFormatedCurrency(t),oldPrice:Odigeo.Utils.splitFormatedCurrency(i)}}})),viewClass:Odigeo.View.extend({events:{"tap @acceptRepricing":"onAcceptRepricing","tap @closePopup":"onClosePopupClick"},selectors:{popup:".repricing_popup",acceptRepricing:".confirm_repricing",closePopup:".cancel_repricing"},init:function(){this.widget.options=Odigeo.parseOptions(this.widget.options),this.listenTo(this.model,"change:show",_.bind(this.renderPopup,this)),this.listenTo(this.model,"priceCollection.repaintPrices",this.refreshPrices)},refreshPrices:function(){this.model.get("show")&&this.renderPopup()},closePopUp:function(e){n.trackEvent("repricing_popup","repricing_appearances_"+e,"payment"),this.removePopup()},onAcceptRepricing:function(){this.closePopUp(this.getRepricingTrackingLabel()),Odigeo.trigger(this.widget.id+":confirmRepricing")},onClosePopupClick:function(){Odigeo.Session.set("repricingClose","repricing_closed_purchase_"+this.getRepricingTrackingLabel()),this.closePopUp("close")},getRepricingTrackingLabel:function(){return"iprice:"+this.model.get("repricing").oldPrice+"_fprice:"+this.model.get("repricing").newPrice+"_pax:"+a.getNumberOfPassengers()},removePopup:function(){this.$cachedSelectors.popup.remove(),this.model.set("show",!1)},renderPopup:function(e){if(this.model.get("show")){var t=this.model.getRepricingValues(e);this.setTemplate(this.$el,"popup",_.extend(this.widget.options,{newPrice:t.newPrice,oldPrice:t.oldPrice}))}}}),setRepricing:function(e){var t=[].slice.call(arguments,0);this.model.get("show")||this.model.set({repricing:t[0],show:!0})},setNewPrice:function(e){this.model.get("show")&&!_.isUndefined(e)&&Odigeo.AB.repricingPopupFromCollectionDataEnabled&&this.view.renderPopup(e)}}))},function(e,t,i){"use strict";$(function(){var e=i(0),t=i(60),n=i(548),a=i(21),s=i(159),r=i(705),o=i(162),c=i(86).buildUrlFromConfirmationPage,d=i(549),l=i(551),g=i(490),h=i(553);Odigeo.defineWidget("confirmation_manager",Odigeo.Widget.extend({modelClass:Odigeo.Model.extend({bookingConfirmedUrl:"confirmed",bookingPendingUrl:"pending",bookingRejectedUrl:"rejected",bookingRetainedUrl:"retained",bookingBankTransfer:"banktransfer"}),viewClass:Odigeo.View.extend(o.deepExtend(s.deepExtend(t.extend({currency:null,tmplSelectors:{xsellingFooterTemplate:".xselling_footer_template"},pendingSelectors:{extraInfoContainer:"extra_info_container",extraInfoBtn:"extra_info_btn",angleIcon:"extra_info_btn_icon",confirmationMsg:"confirmation_msg",confirmationMsgOpen:"confirmation_msg_open",mainInfoContainer:"main_info_block"},isPendingDomBinded:!1,emergingLayer:null,xsellingData:{},selectors:{gtStandaloneBanner:".ground_transportation_banner",carsStandaloneBanner:".cars_standalone_banner"},init:function(){this.cacheDomSelectors(),this.currency=this.$widget.find(".repricing_error").data("currency"),this.bindToDom(),Odigeo.trigger(this.id+":init"),this.templates=Odigeo.Utils.getTemplates(this.$el,this.tmplSelectors)},events:{"tap .confirmation_info_mytrips":"onTapConfirmationInfoBtn","tap .my_trips_button":"onTapConfirmationInfoBtn","tap .room_details_lightBox":"openConditions","tap .hint_close":"closeConditions","tap .xsell_cars_widget_link":"openXsellLink","tap .xsell_hotels_widget_link":"openXsellLink"},cacheDomSelectors:function(){this.addSelectorToCache("error-template",this.$widget.find(".error_template")),this.addSelectorToCache("confirmationContainer",this.$widget.find("#confirmation_container")),this.addSelectorToCache("emergingLayerContainer",this.$widget.find(".emerging_layer")),this.addSelectorToCache("xsellingSummaryFooter",this.$widget.find(".xselling_summary_footer"))},cacheConfirmationPendingDomSelectors:function(){this.addSelectorToCache("extraInfoBtn",this.$widget.find("."+this.pendingSelectors.extraInfoBtn)),this.addSelectorToCache("extraInfoContainer",this.$widget.find("."+this.pendingSelectors.extraInfoContainer)),this.addSelectorToCache("angleIcon",this.$widget.find("."+this.pendingSelectors.angleIcon)),this.addSelectorToCache("confirmationMsg",this.$widget.find("."+this.pendingSelectors.confirmationMsg)),this.addSelectorToCache("confirmationMsgOpen",this.$widget.find("."+this.pendingSelectors.confirmationMsgOpen)),this.addSelectorToCache("mainInfoContainer",this.$widget.find("."+this.pendingSelectors.mainInfoContainer))},bindToDom:function(){this.isDomBinded||(this.isDomBinded=!0)},unbindFromDom:function(){this.isDomBinded&&(this.isDomBinded=!1),this.isPendingDomBinded&&(this.isPendingDomBinded=!1,this.$cachedSelectors.extraInfoBtn.unbind(Odigeo.Events.tap))},fillDaysLeft:function(){var e=this.$widget.find(".insert_date"),t=new Date(e.attr("data-id")),i=Odigeo.Utils.getRemainingDays(t.getTime());Odigeo.UIElements.drawArrow(this.$widget.find(".tip_arrow_confirmation"),"right"),e.html(i),$(".od-flightdetails-segment-itinerary-title").appendTo($('<div class="hidden"></div>')),$(".od-flightdetails-charter").appendTo($('<div class="hidden"></div>')),$(".od-itineraryDetails-section-det").appendTo($('<div class="hidden"></div>'))},fillPrices:function(e,t){$(t).find(".dialog_new_price").append(this.formatCurrency(e.newPrice)),$(t).find(".dialog_old_price").append(this.formatCurrency(e.oldPrice))},formatCurrency:function(e){return e=parseFloat(e),Odigeo.Utils.formatCurrency(e)},showErrorBrokenFlowDialog:function(){Odigeo.UIElements.showBrokenFlowError()},handleUserInteractionNeeded:function(e){Odigeo.trigger(this.widget.id+":userInteractionNeeded",e)},onTapConfirmationInfoBtn:function(t){this.isMyTripsDataInStorage()?this.goToMyTripsDetails(t):this.goToMyTrips(t);var i=this.widget.options.isDynpack?"dynpack":"flights";e.trackEventWithCategory(i+"_confirmation_page_confirmed","booking_status","my_trips_clicks")},isMyTripsDataInStorage:function(){return!1===_.isEmpty(Odigeo.Storage.get("mytripsData"))},goToMyTripsDetails:function(e){Odigeo.trigger(this.widget.id+":goToMyTripsDetails",e)},goToMyTrips:function(e){Odigeo.trigger(this.widget.id+":goToMyTrips",e)},tripCategoryFromData:function(e){var t,i=_.isNull(e.myTrip)?"":e.myTrip.itineraries[0].segments,n="multi_trip";switch(i.length){case 0:t="not_valid";break;case 1:t="one_way";break;case 2:var a=i[0].departureLocation.cityIataCode===i[1].arrivalLocation.cityIataCode,s=i[0].arrivalLocation.cityIataCode===i[1].departureLocation.cityIataCode;t=a&&s?"return":n;break;default:t=n}return t},createInfoHotelsHero:function(e){var t=e.myTrip.itineraries[0].segments[0],i=t.arrivalDate+864e5,n="return"===e.tripCategory?e.myTrip.itineraries[0].segments[1].departureDate:i,a=Odigeo.Utils.parseJson(Odigeo.Storage.get("infoHotelsHero")),s=!_.isNull(a)&&a.departureDate<Odigeo.Utils.getToday(),r=e.myTrip.itineraries[0].itineraryProviderBookingDTOList[0],o={iata:t.arrivalLocation.iata,checkin_monthday:Odigeo.Utils.formatDate(t.arrivalDate,"justDay",!0),checkin_year_month:Odigeo.Utils.formatDate(t.arrivalDate,"yearMonth",!0),checkout_monthday:Odigeo.Utils.formatDate(n,"justDay",!0),checkout_year_month:Odigeo.Utils.formatDate(n,"yearMonth",!0),selected_currency:e.myTrip.currency,group_adults:r.numAdults,group_children:r.numInfants+r.numChildren,age:[],buyer_name:e.myTrip.buyer.name.toLowerCase(),category:e.tripCategory,departureDate:t.departureDate,arrivalDate:t.arrivalDate,iataDeparture:t.departureLocation.cityIataCode,iataAirportDeparture:t.departureLocation.iata,iataArrival:t.arrivalLocation.cityIataCode};_.each(e.myTrip.travellers,function(e){"ADULT"!==e.ageType&&o.age.push(e.birthDate)}),(_.isNull(a)||s||o.departureDate<a.departureDate)&&Odigeo.Storage.set("infoHotelsHero",JSON.stringify(o))},renderBanner:function(e,t,i){var n=$("."+i+"_xselling_banner");n.append(e(t)),n.removeClass("odf-hidden")},mountXsellBanner:function(e,t){var i,n=t.bannerSuffix;i="hotels"===n&&Odigeo.AB.isExpediaLinksAndWidget?"od-confirmation-hotels-textlink-img-expedia":"od-confirmation-"+n+"-textlink-img";var a={utils:Odigeo.Utils,urlArgs:t.urlArgs,bannerType:n,trackLabel:n,textlinkImgClass:i,product:n};this.renderBanner(e,a,n)},mountGtBanner:function(e,t){var i=t.bannerSuffix,n={utils:Odigeo.Utils,urlArgs:t.urlArgs,product:"gt",bannerType:"ground_transports",trackLabel:"groundtransportation",trackingCategory:(Odigeo.Utils.isRequestApp("dp")?"dynpack":"flights")+"_confirmation_page_confirmed",textlinkImgClass:"od-confirmation-"+i+"-textlink-img",titleArg:t.cityName};this.renderBanner(e,n,i)},getCarsData:function(e){return{bannerSuffix:"cars",urlArgs:e}},renderCarsBanner:function(e,t){var i=c(e,Odigeo.UIElements.translations.xsellBaseDeeplinksUrl.cartrawler,a.confirmation_cars_banner);this.mountXsellBanner(t,this.getCarsData(i))},getHotelData:function(e){return{bannerSuffix:"hotels",urlArgs:[e.pickupIata,e.checkin_monthday,e.checkin_year_month,e.checkout_monthday,e.checkout_year_month]}},getHotelEarlyData:function(){return Odigeo.AB.isExpediaLinksAndWidget?this.getExpediaHotelsData(_.defaults(this.xsellingData.hotel.earlyFlightHotelData,this.xsellingData.hotel)):this.getHotelData(_.defaults(this.xsellingData.hotel.earlyFlightHotelData,this.xsellingData.hotel))},getExpediaHotelsData:function(e){return{bannerSuffix:"hotels",urlArgs:[e.pickupIata,Odigeo.UIElements.translations.expediaHotels.id,e.checkin,e.checkout,e.roomParams,e.currency,e.nPassengers,e.checkin,e.checkout,e.departureIata,e.purchaseDate,e.token]}},renderHotelsBanner:function(e,t){var i=Odigeo.AB.isExpediaLinksAndWidget?this.getExpediaHotelsData(e.hotel):this.getHotelData(e.hotel);this.mountXsellBanner(t,i)},renderGtBanner:function(e,t,i){var n=e.gt,a={bannerSuffix:"gt",cityName:e.gt.cityName,urlArgs:["link-confpage-"+i,"multi_trip"===n.tripType?"one_way":n.tripType,n.nPassengers,e.pickupIata,n.pickupDatetime,n.returnDatetime]};this.mountGtBanner(t,a)},trackBannersAppearances:function(t,i){var n={BOOKING_CONFIRMED:"confirmed",BOOKING_PENDING:"pending"}[i.bookingstatus];e.trackEvent("xsell_banner","banner_appearances_car:"+t.cars+"_hot:"+t.hotels+"_gt:"+t.gt,(Odigeo.Utils.isRequestApp("dp")?"dynpack":"flights")+"_confirmation_page_"+n)},bindBannersLinks:function(t){this.$cachedSelectors.confirmationContainer.on(Odigeo.Events.tap,".confirmation_xselling_link",function(t){var i=$(t.currentTarget),n=i.data("track-label"),a=i.data("ref"),s=i.data("track-action");e.trackEvent(s||"xsell_banner",n,Odigeo.Utils.getAppInGlobalScope()+"_confirmation_page_confirmed"),e.openExternalLink(a,!1)})},createCarsSmartblock:function(e){0<this.$el.find("#xsell-cartrawler-widget").length&&l.create({id:"xsell-cartrawler-widget",options:{bookingDetail:e}})},renderXsellingEarlyFlightMessage:function(t){var i=new Date(_.get(t,"myTrip.itineraries[0].segments[0].departureDate")).getHours();if(5<i&&i<10){var n=_.template(this.$widget.find(".xselling_footer_template").html(),Odigeo.Utils.getTmplSettings()),a=this.getHotelEarlyData().urlArgs,s=this.prepareAndReplaceCmsKey(a,Odigeo.AB.isExpediaLinksAndWidget?Odigeo.UIElements.translations.confirmationTripDetailsMessages.expediaEarlyMessage:Odigeo.UIElements.translations.confirmationTripDetailsMessages.earlyMessage);this.$widget.find(".flight_details_xsell_departure_time").first().addClass("odf-text-info odf-bold"),this.$widget.find(".xselling_summary_footer").html(n({url:s})),e.trackEvent("early-morning_widget","early-morning_appearances")}},renderXsellingHotelsWidgetsTemplates:function(e){var t=this.getHotelsData(this.xsellingData).urlArgs,i=this.getWidgetUrl(t,"hotels","confirmationWidgets"),n=_.extend({},e,{url:i,xsellingData:this.xsellingData});if(this.xsellingData.hotel){var a=this.xsellingData.hotel;r.search({checkInDate:a.checkin,checkOutDate:a.checkout,geoNodeId:this.xsellingData.geoNodeId,currency:a.currency,numAdults:a.passengers.numAdults,childrenAges:a.passengers.childrenAges,maxResults:this.hotelsConfig.maxResults,minScore:this.hotelsConfig.minScore,orderBy:this.hotelsConfig.sortingRule},"confirmation-widget"),this.renderXsellWidget(this.hotelsTemplates.xsellWidgetTemplate,n,".hotels_widget_container")}},renderXsellingBannersTemplates:function(e){var t,i,n=$(".gt_xselling_banner"),a={hotels:0,cars:0,gt:0};t=2===Odigeo.AB.updateXsellBannersMobileConfPage?_.template(this.$widget.find(".new_product_banners").html(),Odigeo.Utils.getTmplSettings()):_.template(this.$widget.find(".xselling_banners").html(),Odigeo.Utils.getTmplSettings()),this.xsellingData.cars&&(this.renderCarsBanner(this.xsellingData,t),a.cars++),!this.xsellingData.hotel||this.xsellingData.hotel.checkin_monthday===this.xsellingData.hotel.checkout_monthday&&this.xsellingData.hotel.checkin_year_month===this.xsellingData.hotel.checkout_year_month||(this.renderHotelsBanner(this.xsellingData,t),a.hotels++),n.length&&(i=e.myTrip.accommodationBooking?"dp":"flights",this.renderGtBanner(this.xsellingData,t,i),a.gt++),this.trackBannersAppearances(a,e)},createCarsStandaloneBanner:function(e){var t=_.partial(c,this.xsellingData);0<this.$el.find("#cars-standalone-banner").length&&d.create({id:"cars-standalone-banner",options:{deeplinkFactory:t,trackingCategory:e}})},createGtStandaloneBanner:function(e){0<this.$el.find("#gt-standalone-banner").length&&g.create({id:"gt-standalone-banner",options:{xsellData:this.xsellingData,trackingCategory:e}})},openConditions:function(e){var t=$(e.currentTarget).data("target");this.$el.find(t).addClass("open")},closeConditions:function(e){var t=$(e.currentTarget).data("target");this.$el.find(t).removeClass("open")}})))),createEmergingLayer:function(e){var t=this.view.getConfirmationXsellingData(e),i=e.myTrip.travellers,n="BOOKING_CONFIRMED"===e.bookingstatus?"confirmed":"pending",a=this.generateConfirmationTrackingCategory(n),s=_.extend({},e,{xsellingData:t,travellers:i});h.create({id:"xsell-emerging-layer-confirmation",options:{bookingDetails:s,context:"confirmation",trackingCategory:a}})},loadOnReady:function(e){var t=this,i=$.Deferred(),n=_.bind(this.options.emergingLayerEnabled?i.resolve:i.reject,i),a=_.bind(i.reject,i),s={delay:6e3,bookingStatus:{BOOKING_CONFIRMED:n,BOOKING_PENDING:n,BOOKING_RETAINED:n,BOOKING_PAYMENT_RETRY:a,BOOKING_REJECTED:a,BOOKING_ERROR:a,BOOKING_REPRICING:a,BOOKING_USER_INTERACTION_NEEDED:a}};if(i.then(function(){Odigeo.trigger(t.id+":confirmationPageSuccessfully")},function(){Odigeo.trigger(t.id+":confirmationPageUnsuccessfully")}),i.then(_.bind(this.createEmergingLayer,this,e)),this.isNotBankTransfer(e)){if(this.isForbiddenNegativeFeeCollection(e.extensions))return void Odigeo.trigger(this.id+":bookingNegativeFeeLoaded");this.setConfirmationReachedFlag(e.bookingstatus),Odigeo.Utils.parseJson(Odigeo.Session.get("isAccommodationPostBooking"))?e.tripCategory="accommodationPostBooking":e.tripCategory=this.view.tripCategoryFromData(e);var r=s.bookingStatus[e.bookingstatus];this.executeByBookingStatus(e,r)}else this.loadContentIntoContainer(Odigeo.Settings.property("widgetPartUrlFormatter")(this.name,this.model.bookingBankTransfer),function(){Odigeo.trigger(this.id+":confirmationBanktransferLoaded"),Odigeo.trigger(this.id+":bookingConfirmedLoaded",e)}.bind(this),n),Odigeo.Storage.set("confirmationReached",!0)},init:function(){this.options=Odigeo.parseOptions(this.options)},loadHotelsBanner:function(e){var t={"confirmation-widget":{bannerSelector:".hotels_widget_container",hotels:e.results,trackingCategory:"flights_confirmation_page"}};this.view.loadHotelsBanner(t[e.context])},loadHotelsBannerNoResults:function(e){var t={"confirmation-widget":{bannerSelector:".hotels_widget_container",error:e.error,trackingCategory:"flights_confirmation_page"}};this.view.loadHotelsNoResultsBanner(t[e.context])},isNotBankTransfer:function(e){return _.isNull(e.myTrip)||!e.myTrip.bankTransfer},isForbiddenNegativeFeeCollection:function(e){return!_.isNull(e)&&_.find(e,{name:"ERROR_MESSAGE_KEY",value:"FORBIDDEN_NEGATIVE_FEE_COLLECTION"})},setConfirmationReachedFlag:function(e){if(_.includes(["BOOKING_CONFIRMED","BOOKING_PENDING","BOOKING_RETAINED","BOOKING_REJECTED"],e)){var t=Number($("#passengers-manager-wrapper").data("bookingId")),i=!!_.isNaN(t)||t;Odigeo.Storage.set("confirmationReached",i)}else Odigeo.Storage.set("confirmationReached",!1)},renderConfirmationWhenBookingApiError:function(e){this.loadOnReady(e)},executeByBookingStatus:function(e,t){var i="one_way"===e.tripCategory||"return"===e.tripCategory,n=Odigeo.Utils.isRequestApp("flights")&&i;switch(e.bookingstatus){case"BOOKING_CONFIRMED":$(".od-resultpage-segment-itinerary-title").css("display","none"),$(".od-resultpage-segment-itinerary-details").css("display","none"),this.loadContentIntoContainer(Odigeo.Settings.property("widgetPartUrlFormatter")(this.name,this.model.bookingConfirmedUrl),this.onBookingConfirmed.bind(this,e),t),n&&this.view.createInfoHotelsHero(e);break;case"BOOKING_PENDING":this.loadContentIntoContainer(Odigeo.Settings.property("widgetPartUrlFormatter")(this.name,this.model.bookingPendingUrl),this.onBookingPending.bind(this,e),t),n&&this.view.createInfoHotelsHero(e);break;case"BOOKING_RETAINED":this.loadContentIntoContainer(Odigeo.Settings.property("widgetPartUrlFormatter")(this.name,this.model.bookingRetainedUrl),function(){$(this).find(".confirmation_expand_wrapper").each(function(){var e=$(this).find(".confirmation_expand_content").first();$(this).find(".confirmation_expand").on(Odigeo.Events.tap,function(){e.toggleClass("hidden").closest(".scroll_area").trigger("updateDimensions")})})},t);break;case"BOOKING_REJECTED":this.loadContentIntoContainer(Odigeo.Settings.property("widgetPartUrlFormatter")(this.name,this.model.bookingRejectedUrl),function(){Odigeo.trigger(this.id+":bookingRejectedLoaded")}.bind(this),t);break;case"BOOKING_PAYMENT_RETRY":Odigeo.trigger(this.id+":bookingPaymentRetryLoaded",e),t();break;case"BOOKING_ERROR":this.view.showErrorBrokenFlowDialog(),Odigeo.trigger(this.id+":bookingErrorLoaded"),t();break;case"BOOKING_REPRICING":Odigeo.trigger(this.id+":bookingRepricingLoaded",{data:e.repricing,textPositive:this.options.repricing_popup_text_positive,textNegative:this.options.repricing_popup_text_negative}),t();break;case"BOOKING_USER_INTERACTION_NEEDED":this.view.handleUserInteractionNeeded(e),t();break;default:this.view.showErrorBrokenFlowDialog(),Odigeo.trigger(this.id+":bookingErrorBrokenFlowDialogLoaded"),t()}},loadContentIntoContainer:function(e,t,i){this.view.$cachedSelectors.confirmationContainer.load(e,function(){t.apply(this),i()})},onBookingConfirmed:function(t){var i=this,n=this.generateConfirmationTrackingCategory("confirmed"),a=Odigeo.Utils.parseJson(Odigeo.Session.get("searchParameters"))||{},s=_.extend({},t,a);"accommodationPostBooking"!==t.tripCategory&&(this.view.xsellingData=this.view.getConfirmationXsellingData(s)),this.view.fillDaysLeft(),this.renderWidgets(t,n),this.view.bindBannersLinks(n),this.options.isDesktop&&_.defer(function(){var t=i.view.$el.find(i.view.selectors.carsStandaloneBanner).length,a=i.view.$el.find(i.view.selectors.gtStandaloneBanner).length;e.trackEvent("xsell_banner","banner_appearances_car:"+t+"_gt:"+a,n)}),Odigeo.trigger(this.id+":bookingConfirmedLoaded",t)},onBookingPending:function(t){var i=this,n=this.generateConfirmationTrackingCategory("pending"),a=Odigeo.Utils.parseJson(Odigeo.Session.get("searchParameters"))||{},s=_.extend({},t,a);"accommodationPostBooking"!==t.tripCategory&&(this.view.xsellingData=this.view.getConfirmationXsellingData(s)),this.renderWidgets(t,n),this.view.bindBannersLinks(n),this.options.isDesktop?_.defer(function(){var t=i.view.$el.find(i.view.selectors.carsStandaloneBanner).length,a=i.view.$el.find(i.view.selectors.gtStandaloneBanner).length;e.trackEvent("xsell_banner","banner_appearances_car:"+t+"_gt:"+a,n)}):this.view.$el.find(".xselling_banners_wrapper").length&&this.view.renderXsellingBannersTemplates(t),Odigeo.trigger(this.id+":bookingPendingLoaded",t)},renderWidgets:function(e,t){var i=$("#page"),a=i.find(".xselling_banners_wrapper").length,s=i.find(".hotels_widget_container").length,r=$("#app-checkin-desktop-confirmation");a&&this.view.renderXsellingBannersTemplates(e),this.options.isDesktop&&(this.view.createCarsStandaloneBanner(t),this.view.createGtStandaloneBanner(t)),this.view.createCarsSmartblock(e.myTrip),s&&this.view.renderXsellingHotelsWidgetsTemplates(e),_.isEmpty(e.myTrip.itineraries)||this.view.renderXsellingEarlyFlightMessage(e),r.length&&n.create({id:"app-checkin-desktop-confirmation"})},generateConfirmationTrackingCategory:function(e){return(Odigeo.Utils.isRequestApp("dp")?"dynpack":"flights")+"_confirmation_page_"+e}}))})},function(e,t,i){"use strict";var n=i(196),a=i(0),s=i(13),r=i(18);e.exports=r(s.extend(n.extend({name:"app_check_in_desktop",initialize:function(){var e=this.templates[this.options.templateToRender];this.initEmailCapture(),this.initTrackingVars(),e&&this.render(e)},events:{"tap .app_touchpoint_checkin_img":"onImgClick","tap .expander_link":"onExpanderButtonClick"},render:function(e){this.$el.find(".app_touchpoint_checkin").append(e({keys:this.keys,buyerEmail:this.options.buyerEmail})),this.initAppCheckInDesktop(),this.dataType=this.$slctrs.input.attr("data-type"),this.userEmail=this.options.buyerEmail,this.bindEvents()},initAppCheckInDesktop:function(){var e=this.$el.find(".app_touchpoint_checkin");this.$slctrs={container:e,input:e.find(".app_touchpoint_checkin_input"),button:e.find(".app_touchpoint_email_link_button"),expander:e.find(".expander_link_input"),customBox:e.find(".app_custom_box"),appImgs:e.find(".app_touchpoint_checkin_img")}},bindEvents:function(){"email-validate"===this.dataType&&this.userEmail?this.$slctrs.button.on(Odigeo.Events.tap,_.partial(_.bind(this.onSuccess,this),this.userEmail)):this.$slctrs.button.on(Odigeo.Events.tap,_.bind(this.validateEmailCapture,this))},initTrackingVars:function(){var e=Odigeo.Utils.getFunnelInGlobalScope();this.trackKeys={MyTripsDetails:"my_area_trips_details",ConfirmationPage:e+"_confirmation_page_confirmed"},this.moduleContext=this.options.context,this.action="checkin_widget",this.labelConcept="send_link_click_"},onImgClick:function(e){e.preventDefault();var t=e.currentTarget;a.trackEvent(this.action,"go_"+$(t).data("track")+"_click",this.trackKeys[this.moduleContext]),"email-validate"===this.dataType&&window.open(t.href)},onExpanderButtonClick:function(){this.$slctrs.expander.is(":checked")||(this.trackOpenWidget(),this.appWindowScroll())},trackOpenWidget:function(){a.trackEventWithCategory(this.trackKeys[this.moduleContext],this.action,"open_widget_click")},appWindowScroll:function(){var e=this;setTimeout(function(){$("html, body").animate({scrollTop:e.$slctrs.customBox.offset().top-$(window).height()/2},300)},600)},onSuccess:function(e){var t=Odigeo.SessionScope.appCheckInDesktopSettings;if(this.$slctrs.button.addClass("loading"),!_.isEmpty(t)){var i=t.url+"?lid="+t.lid+"&MID="+t.mid+"&Email%20Address="+e+"&POS="+t.pos+"&Brand="+t.brand+"&Market="+t.market+"&Source="+this.moduleContext;$.ajax({url:i,type:"get",complete:_.bind(function(){this.showSentMessageEmailCapture()},this)})}}})))},function(e,t,i){"use strict";e.exports={url:function(){return Odigeo.Settings.getProperty("hotelsServiceFormatter")("list")},search:function(e,t){$.ajax({url:this.url(),type:"POST",data:JSON.stringify(e),contentType:"application/json",dataType:"json",cache:!1,success:_.bind(this.successFetch,this,t),error:_.bind(this.errorFetch,this,t)})},successFetch:function(e,t){Odigeo.trigger(e+":hotelsSearchCompletedSuccessfully",{results:t,context:e})},errorFetch:function(e,t){Odigeo.trigger(e+":hotelsSearchFailed",{error:t,context:e})}}},function(e,t,i){"use strict";var n=i(13),a=i(18),s=i(550),r=i(357),o=i(27),c=i(21),d=i(0);function l(){return o.isMyTripsHome()?"my_area_trips":"my_area_trips_details"}e.exports=a(n.extend({name:"cars_standalone_banner",initialize:function(){var e,t,i;this.deeplink=this.options.deeplinkFactory?this.options.deeplinkFactory(this.keys.url,c.confirmation_cars_banner):(e=this.options.bookingData,t=this.keys,i=r(e),_.partial(s,i)(t.url,c.confirmation_cars_banner)),this.render()},selectors:{carProvidersContainer:".car_providers_container",viewContainer:".cars_standalone_banner"},events:{"tap .cars_standalone_add_car":"onAddTransferClick"},render:function(){this.$el.find(this.selectors.viewContainer).html(this.templates.carsStandaloneBanner({keys:this.keys})),function(){var e=this.options.myTripsWithGt?"od-cars-providers-small":"od-cars-providers-large";this.$el.find(this.selectors.carProvidersContainer).addClass(e)}.apply(this),function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:l();d.trackEvent("xsell_banner","car_appearances",e)}(this.options.trackingCategory)},onAddTransferClick:function(){var e;!function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:l();d.trackEvent("xsell_banner","cars_clicks_button",e)}(this.options.trackingCategory),e=this.deeplink,window.open(e,"_blank")}}))},function(e,t,i){"use strict";e.exports=function(e){var t=_.last(e.itinerarySegments[0].sections).section,i={getArrivalDate:function(){return e=t.arrivalDate,Odigeo.Utils.getRemainingMinutes(e)<=0&&(e=Odigeo.Utils.addMins(Odigeo.Utils.getTodayExactTimeLocal(),60)),e;var e},getDepartureDate:function(){return t.departureDate},getCityIata:function(){return t.to.cityIataCode},getDestinationAirportIata:function(){return t.to.iataCode},getOriginAirpotIata:function(){return t.from.iataCode},getOriginCountryCode:function(){return t.from.countryCode},getDestinationCountryCode:function(){return t.to.countryCode},getCityName:function(){return t.to.cityName},getGeoNodeId:function(){return t.to.geoNodeId},getPnr:function(){return _.get(t,"pnr","")},getCabinClass:function(){return _.get(t,"cabinClass","")},getFlightNumber:function(){return""+t.carrier.code+t.id}};return i}},function(e,t,i){"use strict";e.exports=function(e){var t=e.itinerarySegments,i=1===t.length,n=i?_.last(t[0].sections).section:t[1].sections[0].section,a={getArrivalDate:function(){return n.arrivalDate},getDepartureDate:function(){return e=n.departureDate,i?Odigeo.Utils.addDays(e,1):e;var e},getCityIata:function(){return n.to.cityIataCode},getDestinationAirportIata:function(){return n.to.iataCode},getOriginAirpotIata:function(){return n.from.iataCode},getCityName:function(){return n.to.cityName},getOriginCountryCode:function(){return n.from.countryCode},getDestinationCountryCode:function(){return n.to.countryCode},getGeoNodeId:function(){return n.to.geoNodeId},getPnr:function(){return _.get(n,"pnr","")},getFlightNumber:function(){return""+n.carrier.code+n.id},getCabinClass:function(){return _.get(n,"cabinClass","")}};return a}},function(e,t,i){"use strict";var n=i(13),a=i(21),s=i(76),r=i(710),o=i(161),c=i(713),d=i(27),l=i(86);e.exports=n.extend({name:"cartrawler_widget",initialize:function(e){n.prototype.initialize.call(this,e),this.carsSubdomain="https://"+this.keys.carsSubdomain,this.render(this.options.bookingDetail)},render:function(e){var t=function(e){var t=[],i=r(e),n=o(e.buyer),g=d.isConfirmationPage()?s(a.confirmation_cars_smartblock):s(a.mytripdetails_cars_smartblock),h=l.getAbPartition();return u(i.getArrivalLeg()),"ONE_WAY"!==i.getItineraryType()&&u(i.getDepartureLeg()),{partnerName:c.getBrand(),clientId:g,currency:c.getCurrencyCode(),residenceId:n.getCountryCode(),language:c.getLanguage(),pax:i.getNumberOfPassengers(),userAge:n.getAge(),flightNumber:i.getArrivalLeg().getFlightNumber(),pnr:i.getPnr(),context:d.isConfirmationPage()?"confirm":"mytrip",carsSubdomain:this.carsSubdomain,variation:h,segments:t};function u(e){var i="UTC:yyyy-mm-dd'T'HH:MM:ss",n={arrivalIata:e.getDestinationAirportIata(),departureIata:e.getOriginAirpotIata(),arrivalDateTime:Odigeo.Utils.formatDate(new Date(e.getArrivalDate()),i),departureDateTime:Odigeo.Utils.formatDate(new Date(e.getDepartureDate()),i)};t.push(n)}}.call(this,e);this.$el.html(this.templates.main(t)),function(){var e=this;window.require(["cartrawler"],function(){window.CTStore.hasOwnProperty("events")&&window.CTStore.events.trigger("onRestart",e.$el.find("ct-smartblock")[0])})}.call(this)}})},function(e,t,i){"use strict";var n=i(711),a=i(27);function s(e){return 1===_.get(e,"length")}e.exports=function(e){var t={},i=_.get(e,"itineraries[0].segments")||_.get(e,"itineraryBookings.itinerarySegments"),r=_.map(i,function(e){return n(e)}),o=a.getPassengers(e.travellers);return t.getArrivalLeg=function(){return _.result(r,"[0].getDepartureLeg",!1)},t.getDepartureLeg=function(){return s(i)?t.getArrivalLeg():_.result(r,"[1].getArrivalLeg",!1)},t.getSegment=function(e){return r[e]},t.getItineraryType=function(){return s(i)?"ONE_WAY":"ROUND_TRIP"},t.getNumberOfPassengers=function(){return _.get(e,"travellers.length",1)},t.getPassengers=function(){return o},t.getPrice=function(){return _.get(e,"price.amount")||e.totalPrice},t.hasHotelBooked=function(){return!_.isEmpty(e.accomodationBooking)},t.getCurrencyCode=function(){return e.currency||_.get(e,"price.currency","EUR")},t.getPnr=function(){return e.reference||_.get(t.getArrivalLeg().getPnr(),"pnr","")},t}},function(e,t,i){"use strict";var n=i(712);e.exports=function(e){var t={},i=_.map(e.sections,function(e){return n(e)});return t.getDuration=function(){return e.duration},t.getLeg=function(e){return i[e]},t.getLegsCount=function(){return i.length},t.getDepartureLeg=function(){return i[0]},t.getArrivalLeg=function(){return _.last(i)},t}},function(e,t,i){"use strict";e.exports=function(e){var t=e.section||e,i=t.from||t.departureLocation,n=t.to||t.arrivalLocation;return{getArrivalDate:function(){return _.get(t,"arrivalDate",0)},getDepartureDate:function(){return _.get(t,"departureDate",0)},getCityIata:function(){return _.get(n,"cityIataCode","")},getDestinationAirportIata:function(){return _.get(n,"iataCode","")||_.get(n,"iata","")},getOriginAirpotIata:function(){return _.get(i,"iataCode","")||_.get(i,"iata","")},getOriginCountryCode:function(){return _.get(i,"countryCode","")},getDestinationCountryCode:function(){return _.get(n,"countryCode","")},getCityName:function(){return _.get(n,"cityName","")},getGeoNodeId:function(){return _.get(n,"geoNodeId","")},getPnr:function(){return _.get(t,"pnr","")},getCabinClass:function(){return _.get(t,"cabinClass","")},getFlightNumber:function(){return""+_.get(t,"carrier.code","")+_.get(t,"id","")}}}},function(e,t,i){"use strict";var n={ED:"edreams",OP:"opodo",TL:"travel-link",GV:"go-voyages"};e.exports={getBrand:function(){var e=Odigeo.SessionScope.brand;return _.get(n,e,"")},getLanguage:function(){return _.get(Odigeo.SessionScope,"tmParam.language","en")},getCurrencyCode:function(){return Odigeo.Utils.Currency.currencyCode}}},function(e,t,i){"use strict";var n=i(13),a=i(18),s=i(552),r=i(27),o=i(0),c=i(357);function d(){return r.isMyTripsHome()?"my_area_trips":"my_area_trips_details"}e.exports=a(n.extend({name:"ground_transportation_banner",events:{"tap .gt_standalone_add_transfer":"onTapLink"},initialize:function(){var e,t,i,n,a,r,o;this.options.bookingData&&(this.options.xsellData=c(this.options.bookingData)),this.deeplink=(e=this.options.xsellData,t=this.keys.gtLinkRegex,e?"confirmation"===Odigeo.History.getPageNameFromFragment()?(n=e,a=t,r="link-confpage-"+(Odigeo.Utils.isRequestApp("dp")?"dynpack":"flights"),Odigeo.Utils.replaceCmsKeyArgs(a,r,"multi_trip"===(o=n.gt.tripType).toLowerCase()?"one_way":o.toLowerCase(),n.nPassengers,n.pickupIataAirport,n.gt.pickupDatetime,n.gt.returnDatetime)):s(e,t):(i=t,Odigeo.Utils.replaceCmsKeyArgs(i,"mytrips_home_mobileweb","","","","",""))),this.render()},render:function(){var e=this.options.xsellData?this.templates.bookingDetailBanner:this.templates.noBookingsBanner;this.$el.find(".ground_transportation_banner").html(e({keys:this.keys})),function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:d();o.trackEvent("xsell_banner","ground_transportation_appearances",e)}(this.options.trackingCategory)},onTapLink:function(e){var t;!function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:d();o.trackEvent("xsell_banner","groundtransportation_clicks_button",e)}(this.options.trackingCategory),t=this.deeplink,window.open(t,"_blank")}}))},function(e,t,i){"use strict";var n=i(13),a=i(18),s=i(167),r=i(0),o=i(7),c=i(138),d=i(60),l=i(21),g=i(76),h=i(86).getCartrawlerAbParameters,u=i(175).replaceWapb3ForAb,p=i(95),f=void 0,m=Odigeo.Utils.isRequestApp("dp"),b={ED:"edreams",OP:"opodo",TL:"travellink",GV:"govoyages"},y=function(){var e=void 0;switch(f){case"confirmation":case"mytrips":e=g(l.confirmation_cars_emerginglayer)}return e};e.exports=a(s(n.extend(d.extend({name:"xsell_emerging_layer",selectors:{appStatus:".emerging-layer-status",appContainer:".xsell_emerging_layer"},events:{},bannerType:"",activeBanners:[],emergingLayerTemplateData:{},emergingLayerLightBox:{},initialize:function(){f=this.options.context;var e,t,i,n,a,s,c,d,l={keys:this.keys,hotelsTemplate:this.templates.emergingLayerHotelsBanner,carsTemplate:this.templates.emergingLayerCarsBanner},g=this.options.bookingDetails;this.options.xsellingData=this.getXsellingData(f,g),this.setActiveBanners(g,this.options.xsellingData),_.isEmpty(this.activeBanners)?this.remove():(this.setEmergingLayerTemplateData(l,this.options.xsellingData),this.renderEmergingLayerTemplate(),this.displayEmergingLayer(),Odigeo.Device.getViewport().off(Odigeo.Events.tap,".emerging_layer_link").off(Odigeo.Events.tap,"#xsell_emerging_layer .lightbox_close"),this.setBannerType(g.travellers,this.options.xsellingData.gt),e=this.emergingLayerTemplateData.deeplinks,t=this.getBannerType(),i=_.get(this,"options.trackingCategory"),n=_.isEmpty(e.hotels.url)?"0":"1",a=_.isEmpty(e.cars.url)?"0":"1",s=_.isEmpty(e.gt.url)?"0":"1",c=i||function(){var e=void 0;switch(f){case"confirmation":e=(m?"dynpack":"flights")+"_confirmation_page_confirmed";break;case"mytrips":e="my_area_trips_details"}return e}(),d="xsell_layer_"+t,r.trackEvent(d,"layer_appearances_car:"+a+"_hot:"+n+"_gt:"+s,c),r.addCrossDomainIframesTracking(),$(".emerging_layer_link").on(Odigeo.Events.tap,function(e){var t=$(e.currentTarget),i=t.data("track-label"),n=t.data("ref");r.trackEvent(d,i,c),Odigeo.trigger("analytics:tracking",{type:"sendToPageBlank",data:{url:n,goOutside:!0}})}),Odigeo.Device.getViewport().on(Odigeo.Events.tap,"#emerging_layer_container",function(e){(e.target===this||$(e.target).hasClass("lightbox_close"))&&(r.trackEvent(d,"layer_close",c),o.fireEvent("click_EML","page_EML_click","true"),Odigeo.Utils.ensighten({page_EML_click:"true"},!0,"click_EML"))}))},getXsellingData:function(e,t){var i=!1;switch(e){case"confirmation":i=this.getConfirmationXsellingData(t);break;case"mytrips":i=this.getMyTripsXsellingData(t)}return i},setActiveBanners:function(e,t){var i,n,a,s,r,o;i=this.keys,!_.isEmpty(i.cartrawlerBaseUrl)&&Odigeo.Utils.parseJson(i.hasCarsUpselling)&&this.activeBanners.push("cars"),n=e,a=t,s=this.keys,r=!(_.isNull(n.accommodationBooking)||_.isUndefined(n.accommodationBooking)),o=function(e){var t=e.checkin_monthday,i=e.checkin_year_month,n=e.checkout_monthday,a=e.checkout_year_month;return t===n&&i===a}(a.hotel),m||r||o||!Odigeo.Utils.parseJson(s.hasHotelsUpselling)||this.activeBanners.push("hotels")},setEmergingLayerTemplateData:function(e,t){var i=function(e,t,i){var n={},a={cars:{},hotels:{},gt:{}};if(_.includes(i,"hotels")){var s,r=void 0;s=Odigeo.AB.isExpediaLinksAndWidget?(r=Odigeo.UIElements.translations.expediaHotels.emlConfirmation,r=u(r,l.mytripsdetails_hotels_emerginglayer,p.getRedirectionAbConfig()),function(e){var t=Odigeo.UIElements.translations.expediaHotels.id,i=e.nPassengers,n=e.hotel,a={originIata:e.departureIataAirport,arrivalIata:e.pickupIataAirport};return{airportOrigin:a.originIata,airportArrival:a.arrivalIata,widgetId:t,checkIn:n.checkin,checkOut:n.checkout,rooms:n.roomParams,currency:n.currency,passengers:i,departureDate:n.checkin,arrivalDate:n.checkout,purchaseDate:n.purchaseDate,token:n.token,checkin_monthday:n.checkin_monthday,checkin_year_month:n.checkin_year_month,checkout_monthday:n.checkout_monthday,checkout_year_month:n.checkout_year_month}}(e)):(r=t.hotelsBannerUrl,function(e,t){return{iata:e,checkin_monthday:t.checkin_monthday,checkin_year_month:t.checkin_year_month,checkout_monthday:t.checkout_monthday,checkout_year_month:t.checkout_year_month}}(e.pickupIata,e.hotel)),n.hotels=s,a.hotels.url=r}return _.includes(i,"cars")&&(a.cars.url=function(e){var t=y(),i="yyyymmddHHMM",n=Odigeo.Utils.formatDate(new Date(e.cars.pickupDate),i),a=Odigeo.Utils.formatDate(new Date(e.cars.returnDate),i);return"https://cars.cartrawler.com/"+b[Odigeo.SessionScope.brand]+"/widget?clientId="+t+"&pkDateTime="+n+"&rtDateTime="+a+"&locCode="+e.pickupIataAirport+"&lang="+Odigeo.SessionScope.tmParam.language+"&residencyId="+e.buyerCountryCode+h(l.confirmation_cars_emerginglayer)}(e)),_.includes(i,"gt")&&(n.gt=function(e){var t=e.gt;return{campaign:m?"eml-confpage-dp":"eml-confpage-flights",mode:"multi_trip"===e.gt.tripType?"one_way":e.gt.tripType,airportCode:e.pickupIata,travellers:t.nPassengers,checkinDate:t.pickupDatetime,checkoutDate:t.returnDatetime}}(e),a.gt.url=t.hasGt?t.gtBannerUrl:""),c.replaceUrlParams(a,n)}(t,Odigeo.UIElements.translations.upsellLayer,this.activeBanners);this.emergingLayerTemplateData=_.extend({},e,{deeplinks:i,xsellingData:t,cityName:t.cityName,tripDays:t.gt.tripDays,tripType:t.gt.tripType})},renderEmergingLayerTemplate:function(){this.$el.find(this.selectors.appContainer).append(this.templates.xsellEmergingLayer(this.emergingLayerTemplateData))},displayEmergingLayer:function(){this.emergingLayerLightbox=new Odigeo.UIElements.Lightbox(this.$el.find($("#emerging_layer_container")),{delay:6e3}),Odigeo.once("routeChange",this.clearEmergingLayer.bind(this)),this.emergingLayerLightbox.toggle(!0)},clearEmergingLayer:function(){this.emergingLayerLightbox.remove(0)},setBannerType:function(e,t){var i,n,a="general";i=e,_.some(i,function(e){return"ADULT"!==e.ageType&&"ADULT"!==e.travellerType})&&(a="family"),(n=t).tripType&&"round_trip"===n.tripType.toLocaleLowerCase()&&n.tripDays<=1&&(a="business"),this.bannerType=a},getBannerType:function(){return this.bannerType}}))))},,function(e,t,i){"use strict";var n=i(0),a=i(14).getInstance(),s=void 0;e.exports=function(e){return s=e,Odigeo.CollectionView.extend({afterBindCollection:function(){return this.listenTo(this.collection,"add",this.onAncillaryAddedToCollection),this.listenTo(this.collection,"remove",this.destroyChildren),this},onAncillaryAddedToCollection:function(e){var t=e.getViewClass(),i=Odigeo.View.extend({tagName:"div"}),a=_.get(s,t,i),r={widget:this.widget,options:this.widget.options,model:e};this.isPreselectedInsurance(e)||(this.addChildView(a,r,e),Odigeo.trigger(this.widget.name+":ancillaryProductRendered",e),e.registerOffersForTracking()),_.last(this.collection.models)===e&&n.stopMetric(this.widget.getLoadMetricKey())},isPreselectedInsurance:function(e){var t=e.get("id"),i=a.getInsurance(t);return _.get(Odigeo.AB,"isFareC4ARinPaxEnabled",!1)&&_.get(i,"preselected",!1)}})}},function(e,t,i){"use strict";var n=i(358),a="ancillariesNag",s="none",r=!1,o=function(e){return _.get(e,"flags.nag",!1)},c=function(e){return _.get(e,"flags.mandatorySelection",!1)},d=function(e){return _.get(e,"flags.rejectNagEnabled",!1)},l=function(e){return _.get(e,"flags.mandatory",!1)},g=function(e){return _.get(e,"flags.modal",!1)},h=function(e){return _.get(e,"flags.confirmable",!1)};e.exports=Odigeo.Model.extend({selectionCacheID:null,sortHubsBy:0,lastPolicyInteractedWith:"none",parse:function(e){return _.isObject(e)||(e={}),this.resetSelectionCacheID(),e.isMultiOffer=_.isArray(e.products),e.isMultiOffer?_.each(e.products,this.parseProductData,this):this.parseProductData(e),this.orderHubs(e),e},orderHubs:function(e){_.get(e,"isMultiOffer")&&(e.products=_.sortBy(e.products,function(e){return"insurancesHub"===_.get(e,"offerTemplate")?this.sortHubsBy:0},this))},getNagContinueGroup:function(){return _.get(this.getOffersList(),"[0].continueNagGroup")},parseProductData:function(e){this.parsePriceToDisplay(e),this.parseUrlConditions(e),this.parseSelectionCacheID(e)},parsePriceToDisplay:function(e){_.isObject(e.prices)||(e.prices={});var t=e.prices,i=_.has(t,"priceToDisplay")?t.priceToDisplay:0;t.priceToDisplayFormatted=Odigeo.Utils.formatCurrency(i)},parseUrlConditions:function(e){var t=_.isEmpty(e.urlExtended)?"url":"urlExtended";e.urlConditionsParsed=_.get(e,t,"")},resetSelectionCacheID:function(){this.selectionCacheID="#"},parseSelectionCacheID:function(e){this.selectionCacheID+=_.get(e,"policy")||"__NO_POLICY_FOUND__",this.selectionCacheID+="#"},isInPreRejectedState:function(){return this.get("rejectAll")&&this.isProductNoSelected()},afterSync:function(){var e=this.thereIsAnyOfferInSelectionCache(),t=this.isInPreRejectedState(),i=t?s:e?this.getSelectedPolicy():_.get(this.getPrecheckedOffer(),"policy"),n=!_.isEmpty(i),a=this.isSelected(i);if(e||n!==a){var r=!t&&n;this.selectProduct(r,i)}},getNagTexts:function(e,t){switch(t){case n.NAG_TYPE.reject:case n.NAG_TYPE.continuance:return e.texts.nag;case n.NAG_TYPE.confirmation:return e.texts.confirmationNag;default:return{}}},initNagIfNeeded:function(e,t){if(_.isUndefined(this.nag)&&(this.isRemoveNagAvailable()||this.isConfirmationNagAvailable()||this.hasToDisplayContinueNag())){var i=this.getNagTexts(e,t);this.nag=new n({template:this.collection.widget.view.getStaticTemplateBuilder("nag","default"),instanceID:this.selectionCacheID,nagClass:a,doNotShowIfSameNagClassAlreadyShown:!1,translations:i}),this.nag.on(n.NAG_LOCAL_EVENTS.onAcceptNag,_.partial(_.bind(this.trigger,this,"nagAccepted"))),this.nag.on(n.NAG_LOCAL_EVENTS.onRejectNag,_.partial(_.bind(this.trigger,this,"nagRejected")))}},trackProductToggled:function(e,t){var i=!_.isEmpty(t)||this.isMultiOffer()?t:this.getPolicyFromSimpleOffer();if(!_.isEmpty(this.getOfferByPolicy(i))||this.isRejected(i)){var n=this.isRejected(t)||e;this.collection.widget.tracking.addOrRemoveProduct(i,n)}},selectProduct:function(e,t,i){var n=this.isRejected(t)?this.getAddedPolicy():t;this._selectProduct(e,t,this.getAddedPolicy()),i||this.notifySelectionChange(e,n)},_selectProduct:function(e,t){this.setIfSelected(e,t)},toggleSelected:function(e){var t=!(this.isSelected(e)||(this.isMultiOffer()||this.isRejected(e))&&_.isNull(this.getOfferByPolicy(e)));this.trackProductToggled(t,e),this.checkNagAndSelectProduct(t,e)},checkNagAndSelectProduct:function(e,t){this.hasToDisplayRemoveNag(!e)?this.triggerAncillaryNag(n.NAG_TYPE.reject):this.hasToDisplayConfirmationNag(!e)&&!this.collection.isAnyProductSelected()?this.triggerAncillaryNag(n.NAG_TYPE.confirmation):this.selectProduct(e,t),this.setValidationFailed(!1)},isContinueNagFlagEnabled:function(){return _.some(this.getOffersList(),o)},isMandatorySelectionFlagEnabled:function(){return _.some(this.getOffersList(),c)},isConfirmationNagFlagEnabled:function(){return _.some(this.getOffersList(),h)},hasToDisplayContinueNag:function(){return this.isProductNoSelected()&&this.isContinueNagFlagEnabled()},hasToDisplayMandatorySelectionError:function(){return this.isProductNoSelected()&&this.isMandatorySelectionFlagEnabled()&&!n.isNagClassAlreadyBeenShown(a)},isProductNoSelected:function(){return!this.isSelected()&&!this.thereIsAnyOfferInSelectionCache()},getContinuanceNagOffer:function(){var e,t;return this.isSelected()||(t=this.getOffersList(),e=_.find(t,o)),e},getRejectNagOffer:function(){var e,t=this.getSelectedOffer();return _.isNull(t)&&this.isMultiOffer()?e=this.firstProductWithRejectNagEnabled():d(t)&&(e=t),e},getConfirmationNagOffer:function(){var e,t;return this.isSelected()||(t=this.getOffersList(),e=_.find(t,h)),e},hasMandatorySelectionErrorBeenShown:function(){return r},setMandatorySelectionErrorAsShown:function(){r=!0,this.collection.widget.tracking.mandatorySelectionError(this.getPolicyFromSimpleOffer())},firstProductWithRejectNagEnabled:function(){return _.find(this.getProducts(),d)},isMultiOfferRejectNagEnabled:function(){return this.isMultiOffer()&&!_.isEmpty(this.firstProductWithRejectNagEnabled())},isRemoveNagAvailable:function(){var e=this.getSelectedOffer();return _.isNull(e)?this.isMultiOfferRejectNagEnabled():d(e)},isConfirmationNagAvailable:function(){var e=this.getSelectedOffer();return!_.isNull(e)&&h(e)},getAddedPolicy:function(){return this.isSelected()?this.getSelectedPolicy():null},hasToDisplayRemoveNag:function(e){return!!e&&!this.isInPreRejectedState()&&this.isRemoveNagAvailable()&&!n.isNagClassAlreadyBeenShown(a)&&!this.hasMandatorySelectionErrorBeenShown()},hasToDisplayConfirmationNag:function(e){return!!e&&!this.isInPreRejectedState()&&this.isConfirmationNagFlagEnabled()&&!n.isNagClassAlreadyBeenShown(a)&&!this.hasMandatorySelectionErrorBeenShown()},thereIsAnyOfferInSelectionCache:function(){return!_.isEmpty(this.collection.selectionCache[this.selectionCacheID])},hasToDisplayContinuanceNag:function(){return this.hasToDisplayContinueNag()&&!n.isNagClassAlreadyBeenShown(a)},triggerAncillaryNag:function(e){var t=!1;if(this.isRemoveNagAvailable()||this.isConfirmationNagFlagEnabled()||this.hasToDisplayContinueNag()){var i=this.getAncillaryNagOffer(e);if(!_.isUndefined(i)){this.initNagIfNeeded(i,e);var n=this.collection.widget.tracking.getNagTrackData(i.policy,e),a=this.collection.widget.tracking.getPageToTrack();this.nag.updateTracking(n,a),t=this.nag.show(e)}}return t},getAncillaryNagOffer:function(e){switch(e){case n.NAG_TYPE.continuance:return this.getContinuanceNagOffer();case n.NAG_TYPE.reject:return this.getRejectNagOffer();case n.NAG_TYPE.confirmation:return this.getConfirmationNagOffer();default:return null}},getPolicyFromSimpleOffer:function(){return this.get("policy")},getTemplate:function(){return this.get("template")},getViewClass:function(){return this.isMultiOffer()?this.getViewClassMultiOffer():this.getTemplate()},getViewClassMultiOffer:function(){var e=this.getProducts(),t=1===_.size(e)?e:_.reject(e,"offerTemplate","insurancesHub","offerTemplate");return _.get(_.find(t),"offerTemplate",null)},isRejected:function(e){return(_.isUndefined(e)?this.getSelectedPolicy():e)===s},getRejectedPolicy:function(){return s},isSelected:function(e){var t=this.getSelectedPolicy();return _.isUndefined(e)?!_.isUndefined(t)&&!this.isRejected(t):e===t},getSelectedPolicy:function(){return this.collection.selectionCache[this.selectionCacheID]},getPrecheckedOffer:function(){return _.find(this.getOffersList(),function(e){return e.selected&&!l(e)})},getOfferByPolicy:function(e){var t=_.find(this.getOffersList(),function(t){return t.policy===e});return _.isEmpty(t)?null:t},getSelectedOffer:function(){var e=this.getSelectedPolicy();return this.getOfferByPolicy(e)},setIfSelected:function(e,t){var i=null;if(this.isMultiOffer()){_.each(this.getProducts(),function(n){n.selected=e&&n.policy===t,n.selected&&(i=n.policy)},this);var n=!_.isEmpty(t)&&!this.isRejected(t)&&!e;_.isEmpty(i)&&(this.isRejected(t)||n)&&(i=s)}else i=e?this.getPolicyFromSimpleOffer():null,this.isRejected(t)&&(i=s);this.isInPreRejectedState()&&this.isRejected(i)||(this.collection.selectionCache[this.selectionCacheID]=i,this.set({selected:!_.isNull(i)&&!this.isRejected(i),selectedPolicy:i}))},isSelectionChanged:function(){return this.hasChanged("selectedPolicy")||this.hasChanged("selected")},isMultiOffer:function(){return this.get("isMultiOffer")},getProducts:function(){return this.isMultiOffer()?this.get("products"):[]},registerOffersForTracking:function(){var e=this;_.each(this.getOffersList(),function(t){return e.registerPolicyForTracking(_.get(t,"policy"))},this)},registerPolicyForTracking:function(e){this.collection.widget.tracking.registerOffer(e)},hasMandatoryProductInMultiOffer:function(){return this.isMultiOffer()&&_.some(this.getProducts(),l,!1)},notifySelectionChange:function(e,t){var i=this.getOfferByPolicy(t);if(!_.isEmpty(i)){var n={id:_.get(i,"policy"),pbdType:_.get(i,"pbdType"),selected:_.get(i,"selected")};Odigeo.trigger(this.collection.widget.name+":selectionChanged",n)}},getValidationFailed:function(){return this.get("validationFailed")},isModelAlreadyValidated:function(){return!_.isUndefined(this.getValidationFailed())},validateProductSelection:function(){var e=!1;return this.isModelAlreadyValidated()||(e=this.hasToDisplayMandatorySelectionError()),this.setValidationFailed(e),e},isContinuanceValidationFailed:function(){return!!this.getValidationFailed()},hasModal:function(){var e=this.getOffersList();return!_.isEmpty(_.find(e,g))},hasModalExclusion:function(e){return _.get(e,"flags.showModalExclusions",!1)},hasModalBenefits:function(e){return _.get(e,"flags.showModalBenefits",!1)},hasDualContract:function(e){return _.get(e,"flags.dualContract",!1)},hasIpid:function(e){return _.get(e,"flags.ipid",!1)},isFree:function(e){return _.get(e,"flags.free",!1)&&0===_.get(e,"prices.priceToDisplay")},canAddOfferFromModal:function(e){return _.get(e,"flags.addFromModal",!1)},getOffersList:function(){return this.isMultiOffer()?this.getProducts():[this.getAll()]},rejectProductSelection:function(){this.selectProduct(!0,this.getRejectedPolicy()),this.setValidationFailed(!1)},isSingleOfferNotSelected:function(){return!this.isMultiOffer()&&!this.isSelected()},rejectProductSelectionIfIsNotSelected:function(){this.isSingleOfferNotSelected()&&this.rejectProductSelection()},isPrecheckedMarket:function(){return this.get("isPrecheckedMarket")},setValidationFailed:function(e){this.set("validationFailed",e)},getLastPolicyInteractedWith:function(){return this.lastPolicyInteractedWith},setLastPolicyInteractedWith:function(e){this.lastPolicyInteractedWith=e}})},function(e,t,i){"use strict";var n=i(328);e.exports=function(e,t){Odigeo.defineWidget("ancillaries_module",Odigeo.Widget.extend({collectionClass:i(720),viewClass:t,tracking:i(140)("guarantees"),init:function(){this.options=Odigeo.parseOptions(this.options),this.collectionClass=this.collectionClass.extend({model:e})},fetchData:function(e){this.pageToTrack=_.isEmpty(e)?this.options.page.toUpperCase():e.toUpperCase(),this.collection.setUrl(e),this.collection.fetchData()},validateSelection:function(e){return this.collection.validateSelection(e)},showContinueNag:function(){this.collection.showContinueNag()},getAddedPolicies:function(){return this.collection.getAddedPolicies()},updateProductsStateOverRadicalShoppingCartAndContinue:function(e){return this.collection.updateProductsStateOverRadicalShoppingCartAndContinue(e)},toggleAncillaryOffer:function(e,t){this.collection.toggleAncillaryOffer(e,t)},getLoadMetricKey:function(){return n.getLoadMetricKey(this.pageToTrack)},getErrorMetricKey:function(){return n.getErrorMetricKey(this.pageToTrack)},rejectSelectionForUnSelectedSingleProducts:function(){this.collection.rejectSelectionForUnSelectedSingleProducts()}}))}},function(e,t,i){"use strict";var n=i(359).getInstance(),a=i(0),s="MANDATORY_SELECTION",r=i(358);e.exports=Odigeo.Collection.extend({selectionCache:{},init:function(){this.setUrl()},setUrl:function(e){e=_.isEmpty(e)?this.widget.options.page:e,this.url=Odigeo.Settings.getProperty("ancillariesUrlFormatter")("availables/"+e)},onError:function(e,t){this.widget.tracking.trackOfferedProducts(null),a.counterMetric(this.widget.getErrorMetricKey())},onSuccess:function(){var e=[];this.each(function(t){t.afterSync();var i=t.getOffersList(),n=!0,a=!1,s=void 0;try{for(var r,o=i[Symbol.iterator]();!(n=(r=o.next()).done);n=!0){var c=r.value,d=_.get(c,"policy");e.push(d)}}catch(t){a=!0,s=t}finally{try{!n&&o.return&&o.return()}finally{if(a)throw s}}}),this.widget.tracking.trackOfferedProducts(e)},fetchData:function(){this.widget.tracking.willTrackOnLoadOfSomeProducts(),this.fetch({error:_.bind(this.onError,this),success:_.bind(this.onSuccess,this)})},validateSelection:function(e){var t,i,n,a,r,o=(i=(t=this).some(function(e){return e.isMandatorySelectionFlagEnabled()}),n=t.some(function(e){return e.isContinueNagFlagEnabled()}),a="NONE",i&&(a=s),n&&(a="NAG"),a);switch(o){case s:r=this.validateContinueMandatorySelectionDisplay();break;case"NAG":r=this.validateContinueNagDisplay(e);break;default:r=!1}return{validationType:o,invalid:r}},validateContinueMandatorySelectionDisplay:function(){return!this.isAnyProductSelected()&&this.isMandatorySelectionValidationErrorDisplayFailed()},validateContinueNagDisplay:function(e){return!(e&&this.isAnyProductSelected()||_.isUndefined(this.getFirstModelToDisplayContinuanceNag()))},getFirstModelToDisplayContinuanceNag:function(){var e=this.getModelsHasToDisplayContinuanceNag(),t=this.getContinuanceNagGroupsExcluded();return _.first(e.filter(function(e){return!_.includes(t,e.getNagContinueGroup())}))},getModelsHasToDisplayContinuanceNag:function(){return this.filter(function(e){return e.hasToDisplayContinuanceNag()})},getContinuanceNagGroupsExcluded:function(){return _.compact(this.map(function(e){return e.getAddedPolicy()?e.getNagContinueGroup():null}))},getAddedPolicies:function(){return _.compact(this.map(function(e){return e.getAddedPolicy()}))},updateProductsStateOverRadicalShoppingCartAndContinue:function(e){n.configureShoppingCart("ancillary",this.widget.id,this.get("bookingId"),e),this.each(function(e){e.updateProductStateOverRadicalShoppingCart()}),n.submitProductPerPage()},getModelByPolicy:function(e){return this.find(function(t){return!_.isNull(t.getOfferByPolicy(e))})},toggleAncillaryOffer:function(e,t){var i=this.getModelByPolicy(e);t=_.isUndefined(t)?!i.isSelected(e):t,_.isUndefined(i)||i.selectProduct(t,e,!0)},isAnyProductSelected:function(){return this.reduce(function(e,t){var i=t.getSelectedPolicy();return e||!_.isUndefined(i)&&!t.isRejected(i)},!1)},isMandatorySelectionValidationErrorDisplayFailed:function(){var e=this.reduce(function(e,t){return t.validateProductSelection()||e},!1);return e&&this.each(function(e){e.setMandatorySelectionErrorAsShown()}),e},rejectSelectionForUnSelectedSingleProducts:function(){this.each(function(e){e.rejectProductSelectionIfIsNotSelected()})},showContinueNag:function(){var e=this.getFirstModelToDisplayContinuanceNag();_.isUndefined(e)||e.triggerAncillaryNag(r.NAG_TYPE.continuance)}})},function(e,t,i){"use strict";Odigeo.defineWidget("ancillaries_debuginfo",Odigeo.Widget.extend({modelClass:i(722),viewClass:i(723),load:function(){this.model.refreshData()}}))},function(e,t,i){"use strict";e.exports=Odigeo.Model.extend({dataUrl:"getancillariesdebuginfo",refreshData:function(){this.isEmptyData=!1,this.refresh()},url:function(){return Odigeo.Settings.getProperty("ancillariesUrlFormatter")(this.dataUrl)},getDataRequestSettings:function(){return{type:"GET",data:null,success:_.bind(this.requestSuccessHandler,this)}},requestSuccessHandler:function(e){_.isEmpty(e)||this.set("debuginfo",e)}})},function(e,t,i){"use strict";e.exports=Odigeo.View.extend({template:{main:"#ancillaries_debuginfo_script"},selectors:{mainContainer:".main_container"},renderTemplate:function(e){this.$cachedSelectors.mainContainer.html(this.template.main(e.toJSON()))},init:function(){this.template=Odigeo.Utils.getTemplates(this.$el,this.template,{variable:"tmpl"}),this.listenTo(this.model,"change",this.renderTemplate)}})},function(e,t,i){"use strict";var n=i(0),a=i(51);Odigeo.defineWidget("invoice_manager",Odigeo.Widget.extend({modelClass:Odigeo.Model.extend({requiredFields:[],init:function(){this.set({professional:"B2B"},{validate:!0}),this.widget.options=Odigeo.parseOptions(this.widget.options)},validate:function(){var e,t,i=this.requiredFields,n=[];return _.each(i,_.bind(function(i){"invoiceId"===i&&-1===this.widget.options.requiredFieldsPersonal.indexOf("id")&&"B2C"===this.get("professional")||"empty"!==(t=this.checkValidity(i))&&!1!==t||(e=t?"empty":"invalid",n.push({name:i,errorType:e}))},this)),0<n.length&&n},checkValidity:function(e){var t=this.widget.view.$widget.find('[data-name="'+e+'"]');t.val(Odigeo.Utils.trim(t.val()));var i=t.val(),n=function(e,t){return new RegExp(t.pattern).test(e)},a={REGEX_VALIDATOR:n,NULL_VALIDATOR:function(e){return!!e},REQUIRED_STRING:function(e){return _.isString(e)&&!!e},CIF_NIF_VALIDATOR:_.bind(function(e){return Odigeo.Utils.isValidNif(e)||Odigeo.Utils.isValidCif(e)},this),ZIP_CODE_VALIDATOR:n},s=a[t.data("validation-type")]?a[t.data("validation-type")](i,t.data()):i;return _.isEmpty(i)?"empty":s}}),viewClass:Odigeo.View.extend({selectors:{invoiceManagerNotNecessary:".invoicemanager_not_necessary",invoiceManagerCollapsibleContent:".invoicemanager_collapsible_content",invoiceManagerFormWrapper:".invoicemanager_form_wrapper",invoiceNameManagerB2B:".invoicemanager_name_B2B",invoiceNameManagerB2C:".invoicemanager_name_B2C",invoiceIdManagerB2B:".invoicemanager_id_B2B",invoiceIdManagerB2C:".invoicemanager_id_B2C",validationField:".validation_field",clearInput:".clear_input",invoiceDisplayOn:"#invoiceDisplayCheck",invoiceManagerOption:'[name="invoicemanager_option"]',invoiceName:'[name="invoiceName"]',invoiceAddress:'[data-name="invoiceAddress"]',invoiceCity:'[data-name="invoiceCity"]',invoiceZipcode:'[data-name="invoiceZipcode"]',invoiceCountryCode:'[data-name="invoiceCountryCode"]',invoiceId:'[data-name="invoiceId"]',allFocused:".submit_field_focusable",invoiceIdField:".invoice_id",invoiceIdCountry:".invoice_id .form_field_hover_tag"},inputLabelCorrespondences:{invoiceName:"invoice_name",invoiceId:"invoice_id",invoiceZipcode:"invoice_zipcode",invoiceAddress:"invoice_address",invoiceCity:"invoice_city"},init:function(){this.widget.options=Odigeo.parseOptions(this.widget.options),this.$cachedSelectors.invoiceManagerCollapsibleContent=Odigeo.UIElements.collapsive.enhance(this.$cachedSelectors.invoiceManagerCollapsibleContent,{triggerLauncher:"invoiceManagerCollapsible",triggerEvents:!0}),this.$cachedSelectors.invoiceManagerCollapsibleContent.length&&(this.$cachedSelectors.invoiceManagerCollapsibleContent.trigger("collapsePanel"),this.defineRequiredFields(),this.bindToDom(),this.preFillInputsValues(),this.setCorrectLabels())},bindToDom:function(){this.$cachedSelectors.invoiceDisplayOn.on(Odigeo.Events.change,_.bind(_.throttle(this.radioChangeHandler,500),this)),this.$cachedSelectors.invoiceManagerOption.on(Odigeo.Events.change,_.bind(function(e){this.changeTypeOfClient($(e.target).val())},this)),this.$cachedSelectors.allFocused.on(Odigeo.Events.blur,_.bind(this._checkField,this,!1)).on(Odigeo.Events.focus,_.bind(this._toggleFocused,this,!0)),this.$cachedSelectors.clearInput.on(Odigeo.Events.tap,_.partial(a.clearField,_)),this.$cachedSelectors.invoiceCountryCode.on(Odigeo.Events.change,_.bind(this.showInvoiceIdCountry,this)),this.showInvoiceIdCountry(),this.showNotNecessaryMessageWithScroll()},isIDCountryNeeded:function(){return _.includes(this.widget.options.countriesWithCodeInId,this.$cachedSelectors.invoiceCountryCode.val())&&"B2B"===this.widget.model.attributes.professional},getCountryValidation:function(e){return this.widget.options.invoiceCountryValidations[e]||this.widget.options.invoiceCountryValidations.default},showInvoiceIdCountry:function(){var e=this.getEUCountryCode(),t=this.getCountryValidation(e),i=this.isIDCountryNeeded();this.$cachedSelectors.invoiceId.data("pattern",t.regex.pattern).data("validation-type",t.name).toggleClass("active",i).closest(".validation_field").toggleClass("focused",i),this.$cachedSelectors.invoiceIdCountry.toggleClass("active",i).html(i?e:""),""!==this.$cachedSelectors.invoiceId.val()&&this._checkField(!1,this.$cachedSelectors.invoiceId)},addInvoiceIdCountry:function(e){this.isIDCountryNeeded()&&(e.invoiceId=this.getEUCountryCode()+e.invoiceId)},getEUCountryCode:function(){var e=this.$cachedSelectors.invoiceCountryCode.val();return"GR"===e?"EL":e},showNotNecessaryMessageWithScroll:function(){var e=0;$(window).scroll(_.bind(function(t){var i=this.$widget.offset().top-this.$widget.height()-100,n=i+20,a=$(t.target).scrollTop();i<=a&&a<=n&&e<a&&this.$cachedSelectors.invoiceManagerNotNecessary.hasClass("show")&&this.$cachedSelectors.invoiceManagerNotNecessary.addClass("animate").removeClass("show"),e=a},this))},setCorrectLabels:function(){var e=this.$cachedSelectors.invoiceManagerFormWrapper.attr("data-show"),t=this.widget.options.alternativeInvoiceLabels;_.each(["id","name"],_.bind(function(i){var n="invoice"+Odigeo.Utils.capitalize(i),a=this.$cachedSelectors[n].closest(this.$cachedSelectors.validationField),s=t[e][i],r=s.mandatory;a.find(".label_field_text").html(s.label),a.find(".wrong_label").html(r),this.setPlaceholderOrLabel(n,s.label),this.$cachedSelectors[n].attr("data-mandatory",r).attr("data-error",s.error)},this))},setPlaceholderOrLabel:function(e,t){this.$cachedSelectors[e].closest(".validation_field").find(".new_label_field").html(t)},defineRequiredFields:function(){var e=this.widget.options.requiredFieldsPersonal;_.isEmpty(e)||("B2B"===this.$cachedSelectors.invoiceManagerFormWrapper.attr("data-show")&&(e=this.widget.options.requiredFieldsProfessional),this.model.requiredFields=[],_.each(e.split(","),function(e){var t="invoice"+Odigeo.Utils.capitalize(Odigeo.Utils.stringToCamelCase(e));this.$cachedSelectors[t]&&this.model.requiredFields.push(t)},this))},radioChangeHandler:function(){this.cleanErrors(),this.$cachedSelectors.invoiceDisplayOn.is(":checked")&&(this.model.set("invoiceRequired",!0),n.trackEvent("invoice_widget","open_invoice_clicks")),this.$cachedSelectors.invoiceManagerCollapsibleContent.trigger("togglePanel")},getCompleteName:function(e){var t=e.lastName?e.lastName:(e.firstLastName?" "+e.firstLastName:"")+(e.secondLastName?" "+e.secondLastName:"");return(e.name||"")+t},fillAddressFields:function(e,t){_.each(t,_.bind(function(t,i){var n=this.$cachedSelectors[i].closest(".validation_field");this.$cachedSelectors[i].val(e[t]?e[t]:this.$cachedSelectors[i].val()),n.attr("data-state","valid")},this))},preFillLoggedUser:function(e){_.isObject(e)&&(this.fillAddressFields(e.profile.address,{invoiceAddress:"address",invoiceCity:"city",invoiceZipcode:"postalCode",invoiceCountryCode:"country"}),this.$cachedSelectors.invoiceName.attr("data-prefill-b2c",this.getCompleteName(e.profile)),this.showInvoiceIdCountry())},preFillInputsValues:function(){var e=Odigeo.Utils.parseJson(Odigeo.Session.get("passengersData"));_.isObject(e)&&_.isObject(e.buyer)&&_.isObject(e.passengers0)&&(this.fillAddressFields(e.buyer,{invoiceAddress:"address",invoiceCity:"cityName",invoiceZipcode:"zipCode",invoiceCountryCode:"country"}),this.$cachedSelectors.invoiceName.attr("data-prefill-b2c",this.getCompleteName(e.passengers0)),this.showInvoiceIdCountry())},fillInputName:function(e){var t="data-prefill-b2c",i="data-prefill-b2b",n=this.$cachedSelectors.invoiceName.val();"B2C"===e&&(t="data-prefill-b2b",i="data-prefill-b2c"),this.$cachedSelectors.invoiceName.attr(i)&&this.$cachedSelectors.invoiceName.attr(t,n).val(this.$cachedSelectors.invoiceName.attr(i)).trigger(Odigeo.Events.blur)},changeTypeOfClient:function(e){this.model.set("professional",e),this.$cachedSelectors.invoiceManagerFormWrapper.removeClass("od-show").addClass("od-hide"),_.delay(_.bind(function(){this.cleanErrors(),this.$cachedSelectors.invoiceManagerFormWrapper.attr("data-show",e),this.$cachedSelectors.validationField.filter("[data-client]").attr("data-client",e),this.fillInputName(e),this.$cachedSelectors.invoiceManagerFormWrapper.removeClass("od-hide").addClass("od-show"),-1===this.widget.options.requiredFieldsPersonal.indexOf("id")&&this.$cachedSelectors.invoiceIdField.toggleClass("hidden","B2C"===e),this.setCorrectLabels()},this),450)},storageInvoice:function(e){var t=this.model.getAll();this.cleanErrors(),_.each(this.model.requiredFields,_.bind(function(e){t[e]=this.$cachedSelectors[e].val()},this)),this.model.set(t,{validate:!0});var i=_.isEmpty(this.model.validationError);return i||(this.showErrors(e),this.$cachedSelectors.invoiceManagerNotNecessary.addClass("show"),Odigeo.trigger(this.widget.id+":showErrorsResume",this.model.validationError,this.model.get("professional"))),i},showErrors:function(){var e=this.model.validationError,t=this.model.get("professional");_.each(e,_.bind(function(e){var i=this.$cachedSelectors[e.name].closest(".validation_field");i.attr("data-state",e.errorType),this._changeError(i,!1),_.includes(["invoiceName","invoiceId"],e.name)&&i.attr("data-client",t),this.trackError(e.name,e.errorType,"submit")},this))},_checkField:function(e,t){var i=t.target?$(t.target):t,n=i.attr("data-name"),a=this.model.checkValidity(n),s="valid",r=this.$cachedSelectors[n].closest(".validation_field"),o=!_.isUndefined(t.relatedTarget)&&!_.isNull(t.relatedTarget)&&_.contains(t.relatedTarget.classList,"payment_continue_button");"empty"===a?s=e?"init":"empty":!1===a&&(s="invalid"),this.$cachedSelectors.invoiceManagerNotNecessary.removeClass("show animate"),r.attr("data-state",s),this._changeError(r,!o),this._toggleFocused(!1,i)},_toggleFocused:function(e,t){var i=t.target?$(t.target):t,n=i.attr("data-state"),a=i.siblings(".bottom_placeholder");0<a.length&&e?a.fadeIn(250):0<a.length&&!e&&a.fadeOut(250),i.closest(".validation_field").toggleClass("focused",e).attr("data-state",e?"init":n)},cleanErrors:function(){var e=this.$cachedSelectors.validationField.closest(".validation_field");_.each(e,function(e){var t=$(e);"valid"!==t.attr("data-state")&&t.attr("data-state","init")}),Odigeo.trigger(this.widget.id+":clearValidationErrors"),this.$cachedSelectors.invoiceManagerNotNecessary.removeClass("show animate")},getInvoiceValidation:function(e){var t=this.$cachedSelectors.invoiceDisplayOn.is(":checked");return this.model.set("invoiceRequired",t),!t||this.storageInvoice(e)},_changeError:function(e,t){var i=e instanceof $?e:$(e);this.setErrorText(i,"empty"===i.attr("data-state")||"init"===i.attr("data-state")?"empty":"invalid",t)},setErrorText:function(e,t,i){var n=e.find(".submit_field_focusable").attr("data-"+("empty"===t?"mandatory":"error"));e.find(".wrong_label, .form-error").text(n.trim()),"valid"!==e.attr("data-state")&&i&&this.trackError(e.find(".submit_field_focusable").attr("data-name"),t,"inline")},userLogged:function(e){_.isObject(e)&&_.isArray(e.traveller)&&0<e.traveller.length&&this.preFillLoggedUser(e.traveller[0])},getWrongChars:function(e,t){var i=a.giveWrongCharacters(this.$cachedSelectors[e]);return i?t+"_char:"+i:t},trackError:function(e,t,i){var a="empty"===t?"_missing_error":"_invalid_error",s=this.inputLabelCorrespondences[e]+"_"+i+a;"submit"===i&&(s=this.getWrongChars(e,s)),n.trackEvent("invoice_widget",s)}}),getInvoiceData:function(){var e=$.extend(!0,{},this.model.attributes);return e.professional="B2B"===e.professional,this.view.addInvoiceIdCountry(e),{invoicemanager:e}},isInvoiceValid:function(e){return this.view.getInvoiceValidation(e)},userLogged:function(e){this.view.userLogged(e)}}))},function(e,t,i){"use strict";$(function(){var e=i(36);Odigeo.defineWidget("passengers_manager",Odigeo.Widget.extend(e.extend({passengerTypes:{ADULT:"adults",CHILD:"children",INFANT:"infants"},passengerMap:{name:"name",travellerTitle:"title",firstLastName:"firstLastName",secondLastName:"secondLastName",phoneNumber1:"phoneNumber",phoneCode1:"prefixPhoneNumber",travellerGender:"gender"},contactDetailsMap:{address:"address",cityName:"city",country:"country",zipCode:"postalCode",buyer:{name:"name",firstLastName:"firstLastName",secondLastName:"secondLastName",phoneNumber:"phoneNumber1",prefixPhoneNumber:"phoneCode1"}},widgetIds:["buyer-email-on-top","buyer-pay"],modelClass:i(726),viewClass:i(728),init:function(){this.view._refreshInputs(),Odigeo.trigger(this.name+":init",this.id),_.each(this.view.$cachedSelectors.passengerFields,function(e){var t=$(e),i=t.find("input").data("error");t.find(".wrong_label").text(i)}),(this.options.hiddenLogin||_.includes(this.widgetIds,this.id))&&(this.view.restoreFieldsLocalStorage(),this.view.prefillCountryWithPrefixTelephone())},validate:function(){var e={widgetId:this.id};_.extend(e,this.view.collectPassengerData.apply(this.view,arguments)),this.view._validateAllFields()||(e.errors=!0),Odigeo.trigger(this.name+":completed",e)},getBuyerDTO:function(){var e={};return this.view.$cachedSelectors.passengerFields.each(function(){var t=$(this).find(".submit_field_focusable");e[t.data().name]=t.val()}),e},_getDefault:function(e){return _.find(e,function(e){return e.profile&&e.profile.isDefault})},_fillPassengerSelector:function(e,t){var i=!_.isEmpty(_.where(e,{id:0})),n=null;_.each(e,_.bind(function(e){var a;e.typeOfTraveller===this.model.passengerType&&(a=$("<option></option>").attr("value",e.id).text(e.profile.name+" "+e.profile.firstLastName+" "+(e.profile.secondLastName?e.profile.secondLastName:"")+(0===e.id?this.options.membershipOptionPremium:"")),"passengers0"===this.id&&0===e.id&&i?this.view.isStepBack()||(this.model.passengerSelectedId=0,n=a):e.profile.isDefault&&("passengers0"===this.id||this.options.isBuyer)&&_.contains([0,-1],this.model.passengerSelectedId)&&!i?this.view.isStepBack()||(this.model.passengerSelectedId=e.id):!this.options.isBuyer&&e.profile.isDefault&&"passengers0"!==this.id&&Odigeo.trigger(this.view.widget.name+":travellerSelected",{id:e.profile.id}),"passengers0"!==this.id&&!this.options.isBuyer&&_.isUndefined(e.id)||t.append(a))},this)),i&&(t.append(t.children(":first-child")),t.prepend(n))},trackingLoggedUser:function(e){this.view.trackingUtils.trackEvent("sso_pax_page",e?"prefilled_none_buyer":"prefilled_pax_none")},trackingLoggedBuyer:_.throttle(function(){this.trackingLoggedUser(!0)},2e3),showPassengerList:function(e){var t;this.model.user=e.userDTO,e&&e.userDTO&&e.userDTO.traveller&&0<e.userDTO.traveller.length&&(this.view.$cachedSelectors.customersPaxManager.removeClass("hidden"),(t=this.options.isBuyer?this.view.$cachedSelectors.contactDetailsSelector:this.view.$cachedSelectors.customerSelector).find('option[value!="-1"]').remove(),this._fillPassengerSelector(e.userDTO.traveller,t),this.options.isBuyer||this.view._initPassengerList())},updatePassengerListSelected:function(e){this._getDefault(this.model.user.traveller).id||_.isUndefined(_.get(e,"userDTO.id"))||(this.showPassengerList(e),this.model.passengerSelectedId=this._getDefault(this.model.user.traveller).id,this.options.isBuyer?this.view.$cachedSelectors.contactDetailsSelector.val(this.model.passengerSelectedId):this.view.setTravellerById(this.model.passengerSelectedId))},initContactDetailsInfo:function(e){var t=e?this._getDefault(e.traveller):"";this.trackingLoggedBuyer(),this.model.user=e,this.model.passengerSelectedId=t?t.id:-1,this.view._prefillEmail(e?this.model.user.email:""),this.view.$cachedSelectors.fillBuyerCombo.addClass("hidden"),this.view.$cachedSelectors.travellerTitleWarning.addClass("hidden"),this.view.$cachedSelectors.passwordBox.addClass("hidden"),t&&!this.view.isStepBack()&&(this.model.passengerType="ADULT",this.showPassengerList({userDTO:e,track:!1}),this.view.$cachedSelectors.contactDetailsSelector.val(this.model.passengerSelectedId),this.view._updateContactDetailsData(t),this.view.$cachedSelectors.contactDetailsSelector.off().on(Odigeo.Events.change,_.bind(function(){this.view.onContactDetailsPassengerChanged()},this))),e&&!_.isEmpty(this.model.user.email)&&(Odigeo.Utils.ensighten({custom_email:this.model.user.email},!0,"customemail"),this.view.tagManagement.fireEvent("submit_form","customer_email",this.model.user.email)),this.view.$cachedSelectors.passwordInput.val(""),this.view.isStepBack()||this.view._hideOrShowNonEditableContactDetailsLayer(t)},_getTravellerStructure:function(){var e,t=$.extend(!0,{},this.model.travellerModel);return-1!==this.model.passengerSelectedId?(e=_.find(this.model.user.traveller,{id:this.model.passengerSelectedId}),t.profile.address=e.profile&&e.profile.address?e.profile.address:t.profile.address,t.profile.prefixPhoneNumber=e.profile.prefixPhoneNumber,t.profile.phoneNumber=e.profile.phoneNumber,t.id=this.model.passengerSelectedId):-1!==this.model.passengerSelectedId||(_.isEmpty(this.model.user)||_.isUndefined(this._getDefault(this.model.user.traveller)))&&!_.isEmpty(this.model.user)||(t.profile.name=this.view.$cachedSelectors.hideOnUserLogged.find("[name=name]").val(),t.profile.firstLastName=this.view.$cachedSelectors.hideOnUserLogged.find("[name=lastName]").val(),t.typeOfTraveller="ADULT",t.profile.title="MR",_.isEmpty(this.model.user)?t.id=-1:t.id=this._getDefault(this.model.user.traveller).id||-1),t},_getPassengerData:function(){var e,t;return-1!==this.model.passengerSelectedId?e=_.find(this.model.user.traveller,{id:Number(this.model.passengerSelectedId)}):((e=$.extend(!0,{},this.model.travellerModel)).typeOfTraveller=this.model.passengerType,e.profile.address=null),_.each(this.view.$cachedSelectors.passengerInputs,_.bind(function(i){var n=$(i);t=this.passengerMap[n.data("name")],_.isUndefined(t)||("gender"===t&&n.is(":checked")&&(e.profile.title="MALE"===n.val()?"MR":"MS"),e.profile[t]=n.val())},this)),e},_getContactDetailsData:function(){var e=this._getTravellerStructure(),t=_.invert(this.contactDetailsMap.buyer);return _.each(this.view.$cachedSelectors.passengerInputs,_.bind(function(i){var n=$(i).data("name"),a=this.contactDetailsMap[n];_.isEmpty(a)||(e.profile.address[a]=$(i).val()),a=t[n],_.isEmpty(a)||_.isUndefined(this.model.travellerModel.profile[a])||(e.profile[a]=$(i).val())},this)),e.profile.firstLastName=this.view.$cachedSelectors.editableBuyerLayer.find("[data-name=lastName]").val(),e},getTravellersData:function(e){var t=this._getPassengerData();this.view.saveName&&Odigeo.trigger(this.name+":"+e,{saveAfterUpdate:!1,traveller:t},"passenger")},getContactDetails:function(e){Odigeo.trigger(this.name+":"+e,this._getContactDetailsData(),"contactDetails")},updateBaggageQuantity:function(e){var t=this.model.get("selectedBaggageQuantity");this.model.set({selectedBaggageQuantity:0<t?t-e:0})},getPassengerFullName:function(){var e=this._getPassengerData();return{name:e.profile.name,firstLastName:e.profile.firstLastName,id:this.id}},execute:function(e){var t=[].slice.call(arguments,1);switch(e){case"validate":this.validate.apply(this,t);break;case"getBuyerDTO":this.view.getBuyerDTO.apply(this.view,t);break;case"selectPassenger":this.view.selectPassenger.apply(this.view,t);break;case"userLoggedShowPassengerList":this.showPassengerList.apply(this,t);break;case"updatePassengerListSelected":this.updatePassengerListSelected.apply(this,t);break;case"userNotLoggedHidePassengerList":this.view.hidePassengerList.apply(this.view,t);break;case"hideTraveller":this.view.onHideTraveller.apply(this.view,t);break;case"showTraveller":this.view.onShowTraveller.apply(this.view,t);break;case"storeLocalData":this.view.storeLocalData.apply(this.view,t);break;case"userNotLoggedHideNonEditableBuyerLayer":this.view.onUserNotLogged.apply(this.view,t);break;case"userLoggedSetBuyerData":this.initContactDetailsInfo.apply(this,t);break;case"checkBaggages":this.view.checkBaggages.apply(this.view,t);break;case"updatePassengerIdentificationType":this.view.updatePassengerIdentificationType.apply(this.view,t);break;case"updatePassengerSelected":this.view.updatePassengerSelected();break;case"getTravellersData":this.getTravellersData.apply(this,t);break;case"getContactDetails":this.getContactDetails.apply(this,t);break;case"updateBaggageQuantity":this.updateBaggageQuantity.apply(this,t);break;case"blockEmail":this.view.blockEmail.apply(this.view,t);break;case"unlockEmail":this.view.unlockEmail.apply(this.view,t);break;case"showEmail":this.view.showEmail.apply(this.view,t);break;case"highlightEmail":this.view.highlightEmail.apply(this.view,t);break;case"showSmoothSubscriptionIndicator":this.view.showSmoothSubscriptionIndicator.apply(this.view,t);break;case"showSmoothSubscriptionTitleIndicator":this.view.showSmoothSubscriptionTitleIndicator.apply(this.view,t);break;case"showForcePrimeLoginIndicator":this.view.showForcePrimeLoginIndicator.apply(this.view,t);break;case"closeForceLoginPopup":this.view.closeForceLoginPopup(this.view,t);break;case"defaultNifSelection":this.view.defaultNifSelection.apply(this.view,t);break;case"toggleSOPhoneFormDisclaimer":this.view.toggleSOPhoneFormDisclaimer.apply(this.view,t);break;case"getFrequentFlyerTrackingData":this.view.frequentFlyerCodesTrackingData.apply(this.view,t);break;case"getFrequentFlyerTrackingOnInit":this.view.frequentFlyerCodesTrackingDataOnInit.apply(this.view,t);break;case"getFrequentFlyerMealsTracking":this.view.frequentFlyerMealsTracking.apply(this.view,t);break;case"getPassengerFullName":this.getPassengerFullName.apply(this,t);break;case"getBuyersEmail":this.view.getBuyersEmail.apply(this.view,t)}return this}})))})},function(e,t,i){"use strict";var n;e.exports=(n=i(727),Odigeo.Model.extend({defaultPassengers:{adults:{},children:{},infants:{},defaultTraveler:null},initialPassengers:{},passengerID:null,validationTypes:{REGEX_VALIDATOR:"REGEX_VALIDATOR",NULL_VALIDATOR:"NULL_VALIDATOR",OPTIONAL:"OPTIONAL",SECOND_EMAIL_VALIDATOR:"SECOND_EMAIL_VALIDATOR",IDENTIFICATION_VALIDATOR_NIF:"IDENTIFICATION_VALIDATOR_NIF",IDENTIFICATION_VALIDATOR_NIE:"IDENTIFICATION_VALIDATOR_NIE",IDENTIFICATION_VALIDATOR_CIF:"IDENTIFICATION_VALIDATOR_CIF",IDENTIFICATION_VALIDATOR_PASSPORT:"IDENTIFICATION_VALIDATOR_PASSPORT",REQUIRED_STRING:"REQUIRED_STRING",EXPIRATION_DATE:"EXPIRATION_DATE",ADULT_DATE_OF_BIRTH:"ADULT_DATE_OF_BIRTH",INFANT_DATE_OF_BIRTH:"INFANT_DATE_OF_BIRTH",CHILD_DATE_OF_BIRTH:"CHILD_DATE_OF_BIRTH",ZIP_CODE_VALIDATOR:"ZIP_CODE_VALIDATOR",INFANT_MAX_AGE:2,CHILD_MAX_AGE:12,CHILD_MIN_AGE:2,ADULT_MIN_AGE:12,CPF_VALIDATOR:"CPF_VALIDATOR",SECOND_EMAIL_VALIDATOR_CASE_INSENSITIVE:"SECOND_EMAIL_VALIDATOR_CASE_INSENSITIVE"},custom_email:"",travellerModel:i(163),user:null,passengerSelectedId:-1,passengerType:"",firstPassengerTemp:{},discountSelected:!1,init:function(){this.widget.options=Odigeo.parseOptions(this.widget.options)},getInitialPassengers:function(){var e=this.widget.options.travellerType,t=[];_.each(this.widget.model.readAllPassengers(!0)[e],function(e,i){t.push({id:i,name:[e.name,e.firstLastName||e.lastName].join(" ").trim()})}),this.initialPassengers=t},readPassenger:function(e){var t=this.readAllPassengers()[this.widget.options.travellerType];return _.has(t,e)?t[e]:null},readAllPassengers:function(e){var t,i=_.clone(this.defaultPassengers);try{t=e&&Odigeo.Storage.get("travellers")||null,_.isNull(t)||(i=JSON.parse(t))}catch(e){}return i},resetCacheBaggages:function(){var e=[this.widget.options.travellerType],t=this.readAllPassengers(!0)||{};_.isEmpty(t)||_.each(t[e],function(e){_.isUndefined(e.baggageSelectionDTOs)&&_.isEmpty(e.baggageSelectionDTOs)||(e.baggageSelectionDTOs=[])},this)},validateNIF:Odigeo.Utils.isValidNif,validateNIE:function(e){var t="XYZ".indexOf(e.substr(0,1).toUpperCase());return 0<=t&&Odigeo.Utils.isValidNif(t+e.substr(1))},checkMailValidity:function(e,t){return new RegExp(e.pattern).test(t)},_validatePassport:function(e){return!!e&&e.length<=20},_uniqueIdDocument:function(e){var t=$('[data-id^="passengers"]').find('input[name="identification"]');return 1===_.reduce(t,function(t,i){return e.toUpperCase()===$(i).val().toUpperCase()&&++t,t},0)},_validateUniqueFields:function(e){var t=e.closest("[data-viewwidget]").find('[data-id^="passenger"] [name="'+e.data("name")+'"]'),i=_.compact(_.map(t,"value"));return _.uniq(i).length===i.length},checkValidity:function(e,t){var i,a,s,r,o,c=e.data(),d=e.val(),l=new Date(Number(this.widget.options.lastDepartureDate||Date.now())).getTime(),g=new Date,h=new Date(g.getFullYear(),g.getMonth(),g.getDate()),u=_.isEmpty(d),p="required"===e.attr("required"),f=!0;switch(e.data("validationType")){case this.validationTypes.REGEX_VALIDATOR:o=new RegExp(c.pattern).test(d);break;case this.validationTypes.IDENTIFICATION_VALIDATOR_NIF:o=new RegExp(c.pattern).test(d)&&this.validateNIF(d),this.widget.options.isBuyer||(o=o&&this._uniqueIdDocument(d));break;case this.validationTypes.OPTIONAL:o=!0;break;case this.validationTypes.IDENTIFICATION_VALIDATOR_NIE:o=new RegExp(c.pattern).test(d)&&this.validateNIE(d),this.widget.options.isBuyer||(o=o&&this._uniqueIdDocument(d));break;case this.validationTypes.IDENTIFICATION_VALIDATOR_CIF:o=!!d;break;case this.validationTypes.IDENTIFICATION_VALIDATOR_PASSPORT:o=this._validatePassport(d);break;case this.validationTypes.NULL_VALIDATOR:o=!p||!!d;break;case this.validationTypes.REQUIRED_STRING:o=_.isString(d)&&!!d;break;case this.validationTypes.SECOND_EMAIL_VALIDATOR:case this.validationTypes.SECOND_EMAIL_VALIDATOR_CASE_INSENSITIVE:var m=this.widget.view.$cachedSelectors.buyerEmail.val();this.widget.options.fixEmailCapitalValidation&&m&&(d=d.toLowerCase(),m=m.toLowerCase()),o=!!d&&this.checkMailValidity(c,d)&&d===m;break;case this.validationTypes.EXPIRATION_DATE:i=new Date(d.replace(/-/g,"/")),o=!isNaN(i.getTime())&&l<i;break;case this.validationTypes.ADULT_DATE_OF_BIRTH:a=new Date(d.replace(/-/g,"/")),o=!isNaN(a.getTime())&&(r=new Date(a.getFullYear()+this.validationTypes.ADULT_MIN_AGE,a.getMonth(),a.getDate()))<=l&&a<h;break;case this.validationTypes.CHILD_DATE_OF_BIRTH:a=new Date(d.replace(/-/g,"/")),isNaN(a.getTime())?o=!1:(r=new Date(a.getFullYear()+this.validationTypes.CHILD_MIN_AGE,a.getMonth(),a.getDate()),s=new Date(a.getFullYear()+this.validationTypes.CHILD_MAX_AGE,a.getMonth(),a.getDate()),(o=r<=l&&l<s)||Odigeo.trigger(this.widget.name+":ageValidationFailed","kid",t));break;case this.validationTypes.INFANT_DATE_OF_BIRTH:a=new Date(d.replace(/-/g,"/")),isNaN(a.getTime())?o=!1:(o=l<(s=new Date(a.getFullYear()+this.validationTypes.INFANT_MAX_AGE,a.getMonth(),a.getDate()))&&a<h)||Odigeo.trigger(this.widget.name+":ageValidationFailed","kid",t);break;case this.validationTypes.ZIP_CODE_VALIDATOR:var b=this.widget.view.$cachedSelectors.buyerCountry.val();o=Odigeo.Utils.isValidPostalCode(b,d.toUpperCase());break;case this.validationTypes.CPF_VALIDATOR:var y=e.val();o=n.isValidCpf(y);break;default:return d}return _.isUndefined(c.unique)||(f=this._validateUniqueFields(e)),f&&!u?o:void 0},getLatestPossibleBirthDate:function(){var e=new Date(Number(this.widget.options.lastDepartureDate||Date.now()));switch(this.widget.options.travellerType){case this.widget.passengerTypes.ADULT:e.setFullYear(e.getFullYear()-this.validationTypes.ADULT_MIN_AGE);break;case this.widget.passengerTypes.CHILD:e.setFullYear(e.getFullYear()-this.validationTypes.CHILD_MIN_AGE);break;case this.widget.passengerTypes.INFANT:(e=new Date(Date.now())).setDate(e.getDate()-1)}return e},getEarliestPossibleBirthDate:function(){var e=new Date(Number(this.widget.options.lastDepartureDate||Date.now()));switch(this.widget.options.travellerType){case this.widget.passengerTypes.ADULT:e.setFullYear(1900);break;case this.widget.passengerTypes.CHILD:e.setFullYear(e.getFullYear()-this.validationTypes.CHILD_MAX_AGE);break;case this.widget.passengerTypes.INFANT:e.setFullYear(e.getFullYear()-this.validationTypes.INFANT_MAX_AGE)}return e.setDate(e.getDate()+1),e},getGooglePlacesRest:function(e){return this.fetch(e)}}))},function(e,t,i){"use strict";function n(e,t,i){var n,a,s;return n=function(e,t,i){for(var n=0,a=1;a<=t;a++)e=10*(n+=parseInt(i.substring(a-1,a))*(t+2-a))%11;return e}(e,t,i),s=(a=t)+1,(e=10===n||11===n?0:n)===parseInt(i.substring(a,s))}e.exports={isValidCpf:function(e){var t;return 11===e.length&&(t=e,!_.every(t.split(""),function(e){return e===t[0]}))&&(n(0,9,e),n(0,10,e))}}},function(e,t,i){"use strict";var n,a,s,r,o;e.exports=(n=i(0),a=i(7),s=i(332),r=i(729),o=i(730),Odigeo.View.extend({events:{"keyup @googlePlacesAutocompleteInput":"updateAutocompleteGooglePlacesInput","tap .get_place_id":"getPlaceId","tap .passenger_container":"closeGooglePlaceAutocomplete","tap @forceLoginButton":"openLoginPopup","tap @closeForceLogin":"closeForceLoginPopup"},isDomBinded:!1,showAutocomplete:!1,saveName:!0,storeData:i(331),trackingUtils:i(0),tagManagement:i(7),fieldUtils:i(51),googlePlacesHelper:o,init:function(){var e=this;this.widget.options.isAddressAutoFillEnabled&&this.googlePlacesHelper.init(".input_autocomplete_address"),this.model.set("isTrackingSent",!1),this.cacheDomSelectors(),this.listenTo(this.model,"change:validationMail",_.bind(this.onValidationEmailModelChange,this)),this.widget.options.validateOnlyRequired=JSON.parse(this.widget.options.validateOnlyRequired||"false")?"[required]":"*",this.model.passengerType=this.widget.options.travellerType,this.widget.options.travellerType=this.widget.passengerTypes[this.$cachedSelectors.passengerTypeSelector.val()||"ADULT"],this.widget.model.set({selectedBaggageQuantity:this.widget.getBaggageSelectedPieces()}),this.widget.model.getInitialPassengers(),JSON.parse(this.widget.options.hasExpandables||"false")&&Odigeo.UIElements.enhanceExpandable(this.$el.find(".passenger_form_content"),{enabled:!0}),_.each(this.$el.find(".calendar_input"),function(e){"dateOfBirth"===$(e).data("name")?Odigeo.UIElements.enhanceInputDate(e,this.model.getEarliestPossibleBirthDate(),this.model.getLatestPossibleBirthDate()):Odigeo.UIElements.enhanceInputDate(e)},this),this.bindToDom(),this.widget.options.storageEnabled=_.isUndefined(this.widget.options.storePassengers)?this.$cachedSelectors.storePassengerCheckbox.is(":checked")||!1:this.widget.options.storePassengers||!1,this.widget.model.resetCacheBaggages(),this.refreshPassengerSelector(),this.identificationTypeValidations(),this.buyerValidation(),this.$cachedSelectors.identificationType.bind(Odigeo.Events.change,_.bind(function(){this.identificationTypeValidations()},this)),this.$cachedSelectors.buyerIdentificationType.bind("change",_.bind(function(){this.buyerValidation()},this)),this.$cachedSelectors.buyerCountry.bind(Odigeo.Events.change,_.bind(function(e){this.showStateName(e.currentTarget.value)},this)),!this.widget.options.isBuyer&&this.$el.find(".input_wrapper_birth select").length&&Odigeo.UIElements.enhanceDateWithSelects.setRange(this.$el.find('[data-name="dateOfBirth"]'),this.model.getLatestPossibleBirthDate(),this.model.getEarliestPossibleBirthDate()),_.forEach(this.$cachedSelectors.dropdownSelect,function(t){var i=$(t).find(".dropdown_select_selected").data("name");r.initDropdown($(t),e.$cachedSelectors.dropdownOption,"buyer."+i,"passengersData")},this)},selectors:{passengerHeader:".passenger_title",identificationType:'[data-name="identificationType"]',buyerIdentificationType:'[data-name="buyerIdentificationType"]',identification:'[data-name="identification"]',passangermanagerSecondLastNameWrapper:".second_last_name_container",passangermanagerSecondLastName:'[data-name="secondLastName"]',name:'[data-name="name"]',firstLastName:'[data-name="firstLastName"]',fullName:'[data-name="name"], [data-name="firstLastName"]',titleName:".passenger_title_text",storedPassengers:".stored_passengers select",storedPassengersWrapper:".stored_passengers",storePassengerCheckbox:".store_passenger",passengerTypeSelector:'[data-name="travellerType"]',stateName:'[data-name="stateName"]',formContent:".form_content",passengerInputsOptional:'[data-requiredoptional="optional"]',addDocumentBtn:".document_add_btn",documentsContainer:".document_container",documents:".document_section",passengerFields:".validation_field",allFocused:'input:not([type="hidden"]), select',allCalendars:".calendar_input",selectsPlaceholder:".select_input:has(option[placeholder])",selectField:".select_input",baggage:".od-passenger-bag-row",buyerEmail:'input[data-name="mail"]',suggestionMail:".mail_suggestion",suggestionValidationMail:".validation_mail_suggestion",buyerEmailSuggestion:".buyer_mail_suggestion",customersPaxManager:".customers_pax_manager",customerSelector:".customer_selector",contactDetailsSelector:".contact_details_selector",editBuyerInfoButton:".edit_buyer_info_button",changeBlockedEmail:".change_blocked_email",buyerEditableEmail:".buyer_editable_email",buyerNonEditableEmail:".buyer_noneditable_email",passengerEmail:".buyer_email",nonEditableLayerFields:"[data-noneditable-layer]",hideOnUserLogged:".hide_on_user_logged",fillBuyerCombo:".fill_buyer_combo_section",travellerTitleWarning:".traveller_title_warning",buyerEditableValidationMail:".buyer_editable_validation_mail",buyerValidationMail:'input[data-name="validationMail"]',apisContainer:".apis_container",showApisRequests:".show_apis_requests",apisRequestsWrapper:".passengersmanager_apis_requests_wrapper",zipCode:'[data-name="zipCode"]',buyerCountry:'[data-name="country"]',clickError:".click_error",passwordInput:'[data-name="password"]',passwordBox:".password_box",passwordIcon:".password_char_viewer",bDayInputs:".input_wrapper_birth .select_day, input_wrapper_birth .select_month, .input_wrapper_birth .select_year",showOptionalRequests:".show_optional_requests",moreOptionsBlock:".moreoptions_block",passengerCardNumber:".passenger_card_number",fflyerCodesSection:".fflyer_codes_section",mealsSelector:'select[data-name="meal"]',apisRequestsWrapperInputs:".passengersmanager_apis_requests_wrapper [data-name]",baggageType:'[data-fieldtype="baggageType"]',allNamesInput:'[data-name="name"]',formDisclaimers:".form_disclaimer",allInputs:'input[data-name]:not([type="hidden"]), select[data-name]:not([type="hidden"])',visibleDateFields:".input_wrapper_birth:visible .date",membershipSignal:".membership_signal",membershipExtraInfo:".membership_extra_information",selectOptionMember:".select_option_member",paxSelectorLabel:".pax_selector_label",paxSeparatorTitle:".pax_separator_title",stateNameContainer:".stateNameContainer",googlePlacesAutocompleteInput:'input[data-name="address"]',primeInPaymentForceLogin:".prime_in_payment_force_login",forceLoginButton:".force_login_button",closeForceLogin:".close_force_login",dropdownSelect:".dropdown_select_with_input",dropdownOption:".dropdown_select_option"},cacheDomSelectors:function(){this.addSelectorToCache("nonEditableBuyerLayer",Odigeo.UIElements.collapsive.enhance(this.$el.find(".non_editable_buyer_layer"))),this.addSelectorToCache("editableBuyerLayer",Odigeo.UIElements.collapsive.enhance(this.$el.find(".editable_buyer_layer"),{initiallyExpanded:!0})),this.addSelectorToCache("editableBuyerLayerWidget",Odigeo.UIElements.collapsive.enhance(this.$el.find(".editable_buyer_layer_widget"),{initiallyExpanded:!0})),this.addSelectorToCache("toggleOptionalRequest",Odigeo.UIElements.collapsive.enhance(this.$el.find(".passengersmanager_optional_requests"),{googleAnalyticsOnOpen:{type:"trackEvent",data:{page:Odigeo.History.getPageNameFromFragment(),action:"optional_requests_open",label:"optional_requests"}}})),this.addSelectorToCache("toggleApisRequest",Odigeo.UIElements.collapsive.enhance(this.$cachedSelectors.apisRequestsWrapper,{googleAnalyticsOnOpen:{type:"trackEvent",data:{page:Odigeo.History.getPageNameFromFragment(),action:"apis_requests_open",label:"apis_requests"}}})),this.addSelectorToCache("passengerInputs",this.$el.find("[data-name]").not(this.$cachedSelectors.apisRequestsWrapperInputs).not(this.$cachedSelectors.passengerCardNumber).not(this.$cachedSelectors.baggageType).not(this.$cachedSelectors.passengerInputsOptional)),this.addSelectorToCache("passengerFullInputs",this.$el.find("[data-name]").not(this.$cachedSelectors.baggageType)),this.addSelectorToCache("ffyerButton",this.$el.find("#showFlyerOptions"+this.widget.options.index))},updatePassengerIdentificationType:function(e){var t=_.isNull(e)?this.$cachedSelectors.identificationType.val():e;this.$cachedSelectors.identificationType.val(t),this.identificationTypeValidations()},identificationTypeValidations:function(){var e=this.$cachedSelectors.identificationType.val(),t="NULL_VALIDATOR",i="NIF"===e;-1<["NIF","NIE","CIF","PASSPORT"].indexOf(e)&&(t="IDENTIFICATION_VALIDATOR_"+e),i?this.$cachedSelectors.passangermanagerSecondLastName.attr("required","required").removeClass("optional"):this.$cachedSelectors.passangermanagerSecondLastName.removeAttr("required").addClass("optional"),this.$cachedSelectors.passangermanagerSecondLastNameWrapper.toggleClass("hidden",!i),this.$cachedSelectors.identification.data("validationType",t),this.$cachedSelectors.identification.data("pattern",this.$cachedSelectors.identificationType.find(":selected").attr("data-pattern"))},showStateName:function(e){var t=this.widget.options,i=t.nonHidableStateNameCountry?t.nonHidableStateNameCountry.split(","):[],n=t.isStateNameHidable&&!_.includes(e,i);this.$cachedSelectors.stateName.toggleClass("optional",n),this.$cachedSelectors.stateNameContainer.toggleClass("odf-hidden",n)},getBuyersEmail:function(){Odigeo.trigger(this.widget.name+":scrollAndSelectPrime",this.$cachedSelectors.buyerEmail.val())},showSmoothSubscriptionIndicator:function(){var e=this.$cachedSelectors.firstLastName.parent(),t=this.$el.find(".tooltip_smooth_passenger_indicator");if(0===t.length){var i=_.template(this.$el.find(".smooth_subscription_passenger_indicator").html(),Odigeo.Utils.getTmplSettings());e.addClass("odf-popup-container"),e.append(i()),n.trackEvent("unlocked","unlocked_titular_info_close"),this.$el.find(".tooltip_smooth_passenger_indicator_close").on(Odigeo.Events.tap,_.bind(this.closeSmoothSubscriptionIndicator,this))}else t.addClass("opened")},showSmoothSubscriptionTitleIndicator:function(e){this.$el.find(".smooth_passenger_title").toggleClass("odf-hidden",!e),this.$el.find(".smooth_passenger_title_indicator").toggleClass("odf-hidden",!e),this.$el.find(".smooth_passenger_title_description").toggleClass("odf-hidden",!e),this.$el.find(".passenger_title_text").toggleClass("odf-hidden",e),this.$el.find(".passenger_title_type").toggleClass("odf-hidden",e),e||this.closeSmoothSubscriptionIndicator()},showForcePrimeLoginIndicator:function(e){this.widget.model.set("discountSelected",e);var t=this.$cachedSelectors.buyerEditableValidationMail;this.$cachedSelectors.primeInPaymentForceLogin.addClass("open opened"),this.$cachedSelectors.buyerEmail.closest(".validation_field").addClass("invalid"),t.val(""),t.closest(".validation_field").toggleClass("valid focused"),this.highlightEmail();var i=e?"prime":"no-prime";n.trackEvent("unlocked","unlocked_existing_account_sce:"+i)},closeForceLoginPopup:function(){this.$cachedSelectors.primeInPaymentForceLogin.removeClass("open opened");var e=this.widget.model.get("discountSelected")?"prime":"no-prime";n.trackEvent("unlocked","unlocked_existing_account_close_sce:"+e),Odigeo.trigger(this.widget.name+":closeForceLoginPopup")},openLoginPopup:function(){this.$cachedSelectors.primeInPaymentForceLogin.removeClass("open opened");var e=this.widget.model.get("discountSelected")?"prime":"no-prime";n.trackEvent("unlocked","unlocked_go_to_login_sce:"+e),Odigeo.trigger(this.widget.name+":openLoginForm"),Odigeo.trigger(this.widget.name+":closeForceLoginPopup")},closeSmoothSubscriptionIndicator:function(){this.$el.find(".tooltip_smooth_passenger_indicator").removeClass("opened")},defaultNifSelection:function(){var e=this.$el.find('select[data-name="localityCodeOfResidence"]');0<e.length&&(e.off("change").on("change",_.bind(function(e){this.$el.find('input[data-name="localityNameOfResidence"]').val(e.target[e.target.selectedIndex].label)},this)),e.val(e[0][e[0].selectedIndex].value),this.$el.find('input[data-name="localityNameOfResidence"]').val(e[0][e[0].selectedIndex].label),this.$el.find('select[data-name="identificationType"] option[value="NIF"]').prop("selected",!0).trigger("change"))},blockEmail:function(){this.$cachedSelectors.buyerEmail.attr("disabled","disabled"),this.$cachedSelectors.buyerEmail.addClass("od-passengersmanager-blocked-email-input-color"),this.$cachedSelectors.buyerEditableValidationMail.closest(".validation_field").addClass("odf-hidden"),this.$cachedSelectors.changeBlockedEmail.removeClass("odf-hidden")},showEmail:function(e){this.$cachedSelectors.buyerEditableEmail.toggleClass("odf-hidden",!e)},unlockEmail:function(){this.$cachedSelectors.buyerEmail.removeAttr("disabled"),this.$cachedSelectors.buyerEditableValidationMail.closest(".validation_field").removeClass("odf-hidden"),this.$cachedSelectors.changeBlockedEmail.addClass("odf-hidden"),Odigeo.trigger(this.widget.name+":deleteMembership")},highlightEmail:function(){Odigeo.Utils.scrollToElement(this.$cachedSelectors.buyerEmail)},acceptChangeEmail:function(){n.trackEvent("unlocked","nag_unlocked_change_email_continue"),this.unlockEmail()},denyChangeEmail:function(){n.trackEvent("unlocked","nag_unlocked_change_email_keep"),Odigeo.trigger("closeAllPopUps")},onChangeBlockedEmail:function(){n.trackEvent("customer_details","change_email"),n.trackEvent("unlocked","nag_unlocked_change_email_appearances"),Odigeo.UIElements.showLightboxWarning("od-passenger-lightbox-email-alert",_.bind(this.acceptChangeEmail,this),_.bind(this.denyChangeEmail,this),this.widget.options.lightboxChangeEmailTexts)},buyerValidation:function(){var e="NULL_VALIDATOR";if(this.widget.options.isBuyer){-1<["NIF","NIE","CIF","PASSPORT"].indexOf(this.$cachedSelectors.buyerIdentificationType.val())&&(e="IDENTIFICATION_VALIDATOR_"+this.$cachedSelectors.buyerIdentificationType.val());var t=this.$cachedSelectors.buyerIdentificationType.find(":selected").attr("data-pattern");this.$cachedSelectors.identification.val("").data("validationType",e).data("pattern",t)}},_reCacheAndBindAllInputs:function(){this.updateDomSelectorsToCache(),this._reBindInputs()},_reBindInputs:function(){var e={blurValidationEvent:{handler:this._inputBlurHandler,target:this.$cachedSelectors.allFocused},progressiveValidationEvent:{handler:this._validateUntilField,target:this.$cachedSelectors.allInputs},selectValidationEvent:{handler:this._inputBlurHandler,target:this.$cachedSelectors.allInputs.filter("select")},resetInputStateEvent:{handler:_.throttle(this._handleChangeText,350,{trailing:!1}),target:this.$cachedSelectors.allInputs.filter('input[type="text"], input[type="email"]')}};this.$cachedSelectors.allInputs.off(Odigeo.Events.focus),_.each(e,function(e,t){e.target.on(_.map((this.widget.options[t]||"").split(" "),function(t){return _.isEmpty(t)||e.target.off(t),Odigeo.Events[t]||""}).join(" "),_.bind(e.handler,this))},this),this.$cachedSelectors.allFocused.on(Odigeo.Events.focus,_.bind(this._focusHandler,this)),this.$cachedSelectors.passwordIcon.on(Odigeo.Events.tap,_.bind(this._togglePasswordVisibility,this))},bindToDom:function(){var e=_.bind(function(e){var t=$(e.currentTarget),i=t.val();if(this.widget.model.checkValidity(t)&&i!==this.widget.model.custom_email&&(this.widget.model.custom_email=i,Odigeo.Utils.ensighten({custom_email:this.widget.model.custom_email},!0,"customemail"),a.fireEvent("submit_form","customer_email",this.widget.model.custom_email)),!_.isEmpty(this.$cachedSelectors.buyerValidationMail.val())){var n=this.widget.model.checkValidity(this.$cachedSelectors.buyerValidationMail);this.$cachedSelectors.buyerEditableValidationMail.closest(".validation_field").toggleClass("valid",n).toggleClass("invalid",!n)}},this);if(!this.isDomBinded){_.each(this.$el.find(".tooltip_hint_wrapper"),function(e){var t=$(e),i=Odigeo.UIElements.enhanceTooltip(t.find(".tooltips_hint_container"));t.find(".open_hint").on(Odigeo.Events.tap,function(e){i.show(),e.stopPropagation()})},this),this.$widget.on(Odigeo.Events.change,'input[type="radio"]',_.bind(function(){this.storeLocalData(!1)},this)).on(Odigeo.Events.tap,".calendar",_.bind(function(e){if(!Odigeo.AB.isNewDOBPicker||"desktop"===Odigeo.SessionScope.flow){var t=$(e.currentTarget).find(".calendar_input");this._toggleCalendar(t,!0,!0)}},this)).on(Odigeo.Events.change,".calendar_input",_.bind(function(e){var t=$(e.currentTarget);_.isEmpty(t.val())||t.siblings(".calendar_placeholder").addClass("hidden")},this)).on(Odigeo.Events.change,'.select_input[data-pax-index="'+this.widget.options.index+'"]',_.bind(function(e){var t=$(e.currentTarget),i=t.find("option").filter(":selected"),n=i.data("numbags"),a=t.data("applicationlevel")===this.getBaggagesApplicationLevelEnum().segment?t.data("segmentindex"):"",s=t.attr("data-index"),r=i.data("price"),o=i.data("kilos");0<n&&(t.parent().parent().parent().find(".baggage_selector").toggleClass("hidden",!0),t.parent().parent().parent().find(".baggage_reset").toggleClass("hidden",!1)),this.widget.model.set({selectedBaggageQuantity:this.widget.model.get("selectedBaggageQuantity")+n}),this._dataChangedHandler(),Odigeo.trigger(this.widget.name+":baggageChange",{type:"baggage",id:this.widget.id,index:s,data:{price:parseFloat(r||0),quantity:parseFloat(n||0),segmentIndex:a,kilos:o}}),t.data("prev-kilos",i.data("kilos"))},this)).on(Odigeo.Events.tap,".baggage_selector",_.bind(function(e){var t=e.target.getAttribute("data-index");this.$el.find(".baggage_type_wrapper_"+t).toggleClass("hidden",!1),this.$el.find(".baggage_type_wrapper").not(".baggage_type_wrapper_"+t).toggleClass("hidden",!0)},this)).on(Odigeo.Events.tap,".baggage_reset",_.bind(function(e){var t,i,n,a,s=$(e.currentTarget),r=this.$el.find(".js_baggageType_"+s.attr("data-index")),o=r.find("option").filter(":first"),c=r.find("option").filter(":selected").data().numbags;s.siblings(".baggage_selector").toggleClass("hidden",!1),s.toggleClass("hidden",!0),this.$el.find(".baggage_type_wrapper").toggleClass("hidden",!0),o.attr("selected",!0),r.val(o.val()),t=r.find("option").filter(":selected").data("numbags"),i=r.data("segmentindex"),n=r.find("option").filter(":selected").data("price"),a=r.data("prev-kilos")||r.find("option").filter(":selected").data("kilos");var d=this.widget.model.get("selectedBaggageQuantity");this.widget.model.set({selectedBaggageQuantity:0<d?d-c:0}),Odigeo.trigger(this.widget.name+":baggageChange",{type:"baggage",id:this.widget.id,index:s.attr("data-index"),data:{price:parseFloat(n),quantity:parseFloat(t),segmentIndex:i,kilos:a}}),r.data("prev-kilos",r.find("option").filter(":selected").data("kilos"))},this)).on(Odigeo.Events.tap,".clear_input",_.bind(function(e){this.fieldUtils.clearField(e)},this)),this.$cachedSelectors.showApisRequests.on(Odigeo.Events.change,_.bind(function(){this.$cachedSelectors.toggleApisRequest.trigger("togglePanel",{isOpenedAutomatic:this.$cachedSelectors.showApisRequests.is(":checked")}),this.$cachedSelectors.apisRequestsWrapper.find(".validation_field").removeClass("invalid empty")},this)),this.$cachedSelectors.moreOptionsBlock.on(Odigeo.Events.change,_.bind(function(){this.$cachedSelectors.toggleOptionalRequest.trigger("togglePanel",{isOpenedAutomatic:this.$cachedSelectors.showOptionalRequests.is(":checked")})},this)),this.$cachedSelectors.ffyerButton.on(Odigeo.Events.change,_.bind(function(){this.$cachedSelectors.fflyerCodesSection.toggleClass("odf-hidden",!this.$cachedSelectors.ffyerButton.is(":checked"))},this)),this._reBindInputs(),this.$cachedSelectors.passengerTypeSelector.on(Odigeo.Events.change,_.bind(this._passengerSelectorHandler,this)),this.$cachedSelectors.storedPassengers.on(Odigeo.Events.change,_.bind(this._storedPassengersChangeHandler,this)),this.$cachedSelectors.storePassengerCheckbox.on(Odigeo.Events.change,_.bind(function(e){var t=this.widget.options.isBuyer?"buyer_":"pax_",i=this.widget.options.isBuyer?"":this.widget.id[this.widget.id.length-1]+"_";n.trackEventWithCategory("flights_pax_page",t+"details","save_"+t+i+"info_"+(e.target.checked?"checked":"unchecked")),this.widget.options.storageEnabled=e.target.checked},this)),this.$cachedSelectors.addDocumentBtn.on(Odigeo.Events.tap,_.bind(this._addDocumentSectionHandler,this)),this.$cachedSelectors.changeBlockedEmail.on(Odigeo.Events.tap,_.bind(this.onChangeBlockedEmail,this)),this.$cachedSelectors.selectsPlaceholder.on(Odigeo.Events.change,_.bind(function(e){var t=$(e.currentTarget);this._toggleSelect(t)},this)),this.$cachedSelectors.selectField.on(Odigeo.Events.change,_.bind(function(e){$(e.currentTarget).closest(".validation_field").removeClass("focused")},this)),Odigeo.bind(this.widget.id+":refreshPassengerSelector",_.bind(this.refreshPassengerSelector,this)),Odigeo.bind(this.widget.id+":setPassenger",_.bind(this._setSelectedPassenger,this)),Odigeo.Device.navigator.isSafariiOS&&this.$cachedSelectors.allCalendars.addClass("is-safari"),this.widget.options.isBuyer&&(this.$cachedSelectors.buyerEmail.off(Odigeo.Events.blur,e).on(Odigeo.Events.blur,e),this.bindAutocompleteMailEvents(),this.$cachedSelectors.buyerEditableValidationMail.on(Odigeo.Events.paste,function(e){e.preventDefault()}),this.$cachedSelectors.buyerValidationMail.on(Odigeo.Events.blur,_.bind(function(e){var t=$(e.currentTarget);this.widget.model.checkValidity(t)&&this.$cachedSelectors.buyerEditableValidationMail.find(".validation_field").removeClass("valid invalid empty")},this)),this.$cachedSelectors.editBuyerInfoButton.off().on(Odigeo.Events.tap,_.bind(this.hideNonEditableBuyerLayer,this,!0)));var t=$().add(this.$cachedSelectors.allInputs).add(this.$cachedSelectors.bDayInputs);_.each(t,function(e){var t=$(e);t.on(Odigeo.Events.focus,_.bind(function(){this.fieldUtils.showHidePlaceholder(t,!0),t.closest(".validation_field").removeClass("empty invalid valid").attr("data-state","init")},this)).on(Odigeo.Events.blur,_.partial(this.fieldUtils.showHidePlaceholder,t,!1))},this),this.isDomBinded=!0}},onValidationEmailChange:function(e,t){this.model.set(e,t.target.value)},onValidationEmailModelChange:function(e,t){var i=_.size(t)<_.size(e.previous("validationMail")),n=s.getDomainByName("email"),a=s.getDomainByName("validationMail");_.isString(n)&&!_.isString(a)&&!i&&_.includes(t,"@")&&!this.$cachedSelectors.buyerEmail.closest(".validation_field").hasClass("invalid")&&s.getClickedMailSuggestions()?(s.setClickedMailSuggestions(!1),this.$cachedSelectors.buyerValidationMail.val(t+n),this.$cachedSelectors.buyerValidationMail.blur(),this.model.set("validationMail",t+n,{silent:!0})):s.checkEmailValueByText("validationMail",t)},bindAutocompleteMailEvents:function(){this.$cachedSelectors.buyerEmail.length&&(s.initEmailSuggestion("email",this.$cachedSelectors.buyerEmail,this.$cachedSelectors.suggestionMail,this.$cachedSelectors.passengerHeader),s.initEmailSuggestion("validationMail",this.$cachedSelectors.buyerValidationMail,this.$cachedSelectors.suggestionValidationMail,this.$cachedSelectors.buyerEmail,_.bind(this.onValidationEmailChange,this)))},unbindFromDom:function(){$(window).off("resize"),this.$widget.off(Odigeo.Events.tap,".calendar").off(Odigeo.Events.blur,".calendar_input"),this.$cachedSelectors.allInputs.off(Odigeo.Events.blur),this.$cachedSelectors.storedPassengers.off(Odigeo.Events.change),this.$cachedSelectors.storePassengerCheckbox.off(Odigeo.Events.change),this.$cachedSelectors.buyerEmail.off(),Odigeo.unbind(this.widget.id+":refreshPassengerSelector"),this.isDomBinded=!1},clearForm:function(e){_.each(this.$el.find('.js_baggageType[data-fieldtype="baggageType"]'),function(e){var t=$(e);t.val(0),this.widget.model.set({selectedBaggageQuantity:0}),Odigeo.trigger("passengers_manager:baggageChange",{type:"baggage",id:this.widget.id,index:t.attr("data-index"),data:{price:0,quantity:0,segmentIndex:t.attr("data-segmentindex"),kilos:t.attr("data-kilos")}})},this),this.$cachedSelectors.allInputs.filter(":not(select)").val("").end().filter('[data-name="travellerType"]').val("ADULT"),this.$cachedSelectors.allInputs.filter("select").each(function(e,t){t.selectedIndex=0}),this.$cachedSelectors.documentsContainer.hasClass("add_section")&&this.$cachedSelectors.documentsContainer.children().not(".add_section_btn").filter(":visible").remove(),this.$cachedSelectors.fflyerContainer.hasClass("add_section")&&(this.$cachedSelectors.fflyerContainer.children().not(".add_section_btn, .hidden").remove(),this.$cachedSelectors.fflyerContainer.find(".add_section_btn").removeClass("hidden")),this.$cachedSelectors.passengerFields.removeClass("valid invalid empty"),this._correctBirthdayInput(e?"adults":this.widget.options.travellerType),this._refreshInputs()},refreshPassengerSelector:function(){var e,t=[],i=Odigeo.Utils.parseJson(Odigeo.Storage.get("travellers")),n=$("#buyer").find(".stored_passengers select");i&&i.defaultTraveler&&i.defaultTraveler.id&&(e=i.defaultTraveler.id),_.each(this.widget.model.readAllPassengers()[this.widget.options.travellerType],_.bind(function(e,i){t.push({id:i,name:[e.name,e.firstLastName||e.lastName].join(" ").trim()})},this)),t.sort(function(t,i){return t.id===e?-1:i.id===e?1:t.name<i.name?-1:t.name>i.name?1:0}),this.$cachedSelectors.storedPassengers.off(Odigeo.Events.change),this.$cachedSelectors.storedPassengers.children(':not([value=""])').remove(),_.each(t,function(e){$("<option>",{value:e.id,text:e.name}).appendTo(this.$cachedSelectors.storedPassengers)},this),this.$cachedSelectors.storedPassengers.val(this.widget.model.passengerID),this.$cachedSelectors.storedPassengersWrapper.toggleClass("hidden",!t.length),t.length&&(this.$cachedSelectors.storedPassengers.on(Odigeo.Events.change,_.bind(this._storedPassengersChangeHandler,this)),_.isEmpty(n.val())||n.trigger(Odigeo.Events.change))},collectPassengerData:function(){var e={},t=function(e,t){var i=$(t),n="radio"===i.prop("type"),a=i.attr("data-name");return!_.isEmpty(i.val())&&(!n||n&&i.prop("checked"))?e[a]=_.startsWith(a,"phoneNumber")?i.val().replace(/[\s()-]/g,""):i.val():i.hasClass("radio_group")&&i.find("input:checked")&&(e[a]=i.find("input:checked").val()),e};if(e=_.reduce(this.$cachedSelectors.passengerInputs,t,e,this),this.widget.options.isBuyer&&!_.isEmpty(this.$cachedSelectors.passwordInput.val())&&(e.password=this.$cachedSelectors.passwordInput.val()),this.$cachedSelectors.showApisRequests.is(":checked")){var i={};i=_.reduce(this.$cachedSelectors.apisRequestsWrapperInputs,t,i,this),e=_.extend(e,i)}if(this.widget.options.isBuyer){var n=this.widget.view.$el.find(".dropdown_select_selected");n.length&&n.each(function(){var t=$(this);e[t.data("name")]=t.find(".select_value").data("value")})}else e.frequentFlyerCardCodes=[],this.$cachedSelectors.showOptionalRequests.is(":checked")&&_.each(this.$cachedSelectors.passengerCardNumber,function(t){var i=$(t);this.model.checkValidity(i,!0)&&e.frequentFlyerCardCodes.push({carrierCode:i.data("carrierCode"),passengerCardNumber:i.val()})},this),e.baggageSelectionDTOs=this.parseBaggagesDTOs();return{data:e,passengerID:this.widget.model.passengerID}},parseBaggagesDTOs:function(){var e=this.widget.getBaggagePassengerComposedRowsInfo(this.widget.options.index);return _.map(e,function(e){var t=e.selected;if(t){var i=t.get("isSelectableBaggage"),n=t.get("isIncludedBaggage"),a={},s={};t=t.getDescriptor(),i?a=t:n&&(s=t)}else a={pieces:0,kilos:0,price:0,baggageType:"BAGGAGE"};return{selectedBaggageDescriptor:[{baggageDescriptor:a,price:a.price}],baggageDescriptorIncludedInPrice:s,segmentTypeIndexDTO:e.rowDescriptor.get("idRow")}},this)},fillPassengerData:function(e){var t={},i=this.$cachedSelectors.documents;if(!_.isNull(e)&&!_.isUndefined(e)){if(this.widget.options.isBuyer?e.lastName=e.lastName||e.firstLastName||"":e.firstLastName=e.firstLastName||e.lastName||"",this.clearForm(),_.each(e,function(e,i){_.contains(["documents","frequentFlyerCardCodes"],i)||(t[i]=e)}),_.each(t,_.partial(this._fillField,this.$cachedSelectors.formContent,_,_,!0),this),this._refreshInputs(),!this.widget.options.isBuyer&&!_.isEmpty(e.documents)){var n=_.map(i.find(".document_select option").not("[placeholder]"),function(e){return $(e).val()}),a=_.find(e.documents,function(e){return-1<n.indexOf(e.identificationType)});this._fillPassengerDocument(i,a)}_.each(this.$el.find('.js_baggageType[data-fieldtype="baggageType"]'),function(t){var i,n,a,s=$(t),r=s.attr("data-index"),o=s.attr("data-kilos");if(!_.isEmpty(e.baggageSelectionDTOs)&&!_.isUndefined(e.baggageSelectionDTOs)&&0<r){var c=_.find(e.baggageSelectionDTOs[r-1],{baggageDescriptor:{baggageType:"BAGGAGE"}});s.val(c.price),i=c.baggageDescriptor.pieces,n=c.price,a=e.baggageSelectionDTOs[r-1].segmentTypeIndexDTO,this.widget.model.set({selectedBaggageQuantity:i}),Odigeo.trigger("passengers_manager:baggageChange",{type:"baggage",id:this.widget.id,index:r,data:{price:parseFloat(n),quantity:parseFloat(i),segmentIndex:a,kilos:o}})}},this)}},_correctBirthdayInput:function(e){var t=this.$cachedSelectors.allCalendars.filter('[data-name="dateOfBirth"]');t.data("validationType",_.invert(this.widget.passengerTypes)[e]+"_DATE_OF_BIRTH"),_.isEmpty(t.val())||this._validateField({field:t})},_fillPassengerDocument:function(e,t){_.each(e.find("[data-name]"),function(e){var i=$(e);i.val(t[i.data("name")]),this._refreshInputs(i)},this)},_fillField:function(e,t,i,n){var a=e.find('[data-name="'+i+'"]:not([type="hidden"])');if(a.length)switch(a.val(t),this._validateField({field:a,autoFilled:n}),i){case"dateOfBirth":Odigeo.UIElements.enhanceDateWithSelects.setDate(a,t);break;case"name":a.trigger(Odigeo.Events.blur,{notValidate:!1})}},_refreshInputs:function(e){var t=e?e.filter(".calendar_input"):this.$cachedSelectors.allCalendars.filter(".submit_field_focusable"),i=e?e.filter("select"):this.$cachedSelectors.selectsPlaceholder;_.each(t,function(e){this._toggleCalendar($(e),!!$(e).val())},this),_.each(i,function(e){this._toggleSelect($(e))},this)},_handleChangeText:function(e){this._validateField({field:$(e.target),silentOnSuccess:!0})},_toggleCalendar:function(e,t){e.siblings(".calendar_placeholder").toggleClass("hidden",t),e.toggleClass("hidden",!t)},_toggleSelect:function(e){e.toggleClass("placeholder",!e.val())},_focusHandler:function(e){var t=$(e.target).closest(".validation_field");t.next(".form_disclaimer").not(".disabled").addClass("showed"),t.addClass("focused")},_togglePasswordVisibility:function(){var e=this.$cachedSelectors.passwordIcon.hasClass("odf-icon-eye-off")?"odf-icon-eye-open":"odf-icon-eye-off";this.$cachedSelectors.passwordIcon.removeClass("odf-icon-eye-open odf-icon-eye-off").addClass(e),this.$cachedSelectors.passwordInput.attr("type","password"===this.$cachedSelectors.passwordInput.attr("type")?"text":"password")},onBlurValidateElement:_.debounce(function(e){this._validateField({field:e})?(this.storeLocalData(!1),Odigeo.trigger("baggagesmanager:passengerValid",this.widget.id,!0)):Odigeo.trigger("baggagesmanager:passengerValid",this.widget.id,!1)},100),_inputBlurHandler:function(e,t){var i=$(e.target),n=i.closest(".validation_field");i.val(Odigeo.Utils.trim(i.val())),t&&!t.notValidate||("on"===i.attr("autocapitalize")&&i.val(Odigeo.Utils.capitalize(i.val())),("required"===i.attr("required")||i.hasClass("optional")&&i.val()||this.widget.options.fillDataWithSession)&&(Odigeo.trigger(this.widget.id+":dirty"),this.onBlurValidateElement(i)),n.removeClass("focused"),n.next(".form_disclaimer").not(".disabled").removeClass("showed"),"password"===i.data("name")&&_.isEmpty(i.val())&&this.$cachedSelectors.passwordBox.removeClass("valid"),i.toggleClass("placeholder",_.isEmpty(i.val())))},_dataChangedHandler:function(){Odigeo.trigger(this.widget.id+":dirty"),this._validateAllFields(!0)},getWrongChars:function(e,t){var i=this.fieldUtils.giveWrongCharacters(e);return i&&!this.isEmail(e.data("name"))?t+"_char:"+i:t},getCorrectSibling:function(e){var t=e.parent();return t.siblings("input").val()?t.siblings("input"):t.parent().siblings("input")},_validateField:function(e){var t,i=$(e.field),a=_.isEmpty(i.data("name"))?this.getCorrectSibling(i):i,s=e.silent||!1,r=e.fullvalidation||!1,o=e.silentOnSuccess||!1,c=e.autoFilled||!1,d=this.widget.model.checkValidity(a,c),l=_.isUndefined(d),g=a.hasClass("optional")||"optional"===a.data("requiredoptional");if(!_.isEmpty(a.data("name"))&&(r||!_.isEmpty(a.val())||!_.includes(["EXPIRATION_DATE","ADULT_DATE_OF_BIRTH","INFANT_DATE_OF_BIRTH","CHILD_DATE_OF_BIRTH"],a.data("validationType")))){if(!s){var h,u,p,f,m=a.closest(".validation_field").removeClass("valid invalid empty"),b=a.closest(".document_section").removeClass("success error"),y=this.$cachedSelectors.passengerHeader.removeClass("success error").add(b),v=this.widget.view.$cachedSelectors.buyerEmail.val(),S=a.val();if(this.widget.options.fixEmailCapitalValidation&&v&&(S=S.toLowerCase(),v=v.toLowerCase()),h="validationMail"===a.data("name")&&S!==v&&v,!1===d||l&&!g)m.addClass(_.isUndefined(d)?"empty":"invalid"),this.fieldUtils.showError(m,!0),y.addClass("error"),u=_.isUndefined(d)?"_missing_error":h?"_does_not_match_error":"_invalid_error",f=r?"_submit":"_inline",p=(t=this.widget.options.isBuyer?"buyer":"pax")+"_"+a.data("name").toLowerCase()+f+u,a.val()&&r&&(p=this.getWrongChars(a,p)),n.trackEvent(t+"_details_error",p);else if(!_.isUndefined(d)&&!o){var C=b.find(".validation_field");m.addClass("valid"),y.addClass(this._validateAllFields(!0)?"success":""),b.toggleClass("success",0===C.not(".valid").length),b.toggleClass("error",0<C.filter(".invalid").length)}}return s||g&&l||!l&&d}},isEmail:function(e){return"mail"===e||"validationMail"===e},_validateAllFields:function(e,t){var i=this.$cachedSelectors.allInputs.filter(this.widget.options.validateOnlyRequired).filter(":visible").filter(":not([data-required=false])"),n=this.$cachedSelectors.allInputs.filter(".optional").filter(function(){return $(this).val()}),a=i.add(n).add(this.$cachedSelectors.visibleDateFields).slice(0,t?this.$cachedSelectors.allInputs.index(t):void 0),s=_.reduce(a,function(t,i){return this._validateField({field:$(i),silent:e,fullvalidation:!0})&&t},!0,this);return t||Odigeo.trigger(this.widget.name+":passengerValid",this.widget.id,s),s},_validateUntilField:function(e){("required"===$(e.target).attr("required")||$(e.target).hasClass("optional")&&""!==$(e.target).val())&&this._validateAllFields(!1,$(e.target))},_selectStoredPassenger:function(e){var t=this.widget.model.readPassenger(e);this.widget.model.passengerID=e,this.fillPassengerData(t),this.widget.options.isBuyer||this._validateAllFields()},_storedPassengersChangeHandler:function(e,t){var i=e.target.value,a=this.widget.options.isBuyer?"buyer":"pax",s=this.widget.options.isBuyer?"":this.widget.id[this.widget.id.length-1]+"_";i?this._selectStoredPassenger(i):(this.widget.model.passengerID=null,this.clearForm()),_.isUndefined(e.originalEvent)||n.trackEventWithCategory("flights_pax_page",a+"_details",a+"_selected_"+s+e.target.selectedIndex),t||Odigeo.trigger(this.widget.id+":dirty"),Odigeo.trigger(this.widget.name+":passengerPicked",{id:this.widget.id,data:i})},_passengerSelectorHandler:function(e){this.widget.options.travellerType=this.widget.passengerTypes[$(e.currentTarget).val()],this._correctBirthdayInput(this.widget.options.travellerType)},selectPassenger:function(e){var t=this.$cachedSelectors.storedPassengers;t.children('[value="'+e+'"]').length&&(t[0].value=e,t.trigger(Odigeo.Events.change,!0))},_setSelectedPassenger:function(e,t){_.isEmpty(e.toString())?(this.widget.model.passengerID=null,this.clearForm(!(!_.isUndefined(t)&&!_.isEmpty(t))||void 0)):(this.widget.options.travellerType=t||this.widget.options.travellerType,this._correctBirthdayInput(this.widget.options.travellerType),this._selectStoredPassenger(e))},_addDocumentSectionHandler:function(){var e,t=this.$cachedSelectors.documents.first().clone(),i=t.find(".document_select > option").length-1,n=this.$cachedSelectors.documentsContainer,a=n.find(".document_section").length;if(!(i<=a))return(e=t.insertBefore(n.children().last()).removeClass("hidden")).find(".remove_code").on(Odigeo.Events.tap,_.bind(this._removeDocumentSection,this)),this.$cachedSelectors.addDocumentBtn.toggleClass("hidden",++a>=i),this._reCacheAndBindAllInputs(),e},_removeDocumentSection:function(e){$(e.target).parents(".document_section").remove(),this.$cachedSelectors.addDocumentBtn.removeClass("hidden"),this._reCacheAndBindAllInputs(),this._dataChangedHandler()},setTravellerById:function(e){this.$cachedSelectors.customerSelector.val(e),this._selectedTravellerUpdateValues(e)},_initPassengerList:function(){-1<this.model.passengerSelectedId?(this.membershipActions(this.model.passengerSelectedId),this.setTravellerById(this.model.passengerSelectedId)):this.isStepBack()||this._clearWidgetsFields(),this.$cachedSelectors.customerSelector.off().on(Odigeo.Events.change,_.bind(this.onPassengerSelected,this)),this.updatePassengerOptionSelected(!1),this.sendNameToSidebar(this.model.passengerSelectedId)},isStepBack:function(){var e=Odigeo.Utils.parseJson(Odigeo.Session.get("lastRouteChange"));return!_.isNull(e)&&_.includes(["payment","insurance","flightinfo"],e.from.name)},_selectedTravellerUpdateValues:function(e){var t=_.findWhere(this.model.user.traveller,{id:Number(e)});return t?this._fillValues(this.$cachedSelectors.passengerInputs,this.widget.passengerMap,t.profile,"name",!0):this._clearWidgetsFields(),t},hideNameAndSurname:function(e){var t={name:"",firstLastName:""};_.find(this.$cachedSelectors.passengerInputs,_.bind(function(i){var n=$(i);_.isEmpty(_.pick(t,n.data("name")))||n.closest(this.$cachedSelectors.passengerFields).toggleClass("odf-hidden",e)},this))},showMembershipIcon:function(e){this.$cachedSelectors.membershipSignal.toggleClass("odf-hidden",!e),this.$cachedSelectors.membershipExtraInfo.toggleClass("odf-hidden",!e),this.$cachedSelectors.paxSelectorLabel.toggleClass("odf-hidden",e),this.$cachedSelectors.paxSeparatorTitle.toggleClass("odf-hidden",!e)},showMembershipMobileLabel:function(e){this.$cachedSelectors.selectOptionMember.toggleClass("odf-hidden",!e)},membershipActions:function(e,t){var i=0===e,n=_.isEmpty(this.model.user.membershipInfoDTO.membershipDTO);this.hideNameAndSurname(i),this.showMembershipIcon(i),this.showMembershipMobileLabel(i),Odigeo.trigger("membership:updatePremiumDisclaimers",i,n,t)},updatePassengerOptionSelected:function(e){var t,i=this.$cachedSelectors.customerSelector[0].selectedIndex,n=[];-1===this.model.passengerSelectedId?this.isStepBack()?(_.forEach(this.$cachedSelectors.passengerInputs.filter('[data-name="name"],[data-name="firstLastName"]'),function(e){n.push($(e).val())}),t=_.find(this.$cachedSelectors.customerSelector.find("option"),function(e){return _.every(n,function(t){return-1!==$(e).html().indexOf(t)})}),_.isUndefined(t)||(this.model.passengerSelectedId=Number($(t).val()),this.$cachedSelectors.customerSelector.val(this.model.passengerSelectedId))):this._clearWidgetsFields():this._selectedTravellerUpdateValues(this.model.passengerSelectedId),e&&this.trackingUtils.trackEvent("flights_pax_page",-1===this.model.passengerSelectedId?"select_new_pax":"select_stored_pax_"+i)},onPassengerSelectedAction:function(e,t,i){-1<e&&this._selectedTravellerUpdateValues(e)?(this.trackingUtils.trackEvent("pax_details","select_stored_pax_"+t),Odigeo.trigger(this.widget.name+":travellerSelected",{id:e})):(this.trackingUtils.trackEvent("pax_details","select_new_pax"),this._clearWidgetsFields()),this.membershipActions(e,i),-1<this.model.passengerSelectedId&&Odigeo.trigger(this.widget.name+":travellerNotSelected",{id:this.model.passengerSelectedId}),0===this.model.passengerSelectedId&&n.trackEvent("unlocked","nag_remove_subscriber_confirm"),this.model.passengerSelectedId=e,this.sendNameToSidebar(e)},sendNameToSidebar:function(e){var t=_.findWhere(this.model.user.traveller,{id:Number(e)}),i=_.isUndefined(t)?"":t.profile.name;Odigeo.trigger(this.widget.name+":sendNameToSidebar",{name:i,index:this.widget.options.index,id:e})},onPassengerSelectedCancel:function(e){var t=!0===e?"nag_remove_subscriber_cancel":"nag_remove_subscriber_close";n.trackEvent("unlocked",t),this.$cachedSelectors.customerSelector.val(this.model.passengerSelectedId)},onPassengerSelected:function(){var e=Number(this.$cachedSelectors.customerSelector.val()),t=this.$cachedSelectors.customerSelector[0].selectedIndex;0===this.model.passengerSelectedId?(n.trackEvent("unlocked","nag_remove_subscriber_displayed",null,!0),Odigeo.UIElements.showLightboxWarning("od-passenger-lightbox-edit",_.bind(this.onPassengerSelectedAction,this,e,t,!0),_.bind(this.onPassengerSelectedCancel,this),this.widget.options.lightboxTexts)):this.onPassengerSelectedAction(e,t,!1)},updatePassengerSelected:function(){Odigeo.trigger(this.widget.name+":travellerSelected",{id:this.model.passengerSelectedId})},onHideTraveller:function(e){_.isObject(e)&&(e.id||0===e.id)&&-1!==e.id&&this.$cachedSelectors.customerSelector.val()!==e.id.toString()&&this.$cachedSelectors.customerSelector.find("option[value="+e.id+"]").addClass("hidden").attr("disabled",!0)},onShowTraveller:function(e){-1!==e.id&&this.$cachedSelectors.customerSelector.find("option[value="+e.id+"]").removeClass("hidden").removeAttr("disabled")},hidePassengerList:function(){this.$cachedSelectors.customersPaxManager.addClass("hidden"),this.hideNameAndSurname(!1),this.showMembershipIcon(!1),this.restoreFieldsLocalStorage()},_hasEmptyRequiredValues:function(e,t){var i=_.isEmpty(e);return i||_.each(t,function(t,n){_.isEmpty(e[n])&&"buyer"!==t&&"secondLastName"!==t&&(i=!0)}),i},trackNotLoggedUser:function(){var e="forms_prefilled_session";this.model.get("isTrackingSent")||(_.isEmpty(this.storeData.get("passengersData",this.widget.id))&&(e="prefilled_none_none"),this.model.set("isTrackingSent",!0),this.trackingUtils.trackEvent("sso_pax_page",e))},onUserNotLogged:function(){this.$cachedSelectors.hideOnUserLogged.removeClass("hidden"),this.$cachedSelectors.fillBuyerCombo.removeClass("hidden"),this.$cachedSelectors.customersPaxManager.addClass("hidden"),this.$cachedSelectors.buyerNonEditableEmail.addClass("hidden"),this.$cachedSelectors.buyerEditableEmail.removeClass("hidden"),this.$cachedSelectors.buyerEditableValidationMail.removeClass("hidden"),this.$cachedSelectors.travellerTitleWarning.removeClass("hidden"),this.showNonEditableBuyerLayer(!1),this.restoreFieldsLocalStorage(),this.trackNotLoggedUser()},hideNonEditableBuyerLayer:function(e){this.$cachedSelectors.fillBuyerCombo.addClass("hidden"),this.showNonEditableBuyerLayer(!1),e&&this.trackingUtils.trackEvent("buyer_details","edit_buyer_details")},showNonEditableBuyerLayer:function(e){e&&this.$cachedSelectors.nonEditableBuyerLayer.removeClass("hidden"),this.$cachedSelectors.nonEditableBuyerLayer.trigger(e?"expandPanel":"collapsePanel"),_.delay(_.bind(function(){this.$cachedSelectors.editableBuyerLayer.trigger(e?"collapsePanel":"expandPanel")},this),400)},_existsField:function(e,t,i,n){return!!_.find(e,function(e){var a=$(e);return t[a.data(i)]===n})},_fillValues:function(e,t,i,n,a){var s=this._existsField(e,t,n,"middleName"),r=this._existsField(e,t,n,"secondLastName"),o=this.widget.options.secondSurnameFix;_.each(e,_.bind(function(e){var c=$(e),d=t[c.data(n)];"gender"===d?(i[d]="MR"===i.title?"MALE":"FEMALE",this.$el.find('input[data-name="travellerGender"][value="'+i[d]+'"]').prop("checked",!0)):d&&i[d]&&(o&&"name"===d&&i.middleName&&!s?(c.val(i.name+" "+i.middleName),this.saveName=!1):o&&"firstLastName"===d&&i.secondLastName&&!r?(c.val(i.firstLastName+" "+i.secondLastName),this.saveName=!1):c[a?"val":"text"](i[d]),a&&c.closest(".validation_field").removeClass("empty").addClass("valid"))},this))},_prefillEmail:function(e){e&&(this.$cachedSelectors.buyerNonEditableEmail.removeClass("hidden"),this.$cachedSelectors.buyerEditableEmail.addClass("hidden"),this.$cachedSelectors.buyerEditableValidationMail.addClass("hidden"),_.each(this.$cachedSelectors.passengerEmail,function(t){$(t).text(e)}),this.$cachedSelectors.editableBuyerLayer.find('[data-name="mail"], [data-name="validationMail"]').val(e))},_prefillTravellerData:function(e){var t,i;e&&e.profile&&(i=_.invert(this.widget.contactDetailsMap.buyer),this._fillValues(this.$cachedSelectors.passengerInputs,i,e.profile,"name",!0),this._fillValues(this.$cachedSelectors.nonEditableLayerFields,i,e.profile,"noneditableLayer",!1),this.$cachedSelectors.editableBuyerLayer.find("[data-name=lastName]").val(e.profile.firstLastName+" "+(e.profile.secondLastName?e.profile.secondLastName:"")).closest(".validation_field").addClass("valid"),t=this.$cachedSelectors.editableBuyerLayer.find("[data-name=phoneCode1] option:selected").text(),this.$cachedSelectors.nonEditableBuyerLayer.find("[data-noneditable-layer=phoneCode1]").text(t&&t.match(/\((.*?)\)/)?t.match(/\((.*?)\)/).shift():""))},_prefillContactDetails:function(e){e&&(this._fillValues(this.$cachedSelectors.passengerInputs,this.widget.contactDetailsMap,e,"name",!0),this._fillValues(this.$cachedSelectors.nonEditableLayerFields,this.widget.contactDetailsMap,e,"noneditableLayer",!1),this.$cachedSelectors.nonEditableBuyerLayer.find("[data-noneditable-layer=country]").text(this.$cachedSelectors.editableBuyerLayer.find("[data-name=country] option:selected").text()))},_updateContactDetailsData:function(e){e&&e.profile&&(this._prefillTravellerData(e),this._prefillContactDetails(e.profile.address))},onContactDetailsPassengerChanged:function(){var e=Number(this.$cachedSelectors.contactDetailsSelector.val()),t=_.find(this.model.user.traveller,{id:Number(e)});this.model.passengerSelectedId=e,this._clearWidgetsFields(),this.$cachedSelectors.hideOnUserLogged.toggleClass("hidden",-1!==e),this._updateContactDetailsData(t),this.showNonEditableBuyerLayer(!1)},_hideOrShowNonEditableContactDetailsLayer:function(e){var t=!_.isUndefined(e)&&!this._hasEmptyRequiredValues(e.profile,this.widget.contactDetailsMap.buyer)&&!this._hasEmptyRequiredValues(e.profile.address,_.invert(this.widget.contactDetailsMap))&&this.model.user.email&&0===_.size(this.widget.view.$cachedSelectors.identification)&&0===_.size(this.widget.view.$cachedSelectors.stateName);this.showNonEditableBuyerLayer(t)},_emptyCollectionFields:function(e){var t;_.each(e,_.bind(function(e){(t=$(e)).is("select")?t.prop("selectedIndex",0):"text"===t.prop("type")&&"mail"!==t.data("name")&&"validationMail"!==t.data("name")&&t.val(""),t.parents(".validation_field").removeClass("valid invalid empty")},this))},_clearWidgetsFields:function(){this._emptyCollectionFields(this.$cachedSelectors.bDayInputs),this._emptyCollectionFields(this.$cachedSelectors.passengerInputs)},checkBaggages:function(){this.$el.find('[data-fieldtype="baggageType"]').trigger("change")},restoreFieldsLocalStorage:function(){var e={},t=_.includes(this.widget.widgetIds,this.widget.id)?"buyer":this.widget.id;"buyer"!==t&&(e.optionalRequest=this.$cachedSelectors.showOptionalRequests,e.showApisRequests=this.$cachedSelectors.showApisRequests,0<this.$cachedSelectors.ffyerButton.size()&&(e.ffyerButton=this.$cachedSelectors.ffyerButton)),"passengers0"!==t||this.model.travellerModel.importedFromLocal||this.storeData.check("passengersData")&&(this.model.travellerModel.importedFromLocal=!0),this.storeData.restore("passengersData",this.$cachedSelectors.passengerFullInputs,t,e)},prefillCountryWithPrefixTelephone:function(){var e=Odigeo.Utils.parseJson(Odigeo.Session.get("passengersData"));_.isObject(e)&&_.isObject(e.buyer)&&this.$cachedSelectors.buyerCountry.val(e.buyer.phoneCode1)},storeLocalData:function(e){var t={},i=this.$cachedSelectors.passengerFullInputs,n=_.includes(this.widget.widgetIds,this.widget.id)?"buyer":this.widget.id;"buyer"!==n&&(t.optionalRequest=this.$cachedSelectors.showOptionalRequests.is(":checked"),t.showApisRequests=this.$cachedSelectors.showApisRequests.is(":checked"),0<this.$cachedSelectors.ffyerButton.size()&&(t.ffyerButton=this.$cachedSelectors.ffyerButton.is(":checked")),this.saveName||(i=_.reject(i,function(e){return"name"===e.name||"firstLastName"===e.name}))),this.storeData.save(e,"passengersData",i,n,t)},toggleSOPhoneFormDisclaimer:function(e){this.$cachedSelectors.formDisclaimers.filter('[data-type="phone"]').toggleClass("disabled",!e)},frequentFlyerCodesTrackingData:function(e){var t=0;this.$cachedSelectors.showOptionalRequests.is(":checked")&&(this.$cachedSelectors.ffyerButton.is(":checked")||0===this.$cachedSelectors.ffyerButton.size())&&(t=_.reduce(this.$cachedSelectors.passengerCardNumber,function(e,t){return $(t).val()?e+1:e},0)),e.totalFilled=e.totalFilled+t,e.totalCardsFields=e.totalCardsFields+this.$cachedSelectors.passengerCardNumber.size()},frequentFlyerCodesTrackingDataOnInit:function(e){e.isMealDisplayed=e.isMealDisplayed||0<this.$cachedSelectors.mealsSelector.size(),e.isFFDisplayed=e.isFFDisplayed||0<this.$cachedSelectors.moreOptionsBlock.size()},frequentFlyerMealsTracking:function(e){var t,i=this.$cachedSelectors.mealsSelector;0<i.size()&&(t=0<i.size()&&0<i.prop("selectedIndex")?"_"+i.val():"_none",e.meals+=t,e.frequentFlyer+=t)},updateAutocompleteGooglePlacesInput:function(e){var t=this;if(!this.widget.options.isAddressAutoFillEnabled)return!1;var i=e.target.value&&e.target.value.toString()||null;"Backspace"!==e.key&&i&&3<=i.length?navigator.geolocation.getCurrentPosition(function(e){var n=e.coords,a={latitude:n.latitude,longitude:n.longitude,place:i},s=Odigeo.Settings.property("appContext")+"/service/googleplaces/getplacessuggestions",r=t.googlePlacesHelper.fillSuggestionList,o=_.bind(t.googlePlacesRequestErrorHandler,t),c=JSON.stringify(a);t.model.getGooglePlacesRest({data:c,dataType:"json",contentType:"application/json",type:"POST",url:s,success:r,error:o})}):(i&&i.length<=3&&document.querySelector(".places_suggestion")||"Escape"===e.key)&&this.googlePlacesHelper.removeListContainer()},googlePlacesRequestErrorHandler:function(e){return e},getPlaceId:function(e){var t=e.target,i=t.getAttribute("data-place-id")||t.parentNode.getAttribute("data-place-id");if(i){var n=Odigeo.Settings.property("appContext")+"/service/googleplaces/getplacebyid",a=this.googlePlacesHelper.populateForm,s=_.bind(this.googlePlacesRequestErrorHandler,this),r=JSON.stringify({placeId:i});this.model.getGooglePlacesRest({data:r,dataType:"json",contentType:"application/json",type:"POST",url:n,success:a,error:s})}},closeGooglePlaceAutocomplete:function(){document.querySelector(".places_suggestion")&&this.googlePlacesHelper.removeListContainer()}}))},function(e,t,i){"use strict";var n=/(\(\+\d{1,4}\))/,a=".dropdown_select_selected",s=void 0,r=function(e){$(e.target).hasClass("clickable_select")||o(s)},o=function(e){e.toggleClass("focus"),e.hasClass("focus")||e!==s?($("#page").on(Odigeo.Events.tap+".dropdown",r),$("#page .hint_trigger_button").on(Odigeo.Events.tap+".dropdown",r)):($("#page").off(Odigeo.Events.tap+".dropdown"),$("#page .hint_trigger_button").off(Odigeo.Events.tap+".dropdown")),s=e},c=function(e,t){var i=e.find(".select_text").text().match(n)||[];t.find(".select_text").html(i[0])},d=function(e,t,i,n){var s,r,o,d,l,g=$(e.currentTarget),h=t.find(a);s=i,r=g.data("value"),o=n,d=Odigeo.Utils.parseJson(Odigeo.Session.storage[o]),l=_.set(d,s,r),Odigeo.Session.set(o,JSON.stringify(l)),h.html(g.html()),c(g,h)},l=function(e,t,i,n){e.off().on(Odigeo.Events.tap,_.bind(o,void 0,e)),e.find(t).off().on(Odigeo.Events.tap,_.bind(d,void 0,_,e,i,n))};e.exports={initDropdown:function(e,t,i,n){var s,r,o,d,g,h;l(e,t,i,n),s=i,r=t,o=e,d=n,g=Odigeo.Utils.parseJson(Odigeo.Session.storage[d]),(h=_.get(g,s))&&o.find(r).filter('[data-value="'+h+'"]').trigger(Odigeo.Events.tap),c(e.find(a),e.find(a))}}},function(e,t,i){"use strict";var n="od-places-suggestion places_suggestion odf-space-inner-left-s odf-space-inner-right-s";e.exports={init:function(e){if(this.mainContainerSelector=e?document.querySelector(e):null,this.mainContainerSelector)return this.streetNumber="",this.streetName="",this.createListContainer=this.createListContainer.bind(this),this.removeListContainer=this.removeListContainer.bind(this),this.populateForm=this.populateForm.bind(this),this.fillSuggestionList=this.fillSuggestionList.bind(this),this.focusAndFillField=this.focusAndFillField.bind(this),this.populateFormByType=this.populateFormByType.bind(this),this.createListContainer(),this},fillSuggestionList:function(e){var t="",i=e.changed.predictionsList||e.attributes.predictionsList||null;i&&0<i.length?(t=_.reduce(i,function(e,t){return e+(c=t,n=(i=_.assign({},c,{mainText:c.mainText.replace(/,/g,""),secondaryText:c.secondaryText?",&nbsp;"+c.secondaryText:"",listClass:"od-places-suggestion-list-item odf-space-inner-top-m odf-space-inner-bottom-m odf-text-mono-color-02 odf-text-s odf-stroke-primary get_place_id",mainTextClass:"od-places-suggestion-subcomp",secTextClass:"odf-strong od-places-suggestion-subcomp od-elipsis"})).listClass,a=i.placeId,s=i.mainText,r=i.secondaryText,o=i.secTextClass,"\n    <li class='"+n+"' data-place-id='"+a+"'>\n        <span class='"+i.mainTextClass+"'>"+s+"</span>\n        <span class='"+o+"'>"+r+"</span>\n    </li>");var i,n,a,s,r,o,c},""),this.suggestionsContainer||this.createListContainer(),this.suggestionsContainer.innerHTML=t,this.suggestionsContainer.className=n):this.removeListContainer()},populateForm:function(e){if(e.changed.addressComponents){for(var t=e.changed.addressComponents,i=0;i<t.length;i++){var n=e.changed.addressComponents[i].types[0],a=e.changed.addressComponents[i].longName,s=e.changed.addressComponents[i].shortName;this.populateFormByType(n,a,s)}this.removeListContainer()}else this.suggestionsContainer&&this.removeListContainer()},populateFormByType:function(e,t,i){var n="";switch(e){case"ROUTE":this.streetName=t,n=this.streetNumber?this.streetName+" "+this.streetNumber:""+this.streetName,this.focusAndFillField('[data-name="address"]',n);break;case"STREET_NUMBER":this.streetNumber=t;break;case"LOCALITY":this.focusAndFillField('[data-name="cityName"]',t);break;case"POSTAL_CODE":this.focusAndFillField('[data-name="zipCode"]',t);break;case"COUNTRY":this.fillCountry(i)}},fillCountry:function(e){for(var t=document.querySelectorAll('[data-name="country"] option'),i=Array.prototype.slice.call(t),n=0;n<i.length;n++)i[n].selected=!1,i[n].value===e&&(i[n].selected=!0)},createListContainer:function(){document.querySelector(".places_suggestion")||(this.suggestionsContainer=document.createElement("ul"),this.suggestionsContainer.className=n+" odf-hidden",this.mainContainerSelector.appendChild(this.suggestionsContainer,this.mainContainerSelector))},removeListContainer:function(){this.suggestionsContainer&&(this.suggestionsContainer.remove(),this.suggestionsContainer=null)},focusAndFillField:function(e,t){if(!e||!t)return!1;var i=document.querySelector(e);i.value=t,-1===i.parentNode.parentNode.className.indexOf(" valid")&&(i.parentNode.parentNode.className+=" valid"),i.blur()}}},function(e,t,i){"use strict";$(function(){Odigeo.defineWidget("passengers_update",Odigeo.Widget.extend({modelClass:i(732),viewClass:Odigeo.View.extend({uploadingDialog:null,selectors:{addpaxTemplate:".updatingPax_template",addpaxAction:".details_add_adults_button",addpaxButttonWrapper:".addpax_wrapper"},events:{"tap @addpaxAction":"onAddpaxAction"},init:function(){this.widget.model.isSearchData()||this.$cachedSelectors.addpaxButttonWrapper.prop("disabled",!0)},onAddpaxAction:function(e){e.stopPropagation(),this.widget.addAdult()},showLoadingMessage:function(){var e=this.$el.find(this.$cachedSelectors.addpaxTemplate);this.uploadingDialog=Odigeo.UIElements.showUploadingResultsInfo(e),this.uploadingDialog.uploading()},showUpdatingOk:function(){this.uploadingDialog.confirm()}}),addAdult:function(){this.model.addAdult(),this.model.refreshData()}}))})},function(e,t,i){"use strict";e.exports=Odigeo.Model.extend({defaults:{searchParams:null,requestData:null,adults:1},url:function(){return Odigeo.Settings.getProperty("serviceUrlFormatter")("addpaxondetails")},refreshData:function(){var e=this.get("requestData");_.isNull(e)||(this.widget.view.showLoadingMessage(),this.clear().save(e,{success:_.bind(this.requestSuccessAddPaxHandler,this),error:_.bind(this.requestErrorAddPaxHandler,this)}))},requestSuccessAddPaxHandler:function(e,t){null!==t.errors?(Odigeo.Session.set("showAddPaxError","true"),Odigeo.trigger(this.widget.id+":addPaxCompleteError",App.Flights.searchParamsStringify(Odigeo.Session.get("searchParameters")))):(this.widget.view.showUpdatingOk(),Odigeo.trigger(this.widget.id+":addPaxCompleteSuccessful"))},requestErrorAddPaxHandler:function(e,t){"abort"!==t.statusText&&Odigeo.trigger(this.widget.id+":searchError",t)},addAdult:function(){var e=this.get("adults")+1;this.set("adults",e),this.get("searchParams").numAdults=e,Odigeo.Session.set("searchParameters",JSON.stringify(this.get("searchParams"))),this.prepareData()},isSearchData:function(){var e=Odigeo.Utils.parseJson(Odigeo.Storage.get("search-data"));return this.set("searchParams",Odigeo.Utils.parseJson(Odigeo.Session.get("searchParameters"))),_.isEmpty(this.get("searchParams"))&&!_.isEmpty(e)&&this.set("searchParams",e[0]),!_.isEmpty(this.get("searchParams"))},prepareData:function(){var e=this.get("searchParams"),t=e.type,i=["iata","name","geoNodeId","type"];e.externalSelectionRequest=_.omit(e.externalSelectionRequest,"searchId"),e.segmentRequests=e.searchSegments,e=_.omit(e,["searchSegments"]);for(var n=0;n<e.segmentRequests.length;n++)e.segmentRequests[n]=_.omit(e.segmentRequests[n],["transportType"]),e.segmentRequests[n].departure=_.pick(e.segmentRequests[n].departure,i),e.segmentRequests[n].destination=_.pick(e.segmentRequests[n].destination,i),e.segmentRequests[n].date=e.segmentRequests[n].dateStr;e=_.extend(e,{dynpackSearch:!1,searchMainProductType:"FLIGHT",type:"oneWayTrip"===t?"ONE_WAY":"roundTrip"===t?"ROUND_TRIP":"MULTIPLE_DESTINATIONS"}),this.set("requestData",{itinerarySearchRequest:e})}})},function(e,t,i){"use strict";var n=i(494),a=i(559),s=i(0),r=function(){var e=_.isObject(this.model.get("user"));e&&this.model.set("defaultDataStorage","userAccount"),this.view.$cachedSelectors.cardSaverManager.toggleClass("localStorageEnabled",!e),this.view.$cachedSelectors.cardInputs[e?"off":"on"](Odigeo.Events.change,_.bind(this.view.storePaymentLocally,this.view,!1))},o={BOOKING_USER_INTERACTION_NEEDED:":userInteractionNeeded",BOOKING_PAYMENT_RETRY:":bookingPaymentRetryLoaded",BOOKING_REPRICING:":bookingRepricingLoaded"};Odigeo.defineWidget("paymentmanager",Odigeo.Widget.extend($.extend(!0,n.controller,a.controller,{payment3dSecureURL:Odigeo.Settings.property("appContext")+"/secure/pay3dsecure",isPaymentMethodRetry:!1,isRepricing:!1,enhancedElementsList:[],bookingAlreadyDone:!1,modelClass:Odigeo.Model.extend(_.extend(i(560),n.model,a.model)),viewClass:Odigeo.View.extend(_.extend(i(561),n.view,a.view)),init:function(){this.model.on("sync",this.view.updatePaymentOptions,this.view).on("change:chosenMethod",this.view.updatePaymentMethod,this.view).on("change:chosenCard",this.view.updateCreditCard,this.view).on("cardChanges",this.view.showErrors,this.view).on("change:response",this.checkResponse,this).on("feeChanges",this.notifyFees,this).on("change:user",r,this),n.controller.initController.call(this),a.controller.initKlarnaController.call(this),this.view.on("change:cardType",this.model.setCardType,this.model).on("change:cardData",this.model.setCardData,this.model)},fireResponseEvent:function(e){Odigeo.trigger(this.id+o[e.bookingstatus],e)},checkResponse:function(e){var t=e.get("response");Odigeo.Utils.parseJson(Odigeo.Session.get("isAccommodationPostBooking"))&&!t.errors?(Odigeo.trigger(this.id+":confirmationShoppingBasketReady",_.chain(t).pick("myTrip","flowErrors").extend({bookingstatus:t.bookingStatus}).value()),s.stopMetric("LOAD_CONFIRM_SHOPPINGBASKET")):t.errors||(Odigeo.trigger(this.id+":confirmationReady",_.chain(t).pick("repricing","extensions","myTrip","membershipPerksDTO","flowErrors","userInteractionNeededDTO").extend({bookingstatus:t.bookingStatus,analyticsEcommerce:t.analyticsEcommerce,tmsDatalayer:t.tmsDatalayer}).value()),s.stopMetric("LOAD_CONFIRM_SHOPPINGBASKET"))},notifyFees:function(e){var t={quantity:this.options.quantityOnePrice,numSegments:this.options.numSegments,numTravellers:this.options.numTravellers,priceLogic:e.priceLogic};if("CREDITCARD"===e.chosenMethod)_.isUndefined(e.chosenCard)||_.extend(t,{totalFee:e.chosenCard.fee,fee:e.chosenCard.fee/this.options.numTravellers,name:e.chosenCard.name,concept:e.chosenCard.code,totalPax:this.options.numTravellers,ccResolved:e.ccResolved});else{var i=_.find(e.paymentMethods,_.matches({method:e.chosenMethod}));_.isUndefined(i)||_.extend(t,{fee:i.fee,name:i.method,concept:i.method,ccResolved:!0})}"MINIMUM_PURCHASE_PRICE_WITH_DISCOUNT"===e.priceLogic&&_.extend(t,{cheapestCCCode:e.presetCard.code,cheapestDiscount:e.presetCard.fee}),Odigeo.trigger(this.id+":feeChange",{id:this.id,data:t,type:"card_fee"}),this.view.cvvTypeChanged("AX"===t.concept)},userInteractionNeeded:function(e){var t=e.userInteractionNeededDTO;if(Odigeo.Session.set("returnFromUserInteraction",!0),_.isEmpty(t.redirectUrl))if("SOFORT"===this.model.get("chosenMethod")){try{$("html").html(t.htmlCode)}catch(e){}var i=$("input[name=DIRECTEBANKINGOPENREGULAR]");0<i.length&&i.click()}else t.htmlCode.match(/<html>/i)?window.location.href=this.payment3dSecureURL:(this.options.isDynpack||Odigeo.UIElements.enhanceLoading($(".waiting_page")).showLoading(["waiting_bottom","waiting_confirmation","waiting_bottom_gradient"]),$("#payment3ds").html(t.htmlCode));else if(_.isEmpty(t.parameters))window.location.href=t.redirectUrl;else{var n=_.map(t.parameters,function(e,t){return $("<input>",{value:e,name:t})});$("<form>",{method:t.sendType,action:t.redirectUrl}).append(n).appendTo($("body")).submit()}},setCreditCardType:function(e,t,i){this.model.changeCreditCard.call(this.model,e,i),this.model.set({showCCDropdown:t}),this.view.$cachedSelectors.cvv2.attr("maxlength",this.model.getCvvLength(e))},userNotLogged:function(){this.view.toggleSaveDataCheck(!0),this.model.set("selectedStorageCreditCard",null),this.model.setUserData(null),_.delay(_.bind(function(){this.view.restoreFieldsLocalStorage()},this),1e3),this.model.setCreditCards(null),this.view.storeData.removeStorageOnNotSelected(this.view.$cachedSelectors.saveCardData,"paymentData"),this.view.$cachedSelectors.root.removeClass("od-stored-cards-visible")},userLogged:function(e){this.view.toggleSaveDataCheck(!1),this.view.storeData.removeStorageOff(this.view.$cachedSelectors.saveCardData),this.model.setUserData(e),Odigeo.trigger(this.id+":getCreditCards")},isValid:function(){return this.model.isValid()},getPaymentMethod:function(){return this.model.getPaymentMethod()},execute:function(e){var t=[].slice.call(arguments,1);switch(e){case"updatePaymentOptions":this.model.getPaymentOptions.apply(this.model,t);break;case"updateFees":this.model.trigger("feeChanges",this.model.toJSON());break;case"commit":this.model.commit.apply(this.model,t);break;case"userInteractionNeeded":this.userInteractionNeeded.apply(this,t);break;case"showNegativeFee":this.view.showNegativeFee.apply(this.view,t);break;case"hideDialogs":this.view.hideDialogs();break;case"paymentRetryDialog":this.view.showErrorPaymentRetryDialog.apply(this.view,t);break;case"paymentRetry":this.view.showErrorPaymentRetryInline.apply(this.view,t);break;case"fillForm":this.view.fillForm.apply(this.view,t);break;case"enhancedElementList":this.view.enhancedElementsList.apply(this.view,t);break;case"loadRepricingMessage":this.view.loadRepricingMessage.apply(this.view,t);break;case"loadRepricingMessagePopUp":this.view.loadRepricingMessagePopUp.apply(this.view,t);break;case"setManualPaymentRetry":this.view.setManualPaymentRetry(this.view,t);break;case"setInvoiceRequestDTO":this.model.setInvoiceRequestDTO.apply(this.model,t);break;case"setBookingUserComments":this.model.setBookingUserComments.apply(this.model,t);break;case"setNewsletterSubscription":this.model.setNewsletterSubscription.apply(this.model,t);break;case"setCreditCardType":this.setCreditCardType.apply(this,t);break;case"userLogged":this.userLogged.apply(this,t);break;case"userNotLogged":this.userNotLogged.apply(this);break;case"setCreditCards":this.model.setCreditCards.apply(this.model,t);break;case"cleanInputs":this.view.cleanInputs.apply(this.view,t);break;case"cvvTypeChanged":this.view.cvvTypeChanged.apply(this.view,t);break;case"changePaymentMethod":this.model.changePaymentMethod();break;case"removeCreditCardHintClosed":this.view.removeStoredCreditCardHintClosed.apply(this.view,t);break;case"creditCardRemoved":this.view.removeStoredCreditCardSuccess.apply(this.view,t);break;case"isStoredCardsAvailability":return this.model.isStoredCardsAvailability.apply(this.model,t);case"blurAllInputs":return this.view.blurAllInputs.apply(this.view,t);case"isStoredCardSelected":this.model.isStoredCardSelected.apply(this.model,t);break;case"confirmationFlowErrors":return _.get(this.model.get("response"),"flowErrors",{})}return this}})))},function(e){e.exports={method:"KLARNA",description:{urlHint:"",title:"",information:"",name:"",moreInfo:"",header:""},options:{klarnaInfoDTO:{},form:{labelKey:"payment",name:"PAYMENT",form:{gender:{attributes:{autoCapitalize:"",dataRole:"",maxLength:0,unique:"",type:"",patternType:"",autocomplete:"nope",validator:"NULL_VALIDATOR",icon:"",title:"",hoverTag:"",autocapitalize:"",autocorrect:""},cms:{attributes:{validationPlaceholderKey:"",labelKey:"Geschlecht",validationErrorKey:"Selecciona el sexo de la persona",validationMandatoryKey:"Selecciona una de las opciones"},options:{defaultValue:null,options:{H:"Herr",F:"Frau"}}},css:{field:"odf-select-xs paymentmanager_datepicker",container:"od-paymentmanager-form-field-month field_month",checkMark:"odf-hidden",label:"",wrongLabel:"",wrapper:"od-paymentmanager-fix-space",icon:"",placeholder:""},data:null,requiredFieldOptional:!1,name:"gender",informationFieldOptions:{mandatory:!0,requiredField:"required",boxType:"COMBO_BOX",source:"GENDER"}},name:{attributes:{autoCapitalize:"",dataRole:"",maxLength:0,unique:"",type:"text",patternType:"latinCharacters",autocomplete:"nope",validator:"PAX_NAME_REGEX",icon:"",title:"",hoverTag:"",autocapitalize:"",autocorrect:""},cms:{attributes:{placeholderKey:"Tal y como aparece en la tarjeta (mín. 6 letras)",validationPlaceholderKey:"Debe coincidir con la tarjeta",labelKey:"Vorname",validationErrorKey:"Introduce un nombre válido",validationMandatoryKey:"Introduce el nombre del titular de la tarjeta"},options:null},css:{field:"odf-input-xl",container:"",checkMark:"odf-form-checkmark-xl",label:"",wrongLabel:"",wrapper:"card_field",icon:"",placeholder:""},data:null,requiredFieldOptional:!1,name:"name",informationFieldOptions:{mandatory:!0,requiredField:"required",boxType:"TEXT_BOX",source:null}},surname:{attributes:{autoCapitalize:"",dataRole:"",maxLength:0,unique:"",type:"text",patternType:"latinCharacters",autocomplete:"nope",validator:"PAX_NAME_REGEX",icon:"",title:"",hoverTag:"",autocapitalize:"",autocorrect:""},cms:{attributes:{placeholderKey:"Tal y como aparece en la tarjeta (mín. 6 letras)",validationPlaceholderKey:"Debe coincidir con la tarjeta",labelKey:"Nachname",validationErrorKey:"Introduce un apellido válido",validationMandatoryKey:"Introduce el apellido del titular de la tarjeta"},options:null},css:{field:"odf-input-xl",container:"",checkMark:"odf-form-checkmark-xl",label:"",wrongLabel:"",wrapper:"card_field",icon:"",placeholder:""},data:null,requiredFieldOptional:!1,name:"surname",informationFieldOptions:{mandatory:!0,requiredField:"required",boxType:"TEXT_BOX",source:null}},address:{attributes:{autoCapitalize:"",dataRole:"",maxLength:0,unique:"",type:"text",patternType:"latinCharacters",autocomplete:"nope",validator:"PAX_NAME_REGEX",icon:"",title:"",hoverTag:"",autocapitalize:"",autocorrect:""},cms:{attributes:{placeholderKey:"Tal y como aparece en la tarjeta (mín. 6 letras)",validationPlaceholderKey:"Debe coincidir con la tarjeta",labelKey:"Adresse",validationErrorKey:"Introduce un apellido válido",validationMandatoryKey:"Introduce el apellido del titular de la tarjeta"},options:null},css:{field:"odf-input-xl",container:"",checkMark:"odf-form-checkmark-xl",label:"",wrongLabel:"",wrapper:"card_field",icon:"",placeholder:""},data:null,requiredFieldOptional:!1,name:"address",informationFieldOptions:{mandatory:!0,requiredField:"required",boxType:"TEXT_BOX",source:null}},city:{attributes:{autoCapitalize:"",dataRole:"",maxLength:0,unique:"",type:"text",patternType:"latinCharacters",autocomplete:"nope",validator:"PAX_NAME_REGEX",icon:"",title:"",hoverTag:"",autocapitalize:"",autocorrect:""},cms:{attributes:{placeholderKey:"Tal y como aparece en la tarjeta (mín. 6 letras)",validationPlaceholderKey:"Debe coincidir con la tarjeta",labelKey:"Stadt",validationErrorKey:"Introduce un apellido válido",validationMandatoryKey:"Introduce el apellido del titular de la tarjeta"},options:null},css:{field:"odf-input-xl",container:"",checkMark:"odf-form-checkmark-xl",label:"",wrongLabel:"",wrapper:"card_field",icon:"",placeholder:""},data:null,requiredFieldOptional:!1,name:"city",informationFieldOptions:{mandatory:!0,requiredField:"required",boxType:"TEXT_BOX",source:null}},country:{attributes:{autoCapitalize:"",dataRole:"",maxLength:0,unique:"",type:"",patternType:"",autocomplete:"nope",validator:"NULL_VALIDATOR",icon:"",title:"",hoverTag:"",autocapitalize:"",autocorrect:""},cms:{attributes:{validationPlaceholderKey:"",labelKey:"Land",validationErrorKey:"Selecciona una fecha de caducidad válida",validationMandatoryKey:"Selecciona una fecha de caducidad válida"},options:{defaultValue:null,options:{Deutchland:"Deutchland",Katalonien:"Katalonien","Österreich":"Österreich",Schweiz:"Schweiz",Spanien:"Spanien"}}},css:{field:"odf-select-xs paymentmanager_datepicker",container:"od-paymentmanager-form-field-month field_month",checkMark:"odf-hidden",label:"",wrongLabel:"",wrapper:"od-paymentmanager-fix-space",icon:"",placeholder:""},data:null,requiredFieldOptional:!1,name:"country",informationFieldOptions:{mandatory:!0,requiredField:"required",boxType:"COMBO_BOX",source:"MONTHS"}},countrycode:{attributes:{autoCapitalize:"",dataRole:"",maxLength:0,unique:"",type:"",patternType:"",autocomplete:"nope",validator:"NULL_VALIDATOR",icon:"",title:"",hoverTag:"",autocapitalize:"",autocorrect:""},cms:{attributes:{validationPlaceholderKey:"",labelKey:"Ländervorwahl",validationErrorKey:"Selecciona una fecha de caducidad válida",validationMandatoryKey:"Selecciona una fecha de caducidad válida"},options:{defaultValue:null,options:{Deutchland:"(+49) Deutchland",Katalonien:"(+34) Katalonien","Österreich":"(+43) Österreich",Schweiz:"(+41) Schweiz",Spanien:"(+34) Spanien"}}},css:{field:"odf-select-xs paymentmanager_datepicker",container:"od-paymentmanager-form-field-month field_month",checkMark:"odf-hidden",label:"",wrongLabel:"",wrapper:"od-paymentmanager-fix-space",icon:"",placeholder:""},data:null,requiredFieldOptional:!1,name:"countrycode",informationFieldOptions:{mandatory:!0,requiredField:"required",boxType:"COMBO_BOX",source:"MONTHS"}},phone:{attributes:{autoCapitalize:"",dataRole:"",maxLength:19,unique:"",type:"tel",patternType:"ccNumberFormatted",autocomplete:"nope",validator:"NULL_VALIDATOR",icon:"",title:"",hoverTag:"",autocapitalize:"",autocorrect:""},cms:{attributes:{placeholderKey:"13 a 19 cifras",validationPlaceholderKey:"13 a 19 cifras",labelKey:"Telefonnummer",validationErrorKey:"Introduce un número de tarjeta bancaria válido",validationMandatoryKey:"Introduce el número de tarjeta bancaria"},options:null},css:{field:"odf-input-xl inspectletIgnore",container:"od-credit-card-container",checkMark:"odf-form-checkmark-xl",label:"",wrongLabel:"",wrapper:"card_field",icon:"odf-input-icon-xl od-bin-card-icon od-bin-card-icon-size cc_type_icon",placeholder:""},data:null,requiredFieldOptional:!1,name:"phone",informationFieldOptions:{mandatory:!0,requiredField:"required",boxType:"TEXT_BOX",source:null}},birthdate:{attributes:{autoCapitalize:"",dataRole:"",maxLength:19,unique:"",type:"tel",patternType:"ccNumberFormatted",autocomplete:"nope",validator:"NULL_VALIDATOR",icon:"",title:"",hoverTag:"",autocapitalize:"",autocorrect:""},cms:{attributes:{placeholderKey:"13 a 19 cifras",validationPlaceholderKey:"13 a 19 cifras",labelKey:"Geburstdatum",validationErrorKey:"Introduce un número de tarjeta bancaria válido",validationMandatoryKey:"Introduce el número de tarjeta bancaria"},options:null},css:{field:"odf-input-xl inspectletIgnore",container:"od-credit-card-container",checkMark:"odf-form-checkmark-xl",label:"",wrongLabel:"",wrapper:"card_field",icon:"odf-input-icon-xl od-bin-card-icon od-bin-card-icon-size cc_type_icon",placeholder:""},data:null,requiredFieldOptional:!1,name:"birthdate",informationFieldOptions:{mandatory:!0,requiredField:"required",boxType:"TEXT_BOX",source:null}},agreement:{attributes:{autoCapitalize:"",dataRole:"",maxLength:0,unique:"",type:"",patternType:"",autocomplete:"",validator:"REQUIRED_FIELD",icon:"",title:"",hoverTag:"",autocapitalize:"",autocorrect:""},cms:{attributes:{labelKey:"Mit der übertmittlung der für die Abwicklung der gewählten Klarna Zahlungsmethode und einer identitäts- und Bonitätsprüfung erforderlichen Daten an Klarna bin ich einverstanden. Meine Einwillgung kann ich jederzeir mit Wirkung für die Zukunft widerrufen."},options:null},css:null,data:null,requiredFieldOptional:!1,name:"agreement",informationFieldOptions:{mandatory:!0,requiredField:"required",boxType:"CHECK_BOX",source:null}}}}}}},function(e,t,i){"use strict";var n=i(94),a=i(0);Odigeo.defineWidget("promotionalcodes",Odigeo.Widget.extend(n.extend({minimumPromoCodeLength:2,modelClass:Odigeo.Model.extend({totalFlightPrice:0,totalDiscount:0,promocode:{},promoCodeListArray:null,promotionalCode:"",removal:!1,step:"",init:function(){this.totalFlightPrice=parseFloat(this.widget.options.totalPrice),this.widget.options=Odigeo.parseOptions(this.widget.options)},url:function(){return Odigeo.Settings.getProperty("serviceUrlFormatter")("addproduct")},getDataRequestSettings:function(){return{type:"POST",contentType:"application/json",dataType:"html",cache:!1,data:JSON.stringify({bookingId:this.widget.options.bookingId,promotionalCodes:[{code:this.promotionalCode}],nextPage:this.step,removal:this.removal}),success:_.bind(this.requestSuccessHandler,this),error:_.bind(this.requestErrorHandler,this)}},requestSuccessHandler:function(e){var t=Odigeo.Utils.parseJson(e);this.promoCodeListArray=t.promoCodeList||{},this.widget.fillPromocodesList(),null===t.errors?(this.widget.responseIsOK(this.removal?"coupon_remove_clicks":"coupon_ok"),this.totalDiscount>this.totalFlightPrice&&a.trackEvent("coupon_section","coupon_maximum_discount_error")):this.widget.responseIsKO(t.errors[0].code)},requestErrorHandler:function(){this.widget.responseIsKO()}}),viewClass:Odigeo.View.extend({events:{"change @promoCodesCheck":"onPromoCodesCheckChanged","focus @promotionalCodeInput":"onFocusInput","blur @promotionalCodeInput":"onBlurFocusInput"},selectors:{promotionalcodesBlockCheck:".promotionalcodes_block_check",promoCodeButton:".promo_code_button",codeKo:".code_ko",codeKoMessage:".code_ko_message",disclaimer:".disclaimer",promotionalcodesBlockDiscounts:".promotionalcodes_block_discounts",codeOk:".code_ok",addCode:".add_code",codeTotalDiscount:".code_total_discount",promotionalcodesInfoBlock:".promotionalcodes_info_block",promoCodesCheck:"#promoCodesCheck",promotionalCodeInput:'input[name="promotionalCode"]',promoCodesTemplate:".promo_codes_template"},init:function(){this.bindToDom()},bindToDom:function(){this.isDomBinded||(this.$cachedSelectors.promotionalCodeInput.on(Odigeo.Events.keyup,_.bind(function(e){e.keyCode===Odigeo.Events.keys.KEY_RETURN&&this.checkHandler.call(this,this.$cachedSelectors.promotionalCodeInput.val(),!1)},this.widget)),this.$cachedSelectors.promoCodeButton.on(Odigeo.Events.tap,_.bind(function(){this.widget.checkHandler.call(this.widget,this.$cachedSelectors.promotionalCodeInput.val(),!1),this.changePromoCodesFocus(!0)},this)),this.$widget.on(Odigeo.Events.tap,".cancel_code",_.bind(this.widget.deleteHandler,this.widget,_)),this.$cachedSelectors.addCode.on(Odigeo.Events.tap,_.bind(this.showAddCodeSection,this)),this.collapsibleContainer=Odigeo.UIElements.collapsive.enhance(this.$cachedSelectors.promotionalcodesInfoBlock,{initiallyExpanded:this.widget.options.initiallyExpanded||"PRODUCT_PAGE"===this.widget.options.step}),this.widget.options.initiallyExpanded&&this.addInitiallyExpandedSettings(),this.isDomBinded=!0)},addInitiallyExpandedSettings:function(){this.$cachedSelectors.promoCodesCheck.prop("checked",!0),this.model.promoCodeListArray=_.isObject(this.widget.options.promoCodeList)?this.widget.options.promoCodeList.list:[],_.size(this.model.promoCodeListArray)&&this.$cachedSelectors.promotionalcodesBlockCheck.addClass("odf-hidden"),this.widget.fillPromocodesList()},unbindFromDom:function(){this.isDomBinded&&(this.$cachedSelectors.promoCodeButton.off(Odigeo.Events.tap),this.$cachedSelectors.promotionalCodeInput.off(Odigeo.Events.keyup),this.$cachedSelectors.cancelCodeDialog.off(Odigeo.Events.tap),this.$cachedSelectors.addCode.off(Odigeo.Events.tap),this.$cachedSelectors.promoCodesCheck.off(Odigeo.Events.change),this.isDomBinded=!1)},changePromoCodesFocus:function(e){this.$cachedSelectors.promotionalCodeInput.closest(".paymentmanager_row").toggleClass("focused",e)},onPromoCodesCheckChanged:function(){var e=this.$cachedSelectors.promoCodesCheck.is(":checked");a.trackEvent("coupon_section",e?"show_coupon_click":"hide_coupon_click"),this.collapsibleContainer.trigger("togglePanelByParameter",e)},onFocusInput:function(e){this.changeFocusInput(e,!0)},onBlurFocusInput:function(e){this.changeFocusInput(e,!1)},changeFocusInput:function(e,t){$(e.target).closest(".paymentmanager_row").toggleClass("focused",t)},showAddCodeSection:function(){this.$cachedSelectors.addCode.addClass("odf-hidden"),this.$cachedSelectors.promotionalcodesBlockCheck.removeClass("odf-hidden")}}),deleteHandler:function(e){var t=$(e.target);t.parent().find(".cancel_waiting").removeClass("odf-hidden"),t.addClass("odf-hidden"),this.checkHandler(t.data("code"),!0)},checkHandler:function(e,t){e.length>=this.minimumPromoCodeLength&&(this.model.promotionalCode=e,this.changeWidgetState(t?"cancel_waiting":"add_code_button_loading"),this.model.step=this.options.step,this.model.removal=t,this.model.isEmptyData=!1,this.model.refresh())},fillPromocodesList:function(){if(this.model.totalDiscount=0,this.changeWidgetState("OK"),_.isArray(this.model.promoCodeListArray)&&0<this.model.promoCodeListArray.length)var e=this.options.STR_success.split("[codename]"),t=_.template(this.view.$cachedSelectors.promoCodesTemplate.html(),Odigeo.Utils.getTmplSettings({variable:""})),i=_.map(this.model.promoCodeListArray,function(i){return this.model.totalDiscount+=i.discount,t({code:i.code,discount:Odigeo.Utils.formatCurrency(parseFloat(i.discount)),promotionalCodeText:e[0],promotionalCodeEndText:e[1]})},this);this.view.$cachedSelectors.codeOk.html(_.isArray(i)?i.join(""):""),this.view.$cachedSelectors.codeTotalDiscount.html(Odigeo.Utils.formatCurrency(parseFloat(this.model.totalDiscount)));var n=-Math.abs(this.model.totalDiscount);this.model.set("promocode",{onePrice:n,conceptLabel:this.options.pbdText,quantity:1,allPrice:n,type:"PROMO_CODE"}),this.changeWidgetState(0<this.model.totalDiscount?"showresults":"hideresults")},changeWidgetState:function(e){switch(e){case"OK":this.view.$cachedSelectors.codeKo.addClass("odf-hidden"),this.view.$cachedSelectors.promotionalCodeInput.removeClass("error"),this.view.$cachedSelectors.disclaimer.addClass("odf-hidden"),this.view.$cachedSelectors.promotionalCodeInput.val(""),this.view.$cachedSelectors.codeOk.html(""),this.view.$cachedSelectors.promoCodesCheck.prop("disabled",!0),this.view.$cachedSelectors.promoCodeButton.removeClass("odf-hidden loading"),this.view.$cachedSelectors.promotionalcodesBlockDiscounts.removeClass("odf-hidden"),this.view.$cachedSelectors.addCode.removeClass("odf-hidden");break;case"KO":this.view.$cachedSelectors.codeKo.removeClass("odf-hidden"),this.view.$cachedSelectors.promotionalCodeInput.addClass("error"),this.view.$cachedSelectors.disclaimer.addClass("odf-hidden"),this.view.$cachedSelectors.promotionalCodeInput.val(""),this.view.$cachedSelectors.promotionalcodesBlockCheck.removeClass("odf-hidden"),this.view.$cachedSelectors.promoCodeButton.removeClass("odf-hidden loading"),this.view.changePromoCodesFocus(!1),0===_.size(this.model.promoCodeListArray)&&this.view.$cachedSelectors.promotionalcodesBlockDiscounts.addClass("odf-hidden"),this.view.$cachedSelectors.addCode.addClass("odf-hidden");break;case"add_code_button_loading":this.view.$cachedSelectors.promoCodeButton.addClass("loading");break;case"cancel_waiting":this.view.$cachedSelectors.promoCodeButton.removeClass("loading");break;case"showresults":this.view.$cachedSelectors.promotionalcodesBlockCheck.addClass("odf-hidden"),this.view.$cachedSelectors.promotionalcodesBlockDiscounts.removeClass("odf-hidden"),this.view.$cachedSelectors.promoCodesCheck.prop("disabled",!0);break;case"hideresults":this.view.$cachedSelectors.promotionalcodesBlockCheck.removeClass("odf-hidden"),this.view.$cachedSelectors.promotionalcodesBlockDiscounts.addClass("odf-hidden"),this.view.$cachedSelectors.promoCodesCheck.removeAttr("disabled")}},responseIsOK:function(e){var t=this.model.get("promocode");n.mixin.addItemToPricemanagerCollection(_.extend(t,this.getAllPromocodesPrice())),Odigeo.trigger(this.id+":updatePrices"),Odigeo.trigger(this.id+":updatePromocode",t),a.trackEvent("coupon_section",e)},getAllPromocodesPrice:function(){return _.reduce(this.model.promoCodeListArray,function(e,t){return{allPrice:e.allPrice-t.discount,quantity:e.quantity+1}},{allPrice:0,quantity:0})},responseIsKO:function(e){var t="WNG_007"===e?this.options["error_"+e].replace("[codename]",'"'+this.model.promotionalCode+'"'):this.options["error_"+e];this.changeWidgetState("KO"),this.view.$cachedSelectors.codeKoMessage.text(t),a.trackEvent("coupon_section","coupon_not_ok_error")}})))},function(e,t,i){"use strict";var n=i(737);Odigeo.defineWidget("shoppingcartmanager",Odigeo.Widget.extend({modelClass:n,execute:function(e,t){switch(e){case"addProductToShoppingCart":this.model.addProductToShoppingCart(t);break;case"submitProducts":this.model.submitProducts(t);break;case"clearShoppingCart":this.model.clearShoppingCart();break;case"deleteHotelFromCart":this.model.deleteHotelFromCart(t);break;case"selectFareUpgrade":this.model.selectFareUpgrade();break;case"deleteFareUpgrade":this.model.deleteFareUpgrade()}return this}}))},function(e,t,i){"use strict";var n=i(0);e.exports=Odigeo.Model.extend({productSelectionError:"INT-003",dataURL:null,dataURLAddProduct:"addproduct",dataURLPersonalInfo:"addpersonalinfo",dataURLSubmitProducts:"submitproducts",CONST:{NO_INTENTION:"NOT_INTENTED_PURCHASE",INTENTION_UNFULFILLED:"INTENDED_PURCHASE",INTENTION_FULFILLED:"PURCHASED"},getDataRequestSettings:function(){return{type:"POST",data:JSON.stringify(this._formatRequestData()),contentType:"application/json",dataType:"json",cache:!1,success:_.bind(this.requestSuccessHandler,this),error:_.bind(this.requestErrorHandler,this)}},_formatRequestData:function(){var e=String(this.get("bookingID")),t=String(this.get("nextPage")),i=String(this.get("pageToGo")),n=[],a=!1,s=!1,r={},o={travellers:[],buyer:{},bookingId:e,nextPage:t,refundableFareUpgradeShown:this.get("refundableFareUpgradeShown")||!1,refundableFareUpgrade:this.get("refundableFareUpgrade")||!1,customerInteractionWithBaggage:this.getIntentionToBuy("bags")},c={insuranceOffers:[],serviceOptions:{},bookingId:e,promotionalCodes:[],nextPage:t,pageToGo:i},d=this.get("data");return _.each(d,function(e,t){0<=t.indexOf("passenger")?(o.travellers.push(e),n.push(e),a=!0):0<=t.indexOf("buyer")?(o.buyer=e,a=!0):0<=t.indexOf("insurance")?"insurancesToAdd"===t?o.insurancesToAdd=_.isUndefined(e)?"":e:(c.insuranceOffers=e,s=!0):0<=t.indexOf("serviceoptions")?(c.serviceOptions=e,s=!0):0<=t.indexOf("seats")?(e.customerInteractionWithSeats=this.getIntentionToBuy("seats"),_.extend(o,{ancillaryServiceRequestSetDTO:e})):0<=t.indexOf("boardingOptions")&&_.extend(o,{boardingOptions:e})},this),a&&s?(Odigeo.Session.set("booking_pax_list",JSON.stringify(n)),r.personalInfoRequest=o,r.productInfoRequest=c):a?(Odigeo.Session.set("booking_pax_list",JSON.stringify(n)),r=o):s&&(r=c,d.removeAncillaryServices&&(r=_.extend(r,{removeAncillaryServices:!0}))),r},url:function(){return Odigeo.Settings.getProperty("serviceUrlFormatter")(this.dataURL)},requestSuccessHandler:function(e){if(Odigeo.trigger(this.widget.id+":enablePaymentButton"),null!==e.errors){var t=e.errors[0].message;Odigeo.Utils.startsWith(t,this.productSelectionError)?(n.trackEvent("back_and_errors","user_cant_continue_popup_"+t),Odigeo.UIElements.showBrokenFlowError()):Odigeo.trigger(this.widget.id+":requestCompletedWithError",e.errors)}else Odigeo.trigger(this.widget.id+":requestCompletedSuccessfully",e)},_hideContainersForError:function(){$("#bread-crumbs").addClass("hidden")},requestErrorHandler:function(e){Odigeo.trigger(this.widget.id+":requestError",e)},addProductToShoppingCart:function(e){var t,i;_.isUndefined(e.pageToGo)||(i=_.isUndefined(e.pageToGo.params)?e.pageToGo.path:e.pageToGo.params),this.set({bookingID:e.bookingID}),this.set({data:e.data}),this.set({nextPage:e.nextPage}),this.set({pageToGo:i}),t=_.keys(this.get("data")),this.dataURL=_.reduce(t,function(e,t){return 0<=t.indexOf("passenger")||0<=t.indexOf("buyer")||"insurancesToAdd"===t?e===this.dataURLAddProduct?e=this.dataURLSubmitProducts:e||(e=this.dataURLPersonalInfo):0<=t.indexOf("insurance")?e===this.dataURLPersonalInfo?e=this.dataURLSubmitProducts:e||(e=this.dataURLAddProduct):0<=t.indexOf("serviceoptions")?e===this.dataURLPersonalInfo?e=this.dataURLSubmitProducts:e||(e=this.dataURLAddProduct):0<=t.indexOf("invoicemanager")?e===this.dataURLAddProduct?e=this.dataURLSubmitProducts:e||(e=this.dataURLAddProduct):0<=t.indexOf("seats")&&(e===this.dataURLPersonalInfo?e=this.dataURLPersonalInfo:e||(e=this.dataURLAddProduct)),e},"",this),this.isEmptyData=!1},submitProducts:function(e){e&&e.avoidEnsightenReload&&Odigeo.Session.set("avoidEnsightenReload",!0),this.refresh()},clearShoppingCart:function(){this.clear(),this.dataURL=null,this.isEmptyData=!0},deleteHotelFromCart:function(e){return this.fetch({url:Odigeo.Settings.getProperty("serviceUrlFormatter")("upsell/accommodation"),contentType:"application/json",type:"DELETE",parse:!1,success:_.bind(this.successFetchDelete,this,e),error:_.bind(this.errorFetchDelete,this)})},successFetchDelete:function(e){return Odigeo.trigger(this.widget.id+":successDeleteHotelFromCart",e),this},errorFetchDelete:function(){return Odigeo.trigger(this.widget.id+":errorDeleteHotelFromCart"),this},selectFareUpgrade:function(){this.set("refundableFareUpgradeShown",!0),this.set("refundableFareUpgrade",!0)},deleteFareUpgrade:function(){this.set("refundableFareUpgradeShown",!0),this.set("refundableFareUpgrade",!1)},getIntentionToBuy:function(e){var t=_.parseInt(Odigeo.Session.get("numSelected_"+e)||0),i=Odigeo.Utils.parseJson(Odigeo.Session.get("intentionToBuy_"+e)),n=0<t?this.CONST.INTENTION_FULFILLED:this.CONST.INTENTION_UNFULFILLED;return i?n:this.CONST.NO_INTENTION}})},function(e,t,i){"use strict";var n=i(0),a=i(323),s=i(51);Odigeo.defineWidget("special_request_manager",Odigeo.Widget.extend({modelClass:Odigeo.Model.extend({defaults:{option:"",bookingUserComments:""},validate:function(){return"wheelchair"!==this.get("specialRequestOption")||!_.isEmpty(this.get("pmiBatteryType"))&&!_.isEmpty(this.get("pmiOption"))},hasSpecialRequest:function(){return this.get("specialRequestDisplay")&&!_.isEmpty(this.get("specialRequestOption"))},getData:function(){var e=this.get("specialRequestOption"),t={wheelchair:["pmiType","pmiOption","pmiBatteryType"],pets:["petsOption","petsWeight","petsLength","petsWidth"]};return this.getStringData(t[e]?t[e]:[])},getStringData:function(e){return _.reduce(e,_.bind(function(e,t){return e+"-"+this.get(t)},this),_.snakeCase(this.get("specialRequestOption")))}}),viewClass:Odigeo.View.extend({selectors:{optionsContainer:".options_container",specialRequestForm:".special_request_form",displaySpecialRequestSelector:"#specialRequestDisplay",specialRequestOption:'[data-name="specialRequestOption"]',wheelchairFields:'select[data-name="pmiBatteryType"], select[data-name="pmiOption"]',petInputFields:'input[data-name="petsWeight"], input[data-name="petsLength"], input[data-name="petsWidth"]',fields:"input, radio, select",clearInput:".clear_input"},events:{"change @displaySpecialRequestSelector":"toggleForm"},init:function(){this.form=Odigeo.UIElements.collapsive.enhance(this.$cachedSelectors.specialRequestForm,{initiallyExpanded:!1}),this.bindEvents(),this.$cachedSelectors.fields.trigger(Odigeo.Events.change)},bindEvents:function(){this.$cachedSelectors.specialRequestOption.on(Odigeo.Events.change,_.bind(this.onOptionSelectedChanged,this,_)),this.$cachedSelectors.fields.on(Odigeo.Events.change,_.bind(this.saveFieldValue,this,_)),_.each(this.$cachedSelectors.petInputFields,function(e){a.initInputPattern(e)}),this.$cachedSelectors.wheelchairFields.parents().closest(".validation_field").attr("data-state","init"),this.$cachedSelectors.wheelchairFields.on(Odigeo.Events.blur,_.bind(this.checkValidity,this,_,!1)),this.$cachedSelectors.petInputFields.parents().closest(".validation_field").attr("data-state","valid"),this.$cachedSelectors.petInputFields.on(Odigeo.Events.focus,this.setFocus),this.$cachedSelectors.petInputFields.on(Odigeo.Events.blur,_.partial(this.checkValidity,_,!0)),this.$cachedSelectors.clearInput.on(Odigeo.Events.tap,s.clearField)},toggleForm:function(){this.form.trigger("togglePanelByParameter",this.$cachedSelectors.displaySpecialRequestSelector.is(":checked"))},onOptionSelectedChanged:function(e){var t=e.target.value,i=this.widget.model.get("option"),n=_.contains(["pets","wheelchair"],i);this.widget.model.set("option",t),this.$cachedSelectors.optionsContainer.attr("data-selected",n?"transition-"+i:t),n&&this.$cachedSelectors.optionsContainer.one(Odigeo.Events.transitionEnd,_.bind(this.changeDataSelected,this,t))},changeDataSelected:function(){this.$cachedSelectors.optionsContainer.attr("data-selected",this.widget.model.get("option"))},saveFieldValue:function(e){var t=$(e.target),i=t.attr("type");("radio"!==i||"radio"===i&&!0===t.is(":checked"))&&this.widget.model.set(t.attr("data-name")||t.attr("name"),"checkbox"===i?t.is(":checked"):e.target.value)},displayErrors:function(){"wheelchair"===this.model.get("specialRequestOption")&&_.each(this.$cachedSelectors.wheelchairFields,function(e){s.setStateAndShowError(e)})},checkValidity:function(e,t){s.removeFocus(e.target),s.setStateAndShowError(e.target,!0,t)},setFocus:function(e){s.setFocus(e.target)}}),analyticsEventTracking:function(){var e="special_request_"+({pets:"pets",wheelchair:"pmr",minor:"underage",specialLuggage:"equipment",familyDiscount:"familydiscount",other:"other"}[this.model.get("option")]||"not_selected");n.trackEvent("special_requests",e)},getSpecialRequestData:function(){return this.model.getData()},isValid:function(){var e=this.model.validate();return e||this.view.displayErrors(),e},hasSpecialRequest:function(){return this.model.hasSpecialRequest()},setBookingUserComments:function(){this.hasSpecialRequest()&&this.isValid()&&Odigeo.Session.set("bookingUserComments",JSON.stringify(this.getSpecialRequestData()))}}))},function(e,t,i){"use strict";Odigeo.defineWidget("membership_subscription",Odigeo.Widget.extend({modelClass:i(740),viewClass:i(741),init:function(){this.listenTo(this.view,"updateProduct",this.updateProduct)},addProductByTraveller:function(e){this.model.addProductByTraveller(e)},alertDisclaimer:function(e){this.view.alertDisclaimer(e)},checkPreviouslyAddedProduct:function(){this.view.checkPreviouslyAddedProduct()},deleteMembership:function(){this.view.deleteMembership()},getData:function(){return this.view.trackContinueToPayment(),this.model.getData()},getGroup:function(){return this.view.getGroup()},getMemberClick:function(){return this.view.getMemberClick()},hideWidget:function(e){this.view.hideWidget(e)},highlightMembershipWidget:function(){this.view.highlightMembershipWidget()},isSelected:function(){return this.model.isMemberSelected()},load:function(){this.model.refreshData()},memberEvolutionContinueMobile:function(){this.view.memberEvolutionContinueMobile()},openLightBox:function(e){this.view.openLightBox(e)},renderLightBoxTemplate:function(){this.view.renderLightBoxTemplate()},setListOfTravellers:function(e){this.model.setListOfTravellers(e)},loginDone:function(e){this.logBehaviour(e)},logoutDone:function(){this.logBehaviour()},logBehaviour:function(e){var t=!_.isUndefined(e);this.model.set("userDTO",e),this.model.set("isUserLoggedIn",t),this.view.showLoginLink(t),this.view.updateState(t)},showWidget:function(){this.view.showWidget()},solveAddMembershipError:function(e){this.view.solveAddMembershipError(e)},trackGetMembershipLightBox:function(e,t){this.view.trackGetMembershipLightBox(e,t)},updateProduct:function(e){this.model.updateProduct(e)}}))},function(e,t,i){"use strict";var n=i(94);e.exports=Odigeo.Model.extend(n.extend({dataUrl:"getsubscriptionoffer",defaults:{member:{},allPrice:0,allPriceFromBackend:0,onePrice:0,onePriceFromBackend:0,quantity:0,conceptKey:"membershipsubscription",conceptLabel:"",type:"MEMBERSHIP_SUBSCRIPTION",memberSelected:null,isUserLoggedIn:!1,userDTO:null,isPriceWithoutDiscountSelected:!1,state:"",scenario:""},url:function(){return Odigeo.Settings.getProperty("membershipServiceFormatter")(this.dataUrl)},getOfferFromResponse:function(e,t){var i=t.membershipSubscriptionOfferDTO;return _.isObject(i)&&_.isEmpty(t.errors)?i:{price:0}},buildPriceFromOffer:function(e){return{onePriceFromBackend:+e.price,allPriceFromBackend:+e.price,formattedPrice:Odigeo.Utils.formatCurrency(e.price,_.extend({},Odigeo.Utils.Currency,{decimalPlaces:2}))}},propagate:function(e){return function(t){return Odigeo.trigger(e+":membershipSubscriptionStored",t.formattedPrice),t}},init:function(){this.bindEvents(),this.fetchProductPrice()},bindEvents:function(){this.on("change:quantity",_.bind(this.onQuantityChange,this))},refreshData:function(){this.isEmptyData=!1,this.refresh()},updateProduct:function(e,t){this.set({quantity:this.isRemoveAction(e)?0:1,allPrice:this.isRemoveAction(e)?0:this.get("allPriceFromBackend"),onePrice:this.isRemoveAction(e)?0:this.get("onePriceFromBackend"),isUserLoggedIn:!!t})},addProductByTraveller:function(e){this.set("memberSelected",e),this.updateProduct("add"),this.widget.view.renderProductAddedTemplate()},removeAndAddProduct:function(){this.set({quantity:0},{silent:!0}),this.updateProduct("add")},isRemoveAction:function(e){return"remove"===e},onQuantityChange:function(e){this.addItemToPricemanagerCollection(e.attributes),Odigeo.trigger(this.widget.id+":membershipSubscriptionChange",e.attributes)},fetchProductPrice:function(){this.fetch({dataType:"json",contentType:"application/json",type:"GET",success:_.flowRight(_.bind(this.set,this),this.propagate(this.widget.id),this.buildPriceFromOffer,this.getOfferFromResponse)})},isProductStoredInSession:function(){var e=this.getOldProductRequest();return!_.isEmpty(e)&&0<e.quantity},getOldProductRequest:function(){return Odigeo.Utils.parseJson(Odigeo.Session.get("membershipProductPreviousRequest"))},setListOfTravellers:function(e){this.set("member",{email:e.email,isLogged:e.isLogged,password:e.password,status:e.status,travellers:e.travellers})},getNameAndLastName:function(e,t){return e?_.find(this.get("member").travellers,function(e){return e.id===t},this):{name:"",lastName:""}},getMemberSelectedFromPreviousRequest:function(){var e=this.getOldProductRequest();return _.isEmpty(e)?null:e.memberSelected},getMemberSelected:function(){var e=this.get("memberSelected");return _.isNull(e)?this.getMemberSelectedFromPreviousRequest():e},isMemberSelected:function(){return!!this.isProductStoredInSession()||!!this.get("memberSelected")},getData:function(){var e=this.getMemberSelected(),t=!_.isEmpty(this.get("member"))&&!_.isNull(e),i=this.getNameAndLastName(t,e);return{password:t?this.get("password"):"",quantity:this.get("quantity"),name:i.name,lastName:i.lastName,memberSelected:e}}}))},function(e,t,i){"use strict";var n=i(81),a=i(0),s=i(7),r=i(157),o=i(348),c=i(50).isUserDTOMember;e.exports=Odigeo.View.extend({slctrs:{alertWarningFields:".alert_warning_fields",allInputs:'[data-name]:not([type="hidden"])',alreadyAMember:".already_a_member",lightboxMember:".lightbox_member",lightboxSaveInformation:".lightbox_save_information",memberSelectTravellers:".member_select_travellers",membershipContainer:".membership_container",membershipMemberPrice:"#membership-member-price",membershipNonMemberPrice:"#membership-non-member-price",membershipPassword:".membership_password",membershipPasswordContainer:".membership_password_container",membershipPasswordError:".membership_password_error",passwordViewerIcon:".password_viewer_icon"},swiper:{selectors:{swiperContainer:"#membership-swiper"},options:{eventMode:"click",draggable:!0,pagination:!0}},tmpls:{emptyTemplate:"#membership-empty",mainTemplate:"#membership-main",lightboxTemplate:"#membership-lightbox",productAddedTemplate:"#membership-product-added"},events:{"change #membership-member-price":"onForcedSelectionMemberChange","change #membership-non-member-price":"onForcedSelectionMemberChange","tap .add_membership_product":"onAddMembershipProduct","tap .continue_with_prime":"onContinueWithPrime","tap .delete_membership":"onDeleteMembership","tap .membership_perks_link":"onMembershipPerksLink","tap .membership_widget_login":"onMembershipWidgetLogin","tap .lightbox_member_close":"onCloseLightboxMember","tap .lightbox_member":"onCloseLightboxMemberTappingOutside","tap .lightbox_save_information_close":"onCloseLightboxSaveInformation","tap .link_save_information":"onSaveInformationClick","tap .open_login_form":"onOpenLoginForm","tap .password_icon":"onPasswordIconClick","tap .want_be_member":"onMemberButtonClick","tap .terms_and_conditions":"onTermsAndConditionsClick"},init:function(){this.tmpls.mainTemplate="#membership-main",this.options=Odigeo.Utils.parseOptions(this.widget.options);var e=this.model.isProductStoredInSession()?this.renderProductAddedTemplate:this.renderBasicTemplate,t=_.flowRight(_.bind(e,this),_.bind(this.updateParamsKeys,this));return this.templates=Odigeo.Utils.getTemplates(this.$el,this.tmpls,{variable:null}),this.listenTo(this.model,"change:allPriceFromBackend",t),this.setInitialState(),this},setInitialState:function(){var e=void 0;e=this.model.isProductStoredInSession()?"added":this.options.isPriceWithoutDiscountSelected?"no-prime":"prime",e=this.model.get("isUserLoggedIn")?"login-"+e:e,this.model.set("state",e)},checkPreviouslyAddedProduct:function(){this.model.isProductStoredInSession()&&(this.model.removeAndAddProduct(),this.renderProductAddedTemplate())},renderBasicTemplate:function(){this.$el.find(this.slctrs.membershipContainer).html(this.templates.mainTemplate({translations:this.opts})),this.widget.options.isSwipeTemplate&&(this.$el.find("#membership-swiper-template").html(_.template(this.$el.find(".membership_swiper_template").html())),new o(this.swiper.selectors,this.swiper.options))},trackGetMembershipLightBox:function(e,t){var i=_.isEmpty(t)?this.model.toJSON().member:t,n={widget_appears:{LOGGED:"prime_mem_view_log-no-sub",PREMIUM:"prime_mem_view_sub-no-log",REGISTERED:"prime_mem_view_no-log-no-sub-upg",NOT_REGISTERED:"prime_mem_view_no-log-no-sub_pax"},click_member:{LOGGED:"prime_mem_select_log-no-sub_np",PREMIUM:"prime_mem_select-sub-no-log",REGISTERED:"prime_mem_select_no-log-no-sub-upg",NOT_REGISTERED:"prime_mem_select_no-log-no-sub_pax"},password_error:{REGISTERED:"pw_inline_FE_error_no-log-no-sub-upg",NOT_REGISTERED:"pw_inline_FE_error_no-log-no-sub"}},s=i.isLogged?n[e].LOGGED:n[e][i.status];_.isEmpty(s)||a.trackEvent("unlocked",s,null,"widget_appears"===e),this.updateScenario(i)},updateScenario:function(e){if(_.isEmpty(this.model.get("scenario"))){var t={NOT_REGISTERED:"no-log-no-sub",REGISTERED:"no-log-no-sub-upg",PREMIUM:"sub-no-log",LOGGED:"log-no-sub"},i=e.isLogged?t.LOGGED:t[e.status];this.model.set("scenario",i)}},renderLightBoxTemplate:function(){this.$el.find(this.slctrs.lightboxMember).html(this.templates.lightboxTemplate({translations:this.opts,data:this.model.toJSON()}))},renderProductAddedTemplate:function(){this.model.set("isPrimePriceSelected",!0),this.$el.find(this.slctrs.membershipContainer).html(this.templates.productAddedTemplate())},alertDisclaimer:function(e){this.$el.find(this.slctrs.alertWarningFields).toggleClass("odf-hidden",!e),e&&a.trackEvent("unlocked","add_membership_clicked_FE_error")},hideWidget:function(e){this.model.updateProduct("remove",e),this.$el.find(this.slctrs.membershipContainer).html(this.templates.emptyTemplate())},highlightMembershipWidget:function(){Odigeo.Utils.scrollToElement(this.$el)},onAddMembershipProduct:function(){this.trackGetMembershipLightBox("click_member");var e=n.checkValidity(this.$el.find(this.slctrs.allInputs),this.$widget);_.isEmpty(e)?(this.setMemberSelected(),this.trigger("updateProduct"),this.onCloseLightboxMember(),this.renderProductAddedTemplate(),s.fireEvent("click_prime","added_prime","true")):(this.showPasswordError(e[0]),this.trackGetMembershipLightBox("password_error"))},onCloseLightboxMemberTappingOutside:function(e){$(e.target).hasClass("lightbox_member")&&this.onCloseLightboxMember()},onCloseLightboxMember:function(){Odigeo.UIElements.toggleWidgetsDialogs(this.widget.id,!1),this.$el.find(this.slctrs.lightboxMember).removeClass("open"),Odigeo.trigger(this.widget.id+":openOrCloseMembershipDialog",!1),a.trackEvent("unlocked","add_membership_close")},onCloseLightboxSaveInformation:function(){this.$el.find(this.slctrs.lightboxSaveInformation).removeClass("open")},onContinueWithPrime:function(){a.trackEvent("unlocked","subscription_widget_prime-mem"),this.onMemberButtonClick()},onDeleteMembership:function(){a.trackEvent("unlocked","unlocked_remove_nag_prime_added_sce:"+this.model.get("state")),Odigeo.UIElements.showLightboxWarning("od-passenger-lightbox-edit",_.bind(this.onDeleteMembershipAction,this),_.bind(this.onDeleteMembershipCancel,this),this.opts.lightboxTexts),a.trackEvent("unlocked","unlocked_remove_nag")},onDeleteMembershipAction:function(){a.trackEvent("unlocked","unlocked_remove_nag_confirm_prime_added_sce:"+this.model.get("state")),this.model.set("state",this.model.get("isUserLoggedIn")?"login-remove":"remove"),Odigeo.AB.isMembershipUserEnumeration?Odigeo.trigger(this.widget.id+":unlockEmail"):this.deleteMembership()},onDeleteMembershipCancel:function(){a.trackEvent("unlocked","unlocked_remove_nag_cancel_prime_added_sce:"+this.model.get("state")),Odigeo.trigger("closeAllPopUps")},onForcedSelectionMemberChange:function(e){var t="membership-member-price"===e.currentTarget.id?"prime-mem":"non-mem";a.trackEvent("unlocked","forced_selection_"+t),Odigeo.trigger(this.widget.id+":setForceSelectionPriceDiscount",_.isEqual(t,"non-mem"))},membershipPerksOpen:function(){Odigeo.trigger(this.widget.id+":openMembershipPerksInfoLightbox"),Odigeo.trigger(this.widget.id+":openOrCloseMembershipDialog",!0)},onMembershipPerksLink:function(){a.trackEvent("unlocked","know_more_clicked_pax_sce:"+this.model.get("state")),this.membershipPerksOpen()},onMembershipWidgetLogin:function(e){a.trackEvent("unlocked","login_clicked"),Odigeo.trigger(this.widget.id+":openLoginForm",e)},onMemberButtonClick:function(){a.trackEvent("unlocked","add_membership_clicked"),Odigeo.AB.isMembershipUserEnumeration?Odigeo.trigger(this.widget.id+":launchTravellersValidationsForRegister"):this.getMemberClick()},onOpenLoginForm:function(e){this.trackGetMembershipLightBox("click_member"),this.onCloseLightboxMember(),Odigeo.trigger(this.widget.id+":openLoginForm",e)},onPasswordIconClick:function(){var e=this.$el.find(this.slctrs.membershipPassword);this.$el.find(this.slctrs.passwordViewerIcon).toggleClass("odf-hidden"),e.attr("type","password"===e.attr("type")?"text":"password")},onSaveInformationClick:function(){this.$el.find(this.slctrs.lightboxSaveInformation).addClass("open")},clearPasswordErrors:function(){this.$el.find(this.slctrs.membershipPasswordContainer).removeClass("invalid"),this.$el.find(this.slctrs.membershipPasswordError).addClass("odf-hidden")},getMemberClick:function(){Odigeo.trigger(this.widget.id+":launchTravellersValidations")},hasToContinue:function(){return!this.$el.find(this.slctrs.membershipMemberPrice).is(":checked")},highlightOptions:function(){a.trackEvent("unlocked","forced_selection_error")},isAnyPriceSelected:function(){return this.$el.find(this.slctrs.membershipMemberPrice).is(":checked")||this.$el.find(this.slctrs.membershipNonMemberPrice).is(":checked")},memberEvolutionContinueMobile:function(){var e=this.isAnyPriceSelected(),t=this.hasToContinue(),i=Odigeo.Utils.parseJson(Odigeo.Session.get("membershipSubscriptionPriceItem")),n=!_.isEmpty(i)&&0<i.data.quantity;e||n?t?Odigeo.trigger(this.widget.id+":continueCallback"):this.getMemberClick():this.highlightOptions()},openLightBox:function(e){this.alertDisclaimer(e),e||(Odigeo.UIElements.toggleWidgetsDialogs(this.widget.id,Odigeo.AB.isMembershipRemoving10MinWarningMessage),Odigeo.trigger(this.widget.id+":getTravellersSelected"),this.$el.find(this.slctrs.lightboxMember).addClass("open"),this.clearPasswordErrors(),Odigeo.trigger(this.widget.id+":openOrCloseMembershipDialog",!0),n.clearErrors(this.$el.find(this.slctrs.allInputs)))},setMemberSelected:function(){this.model.set({password:this.$el.find(this.slctrs.membershipPassword).val(),memberSelected:this.$el.find(this.slctrs.memberSelectTravellers).val()})},updateState:function(e){var t=this.model.get("state");this.model.set("state",e?"login-"+t:t.replace("login-",""))},showLoginLink:function(e){this.$el.find(this.slctrs.alreadyAMember).toggleClass("odf-hidden",e)},showPasswordError:function(e){this.clearPasswordErrors(),this.$el.find(this.slctrs.membershipPasswordContainer).addClass("invalid"),this.$el.find(this.slctrs.membershipPasswordError+'[data-error="'+e.key+'"]').removeClass("odf-hidden")},showWidget:function(){this.renderBasicTemplate()},extendParametrized:function(e){$.extend(!0,this.opts,{productBasic:{perks:e.perks,titleNew:Odigeo.Utils.replaceCmsKeyArgs(e.titleNew,r.getPriceNoWrap(e.titleNewPrice)),titlePre:Odigeo.Utils.replaceCmsKeyArgs(e.titlePre,r.getPriceNoWrap(e.titlePrePrice)),titlePost:Odigeo.Utils.replaceCmsKeyArgs(e.titlePost,r.getPriceNoWrap(e.titlePostPrice)),groupHigher:e.isGroupHigher,basicButton:e.basicButton,basicButtonNew:e.basicButtonNew,basicHeader:e.basicHeader,variation:e.variation,footer:e.footer}})},conditionsGroup3:function(e){return e.discount+e.subscriptionPrice/2<0&&0<e.discount+e.subscriptionPrice},conditionsGroup2:function(e){return e.subscriptionPrice+e.discount<0},extendKeysForContentValueProp:function(e){var t,i=this.opts.productBasic;t=this.conditionsGroup2(e)?"2":this.conditionsGroup3(e)?"3":"4",this.extendParametrized({basicHeader:i["basicHeader"+t],basicButton:i["basicButton"+t],basicButtonNew:i.basicButtonNew,perks:i["perksB"+t],perksNew:i.perksNew,titleNew:i["titleNew"+t],titleNewPrice:e.membershipDiscount,titlePre:i["titlePre"+t],titlePrePrice:"2"===t?e.membershipDiscount:e.flightPrice,titlePost:i["titlePost"+t],titlePostPrice:e.membershipDiscount,isGroupHigher:"2"===t,footer:_.includes(["2","3"],t)?i["footer"+t]:"",variation:t})},extendKeysForBasicTemplate:function(e){$.extend(!0,this.opts,{subscriptionPrice:e.subscriptionPrice,productBasic:{basicButton:Odigeo.Utils.replaceCmsKeyArgs(this.opts.productBasic.basicButton,r.getPriceNoWrap(e.formattedPrice)),titlePost:Odigeo.Utils.replaceCmsKeyArgs(this.opts.productBasic.titlePost,r.getPriceNoWrap(e.membershipDiscount))}})},getGroup:function(){return _.get(this.opts,"productBasic.variation",1)},updateParamsKeys:function(){var e=Number(this.model.get("allPriceFromBackend")),t=Number(this.widget.options.productBasic.membershipDiscount),i=Number(this.widget.options.providerPrice),n=Odigeo.Utils.formatCurrency(i+t),a=Odigeo.Utils.formatCurrency(e),s=Odigeo.Utils.formatCurrency(t);this.opts=Odigeo.parseOptions(this.widget.options),this.extendKeysForContentValueProp({subscriptionPrice:e,discount:t,flightPrice:n,membershipDiscount:s}),this.extendKeysForBasicTemplate({formattedPrice:a,membershipDiscount:s,subscriptionPrice:e})},deleteMembership:function(){this.trigger("updateProduct","remove"),this.renderBasicTemplate(),this.renderLightBoxTemplate()},solveAddMembershipError:function(e){this.deleteMembership(),_.isEmpty(e)||"UNL_MEMBERSHIP_ALREADY_MEMBER"!==e.code||(a.trackEvent("sso_pax_page","go_to_login"),Odigeo.trigger(this.widget.id+":openLoginForm"))},onTermsAndConditionsClick:function(){a.trackEvent("unlocked","unlocked_terms_and_conditions_sce:"+this.model.get("state"))},trackContinueToPayment:function(){if(!this.options.isPriceWithoutDiscountSelected){var e=this.model.get("userDTO");_.isEmpty(this.model.get("scenario"))&&!_.isEmpty(e)&&this.updateScenario({status:c(e)?"PREMIUM":e.source}),a.trackEvent("unlocked","prime_mem_continue_:"+this.model.get("scenario"))}}})},function(e,t,i){"use strict";Odigeo.defineWidget("membership_register",Odigeo.Widget.extend({viewClass:i(743),modelClass:Odigeo.Model.extend({defaults:{callbackData:null,isLoginPending:!1,recaptchaWidgetID:null,isUserLoggedIn:!1}}),loginDone:function(){this.view.loginDone()},openLightBox:function(e){this.view.openLightBox(e)},registerError:function(){this.view.registerError()},registerOk:function(){this.view.registerSuccess()},registerWithError:function(){this.view.registerError()},renderCaptcha:function(){this.view.renderCaptcha()}}))},function(e,t,i){"use strict";var n=i(81),a=i(39),s=i(0);e.exports=Odigeo.View.extend({selectors:{membershipRegisterContainer:".membership_register_container"},slctrs:{allInputs:'[data-name]:not([type="hidden"])',createAccount:".create_account",emailWrapper:".email_wrapper",membershipPassword:".membership_password",membershipPasswordContainer:".membership_password_container",membershipPasswordError:".membership_password_error",passwordViewerIcon:".password_viewer_icon",registerMail:".register_mail",registerMailDisclaimer:".register_mail_disclaimer",selectTravellers:".select_travellers"},events:{"change .select_travellers":"onSelectTravellers","tap .change_email_register":"onChangeEmailRegister","tap .close_membership_register":"onCloseMembershipRegister","tap .create_account":"onCreateAccount","tap .logged_user_confirm":"onLoggedUserConfirm","tap .login_popup":"onLoginPopup","tap .login_popup_error":"onLoginPopupError","tap .password_icon":"onPasswordIconClick","tap .terms_and_conditions":"onTermsAndConditionsClick"},tmpls:{loggedTemplate:"#membership-logged",registerTemplate:"#membership-register"},init:function(){return this.templates=Odigeo.Utils.getTemplates(this.$el,this.tmpls,{variable:null}),this.options=this.widget.options,this},renderLoggedTemplate:function(e){this.model.set("isUserLoggedIn",!0),s.trackEvent("unlocked","prime_mem_view_logged"),this.$cachedSelectors.membershipRegisterContainer.html(this.templates.loggedTemplate({data:e}))},renderRegisterTemplate:function(e){s.trackEvent("unlocked","prime_mem_view_regular"),this.$cachedSelectors.membershipRegisterContainer.html(this.templates.registerTemplate({data:_.extend(e,{recaptchaEnabled:this.options.recaptchaEnabled})})),this.options.recaptchaEnabled&&(a.isGRecaptchaLoaded?this.renderCaptcha():a.init())},addProduct:function(e){Odigeo.trigger(this.widget.id+":addProduct",e),this.onCloseMembershipRegister(),Odigeo.trigger(this.widget.id+":highlightMembershipWidget")},clearEmailErrors:function(){this.$el.find(this.slctrs.registerMailDisclaimer).addClass("odf-hidden"),this.$el.find(this.slctrs.emailWrapper).removeClass("invalid")},clearErrors:function(){this.clearEmailErrors(),this.clearPasswordErrors(),n.clearErrors(this.$el.find(this.slctrs.allInputs))},clearPasswordErrors:function(){this.$el.find(this.slctrs.membershipPasswordContainer).removeClass("invalid"),this.$el.find(this.slctrs.membershipPasswordError).addClass("odf-hidden")},confirmMembership:function(){var e=this.$el.find(this.slctrs.selectTravellers).val();this.addProduct(e)},enableLoadingButton:function(e){this.$el.find(this.slctrs.createAccount).toggleClass("loading",e)},loginDone:function(e){var t=this.model.get("isLoginPending");e?this.model.set("isLoginPending",!1):t&&(Odigeo.trigger(this.widget.id+":highlightMembershipWidget"),this.model.set("isLoginPending",!1))},openMembershipRegister:function(){Odigeo.UIElements.toggleWidgetsDialogs(this.widget.id,Odigeo.AB.isMembershipRemoving10MinWarningMessage),this.$cachedSelectors.membershipRegisterContainer.addClass("open")},onChangeEmailRegister:function(){s.trackEvent("unlocked","prime_mem_regular_email_error_change"),this.onCloseMembershipRegister(),Odigeo.trigger(this.widget.id+":scrollToEmail")},onCloseMembershipRegister:function(){Odigeo.UIElements.toggleWidgetsDialogs(this.widget.id,!1),this.$cachedSelectors.membershipRegisterContainer.removeClass("open"),this.model.set("isLoginPending",!1)},onCreateAccount:function(){this.clearErrors();var e=n.checkValidity(this.$el.find(this.slctrs.allInputs),this.$widget);_.isEmpty(e)?(this.setCallbackData(),this.enableLoadingButton(!0),this.options.recaptchaEnabled?a.gRecaptchaExecute(this.model.get("recaptchaWidgetID")):this.triggerRegisterRequest()):this.showPasswordError(e[0])},onLoggedUserConfirm:function(){s.trackEvent("unlocked","prime_mem_select_logged"),this.confirmMembership()},onLogin:function(e){this.onCloseMembershipRegister(),Odigeo.trigger(this.widget.id+":openLoginForm",e),this.model.set("isLoginPending",!0)},onLoginPopup:function(e){s.trackEvent("unlocked","prime_mem_regular_go_to_login"),this.onLogin(e)},onLoginPopupError:function(e){s.trackEvent("unlocked","prime_mem_regular_email_error_go_to_login"),this.onLogin(e)},onPasswordIconClick:function(){var e=this.$el.find(this.slctrs.membershipPassword);this.$el.find(this.slctrs.passwordViewerIcon).toggleClass("odf-hidden"),e.attr("type","password"===e.attr("type")?"text":"password")},onSelectTravellers:function(e){var t,i=e.target;"passengers0"!==i.value&&(t=$(i).parents(".membership_register_lightbox").length?"prime_mem_regular_change_pax":"prime_mem_logged_change_pax",s.trackEvent("unlocked",t))},openLightBox:function(e){e.isUserLogged?this.renderLoggedTemplate(e):this.renderRegisterTemplate(e),this.openMembershipRegister()},recaptchaCallback:function(){var e=a.gRecaptchaGetResponse(this.model.get("recaptchaWidgetID"));this.model.set("callbackData",_.extend(this.model.get("callbackData"),{recaptchaResponse:e})),this.triggerRegisterRequest()},registerSuccess:function(){s.trackEvent("unlocked","prime_mem_select_regular"),Odigeo.trigger(this.widget.id+":blockBuyerEmail",this.$el.find(this.slctrs.registerMail).val()),this.confirmMembership()},registerError:function(){s.trackEvent("unlocked","prime_mem_select_regular_FE_error"),s.trackEvent("unlocked","prime_mem_regular_email_error_appearances"),this.options.recaptchaEnabled&&a.gRecaptchaReset(this.model.get("recaptchaWidgetID")),this.$el.find(this.slctrs.registerMailDisclaimer).removeClass("odf-hidden"),this.$el.find(this.slctrs.emailWrapper).addClass("invalid"),this.enableLoadingButton(!1)},renderCaptcha:function(){this.model.set("recaptchaWidgetID",a.gRecaptchaRender("g_recaptcha_membership_register",_.bind(this.recaptchaCallback,this),this.options.recaptchaSiteKey))},setCallbackData:function(){this.model.set("callbackData",{email:this.$el.find(this.slctrs.registerMail).val(),password:this.$el.find(this.slctrs.membershipPassword).val(),acceptsNewsletter:!1})},showPasswordError:function(e){s.trackEvent("unlocked","prime_mem_select_regular_FE_error"),s.trackEvent("unlocked","prime_mem_regular_password_error_appearances"),this.clearPasswordErrors(),this.$el.find(this.slctrs.membershipPasswordContainer).addClass("invalid"),this.$el.find(this.slctrs.membershipPasswordError+'[data-error="'+e.key+'"]').removeClass("odf-hidden")},triggerRegisterRequest:function(){Odigeo.trigger(this.widget.id+":createAccount",this.model.get("callbackData"))},onTermsAndConditionsClick:function(){s.trackEvent("unlocked","unlocked_terms_and_conditions"+(this.model.get("isUserLoggedIn")?"_login":"")+"_nag")}})},function(e,t,i){"use strict";var n=i(323),a=i(0),s=i(51),r=i(94);Odigeo.defineWidget("bin_detection_manager",Odigeo.Widget.extend(r.extend({xhr:null,modelClass:Odigeo.Model.extend({requestData:null,dataURL:"",action:"",defaults:{creditCardResolved:!1,isPaste:!1},init:function(){_.extend(this.widget.options,{hiddenCards:["VB","E1","EA"]}),this.widget.options=Odigeo.parseOptions(this.widget.options),this.set("creditCardsDefaultMethod",{code:"",name:""}),this.set("creditCardBinDetailsCache",[]),this.on("change:creditCardBin",this.onCreditCardBinNumberChanged),this.on("change:creditCardsSelected",this.creditCardTypeChanged)},creditCardTypeChanged:function(){var e=this.get("creditCardsSelected"),t={concept:e.code,allPrice:e.fee,onePrice:e.fee,quantity:this.widget.options.numtravellers,type:"CC_FEE",method:e.method,creditCardResolved:this.get("creditCardResolved")};this.widget.addItemToPricemanagerCollection(t),Odigeo.trigger(this.widget.id+":creditCardTypeChanged",e.code,e.name,this.get("creditCardResolved"),this.get("showCCDropdown"))},onCreditCardBinNumberChanged:function(){var e=this.get("creditCardBinDetailsCache"),t=this.get("creditCardBin"),i=_.find(e,{creditCardBin:t});this.xhr&&this.xhr.abort(),_.isObject(i)?this.set("creditCardBinDetails",i):t&&(this.isEmptyData=!1,this.dataURL="getcreditcardbindetails",this.xhr=this.fetch(this.getRequest({creditCardBin:t})))},getRequest:function(e){return{type:"POST",data:JSON.stringify(e),timeout:11e3,contentType:"application/json",dataType:"json",cache:!1,success:_.bind(this.requestSuccessHandler,this),error:_.bind(this.requestErrorHandler,this)}},requestSuccessHandler:function(e,t){if(t.error)this.widget.view._creditCardNotDetected(t.error);else{var i=this.get("creditCardBinDetailsCache");i.push(t),e.set({creditCardBinDetails:t,creditCardBinDetailsCache:i})}this.xhr=null},requestErrorHandler:function(){this.xhr=null,this.widget.view._creditCardNotDetected("ERROR500_ONEFRONT_NOT_RESPONSE")},url:function(){return Odigeo.Settings.getProperty("serviceCollectionMethodFormatter")(this.dataURL)}}),viewClass:Odigeo.View.extend({templateSettings:{evaluate:/\{\{#([\s\S]+?)\}\}/g,interpolate:/\{\{[^#{]([\s\S]+?)[^}]\}\}/g,escape:/\{\{\{([\s\S]+?)\}\}\}/g},selectors:{binDetectionContainer:".bin_detection_container",ccFeePrice:".cc_fee_price",ccnumber:'input[name="ccnumber"]',binDetectionCcFeesListTemplate:".bin_detection_cc_fees_list_template",creditCardFeesBinDetection:"#creditCardFeesBinDetection",binDetectionCcFeesList:".bin_detection_cc_fees_list",ccCardType:'select[data-name="cardTypeSelector"]',ccTypeIcon:".cc_type_icon",ccNotDetected:".cc_not_detected",ccDetectedSelectedOk:".cc_detected_selected_ok",ccNumberNotAvailable:".cc_number_not_available",openCcList:".open_cc_list",cardLogos:".card_logos ul",clearInput:".clear_input",binDetectionNoCcFeesInfo:".bin_detection_no_cc_fees_info",ccFeePriceContainer:".cc_fee_price_container"},init:function(){this.listenTo(this.model,"change:creditCardBinDetails",this.onCreditCardBinDetailsChanged),this.listenTo(this.model,"change:creditCardsList",this.onCreditCardsFeesChanged),this.listenTo(this.model,"change:showCCDropdown",this.onShowCCDropdown),this.$cachedSelectors.clearInput.on(Odigeo.Events.tap,_.bind(this.widget.creditCardNumberChanged,this.widget,!1)),this.$cachedSelectors.cardLogos.on(Odigeo.Events.tap,_.bind(this.onTapOnCardLogos,this)),this.$cachedSelectors.ccnumber.on(Odigeo.Events.change,_.bind(this.widget.creditCardNumberChanged,this.widget,!1)),this.$cachedSelectors.ccCardType.on(Odigeo.Events.change,_.bind(this.creditCardSelectorTypeChanged,this))},onShowCCDropdown:function(){this.$cachedSelectors.ccNotDetected.toggleClass("odf-hidden",!this.model.get("showCCDropdown"))},onTapOnCardLogos:function(){this._trackEvent("credict_card_logo_click")},setCreditCardFormat:function(e){var t=this.model.get("creditCardsSelected"),i=e||t.code;i&&(n.setSelectedCreditCard(i),this.$cachedSelectors.ccnumber.trigger(Odigeo.Events.input).trigger(Odigeo.Events.keydown))},creditCardSelectorTypeChanged:function(){var e=this.$cachedSelectors.ccCardType.val(),t=""!==e,i=t&&e?this._getCcFromAvailableList(e):this.model.get("creditCardsDefaultMethod");t?(this._updateSelectedCcIconAndFee(i),this.$cachedSelectors.ccNotDetected.find(".paymentmanager_row").removeAttr("data-state")):(this._cleanFeeAndFlag(),this.$cachedSelectors.ccCardType.closest(".paymentmanager_row").attr("data-state","init")),this.model.set({creditCardResolved:t,creditCardsSelected:i}),this.setCreditCardFormat(),Odigeo.trigger(this.widget.id+":showPaymentMethodDisclaimer",{ccName:i.name,resolved:this.model.get("creditCardResolved")}),this.$cachedSelectors.ccDetectedSelectedOk.toggleClass("odf-hidden",!t),this.$cachedSelectors.ccCardType.toggleClass("ccNotSelected",!t)},_getCcFromAvailableList:function(e){var t=_.filter(this.model.get("creditCardsList"),{code:e});return _.isEmpty(t)?null:t.shift()},_updateSelectedCcIconAndFee:function(e){var t,i=parseFloat(e.fee);this.$cachedSelectors.ccTypeIcon.attr("data-card",e.code),this.$cachedSelectors.cardLogos.addClass("odf-hidden"),t=Odigeo.AB.isFreeFeeCharge&&0===i?this.widget.options.freeFee:(0<i?"+":"")+Odigeo.Utils.formatCurrency(i),this.$cachedSelectors.ccFeePrice.html(t).removeClass("odf-hidden")},_clearBinElements:function(){this.$cachedSelectors.ccDetectedSelectedOk.removeClass("odf-hidden"),this.model.set("showCCDropdown",!1),this._cleanFeeAndFlag()},_cleanFeeAndFlag:function(){this.$cachedSelectors.ccTypeIcon.attr("data-card",""),this.$cachedSelectors.cardLogos.removeClass("odf-hidden"),this.$cachedSelectors.ccFeePrice.html("").addClass("odf-hidden")},_fillSelectedCard:function(e){var t=this._getCcFromAvailableList(e),i=!1;null!==t&&this.$cachedSelectors.ccTypeIcon.attr("data-card")!==t.code?(this._clearBinElements(),this._updateSelectedCcIconAndFee(t),this._trackEvent("bin_card_type_OK"),i=!0):null===t&&(t=this.model.get("creditCardsDefaultMethod"),this._creditCardNotDetected("NOT_ACCEPTED")),this.model.set({creditCardsSelected:t,creditCardResolved:i}),Odigeo.trigger(this.widget.id+":showPaymentMethodDisclaimer",{ccName:t.name,resolved:i})},_getCcCode:function(e){var t,i=this.model.get("creditCardsList"),n=!!e&&e.creditCardTypeCodeList||[],a=s.trimCreditCardNumber(this.$cachedSelectors.ccnumber.val());return _.each(n,function(e){_.find(i,{code:e})&&_.isEmpty(t)&&(t=e)}),e&&!_.isEmpty(e.creditCardBinSubtypes)&&_.each(_.keys(e.creditCardBinSubtypes),function(i){0===a.indexOf(i)&&(t=e.creditCardBinSubtypes[i])}),t},onCreditCardBinDetailsChanged:function(){var e=this.model.get("creditCardBinDetails"),t=this._getCcCode(e),i=e&&!_.isEmpty(e.creditCardTypeCodeList)?i:"NOT_DETECTED";i=_.isUndefined(i)&&!t?"NOT_ACCEPTED":i,_.isUndefined(i)?(this._fillSelectedCard(t),this.setCreditCardFormat()):this.model.get("showCCDropdown")||(this._creditCardNotDetected(i),this.setCreditCardFormat("default"))},_creditCardNotDetected:function(e){var t=this.model.get("creditCardsSelected"),i={ERROR500:"bin_card_type_KO_error500",TIMEOUT:"bin_card_type_KO_timeout",NOT_DETECTED:"bin_card_type_KO_number_"+this.model.get("creditCardBin"),NOT_ACCEPTED:"bin_card_type_KO_acceptance",ERROR500_ONEFRONT_NOT_RESPONSE:"bin_card_type_KO_no_response"};this._clearBinElements(),this.$cachedSelectors.ccCardType.addClass("ccNotSelected"),this.model.set({showCCDropdown:!0,creditCardsSelected:t,creditCardResolved:!1}),Odigeo.trigger(this.widget.id+":showPaymentMethodDisclaimer",{ccName:t.name,resolved:!1}),this._trackEvent(i[e])},shallShowCcList:function(){var e=this.widget.options.hiddenCards;return _.filter(this.model.get("creditCardsList"),_.bind(function(t){return!_.includes(e,t.code)},this)).length<=e.length},_trackEvent:function(e){a.trackEvent("bin_upgrade_detection",e,Odigeo.History.getPageNameFromFragment())},_setCcFeesHint:function(e){var t,i=_.template(this.$cachedSelectors.binDetectionCcFeesListTemplate.html(),this.templateSettings),n=this.widget.options.showCCFeesDetails;this.$cachedSelectors.creditCardFeesBinDetection.html(i({ccList:e})),t=Odigeo.UIElements.hint.enhance(Odigeo.History.getPageNameFromFragment(),this.$cachedSelectors.binDetectionCcFeesList,{events:{tap:n},googleAnalyticsOnOpen:{type:"trackEvent",data:{page:Odigeo.History.getPageNameFromFragment(),action:"bin_upgrade_detection",label:"credit_card_fees_open"}},trigger:this.widget.id+":ccFeesHint"}),this.$cachedSelectors.binDetectionCcFeesList.removeClass("odf-hidden"),this.$cachedSelectors.openCcList.on(Odigeo.Events.tap,function(e){e.stopPropagation(),t.trigger("showHint")}),!_.some(e,function(e){return e.feeDecimal!==Odigeo.Utils.formatCurrency(0)})&&(this.$cachedSelectors.ccFeePriceContainer.addClass("odf-hidden"),this.$cachedSelectors.binDetectionCcFeesList.addClass("odf-hidden"))},onCreditCardsFeesChanged:function(){var e,t,i=(e=this.model.get("creditCardsList"),t=this.widget.options.freeFee,_.map(_.merge({},e),function(e){e.fee=parseFloat(e.fee);var i=(0<e.fee?"+":"")+Odigeo.Utils.formatCurrency(e.fee);return e.feeDecimal=i,e.fee=Odigeo.AB.isFreeFeeCharge&&0===e.fee?t:i,e})),n=$("<select/>"),a=this.shallShowCcList();this._setCcFeesHint(i),this.$cachedSelectors.ccCardType.find('option[value!=""]').remove(),_.each(i,_.bind(function(e){_.includes(this.widget.options.hiddenCards,e.code)&&!a||n.append($("<option/>").val(e.code).attr("class","ccType").html(e.name))},this)),this.$cachedSelectors.ccCardType.append(n.find("option")),this.$cachedSelectors.ccCardType.val("")}}),creditCardNumberChanged:_.debounce(function(e){var t,i=this.view.$cachedSelectors.ccnumber.val(),n=this.model.get("creditCardsDefaultMethod");this.model.set("isPaste",e),i=s.trimCreditCardNumber(i),/^[0-9]{10,19}$/.test(i)?(t=i.substring(0,10))!==this.model.get("creditCardBin")?this.model.set("creditCardBin",t):this.view.onCreditCardBinDetailsChanged():(""!==this.view.$cachedSelectors.ccTypeIcon.attr("data-card")||this.model.get("showCCDropdown"))&&(this.model.set({creditCardsSelected:n,creditCardResolved:!1}),Odigeo.trigger(this.id+":showPaymentMethodDisclaimer",{ccName:n.name,resolved:!1}),this.view._clearBinElements())},300),setCCFees:function(e){this.model.set("creditCardsList",e.cards),_.isObject(e.defaultCc)&&(this.model.set("creditCardsDefaultMethod",e.defaultCc),"CREDITCARD"===e.chosenMethod&&this.model.set("creditCardsSelected",e.defaultCc)),this.view.$cachedSelectors.ccnumber.val()&&this.creditCardNumberChanged(!1)},triggerInputEventOnCreditCardInput:function(){this.view.$cachedSelectors.ccnumber.trigger(Odigeo.Events.input)},getCcSelectedName:function(){var e=this.model.get("creditCardsSelected");""!==(e=e||this.model.get("creditCardsDefaultMethod")).code&&(Odigeo.trigger(this.id+":methodTypeChanged",e.name),this.model.set("creditCardsSelected",e))},isValid:function(){return!this.model.get("showCCDropdown")||!!this.view.$cachedSelectors.ccCardType.val()}})))},function(e,t,i){"use strict";Odigeo.defineWidget("post_booking",Odigeo.Widget.extend({viewClass:i(746),bookingNotFound:function(){this.view.showBookingNotFound()}}))},function(e,t,i){"use strict";var n=i(0);function a(e){e.removeClass("odf-hidden")}e.exports=Odigeo.View.extend({selectors:{waiting:".post_booking_waiting",bookingNotFound:".post_booking_booking_not_found",confirmationFailure:".post_booking_bags_confirmation_failure",phoneNumber:".post_booking_bags_confirmation_contact_phone_number",notFoundBack:".post_booking_booking_not_found_back",headerBack:".post_booking_bags_header_back"},events:{"tap @phoneNumber":"onTapPhoneNumber","tap @notFoundBack":"onTapNotFoundBack","tap @headerBack":"onTapNotFoundBack"},tmpls:{failureTemplate:".post_booking_bags_failure_template"},init:function(){this.tmpls=Odigeo.Utils.getTemplates(this.$el,this.tmpls)},showBookingNotFound:function(){this.renderFailureContent(),a(this.$cachedSelectors.bookingNotFound),a(this.$cachedSelectors.confirmationFailure),this.$cachedSelectors.waiting.addClass("odf-hidden"),n.trackEventWithCategory("post_booking","baggage_offline_no-possible","baggage_offline_no-possible_appearances")},onTapPhoneNumber:function(){n.trackEventWithCategory("post_booking","baggage_offline_no-available","baggage_offline_no-available_call")},onTapNotFoundBack:function(){Odigeo.Router.navigate("")},renderFailureContent:function(){var e=this.renderFailure();this.$el.find(this.selectors.confirmationFailure).html(e)},renderFailure:function(){return this.tmpls.failureTemplate()}})},function(e,t,i){"use strict";var n=i(0),a=i(148),s=i(748).getInstance(),r=i(562).getInstance(),o=Odigeo.Settings.getProperty("postBookingServiceUrlFormatter")("addBags"),c={CC_ERR:"purchasePaymentError",PAY_ERR:"purchasePaymentError",BAG_SEL_ERR:"purchaseError",VAL_ERR:"purchaseError",UPDATE_WNG:"purchaseOk",PROV_WNG:"purchaseOk"},d={INVALID_CARD_NUMBER:"cccard_number_submit_invalid_error",WRONG_CVV2:"cccard_cvv_submit_invalid_error",WRONG_CREDITCARD_EXPIRATION_DATE:"cccard_expiration_submit_invalid_errors",CARD_EXPIRED:"cccard_expiration_submit_invalid_errors",DATA_VALIDATION_ERROR:"cccard_owner_submit_invalid_error",UNKNOWN:"other"};e.exports={modelClass:i(563),init:function(){this.bindEvents()},bindEvents:function(){this.listenTo(s,"add",this.bagsCollectionChanged),this.listenTo(s,"remove",this.bagsCollectionChanged),this.view.listenTo(this.model,"change:phase",this.view.render)},bagsCollectionChanged:function(){var e=this.model.get("phase"),t=e;this.hasSelectedAnyBags()?e===this.model.phases.SHOPPING&&(t=this.model.phases.CHECKOUT):t=this.model.phases.SHOPPING,this.model.set("phase",t),e===t&&this.view.render()},clearBagSelections:function(){s.reset()},checkAvailableBags:function(e){var t=function(e){if(!_.has(e,"availableAncillariesOptionsDTO.collectionMethods")||_.isEmpty(_.filter(e.availableAncillariesOptionsDTO.collectionMethods,{collectionMethodType:"CREDITCARD"})))return!1;if(!_.has(e,"availableAncillariesOptionsDTO.ancillaryOptionsContainer.baggageResultsResponse")||_.isEmpty(e.availableAncillariesOptionsDTO.ancillaryOptionsContainer.baggageResultsResponse))return!1;var t=e.availableAncillariesOptionsDTO.ancillaryOptionsContainer.baggageResultsResponse,i=_.map(e.availableAncillariesOptionsDTO.travellers,function(e){return e.travellerType.toUpperCase()});return _.some(t,function(e){return!!_.includes(i,e.travellerType.toUpperCase())&&_.some(e.baggageConditions,function(e){return!_.isEmpty(e.selectableBaggage)})})}(e)?"bagsAvailable":"noBagsAvailable";Odigeo.trigger(this.id+":"+t,e)},showAddBags:function(e,t,i){this.model.loadInfo(e,t,i),this.model.set("phase",this.model.phases.SHOPPING)},showSuccess:function(){this.model.set("phase",this.model.phases.SUCCESS)},showPaymentFailure:function(){this.model.set("phase",this.model.phases.PAYMENT_FAILURE)},showFailure:function(){this.model.set("phase",this.model.phases.FAILURE)},open:function(){this.model.initialize(),this.view.isOpen=!0,this.view.open(),this.trackPage("add")},close:function(){this.view.isOpen=!1,this.view.close()},selectBag:function(e,t,i){var n=this.model.getTraveler(e).travellerType.toUpperCase(),a=this.model.getSelectableBag(n,t,i);s.removeBag(e,t),s.addBag(e,t,i,a)},removeBag:function(e,t){s.removeBag(e,t)},getTotalPrice:function(){return s.getTotalPrice()},getCurrencyConfig:function(){return s.getCurrencyConfig()},getTotalPieces:function(){return s.getTotalPieces()},getAverageFee:function(){return this.hasSelectedAnyBags()?Odigeo.Utils.formatCurrency(s.getAverageFee()):0},getPriceBreakdown:function(){return s.getPriceBreakdown()},hasSelectedAnyBags:function(){return s.hasSelectedAnyBags()},isPaymentMethodValid:function(){return this.model.get("paymentMethodValid")},isAcceptedCreditCardType:function(){var e=a.getCollectionMethods(this.model.get("ancillaryInfo")),t=this.model.get("creditCardTypeCode");return a.isAcceptedCreditCardType(e,t)},allowPurchase:function(){return this.isPaymentMethodValid()&&this.isAcceptedCreditCardType()},hasSelectedBagForSegment:function(e,t){return s.hasSelectedBagForSegment(e.travellerNumber,t)},getSelectedBagForSegment:function(e,t){return s.getSelectedBagForSegment(e.travellerNumber,t)},setCardData:function(e,t){this.model.set("paymentMethodValid",e),r.set("paymentDetails",t),this.view.render()},setCreditCardTypeCode:function(e,t){this.model.set({creditCardTypeCode:e,creditCardTypeName:t}),this.view.render()},trackNumBaggages:function(e){var t,i=this.getTotalPieces(),a=i+this.model.getAllIncludedBagsCount(),s=this.model.getItineraryInfo(),r="ONE_WAY"===s.tripType?"OW":"ROUND_TRIP"===s.tripType?"RT":"MD",o=this.model.baggageSelection,c=0;o&&(t=1<o.length?3:0===o[0].segmentIndex?1:2,c=o.map(function(e){return e.travelerIndex}),c=_.uniq(c)),n.trackEventWithCategory("post_booking","baggage_offline_add","num_baggages_"+e+":"+i+"_type:"+r+"_flig:"+t+"_pax:"+c.length+"_num:"+a)},purchaseBags:function(){var e=function(e){return{segmentId:e.segmentIndex,totalPrice:{amount:e.amount.toFixed(2),currencyCode:e.currencyCode},baggageFee:{amount:e.baggageFee.amount.toFixed(2),currencyCode:e.baggageFee.currencyCode},pieces:e.pieces,kilos:e.kilos}};this.trackNumBaggages("pay"),this.trackPage("payment");var t,i,n,a=(t=s,i=r.get("paymentDetails").creditCardDetails,n=_.groupBy(t.toJSON(),"travelerIndex"),{ancillarySelectionList:_.reduce(n,function(t,i,n){var a;return t.push((a=i,{travellerNumber:n,baggageSelectionList:_.map(a,e)})),t},[]),chargeBookingRequest:{amount:{amount:t.getTotalPrice().toFixed(2),currencyCode:t.getCurrencyCode()},collectionCurrency:t.getCurrencyCode(),collectionParameters:{creditCardCollectionParameters:{typeInfo:"creditCardCollectionParameters",typeCode:i.typeCode,owner:i.owner,number:i.number,expiryDate:i.expirationMonth+i.expirationYear,cvv2:i.securityNumber}}}});$.ajax({url:o+"/"+this.model.getBookingId()+"/"+this.model.getBuyerEmail(),type:"POST",data:JSON.stringify(a),dataType:"json",contentType:"application/json",success:_.bind(this.requestSuccessHandler,this),error:_.bind(this.requestErrorHandler,this),complete:_.bind(this.clearBagSelections,this)})},requestSuccessHandler:function(e){if(_.isEmpty(e.errors)){var t=e.addAncillariesResponseDTO;this.requestTracking(t),t.success?(n.trackEcommerce(e.analyticsEcommerce),this.trackPage("confirmation"),Odigeo.trigger(this.id+":purchaseOk","bags")):(this.trackPage("confirmation_error"),Odigeo.trigger(this.id+":"+(c[t.code]||"purchaseError"),"bags"))}else{var i=e.errors[0];this.trackPage("confirmation_error"),this.requestTracking(e),Odigeo.trigger(this.id+":purchaseError","bags",i.message)}},trackPage:function(e){n.trackPage("PB/bag/"+e,{funnel:!1})},requestTracking:function(e){var t="success_",i="OK",a=e.message;e.success||(t="PROV_WNG"===e.code||"UPDATE_WNG"===e.code?"success_":"fail_",i=(i="PAY_ERR"===e.code&&_.find(d,function(e,t){return _.contains(a,t)}))||("PROV_WNG"===e.code?"manual":"UPDATE_WNG"===e.code?"robot":"other")),n.trackEventWithCategory("post_booking","baggage_offline_add","baggage_offline_click_pay_"+t+i)},requestErrorHandler:function(e){this.trackPage("confirmation_error"),Odigeo.trigger(this.id+":purchaseError","bags",e)}}},function(e,t,i){"use strict";var n,a=Odigeo.Collection.extend({model:Odigeo.Model.extend({defaults:{pieces:0,kilos:0,amount:0,currencyCode:null,currencyConfig:null,travelerIndex:-1,segmentIndex:-1,bagIndex:-1}}),getBag:function(e){return this.findWhere(_.isUndefined(e)?{}:e)},getBags:function(e){return this.where(_.isUndefined(e)?{}:e)},getTotalPrice:function(){return this.reduce(function(e,t){return e+t.get("amount")},0)},getCurrencyCode:function(){return this.hasSelectedAnyBags()?this.first().get("currencyCode"):null},getCurrencyConfig:function(){return this.hasSelectedAnyBags()?this.first().get("currencyConfig"):null},getTotalPieces:function(){return this.reduce(function(e,t){return e+t.get("pieces")},0)},getAverageFee:function(){return this.reduce(function(e,t){return e+t.get("baggageFee").amount},0)/this.length},getPriceBreakdown:function(){return _.chain(this.toJSON()).groupBy(function(e){return[e.pieces,e.kilos,e.amount].join("-")}).map(function(e){var t=e.length,i=e[0].amount-e[0].baggageFee.amount,n=e[0].baggageFee.amount,a=e[0].amount;return{type:"BAG",quantity:t,pieces:e[0].pieces,kilos:e[0].kilos,price:i,fee:n,amount:a,totalPrice:t*i,totalFee:t*n,totalAmount:t*a,currencyCode:e[0].baggageFee.currencyCode}}).value()},hasSelectedAnyBags:function(){return 0<this.length},hasSelectedBagForSegment:function(e,t){return!!this.getBag({travelerIndex:e,segmentIndex:t})},getSelectedBagForSegment:function(e,t){var i=this.getBag({travelerIndex:e,segmentIndex:t});return i?i.toJSON():i},hasBag:function(e,t,i){return!!this.getBag({travelerIndex:e,segmentIndex:t,bagIndex:i})},addBag:function(e,t,i,n){this.add({travelerIndex:e,segmentIndex:t,bagIndex:i,pieces:n.pieces,kilos:n.kilos,amount:n.amount,currencyCode:n.currencyCode,currencyConfig:n.currencyConfig,baggageFee:n.baggageFee})},removeBag:function(e,t){this.remove(this.getBag({travelerIndex:e,segmentIndex:t}))}});e.exports.getInstance=function(){return _.isUndefined(n)&&(n=new a),n}},function(e,t,i){"use strict";var n=i(0);e.exports={translations:null,isOpen:!1,isPriceBreakdownOpen:!1,selectors:{widget:".post_booking_bags_widget",waiting:".post_booking_bags_waiting",content:".post_booking_bags_content",flightInfo:".post_booking_flight_info",info:".post_booking_bags_info",payment:".post_booking_bags_payment",purchase:".post_booking_bags_purchase",body:".post_booking_bags_body",headerTitle:".post_booking_bags_header_title",headerBack:".post_booking_bags_header_back",travelers:".post_booking_bags_travelers",checkout:".post_booking_bags_checkout",success:".post_booking_bags_confirmation_success",paymentFailure:".post_booking_bags_payment_failure",failure:".post_booking_bags_failure",footerBack:".post_booking_bags_footer_back",selectableBaggage:".post_booking_bags_selectable_baggage",selectBag:".post_booking_bags_select_bag",removeBag:".post_booking_bags_remove_bag",checkoutButton:".post_booking_bags_checkout_button",priceBreakdown:".post_booking_price_breakdown_toggle",purchaseButton:".post_booking_purchase_purchase_button",translations:".post_booking_bags_translations",phoneNumber:".post_booking_bags_confirmation_contact_phone_number",baggageFeeDisclaimerContainer:".post_booking_baggage_fee_disclaimer_container"},tmpls:{waitingTemplate:"#post_booking_bags_waiting_template",infoTemplate:"#post_booking_bags_info_template",flightSectionInfoTemplate:"#post_booking_flight_section_info_template",travelerTemplate:"#post_booking_bags_traveler_template",segmentTemplate:"#post_booking_bags_segment_template",airportTemplate:"#post_booking_bags_airport_template",includedBaggageTemplate:"#post_booking_bags_included_baggage_template",noSelectableBaggageTemplate:"#post_booking_bags_no_selectable_baggage_template",selectableBaggageTemplate:"#post_booking_bags_selectable_baggage_template",selectableBaggageOptionTemplate:"#post_booking_bags_selectable_baggage_option_template",baggageSelectedTemplate:"#post_booking_bags_baggage_selected_template",checkoutTemplate:"#post_booking_bags_checkout_template",priceBreakdownItemTemplate:"#post_booking_price_breakdown_item_template",priceBreakdownTemplate:"#post_booking_price_breakdown_template",purchaseTemplate:"#post_booking_bags_purchase_template"},events:{"tap @headerBack":"onTapBack","tap @footerBack":"onTapBack","change @selectBag":"onSelectBag","mousedown @selectBag":"onTabSelectBagButton","tap @removeBag":"onRemoveBag","tap @checkoutButton":"onCheckout","tap @priceBreakdown":"onPriceBreakdownToggle","tap @purchaseButton":"onPurchase","tap @phoneNumber":"onTapPhoneNumber"},init:function(){this.tmpls=Odigeo.Utils.getTemplates(this.$el,this.tmpls),this.translations=Odigeo.Utils.parseJson(this.$cachedSelectors.translations.html())},enhanceBaggageFeeHint:function(){this.$cachedSelectors.baggageFeeDisclaimerContainer.length&&Odigeo.UIElements.hint.enhance(Odigeo.History.getPageNameFromFragment(),this.$cachedSelectors.baggageFeeDisclaimerContainer,{ignorePageScroll:!0,events:{tap:!0}})},hide:function(e){e.addClass("odf-hidden")},show:function(e){e.removeClass("odf-hidden")},display:function(e,t){e.toggleClass("odf-hidden",!t)},scrollToTop:function(){Odigeo.Utils.scrollToElement($("body"),{container:this.selectors.body,animation:!1})},getFlightType:function(e,t,i){var n,a=this.translations.flightTypes;switch(e){case"ONE_WAY":n=a.oneWay;break;case"ROUND_TRIP":n=0===i?a.roundTrip.outbound:a.roundTrip.inbound;break;case"MULTI_SEGMENT":n=a.multiSegment[i]}return n},getBagsTranslation:function(e,t,i){var n,a=this.translations;return n=0<t?i?a.bagsExtraPiecesWithKilos:a.bagsPiecesWithKilos:i?a.bagsExtraPieces:a.bagsPieces,Odigeo.Utils.pluralizeAll(n,e,t)},renderWaiting:function(e){return this.tmpls.waitingTemplate(e)},renderInfo:function(e){return this.tmpls.infoTemplate(e)},renderFlightInfo:function(e){return _.reduce(e,function(e,t,i){return e+this.renderFlightSectionInfo(t,i)},"",this)},renderFlightSectionInfo:function(e,t){var i=e.sections,n=i[0].section,a=i[i.length-1].section,s=n.from.cityIataCode,r=a.to.cityIataCode,o=n.from.cityName,c=a.to.cityName,d=Odigeo.Utils.formatDate(n.departureDate,"ddd, d mmm"),l=Odigeo.Utils.formatDate(n.departureDate,"ddd, d mmm yyyy"),g=0===t?"right":"left";return this.tmpls.flightSectionInfoTemplate({direction:g,fromIata:s,toIata:r,from:o,to:c,date:d,dateLong:l})},renderTravelers:function(e,t,i){return _.reduce(e,function(e,n){return e+this.renderTraveler(n,t,i)},"",this)},renderTraveler:function(e,t,i){var n=[e.name,e.middleName,e.firstLastName,e.secondLastName].join(" "),a=_.capitalize(e.travellerType.toLowerCase()),s=this.renderSegments(e,t,i);return this.tmpls.travelerTemplate({travelerName:n,travelerType:a,segments:s})},renderSegments:function(e,t,i){return _.reduce(t,function(t,n,a){return t+this.renderSegment(n,a,e,i)},"",this)},renderSegment:function(e,t,i,n){var a=e.sections,s=a[0].section,r=a[a.length-1].section,o=s.carrier.code,c=this.getFlightType(n.tripType,n.type,t),d=this.renderAirport(c,s,r),l=this.renderIncludedBaggage(i,t),g=this.renderSelectableBaggage(i,t);return this.tmpls.segmentTemplate({travelerIndex:i.travellerNumber,segmentIndex:t,carrierCode:o,airports:d,includedBaggage:l,selectableBaggage:g})},renderAirport:function(e,t,i){var n=t.from.cityIataCode,a=i.to.cityIataCode,s=t.from.cityName,r=i.to.cityName;return this.tmpls.airportTemplate({flightType:e,fromIata:n,toIata:a,from:s,to:r})},bagsInfo:function(e,t){var i=Odigeo.Utils.pluralizeAll,n=e.travellerType.toUpperCase(),a=this.model.hasIncludedBags(n,t),s=this.model.getIncludedBags(n,t),r=this.model.hasPaidBagsForSegment(e,t),o=this.model.getPaidBagsForSegment(e,t),c=this.widget.hasSelectedBagForSegment(e,t),d=this.widget.getSelectedBagForSegment(e,t),l={hasIncludedBags:!1,hasPaidBags:!1,hasSelectedBags:!1,hasBags:!1,includedPieces:0,paidPieces:0,selectedPieces:0,pieces:0,amount:0,bagsText:this.translations.bagsNone,extraBagsText:this.translations.bagsNotAvailable};return"INFANT"===n||(a&&(l.hasIncludedBags=!0,l.includedPieces=s.pieces,l.pieces+=s.pieces),r&&(l.hasPaidBags=!0,l.paidPieces=o.pieces,l.pieces+=o.pieces),c&&(l.hasSelectedBags=!0,l.selectedPieces=d.pieces),(a||r)&&(l.hasBags=!0,0<s.kilos&&0<o.kilos&&s.kilos===o.kilos?l.bagsText=i(this.translations.bagsPiecesWithKilos,l.pieces,s.kilos):0<s.kilos?l.bagsText=i(this.translations.bagsPiecesWithKilos,l.pieces,s.kilos):0<o.kilos?l.bagsText=i(this.translations.bagsPiecesWithKilos,l.pieces,o.kilos):l.bagsText=i(this.translations.bagsPieces,l.pieces)),l.amount=Odigeo.Utils.formatCurrency(l.amount)),l},renderIncludedBaggage:function(e,t){var i=this.bagsInfo(e,t);return this.tmpls.includedBaggageTemplate(i)},renderSelectableBaggage:function(e,t){var i,n;return this.model.hasPaidBagsForSegment(e,t)?this.renderNoSelectableBags():(i=e.travellerType.toUpperCase(),n=this.widget.getSelectedBagForSegment(e,t),this.widget.hasSelectedBagForSegment(e,t)?this.renderSelectedBagsForSegment(e,t,n):this.model.hasSelectableBagsForSegment(i,t)?this.renderBaggageDropdown(i,t,e.travellerNumber,n):this.renderNoSelectableBags())},renderNoSelectableBags:function(){return this.tmpls.noSelectableBaggageTemplate()},renderBaggageDropdown:function(e,t,i,n){var a=this.model.hasIncludedBags(e,t),s=this.renderSelectableBaggageOptions(e,t,i,a,n),r=a?this.translations.dropdownNoExtraBags:this.translations.dropdownNoBags;return this.tmpls.selectableBaggageTemplate({travelerIndex:i,segmentIndex:t,options:s,noBagsText:r})},renderSelectableBaggageOptions:function(e,t,i,n,a){var s=this.model.getSelectableBagsForSegment(e,t);return _.reduce(s,function(e,s,r){return e+this.renderSelectableBaggageOption(s,i,t,r,n,a)},"",this)},renderSelectableBaggageOption:function(e,t,i,n,a,s){var r=this.getBagsTranslation(e.pieces,e.kilos,a),o=Odigeo.Utils.formatCurrency(e.amount,e.currencyConfig),c=_.isUndefined(s)||s.bagIndex!==n?"":"selected";return this.tmpls.selectableBaggageOptionTemplate({travelerIndex:t,segmentIndex:i,bagIndex:n,label:r,amount:o,isSelected:c})},renderCheckout:function(){n.trackEventWithCategory("post_booking","baggage_offline_add","baggage_offline_add_appearances");var e=Odigeo.Utils.formatCurrency(this.widget.getTotalPrice(),this.widget.getCurrencyConfig()),t=this.getBagsTranslation(this.widget.getTotalPieces(),-1,!1),i=0<this.widget.getTotalPieces(),a=this.widget.hasSelectedAnyBags(),s=this.widget.getAverageFee(),r=this.widget.hasSelectedAnyBags()&&0!==s;return this.tmpls.checkoutTemplate({totalPrice:e,totalPieces:t,showTotalPieces:i,enableCheckout:a,showBaggageFee:r,baggageFee:s,baggageFeeDisclaimerText:this.translations.baggageFeeDisclaimer})},renderPriceBreakdownItems:function(){var e=this.widget.getPriceBreakdown(),t=this.widget.getCurrencyConfig();return _.chain(e).map(function(e){return _.extend(e,{item:this.getBagsTranslation(e.pieces,e.kilos,!0),price:Odigeo.Utils.formatCurrency(e.price,t),fee:Odigeo.Utils.formatCurrency(e.fee,t),amount:Odigeo.Utils.formatCurrency(e.amount,t),totalPrice:Odigeo.Utils.formatCurrency(e.totalPrice,t),totalFee:Odigeo.Utils.formatCurrency(e.totalFee,t),totalAmount:Odigeo.Utils.formatCurrency(e.totalAmount,t)})},this).map(this.tmpls.priceBreakdownItemTemplate).value().join("")},renderPriceBreakdown:function(){var e=Odigeo.Utils.formatCurrency(this.widget.getTotalPrice(),this.widget.getCurrencyConfig()),t=this.getBagsTranslation(this.widget.getTotalPieces(),-1,!1),i=this.renderPriceBreakdownItems();return this.tmpls.priceBreakdownTemplate({priceBreakdownItems:i,totalPieces:t,totalPrice:e})},renderPurchase:function(){var e=Odigeo.Utils.formatCurrency(this.widget.getTotalPrice(),this.widget.getCurrencyConfig()),t=this.widget.allowPurchase(),i="",n="";return this.model.get("creditCardTypeName")&&(n=Odigeo.Utils.replaceCmsKeyArgs(this.translations.cardType,this.model.get("creditCardTypeName"))),this.isPriceBreakdownOpen&&(i=this.renderPriceBreakdown()),this.tmpls.purchaseTemplate({totalPrice:e,enablePurchase:t,priceBreakdown:i,isPriceBreakdownOpen:this.isPriceBreakdownOpen,cardType:n})},widgetInfo:function(){var e,t,i,n=this.model.get("phase"),a=n===this.model.phases.LOADING,s=n===this.model.phases.SHOPPING,r=n===this.model.phases.CHECKOUT,o=n===this.model.phases.PAYMENT,c=n===this.model.phases.BUYING,d=n===this.model.phases.SUCCESS,l=n===this.model.phases.FAILURE,g=n===this.model.phases.PAYMENT_FAILURE,h=this.model.showFlightInfo(),u=o,p=!d&&!g&&!l,f=l||g,m="",_="",b="",y="",v="";return this.model.hasInfo()&&(e=this.model.getTravelers(),t=this.model.getSegmentsInfo(),i=this.model.getItineraryInfo(),!h||d||l||g||(_=this.renderFlightInfo(t)),d||l||g||(b=this.renderTravelers(e,t,i))),(s||r)&&(y=this.renderCheckout()),o&&(v=this.renderPurchase()),a&&(m=this.translations.loadingWaitingMessage),c&&(m=this.translations.buyingWaitingMessage),{showWaiting:a||c,waitingMessage:m,isSuccess:d,isFailure:l,isPaymentFailure:g,showHeaderTitle:p,showFlightInfo:h,showPayment:u,flightInfo:_,travelers:b,checkout:y,purchase:v,showFooterBackLink:f,hasCheckout:s||r}},render:function(){if(this.isOpen){var e=this.widgetInfo();this.$cachedSelectors.waiting.html(this.renderWaiting(e)),this.display(this.$cachedSelectors.waiting,e.showWaiting),this.$cachedSelectors.info.html(this.renderInfo(e)),this.display(this.$cachedSelectors.payment,e.showPayment),this.$cachedSelectors.purchase.html(e.purchase),this.display(this.$cachedSelectors.content,!e.showWaiting),this.display(this.$cachedSelectors.success,e.isSuccess),this.display(this.$cachedSelectors.failure,e.isFailure),this.display(this.$cachedSelectors.paymentFailure,e.isPaymentFailure),this.afterRenderContent(e),this.updateDomSelectorsToCache(),e.hasCheckout&&this.enhanceBaggageFeeHint()}},removeContent:function(){this.beforeRemoveContent()},open:function(){this.render(),this.scrollToTop()},close:function(){this.removeContent(),this.scrollToTop()},onTapBack:function(){var e,t="no-possible";this.model.get("phase")!==this.model.phases.FAILURE&&(t="add"),this.model.get("baggageAdded")&&(e="add",t="added"),n.trackEventWithCategory("post_booking","baggage_offline_"+(e||t),"baggage_offline_"+t+"_close"),this.model.set("baggageAdded",!1),Odigeo.trigger(this.widget.id+":closeAddBags")},onTapPhoneNumber:function(){n.trackEventWithCategory("post_booking","baggage_offline_no-possible","baggage_offline_no-possible_call")},onTabSelectBagButton:function(e){var t=$(e.currentTarget).find("option:selected").data(),i=t.travelerIndex||$(e.currentTarget).data("travelerIndex"),a=t.bagIndex,s=_.isNumber(a)?"edit":"add";n.trackEventWithCategory("post_booking","baggage_offline_add","click_"+s+"_baggage_offline_"+i)},onSelectBag:function(e){var t=$(e.currentTarget).find("option:selected").data(),i=t.travelerIndex,a=t.segmentIndex,s=t.bagIndex,r=this.model.getBookingId(),o=this.model.getTraveler(i),c=this.model.getSelectableBag(o.travellerType,a,s).pieces||0,d=0===a?"Departure":"Return",l=_.isNumber(s)?"1":"0";_.isNumber(s)?(null===this.model.baggageSelection?this.model.baggageSelection=[{segmentIndex:a,travelerIndex:o.travellerNumber}]:this.model.baggageSelection.push({segmentIndex:a,travelerIndex:o.travellerNumber}),this.widget.selectBag(i,a,s)):_.isUndefined(i)||_.isUndefined(a)?(this.model.baggageSelection=null,this.render()):(_.remove(this.model.baggageSelection,{segmentIndex:a,travelerIndex:i}),this.widget.removeBag(i,a)),n.trackEventWithCategory("post_booking","baggage_offline_add","added_baggage_offline_"+d+"_"+l+"_"+c+"_"+r)},onRemoveBag:function(e){var t=$(e.currentTarget).data(),i=t.travelerIndex,a=t.segmentIndex;this.widget.removeBag(i,a),n.trackEventWithCategory("post_booking","baggage_offline_add","click_remove_baggage_offline_"+i)},onCheckout:function(){Odigeo.AB.isPostBookingBagsPayment?this.widget.hasSelectedAnyBags()&&(this.trackingCheckout("success",""),this.model.set("phase",this.model.phases.PAYMENT)):(this.trackingCheckout("fail","_no-possible"),this.model.set("phase",this.model.phases.FAILURE))},onPriceBreakdownToggle:function(){this.isPriceBreakdownOpen=!this.isPriceBreakdownOpen,this.render()},onPurchase:function(){this.widget.allowPurchase()&&(this.model.set("phase",this.model.phases.BUYING),this.widget.purchaseBags())},trackingCheckout:function(e,t){n.trackEventWithCategory("post_booking","baggage_offline_add","baggage_offline_added_"+e+t),this.widget.trackNumBaggages("continue"),n.trackEventWithCategory("post_booking","baggage_offline_add","baggage_offline_click_continue_"+e+t),this.model.set("baggageAdded",!0)}}},function(e,t,i){"use strict";var n=i(0),a=i(148),s=i(101).getInstance(),r=i(562).getInstance(),o=Odigeo.Settings.getProperty("postBookingServiceUrlFormatter")("addSeats"),c={CC_ERR:"purchasePaymentError",PAY_ERR:"purchasePaymentError",SEAT_SEL_ERR:"purchaseError",VAL_ERR:"purchaseError",UPDATE_WNG:"purchaseOk",PROV_WNG:"purchaseOk"},d={INVALID_CARD_NUMBER:"cccard_number_submit_invalid_error",WRONG_CVV2:"cccard_cvv_submit_invalid_error",WRONG_CREDITCARD_EXPIRATION_DATE:"cccard_expiration_submit_invalid_errors",CARD_EXPIRED:"cccard_expiration_submit_invalid_errors",DATA_VALIDATION_ERROR:"cccard_owner_submit_invalid_error",UNKNOWN:"other"};e.exports={modelClass:i(563),init:function(){this.bindEvents()},bindEvents:function(){this.listenTo(s,"add",this.seatsCollectionChanged),this.listenTo(s,"remove",this.seatsCollectionChanged),this.view.listenTo(this.model,"change:phase",this.view.render)},seatsCollectionChanged:function(){var e=this.model.get("phase"),t=e;this.hasSelectedAnySeat()?e===this.model.phases.SHOPPING&&(t=this.model.phases.CHECKOUT):t=this.model.phases.SHOPPING,this.model.set("phase",t),e===t&&this.view.render()},clearSeatSelections:function(){s.reset()},checkAvailableSeats:function(e){var t=function(e){if(!_.has(e,"availableAncillariesOptionsDTO.collectionMethods")||_.isEmpty(_.filter(e.availableAncillariesOptionsDTO.collectionMethods,{collectionMethodType:"CREDITCARD"})))return!1;if(!_.has(e,"availableAncillariesOptionsDTO.ancillaryOptionsContainer.seatMapResultsResponse")||_.isEmpty(e.availableAncillariesOptionsDTO.ancillaryOptionsContainer.seatMapResultsResponse))return!1;var t=e.availableAncillariesOptionsDTO.ancillaryOptionsContainer.seatMapResultsResponse;return _.some(t,function(e){return _.some(e.seatMapPreferencesDescriptorItemList,function(e){return!_.isEmpty(e.cabin)&&_.some(e.cabin,function(e){return!_.isEmpty(e.seats)})})})}(e)?"seatsAvailable":"noSeatsAvailable";Odigeo.trigger(this.id+":"+t,e)},showAddSeats:function(e,t,i){this.model.loadInfo(e,t,i),this.model.set("phase",this.model.phases.SHOPPING)},changePhase:function(e){this.model.set("phase",_.get(this.model.phases,e,"FAILURE"))},scrollTop:function(){this.view.scrollToTop()},showSuccess:function(){this.model.set("phase",this.model.phases.SUCCESS)},showPaymentFailure:function(){this.model.set("phase",this.model.phases.PAYMENT_FAILURE)},showFailure:function(){this.model.set("phase",this.model.phases.FAILURE)},open:function(){this.model.initialize(),this.view.isOpen=!0,this.view.open()},close:function(){this.view.isOpen=!1,this.view.close()},getTotalPrice:function(){return s.getTotalPrice()},getCurrencyConfig:function(){return Odigeo.Utils.Currency},getTotalSeats:function(){return _.size(s)},getPriceBreakdown:function(){return s.getPriceBreakdown()},hasSelectedAnySeat:function(){return s.hasSelectedAnySeat()},isPaymentMethodValid:function(){return this.model.get("paymentMethodValid")},isAcceptedCreditCardType:function(){var e=a.getCollectionMethods(this.model.get("ancillaryInfo")),t=this.model.get("creditCardTypeCode");return a.isAcceptedCreditCardType(e,t)},allowPurchase:function(){return this.isPaymentMethodValid()&&this.isAcceptedCreditCardType()},setCardData:function(e,t){this.model.set("paymentMethodValid",e),r.set("paymentDetails",t),this.view.render()},setCreditCardTypeCode:function(e,t){this.model.set({creditCardTypeCode:e,creditCardTypeName:t}),this.view.render()},purchaseSeats:function(){var e,t,i,n=function(e){var t=e.totalPrice-e.providerPrice;return{seatMapRow:e.seatMapRow,column:e.columnSelection,row:e.rowSelection,floor:e.floorSelection,section:e.section,totalPrice:{amount:e.totalPrice.toFixed(2),currencyCode:e.currencyCode},seatFee:{amount:t.toFixed(2),currencyCode:e.currencyCode}}},a=(e=s,t=r.get("paymentDetails").creditCardDetails,i=_.groupBy(e.toJSON(),"numPassenger"),{ancillarySelectionList:_.reduce(i,function(e,t,i){var a;return e.push((a=t,{travellerNumber:i,seatMapSelectionList:_.map(a,n)})),e},[]),chargeBookingRequest:{amount:{amount:e.getTotalPrice().toFixed(2),currencyCode:e.getCurrencyCode()},collectionCurrency:e.getCurrencyCode(),collectionParameters:{creditCardCollectionParameters:{typeInfo:"creditCardCollectionParameters",typeCode:t.typeCode,owner:t.owner,number:t.number,expiryDate:t.expirationMonth+t.expirationYear,cvv2:t.securityNumber}}}});$.ajax({url:o+"/"+this.model.getBookingId(),type:"POST",data:JSON.stringify(a),dataType:"json",contentType:"application/json",success:_.bind(this.requestSuccessHandler,this),error:_.bind(this.requestErrorHandler,this),complete:_.bind(this.clearSeatSelections,this)})},requestSuccessHandler:function(e){if(_.isEmpty(e.errors)){var t=e.addAncillariesResponseDTO;this.requestTracking(t),t.success?Odigeo.trigger(this.id+":purchaseOk","seats"):Odigeo.trigger(this.id+":"+(c[t.code]||"purchaseError"),"seats")}else{var i=e.errors[0];this.requestTracking(e),Odigeo.trigger(this.id+":purchaseError","seats",i.message)}},requestTracking:function(e){var t="success_",i="OK",a=e.message;e.success||(t="PROV_WNG"===e.code||"UPDATE_WNG"===e.code?"success_":"fail_",i=(i="PAY_ERR"===e.code&&_.find(d,function(e,t){return _.contains(a,t)}))||("PROV_WNG"===e.code?"manual":"UPDATE_WNG"===e.code?"robot":"other")),n.trackEventWithCategory("post_booking","seats_offline_add","seats_offline_click_pay_"+t+i)},requestErrorHandler:function(e){Odigeo.trigger(this.id+":purchaseError","seats",e)}}},function(e,t,i){"use strict";var n=i(0);e.exports={translations:null,isOpen:!1,isPriceBreakdownOpen:!1,selectors:{widget:".post_booking_seats_widget",waiting:".post_booking_seats_waiting",content:".post_booking_seats_content",flightInfo:".post_booking_flight_info",seatMap:".post_booking_seats_seatmap",info:".post_booking_seats_info",payment:".post_booking_seats_payment",purchase:".post_booking_seats_purchase",body:".post_booking_seats_body",headerTitle:".post_booking_seats_header_title",headerBack:".post_booking_seats_header_back",checkout:".post_booking_seats_checkout",success:".post_booking_seats_confirmation_success",paymentFailure:".post_booking_seats_payment_failure",failure:".post_booking_seats_failure",footerBack:".post_booking_seats_footer_back",checkoutButton:".post_booking_seats_checkout_button",priceBreakdown:".post_booking_price_breakdown_toggle",purchaseButton:".post_booking_purchase_purchase_button",translations:".post_booking_seats_translations",phoneNumber:".post_booking_seats_confirmation_contact_phone_number"},tmpls:{waitingTemplate:"#post_booking_seats_waiting_template",infoTemplate:"#post_booking_seats_info_template",flightSectionInfoTemplate:"#post_booking_flight_section_info_template",checkoutTemplate:"#post_booking_seats_checkout_template",priceBreakdownItemTemplate:"#post_booking_price_breakdown_item_template",priceBreakdownTemplate:"#post_booking_price_breakdown_template",purchaseTemplate:"#post_booking_seats_purchase_template"},events:{"tap @headerBack":"onTapBack","tap @footerBack":"onTapBack","tap @checkoutButton":"onCheckout","tap @priceBreakdown":"onPriceBreakdownToggle","tap @purchaseButton":"onPurchase","tap @phoneNumber":"onTapPhoneNumber"},init:function(){this.tmpls=Odigeo.Utils.getTemplates(this.$el,this.tmpls),this.translations=Odigeo.Utils.parseJson(this.$cachedSelectors.translations.html())},hide:function(e){e.addClass("odf-hidden")},show:function(e){e.removeClass("odf-hidden")},display:function(e,t){e.toggleClass("odf-hidden",!t)},scrollToTop:function(){"desktop"===Odigeo.SessionScope.flow?this.$cachedSelectors.widget.animate({scrollTop:0},300):Odigeo.Utils.scrollToElement($("body"),{container:this.selectors.body,animation:!1})},getFlightType:function(e,t,i){var n,a=this.translations.flightTypes;switch(e){case"ONE_WAY":n=a.oneWay;break;case"ROUND_TRIP":n="SIMPLE"===t?a.roundTrip.roundTrip:0===i?a.roundTrip.outbound:a.roundTrip.inbound;break;case"MULTI_SEGMENT":n=a.multiSegment[i]}return n},getSeatsTranslation:function(){return this.translations.seats},renderWaiting:function(e){return this.tmpls.waitingTemplate(e)},renderInfo:function(e){return this.tmpls.infoTemplate(e)},renderFlightInfo:function(e){return _.reduce(e,function(e,t,i){return e+this.renderFlightSectionInfo(t,i)},"",this)},renderFlightSectionInfo:function(e,t){var i=e.sections,n=i[0].section,a=i[i.length-1].section,s=n.from.cityIataCode,r=a.to.cityIataCode,o=n.from.cityName,c=a.to.cityName,d=Odigeo.Utils.formatDate(n.departureDate,"ddd, d mmm"),l=Odigeo.Utils.formatDate(n.departureDate,"ddd, d mmm yyyy"),g=0===t?"right":"left";return this.tmpls.flightSectionInfoTemplate({direction:g,fromIata:s,toIata:r,from:o,to:c,date:d,dateLong:l})},renderCheckout:function(){n.trackEventWithCategory("post_booking","seats_offline_add","seats_offline_add_appearances");var e=Odigeo.Utils.formatCurrency(this.widget.getTotalPrice(),this.widget.getCurrencyConfig()),t=this.getSeatsTranslation(this.widget.getTotalSeats(),-1,!1),i=0<this.widget.getTotalSeats(),a=this.widget.hasSelectedAnySeat(),s="";return this.isPriceBreakdownOpen&&(s=this.renderPriceBreakdown()),this.tmpls.checkoutTemplate({totalPrice:e,totalPieces:t,showTotalPieces:i,priceBreakdown:s,isPriceBreakdownOpen:this.isPriceBreakdownOpen,enableCheckout:a})},renderPriceBreakdownItems:function(){var e=this.widget.getPriceBreakdown(),t=this.widget.getCurrencyConfig();return _.chain(e).map(function(e){return _.extend(e,{item:this.getSeatsTranslation(),totalAmount:Odigeo.Utils.formatCurrency(e.totalAmount,t)})},this).map(this.tmpls.priceBreakdownItemTemplate).value().join("")},renderPriceBreakdown:function(){var e=Odigeo.Utils.formatCurrency(this.widget.getTotalPrice(),this.widget.getCurrencyConfig()),t=this.getSeatsTranslation(this.widget.getTotalSeats(),-1,!1),i=this.renderPriceBreakdownItems();return this.tmpls.priceBreakdownTemplate({priceBreakdownItems:i,totalPieces:t,totalPrice:e,isSeatMap:!0})},renderPurchase:function(){var e=Odigeo.Utils.formatCurrency(this.widget.getTotalPrice(),this.widget.getCurrencyConfig()),t=this.widget.allowPurchase(),i="",n="";return this.model.get("creditCardTypeName")&&(n=Odigeo.Utils.replaceCmsKeyArgs(this.translations.cardType,this.model.get("creditCardTypeName"))),this.isPriceBreakdownOpen&&(i=this.renderPriceBreakdown()),this.tmpls.purchaseTemplate({totalPrice:e,enablePurchase:t,priceBreakdown:i,isPriceBreakdownOpen:this.isPriceBreakdownOpen,cardType:n})},widgetInfo:function(){var e,t=this.model.get("phase"),i=t===this.model.phases.LOADING,n=t===this.model.phases.SHOPPING,a=t===this.model.phases.CHECKOUT,s=t===this.model.phases.PAYMENT,r=t===this.model.phases.BUYING,o=t===this.model.phases.SUCCESS,c=t===this.model.phases.FAILURE,d=t===this.model.phases.PAYMENT_FAILURE,l=this.model.showFlightInfo(),g=s,h=!o&&!d&&!c,u=c||d||o,p="",f="",m="",_="";return this.model.hasInfo()&&(e=this.model.getSegmentsInfo(),!l||o||c||d||(f=this.renderFlightInfo(e))),(n||a)&&(m=this.renderCheckout()),s&&(_=this.renderPurchase()),i&&(p=this.translations.loadingWaitingMessage),r&&(p=this.translations.buyingWaitingMessage),{showWaiting:i||r,waitingMessage:p,showSeatMap:!(o||c),isSuccess:o,isFailure:c,isPaymentFailure:d,showHeaderTitle:h,showFlightInfo:l,showPayment:g,flightInfo:f,checkout:m,purchase:_,showFooterBackLink:u}},render:function(){if(this.isOpen){var e=this.widgetInfo();this.$cachedSelectors.waiting.html(this.renderWaiting(e)),this.display(this.$cachedSelectors.waiting,e.showWaiting),this.$cachedSelectors.info.html(this.renderInfo(e)),this.display(this.$cachedSelectors.seatMap,e.showSeatMap),this.display(this.$cachedSelectors.payment,e.showPayment),this.$cachedSelectors.purchase.html(e.purchase),this.display(this.$cachedSelectors.content,!e.showWaiting),this.display(this.$cachedSelectors.success,e.isSuccess),this.display(this.$cachedSelectors.failure,e.isFailure),this.display(this.$cachedSelectors.paymentFailure,e.isPaymentFailure),this.afterRenderContent(e),this.updateDomSelectorsToCache()}},removeContent:function(){this.beforeRemoveContent()},open:function(){this.render(),this.scrollToTop()},close:function(){this.removeContent(),this.scrollToTop()},onTapBack:function(){var e,t="no-possible";this.model.get("phase")!==this.model.phases.FAILURE&&(t="add"),this.model.get("seatAdded")&&(e="add",t="added"),n.trackEventWithCategory("post_booking","seats_offline_"+(e||t),"seats_offline_"+t+"_close"),this.model.set("seatAdded",!1),Odigeo.trigger(this.widget.id+":closeAddSeats")},onTapPhoneNumber:function(){n.trackEventWithCategory("post_booking","seats_offline_no-possible","seats_offline_no-possible_call")},onCheckout:function(){Odigeo.AB.isPostBookingBagsPayment?this.widget.hasSelectedAnySeat()&&(Odigeo.trigger(this.widget.id+":closeAircraftMap"),this.model.set("phase",this.model.phases.PAYMENT)):this.model.set("phase",this.model.phases.FAILURE)},onPriceBreakdownToggle:function(){this.isPriceBreakdownOpen=!this.isPriceBreakdownOpen,this.render()},onPurchase:function(){this.widget.allowPurchase()&&(this.model.set("phase",this.model.phases.BUYING),this.widget.purchaseSeats())}}},function(e,t,i){"use strict";var n=i(323),a=i(51),s=i(333);Odigeo.defineWidget("post_booking_bin_detection",Odigeo.Widget.extend({xhr:null,modelClass:Odigeo.Model.extend({dataURL:"getcreditcardbindetails",defaults:{creditCardBinCache:[],creditCardNumber:"",creditCardType:"",creditCardTypeCode:"",creditCardBin:""},init:function(){_.extend(this.widget.options,{hiddenCards:["VB","E1","EA"]}),this.widget.options=Odigeo.parseOptions(this.widget.options),this.on("change:creditCardNumber",this.onCreditCardNumberChange),this.on("change:creditCardBin",this.onCreditCardBinChange)},getCreditCardTypeCode:function(e){return e.creditCardTypeCodeList[0]},onCreditCardNumberChange:function(){var e=this.get("creditCardNumber"),t=e.substring(0,10);/^[0-9]{10,19}$/.test(e)?t!==this.get("creditCardBin")&&this.set("creditCardBin",t):this.set({creditCardType:"",creditCardTypeCode:"",creditCardBin:""})},onCreditCardBinChange:function(){var e=this.get("creditCardBin"),t=this.get("creditCardBinCache"),i=_.find(t,{creditCardBin:e});this.xhr&&this.xhr.abort(),_.isObject(i)?this.set({creditCardTypeCode:this.getCreditCardTypeCode(i)}):e&&(this.xhr=this.fetch(this.getRequest({creditCardBin:e})))},getRequest:function(e){return{type:"POST",data:JSON.stringify(e),timeout:11e3,contentType:"application/json",dataType:"json",cache:!1,success:_.bind(this.requestSuccessHandler,this),error:_.bind(this.requestErrorHandler,this)}},requestSuccessHandler:function(e,t){t.error?this.trigger("unknownCardType",t.error):(this.get("creditCardBinCache").push(t),this.set({creditCardBinDetails:t,creditCardTypeCode:this.getCreditCardTypeCode(t)})),this.xhr=null},requestErrorHandler:function(){this.xhr=null,this.trigger("unknownCardType","ERROR500_ONEFRONT_NOT_RESPONSE")},url:function(){return Odigeo.Settings.getProperty("serviceCollectionMethodFormatter")(this.dataURL)}}),viewClass:Odigeo.View.extend({selectors:{binDetectionContainer:".bin_detection_container",ccFeePrice:".cc_fee_price",ccnumber:'input[name="ccnumber"]',binDetectionCcFeesListTemplate:".bin_detection_cc_fees_list_template",creditCardFeesBinDetection:"#creditCardFeesBinDetection",binDetectionCcFeesList:".bin_detection_cc_fees_list",ccCardType:'select[data-name="cardTypeSelector"]',ccTypeIcon:".cc_type_icon",ccNotDetected:".cc_not_detected",ccDetectedSelectedOk:".cc_detected_selected_ok",ccNumberNotAvailable:".cc_number_not_available",openCcList:".open_cc_list",clearInput:".clear_input"},init:function(){this.listenTo(this.model,"change:creditCardTypeCode",this.onCreditCardTypeCodeChange),this.$cachedSelectors.clearInput.on(Odigeo.Events.tap,_.bind(this.widget.creditCardNumberChanged,this.widget,!1)),this.$cachedSelectors.ccnumber.on(Odigeo.Events.change,_.bind(this.widget.creditCardNumberChanged,this.widget,!1)),this.$cachedSelectors.ccnumber.on(Odigeo.Events.input,_.bind(this.widget.creditCardNumberChanged,this.widget,!1))},setCreditCardTypeIcon:function(e){this.$cachedSelectors.ccTypeIcon.attr("data-card",e)},setCreditCardFormat:function(e){e&&(n.setSelectedCreditCard(e),this.$cachedSelectors.ccnumber.trigger(Odigeo.Events.input).trigger(Odigeo.Events.keydown))},onCreditCardTypeCodeChange:function(){var e=this.model.get("creditCardTypeCode"),t=s[e]?s[e].name:e;this.setCreditCardTypeIcon(e),this.setCreditCardFormat(e),Odigeo.trigger(this.widget.id+":creditCardTypeCodeChanged",e,t)}}),creditCardNumberChanged:_.debounce(function(e){var t=this.view.$cachedSelectors.ccnumber.val();this.model.set({isPaste:e,creditCardNumber:a.trimCreditCardNumber(t)})},300)}))},function(e,t,i){"use strict";Odigeo.defineWidget("post_booking_accommodation",Odigeo.Widget.extend({viewClass:i(754),modelClass:i(755),load:function(e){this.model.loadPostBookingAccommodation(e)},error:function(e){this.model.loadPostBookingAccommodation(_.zipObject([e],[!0]))}}))},function(e,t,i){"use strict";var n=i(0),a=i(148);e.exports=Odigeo.View.extend({events:{"tap .hotel_post_booking_error_button":"redirectHotelsWL"},redirectHotelsWL:function(){var e=a.getHotelsWhiteLabel(),t=this.model.get("buttonTracking");n.trackEvent("nags",t),window.location=e},init:function(){this.listenTo(this.model,"change:errorType",this.renderError)},renderError:function(){var e=this.model.get("errorType"),t=this.model.get("pictureType"),i=e.concat("_title"),a=e.concat("_description"),s=e.concat("_button"),r=this.model.get("onLoadTracking");n.trackEvent("nags",r),this.setTemplate(this.$el,"error",{titleKey:i,descriptionKey:a,buttonKey:s,pictureType:t})}})},function(e,t,i){"use strict";var n=[0,3],a=[{type:"no_hotel_results",check:_.partialRight(_.has,"no_hotel_results"),image:"odf-spot-hotel-error",onLoadTracking:"nag_error_postbook_noavailable_shown",buttonTracking:"nag_error_postbook_noavailable_search"},{type:"no_booking_found",check:_.partialRight(_.has,"no_booking_found"),image:"odf-spot-bellboy-sad",onLoadTracking:"nag_error_postbook_nobookingfound_shown",buttonTracking:"nag_error_postbook_nobookingfound_search"},{type:"hotel_booking_used",check:function(e){return i=t=e,!(_.isNull(i.shoppingBasketBundle)||_.isUndefined(i.shoppingBasketBundle))&&1<t.shoppingBasketBundle.shoppingBasketIds.length||!_.isNull(_.get(e,"accommodationBooking"));var t,i},image:"odf-spot-bellboy-sad",onLoadTracking:"nag_error_postbook_linkused_shown",buttonTracking:"nag_error_postbook_linkused_shown"},{type:"link_expired",check:function(e){if(_.has(e,"itineraryBookings"))return s((t=e,_.first(_.first(_.get(t,"itineraryBookings.itinerarySegments")).sections).section).departureDate).getTime()<Date.now();var t},image:"odf-spot-alarm-clock",onLoadTracking:"nag_error_postbook_linkexpired_shown",buttonTracking:"nag_error_postbook_linkexpired_search"}];function s(e){var t=new Date(e);return t.setDate(t.getDate()-1),t}function r(e){return Odigeo.Utils.formatDate(e,Odigeo.Utils.formatDate.masks.isoDate)}function o(e,t){return _(e).filter(function(e){return e.travellerType===t}).size()}function c(e){return t=new Date(e.arrivalDate).getHours(),n[0]<=t&&t<n[1]?s(e.arrivalDate).getTime():e.arrivalDate;var t}function d(e){for(var t=e.itineraryBookings.itinerarySegments,i=[],n=0;n<t.length;n++)i.push({}),i[n].departure={geoNodeType:t[n].sections[0].section.from.type.toUpperCase(),type:t[n].sections[0].section.from.type.toUpperCase(),name:t[n].sections[0].section.from.cityName,countryCode:t[n].sections[0].section.from.countryCode,country:t[n].sections[0].section.from.countryName,city:t[n].sections[0].section.from.name,iata:t[n].sections[0].section.from.iataCode,geoNodeId:t[n].sections[0].section.from.geoNodeId},i[n].destination={geoNodeType:t[n].sections[t[n].sections.length-1].section.to.type.toUpperCase(),type:t[n].sections[t[n].sections.length-1].section.to.type.toUpperCase(),name:t[n].sections[t[n].sections.length-1].section.to.cityName,countryCode:t[n].sections[t[n].sections.length-1].section.to.countryCode,country:t[n].sections[t[n].sections.length-1].section.to.countryName,city:t[n].sections[t[n].sections.length-1].section.to.name,iata:t[n].sections[t[n].sections.length-1].section.to.iataCode,geoNodeId:t[n].sections[t[n].sections.length-1].section.to.geoNodeId},i[n].dateStr=Odigeo.Utils.formatDate(t[n].sections[0].section.departureDate,Odigeo.Utils.formatDate.masks.isoDate),i[n].date=Odigeo.Utils.formatDate(t[n].sections[0].section.departureDate,Odigeo.Utils.formatDate.masks.isoDate),i[n].time=Odigeo.Utils.formatDate(t[n].sections[0].section.departureDate,Odigeo.Utils.formatDate.masks.hourMinutes);return i}function l(e,t){return a[_.findIndex(a,function(t){return t.type===e})][t]}e.exports=Odigeo.Model.extend({defaults:{search:{},errorType:[],pictureType:"",buttonTracking:"",onLoadTracking:""},loadPostBookingAccommodation:function(e){var t,i=(t=e,_(a).reduce(function(e,i){return e.concat(i.check(t)&&i.type)},[]).filter(Boolean));if(_.isEmpty(i))this.set("search",function(e){var t,i,n,a,s,l,g,h,u,p=(t=e,_.last(_.first(_.get(t,"itineraryBookings.itinerarySegments")).sections).section),f=r(c(p));return l=f,g=i="ONE_WAY"===e.itineraryBookings.bookingItinerary.tripType?r(f+864e5):"ROUND_TRIP"===e.itineraryBookings.bookingItinerary.tripType?(a=e,r(_.first(_.last(_.get(a,"itineraryBookings.itinerarySegments")).sections).section.departureDate)):(n=e,r(_.get(n,"itineraryBookings.itinerarySegments[1].sections[0].section").departureDate)),h={},u=(s=e).itineraryBookings.bookingItinerary.tripType,h.buyPath="POST_BOOKING_ACCOMMODATION",h.cabinClass=s.itineraryBookings.itinerarySegments[0].sections[0].section.cabinClass,h.type="ROUND_TRIP"===u?"roundTrip":u,h.accommodationDestination={geoNodeId:s.itineraryBookings.bookingItinerary.arrival.geoNodeId,iata:s.itineraryBookings.bookingItinerary.arrival.iataCode,name:s.itineraryBookings.bookingItinerary.arrival.name},h.searchSegments=d(s),h.checkInDate=l,h.checkOutDate=g,h.numAdults=o(s.travellers,"ADULT"),h.numChildren=o(s.travellers,"CHILD"),h.numInfants=o(s.travellers,"INFANT"),Odigeo.Session.set("searchParameters",JSON.stringify(h)),{accommodationSearchRequest:{destination:{iata:p.to.iataCode,name:p.to.name,geoNodeId:p.to.geoNodeId,type:p.to.type.toUpperCase()},checkInDate:f,checkOutDate:i,searchType:"POST_BOOKING"},itinerarySearchRequest:{numAdults:o(e.travellers,"ADULT"),numChildren:o(e.travellers,"CHILD"),numInfants:o(e.travellers,"INFANT"),cabinClass:p.cabinClass,segmentRequests:d(e)}}}(e)),Odigeo.trigger(this.widget.id+":available",this.get("search"));else{var n=_.first(i);Odigeo.trigger(this.widget.id+":loadError"),this.set({errorType:n,pictureType:l(n,"image"),onLoadTracking:l(n,"onLoadTracking"),buttonTracking:l(n,"buttonTracking")})}}})},function(e,t,i){"use strict";var n=i(0),a=i(494),s=i(560),r=i(561),o=i(148),c={nameoncard:"owner",ccnumber:"number",creditCardExpiration:"expiration",cvv2:"cvv"};e.exports={modelClass:Odigeo.Model.extend(_.extend(s,a.model)),viewClass:Odigeo.View.extend(_.extend(r,a.view,{selectors:_.extend(r.selectors,{invalidCard:".post_booking_payment_invalid_card"}),onCreditCardTypeCodeChanged:function(){var e=this.model.get("creditCardTypeCode"),t=this.model.get("collectionMethods"),i=o.isAcceptedCreditCardType(t,e);this.$cachedSelectors.invalidCard.toggleClass("odf-hidden",i)},renderAcceptedCreditCardTypes:function(e){var t=_.template(this.$cachedSelectors.acceptedCardsTemplate.html(),this.tmplSettings),i=_.chain(e).uniq(_.property("code")).map(t).value();this.$cachedSelectors.acceptedCards.html(i)}})),init:function(){this.listenTo(this.model,"cardChanges",this.cardDataChanged),this.view.listenTo(this.model,"change:creditCardTypeCode",this.view.onCreditCardTypeCodeChanged),this.view.listenTo(this.model,"change:chosenMethod",this.view.updatePaymentMethod),this.view.listenTo(this.model,"change:chosenCard",this.view.updateCreditCard),this.view.listenTo(this.model,"cardChanges",this.view.showErrors),a.controller.initController.call(this),this.model.listenTo(this.view,"change:cardData",this.model.setCardData)},cardDataChanged:function(e){var t=this.model.getRequest(),i=_.isNull(t)?{}:t.paymentDetails,n=e.changes[0],a=this.model.validationError||"";this.trackFormErrorEvents(n,a),Odigeo.trigger(this.id+":cardDataChanged",this.model.isValid(),i)},trackFormErrorEvents:function(e,t){"cardExpirationYear"!==e&&"cardExpirationMonth"!==e||(e="creditCardExpiration");var i=c[e],n=t[e]||"";this.trackError(n,i)},trackError:function(e,t){"invalid"!==e&&"empty"!==e||("empty"===e&&(e="missing"),n.trackEventWithCategory("post_booking","baggage_offline_add","baggage_offline_fill_pay_fail_cccard_"+t+"_inline_"+e+"_error"))},setPaymentOptions:function(e,t){var i;this.model.set({collectionMethods:t,paymentMethods:(i=t,_.chain(i).groupBy("method").map(function(e,t){return{method:t,info:{cardTypes:e}}}).value()),chosenMethod:"CREDITCARD",bookingId:e}),this.view.renderAcceptedCreditCardTypes(t),this.view.updatePaymentOptions(this.model)},setCreditCardTypeCode:function(e){this.model.set("creditCardTypeCode",e),this.model.setCardType(e),this.view.cvvTypeChanged("AX"===e),this.view.$cachedSelectors.cvv2.attr("maxlength",this.model.getCvvLength(e))}}},function(e,t,i){"use strict";var n=i(168),a=i(36),s=i(0),r=a.extend(n.extend({modelClass:i(758),viewClass:i(759),trackingAction:"pax_baggage",secondLegId:null,selectedRowId:null,trackingLabels:{addButton:"click_add_baggage_",addExtraButton:"click_add_baggage_extra_",removeButton:"click_remove_baggage_",addedBaggage:"added_baggage_",addedExtraBaggage:"added_baggage_extra_",showExtraBaggage:"add_baggage_extra_shown",autoSelectionOff:"change_baggage_",notBaggageAllowed:"notBaggageAllowed"},exposedMethods:{onSelectedBaggageFromSmartNag:"onSelectedBaggageFromSmartNag"},CONST:{BAGS_PROPENSITY_THRESHOLD:.3,INTENTION_TO_BUY_BAGS:"intentionToBuy_bags"},getProviderTracking:function(){return this.options.isPureAmadeus?"ama":"other"},trackBaggages:function(e){s.trackEvent("on_load_widgets",e+":"+this.getProviderTracking())},onBaggageExtraShown:function(e){!_.isUndefined(this.options.paxIndex)&&e&&0===this.options.paxIndex&&this.sendBaggageTracking(this.trackingLabels.showExtraBaggage,"")},onAddButtonClicked:function(e){var t=this.getBaggageRowByCid(e);this.selectedRowId=e,this.sendBaggageTracking(t.get("hasIncludedBaggages")&&t.get("hasSelectableBaggages")?this.trackingLabels.addExtraButton:this.trackingLabels.addButton,this.getGlobalRowPosition(e)),Odigeo.Session.set(this.CONST.INTENTION_TO_BUY_BAGS,!0)},onSelectedBaggage:function(e,t){var i=this.getBaggageOptionByCid(e),n=0===i.get("price")&&0===i.get("pieces"),a=this.isNewSelection(i)&&n;t&&(a&&this.sendRemovedBaggageTracking(i),this.sendSelectedBaggageTracking(i)),this.updateBaggageSelection({newOptionCid:e,isUserAction:!0,triggerEvents:!0})},onRemoveBaggages:function(e){var t=this.getBaggageRowByCid(e),i=t.get("idRow");this.isSecondLeg(i)&&this.deactivateAutoselection(e),this.selectDefaultOption(t.get("idPassenger"),i,!0),this.sendRemovedBaggageTracking(t),this.sendSelectedBaggageTracking(this.getBaggagesRowSelection(this.options.paxIndex,i),t)},onBaggageLoaded:function(){1<this.options.tests.keepBaggagesSession&&this.updateTravelerSessionBaggages()},onBaggageChange:function(e){var t=e.currentOption,i=t.get("idPassenger")===this.options.paxIndex;t.get("selected")&&i&&(this.shouldAutoSelectSecondLeg(t)&&this.autoSelectSecondLeg(t)||this.updateView()),i&&this.updateTravelerSessionBaggages()},updateTravelerSessionBaggages:function(){var e=Odigeo.Utils.parseJson(Odigeo.Session.get("baggagesSelection"))||{},t=this.options.paxIndex;e[this.options.bookingId]=e[this.options.bookingId]||{},e[this.options.bookingId][t]=this.getActualSelection(t),Odigeo.Session.set("baggagesSelection",JSON.stringify(e))},checkAutoSelectionUpdate:function(e){if(this.model.get("hasAutoselectionActive")){var t=_.find(e,function(e){return"FIRST"===e.get("idRow")}),i=_.every(e,function(e){return _.isEqual(e.get("pieces"),t.get("pieces"))});this.model.set("hasAutoselectionActive",i)}},prefillTravelerSelection:function(){var e=Odigeo.Utils.parseJson(Odigeo.Session.get("baggagesSelection")),t=this.options.paxIndex,i=!1;if(!_.isNull(e)&&_.isObject(_.get(e,"["+this.options.bookingId+"]["+t+"]"))&&!_.isEqual(this.getActualSelection(t),e[this.options.bookingId][t])){var n=this.getAvailableOptions(e[this.options.bookingId][t],t);i=!0,this.updateBaggagesOptions({baggagesOptions:n,triggerEvents:!1}),this.checkAutoSelectionUpdate(n)}Odigeo.trigger(this.name+":trackPrefillBaggages",{bookingid:this.options.bookingId,saveBaggages:i})},onCollectionBuilt:function(e){var t=this.options.paxIndex,i=this.getBaggagesPassengerSelection(t);_.isUndefined(e[t])||(this.model.update(e[t]),this.setAutoSelectionDefaultValue(),this.sendOnLoadBaggageTracking(t),this.prefillTravelerSelection(),this.checkAutoSelectionUpdate(i),this.updateView())},onDeactivateAutoselection:function(e){this.deactivateAutoselection(e),this.updateView()},ensureTestsObjectExists:function(){_.has(this.options,"tests")||(this.options.tests={})},getGlobalRowPosition:function(e){var t=this.getBaggageRowByCid(e).get("idRow");return this.getBaggagesRowIdsArray().indexOf(t)+1+this.getPassengerRows(this.options.paxIndex).length*this.options.paxIndex},init:function(){this.options=Odigeo.Utils.parseOptions(this.options),this.ensureTestsObjectExists(),this.secondLegId=this.getBaggagesRowIdsArray()[1],_.isUndefined(this.options.paxIndex)||(this.bindEvents(),this.trackBaggages("onload_baggage_widget_prov"),this.subscribeToCollectionEvent("removeLoadingBaggages",_.bind(this.view.removeLoadingTemplate,this.view)),this.subscribeToCollectionEvent("trackBaggages",this.trackBaggages),this.model.refreshData()),this.setDiscountFigure()},setAutoSelectionDefaultValue:function(){this.model.set("hasAutoselectionActive",this.doBaggageAllowAutoselection())},bindEvents:function(){this.suscribeBaggagesCollectionEvents()},updateView:function(){this.view.renderTemplate(this.buildTemplate()),this.displayPromotionBadge(!0),this.displayBaggageFeeDisclaimer(),this.displayVinBaggagesDisclaimer()},buildTemplate:function(){return{idPassenger:this.options.paxIndex,rowsInfo:this.getBaggagePassengerComposedRowsInfo(this.options.paxIndex),searchRequestType:this.model.get("searchRequestType"),notBaggageAllowed:this.model.get("notBaggageAllowed"),includedBaggage:this.model.get("includedBaggage"),hasSelectableBaggage:this.model.get("hasSelectableBaggage"),hasAllIncludedAndSelectableBaggage:this.model.get("hasAllIncludedAndSelectableBaggage"),autoSelectionActive:this.model.get("hasAutoselectionActive"),tests:this.options.tests,layout:Odigeo.AB.mobileWidgetProminentPartition,isLayoutBig:this.isLayoutBig(),passengerNumber:this.options.paxIndex+1,baggageFee:this.getSelectedBaggageAverageFee()}},isLayoutBig:function(){return 2===Odigeo.AB.mobileWidgetProminentPartition||3===Odigeo.AB.mobileWidgetProminentPartition},closeBaggageSelector:function(){this.view.closeBaggageSelectors()},shouldDisplayPromotionBadge:function(){var e=this.getBaggagePropensity(),t=_.isNumber(e)&&e<this.CONST.BAGS_PROPENSITY_THRESHOLD;return 3===Odigeo.AB.promotionMerchandisingBadgePartition&&t&&this.hasAnySelectableBaggage()&&0===this.getBaggageSelectedPieces()},displayPromotionBadge:function(e){this.shouldDisplayPromotionBadge()&&this.view.displayPromotionBadge(e)},displayDiscountPercentage:function(e){this.view.displayDiscountPercentage(e)},displayBaggageFeeDisclaimer:function(){var e=this.getSelectedBaggageAverageFee();0<this.getPassengerBaggageSelectedPieces(this.options.paxIndex)&&0!==e&&this.view.displayBaggageFeeDisclaimer()},displayVinBaggagesDisclaimer:function(){var e=0<this.getPassengerBaggageSelectedPieces(this.options.paxIndex);Odigeo.AB.isBaggageVinDisclaimer&&this.options.isVinFlight&&e&&this.view.displayVinBaggagesDisclaimer(e)},shouldAutoSelectSecondLeg:function(e){return e.get("idRow")===this.getBaggagesRowIdsArray()[0]&&this.doBaggageAllowAutoselection()&&this.model.get("hasAutoselectionActive")},autoSelectSecondLeg:function(e){var t=this.getOptionForSecondLeg(e),i=!1;return _.isUndefined(t)||(this.updateBaggageSelection({newOptionCid:t.cid,isUserAction:!1,triggerEvents:!0}),i=!0),i},getOptionForSecondLeg:function(e){var t=this.getSamePieceSameWeightOptionForSecondLeg(e);return _.isUndefined(t)?this.getFirstBaggageOption(_.extend({idPassenger:this.options.paxIndex,idRow:this.secondLegId},e.pick("pieces"))):t},getSamePieceSameWeightOptionForSecondLeg:function(e){return this.getFirstBaggageOption(_.extend({idPassenger:this.options.paxIndex,idRow:this.secondLegId},e.pick("pieces","kilos")))},deactivateAutoselection:function(e){this.model.set("hasAutoselectionActive",!1),this.sendAutoSelectionDeactivatedTracking(e)},isNewSelection:function(e){var t=this.getFirstBaggageOption({idPassenger:e.get("idPassenger"),idRow:e.get("idRow"),selected:!0});return e.cid!==t.cid},isRoundTrip:function(){return this.getBaggagesRequestTypesEnum().roundTrip===this.getBaggagesRequestType()},isSecondLeg:function(e){return e===this.secondLegId},sendOnLoadBaggageTracking:function(e){0===e&&this.model.get("notBaggageAllowed")&&this.sendBaggageTracking(this.trackingLabels.notBaggageAllowed,"")},sendSelectedBaggageTracking:function(e,t){var i,n=this.isRoundTrip()&&this.isSecondLeg(e.get("idRow"))?"Return":"Departure",a=e.get("pieces"),s=n+"_"+(0<a?1:0)+"_"+a,r=this.selectedRowId||t,o=this.getBaggageRowByCid(r);_.isUndefined(o)||(i=o.get("hasIncludedBaggages")&&o.get("hasSelectableBaggages")?"addedExtraBaggage":"addedBaggage",this.sendBaggageTracking(this.trackingLabels[i],s))},sendRemovedBaggageTracking:function(e){var t=e.get("idRow"),i=this.getBaggageFirstRow({idPassenger:this.options.paxIndex,idRow:t});this.sendBaggageTracking(this.trackingLabels.removeButton,this.getGlobalRowPosition(i.cid))},sendAutoSelectionDeactivatedTracking:function(e){var t=this.getBaggageRowByCid(e),i=this.getBaggagesRowSelection(t.get("idPassenger"),t.get("idRow")).get("pieces");this.sendBaggageTracking(this.trackingLabels.autoSelectionOff,i)},sendBaggageTracking:function(e,t){var i=e+t;s.trackEvent(this.trackingAction,i)},onSelectedBaggageFromSmartNag:function(e){this.onSelectedBaggage(e,!1),this.updateView()}}));Odigeo.defineWidget("baggagesmanager",Odigeo.Widget.extend(r)),e.exports=r},function(e,t,i){"use strict";e.exports=Odigeo.Model.extend({defaults:{searchRequestType:"",notBaggageAllowed:!1,includedBaggage:!1,hasSelectableBaggage:!1,hasAllIncludedAndSelectableBaggage:!1,hasAutoselectionActive:!1,status:""},update:function(e){var t=this.widget.hasPassengerAllSegmentsWithIncludedAndSelectableBaggage();this.setSearchRequestType(e.searchRequestType),this.setBaggageProperties({notBaggageAllowed:e.notBaggageAllowed,includedBaggage:e.includedBaggage,hasSelectableBaggage:this.widget.hasPassengerSelectableBaggage(),hasAllIncludedAndSelectableBaggage:t,status:e.status}),this.widget.onBaggageExtraShown(t)},refreshData:function(){this.isEmptyData=!1,this.refresh()},setSearchRequestType:function(e){_.isUndefined(e)||this.set("searchRequestType",e)},setBaggageProperties:function(e){_.forOwn(e,function(e,t){_.isUndefined(e)||this.set(t,e)},this)}})},function(e,t,i){"use strict";var n=i(0);e.exports=Odigeo.View.extend({templateSettings:{evaluate:/\{\{#([\s\S]+?)\}\}/g,interpolate:/\{\{[^#{]([\s\S]+?)[^}]\}\}/g,escape:/\{\{\{([\s\S]+?)\}\}\}/g,variable:"tmpl"},CONST:{baggageSelectorList:".new_baggage_type_wrapper_",hiddenClass:"odf-hidden",baggageType:".js_baggageType_",baggageSelectors:".new_baggage_type_wrapper"},selectors:{addBaggageButton:".baggage_add_button",baggageSelectMobile:".select_baggage_mobile",baggageSelected:".selectable_baggage",container:"#baggages-main-container",baggagesLoader:".baggages_loader",baggagesNotAvailable:".baggages_not_available",baggageAutoselectionLink:".baggage_autoselection_link",boxSpinner:".box_spinner",promotionBadge:".promotion_badge",baggageFeeDisclaimerIcon:".baggage_fee_disclaimer_icon",baggageFeeDisclaimerText:".baggage_fee_disclaimer_text",baggageFeeDisclaimerLightbox:".baggage_fee_disclaimer_lightbox",vinBaggageDisclaimer:".vin_baggage_disclaimer"},events:{"tap @addBaggageButton":"onAddButtonClicked","tap @baggageSelected":"onSelectBaggage","tap @baggageSelectMobile":"onAddButtonClicked","change @baggageSelectMobile":"onSelectBaggage","tap .baggage_remove":"onBaggageRemove","tap @baggageAutoselectionLink":"onAutoselectionLinkClicked","tap @baggageFeeDisclaimerIcon":"onTapBaggageFeeDisclaimerIcon"},baggageFeeDisclaimerLightbox:null,init:function(){this.template=_.template(this.$cachedSelectors.container.html(),this.templateSettings),this.listenTo(this.model,"change:status",this.trackingBaggageStatus)},removeLoadingTemplate:function(){this.$cachedSelectors.baggagesLoader.remove(),this.widget.hasAnySelectableBaggage()||this.widget.hasIncludedBaggage()||this.$cachedSelectors.baggagesNotAvailable.removeClass("odf-hidden")},trackingBaggageStatus:function(){var e="baggage_widget_loaded_prov";this.widget.hasNotSelectableOrIncludedBaggages()&&(e="baggage_widget_unavailable_prov"),this.widget.trackBaggages(e),this.widget.execute("setPromotionBadgeTracking")},sendPromotionBadgeTracking:function(e){var t=e;n.trackEvent("on_load_widgets",t)},onAddButtonClicked:function(e){var t,i=$(e.currentTarget),n=i.data("row");i.hasClass(this.selectors.baggageSelectMobile)||(t=this.$el.find(this.CONST.baggageSelectorList+n)).hasClass(this.CONST.hiddenClass)&&this.openSelectorsContainer(t),this.widget.onAddButtonClicked(n)},onSelectBaggage:function(e){var t=$(e.currentTarget),i=t.is("select"),n=(i?t.find("option:selected"):t).data(),a=n.row,s=n.bag;i||this.$el.find(this.CONST.baggageSelectorList+a).addClass(this.CONST.hiddenClass),this.widget.onSelectedBaggage(s,!0)},onBaggageRemove:function(e){var t=$(e.currentTarget).data().row;this.widget.onRemoveBaggages(t)},onAutoselectionLinkClicked:function(e){var t=$(e.currentTarget).data().row;e.preventDefault(),this.widget.onDeactivateAutoselection(t)},onTapBaggageFeeDisclaimerIcon:function(){this.baggageFeeDisclaimerLightbox.toggle(!0)},openSelectorsContainer:function(e){Odigeo.trigger(this.widget.name+":baggageSelectorOpened"),this.$el.find(e).removeClass(this.CONST.hiddenClass)},renderTemplate:function(e){this.addTranslationKeysToTemplate(e),this.$cachedSelectors.boxSpinner.html(this.template(e)),this.updateDomSelectorsToCache(),this.enhanceBaggageFeeDisclaimer()},addTranslationKeysToTemplate:function(e){_.each(e.rowsInfo,function(e){_.extend(e,{baggageMessage:this.getRowTranslationsKey(e.rowDescriptor)})},this)},getRowTranslationsKey:function(e){var t;return this.widget.getBaggagesTransportsEnum().train!==e.get("transportType")?(t=this.widget.getFirstBaggageOption({idPassenger:this.widget.options.paxIndex,idRow:e.get("idRow"),isIncludedBaggage:!0}),!_.isUndefined(t)&&0<t.get("kilos")?"segmentIncludedWithkilos":"segmentIncluded"):"segmentIncludedTrains"},closeBaggageSelectors:function(){this.$el.find(this.CONST.baggageSelectors).addClass(this.CONST.hiddenClass)},displayPromotionBadge:function(e){var t=this.$el.find(".promotion_badge"),i=this.$el.find(".baggages_title_container");e?(Odigeo.trigger("baggagesmanager:displayDiscountPercentage"),t.removeClass("fadeOut").addClass("fadeIn"),i.addClass("od-with-promotion-badge")):(t.removeClass("fadeIn").addClass("fadeOut"),i.removeClass("od-with-promotion-badge"))},displayDiscountPercentage:function(e){$(".promotion_discount").text("-"+e)},enhanceBaggageFeeDisclaimer:function(){this.baggageFeeDisclaimerLightbox=new Odigeo.UIElements.Lightbox(this.$cachedSelectors.baggageFeeDisclaimerLightbox,{overFullPage:!1})},displayBaggageFeeDisclaimer:function(){this.$cachedSelectors.baggageFeeDisclaimerIcon.removeClass("odf-hidden")},displayVinBaggagesDisclaimer:function(e){this.$cachedSelectors.vinBaggageDisclaimer.toggleClass("odf-hidden",!e)}})},function(e,t,i){"use strict";e.exports=Odigeo.Model.extend({defaults:{index:0,numPassenger:0,name:"",defaultName:"",firstLastName:"",shortName:"",defaultShortName:"P",travellerType:""}})},function(e,t,i){"use strict";e.exports=Odigeo.Model.extend({dataUrl:"getseatmapdescriptors",defaults:{},url:function(){return Odigeo.Settings.getProperty("serviceUrlFormatter")(this.dataUrl)},getDataRequestSettings:function(){return{type:"GET",reset:!0,cache:!1,dataType:"json",contentType:"application/json",success:_.bind(this.requestSuccessHandler,this),error:_.bind(this.requestErrorHandler,this)}},requestSuccessHandler:function(e){_.isEmpty(e)||(this.widget.initializeSeatView.call(this.widget.view,this.toJSON()),this.trigger("responseIsOK",e))},getSeatsStatus:function(){return this.toJSON()},requestErrorHandler:function(){this.trigger("responseIsKO")},hasInfo:function(){return this.get("hasFlightDetails")&&this.get("hasSeatMapInfo")}})},function(e,t,i){"use strict";var n=i(618),a=i(564),s=i(101),r=i(763);e.exports=new n({CollectionClass:r,viewClass:null,exposedMethods:null,seatMapSelectionCollection:null,passengerCollection:null,seatMapDescriptorCollection:null,preSelectedSeats:null,init:function(){(this.isPostBookingAircraftMap()||this.isPassengersPageAircraftMap())&&(this.passengerCollection=a.getInstance(),this.seatMapSelectionCollection=s.getInstance(),this.seatMapDescriptorCollection=new this.CollectionClass(null),this.setUpView(),this.bindEvents())},bindEvents:function(){this.listenTo(this.seatMapSelectionCollection,"seatMapSelectionResponseIsOK",this.updateView,this),this.listenTo(this.seatMapSelectionCollection,"add",this.updateView,this),this.listenTo(this.seatMapSelectionCollection,"remove",this.updateView,this),this.listenTo(this.seatMapSelectionCollection,"reset",this.updateView,this)},addSelection:function(e){this.seatMapSelectionCollection.addSelection(e)},removeSelection:function(e){this.seatMapSelectionCollection.removeSelection(e)},removeAllSelection:function(){this.seatMapSelectionCollection.resetCollection()},getTrackingConfig:function(){return{type:"trackEvent",data:{category:this.getTrackingCategory(),action:"seat_selection"}}},getTrackingCategory:function(){return this.isPostBookingAircraftMap()?"post_booking":"flights_pax_page"},isPostBookingAircraftMap:function(){return!("post-booking-aircraftmap"!==this.id&&"aircraft-desktop"!==this.id||"post_booking"!==Odigeo.History.getPageNameFromFragment()&&"mytrips"!==Odigeo.History.getPageNameFromFragment()&&"tripdetails"!==Odigeo.History.getPageNameFromFragment())},isPassengersPageAircraftMap:function(){return"aircraft_map"===this.id&&"passengersinfo"===Odigeo.History.getPageNameFromFragment()||"aircraft_map_manager"===this.id&&"details"===Odigeo.History.getPageNameFromFragment()},openAircraftMap:function(e,t){var i=_.isEmpty(e)?{}:this.returnSeatsFromCabins(e.cabin);_.extend(this.options,t),this.seatMapDescriptorCollection.fillData(i,t.segment,t.section),this.view.openAircraftMap(e,t)},returnSeatsFromCabins:function(e){return _.reduce(e,function(e,t){return e.concat(t.seats.seat)},[])},allPaxHaveSeatInSection:function(e,t){return _.size(this.seatMapSelectionCollection.getFlightSeats(e,t))===this.options.nEligibleTravellers},setUpView:function(){this.view.setUpView()},updateView:function(){this.view.render()},analyticsEventTracking:function(e){var t=$.extend(!0,{},this.getTrackingConfig());return _.extend(t.data,e),Odigeo.trigger("analytics:tracking",t),this},execute:function(e){return Odigeo.Utils.executeInternalMethods(this,this.exposedMethods,e,_.toArray(arguments).slice(1))}})},function(e,t,i){"use strict";var n=Backbone.Collection.extend({model:i(764),fillData:function(e,t,i){this.section=i,this.segment=t,this.reset(e)},refreshData:function(){this.isEmptyData=!1,this.refresh()},getSeat:function(e){return _.extend(this.findWhere(e),{section:this.section,segment:this.segment})}});e.exports=n},function(e,t,i){"use strict";e.exports=Odigeo.Model.extend({defaults:{seatCharacteristics:[],floor:0,seatRow:0,seatMapRow:0,column:"",type:"",providerPrice:0,totalPrice:0},idAttribute:"numPassenger",segment:"",section:""})},function(e,t,i){"use strict";$(function(){var e=i(0);Odigeo.defineWidget("trip_details",Odigeo.Widget.extend({modelClass:Odigeo.Model.extend({}),viewClass:Odigeo.View.extend({templateSettings:{evaluate:/{{#([\s\S]+?)}}/g,interpolate:/{{[^#{]([\s\S]+?)[^}]}}/g,escape:/\{\{\{([\s\S]+?)\}\}\}/g},events:{"tap .tripdet_menu_link":"navigateTo"},navigateTo:function(e){var t=$(e.currentTarget).find("a"),i=t.data("href"),n=t.data("track-label");_.isEmpty(i)||(this._trackEvent("sidebar",n,"my_trips_trip_information"),Odigeo.Router.navigate(i))},_trackEvent:function(t,i,n){e.trackEventWithCategory(n,t,i)}})}))})},function(e,t,i){"use strict";$(function(){var e=i(767),t=i(769);Odigeo.defineWidget("paymenterrormanager",Odigeo.Widget.extend({ErrorsCollection:e,viewClass:t,errors:null,init:function(){return this.errors=new this.ErrorsCollection(null,{widget:this}),this.errors.errorMessages=this.options.errorMessages,this.view.collection=this.errors,this.view.afterBindCollection(),this},updateErrorsCollection:function(e){this.errors.updateErrorsCollection(e)},scrollToError:function(){Odigeo.trigger("page:scrollTo",{top:this.view.getContainerTopPosition()})}}))})},function(e,t,i){"use strict";var n;e.exports=(n=i(768),Backbone.Collection.extend({updateErrorsCollection:function(e){_.each(_.isArray(e)?e:[e],function(e){this.addErrorToCollection(e)},this)},addErrorToCollection:function(e){var t=new n(e);this.fillModelWithData(t),this.add(t)},fillModelWithData:function(e){this.setErrorId(e),""===e.get("description")&&this.mapErrorWithMessage(e)},setErrorId:function(e){var t=this.last();e.set("id",_.isUndefined(t)?1:t.get("id")+1)},mapErrorWithMessage:function(e){var t=_.find(this.errorMessages,{type:e.get("type")},this);if(_.isUndefined(t))throw new Error("Error type ("+e.get("type")+") not found in error messages, make sure you send the correct type to widget options");e.set("description",t.value)}}))},function(e,t,i){"use strict";e.exports=Backbone.Model.extend({defaults:{id:"",type:"",validationResult:"",description:""},initialize:function(){this.buildType()},buildType:function(){var e=this.get("validationResult");e&&this.set("type",this.get("type")+("invalid"===e?"_invalid":"_empty"))}})},function(e,t,i){"use strict";var n;e.exports=(n=Backbone.View.extend({tagName:"li",className:"od-payment-error-manager-list-item odf-pl-xs",render:function(){return $(this.el).html(this.model.attributes.description),this}}),Odigeo.View.extend({selectors:{errorsContainer:".errors_container",paymentmanagerError:".paymentmanager_error"},afterBindCollection:function(){this.listenTo(this.collection,"add",function(e){this.appendError(e)},this),this.listenTo(this.collection,"reset",function(){this.cleanErrors()},this)},appendError:function(e){var t=new n({model:e});this.$cachedSelectors.errorsContainer.append(this.getDom(t))},getDom:function(e){return e.render().el},cleanErrors:function(){this.$cachedSelectors.paymentmanagerError.addClass("odf-hidden"),this.$cachedSelectors.errorsContainer.html("")},getContainerTopPosition:function(){return this.$cachedSelectors.paymentmanagerError.toggleClass("odf-hidden"),this.$cachedSelectors.paymentmanagerError.offset().top-10+"px"}}))},function(e,t,i){"use strict";var n=i(36);Odigeo.defineWidget("smart_nag_baggage",Odigeo.Widget.extend(n.extend({viewClass:i(771),modelClass:i(772),init:function(){this.options=Odigeo.Utils.parseOptions(this.options)},showSmartNagBaggage:function(){this.model.loadData(),this.view.showSmartNagBaggage()},setPassengersData:function(e){this.model.setPassengersData(e)},proceedToPayment:function(){Odigeo.trigger("nagmanager:continue")},updateBaggageAndProceedToPayment:function(){this.model.saveBaggageData(),this.proceedToPayment()},exposedMethods:{showSmartNagBaggage:"showSmartNagBaggage",setPassengersData:"setPassengersData"}})))},function(e,t,i){"use strict";var n=i(0);e.exports=Odigeo.View.extend({HIDE_SUCCESS_MESSAGE:3e3,smartNagLightbox:null,trackingConst:{noSegments:"0",allSegments:"ALL",departure:"1",return:"2"},selectors:{smartnagBaggageSelectMobile:".smartnag_baggage_select_mobile",smartnagBaggageContainer:".smart_nag_baggage_container",smartnagDesktopContainer:".smart_nag_desktop_container",smartnagBaggageContent:".smartnag_content",smartnagSuccess:".smartnag_success",expandButtonContainer:".expand_btn_container",changeButton:".expand_btn",submitNoSelectionButton:".nag_btn_ignore",submitWithSelectionButton:".nag_btn_action",submitWithSelectionButtonEnabled:".nag_btn_action:not(.disabled)",collapsedContainer:".collapsed_container",expandedContainer:".expanded_container",collapsedRowContainer:".collapsed_baggage_row_container",departureRowContainer:".departure_baggage_row_container",returnRowContainer:".return_baggage_row_container",smartnagTitle:".smartnag_title",smartnagHeaderSubtitle:".smartnag_header_subtitle",smartnagHeaderImage:".smartnag_header_img",totalPriceLabel:".smartnag_total_price",totalPriceRow:".smartnag_price_row",specialSelectContainer:".special_select_container",specialSelectDropdownItem:".special_select_dropdown_item",smartnagPaxIcon:".smartnag_icon",smartnagTitleWrapper:".smartnag_title_wrapper",smartnagSubtitleWrapper:".smartnag_subtitle"},events:{"tap @changeButton":"onTapChangeButton","tap @submitNoSelectionButton":"onTapSubmitNoSelectionButton","tap @submitWithSelectionButtonEnabled":"onTapSubmitWithSelectionButtonEnabled","tap @smartnagBaggageSelectMobile":"onTapSmartnagBaggageSelectMobile","change @smartnagBaggageSelectMobile":"onChangeSmartnagBaggageSelectMobile","tap @specialSelectContainer":"onTapSpecialSelectContainer","tap @specialSelectDropdownItem":"onTapSpecialSelectDropdownItem","tap @smartnagDesktopContainer":"onTapSmartnagDesktopContainer"},tmpls:{mainTemplate:".smart_nag_baggage_template",itemTemplate:".smart_nag_baggage_item_tmpl"},onTapChangeButton:function(){this.trackEvent("nag_baggage_submit_details_open"),this.expandReturnSection()},onTapSmartnagBaggageSelectMobile:function(e){var t=$(e.currentTarget),i=this.model.getTrackingFlightType(),n=t.data("type");this.trackEvent("nag_baggage_submit",{click:0===t.prop("selectedIndex")?"add":"edit",meta:this.widget.options.isMetaSearch?1:0,type:i,flig:this.getFlightBagAdded(n,i),pax:this.model.getPassengerCount()})},onChangeSmartnagBaggageSelectMobile:function(e){this.onSelectBaggage($(e.currentTarget),!0)},onTapSubmitNoSelectionButton:function(){this.smartNagLightbox.remove(),this.trackEvent("nag_baggage_submit_continue"),this.widget.proceedToPayment()},onTapSubmitWithSelectionButtonEnabled:function(){var e=this.trackingConst.noSegments,t=this.model.getTotalPieces();if(this.setSuccessMessage(),this.showSuccessMessage(),this.model.isExpandableTrip()){var i=this.model.hasSegmentSelectedOptionNotPreselected("departure"),n=this.model.hasSegmentSelectedOptionNotPreselected("return");i&&n?e=this.trackingConst.allSegments:i?e=this.trackingConst.departure:n&&(e=this.trackingConst.return)}else this.model.hasSegmentSelectedOptionNotPreselected("collapsed")&&(e=this.model.isOneWayTrip()?this.trackingConst.departure:this.trackingConst.allSegments);this.trackEvent("nag_baggage_submit_add",{meta:this.widget.options.isMetaSearch?1:0,type:this.model.getTrackingFlightType(),flig:e,pax:this.model.getPassengerCount(),num:t,split:this.model.getExpandedStatus()}),_.delay(_.bind(function(){this.smartNagLightbox.remove(),this.widget.updateBaggageAndProceedToPayment()},this),this.HIDE_SUCCESS_MESSAGE)},onTapSpecialSelectContainer:function(e){e.stopPropagation(),e.preventDefault();var t=$(e.currentTarget),i=t.data("row"),n=this.$el.find(".special_select_"+i),a=n.hasClass("odf-hidden"),s=this.model.getTrackingFlightType(),r=t.data("type");this.closeAllSpecialSelectDropdown(),n.toggleClass("odf-hidden",!a),this.trackEvent("nag_baggage_submit",{click:"selected"===t.data("selected")?"edit":"add",meta:this.widget.options.isMetaSearch?1:0,type:s,flig:this.getFlightBagAdded(r,s),pax:this.model.getPassengerCount()})},onTapSpecialSelectDropdownItem:function(e){e.stopPropagation(),e.preventDefault(),this.onSelectBaggage($(e.currentTarget),!0)},onTapSmartnagDesktopContainer:function(e){$(e.target).hasClass(".special_select_dropdown")||this.closeAllSpecialSelectDropdown()},closeAllSpecialSelectDropdown:function(){this.$el.find(".special_select_dropdown").toggleClass("odf-hidden",!0)},showSmartNagBaggage:function(){this.loadTemplates(),this.loadLightbox(),this.setDefaultIcon(this.model.getPassengerCount()),this.checkPreselected(),this.trackEvent("nag_baggage_submit_appearances",{meta:this.widget.options.isMetaSearch?1:0,type:this.model.getTrackingFlightType(),flig:this.model.isOneWayTrip()?this.trackingConst.departure:this.trackingConst.allSegments,pax:this.model.getPassengerCount()},!0),_.delay(_.bind(function(){this.$cachedSelectors.submitWithSelectionButton.focus()},this),100)},loadLightbox:function(){this.smartNagLightbox=new Odigeo.UIElements.Lightbox(this.$cachedSelectors.smartnagBaggageContainer,{closeOnOuterClick:!1,overFullPage:!1}),this.smartNagLightbox.toggle(!0)},loadTemplates:function(){this.templates=Odigeo.Utils.getTemplates(this.$el,this.tmpls),this.$el.append(this.templates.mainTemplate(this.model.getMainTemplateData())),this.renderSegmentTemplate("collapsed"),this.model.isExpandableTrip()&&(this.renderSegmentTemplate("departure"),this.renderSegmentTemplate("return")),this.updateDomSelectorsToCache()},renderAllSegmentTemplates:function(){this.renderSegmentTemplate("collapsed"),this.model.isExpandableTrip()&&(this.renderSegmentTemplate("departure"),this.renderSegmentTemplate("return"))},renderSegmentTemplate:function(e){_.isObject(this.model.get(e))&&this.$el.find(this.selectors[e+"RowContainer"]).html(this.templates.itemTemplate({segmentsBaggage:this.model.getSegmentBaggage(e),segmentType:e,isOneWayTrip:this.model.isOneWayTrip(),isExpandableTrip:this.model.isExpandableTrip()}))},setDefaultIcon:function(e){var t={icon:1===e?"no":"none",title:this.widget.options.translations.titleCollapse,subtitle:this.widget.options.translations.subtitle};this.drawLeftColumnMessage(t)},checkPreselected:function(){var e=this.model.getSelectedSegments("collapsed");e.length&&(_.each(e,_.bind(function(e){this.onSelectBaggage(this.$el.find(".special_select_"+e.cid+e.cid2),!1)},this)),this.togglePrimaryButton(!0))},expandReturnSection:function(){this.$cachedSelectors.collapsedContainer.toggleClass("odf-hidden"),this.$cachedSelectors.expandedContainer.toggleClass("odf-hidden"),this.$cachedSelectors.smartnagHeaderImage.toggleClass("odf-hidden"),this.$cachedSelectors.smartnagHeaderSubtitle.toggleClass("odf-hidden"),this.$cachedSelectors.expandButtonContainer.toggleClass("odf-hidden"),this.$cachedSelectors.smartnagTitle.html(this.widget.options.translations.titleExpand),this.model.activateExpandedStatus()},togglePrimaryButton:function(e){this.$cachedSelectors.submitWithSelectionButton.toggleClass("disabled",!e)},onSelectBaggage:function(e,t){var i=e.hasClass("special_select_dropdown"),n=e.hasClass("special_select_dropdown_item"),a=e.data("type"),s=e.data("passenger"),r=(i?e.find('[data-selected="selected"]'):n?e:e.find("option:selected")).data("bag"),o=this.model.getSelectedOptionPieces(a,s);if(this.model.updateBaggageData(a,s,r),this.renderAllSegmentTemplates(),t){var c=this.model.getTrackingFlightType();this.trackEvent("nag_baggage_submit",{sel:0===o?"add":"edit",meta:this.widget.options.isMetaSearch?1:0,type:c,flig:this.getFlightBagAdded(a,c),pax:this.model.getPassengerCount(),num:this.model.getSelectedOptionPieces(a,s)})}},updatePriceLabel:function(e){this.$cachedSelectors.totalPriceLabel.html("+"+Odigeo.Utils.formatCurrency(e)),this.togglePrimaryButton(0<e)},getSuccessMessageOptions:function(){var e;return 1===this.model.getPassengerCount()?{title:this.widget.options.translations.success1Pax,subtitle:"",icon:"yes"}:{title:(e=this.model.allPassengersHaveSelectedBaggage())?this.widget.options.translations.successallPax:this.widget.options.translations.success1Pax,subtitle:"",icon:e?"both":"extend"}},setSuccessMessage:function(){var e;e=1===this.model.getPassengerCount()?{title:this.widget.options.translations.success1Pax,subtitle:"",icon:"yes"}:this.getSuccessMessageOptions(),this.drawLeftColumnMessage(e)},drawLeftColumnMessage:function(e){this.$cachedSelectors.smartnagPaxIcon.removeClass(function(e,t){return(t.match(/\bodf-spot-bags-\S+/g)||[]).join(" ")}),this.$cachedSelectors.smartnagPaxIcon.addClass("odf-spot-bags-"+e.icon),this.$cachedSelectors.smartnagTitleWrapper.html(e.title),this.$cachedSelectors.smartnagSubtitleWrapper.html(e.subtitle)},showSuccessMessage:function(){this.$cachedSelectors.smartnagBaggageContent.toggleClass("odf-hidden"),this.$cachedSelectors.smartnagSuccess.toggleClass("odf-hidden")},getFlightBagAdded:function(e,t){var i=this.trackingConst.return;return"collapsed"===e&&"OW"!==t?i=this.trackingConst.allSegments:"departure"!==e&&"OW"!==t||(i=this.trackingConst.departure),i},trackEvent:function(e,t,i){_.each(t,function(t,i){e+="_"+i+":"+t}),n.trackEvent("nags",e,Odigeo.History.getPageNameFromFragment(),i)}})},function(e,t,i){"use strict";var n=i(36),a=i(168);e.exports=Odigeo.Model.extend(n.extend(a.extend({loadData:function(){var e,t=this.getPassengerSegments(),i={collapsed:t.collapsed,totalPieces:0,expandedContainer:0};this.isExpandableTrip()&&(e=t.expanded,_.extend(i,{departure:e.FIRST,return:e.SECOND})),this.set(i)},getPassengerSegments:function(){var e=_.reduce(this.getBaggageAllRowsWithCid(),this.mapExpandedSegments,{collapsed:{},expanded:[]},this);return{collapsed:_.mapValues(e.collapsed,this.mapCollapsedSegmentOptions,this),expanded:e.expanded}},mapExpandedSegments:function(e,t){var i=t.cid,n=t.idPassenger,a=t.idRow,s=this.sortOptions(this.getAllBaggagesOptions({idPassenger:n,idRow:a}));return this.attachCollapsedData(e,i,t,n,a,s),_.isUndefined(e.expanded[a])&&(e.expanded[a]={}),s=this.unpackOptions(s,n),e.expanded[a][n]={cid:i,cid2:"",idPassenger:n,idRow:a,options:s,passenger:this.getPassengerData(n),isSelected:this.isBaggagePreselected(s),label:this.widget.options.translations.noBagsLabel,pieces:0,price:0,selectedCid:this.getEmptyOptionCid(s)},e},attachCollapsedData:function(e,t,i,n,a,s){_.isUndefined(e.collapsed[n])?e.collapsed[n]=_.extend(_.pick(i,"idPassenger","idRow"),{cid:t,cid2:"",segments:[],passenger:this.getPassengerData(n)}):e.collapsed[n].cid2=t,e.collapsed[n].segments[a]=s},getPassengersData:function(){var e=this.get("passengers");return e=_.isObject(e)?e:{},_.isEmpty(e)&&this.set("passengers",{}),e},getPassengerData:function(e){return this.getPassengersData()[e]},unpackOptions:function(e,t){var i=_.map(e,_.bind(function(e){return{cid:e.cid,price:e.get("price"),pieces:e.get("pieces"),kilos:e.get("kilos"),isPreselected:!1,isSelected:!1,label:this.getOptionLabel(e,e.get("price"))}},this));return this.setPreselectedOption(i,t)},getOptionLabel:function(e,t){var i,n,a,s=this.widget.options.translations,r=e.get("piecesToShow"),o=s.noSelectionLabel,c=s.noSelectionLabel;return 0!==r&&(i=!_.isUndefined(e.get("kilos"))&&0<e.get("kilos")?e.get("kilos"):null,n=_.isNull(i)?s.dropdownPieces:s.dropdownPiecesWithKilos,o=(c=r+Odigeo.Utils.pluralizeAll(n,r,i))+" - "+(a=Odigeo.Utils.formatCurrency(t))),{rowLabel:c,optionLabel:o,priceLabel:a}},isBaggagePreselected:function(e){return!_.isUndefined(_.find(e,function(e){return e.isSelected&&0!==e.pieces}))},setPreselectedOption:function(e,t){var i,n=Odigeo.AB.isSmartNagTwoPaxPreselected||0===t;return n&&(i=_.reduce(e,this.getMinNonZero,{index:-1,value:Number.MAX_VALUE},this)).index<e.length&&(e[i.index].isPreselected=!0,e[i.index].isSelected=!0),n?e:this.selectEmptyOption(e)},selectEmptyOption:function(e){return _.map(e,function(e){return _.extend(e,{isPreselected:0===e.pieces,isSelected:0===e.pieces})},this)},getEmptyOptionCid:function(e){var t=_.find(e,function(e){return 0===e.pieces});return _.get(t,"cid","")},getMinNonZero:function(e,t,i){var n=t.pieces,a=0<n&&n<e.value;return{index:a?i:e.index,value:a?n:e.value}},mapCollapsedSegmentOptions:function(e){var t=e.segments.FIRST,i=e.segments.SECOND,n=e.idPassenger,a=_.extend(e,{label:this.widget.options.translations.noBagsLabel,pieces:0,price:0});return _.isUndefined(i)?a.options=this.unpackOptions(t,n):(a.options=this.mapSumSegmentOptions(t,i),a.options=this.setPreselectedOption(a.options,n)),a.isSelected=this.isBaggagePreselected(a.options),a.selectedCid=this.getEmptyOptionCid(a.options),a},mapSumSegmentOptions:function(e,t){return _.map(e,function(e){var i,n=e.get("piecesToShow"),a=e.get("kilos"),s=this.findSecondSegmentOption(t,n,a);return _.isUndefined(s)?e:(a=e.get("kilos")===s.get("kilos")?a:0,i=e.get("price")+s.get("price"),{cid:e.cid,cid2:s.cid,price:i,pieces:n,kilos:a,isPreselected:!1,isSelected:!1,label:this.getOptionLabel(e,i)})},this)},findSecondSegmentOption:function(e,t,i){var n=this.findOptionWithFilters(e,{idRow:"SECOND",pieces:t,kilos:i});return _.isUndefined(n)&&(n=this.findOptionWithFilters(e,{idRow:"SECOND",pieces:t})),n},findOptionWithFilters:function(e,t){return _.find(e,function(e){return _.every(t,function(t,i){return e.get(i)===t})})},getSegmentBaggage:function(e){return this.get(e)},getAllBaggage:function(){return this.isExpandableTrip()?_.values(this.getSegmentBaggage("departure")).concat(_.values(this.getSegmentBaggage("return"))):this.getSegmentBaggage("collapsed")},updateBaggageData:function(e,t,i){var n=this.selectOption(e,t,i);this.updateModelAfterSelect(e,t,n)},selectOption:function(e,t,i){var n=this.get(e),a=n[t],s=a.options,r={};_.map(s,function(e){return e.isSelected=e.cid===i,e.isSelected&&(r=e),e});var o=0<r.pieces;return a.options=s,a.isSelected=o,a.label=o?r.label.rowLabel:this.widget.options.translations.noBagsLabel,a.price=r.price,a.pieces=r.pieces,a.selectedCid=r.cid,this.set(e,n),r},updateModelAfterSelect:function(e,t,i){this.isExpandableTrip()&&"collapsed"===e&&(this.selectOption("departure",t,i.cid),this.selectOption("return",t,i.cid2)),this.updatePriceAndPieceCount()},updatePriceAndPieceCount:function(){var e=this.getAllBaggage(),t=this.getSumOfCollectionProperty(e,"price"),i=this.getSumOfCollectionProperty(e,"pieces");this.set("totalPieces",i),this.widget.view.updatePriceLabel(t)},getSumOfCollectionProperty:function(e,t){return _.reduce(e,function(e,i){return e+i[t]},0)},getTotalPieces:function(){return this.get("totalPieces")},getSelectedOptionPieces:function(e,t){var i=this.get(e)[t].options,n=_.find(i,function(e){return!0===e.isSelected});return _.isUndefined(n)?0:n.pieces},hasSegmentSelectedOptionNotPreselected:function(e){var t=this.get(e);return _.reduce(t,function(e,t){return!_.isUndefined(_.find(t.options,function(e){return e.isSelected&&!e.isPreselected&&0<e.pieces}))||e},!1)},saveBaggageData:function(){var e=this.getAllBaggage();_.each(e,_.bind(function(e){""!==e.selectedCid&&Odigeo.trigger("baggagesmanager:updateSelectedBaggageFromSmartnag",e.idPassenger,e.selectedCid)},this))},activateExpandedStatus:function(){this.set("expandedContainer",1)},getExpandedStatus:function(){return this.get("expandedContainer")},setPassengersData:function(e){var t={};_.each(e,function(e){var i=e.id.replace("passengers","");t[i]={name:e.name,firstLastName:e.firstLastName}}),this.set("passengers",t)},getPassengerCount:function(){return _.size(this.get("collapsed"))},getTrackingFlightType:function(){var e=this.getFlightType();return"ONE_WAY"===e?"OW":"ROUND_TRIP"===e?"RT":"MD"},getSelectedSegments:function(e){return _.filter(this.getSegmentBaggage(e),{isSelected:!0})},allPassengersHaveSelectedBaggage:function(){var e=_.groupBy(this.getAllBaggage(),"idPassenger");return _.reduce(e,function(e,t){return e&&0<_.sum(t,"pieces")},!0)},isExpandableTrip:function(){return!this.isAnItineraryTrip()&&!this.isOneWayTrip()},getMainTemplateData:function(){return{translations:this.widget.options.translations,isOneWayTrip:this.isOneWayTrip(),isExpandableTrip:this.isExpandableTrip()}}})))},function(e,t,i){"use strict";Odigeo.defineWidget("membership_manager",Odigeo.Widget.extend({modelClass:i(774),viewClass:i(779),init:function(){},exposedMethods:{getUserType:"model.getUserType",addMembership:"model.addMembership",setPriceSelected:"model.setPriceSelected",disableAutoRenewal:"model.disableAutoRenewal",enableAutoRenewal:"model.enableAutoRenewal",getSubscriptionDetails:"model.getSubscriptionDetails"},execute:function(e){return Odigeo.Utils.executeInternalMethods(this,this.exposedMethods,e,_.rest(arguments))}}))},function(e,t,i){"use strict";var n=i(620),a=i(317),s=i(775),r=i(776),o=i(777),c=i(778);function d(e,t){return _.isFunction(e)?_.bind(e,t):_.constant(null)}e.exports=Odigeo.Model.extend({defaults:{data:null},currentAction:null,init:function(){},url:function(){return Odigeo.Settings.getProperty("membershipServiceFormatter")(this.currentAction.getUrl())},getDataRequestSettings:function(){return{data:this.get("data"),dataType:"json",contentType:"application/json",type:this.currentAction.getMethod(),success:d(this.currentAction.requestSuccess,this),error:d(this.currentAction.requestError,this),complete:d(this.currentAction.requestComplete,this)}},addMembership:function(e){if(a.hasToPerformRequest(e)){var t=a.formatData(e);this.set("data",t),this.set("request",e),this.currentAction=a,this.performRequest()}else Odigeo.trigger("continueTransitionToPayment")},getUserType:function(e){this.set("data",e),this.currentAction=n,this.performRequest()},setPriceSelected:function(e){this.set("data",JSON.stringify({priceWithoutDiscountSelected:e})),this.currentAction=s,this.performRequest()},enableAutoRenewal:function(){this.currentAction=o,this.performRequest()},disableAutoRenewal:function(){this.currentAction=r,this.performRequest()},getSubscriptionDetails:function(){this.currentAction=c,this.performRequest()},performRequest:function(){this.isEmptyData=!1,this.refresh()}})},function(e,t,i){"use strict";e.exports={getUrl:function(){return"setmemberpriceselected"},getMethod:function(){return"PUT"},requestSuccess:function(e){Odigeo.trigger(this.widget.id+":setPriceSelectedOk",e)}}},function(e,t,i){"use strict";e.exports={getUrl:_.constant("disableautorenewal"),getMethod:_.constant("PUT"),requestSuccess:function(){Odigeo.trigger(this.widget.id+":disableAutoRenewalOk")},requestError:_.noop()}},function(e,t,i){"use strict";e.exports={getUrl:_.constant("enableautorenewal"),getMethod:_.constant("PUT"),requestSuccess:function(){Odigeo.trigger(this.widget.id+":enableAutoRenewalOk")},requestError:_.noop()}},function(e,t,i){"use strict";e.exports={getUrl:_.constant("getsubscriptiondetails"),getMethod:_.constant("GET"),requestSuccess:function(e){Odigeo.trigger(this.widget.id+":getSubscriptionDetailsOk",e)},requestError:_.noop()}},function(e,t,i){"use strict";e.exports=Odigeo.View.extend({init:function(){this.bindEvents()},bindEvents:function(){this.listenTo(this.model,"showLightboxWarning",this.showLightboxWarning)},showLightboxWarning:function(){Odigeo.trigger(this.widget.id+":cancelMembershipWithError",{action:"cancelMembershipWithError"}),Odigeo.UIElements.showLightboxWarning("od-passenger-lightbox-edit",_.bind(_.noop,this),_.bind(Odigeo.trigger,Odigeo,"closeAllPopUps"),Odigeo.UIElements.translations.membershipManager.lightboxTexts,!0)}})},function(e,t,i){"use strict";Odigeo.defineWidget("account_blocked",Odigeo.Widget.extend({modelClass:i(781),viewClass:i(782),execute:function(e,t){return this.view[{}[e]](t),this}}))},function(e,t,i){"use strict";e.exports=Odigeo.Model.extend({accountBlocked:{data:"",action:"recoverpassword"}})},function(e,t,i){"use strict";var n=i(0);e.exports=Odigeo.View.extend({init:function(){this.$el.find(this.selectors.accountBlockedBody).html(this.prepareBodyText())},selectors:{accountBlockedLoginUser:".account_blocked_login_user",accountBlockedGoHome:".account_blocked_go_home",accountBlockedBody:".account_blocked_body",loginNameEmpty:".login_name_empty"},events:{"tap .account_blocked_login_user":"onTapLoginUser","tap .account_blocked_go_home":"onTapGoHome"},prepareBodyText:function(){var e=_.isEmpty(Odigeo.UserArea.loginName)?Odigeo.Session.get("loginDetails"):Odigeo.UserArea.loginName,t='<span class="od-login-blocked-address not_user">'+e+"</span>",i='<div class="od-login-message-text-email  not_user">'+e+"</div>",n="mobile"===Odigeo.SessionScope.flow;return Odigeo.Utils.replaceCmsKeyArgs(this.keys.loginBlockedBodyMessage,n?i:t)},onTapLoginUser:function(e){e.stopPropagation(),Odigeo.trigger(this.widget.id+":openLoginForm"),n.trackEventWithCategory("sso_blocked","sso_blocked","go_to_login")},onTapGoHome:function(e){e.stopPropagation(),Odigeo.Utils.goToApplicationHome()}})},function(e,t,i){"use strict";var n=function(){Odigeo.Utils.eraseCookie("sso_remember_me"),Odigeo.Utils.goToApplicationHome()},a=function(e){_.isEmpty(e)||_.isEmpty(e.messageError)||this.model.set("errorPsw",e.messageError),this.view.showDetails(),this.model.set({error:"",errorPsw:"",passwordChanged:!1})},s=function(){this.model.set("error","accountError"),this.view.showDetails()};Odigeo.defineWidget("account_preferences_manager",Odigeo.Widget.extend({modelClass:i(784),viewClass:i(785),cancelAccountOk:n,cancelAccountError:s,cancelAccountWithError:s,changePasswordOk:function(){this.model.set("passwordChanged",!0),this.view.hideHint(),this.view.showDetails()},changePasswordError:a,changePasswordWithError:a,getAccountInfoOk:function(e){this.model.initialized||(this.model.set({userDTO:e.userDTO,isActive:"ACTIVE"===e.userDTO.status}),this.view.showDetails())},clearChangePasswordFields:function(){this.view.clearPasswordFields()},cancelMembershipOk:n,cancelMembershipWithError:s}))},function(e,t,i){"use strict";e.exports=Odigeo.Model.extend({defaults:{initialized:!1,passwordChanged:!1,userDTO:null,error:"",errorPsw:"",errorMaxLength:50,errors:{AUTH_000:"loginerror",VAL_002:"incorrectformat",VAL_003:"invalid",default:"notchanged"},isActive:!1}})},function(e,t,i){"use strict";var n,a=i(0),s="my_area_account",r=i(588),o=i(787),c=[{id:"membership-account-preferences",factory:i(789)},{id:"membership-cancel-account",factory:i(588)}],d=function(){return a.trackEventWithCategory(s,"account_details","cancel_account_open")},l=function(e,t){e.removeClass("valid invalid invalid-long").find("input").val("").attr("type","password"),t.addClass("hidden").find(".password_char_viewer").removeClass("od-passengersmanager-input-pass-icon-hide").addClass("od-passengersmanager-input-pass-icon-show")};e.exports=Odigeo.View.extend({events:{"tap .old_password_icon":"onTapOldPasswordIcon","tap .new_password_icon":"onTapNewPasswordIcon","input .account_pref_old_pass":"onInputAccountPrefOldPass","input .account_pref_new_pass":"onInputAccountPrefNewPass","tap .account_pref_change_passBtn":"onTapAccountPrefChangePassBtn","tap .account_pref_change_pass_link":"onTapChangePassLink","tap .change_pass_close":"onTapChangePassClose","tap .account_pref_cancel_account_link":"onTapCancelAccountLink"},selectors:{accountPrefBody:".account_pref_body",accountPrefEmail:".account_pref_email",accountPrefPassword:".account_pref_password",accountPrefOldPass:".account_pref_old_pass",accountPrefNewPass:".account_pref_new_pass",accountPrefOldPassWrapper:".account_pref_old_pass_wrapper",accountPrefNewPassWrapper:".account_pref_new_pass_wrapper",accountPrefNotification:".account_pref_notification_changed",accountPrefError:".account_pref_notification_error",accountPrefErrorTxt:".account_pref_notification_error_txt",accountTitle:".account_title",accountPrefClearInput:".clear_input",allFocused:'input:not([type="hidden"]), select',cancelHint:".account_pref_cancel_account",changePassView:".change_pass_container",newPasswordIcon:".new_password_icon",oldPasswordIcon:".old_password_icon"},init:function(){this.listenTo(this.model,"change:userDTO",function(e){(function(e){var t,i=_.get(e,"membershipInfoDTO.membershipDTO"),n=(t=i,_.isObject(t)&&!Odigeo.Utils.isRequestApp("dp")),a=n?r:o,s=this.keys,l=this.$el,g=this.selectors,h=this.templates,u={membershipPriceDisplayEnabled:n,keys:s};l.find(g.accountTitle).html(h.accountTitle(u)),this.cancelAccountWidget=a.create({id:"cancel-account",trackOpenDialog:d}),n&&_.each(c,function(e){var t=e.factory,n=e.id;return t.create({id:n,options:{membershipDTO:i}})})}).call(this,e.get("userDTO"))}),Odigeo.UIElements.fade.enhance(this.$cachedSelectors.accountPrefNotification),Odigeo.UIElements.fade.enhance(this.$cachedSelectors.accountPrefError)},onTapOldPasswordIcon:function(){this._changeCharsViewer("oldPasswordIcon",this.$cachedSelectors.accountPrefOldPass)},onTapNewPasswordIcon:function(){this._changeCharsViewer("newPasswordIcon",this.$cachedSelectors.accountPrefNewPass)},onInputAccountPrefOldPass:function(){this.$cachedSelectors.oldPasswordIcon.removeClass("hidden")},onInputAccountPrefNewPass:function(){this.$cachedSelectors.newPasswordIcon.removeClass("hidden")},onTapAccountPrefChangePassBtn:(n=function(){this.changePassword()},function(e){e.stopPropagation(),e.preventDefault(),n.call(this)}),onTapChangePassLink:function(){a.trackEventWithCategory(s,"account_details","change_password"),this.clearPasswordFields(),this.$cachedSelectors.changePassView.addClass("open opened"),Odigeo.trigger(this.widget.id+":openDialog",!0)},onTapChangePassClose:function(){this.clearPasswordFields(),this.$cachedSelectors.changePassView.removeClass("open opened"),Odigeo.trigger(this.widget.id+":openDialog",!1)},onTapCancelAccountLink:function(){this.cancelAccountWidget.execute("open")},hideHint:function(){this.$cachedSelectors.changePassView.removeClass("open opened")},showDetails:function(){if(this.$cachedSelectors.allFocused.on(Odigeo.Events.focus,_.bind(this.focusHandler,this)),this.$cachedSelectors.allFocused.on(Odigeo.Events.blur,_.bind(this.blurHandler,this)),_.isEmpty(this.$cachedSelectors.cancelHint)||this.hideHint(),this.$cachedSelectors.accountPrefNotification.addClass("hidden"),this.$cachedSelectors.accountPrefError.addClass("hidden"),this.model.get("passwordChanged")&&this.$cachedSelectors.accountPrefNotification.trigger("fadeElement"),this.$cachedSelectors.accountPrefEmail.empty().append(this.model.get("userDTO").email),this.$cachedSelectors.accountPrefPassword.toggleClass("odf-hidden",!this.model.get("isActive")),this.$cachedSelectors.accountPrefBody.removeClass("hidden"),!_.isEmpty(this.model.get("errorPsw"))){var e=function(){var e=this.model.get("errorPsw"),t=this.model.get("errors");return _.isUndefined(t[e])?t.default:t[e]}.call(this);"loginerror"===e?this.$cachedSelectors.accountPrefOldPassWrapper.removeClass("valid").addClass("invalid").find(".error_message").text(this.$cachedSelectors.accountPrefOldPass.data(e)):(this.$cachedSelectors.accountPrefErrorTxt.text(this.$cachedSelectors.accountPrefError.data(e)).trigger("fadeElement"),this.$cachedSelectors.accountPrefError.trigger("fadeElement")),this.$cachedSelectors.changePassView.addClass("open opened")}_.isEmpty(this.model.get("error"))||this.$cachedSelectors.accountPrefError.trigger("fadeElement"),this.$cachedSelectors.accountPrefClearInput.off().on(Odigeo.Events.tap,function(e){var t=$(e.currentTarget).closest(".input_wrapper"),i=t.find("input");i.val(""),t.addClass("invalid").removeClass("valid"),i.focus()}),this.model.set("passwordChanged",!1)},focusHandler:function(e){$(e.target).closest(".input_wrapper").addClass("focused").removeClass("valid empty")},blurHandler:function(e){var t=$(e.target),i=t.closest(".input_wrapper"),n=this.checkPasswordValidity(t);i.removeClass("focused").toggleClass("valid",n).toggleClass("invalid",!n),n||i.find(".error_message").text(this.$cachedSelectors.accountPrefError.data("incorrectformat"))},_changeCharsViewer:function(e,t){this.$cachedSelectors[e].find(".password_char_viewer").toggleClass("od-passengersmanager-input-pass-icon-show").toggleClass("od-passengersmanager-input-pass-icon-hide"),t.attr("type","password"===t.attr("type")?"text":"password")},changePassword:function(){var e=this.$cachedSelectors.accountPrefOldPass,t=this.$cachedSelectors.accountPrefNewPass,i={oldPassword:e.val(),newPassword:t.val()},n=this.$cachedSelectors.accountPrefError.data("incorrectformat"),s=n.length>this.errorMaxLength;this.checkPasswordValidity(e)&&this.checkPasswordValidity(t)?(this.$cachedSelectors.accountPrefOldPassWrapper.removeClass("invalid-long"),this.$cachedSelectors.accountPrefNewPassWrapper.removeClass("invalid-long"),a.trackEventWithCategory("sso_module","change_password","change_password"),Odigeo.trigger(this.widget.id+":submitUserRequest",{action:"changePassword",data:i})):(this.checkErrors(e,this.$cachedSelectors.accountPrefOldPassWrapper,s,n),this.checkErrors(t,this.$cachedSelectors.accountPrefNewPassWrapper,s,n))},checkPasswordValidity:function(e){return!_.isEmpty(e.val())&&Odigeo.Utils.isValidPassword(e.val(),!0)},checkErrors:function(e,t,i,n){this.checkPasswordValidity(e)||t.addClass(i?"invalid-long":"invalid").find(i?".error_long_message":".error_message").text(n)},clearPasswordFields:function(){l(this.$cachedSelectors.accountPrefOldPassWrapper,this.$cachedSelectors.oldPasswordIcon),l(this.$cachedSelectors.accountPrefNewPassWrapper,this.$cachedSelectors.newPasswordIcon)}})},function(e,t,i){"use strict";var n=i(13),a=i(18),s=function(e){return function(){this.$el.toggleClass("open opened",e)}},r=s(!0),o=s(!1);e.exports=a(n.extend({name:"membership_cancel_account",initialize:function(e){this.trackOpenDialog=e.trackOpenDialog},events:{"tap .cancel_member_account_close":"onClose"},onClose:o,open:function(){this.trackOpenDialog(),r.call(this)}}))},function(e,t,i){"use strict";var n=i(10);e.exports=n({viewClass:i(788),methods:{open:function(){this.open()}}})},function(e,t,i){"use strict";var n=i(13),a=i(18),s=i(0),r=function(e){return function(){this.$el.toggleClass("open opened",e)}},o=r(!0),c=r(!1);e.exports=a(n.extend({name:"cancel_account",initialize:function(e){n.prototype.initialize.call(this,e),this.trackOpenDialog=e.trackOpenDialog},events:{"tap .cancel_account_close":"onClose","tap .account_pref_cancel_account_btn":"onTapCancelAccount","tap .account_pref_return":"onTapReturnButton"},onClose:c,onTapCancelAccount:function(e){e.stopPropagation(),e.preventDefault(),s.trackEventWithCategory("my_area_account","account_details","cancel_account_yes"),Odigeo.Session.set("dontDisplayGoogleOneTap",!0),Odigeo.trigger(this.id+":submitUserRequest",{action:"cancelAccount",data:""})},onTapReturnButton:function(e){e.stopPropagation(),e.preventDefault(),c.call(this)},open:function(){this.trackOpenDialog(),o.call(this)}}))},function(e,t,i){"use strict";var n=i(10);e.exports=n({viewClass:i(790)})},function(e,t,i){"use strict";var n=i(13),a=i(18),s=[{id:"membership-subscription-details",factory:i(791)},{id:"membership-customer-service",factory:i(794)},{id:"membership-benefits",factory:i(796)}];e.exports=a(n.extend({name:"membership_account_preferences",initialize:function(e){n.prototype.initialize.call(this,e),_.each(s,function(e){var t=e.factory,i=e.id;return t.create({id:i})}),Odigeo.trigger(this.id+":renderOk",e.membershipDTO)}}))},function(e,t,i){"use strict";var n=i(10);e.exports=n({viewClass:i(792),modelClass:i(793)})},function(e,t,i){"use strict";var n=i(13),a=i(18),s=i(167);e.exports=a(s(n.extend({name:"membership_subscription_details",initialize:function(){_.extend(this.options,{minSavings:1e4}),this.updateDomSelectorsToCache(),this.listenTo(this.model,"change:memberSubscriptionDetailsDTO",this.initTemplate)},selectors:{subscriptionDetailsWrapper:".account_pref_membership_subscription_details"},initTemplate:function(){var e=this.model.get("memberSubscriptionDetailsDTO");Odigeo.trigger(this.id+":onSubscriptionDetailsChange",e),_.isObject(e)&&e.totalSavings&&this.isPrimeSavingsPositive(e.totalSavings.amount)&&this.$cachedSelectors.subscriptionDetailsWrapper.append(this.createSubscriptionDetailsTemplate(e.totalSavings))},isPrimeSavingsPositive:function(e){return this.options.minSavings+e<0},getCurrencyConfig:function(){return _.clone(Odigeo.Utils.Currency,{})},getFormattedDescriptionText:function(e,t){var i=this.getCurrencyConfig();return _.isEqual(t,i.currencyCode)?Odigeo.Utils.replaceCmsKeyArgs(this.keys.memberAccountSavingsDescription,Odigeo.Utils.formatCurrency(e,i)):Odigeo.Utils.replaceCmsKeyArgs(this.keys.memberAccountSavingsDescription,e.toString().concat(" ",t))},createSubscriptionDetailsTemplate:function(e){return _.isObject(e)||e.amount||e.currency?$(this.templates.subscriptionDetails({savingsTitle:this.keys.memberAccountSavingsTitle,savingsDescription:this.getFormattedDescriptionText(Math.abs(e.amount),e.currency)})):null}})))},function(e,t,i){"use strict";e.exports=Backbone.Model.extend({initialize:function(){this.fetch(this.getDataRequestSettings())},dataUrl:"getsubscriptiondetails",url:function(){return Odigeo.Settings.getProperty("membershipServiceFormatter")(this.dataUrl)},getDataRequestSettings:function(){return{type:"GET"}}})},function(e,t,i){"use strict";var n=i(10);e.exports=n({viewClass:i(795)})},function(e,t,i){"use strict";var n=i(18);e.exports=n(Backbone.View.extend({name:"membership_customer_service"}))},function(e,t,i){"use strict";var n=i(10);e.exports=n({viewClass:i(797),isEnabled:function(){return Odigeo.Membership.enabledSpecialPrimeWidgets}})},function(e,t,i){"use strict";var n=i(18);e.exports=n(Backbone.View.extend({name:"membership_benefits"}))},function(e,t,i){"use strict";Odigeo.defineWidget("frequent_passengers_manager",Odigeo.Widget.extend({modelClass:i(799),viewClass:i(800),getAccountInfoOk:function(e){this.model.initialized||(this.model.userDTO=e.userDTO),this.view.setTemplate(),_.isEmpty(this.model.userID)?this.view.showPassengers():"new"===this.model.userID?this.view.showEditorNew():this.view.showEditorModify(this.model.userID)},updateAccountInfoResponse:function(e){if(e&&e.responseOK){var t=decodeURIComponent(Odigeo.Utils.readCookie("sso_remember_me")).split(";"),i=t[0]||"",n=[i,e.displayName||i].concat(t.splice(2,t.length-1)),a=encodeURIComponent(n.join(";"));Odigeo.Utils.createCookie("sso_remember_me",a),Odigeo.trigger(this.id+":ssoRememberMeCookieUpdated"),this.model.userDTO=e.userDTO}else this.model.action="error";_.isEmpty(this.model.userID)?(this.view.setTemplate(),this.view.showPassengers()):Odigeo.Router.navigate("frequentpassengers",{})},setUserID:function(e){this.model.userID=e.userID,this.view.loading()},execute:function(e,t){var i={getAccountInfoOk:"getAccountInfoOk",updateAccountInfoOk:"updateAccountInfoResponse",updateAccountInfoWithError:"updateAccountInfoResponse",updateAccountInfoError:"updateAccountInfoResponse",loadUser:"loadUser",setUserID:"setUserID"};return this[i[e]]&&this[i[e]](t),this}}))},function(e,t,i){"use strict";e.exports=Odigeo.Model.extend({initialized:!1,action:null,actions:{save:"freqPassNotifSaved",delete:"freqPassNotifDelete",error:"freqPassNotifFatalError"},userDTO:null,bindPassengerDetail:!1,templateSeted:!1,travellerTitle:["MR","MRS","MS"],travellerPhonePattern:"^[0-9]{7,13}$",userID:null,validationTypes:{REGEX_VALIDATOR:"REGEX_VALIDATOR",NULL_VALIDATOR:"NULL_VALIDATOR"},traveller:{buyer:!1,typeOfTraveller:"ADULT",frequentFlyerList:[],profile:{gender:"",title:"",name:"",middleName:null,firstLastName:"",secondLastName:null,birthDate:null,prefixPhoneNumber:null,phoneNumber:null,prefixAlternatePhoneNumber:null,mobilePhoneNumber:null,alternatePhoneNumber:null,isDefault:!1,cpf:null,nationalityCountryCode:null,identificationList:[],address:null},importedFromLocal:!1},address:{address:null,addressType:"-",city:null,country:null,postalCode:null,isPrimary:!0,alias:null,state:null}})},function(e,t,i){"use strict";var n=i(0),a=i(7);e.exports=Odigeo.View.extend({templateSettings:{evaluate:/\{\{#([\s\S]+?)\}\}/g,interpolate:/\{\{[^#\{]([\s\S]+?)[^\}]\}\}/g,escape:/\{\{\{([\s\S]+?)\}\}\}/g},selectors:{allFocused:'input:not([type="hidden"]), select',freqPassBody:".freq_pass_body",freqPassClearInput:".clear_input",freqPassNotifSaved:".freq_pass_notification_saved",freqPassNotifDelete:".freq_pass_notification_delete",freqPassNotifError:".freq_pass_notification_error",freqPassNotifFatalError:".freq_pass_notification_fatalerror",freqPassEdit:".freq_pass_edit",freqPassEditDelete:".freq_pass_edit_delete",freqPassEditDeleteLink:".freq_pass_edit_delete_link",freqPassEditDeleteHint:".freq_pass_delete_hint",freqPassEditDeleteView:".freq_pass_edit_delete_overlay",freqPassEditDeleteClose:".freq_pass_edit_delete_close",freqPassEditDeleteBtn:".freq_pass_edit_deleteBtn",freqPassEditDiscardView:".freq_pass_edit_discard_overlay",freqPassEditDiscardLink:".freq_pass_edit_discard_changes",freqPassEditDiscardClose:".freq_pass_edit_discard_close",freqPassEditReturnBtn:".freq_pass_edit_returnBtn",freqPassFormContactInfo:".freq_pass_form_contact_info",freqPassList:".freq_pass_list",freqPassMainPass:".freq_pass_main_pass",freqPassNewBtn:".freq_pass_newBtn",freqPassNew:".freq_pass_new",freqPassReturn:".freq_pass_return",templateBody:".freq_pass_body_template",templateItem:".freq_pass_items_template",overviewOverlay:".overview_delete_passenger_overlay",overviewClose:".overview_delete_passenger_close",overviewCloseNo:".overview_delete_passenger_close_no",overviewDelete:".overview_delete_passenger_yes"},events:{"tap .freq_pass_newBtn":"goToTappedNewPassenger","tap .freq_pass_edit":"goToTappedPassenger","tap .freq_pass_saveNewBtn":"savePassenger","tap .freq_pass_return":"onTapFreqPassReturn","tap .freq_pass_edit_deleteBtn":"onTapFreqPassDelete","tap .clear_input":"onClearInput","tap .freq_pass_edit_discard_changes":"onOpenDiscardView","tap .freq_pass_edit_discard_close":"onCloseDiscardView","tap .freq_pass_edit_delete_link":"onOpenDeleteView","tap .freq_pass_edit_delete_close":"onCloseDeleteView","tap .freq_pass_edit_returnBtn":"onCloseDeleteView","tap .freq_pass_delete_hint":"onTapDeleteHint","tap .overview_delete_passenger_close":"onTapOverviewClose","tap .overview_delete_passenger_close_no":"onTapOverviewClose","tap .overview_delete_passenger_yes":"deletePassenger","change .freq_pass_main_pass":"onChangeMainPassenger",'focus input:not([type="hidden"]), select':"_focusHandler"},_focusHandler:function(e){$(e.target).closest(".input_wrapper").addClass("focused")},_tracktEvent:function(e,t,i){n.trackEventWithCategory(i,e,t)},trackEnsightenPage:function(e){a.updateDatalayer(),Odigeo.Utils.ensighten({page_name:e,page_type:"general"})},checkEmpty:function(e){return!_.isEmpty(e.val())},checkRequiredEmpty:function(e){return"required"===e.attr("required")&&!this.checkEmpty(e)},checkValidity:function(e){var t=e.data(),i=e.val(),n=!0;switch(e.data("validationType")){case this.model.validationTypes.REGEX_VALIDATOR:"required"!==e.attr("required")&&""===i||(n=new RegExp(t.pattern).test(i));break;case this.model.validationTypes.NULL_VALIDATOR:n=!!i;break;default:return!0}return n},isProfileElement:function(e){return!_.isUndefined(this.model.traveller.profile[e])&&"address"!==e},isAddressElement:function(e){return!_.isUndefined(this.model.address[e])&&this.$el.find(this.selectors.freqPassMainPass).is(":checked")},createPassengerListeners:function(){var e=this.$el.find("[data-name]");_.each(e,function(e){_.isEmpty($(e).val())||$(e).closest(".input_wrapper").addClass("valid")}),e.on(Odigeo.Events.blur,_.bind(function(e){var t=$(e.currentTarget),i=t.closest(".input_wrapper").removeClass("invalid empty focused").toggleClass("valid",!_.isEmpty(t.val()));!this.isProfileElement(t.data("name"))&&!this.isAddressElement(t.data("name"))||this.checkValidity(t)&&!this.checkRequiredEmpty(t)||i.addClass("empty").removeClass("valid")},this)),this.model.bindPassengerDetail=!0},setTemplate:function(){null===this.model.userDTO||null===this.model.userDTO.traveller||this.model.initialized&&!_.isEmpty(this.model.userID)||(this.$el.html(this.templates.main({keys:this.keys})),this.$el.find(this.selectors.freqPassBody).empty().append(this.templates.frequentPassengersItems({model:this.getExtendedData(this.model),keys:this.keys})),this.model.initialized=!0,Odigeo.UIElements.fade.enhance(this.$el.find(this.selectors.freqPassNotifSaved)),Odigeo.UIElements.fade.enhance(this.$el.find(this.selectors.freqPassNotifDelete)),Odigeo.UIElements.fade.enhance(this.$el.find(this.selectors.freqPassNotifFatalError))),this.$el.find(this.selectors.freqPassNew).addClass("hidden"),this.$el.find(this.selectors.freqPassList).removeClass("hidden"),this.$el.find(this.selectors.freqPassBody).removeClass("hidden"),this.$el.find(this.selectors.freqPassEditDelete).addClass("hidden"),this.$el.find(this.selectors.freqPassNotifError).addClass("hidden")},getExtendedData:function(e){return _.extend(e,{countries:Odigeo.UserArea.countries,passengerRegexValidation:Odigeo.UserArea.passengerRegexValidation,addressRegexValidation:Odigeo.UserArea.addressRegexValidation})},showPassengers:function(){this.trackEnsightenPage("frequentpassengers"),Odigeo.trigger(this.widget.id+":changePageTitle","main"),_.isUndefined(this.model.actions[this.model.action])||this.$el.find(this.selectors[this.model.actions[this.model.action]]).trigger("fadeElement"),this.model.action=""},goToTappedNewPassenger:function(){Odigeo.Router.navigate("frequentpassengers",{params:"new"})},goToTappedPassenger:function(e){var t;e.preventDefault(),t=$(e.currentTarget).data("index"),Odigeo.Router.navigate("frequentpassengers",{params:t})},showEditor:function(e,t){var i=this.$el.find(this.selectors.freqPassMainPass);this.$el.find(this.selectors.freqPassList).addClass("hidden"),this.$el.find(this.selectors.freqPassNew).removeClass("hidden"),t&&this.$el.find(this.selectors.allFocused).find("option[selected]").prop("selected",!0),n.trackEventWithCategory("my_area_pax","passenger_list",t?"add_new_passenger":"edit_passeger"),Odigeo.trigger(this.widget.id+":changePageTitle",t?"new":"edit"),i.prop("disabled",!!e&&"disabled").prop("checked",!!e),Odigeo.UIElements.collapsive.enhance(this.$el.find(this.selectors.freqPassFormContactInfo),{initiallyExpanded:e}),this.$el.find(this.selectors.freqPassEditDelete).toggleClass("hidden",e||t),this.createPassengerListeners()},showEditorNew:function(){this.trackEnsightenPage("frequentpassengers/new");var e=(Odigeo.UserArea.countryId||"").toUpperCase();_.each(this.$el.find("[data-name]"),function(t){t.value=/^(country|prefixPhoneNumber)$/.test(t.getAttribute("data-name"))?e:""}),this.$el.find("#freq_pass_position").val(""),this.showEditor(_.isEmpty(this.model.userDTO.traveller),!0)},showEditorModify:function(e){this.trackEnsightenPage("frequentpassengers/edit");var t=this.model.userDTO.traveller[e],i=void 0,n=(Odigeo.UserArea.countryId||"").toUpperCase();this.$el.find("#freq_pass_position").val(e),_.each(this.$el.find("[data-name]"),function(e){i=e.getAttribute("data-name"),e.value=/^(country|prefixPhoneNumber)$/.test(i)?n:e.value,_.isEmpty(t.profile[i])||"address"===i?null===t.profile.address||_.isEmpty(t.profile.address[i])||(e.value=t.profile.address[i]):e.value=t.profile[i],$(e).removeClass("od-freq-pass-error")}),_.isEmpty(t.profile.name)||$("#travellerName").text(t.profile.name+(t.profile.firstLastName?" "+t.profile.firstLastName:"")),this.showEditor(t.profile.isDefault,!1)},deletePassenger:function(e){var t,i;e.preventDefault(),n.trackEventWithCategory("my_area_pax","pax_details","delete_pax_yes"),t=$(e.currentTarget).data("index"),i=this.model.userDTO.traveller[t].id,this.model.action="delete",Odigeo.trigger(this.widget.id+":submitUserRequest",{action:"deletePassenger",data:{id:i,saveAfterUpdate:!0}},!0)},deletePassengerOnEdit:function(){var e,t=this.$el.find("#freq_pass_position").val();n.trackEventWithCategory("my_area_pax","pax_details","delete_pax_open"),e=this.model.userDTO.traveller[t].id,"delete"!==this.model.action&&(this.model.action="delete",Odigeo.trigger(this.widget.id+":submitUserRequest",{action:"deletePassenger",data:{id:e,saveAfterUpdate:!0}},!0))},savePassenger:function(){var e=this.fillErrors(),t=this.$el.find("#freq_pass_position").val(),i=_.isEmpty(t)?JSON.parse(JSON.stringify(this.model.traveller)):this.model.userDTO.traveller[t],a=this.$el.find(this.selectors.freqPassMainPass).is(":checked");this.$el.find(this.selectors.freqPassNotifError).find("ul").empty(),_.isEmpty(e)?(this.$el.find(this.selectors.freqPassNotifError).addClass("hidden"),this.fillTraveller(i),a&&this.uncheckMainTravellers(),i.profile.isDefault=a,n.trackEventWithCategory("my_area_pax","pax_details","save_pax"),"save"!==this.model.action&&(this.model.action="save",Odigeo.trigger(this.widget.id+":submitUserRequest",{action:"savePassenger",data:{traveller:i,saveAfterUpdate:!0}},!0))):(this.$el.find(this.selectors.freqPassNotifError).find("ul").append(e),this.$el.find(this.selectors.freqPassNotifError).removeClass("hidden"),n.trackEventWithCategory("my_area_pax","pax_details","save_pax_FE_error"),_.isEmpty(this.$el.find(this.selectors.freqPassEditDiscardLink))||this.$el.find(this.selectors.freqPassEditDiscardLink).trigger("hideHint",!1),this.$el.find(this.selectors.freqPassEditDiscardView).removeClass("open opened"))},fillErrors:function(){var e="";return _.each(this.$el.find("[data-name]"),_.bind(function(t){var i=$(t).closest(".input_wrapper");i.removeClass("invalid empty focused"),_.isEmpty($(t).val())||i.addClass("valid"),(!_.isUndefined(this.model.traveller.profile[t.getAttribute("data-name")])&&"address"!==t.getAttribute("data-name")||!_.isUndefined(this.model.address[t.getAttribute("data-name")])&&this.$el.find(this.selectors.freqPassMainPass).is(":checked"))&&(!1===this.checkValidity($(t))?(e+="<li>"+t.getAttribute("data-error")+"</li>",i.addClass("empty").removeClass("valid")):_.isNull(t.getAttribute("required"))||this.checkEmpty($(t))||(e+="<li>"+t.getAttribute("data-mandatory")+"</li>",i.addClass("empty").removeClass("valid")))},this)),e},fillTraveller:function(e){_.each(this.$el.find("[data-name]"),function(t){_.isUndefined(this.model.traveller.profile[t.getAttribute("data-name")])||"address"===t.getAttribute("data-name")?!this.$el.find(this.selectors.freqPassMainPass).is(":checked")||_.isUndefined(this.model.address[t.getAttribute("data-name")])||_.isEmpty(t.value)||(_.isEmpty(e.profile.address)&&(e.profile.address=this.model.address),e.profile.address[t.getAttribute("data-name")]=t.value):(e.profile=_.isEmpty(e.profile)?this.model.traveller.profile:e.profile,e.profile[t.getAttribute("data-name")]=t.value,"title"===t.getAttribute("data-name")&&(e.profile.gender="MR"===t.value?"MALE":"FEMALE"))},this)},uncheckMainTravellers:function(){_.each(this.model.userDTO.traveller,_.bind(function(e){e.profile.isDefault=!1,Odigeo.trigger(this.widget.id+":submitUserRequest",{action:"savePassenger",data:{traveller:e,saveAfterUpdate:!1}},!0)},this))},loading:function(){var e=this.$el.find(this.selectors.freqPassBody);e.addClass("hidden"),e.find(".freq_pass_list").addClass("hidden"),e.find(".freq_pass_new").addClass("hidden"),this.$el.find(".freq_pass_edit_delete").addClass("hidden")},onChangeMainPassenger:function(e){this.$el.find(this.selectors.freqPassFormContactInfo).trigger($(e.currentTarget).is(":checked")?"expandPanel":"collapsePanel")},onTapFreqPassReturn:function(){this.$el.find(this.selectors.freqPassNotifError).addClass("hidden"),n.trackEventWithCategory("my_area_pax","pax_details","discard_changes"),Odigeo.Router.navigate("frequentpassengers",{})},onTapFreqPassDelete:function(e){e.stopPropagation(),e.preventDefault(),_.delay(_.bind(function(){this.$el.find(this.selectors.freqPassEditDeleteView).removeClass("open opened"),this.deletePassengerOnEdit()},this),300)},onClearInput:function(e){var t=$(e.currentTarget).closest(".input_wrapper"),i=t.find("input");e.stopPropagation(),e.preventDefault(),i.val(""),this.checkRequiredEmpty(i)&&t.addClass("empty").removeClass("valid"),i.focus()},onOpenDiscardView:function(){this.$el.find(this.selectors.freqPassEditDiscardView).addClass("open opened")},onCloseDiscardView:function(){this.$el.find(this.selectors.freqPassEditDiscardView).removeClass("open opened")},onOpenDeleteView:function(){this.$el.find(this.selectors.freqPassEditDeleteView).addClass("open opened")},onCloseDeleteView:function(){this.$el.find(this.selectors.freqPassEditDeleteView).removeClass("open opened")},onTapDeleteHint:function(e){var t=$(e.currentTarget).data("index");$(this.$el.find('.overview_delete_passenger_overlay[data-index="'+t+'"]')).addClass("open opened")},onTapOverviewClose:function(e){var t=$(e.currentTarget).data("index");$(this.$el.find('.overview_delete_passenger_overlay[data-index="'+t+'"]')).removeClass("open opened")}})},function(e,t,i){"use strict";Odigeo.defineWidget("login_expired_manager",Odigeo.Widget.extend({modelClass:i(802),viewClass:i(803),showLoginError:function(e){this.view._isAccountBlocked(e)?this.view.launchAccountBlockedFlow():this.view._showError(this.model.errors[e.messageError])},renderCaptcha:function(){this.view.renderCaptcha()}}))},function(e,t,i){"use strict";e.exports=Odigeo.Model.extend({action:null,cookie:null,mail:null,name:null,membership:null,typeLogin:null,defaults:{recaptchaWidgetID:null,recaptchaRendered:!1},data:{},errors:{AUTH_000:"loginerror",STA_009:"accountblocked",STA_000:"accountblocked",VAL_000:"empty",VAL_002:"invalid",VAL_003:"invalid",SSO_006:"requesterror",RCP_001:"recaptchaError",STO_000:"remoteError",default:"requesterror"},init:function(){var e=Odigeo.Utils.readCookie("sso_remember_me");_.isNull(e)&&Odigeo.Utils.goToApplicationHome(),this.cookie=decodeURIComponent(e),this.mail=this.cookie.split(";")[0],this.name=this.cookie.split(";")[1],this.membership="true"===this.cookie.split(";")[2],this.typeLogin=this.cookie.split(";")[3]}})},function(e,t,i){"use strict";var n=i(0),a=i(39);e.exports=Odigeo.View.extend({events:{"tap .freq_pass_newBtn":"goToTappedNewPassenger","tap .freq_pass_edit":"goToTappedPassenger","tap .loginexpired_login_button":"login","keyup .user_login":"keyPressed","tap .password_icon":"changePasswordCharsViewer","tap .close_session":"closeSession"},selectors:{passwordInput:".loginexpired_password_input",loginUserWithPassword:".login_user_with_password",passwordIcon:".password_icon",rememberLogout:".remember_logout",loginUserWithSocial:".login_user_with_social",loginUserWithGoogle:".login_user_with_google",loginUserWithFacebook:".login_user_with_facebook",welcomeBack:".welcome_back",welcomeBackTemplate:".welcome_back_template",loginExpiredWaiting:".loginexpired_waiting",loginExpiredError:".login_expired_error",recaptchaWrapper:".g_recaptcha_login_expired"},init:function(){this.widget.options={recaptchaLoginEnabled:Odigeo.AB.isRecaptchaLoginEnabled,recaptchaSiteKey:Odigeo.UserArea.recaptchaSiteKey},this.bindToDom(),this.cacheDomSelectors(),this.renderRememberLogout(),this.loadloginForm(),this.widget.options.recaptchaLoginEnabled&&(a.isGRecaptchaLoaded?this.renderCaptcha():a.init())},renderCaptcha:function(){this.widget.options.recaptchaLoginEnabled&&!this.model.get("recaptchaRendered")&&(this.model.set("recaptchaWidgetID",a.gRecaptchaRender(this.$cachedSelectors.recaptchaWrapper.get(0),_.bind(this.recaptchaExecutionCallback,this),this.widget.options.recaptchaSiteKey)),this.model.set("recaptchaRendered",!0))},recaptchaExecutionCallback:function(){this.model.data.recaptchaResponse=a.gRecaptchaGetResponse(this.model.get("recaptchaWidgetID")),this.triggerSubmitRequest()},loadloginForm:function(){var e=this.model.typeLogin,t=_.bind(function(e,t){this.$cachedSelectors.loginExpiredWaiting.addClass("odf-hidden").removeClass("active"),this.$cachedSelectors.loginUserWithPassword.toggleClass("odf-hidden",e),this.$cachedSelectors.loginUserWithSocial.toggleClass("odf-hidden",!e),this.$cachedSelectors.loginUserWithGoogle.toggleClass("odf-hidden",!(e&&"google"===t)),this.$cachedSelectors.loginUserWithFacebook.toggleClass("odf-hidden",!(e&&"facebook"===t))},this),i=0<this.$cachedSelectors.welcomeBack.length&&_.includes(["facebook","google"],e);if(i){Odigeo.trigger(this.widget.id+":initEmbedLogin",e);var n=Odigeo.Utils.replaceCmsKeyArgs(this.keys.welcomeBack,this.model.name);this.$cachedSelectors.welcomeBack.empty().append(n),Odigeo.Session.set("socialLoginExpired",!0)}t(i,e)},cacheDomSelectors:function(){this.addSelectorToCache("allInputs",this.$cachedSelectors.loginUserWithPassword.find('[data-name]:not([type="hidden"])'))},bindToDom:function(){this.$el.on("input",this.selectors.passwordInput,_.bind(this.showPasswordCharsIcon,this))},renderRememberLogout:function(){var e=Odigeo.Utils.replaceCmsKeyArgs(this.keys.notName,this.model.name),t=this.keys.logout;this.$cachedSelectors.rememberLogout.empty().append(this.templates.rememberMe({keys:{notName:e,logout:t}}))},keyPressed:_.debounce(function(e){13===(e.keyCode?e.keyCode:e.which)&&this.login()},300),login:function(){this.$cachedSelectors.passwordInput.closest(".input_wrapper").removeClass("invalid"),this.checkPassword()&&(n.trackEventWithCategory("sso_expired","sign_in","sign_in"),this.model.data={login:this.model.mail,password:this.$cachedSelectors.passwordInput.val()},this.hideGenericError(),this.widget.options.recaptchaLoginEnabled&&this.model.get("recaptchaRendered")?a.gRecaptchaExecute(this.model.get("recaptchaWidgetID")):this.triggerSubmitRequest())},triggerSubmitRequest:function(){Odigeo.trigger(this.widget.id+":submitUserRequest",{data:this.model.data,action:"login"})},checkPassword:function(){var e,t=this.$cachedSelectors.passwordInput.val(),i=this.$cachedSelectors.passwordInput.data(),n=!1;return _.isEmpty(t)?e="empty":i&&i.validationType&&!Odigeo.Utils.isValid(i.validationType,t)?e="invalid":n=!0,n||this._showError(e),n},launchAccountBlockedFlow:function(){Odigeo.Utils.eraseCookie("sso_remember_me"),Odigeo.trigger(this.widget.id+":submitUserRequest",{data:this.model.mail,action:"recoverPassword"}),Odigeo.Router.navigate("accountblocked")},changePasswordCharsViewer:function(){this.$cachedSelectors.passwordIcon.find(".password_char_viewer").toggleClass("odf-hidden"),this.$cachedSelectors.passwordInput.attr("type","password"===this.$cachedSelectors.passwordInput.attr("type")?"text":"password")},showPasswordCharsIcon:function(){this.$cachedSelectors.passwordIcon.removeClass("odf-hidden"),this.$el.off("input",this.selectors.passwordInput)},closeSession:function(){this.$cachedSelectors.loginUserWithPassword.addClass("odf-hidden"),this.$cachedSelectors.loginUserWithSocial.addClass("odf-hidden"),this.$cachedSelectors.loginExpiredWaiting.addClass("active").removeClass("odf-hidden"),n.trackEventWithCategory("sso_module","sign_in","close_session_clicks"),Odigeo.Utils.eraseCookie("sso_remember_me"),Odigeo.Session.set("dontDisplayGoogleOneTap",!0),Odigeo.Utils.goToApplicationHome()},_showError:function(e){var t;this.widget.options.recaptchaLoginEnabled&&a.gRecaptchaReset(this.model.get("recaptchaWidgetID"));var i=this.$cachedSelectors.passwordInput.closest(".input_wrapper");-1!==(e=_.isUndefined(e)?"requesterror":e).indexOf("recaptcha")?(this.showGenericError("recaptchaerror"),n.trackEventWithCategory(Odigeo.Utils.isHomePage()?"home":Odigeo.History.getPageNameFromFragment(),"recaptcha_error","odigeo_recaptcha_error_sign-on")):"remoteError"===e?this.showGenericError("remoteerror"):(t=this.$cachedSelectors.passwordInput.data(e),"invalid"===e&&n.trackEventWithCategory("sso_expired","sign_in","sso_email_pci_compliance_error"),i.addClass("invalid"),i.find(".error_message").text(t))},showGenericError:function(e){var t=this.$cachedSelectors.loginExpiredError.data(e);this.$cachedSelectors.loginExpiredError.find(".msg_content").text(t),this.$cachedSelectors.loginExpiredError.removeClass("odf-hidden")},hideGenericError:function(){this.$cachedSelectors.loginExpiredError.addClass("odf-hidden")},_tracktEvent:function(e,t,i){n.trackEventWithCategory(i,e,t)},_isAccountBlocked:function(e){return e&&e.messageError&&"accountblocked"===this.model.errors[e.messageError]}})},function(e,t,i){"use strict";Odigeo.defineWidget("my_trips",Odigeo.Widget.extend({modelClass:i(805),viewClass:i(806),showGtBannerNoBookings:function(){this.view._showGtBannerNoBookings()},getMyTripsOk:function(e){this.view._loadTrips(e)},hideManageMyBookingBox:function(e){this.view.hideManageMyBookingBox(e)},showManageMyBookingBox:function(e){this.view.showManageMyBookingBox(e)},loadOpenBookingDetails:function(e){this.view._loadOpenBookingDetails(e)},openLightBoxMsg:function(e){this.view.openLightBoxMsg(e)},init:function(){this.options=Odigeo.parseOptions(this.options)}}))},function(e,t,i){"use strict";e.exports=Odigeo.Model.extend({myBookings:null,countries:{},isWithBookings:!0,popUpErrors:{RSA_000:"deepTokenKoLightbox",TRC_001:"deepTokenKoLightbox",TRC_002:"deepTokenKoLightbox",TRC_003:"deepTokenKoLightbox",TRC_004:"deepTokenNotOwnerLightbox"},update:function(e){var t=e.selectedBooking;this.set({bookingDetail:e.userDTO.bookingDetail[t]})}})},function(e,t,i){"use strict";var n=i(0),a=i(7),s=i(198),r=i(548),o=i(490),c=i(807),d=i(809),l=i(553),g=i(811),h=i(815),u=["CANXSELF","CNXFLT151","CNXFHL157","1_26_5251592","CNXFHL154","CNXAST152","CNXAST158","ASTONL162","COMPREH163","NEWHUB162","FLEXSELF","FLEXRB156","FLEXRB160","INSLUG159","G_AIRD01","G_AIRI01"],p=["PENDING","REQUEST","CONTRACT"],f={INITERARY:{phoneKey:"",emailKey:""},STATUS:{phoneKey:"",emailKey:""},FLIGHT_NOTIFICATION:{phoneKey:"",emailKey:""},CP_CONTACT_CENTRE_REDUCED_RATE_PHONE_NUMBER:{phoneKey:"standard_phone_number",emailKey:""},CP_CONTACT_CENTRE_FREE_PHONE_NUMBER:{phoneKey:"premium_phone_number",emailKey:"email_contact_premium"},CC_FREE_CANCELLATION_OR_MODIFICATION:{phoneKey:"",emailKey:""},FR_FAST_REFUND:{phoneKey:"",emailKey:""}};e.exports=Odigeo.View.extend({templates:null,templateSettings:{evaluate:/\{\{#([\s\S]+?)\}\}/g,interpolate:/\{\{[^#{]([\s\S]+?)[^}]\}\}/g,escape:/\{\{\{([\s\S]+?)\}\}\}/g},selectors:{goHome:".go_home",findBookings:".find_bookings",findBookingHotels:".find_booking_hotels",findBookingCars:".find_booking_cars",myTripsBody:".my_trips_body",myTripsWithNoBookings:".my_trips_with_no_bookings",myTripsWithBookings:".my_trips_with_bookings",myTripsBookingDetails:".my_trips_booking_details",myTripsWaiting:".mytrips_waiting",fallbackprice:".mytrips_xsell_fallback",deepTokenKoLightbox:".deep_token_ko_lightbox",deepTokenNotOwnerLightbox:".deep_token_not_owner_lightbox"},events:{"tap .one_trip_card":"_goToTappedOneTrip","tap .one_trip_button":"_goToTappedOneTrip","tap .link_box_item":"_goToLink","tap .bp_help_link":"_trackLink","tap .bp_autocheckin_button":"_openModalIframe","tap .folded_clickable":"_foldingDetails","tap .pax_details_open_add_bags":"openBagsPopup","tap .pax_details_open_choose_seats":"openSeatsPopup","tap .lightbox_wrapper":"closeLightbox","tap .lightbox_close":"closeLightbox"},trackingCategory:null,init:function(){this.bindToDom(),this.$cachedSelectors.myTripsWaiting.addClass("opened open"),this.createAppTouchpoint(this.$el,"mytripswithoutbookings")},createAppTouchpoint:function(e,t,i){var n="app-touchpoint-"+t;0<e.find("#"+n).length&&s.create({id:n,options:{selector:t,trackCategory:i||"flight_results",trackLabel:"app_download_bottom"}})},shouldDisplayEmergingLayer:function(){var e=Odigeo.Utils.parseJson(Odigeo.Session.get("isRedirectionFromConfirmation")),t=Odigeo.Utils.parseJson(Odigeo.Session.get("hasEmlAlreadyAppeared"));return e&&!t},createEmergingLayer:function(e){l.create({id:"xsell-emerging-layer-mytrips",options:{bookingDetails:e,context:"mytrips"}})},disableEmergingLayer:function(){Odigeo.Session.set("hasEmlAlreadyAppeared","true")},createProductBanner:function(e,t,i){g.create({id:e,options:{bookingDetails:t,type:i}})},createSendToMessenger:function(){d.create({id:"send_to_messenger_button",options:{context:"MyTripsDetails",linkSource:"AppDownloadMyTrips"}})},createXsellOneBookingProducts:function(e){h.create({id:"xsell-one-booking-products",options:{bookingData:e}})},createAppCheckInDesktop:function(e){r.create({id:"app-checkin-desktop-my-trips",options:{buyerEmail:e}})},getTrackingCategory:function(){return this.trackingCategory},setTrackingCategory:function(e){this.trackingCategory=e},_trackEvent:function(e,t,i){n.trackEventWithCategory(e,t,i)},bindToDom:function(){this.$cachedSelectors.goHome.off().on(Odigeo.Events.tap,_.bind(function(){this._trackEvent("my_area_no_trips","no_trips","go_home_clicks"),Odigeo.Utils.goToApplicationHome()},this)),this.$cachedSelectors.findBookingHotels.off().on(Odigeo.Events.tap,function(){}),this.$cachedSelectors.findBookingCars.off().on(Odigeo.Events.tap,function(){}),Odigeo.UIElements.hint.enhance(Odigeo.History.getPageNameFromFragment(),this.$cachedSelectors.findBookings,{events:{tap:!0}})},_loadTrips:function(e){var t,i,n="tripdetails"===Odigeo.History.getPageNameFromFragment()?"my_trips_trip_information":"my_area_trips";this.$cachedSelectors.myTripsWaiting.removeClass("opened open"),Odigeo.UIElements.enhanceLoading($(".waiting_page")).hideLoading(),this._loadMappings(),Odigeo.trigger(this.widget.id+":hideCanFindBooking"),this.setTrackingCategory("my_area_trips");var a=(t=!_.isNull(e.userDTO.bookingDetail)&&0<e.userDTO.bookingDetail.length)?"my_area_trips":"my_area_no_trips";if(this.model.isWithBookings=t,e=this._addInfoToData(e),_.isEmpty(e.userDTO.bookingDetail)?e.gtType="one_way":(i=e.userDTO.bookingDetail[0].itineraryBookings.bookingItinerary.tripType,e.gtType="MULTI_SEGMENT"===i?"one_way":i.toLowerCase()),t?(this._trackEvent(n,"on_load_events","upcoming_trips"),Odigeo.trigger(this.widget.id+":changeCategoryTracking","my_area_trips")):(this.$cachedSelectors.myTripsBody.attr("data-state","noBookings"),Odigeo.trigger(this.widget.id+":dataTrackNoTrips",{action:"sidebar",category:"my_area_no_trips"}),this._trackEvent("my_area_trips","on_load_events","no_trips"),Odigeo.trigger(this.widget.id+":changeCategoryTracking","my_area_no_trips"),Odigeo.trigger(this.widget.id+":showCanFindBooking",a),Odigeo.trigger(this.widget.id+":showGtBannerNoBookings")),this.model.update(e),(_.isEmpty(e.selectedBooking)||_.isUndefined(e.selectedBooking)||_.isUndefined(e.userDTO.bookingDetail[e.selectedBooking]))&&t&&(this._loadBookingList(e),Odigeo.trigger(this.widget.id+":showCanFindBooking",a),Odigeo.trigger(this.widget.id+":hideManageMyBookingBox")),!_.isEmpty(e.selectedBooking)&&!_.isUndefined(e.userDTO.bookingDetail[e.selectedBooking])&&t){var s=e.userDTO.bookingDetail[e.selectedBooking];this._loadBookingDetails(e,e.selectedBooking),Odigeo.trigger(this.widget.id+":changeCategoryTracking","my_area_trips_details"),this.isManageBookingAvailable(s.bookingStatus)&&this.manageBookingTokenNeeded(s.buyer.mail,s.bookingBasicInfo.id)}this.widget.model.myBookings=e,this.updateUserName(e.displayName)},isManageBookingAvailable:function(e){return Odigeo.UserArea.isManageMyBookingAvailable&&Odigeo.AB.isManageMyBookingDesktop&&_.includes(p,e)},manageBookingTokenNeeded:function(e,t){var i={queryParams:{email:e,bookingid:t}};Odigeo.trigger(this.widget.id+":showManageMyBookingBox",i)},_loadOpenBookingDetails:function(e){var t={selectedBooking:"0",userDTO:{bookingDetail:[e]}};this._loadTrips(t)},_addInfoToData:function(e){var t=!0,i={CONFIRMED:{icon:"7",statusClass:"od-trip-status-positive",keyText:this.keys.tripStatusOk},PENDING:{icon:"F",statusClass:"od-trip-status-informative",keyText:this.keys.tripStatusPending},CANCELLED:{icon:"s",statusClass:"od-trip-status-negative",keyText:this.keys.tripStatusCancel},byDefault:{statusClass:"hidden"}},n=(_.isEmpty(e.selectedBooking)||_.isEmpty(e.userDTO.bookingDetail[e.selectedBooking]))&&this.model.isWithBookings,a=e.userDTO.bookingDetail,s=e.selectedBooking;return e.userDTO.bookingDetail=_.map(e.userDTO.bookingDetail,function(e){var r=e.myTripStatus,o=e.itineraryBookings.bookingItinerary.tripType,c=!n&&_.indexOf(a,e)===parseInt(s,10);return e.icon=i[r]?i[r].icon:"",e.keyText=i[r]?i[r].keyText:"",e.statusClass=i[r]?i[r].statusClass:i.byDefault.statusClass,e.tripTypeClass="od-"+o.toLowerCase().replace("_","-"),e.formatTotalAmount=this._formatPrice(e.price),e.isFirstConfirmed=e.keyText===this.keys.tripStatusOk&&t,(e.isFirstConfirmed&&n||!n&&c)&&(t=!1),this._updateBuyerName(e.buyer),e.insuranceBookings.bookings=(e.insuranceBookings.bookings||[]).filter(function(e){var t=_.get(e,"insurance.policy");return!!t&&(e.insurance.policy=t.replace(/-/g,"_"),_.includes(u,e.insurance.policy))}),!Odigeo.AB.isServiceOptionsInMyTrips&&!Odigeo.AB.isServiceOptionsInMyTripsMobile||_.isEmpty(e.postsellServiceOptionBookings)||(e.postsellServiceOptionBookings=e.postsellServiceOptionBookings.shift(),e.postsellServiceOptionBookings.postsellServiceOptionProducts=(e.postsellServiceOptionBookings.postsellServiceOptionProducts||[]).filter(function(e){var t=_.get(e,"name");return!!t&&(e.name=t.replace(/-/g,"_"),_.includes(_.keys(f),e.name.toUpperCase()))}).map(function(e){return _.extend(e,f[e.name])})),e},this),e},_loadBookingList:function(e){this.$cachedSelectors.myTripsBody.attr("data-state","listBookings"),this.$cachedSelectors.myTripsWithBookings.empty().append(this.templates.myTripsBookings({bookingsList:e,humanTripDate:this.humanTripDate,translations:this.keys,formatDate:Odigeo.Utils.formatDate,millisecsToDays:Odigeo.Utils.millisecsToDays,pluralizeAll:Odigeo.Utils.pluralizeAll,replaceCmsKeyArgs:Odigeo.Utils.replaceCmsKeyArgs,gtType:e.gtType,templates:this.templates,imagePath:Odigeo.UserArea.imagePath})),this.createAppTouchpoint(this.$cachedSelectors.myTripsWithBookings,"mytripswithbookings");var t=e.userDTO.bookingDetail[this.$el.find("#xsell-products-banners").data("index")];_.isUndefined(t)||this.createProductBanner("xsell-products-banners",t,"list")},_loadBookingDetails:function(e,t){var i=e.userDTO.bookingDetail[t],s=_.bind(function(){var n,a={bookingDetailIndex:t,bookingDetail:i,translations:this.keys,countriesMap:this.widget.model.countries,formatDate:Odigeo.Utils.formatDate,pluralizeAll:Odigeo.Utils.pluralizeAll,replaceCmsKeyArgs:Odigeo.Utils.replaceCmsKeyArgs,humanTripDate:this.humanTripDate,formatMin:_.bind(this.formatMin,this),millisecsToDays:Odigeo.Utils.millisecsToDays,gtType:e.gtType,templates:this.templates,imagePath:Odigeo.UserArea.imagePath,isRedirectionFromConfirmation:(n=Odigeo.Session.get("isRedirectionFromConfirmation"),!0===Odigeo.Utils.parseJson(n))},s=this.$cachedSelectors.myTripsBookingDetails.empty().append(this.templates.myTripsOneBooking(a));return this.bagsAndSeatsOffline=c.create({el:this.$el.find(".bags_and_seats_offline"),model:this.model}),s},this),r=_.bind(_.wrap(s,function(e){e().length&&this.$cachedSelectors.myTripsBookingDetails.find(".bp_autocheckin_button").length&&this._trackEvent("on_load_events","auto_checkin_shown","my_area_trips_details")}),this);this.$cachedSelectors.myTripsBody.attr("data-state","bookingDetails"),r(s),this.createAppTouchpoint(this.$cachedSelectors.myTripsBookingDetails,"mytripsdetails","my_area_trips_details"),this.createXsellOneBookingProducts(i),this.$el.find("#app-checkin-desktop-my-trips")&&"desktop"===Odigeo.SessionScope.flow&&(this.createAppCheckInDesktop(i.buyer.mail),Odigeo.AB.getMyTripsPhase1QrDesktop===Odigeo.Utils.Partition.C&&this.createSendToMessenger()),this.createProductBanner("xsell-products-banners-details",i,"detail");var o=this.$cachedSelectors.myTripsBookingDetails.find(".mytrip_eptica_wrapper");_.each(o,function(e){Odigeo.UIElements.hint.enhance(Odigeo.History.getPageNameFromFragment(),e,{generateHtml:!0,wrapperClass:"od-mytrips-hint od-hint-notitle",arrowClass:"od-hint-arrow-flex",hintTriggerButton:{hintTriggerButtonClass:"od-mytrips-hint-btn",hintTriggerButtonText:"9"},events:{hover:!1,tap:!0}})}),_.each($(this.$cachedSelectors.myTripsBookingDetails.find(".mytrip_eptica_link")),function(e){$(e).off().on(Odigeo.Events.tap,_.bind(function(){this._trackEvent("my_area_trips_details"," trip_details","baggage_help_center_clicks")},this))},this),n.trackEvent("my_trips","successfully_arrived_to_my_trips_details"),this.setTrackingCategory("my_area_trips_details");var d=_.isEmpty(i.accommodationBooking)?"tripdetails/flights":"tripdetails/dynpack";n.trackPage(d,{funnel:!1}),this.shouldDisplayEmergingLayer()&&(this.createEmergingLayer(i),this.disableEmergingLayer()),a.updateDatalayer()},humanTripDate:function(e,t){return t=t||"ddd, mmm dd yyyy",Odigeo.Utils.formatDate(e,t,!0)},getDurationUnits:function(e){return{days:Math.floor(e/1440),hours:Math.floor(e%1440/60),minutes:e%1440%60}},formatMin:function(e){var t=this.getDurationUnits(e),i=this.keys,n=[t.minutes],a=i.durationInMinutes;return 0<t.days?(a=i.durationWithDays,n.unshift(t.days,t.hours)):0<t.hours&&(a=i.durationShort,n.unshift(t.hours)),n.unshift(a),Odigeo.Utils.replaceCmsKeyArgs.apply(Odigeo.Utils.replaceCmsKeyArgs,n)},_loadMappings:function(){_.isEmpty(this.widget.model.countries)&&(this.widget.model.countries=this._getMappingList(Odigeo.UserArea.countries))},_getMappingList:function(e){var t={};return _.each(e,function(e){t[e.code]=e}),t},_formatPrice:function(e){var t=this._setCurrency(e.currencyConfig);return Odigeo.Utils.formatCurrency(e.amount,t)},_setCurrency:function(e){var t=$.extend(!0,{},Odigeo.Utils.Currency);return _.isUndefined(e)||_.isNull(e)||(t.currencySign=e.currencySymbol,t.decimalPlaces=e.decimalPlaces,t.decimalSeparator=e.decimalSeparator,t.thousandSeparator=e.thousandSeparator,t.currencySymbolPrefix=e.currencySymbolPrefix,t.currencyCode=e.currencyCode,t.spaceBetweenSignAndQuantity=e.spaceBetweenSignAndQuantity,t.signPosition=e.signPosition),t},_updateBuyerName:function(e){_.isUndefined(e.name)||_.isNull(e.name)||(e.name=e.name.toLowerCase()),_.isUndefined(e.lastNames)||_.isNull(e.lastNames)||(e.lastNames=e.lastNames.toLowerCase())},_showGtBannerNoBookings:function(){0<this.$el.find("#no-bookings-gt-banner").length&&o.create({id:"no-bookings-gt-banner"})},_goToTappedOneTrip:function(e){var t,i=this.widget.model.myBookings;e.preventDefault(),t=$(e.currentTarget).data("index"),this._trackEvent("my_area_trips","upcoming_trips","view_trip_"+i.userDTO.bookingDetail[t].myTripStatus.toLowerCase()+"_details"),Odigeo.Router.navigate("mytrips",{params:t})},_goToLink:function(e){var t=$(e.currentTarget),i=t.data("ref"),a=t.data("place");if(a=_.isEmpty(a)?"_self":a,!_.isEmpty(i)){var s=t.data("track-category"),r=t.data("track-action"),o=t.data("track-label");n.trackEvent(r,o,s),"_blank"===a?window.open(i):window.open(i,a,!1)}},_foldingDetails:function(e){var t,i=$(e.currentTarget);t=i.attr("data-tracking"),i.toggleClass("od-mytrips-last-border"),i.siblings(".trip_folded_details").toggleClass("hidden"),i.find(".ficon").toggleClass("hidden"),i.hasClass("od-mytrips-last-border")&&this._trackEvent("my_area_trips_details","trip_details",t)},_openModalIframe:function(e){var t='<iframe class="od-autocheckin-popup" src="'+$(e.currentTarget).data("ref")+'" width="420" height="650"></iframe>',i=Odigeo.UIElements.createDialog(Odigeo.UIElements.translations.infocheckinpopup.title,t,{},"popup_dialog_autocheckin od-popup-dialog-autocheckin",!0);Odigeo.UIElements.showDialog(i),this._trackEvent("my_area_trips_details","auto_check_in","request_boarding_pass_clicks")},_trackLink:function(e){var t=$(e.currentTarget),i=t.data("track-category"),n=t.data("track-action"),a=t.data("track-label");this._trackEvent(i,n,a)},openBagsPopup:function(){this.bagsAndSeatsOffline.execute("addBags")},openSeatsPopup:function(){this.bagsAndSeatsOffline.execute("chooseSeats")},showManageMyBookingBox:function(e){if(!_.isEmpty(e.response.token)){var t=$(e.box),i=t.find(".manage_my_booking_btn"),n=i.data("url");i.attr("data-ref",n+"?mb="+e.response.token),i.off().on(Odigeo.Events.tap,_.bind(this._goToLink,this)),t.removeClass("odf-hidden")}},hideManageMyBookingBox:function(e){$(e).addClass("odf-hidden")},openLightBoxMsg:function(e){var t=this.model.popUpErrors[e];this.$cachedSelectors[t].toggleClass("opened open")},closeLightbox:function(e){($(e.target).hasClass("opened open")?$(e.target):$(e.target).parents(".opened")).toggleClass("opened open")},updateUserName:function(e){this.changeTitleInLightBox(this.$cachedSelectors.deepTokenKoLightbox,Odigeo.Utils.replaceCmsKeyArgs(this.keys.deepTokenLightboxTitle,e)),this.changeTitleInLightBox(this.$cachedSelectors.deepTokenNotOwnerLightbox,Odigeo.Utils.replaceCmsKeyArgs(this.keys.deepTokenLightboxTitleNotOwner,e))},changeTitleInLightBox:function(e,t){e.find(".deep_token_lightbox_title").text(t)}})},function(e,t,i){"use strict";var n=i(10);e.exports=n({viewClass:i(808),options:{"*":{isUpdateBagClaimTextUk:Odigeo.AB.isUpdateBagClaimTextUk,isMyTripsPostBookingBagsButton:Odigeo.AB.isMyTripsPostBookingBagsButton,isMyTripsPostBookingSeatsButton:Odigeo.AB.isMyTripsPostBookingSeatsButton,trackBookingIdOnDialup:Odigeo.BagsAndSeats.trackBookingIdOnDialup}},methods:{addBags:function(){this.addBags("link")},chooseSeats:function(){this.chooseSeats("link")}}})},function(e,t,i){"use strict";var n=i(13),a=i(18),s=i(0),r="opened open",o="my_area_trips_details",c=function(e,t){var i=t.options,n="bags"===e,a=n?":loadBags":":loadSeats",c=n?".bags_add_popup":".seats_add_popup",d=n?i.isMyTripsPostBookingBagsButton:i.isMyTripsPostBookingSeatsButton;return{openPopup:function(n){var l=t.model.get("bookingDetail");!function(t,n){var a=t.bookingBasicInfo.id,r=[n,e].join("_"),c=["open",e];i.trackBookingIdOnDialup||c.push(a);var d=c.join("_");s.trackEventWithCategory(o,r,d)}(l,_.isString(n)?n:"widget"),d?Odigeo.trigger(t.name+a,l):t.$el.find(c).addClass(r)},closePopup:function(){t.$el.find(c).removeClass(r)},dialup:function(){var i=t.model.get("bookingDetail").bookingBasicInfo.id,n="popup_"+e,a="call_"+e+"_"+i;s.trackEventWithCategory(o,n,a)}}};e.exports=a(n.extend({name:"bags_and_seats_offline",events:{"tap .open_add_bags":"addBags","tap .open_choose_seats":"chooseSeats","tap .close_add_bags":"closeBagsPopup","tap .close_add_seats":"closeSeatsPopup","tap .dialup_add_bags":"dialupBags","tap .dialup_add_seats":"dialupSeats"},initialize:function(e){this.model=e.model,this.bagsOffline=c("bags",this),this.seatsOffline=c("seats",this)},closeBagsPopup:function(){this.bagsOffline.closePopup()},closeSeatsPopup:function(){this.seatsOffline.closePopup()},addBags:function(e){this.bagsOffline.openPopup(e)},chooseSeats:function(e){this.seatsOffline.openPopup(e)},dialupBags:function(){this.bagsOffline.dialup()},dialupSeats:function(){this.seatsOffline.dialup()}}))},function(e,t,i){"use strict";var n=i(10);e.exports=n({viewClass:i(810),options:{send_to_messenger_button:{templateToRender:"sendToMessenger"}}})},function(e,t,i){"use strict";var n=i(0),a=i(13),s=i(18),r=i(167),o={ED:"eDreams",OP:"Opodo",TL:"Travellink",GV:"GoVoyages"},c=["EN","ES","DE","FR","IT"];e.exports=s(r(a.extend({name:"send_to_messenger_button",selectors:{button:".send_to_messenger_button_container"},events:{"tap .send_to_messenger_button":"onButtonClick"},initialize:function(){this.initTrackingVars();var e=_.get(Odigeo.SessionScope,"brand"),t=this.getFacebookPageName(e),i=_.get(this.options,"linkSource"),n=this.getLanguage().toLowerCase(),a=this.templates[this.options.templateToRender];this.url="http://m.me/"+t+"?ref=linkSource:"+i+";locale:"+n,a&&this.render(a)},initTrackingVars:function(){this.trackKeys={MyTripsDetails:"my_area_trips_details"},this.moduleContext=this.options.context,this.action="checkin_widget",this.labelConcept="send_messenger_click_successful"},render:function(e){this.$cachedSelectors.button.append(e({keys:this.keys}))},onButtonClick:function(){n.trackEvent(this.action,this.labelConcept,this.trackKeys[this.moduleContext]),this.popUpCenter(this.url)},getFacebookPageName:function(e){var t=this.getLanguage(),i=o[e];return"EN"===t?i:i+"."+t},getLanguage:function(){var e=_.get(Odigeo.SessionScope,"tmParam.language","EN").toUpperCase();return this.isSupported(e)?e:"EN"},isSupported:function(e){return-1!==c.indexOf(e)},popUpCenter:function(e){var t=screen.width/2-375,i=screen.height/2-375;window.open(e,"MessengerWindow","height=750,width=750,left="+t+",top="+i)}})))},function(e,t,i){"use strict";var n=i(10);e.exports=n({viewClass:i(812)})},function(e,t,i){"use strict";var n=i(13),a=i(60),s=i(0),r=i(357),o=i(21),c=i(27),d=i(813),l=i(814);e.exports=n.extend(a.extend({name:"products_banner",bannerData:null,trackingCategory:null,bannersAppearances:{cars:0,hotels:0,gt:0},selectors:{productBanner:".product_banner"},events:{"tap .product_banner_link":"openProductBannerLnk"},initialize:function(e){n.prototype.initialize.call(this,e),this.options.xsellingData=this.getMyTripsXsellingData(this.options.bookingDetails)||!1,this.bannersData=this.getXsellData(this.options.bookingDetails),this.trackingCategory=_.isEqual(this.options.type,"list")?"my_area_trips":"my_area_trips_details",this.$el.html(this.templates[this.options.type](this.getContainerData(this.bannersData))),this.renderBanners(),this.trackBannersAppearances()},getXsellData:function(e){var t={expediaHotels:Odigeo.UIElements.translations.expediaHotels,isGtActive:Odigeo.UIElements.translations.myTripsXsellParameters.gtActive},i=c.isMyTripsHome()?o.mytrips_cars_banner:o.mytripdetails_cars_banner,n=_.extend({},this.keys,{xsellParams:t}),a=r(e),s=l(n),g=d(a,s,i);return _.extend({},s,{deepLinks:g})},getContainerData:function(e){var t,i,n,a,s,r,o=!_.isEmpty(this.keys.hasGtGlobal)&&"true"===this.keys.hasGtGlobal.toLowerCase()&&!_.isEmpty(this.keys.hasGtLocalMyInfo)&&"true"===this.keys.hasGtLocalMyInfo.toLowerCase();return{isGTActive:e.gt.isActive,hasGtUpselling:o,hasHotelsUpselling:(t=this.options.bookingDetails.accommodationBooking,i=this.options.xsellingData.hotel,n=i.checkin_monthday,a=i.checkout_monthday,s=i.checkin_year_month,r=i.checkout_year_month,_.isEmpty(t)&&(n!==a||s!==r))}},renderBanners:function(){var e=this.$el.find(this.selectors.productBanner);_.each(e,function(e){$(e).html(this.templates.banner(this.getBannerData($(e).data("product")))),this.bannersAppearances[$(e).data("product")]=1},this)},getBannerData:function(e){return{product:e,productTracking:_.isEqual(e,"gt")?"groundtransportation":e,title:this.bannersData[e].title,description:this.bannersData[e].description,text1:this.bannersData[e].text1,text2:this.bannersData[e].text2,button:this.bannersData[e].button,deepLink:this.bannersData.deepLinks[e],trackCategory:this.trackingCategory}},trackBannersAppearances:function(){var e="banner_appearances_car:"+this.bannersAppearances.cars+"_hot:"+this.bannersAppearances.hotels+"_gt:"+this.bannersAppearances.gt;s.trackEventWithCategory(this.trackingCategory,"xsell_banner",e),0<this.bannersAppearances.gt&&s.trackEvent("xsell_banner","ground_transportation_appearances",this.trackingCategory)},openProductBannerLnk:function(e){var t=$(e.currentTarget),i=t.data("ref"),n=t.data("track-category"),a=t.data("track-action"),r=t.data("track-label"),o=_.isEmpty(t.data("place"))?"_self":t.data("place");_.isEmpty(i)||(s.trackEvent(a,r,n),_.isEqual(o,"_blank")?window.open(i):window.open(i,o,!1))}}))},function(e,t,i){"use strict";var n=i(550),a=i(589),s=i(552);e.exports=function(e,t,i){var r={expediaParams:t.expediaParams,url:t.hotels.url};return{cars:n(e,t.cars.url,i),hotels:a(e,r),gt:s(e,t.gt.url)}}},function(e,t,i){"use strict";var n=i(27);function a(e){return e.xsellCartrawlerBannerUrl}function s(e){return Odigeo.AB.isExpediaLinksAndWidget?e.xsellParams.expediaHotels.deeplink:n.isMyTripsHome()?e.xsellHotelsBannerUrl:e.xsellHotelsBannerDetailsUrl}e.exports=function(e){return{cars:n.isMyTripsHome()?(d=e,{title:d.xsellCarsBannerTitle,description:d.xsellCarsBannerDescription,text1:d.xsellCarsBannerText1,text2:d.xsellCarsBannerText2,button:d.xsellCarsBannerButton,url:a(d)}):(c=e,{title:c.xsellCarsBannerTitleDetail,description:c.xsellCarsBannerDescriptionDetail,text1:c.xsellCarsBannerText1Detail,text2:c.xsellCarsBannerText2Detail,button:c.xsellCarsBannerButtonDetail,url:a(c)}),hotels:n.isMyTripsHome()?(o=e,{title:o.xsellHotelsBannerTitle,description:o.xsellHotelsBannerDescription,text1:o.xsellHotelsBannerText1,text2:o.xsellHotelsBannerText2,button:o.xsellHotelsBannerButton,url:s(o)}):(r=e,{title:r.xsellHotelsBannerTitleDetail,description:r.xsellHotelsBannerDescriptionDetail,text1:r.xsellHotelsBannerText1Detail,text2:r.xsellHotelsBannerText2Detail,button:r.xsellHotelsBannerButtonDetail,url:s(r)}),gt:n.isMyTripsHome()?(i=e,{isActive:i.xsellParams.isGtActive,title:i.xsellGtBannerTitle,description:i.xsellGtBannerDescription,text1:i.xsellGtBannerText1,text2:i.xsellGtBannerText2,button:i.xsellGtBannerButton,url:i.xsellGtBannerUrl}):(t=e,{isActive:t.xsellParams.isGtActive,title:t.xsellGtBannerTitleDetail,description:t.xsellGtBannerDescriptionDetail,text1:t.xsellGtBannerText1Detail,text2:t.xsellGtBannerText2Detail,button:t.xsellGtBannerButtonDetail,url:t.xsellGtBannerDetailsUrl}),expediaParams:_.pick(e.xsellParams.expediaHotels,"id","key")};var t,i,r,o,c,d}},function(e,t,i){"use strict";var n=i(10);e.exports=n({viewClass:i(816)})},function(e,t,i){"use strict";var n=i(13),a=i(18),s=i(60),r=i(551),o=i(490),c=i(549),d=i(817),l=i(819);e.exports=a(n.extend(s.extend({name:"one_booking_products",initialize:function(){this.options.xsellingData=this.getMyTripsXsellingData(this.options.bookingData)||!1,this.options.xsellingData&&(this.options.hasHotelData=this.hasHotelData(),this.createCarsSmartblock(this.options.bookingData),this.createGroundTransportationBannerWithBooking(this.options.bookingData),this.createCarsStandaloneBanner(this.options.bookingData,this.options.hasGtUpselling),this.options.hasHotelData&&(Odigeo.AB.isExpediaLinksAndWidget?this.createExpediaHotelIframe(this.options.xsellingData):this.createHotelIframe(this.options.xsellingData)))},hasHotelData:function(){var e=this.options.xsellingData.hotel;return(e.checkin_monthday!==e.checkout_monthday||e.checkin_year_month!==e.checkout_year_month)&&_.isEmpty(this.options.bookingData.accommodationBooking)},createCarsSmartblock:function(e){r.create({id:"xsell-cartrawler-widget",options:{bookingDetail:e}})},createGroundTransportationBannerWithBooking:function(e){o.create({id:"mytrips-booking-gt-banner",options:{bookingData:e}})},createCarsStandaloneBanner:function(e,t){c.create({id:"cars-standalone-banner",options:{bookingData:e,myTripsWithGt:t}})},createExpediaHotelIframe:function(e){l.create({id:"expedia-hotels-iframe-container",options:{xsellData:e}})},createHotelIframe:function(e){d.create({id:"hotels-iframe-container",options:{xsellData:e}})}})),function(e){var t,i=e.keys,n=e.options;return{keys:i,options:_.extend(n,{hasGtUpselling:!_.isEmpty(i.hasGtGlobal)&&"true"===i.hasGtGlobal.toLowerCase()&&!_.isEmpty(i.hasGtLocalMyInfo)&&"true"===i.hasGtLocalMyInfo.toLowerCase(),isRedirectionFromConfirmation:(t=Odigeo.Session.get("isRedirectionFromConfirmation"),!0===Odigeo.Utils.parseJson(t))})}})},function(e,t,i){"use strict";var n=i(10);e.exports=n({viewClass:i(818)})},function(e,t,i){"use strict";var n=i(13),a=i(18);e.exports=a(n.extend({name:"hotel_iframe"}),function(e){var t,i,n,a=e.keys,s=e.options;return{keys:_.extend(a,{bookingComUrl:(t=a.bookingComUrl,i=s,n=i.xsellData.hotel,Odigeo.Utils.replaceCmsKeyArgs(t,i.xsellData.pickupIata,n.checkin_monthday,n.checkin_year_month,n.checkout_monthday,n.checkout_year_month))}),options:s}})},function(e,t,i){"use strict";var n=i(10);e.exports=n({viewClass:i(820)})},function(e,t,i){"use strict";var n=i(13),a=i(18),s=i(21),r=i(95),o=i(175),c=o.getMemberDiscountParams,d=o.replaceWapb3ForAb;e.exports=a(n.extend({name:"expedia_hotel_iframe"}),function(e){var t,i,n,a,o,l,g,h,u,p,f,m,b,y,v,S,C,w,O=e.keys,T=e.options;return{keys:_.extend(O,{expediaUrl:(t=O,i=T,n=i.xsellData,a=n.departureIataAirport,o=n.pickupIataAirport,l=i.xsellData.hotel,g=l.checkin,h=l.checkout,u=l.currency,p=l.purchaseDate,f=i.xsellData.hotel.passengers,m=f.numAdults,b=f.numChildren,y=i.xsellData.additionalInfo,v=y.pnr,S=y.cabinClass,C=y.numInfants,w=d(t.expediaUrl,s.mytripsdetails_hotels_iframe,r.getRedirectionAbConfig()),Odigeo.Utils.replaceCmsKeyArgs(w,g,h,a,o,m,b+C,u,v,S,p,"MB",t.expediaHotelsId).concat(c(),"&showSearchBar=true"))}),options:T}})},function(e,t,i){"use strict";Odigeo.defineWidget("my_trips_login",Odigeo.Widget.extend({modelClass:i(822),viewClass:i(823),getTripOk:function(e){this.view._loadTrip(e)},getTripError:function(e){this.view._loadTripError(e)}}))},function(e,t,i){"use strict";e.exports=Odigeo.Model.extend({errors:{TRC_002:"emailEmpty",TRC_003:"noBookingFound",default:"requestError"},trackErrors:{email:{empty:"email_missing_error",invalid:"email_invalid_error"},bookingRef:{empty:"reference_missing_error",invalid:"reference_invalid_error"}}})},function(e,t,i){"use strict";var n=i(81),a=i(0),s=i(198);e.exports=Odigeo.View.extend({templateSettings:{evaluate:/\{\{#([\s\S]+?)\}\}/g,interpolate:/\{\{[^#{]([\s\S]+?)[^}]\}\}/g,escape:/\{\{\{([\s\S]+?)\}\}\}/g},selectors:{checkWithBookingRef:"#checkWithBookingRef",emailInput:"#checkWithBookingRef .email_input",bookingRefInput:"#checkWithBookingRef .bookingRef_input",oneLineInputs:"#checkWithBookingRef .oneline-input",mytripsloginInfoError:"#checkWithBookingRef .od-mytripslogin-info .error_message",reservationWaiting:"#checkWithBookingRef .reservation_waiting"},events:{"tap .checkBooking_button":"checkBooking","tap .register_page_link":"goToRegisterPage","tap .mytripslogin_login_button":"submitLoginRequest","focus #checkWithBookingRef .oneline-input":"showOneLineLabel","blur #checkWithBookingRef .oneline-input":"validateOneLine"},init:function(){this.apiCallLimiter=!0,0<this.$el.find("#app-touchpoint-findyourbooking").length&&s.create({id:"app-touchpoint-findyourbooking",options:{selector:"findyourbooking",trackCategory:"sso_sign_in_trips",trackLabel:"app_download_middle"}}),Odigeo.trigger(this.widget.id+":renderOk")},showOneLineLabel:function(e){$(e.currentTarget).closest(".input_wrapper").toggleClass("showing_label",!0).toggleClass("invalid invalid-long",!1)},validateOneLine:function(e){var t=$(e.currentTarget),i=n.checkValidity(t,this.$el.find(this.selectors.checkWithBookingRef));t.closest(".input_wrapper").toggleClass("showing_label",_.isEmpty(i)).toggleClass("invalid invalid-long",!_.isEmpty(i))},_trackEvent:function(e,t,i){a.trackEventWithCategory(i,e,t)},checkBooking:function(){var e,t,i=this.$el.find(this.selectors.checkWithBookingRef).find('[data-name]:not([type="hidden"])');Odigeo.Session.remove("bookingInfo"),n.clearErrors(i),this.$el.find(this.selectors.mytripsloginInfoError).closest(".input_wrapper").toggleClass("invalid invalid-long",!1),this.$el.find(this.selectors.emailInput).closest(".input_wrapper").removeClass("invalid-no-text"),t=n.checkValidity(i,this.$el.find(this.selectors.checkWithBookingRef)),_.each(t,function(e){this._trackError(e)},this),_.isEmpty(t)&&this.apiCallLimiter&&(e={queryParams:{email:this.$el.find(this.selectors.emailInput).val(),bookingid:this.$el.find(this.selectors.bookingRefInput).val()}},this._trackEvent("find_booking","find_booking_clicks","sso_sign_in_trips"),this.apiCallLimiter=!1,this.$el.find(this.selectors.reservationWaiting).removeClass("hidden"),Odigeo.trigger(this.widget.id+":submitUserRequest",{data:e,action:"getTrip"}))},_loadTrip:function(e){this.$el.find(this.selectors.reservationWaiting).addClass("hidden"),Odigeo.trigger(this.widget.id+":loadTripOK",e),this.apiCallLimiter=!0},_loadTripError:function(e){var t,i,a=e&&e.messageError&&this.model.errors[e.messageError]?this.model.errors[e.messageError]:"requestError",s={bookingNull:{label:this.model.trackErrors.bookingRef.invalid},emailEmpty:{label:this.model.trackErrors.email.empty},emailInvalid:{label:this.model.trackErrors.email.invalid},noBookingFound:{label:"reference_and_email_dont_match_error",noTextClass:!0},defaultError:{label:"request_error",noTextClass:!0}};this.$el.find(this.selectors.reservationWaiting).addClass("hidden"),this.apiCallLimiter=!0,i=_.includes(["emailEmpty","emailInvalid"],a)?this.$el.find(this.selectors.emailInput):this.$el.find(this.selectors.bookingRefInput),i=this.$el.find(this.selectors.mytripsloginInfoError).length&&_.includes(["noBookingFound","requestError"],a)?this.$el.find(this.selectors.mytripsloginInfoError):i,n.showError(i.data(a),i.closest(".input_wrapper").toggleClass("showing_label",!1)),(t=s[a]||s.defaultError).noTextClass&&this.$el.find(this.selectors.emailInput).closest(".input_wrapper").addClass("invalid-no-text"),this._trackEvent("find_booking_error",t.label,"sso_sign_in_trips")},_trackError:function(e){var t=this.model.trackErrors[e.index][e.key];this._trackEvent("find_booking_error",t,"sso_sign_in_trips")},goToRegisterPage:function(){this._trackEvent("sign_in","go_to_register","sso_sign_in_trips"),Odigeo.trigger(this.widget.id+":goToRegisterPage")},submitLoginRequest:function(){this._trackEvent("sign_in","sign_in","sso_sign_in_trips"),Odigeo.trigger(this.widget.id+":submitLoginRequest",{action:"openModalLogin"})}})},function(e,t,i){"use strict";Odigeo.defineWidget("register_manager",Odigeo.Widget.extend({modelClass:i(825),viewClass:i(826),execute:function(e,t){return this.view[{registerOk:"onRegisterSuccess",registerWithError:"onRegisterError",registerError:"onRegisterError",attachSocialLoginButton:"onAttachSocialLoginButton",closeLoginForm:"onCloseLoginForm",registerWithFacebookOk:"onRegisterSuccessFacebook",registerWithFacebookWithError:"onRegisterErrorFB",registerWithFacebookError:"onRegisterErrorFB",registerWithGoogleOk:"onRegisterSuccessGoogle",registerWithGoogleWithError:"onRegisterErrorGoogle",registerWithGoogleError:"onRegisterErrorGoogle",updateAccountInfoOk:"onUpdateAccountInfoSuccess",updateAccountInfoWithError:"onUpdateAccountInfoError",updateAccountInfoError:"updatePaxWithSocialProfile",renderCaptcha:"renderCaptcha"}[e]](t),this}}))},function(e,t,i){"use strict";e.exports=Odigeo.Model.extend({acceptsNewsletter:null,recaptchaWidgetID:null,recaptchaCallbackData:null,recaptchaRendered:!1,errors:{STA_001:"emailExist-",STA_006:"emailExist-facebook",STA_007:"emailExist-google",STA_008:"emailExist-social",AUTH_000:"tokenError",AUTH_002:"permissions",AUTH_005:"authErrorFacebook",AUTH_006:"authErrorGoogle",AUTH_008:"socialError",AUTH_010:"tokenError",VAL_028:"format",VAL_008:"tokenError",RCP_001:"recaptchaError",STO_000:"remoteError",default:"requestError"},trackError:{STA_001:"odigeo",STA_006:"facebook",STA_007:"google",STA_008:"social"},registerActions:{password:"register",facebook:"registerWithFacebook",google:"registerWithGoogle"}})},function(e,t,i){"use strict";var n=i(81),a=i(93),s=i(0),r=i(39),o=_.partial(s.trackEventWithCategory,"sso_register","register_form"),c=i(139).updateRememberMeCookieField,d={facebook:i(164),google:i(165)},l=i(198);e.exports=Odigeo.View.extend({errorMaxLength:50,sendingWaitingPopup:null,waitingWheelDialog:null,init:function(){this.$el.find(".login_user_with_facebook").append(this.getSocialLoginButtonTemplate("facebook")),this.$el.find(".login_user_with_google").append(this.getSocialLoginButtonTemplate("google")),a.init(_.bind(this._socialLogin,this),_.bind(this._showSocialLoginError,this),this.widget.id,this.$el.find(this.selectors.socialLoginContainer).data("pattern")),this.waitingWheelDialog=Odigeo.UIElements.createDialog({content:this.keys.registerFormSending,dialogClasses:"od-login-layer-notifications",imageClass:"waiting-wheel"}),Odigeo.AB.isRecaptchaEnabled&&(r.isGRecaptchaLoaded?this.renderCaptcha():r.init()),0<this.$el.find("#app-touchpoint-register").length&&l.create({id:"app-touchpoint-register",options:{selector:"register",trackCategory:"sso_register",trackLabel:"app_download_middle"}})},selectors:{emailInfo:".email_info",createUserGenericError:".create_user_generic_error",emailInput:".email_input",passwordInput:".password_input",passwordIcon:".password_icon",registerSuccess:"#register-success",registerPage:"#register-page",userName:".user_name",userEmail:".user_email",accountRegistered:".account_registered",hasAccount:".has_account",registerUserWaiting:".register_user_waiting",socialLoginContainer:".social_register_container",receiveNewsletter:'.register_receivemore_checkbox[name="receiveNewsletter"]',loginFacebookButton:".social_register_container .login_facebook_button",loginGoogleButton:".login_google_button",loginFacebookError:".social_register_container .login_facebook_error",loginGoogleError:".login_google_error",loginSocialError:".login_social_error",socialError:".social_error",recaptchaWrapper:".g_recaptcha_register",allInputs:'[data-name]:not([type="hidden"])'},events:{"tap .email_input":"showEmailInfoMessage","input .password_input":"showPasswordCharsIcon","tap .password_icon":"changePasswordCharsViewer","tap .open_login_button":"showLoginForm","tap .create_user_button":"createUser","tap .has_account":"showLoginFormAlreadyRegister","tap .info_protection":"trackEventForLegalInfoLinks","tap .info_terms":"trackEventForLegalInfoLinks","tap .register_go_home":"goHome","tap .login_facebook_button":"onLoginFacebook","tap .login_google_button":"onLoginGoogle"},getSocialLoginButtonTemplate:function(e){return _.template(d[e],Odigeo.Utils.getTmplSettings({variable:"data"}))({keys:this.keys})},onLoginGoogle:function(){Odigeo.Session.set("loginPassword","google"),o("create_account_google"),this.checkLoginGoogleState()},onLoginFacebook:function(){o("create_account_facebook"),Odigeo.Session.set("loginPassword","facebook"),this.checkLoginFacebookState()},trackEventForLegalInfoLinks:function(e){var t=$(e.currentTarget).hasClass("info_protection")?"links_open_DataProtectionPolicy":"links_open_GeneralConditions";o(t)},goHome:function(){Odigeo.Utils.goToApplicationHome()},checkLoginFacebookState:function(){a.getLoginStatus(this.widget.id),this.clearErrors()},checkLoginGoogleState:function(){a.getLoginStatusGoogle(this.widget.id),this.clearErrors()},showEmailInfoMessage:function(e){this.$el.find(this.selectors.emailInfo).removeClass("hidden"),$(e.target).off()},showInProgressInfoModal:function(){this.$el.find(this.selectors.modalView).addClass("active"),this.$el.find(this.selectors.registerUserWaiting).removeClass("odf-hidden")},hideInProgressInfoModal:function(){this.$el.find(this.selectors.modalView).removeClass("active"),this.$el.find(this.selectors.registerUserWaiting).addClass("odf-hidden")},showLoginForm:function(e,t){e.stopPropagation(),o(t||"go_to_login"),Odigeo.trigger(this.widget.id+":openLoginForm")},showLoginFormAlreadyRegister:function(e){var t="sso_email_already_used_"+this.$el.find(this.selectors.hasAccount).data("track")+"_error_sing_in";this.showLoginForm(e,t)},changePasswordCharsViewer:function(){var e=this.$el.find(this.selectors.passwordInput);this.$el.find(this.selectors.passwordIcon).find(".password_char_viewer").toggleClass("hidden"),e.attr("type","password"===e.attr("type")?"text":"password")},showPasswordCharsIcon:function(e){this.$cachedSelectors.passwordIcon.removeClass("hidden"),$(e.target).off()},createUser:function(e){o("create_account_odigeo"),e&&e.preventDefault(),this.clearErrors(),this.checkValidity()&&(Odigeo.UIElements.hideDialog(this.waitingWheelDialog),this.model.acceptsNewsletter=this.$el.find(this.selectors.receiveNewsletter)[0]&&!!this.$el.find(this.selectors.receiveNewsletter)[0].checked,this.model.recaptchaCallbackData=_.extend({email:this.$el.find(this.selectors.emailInput).val(),password:this.$el.find(this.selectors.passwordInput).val()},this.model.acceptsNewsletter?{acceptsNewsletter:!0}:{}),this.hideGenericError(),Odigeo.AB.isRecaptchaEnabled?r.gRecaptchaExecute(this.model.recaptchaWidgetID):this.triggerSubmitRequest())},recaptchaExecutionCallback:function(){this.model.recaptchaCallbackData.recaptchaResponse=r.gRecaptchaGetResponse(this.model.recaptchaWidgetID),this.triggerSubmitRequest()},triggerSubmitRequest:function(){Odigeo.trigger(this.widget.id+":submitUserRequest",{action:this.model.registerActions.password,data:this.model.recaptchaCallbackData})},_socialLogin:function(e){this.showInProgressInfoModal(),Odigeo.trigger(this.widget.id+":submitUserRequest",{data:e,action:this.model.registerActions[e.loginType]})},_showSocialLoginError:function(e,t){var i=_.startCase(t),n="requestError"===e?"error":e,a=this.$el.find(this.selectors["login"+i+"Button"]).data(n),s=this.$el.find(this.selectors.loginSocialError);this.clearErrors(),this.$el.find(this.selectors["login"+i+"Error"]).addClass("invalid"),s.find(".error_message").text(a),s.addClass("invalid"),this.hideInProgressInfoModal(),o("sso_email_authentication_"+t+"_error")},checkValidity:function(){var e=_.reduce(this.$el.find(this.selectors.allInputs),function(e,t){return $.merge(e,this._validateOneField($(t)))},[],this);return this.clearErrors(),_.each(e,function(e){this._showError(e)},this),_.isEmpty(e)},_showError:function(e,t){var i=this.$el.find("[data-name="+e.index+"]"),n=i.data(e.key.toLowerCase()),a=i.closest(".input_wrapper"),s=_.isUndefined(t)?n.length>this.errorMaxLength:!!t;a.addClass(s?"invalid-long":"invalid"),a.find(s?".error_long_message":".error_message").text(n)},_validateOneField:function(e){var t=[],i=e.is("input")?e.val():"click",n=e.data(),a="password"===n.validationType;return(_.isEmpty(i)||n&&n.validationType&&!Odigeo.Utils.isValid(n.validationType,i,a))&&(t.push({index:n?n.name:"",key:_.isEmpty(i)?"empty":"invalid"}),o("email"===n.name?"sso_email_incorrect_format_error":"sso_pwd_pci_compliance_error")),t},onRegisterSuccess:function(e){this.model.acceptsNewsletter&&o("sso_newsletter_checked"),Odigeo.UIElements.hideDialog(this.waitingWheelDialog),e&&e.userDTO&&e.userDTO.email&&(Odigeo.SessionScope.userData=e.userDTO,this.$el.find(this.selectors.userName).text(e.userDTO.email).removeClass("hidden"),this.$el.find(this.selectors.userEmail).text(e.userDTO.email)),Odigeo.trigger(this.widget.id+":registerSuccess"),this.$el.find(this.selectors.registerPage).addClass("hidden"),this.$el.find(this.selectors.registerSuccess).removeClass("hidden"),o("sso_successful_register_odigeo"),Odigeo.Utils.ensighten({page_name:"register/success",page_type:"general"}),s.trackPage("register/success",{funnel:!1}),Odigeo.trigger("checkLazyImages")},onRegisterSuccessFacebook:function(e){o("sso_successful_register_facebook"),a.addTravellerToAccount(e,this.widget.id,"home")},onRegisterSuccessGoogle:function(e){o("sso_successful_register_google"),a.addTravellerToAccount(e,this.widget.id,"home")},onRegisterError:function(e,t){this.hideInProgressInfoModal(),Odigeo.UIElements.hideDialog(this.waitingWheelDialog),Odigeo.AB.isRecaptchaEnabled&&r.gRecaptchaReset(this.model.recaptchaWidgetID);var i,n,a=e&&e.messageError&&this.model.errors[e.messageError]?this.model.errors[e.messageError]:"requestError",c=_.includes(["permissions","authErrorFacebook","authErrorGoogle","format","tokenError","socialError"],a),d="odigeo";-1!==a.indexOf("emailExist")?(this._showError({index:"email",key:"repeated"+(i=a,n=i.split("-").pop(),n?"-"+n:"")}),d=this.model.trackError[e.messageError]||d,o("sso_email_already_used_"+d+"_error"),this.$el.find(this.selectors.accountRegistered).removeClass("hidden"),this.$el.find(this.selectors.hasAccount).data("track",d)):0===e.status?-1<e.action.toLowerCase().indexOf("facebook")?this._showSocialLoginError(a,t):this._showError({index:"password",key:"connectionerror"}):-1!==a.indexOf("recaptcha")?(this.showGenericError("recaptchaerror"),s.trackEventWithCategory(Odigeo.Utils.isHomePage()?"home":Odigeo.History.getPageNameFromFragment(),"recaptcha_error","odigeo_recaptcha_error_register")):"remoteError"===a?(this.$el.find(this.selectors.passwordInput).val(""),this.showGenericError("remoteerror")):c?(-1!==a.indexOf("Error")&&(a="error"),this._showSocialLoginError(a,t)):this._showError({index:"password",key:"error"})},showGenericError:function(e){var t=this.$el.find(this.selectors.createUserGenericError);t.find(".msg_content").text(t.data(e)),t.removeClass("odf-hidden")},hideGenericError:function(){this.$el.find(this.selectors.createUserGenericError).addClass("odf-hidden")},onCloseLoginForm:function(){Odigeo.trigger(this.widget.id+":closeLoginForm")},onRegisterErrorFB:function(e){this.onRegisterError(e,a.socialLoginType.facebook)},onRegisterErrorGoogle:function(e){this.onRegisterError(e,a.socialLoginType.google)},onUpdateAccountInfoSuccess:function(e){_.isEmpty(e.displayName)||c("name",e.displayName),Odigeo.Utils.goToApplicationHome()},onUpdateAccountInfoError:function(){Odigeo.Utils.goToApplicationHome()},loginWithFacebook:function(){Odigeo.trigger(this.widget.id+":facebookLogin")},loginWithGoogle:function(){Odigeo.trigger(this.widget.id+":googleLogin")},onAttachSocialLoginButton:function(){Odigeo.trigger(this.widget.id+":attachSocialLoginButton",this.$el.find(this.selectors.loginGoogleButton))},renderCaptcha:function(){Odigeo.AB.isRecaptchaEnabled&&!this.model.recaptchaRendered&&(this.model.recaptchaWidgetID=r.gRecaptchaRender(this.$el.find(this.selectors.recaptchaWrapper).get(0),_.bind(this.recaptchaExecutionCallback,this),Odigeo.UserArea.recaptchaSiteKey),this.model.recaptchaRendered=!0)},clearErrors:function(){n.clearErrors(this.$el.find(this.selectors.allInputs),this.$el.find(this.selectors.socialError))}})},function(e,t,i){"use strict";var n=i(39);Odigeo.defineWidget("remember_me_manager",Odigeo.Widget.extend({modelClass:i(828),viewClass:i(829),enableRememberMe:function(e){this.view.activateWidget(e&&!this.model.socialLogin)},dealWithErrors:function(e){Odigeo.AB.isRecaptchaLoginEnabled&&n.gRecaptchaReset(this.model.recaptchaWidgetID);var t=e.messageError||"default";-1!==t.indexOf("recaptcha")?(this.showGenericError("recaptchaerror"),this.trackRecaptchaError("odigeo_recaptcha_error_sign-on")):"remoteError"===t?this.showGenericError("remoteerror"):_.startsWith(t,"UNL")?this.view._showUnlError():this.view._showError(this.model.errors[t])},showLoginError:function(e){this.view._isAccountBlocked(e)?this.view.launchAccountBlockedFlow():this.dealWithErrors(e)},renderCaptcha:function(){this.view.renderCaptcha()},showGenericError:function(e){this.view.showGenericError(e)},hideGenericError:function(){this.view.hideGenericError()}}))},function(e,t,i){"use strict";e.exports=Odigeo.Model.extend({action:null,cookie:null,socialLogin:!1,mail:null,name:null,membership:null,recaptchaWidgetID:null,recaptchaCallbackData:null,recaptchaRendered:!1,errors:{AUTH_000:"loginerror",STA_009:"accountblocked",STA_000:"accountblocked",VAL_000:"empty",VAL_002:"invalid",VAL_003:"invalid",SSO_006:"requesterror",STO_000:"requesterror",UNL_007:"velocityRules",RCP_001:"requesterror",default:"requesterror"},defaults:{isActivated:!1},init:function(){_.isEmpty(Odigeo.Utils.readCookie("sso_remember_me"))||(this.cookie=decodeURIComponent(Odigeo.Utils.readCookie("sso_remember_me")),this.mail=this.cookie.split(";")[0],this.name=this.cookie.split(";")[1].replace(/[#+]/g," "),this.membership="true"===this.cookie.split(";")[2],this.socialLogin=_.includes(["facebook","google"],this.cookie.split(";")[3]))}})},function(e,t,i){"use strict";var n=i(39),a=i(0),s=i(830);e.exports=Odigeo.View.extend({errorMaxLength:50,events:{"tap .freq_pass_newBtn":"goToTappedNewPassenger","tap .freq_pass_edit":"goToTappedPassenger","tap .login_button":"login","tap .passwordIcon":"changePasswordCharsViewer","tap .close_session":"closeSession","keyup .password_input":"keyPressed"},selectors:{body:".remember_me_passenger_body",passwordInput:".password_input",loginSubmit:".login_button",passwordIcon:".password_icon",rememberLogout:".remember_logout",rememberWelcome:".remember_welcome",controlError:".control_error",errorMessageWrapper:".error_message_wrapper",recaptchaWrapper:".g_recaptcha_remember_me",rememberMeError:".remember_me_error",closeSession:".close_session"},tmpls:{logoutTemplate:".remember_me_widget_logout_template",descriptionTemplate:".remember_me_widget_description_template",descriptionMemberTemplate:".remember_me_widget_description_template_member"},init:function(){Odigeo.AB.isRecaptchaLoginEnabled&&(n.isGRecaptchaLoaded?this.renderCaptcha():n.init()),this.prepareKeys()},prepareKeys:function(){this.keys.loginRememberMePassengersWellComeBack=Odigeo.Utils.replaceCmsKeyArgs(this.keys.loginRememberMePassengersWellComeBack,this.model.name),this.keys.loginRememberMePassengersNotName=Odigeo.Utils.replaceCmsKeyArgs(this.keys.loginRememberMePassengersNotName,this.model.name)},renderSubTemplate:function(){this.$el.find(this.selectors.rememberLogout).empty().append(this.templates.rememberMeWidgetLogout({keys:this.keys})),this.model.membership?s.create({id:"remember-welcome",options:{userName:this.model.name}}):this.$el.find(this.selectors.rememberWelcome).empty().append(this.templates.rememberMeWidgetDescription({keys:this.keys}))},activateWidget:function(e){this.$el.find(this.selectors.body).toggleClass("hidden",!e),e&&(this.renderSubTemplate(),a.trackEvent("sso_pax_page","go_to_login_user_remembered"),this.model.set("isActivated",e))},keyPressed:function(e){13===(e.keyCode?e.keyCode:e.which)&&this.login()},login:function(){this.$el.find(this.selectors.errorMessageWrapper).removeClass("invalid invalid-long"),this.checkPassword()&&(a.trackEventWithCategory("sso_module","sign_in","remember_me_clicks"),this.model.recaptchaCallbackData={login:this.model.mail,password:this.$el.find(this.selectors.passwordInput).val(),rememberme:!0},this.hideGenericError(),Odigeo.AB.isRecaptchaLoginEnabled&&this.model.recaptchaRendered?n.gRecaptchaExecute(this.model.recaptchaWidgetID):this.triggerSubmitRequest())},renderCaptcha:function(){Odigeo.AB.isRecaptchaLoginEnabled&&!this.model.recaptchaRendered&&this.model.get("isActivated")&&(this.model.recaptchaWidgetID=n.gRecaptchaRender(this.$el.find(this.selectors.recaptchaWrapper).get(0),_.bind(this.recaptchaExecutionCallback,this),Odigeo.UserArea.recaptchaSiteKey),this.model.recaptchaRendered=!0)},recaptchaExecutionCallback:function(){this.model.recaptchaCallbackData.recaptchaResponse=n.gRecaptchaGetResponse(this.model.recaptchaWidgetID),this.triggerSubmitRequest()},triggerSubmitRequest:function(){Odigeo.trigger(this.widget.id+":submitUserRequest",{data:this.model.recaptchaCallbackData,action:"login"})},checkPassword:function(){var e="",t=this.$el.find(this.selectors.passwordInput).val(),i=this.$el.find(this.selectors.passwordInput).data();return _.isEmpty(t)?e="empty":i&&i.validationType&&!Odigeo.Utils.isValid(i.validationType,t)&&(e="invalid"),""!==e&&this._showError(e),""===e},launchAccountBlockedFlow:function(){Odigeo.Utils.eraseCookie("sso_remember_me"),Odigeo.trigger(this.widget.id+":submitUserRequest",{data:this.model.mail,action:"recoverPassword"}),Odigeo.Router.navigate("accountblocked")},changePasswordCharsViewer:function(){this.$el.find(this.selectors.passwordIcon).find(".password_char_viewer").toggleClass("hidden"),this.$el.find(this.selectors.passwordInput).attr("type","password"===this.$el.find(this.selectors.passwordInput).attr("type")?"text":"password")},closeSession:function(e){e.preventDefault(),this.widget.enableRememberMe(!1),Odigeo.trigger(this.widget.id+":submitUserRequest",{data:"",action:"logOut"})},_showError:function(e,t){var i=this.$el.find(this.selectors.passwordInput).data(_.isUndefined(e)?"requesterror":e),n=_.isUndefined(t)?i.length>this.errorMaxLength:!!t;"requesterror"!==e&&this.$el.find(this.selectors.passwordInput).parent().addClass("invalid"),this.$el.find(this.selectors.errorMessageWrapper).addClass(n?"invalid-long":"invalid"),this.$el.find(this.selectors.errorMessageWrapper).find(n?".error_long_message":".error_message").text(i)},_showUnlError:function(){var e=Odigeo.UIElements.translations.unl.lightboxTextsVelocityRules;Odigeo.UIElements.showLightboxWarning("od-passenger-lightbox-logout",_.bind(Odigeo.trigger,Odigeo,"closeAllPopUps"),_.bind(Odigeo.trigger,Odigeo,"closeAllPopUps"),_.extend({},e,{description:e.description}))},_isAccountBlocked:function(e){return e&&e.messageError&&"accountblocked"===this.model.errors[e.messageError]},hideGenericError:function(){this.$el.find(this.selectors.rememberMeError).addClass("odf-hidden")},showGenericError:function(e){var t=this.$el.find(this.selectors.rememberMeError),i=t.data(e);t.find(".msg-item").text(i),t.removeClass("odf-hidden")}})},function(e,t,i){"use strict";var n=i(10);e.exports=n({viewClass:i(831)})},function(e,t,i){"use strict";var n=i(13),a=i(18);e.exports=a(n.extend({name:"membership_remember_me_description"}),function(e){var t=e.keys,i=e.options;return{keys:_.extend(t,{loginRememberMePassengersWellComeBack:Odigeo.Utils.replaceCmsKeyArgs(t.loginRememberMePassengersWellComeBack,i.userName)}),options:i}})},function(e,t,i){"use strict";Odigeo.defineWidget("reset_password_manager",Odigeo.Widget.extend({modelClass:i(833),viewClass:i(834),setRecoverCode:function(e){var t=Odigeo.Utils.parseHashParameters(e);this.model.hashCode=t.ac||"","legacy"===t.cf&&(this.model.isLegacy=!0,this.view.setRecoverCode())},passwordWithError:function(){this.view.passwordError("backerror")},passwordError:function(){this.view.passwordError("requestError")},passwordChangedOk:function(){this.view._trackEvent("recovery_successful_message");var e=Odigeo.UIElements.createDialog({dialogClasses:"od-login-reset-dialog",headerText:'<div class="od-login-icon-reset-pass-success"></div>',content:this.view.keys.loginChangePasswordChanged});Odigeo.UIElements.showDialog(e),_.delay(_.bind(function(){Odigeo.Utils.goToApplicationHome()},this),1500)}}))},function(e,t,i){"use strict";e.exports=Odigeo.Model.extend({hashCode:"",isLegacy:!1})},function(e,t,i){"use strict";var n=i(0);e.exports=Odigeo.View.extend({errorMaxLength:50,init:function(){this.prepareLoginStartInfo()},selectors:{resetPasswordButton:".reset_password_button",resetPasswordInput:".reset_password_input",resetPasswordDiv:".reset_password_div",resetPasswordIcon:".password_icon",backToLogin:".back_to_login",legacyUserElements:".legacy_user",resetpasswordTitle:".resetpassword_title",loginStartInfo:".login_start_info",infoProtection:".info_protection",infoTerms:".info_terms"},events:{"tap .reset_password_button":"resetPassword","input .reset_password_input":"showPasswordCharsIcon","tap .password_icon":"changePasswordCharsViewer","tap .back_to_login":"openLoginForm","tap .info_protection":"onTapInfoProtection","tap .info_terms":"onTapInfoTerms"},_trackEvent:function(e){n.trackEventWithCategory(this.model.isLegacy?"sso_legacy_pwd":"sso_change_pwd","password_set_new",e)},_clearErrors:function(){this.$el.find(this.selectors.resetPasswordDiv).removeClass("invalid").removeClass("invalid-long"),this.$el.find(".error_long_message").text(""),this.$el.find(".error_message").text("")},resetPassword:function(){var e=this.$el.find(this.selectors.resetPasswordInput),t=e.val(),i=e.data("validationType"),n="invalid";this._clearErrors(),""!==this.model.hashCode&&Odigeo.Utils.isValid(i,t,!0)?(this._trackEvent("change_password"),Odigeo.trigger(this.widget.id+":showHideModalLayer",!0),Odigeo.trigger(this.widget.id+":submitUserRequest",{action:"changePasswordWithCode",data:{newPassword:t,hashCode:this.model.hashCode}})):(this._trackEvent("sso_pwd_pci_compliance_error"),""===this.model.hashCode?n="errorcode":""===t&&(n="empty"),this.passwordError(n))},changePasswordCharsViewer:function(){var e=this.$el.find(this.selectors.resetPasswordInput);this.$el.find(this.selectors.resetPasswordIcon).find(".password_char_viewer").toggleClass("odf-hidden"),e.attr("type","password"===e.attr("type")?"text":"password")},showPasswordCharsIcon:function(e){this.$el.find(this.selectors.resetPasswordIcon).removeClass("odf-hidden"),$(e.target).off()},openLoginForm:function(){n.trackEventWithCategory("sso_module","password_recovery","go_to_login"),Odigeo.trigger(this.widget.id+":openLoginForm")},passwordError:function(e){var t=this.$el.find(this.selectors.resetPasswordInput).data(e),i=t.length>this.errorMaxLength;"backerror"===e&&this._trackEvent("recovery_error_token_used"),Odigeo.trigger(this.widget.id+":showHideModalLayer",!1),this.$el.find(this.selectors.resetPasswordDiv).addClass(i?"invalid-long":"invalid"),this.$el.find(i?".error_long_message":".error_message").text(t)},prepareLoginStartInfo:function(){var e='<span class="info_protection">'+this.keys.registerFormCreateInfoProtection+"</span>",t='<span class="info_terms">'+this.keys.registerFormCreateInfoTerms+"</span>",i=Odigeo.Utils.replaceCmsKeyArgs(this.keys.registerFormCreateInfo,e,t);this.$el.find(this.selectors.loginStartInfo).html(i)},onTapInfoProtection:function(){this._trackEvent("privacy_policy_clicks")},onTapInfoTerms:function(){this._trackEvent("terms_and_conditions_clicks")},setRecoverCode:function(){var e=this.$el.find(this.selectors.resetPasswordButton),t=this.$el.find(this.selectors.resetpasswordTitle);this.$el.find(".reset_password").addClass("od-legacy"),this.$el.find(this.selectors.legacyUserElements).removeClass("hidden"),e.text(e.data("legacy")),t.text(t.data("legacy"))}})},function(e,t,i){"use strict";var n=i(56),a=i(40)({login:["login-header",n]}),s=i(0);e.exports={seatMapSelectionData:{seatMapSelectionRequests:[],numberOfRetries:0},viewEvents:{"users-manager:logInAndUpdateAccountOk":"onLogInAndUpdateAccount","seatmap-selection-manager:updateSeatsInPassengersPage":"updateSeatsInPassengersPage","baggagesmanager:trackPrefillBaggages":"trackPrefillAncilliaries","global:userLogout":"onLogout","seatmap:updateSeatsInPassengersPage":"updateSeatsInPassengersPage"},eventHandlers:{onLogInAndUpdateAccount:function(e){var t=_.isObject(e)&&_.isObject(e.attributes)?e.attributes:e;a.get("login").execute("loginEmailOnTopOk",t)},onLogout:function(){a.get("login").execute("logOutOk")},trackPrefillAncilliaries:_.once(function(e){var t=(Odigeo.Session.get("trackABSeatsInSession")?"_seats":"")+(e.saveBaggages?"_baggage":"");Odigeo.Session.remove("trackABSeatsInSession"),t&&s.trackEvent("on_load","ancillaries_preselected"+t)}),updateSeatsInPassengersPage:function(e){_.isEmpty(e)||(this.seatMapSelectionData=e.seatData)}},getPassengersCountByType:function(e){return _.reduce(_.filter(e,function(e){return e&&e.travellerType}),function(e,t){return e[t.travellerType]=(e[t.travellerType]||0)+1,e},{})}}},function(e,t,i){"use strict";var n=i(0),a=function(e,t,i,n){Odigeo.requireWidget(e,t,function(e){e.execute(i,n)})},s=function(e,t){n.counterMetric("FRONT"+t+"CONFIRMATION_REPRICING_COUNTER"),a("repricing-popup-manager","repricing_popup_manager","setRepricing",e.data),a("price-breakdown-payments","pricemanager_enhanced","setRepricing",e.data),a("payment-manager","paymentmanager","loadRepricingMessage",e)},r=s;e.exports={repricingHandlerMobile:r,repricingHandlerDesktop:function(e,t,i){s(e,i),0<t.find("#pay-with-guarantee").length&&a("pay-with-guarantee","pay_with_guarantee","setRepricing",e.data)},paymentRetryHandler:function(e,t,i){n.counterMetric("FRONT"+t+"CONFIRMATION_RETRY_COUNTER"),a("payment-manager","paymentmanager",i,e)},userInteractionNeededHandler:function(e,t){n.counterMetric("FRONT"+t+"CONFIRMATION_3DSECURE_COUNTER"),a("payment-manager","paymentmanager","userInteractionNeeded",e)}}},function(e,t,i){"use strict";var n=i(0),a=i(838),s=i(839),r="_confirmation_page_";e.exports=function(e,t,i){this.automaticRedirectionStates=Object.freeze({NOT_ACTIVE:0,INIT:1,SUCCESSFUL:2,FAILED:3}),this.pageStatusTrackingNames=Object.freeze({BOOKING_CONFIRMED:"confirmed",BOOKING_PENDING:"pending"}),this.pageStatus="confirmed",this.automaticRedirectionStatus=this.automaticRedirectionStates.NOT_ACTIVE,this.flow=_.isBoolean(e)&&e?"dynpack":"flights",this.waitingElement="waitingPage"===_.get(i,"name","dialog")?s(i.waitingController):a,this.requestBookingDetails=function(e){var t=this._getTripData(),i=_.get(t,"buyer.mail"),n=_.get(t,"bookingId");this.executeSubmitUserRequest(i,n,e),this.waitingElement.showLoading()},this.requestBookingDetailsWithConfirmationdata=function(e,t){this.automaticRedirectionStatus=this.automaticRedirectionStates.INIT,this.pageStatus=_.get(this.pageStatusTrackingNames,t.bookingStatus,"confirmed");var i=_.get(t,"myTrip.buyer.mail"),n=_.get(t,"myTrip.bookingId");this.executeSubmitUserRequest(i,n,e),this.waitingElement.showLoading()},this.executeSubmitUserRequest=function(e,t,i){i().execute("submitUserRequest",{action:"getTrip",data:{queryParams:{email:e,bookingid:t}}})},this.goToMyTripsDetails=function(e){this._saveBookingDetailsOnSession(e),this.showFakeLoadingAndRedirect()},this.catchGetTripError=function(){this.waitingElement.closeLoading(),this.waitingElement.showError()},this.showFakeLoadingAndRedirect=function(){_.delay(function(){this.waitingElement.closeLoading(),this._deepLinkToDetails()}.bind(this),6e3)},this._trackMyTripDetailsAccess=function(){this.automaticRedirectionStatus===this.automaticRedirectionStates.SUCCESSFUL&&n.trackEventWithCategory(this.flow+r+this.pageStatus,"access_my_trip_details","automatic_redirection_successful")},this._deepLinkToDetails=function(){this._trackMyTripDetailsAccess(),t.get("login").execute("fromDeepLinkToDetails",this.flow)},this._saveBookingDetailsOnSession=function(e){var t=_.get(e,"bookingBasicInfo.id");Odigeo.Session.set("bookingInfo",JSON.stringify(e)),Odigeo.Session.set("tdid",t),this.automaticRedirectionStatus===this.automaticRedirectionStates.SUCCESSFUL&&Odigeo.Session.set("isRedirectionFromConfirmation",!0)},this._getTripData=function(){var e=Odigeo.Utils.parseJson(Odigeo.Storage.get("mytripsData"));return this._getLastBooking(e)},this._getLastBooking=function(e){return _.max(e,"bookingId")},this.catchAutomaticRedirectionError=function(){this.automaticRedirectionStatus=this.automaticRedirectionStates.FAILED,n.trackEventWithCategory(this.flow+r+this.pageStatus,"find_booking_error","access_my_trips_automatic_error")}}},function(e,t,i){"use strict";e.exports={dialog:null,showLoading:function(){this.dialog=Odigeo.UIElements.loadingMyTripsDialog()},closeLoading:function(){this.dialog.remove()},showError:function(){this.dialog=Odigeo.UIElements.loadingMyTripsErrorDialog()}}},function(e,t,i){"use strict";e.exports=function(e){return{loadingPage:e,showLoading:function(){this.loadingPage.showLoading(["waiting_confirmation_automatic_redirection","waiting_bottom","waiting_confirmation","waiting_bottom_gradient"])},closeLoading:function(){},showError:function(){}}}},function(e,t,i){"use strict";var n=i(10);e.exports=n({modelClass:i(841),viewClass:i(842),isEnabled:function(){return Odigeo.Membership.enabledSpecialPrimeWidgets&&Odigeo.Membership.isShowMemberhsipAutoRenewal},methods:{onAutoRenewalOk:function(){this.model.setAutoRenewal(!this.model.isAutoRenewalEnabled())},updateModel:function(e){this.model.update(e)}}})},function(e,t,i){"use strict";e.exports=Backbone.Model.extend({defaults:{isAutoRenewalEnabled:!0},isAutoRenewalEnabled:function(){return this.get("isAutoRenewalEnabled")},setAutoRenewal:function(e){this.set("isAutoRenewalEnabled",e)},update:function(e){var t="ENABLED"===e.autoRenewalStatus,i=_.get(e,"expirationDate","");this.set({isAutoRenewalEnabled:t,membershipSubscriptionDate:i})}})},function(e,t,i){"use strict";var n=i(13),a=i(18),s=i(0);e.exports=a(n.extend({name:"membership_account_billing",selectors:{autoRenewalCheckbox:"#membership-auto-renewal",accountPrefRenewalBtn:".account_pref_renewal_btn",renewalClose:".renewal_close"},slctrs:{renewalView:".account_pref_renewal_overlay"},tmpls:{mainTemplate:".membership_account_billing"},events:{"tap #membership-auto-renewal":"onAutoRenewalAction","tap .renewal_close":"toggleModal","tap .account_pref_renewal_btn":"actionModal"},toggleModal:function(){var e=this.$el.find(this.slctrs.renewalView);e.toggleClass("open opened"),e.hasClass("open opened")?s.trackEvent("nags","nag_prime_disable_renewal"):s.trackEvent("nags","nag_prime_disable_renewal_add")},actionModal:function(e){e.stopPropagation(),e.preventDefault(),s.trackEvent("nags","nag_prime_disable_renewal_continue"),this.disableAutoRenewal()},disableAutoRenewal:function(){Odigeo.trigger(this.id+":onDisableAutoRenewal")},initialize:function(){this.listenTo(this.model,"change",this.renderMainTemplate)},renderMainTemplate:function(){var e=this.model.isAutoRenewalEnabled(),t=this.model.get("membershipSubscriptionDate"),i=Odigeo.Utils.formatDateFromString(t,"yyyy-mm-dd","dd/MM/yyyy"),n=e?this.keys.endDateActive:this.keys.endDateUnactive;this.$el.html(this.templates.main({isAutoRenewalEnabled:e,endDate:Odigeo.Utils.replaceCmsKeyArgs(n,i),keys:this.keys}))},onAutoRenewalAction:function(e){e.target.checked?(s.trackEvent("nags","nag_prime_disable_renewal_add"),Odigeo.trigger(this.id+":onEnableAutoRenewal")):(e.stopPropagation(),e.preventDefault(),this.toggleModal())}}))},function(e,t,i){"use strict";var n=i(10);e.exports=n({modelClass:i(844),viewClass:i(845),methods:{setUserDTO:function(e){this.model.setUserDTO(e)}}})},function(e,t,i){"use strict";e.exports=Backbone.Model.extend({defaults:{userDTO:null,validCard:!1,subscriptionDetailsDTO:null,hasExpiredCreditCards:!1,hasValidCreditCards:!1},getHasExpiredCreditCards:function(){return this.get("hasExpiredCreditCards")},getCCToRemove:function(){return this.get("ccToRemove")},getHasValidCreditCards:function(){return this.get("hasValidCreditCards")},getFormattedExpireDate:function(e){return e.expirationDateMonth.concat("/",this.getFormattedYear(e.expirationDateYear))},getFormattedYear:function(e){if(_.isEqual(e.length,4))return e;var t=(new Date).getFullYear();return Math.floor(t/100)+e.slice(0,2)},isFillCardList:function(e){return e=e||this.get("userDTO"),_.has(e,"creditCards")&&!_.isEmpty(e.creditCards)},isCardExpirationDateValid:function(e){return new Date(this.getFormattedYear(e.expirationDateYear).concat("-",e.expirationDateMonth))>=new Date},getCreditCardsState:function(){var e=this.get("userDTO"),t=this.isFillCardList(e);return{hasValidCreditCards:t&&_.some(e.creditCards,_.bind(this.isCardExpirationDateValid,this)),hasExpiredCreditCards:t&&_.some(e.creditCards,_.negate(_.bind(this.isCardExpirationDateValid,this)))}},updateCardsStatus:function(){this.set(this.getCreditCardsState())},setUserDTO:function(e){!this.initialized&&_.isObject(e)&&this.set("userDTO",e.userDTO)}})},function(e,t,i){"use strict";var n=i(13),a=i(18),s=i(167),r=i(0);e.exports=a(s(n.extend({name:"membership_billing_information",selectors:{billingInformationWrapper:".acc_pref_billing_information",billingInformationCCList:".acc_pref_billing_information_list",billingInformationContent:".acc_pref_billing_information_content",billingInformationComplement:".acc_pref_billing_information_complement",addNewCardAction:".acc_pref_add_new_card_action",removeCardAction:".acc_pref_cc_cross",removeCardContainer:".acc_pref_remove_card",moreCardAction:".acc_pref_cc_more_action",moreWrapper:".acc_pref_cc_more_remove",moreRemoveCardAction:".acc_pref_cc_more_remove",closeRemoveCardContainer:".acc_pref_remove_card_close",closeIconRemoveCardContainer:".close_remove_cc_modal",removeCardConfirmationBtn:".acc_pref_remove_card_btn",ccDataItemMobile:".cc_data_item_mobile",ccNameContainer:".acc_pref_cc_name",ccOwnerContainer:".acc_pref_cc_owner"},events:{"tap .acc_pref_add_new_card_action":"onAddNewCardAction","tap .acc_pref_cc_cross":"onRemoveCardAction","tap .acc_pref_cc_more_action":"onMoreCardAction","tap .acc_pref_remove_card_btn":"onRemoveCardConfirmation","tap .acc_pref_remove_card_close":"cancelRemoveCardConfirmation","tap .close_remove_cc_modal":"closeRemoveCardConfirmation","tap .cc_data_item_mobile":"onCcDataItemMobile","mouseover .acc_pref_cc_name":"onCcHover","mouseout .acc_pref_cc_name":"onCcHover","mouseover .acc_pref_cc_owner":"onCcHover","mouseout .acc_pref_cc_owner":"onCcHover"},constants:{trackingCategory:"my_area_account",limitCharsName:49,limitCharsCardType:12,limitCharsComplete:"...",ccNumberComplete:"**** ",tooltipDelay:250},initialize:function(){this.requestCreditCardList(),this.renderRemoveCardConfirmation(),this.updateDomSelectorsToCache(),this.viewListeners()},viewListeners:function(){this.listenTo(this.model,"change:userDTO ",this.renderUserCreditCards),this.listenTo(this.model,"change:hasValidCreditCards",this.sendBillingCardsAvailable)},requestCreditCardList:function(){Odigeo.trigger(this.id+":updateCreditCardList")},sendBillingCardsAvailable:function(e,t){Odigeo.trigger(this.id+":billingCardsAvailable",t)},onAddNewCardAction:function(){this.trackAddCardEvent(),Odigeo.trigger(this.id+":addCreditCard")},onRemoveCardAction:function(e){var t=Number($(e.target).closest("li").attr("data-id"));this.model.set("ccToRemove",[t]),this.$cachedSelectors.removeCardContainer.addClass("open opened"),this.trackDeleteCardEvent(t)},onRemoveCardConfirmation:function(){this.trackCancelPopupEvent("remove"),Odigeo.trigger(this.id+":deleteCreditCard",this.model.get("ccToRemove")),this.onCancelRemoveCardConfirmation()},cancelRemoveCardConfirmation:function(){this.trackCancelPopupEvent("cancel"),this.onCancelRemoveCardConfirmation()},onMoreCardAction:function(e){var t=$(e.target).closest(".acc_pref_cc_more").find(".acc_pref_cc_more_remove"),i=t.hasClass("odf-hidden");this.toggleHiddenClass(this.$cachedSelectors.moreWrapper,!0),this.toggleHiddenClass(t,!i)},onCcDataItemMobile:function(e){$(e.target).hasClass("acc_pref_cc_more_remove")||$(e.target).hasClass("acc_pref_cc_more_action")||this.toggleHiddenClass(this.$cachedSelectors.moreRemoveCardAction,!0)},onCcHover:function(e){var t=$(e.currentTarget);e.type===Odigeo.Events.mouseover?this.tooltipId=setTimeout(function(){t.addClass("open")},this.constants.tooltipDelay):(clearTimeout(this.tooltipId),t.removeClass("open"))},toggleHiddenClass:function(e,t){e.toggleClass("odf-hidden",t)},closeRemoveCardConfirmation:function(){this.trackCancelPopupEvent("close"),this.onCancelRemoveCardConfirmation()},onCancelRemoveCardConfirmation:function(){this.$cachedSelectors.removeCardContainer.removeClass("open opened")},renderUserCreditCards:function(){this.renderCreditCardsTemplate(),this.model.updateCardsStatus(),this.trackLoadEvent(),this.renderCardAction(),this.updateDomSelectorsToCache()},renderCreditCardsTemplate:function(){var e=this.model.get("userDTO");this.$cachedSelectors.billingInformationCCList.empty();var t=!1;this.model.isFillCardList(e)&&this.$cachedSelectors.billingInformationCCList.append(_.map(e.creditCards,_.bind(function(e){var i=this.model.isCardExpirationDateValid(e);return t=i||t,this.templates.creditcardInfo({cardId:e.id,isValidCC:i,ccName:this.sliceAndComplete(e.creditCardType.creditCardName,this.constants.limitCharsCardType),ccNumber:this.ccNumberFormat(e.creditCardNumber),ccExpire:Odigeo.Utils.replaceCmsKeyArgs(this.keys.billingInformationExpireText,this.model.getFormattedExpireDate(e)),ccOwner:this.sliceAndComplete(e.owner,this.constants.limitCharsName),ccMoreRemove:this.keys.billingInformationMoreRemoveCard})},this))),Odigeo.trigger(this.id+":billingCardsAvailable",t)},renderCardAction:function(){var e=this.model.get("userDTO");this.$cachedSelectors.billingInformationComplement.empty(),this.$cachedSelectors.billingInformationComplement.append($(this.templates.actionsCardInfo({addNewCC:this.keys.billingInformationAddBtn,noCardStoredMsg:this.keys.noCardStoredMsg,isCreditCardListEmpty:_.has(e,"creditCards")&&_.isEmpty(e.creditCards)}))),this.updateDomSelectorsToCache()},renderRemoveCardConfirmation:function(){this.$cachedSelectors.billingInformationWrapper.append($(this.templates.removeCardConfirmation({billingInformationRemoveCardTitle:this.keys.billingInformationRemoveCardTitle,billingInformationRemoveCardDescription:this.keys.billingInformationRemoveCardDescription,billingInformationRemoveCardBtnNo:this.keys.billingInformationRemoveCardBtnNo,billingInformationRemoveCardBtnYes:this.keys.billingInformationRemoveCardBtnYes})))},sliceAndComplete:function(e,t){return e.length<t?e:e.slice(0,t).concat(this.constants.limitCharsComplete)+'<span class="odf-tooltip odf-tooltip-top-center odf-tooltip-dark odf-text-nowrap">'+e+"</span>"},ccNumberFormat:function(e){return this.constants.ccNumberComplete.concat(e.slice(-4))},trackLoadEvent:function(){if(!Odigeo.Session.get("isCreditCardBillingTrackingDone")){var e="prime_cc"+this.getExpiredCardsLabel()+this.getValidCardsLabel();this.trackEvent("prime_cc_widget",e),Odigeo.Session.set("isCreditCardBillingTrackingDone",!0)}},trackAddCardEvent:function(){var e="cc_widget"+this.getExpiredCardsLabel()+this.getValidCardsLabel()+"_add_card";this.trackEvent("cc_widget",e)},trackDeleteCardEvent:function(e){var t="cc_widget"+this.getExpiredCardsLabel()+this.getValidCardsLabel()+this.getToDeleteCreditCardLabel(e);this.trackEvent("cc_widget",t)},trackCancelPopupEvent:function(e){var t=_.first(this.model.getCCToRemove()),i="cc_widget"+this.getExpiredCardsLabel()+this.getValidCardsLabel()+this.getToDeleteCreditCardLabel(t)+"_"+e;this.trackEvent("cc_widget",i)},trackEvent:function(e,t){r.trackEventWithCategory(this.constants.trackingCategory,e,t)},getExpiredCardsLabel:function(){return"_expired:"+Number(this.model.getHasExpiredCreditCards())},getValidCardsLabel:function(){return"_valid:"+Number(this.model.getHasValidCreditCards())},getToDeleteCreditCardLabel:function(e){var t=this.model.get("userDTO"),i=_.find(t.creditCards,_.matchesProperty("id",e)),n=!this.model.isCardExpirationDateValid(i);return"_remove_card_".concat(n?"expired":"valid")}})))},function(e,t,i){"use strict";var n=i(10);e.exports=n({viewClass:i(847),modelClass:i(848),methods:{displayAddCCModal:function(){this.model.set("displayAddCCModal",!0)},onCreditCardAdded:function(){this.trackAddCardPopupEvent("added"),this.model.setCCFormError(!1)},onFailedCreditCardAdded:function(){this.trackAddCardPopupEvent("error"),this.model.setCCFormError(!0)},setCCFormError:function(e){this.model.setCCFormError(e)}}})},function(e,t,i){"use strict";var n=i(13),a=i(18),s=i(167),r=i(323),o=i(333),c=i(51),d=i(0);e.exports=a(s(n.extend({name:"membership_card_info_manager",selectors:{binDetectionContainer:".bin_detection_container",ccnumber:'input[name="ccnumber"]',ccOwner:'input[name="nameoncard"]',expDateMonthDrop:'select[name="cardExpirationMonth"]',expDateYearDrop:'select[name="cardExpirationYear"]',cardOptionsDrop:'select[name="cardTypeSelector"]',cardInputs:'input[name="nameoncard"], input[name="ccnumber"]',ccTypeIcon:".cc-type-icon",creditCardModal:".acc_pref_member_cc_manager_add_credit_card",closeCreditCardModal:".close_add_cc_modal",formContainer:".add_cc_form",formObj:".acc_pref_member_cc_form",submitCCData:".submit_cc_data",ccFormError:".cc_form_error",expDateContainer:".exp_date",selectCardType:".acc_pref_select_type_card",validationFieldInputs:".acc_pref_member_cc_form .validation_field",clearInputs:".clear_input"},events:{"tap .close_add_cc_modal":"onCloseCreditCardModal",'change input[name="ccnumber"]':"onCreditCardNumberChanged",'input input[name="ccnumber"]':"onCreditCardNumberChanged",'focus input[name="nameoncard"], input[name="ccnumber"]':"onValidateCreditCardInput",'blur input[name="nameoncard"], input[name="ccnumber"]':"onValidateCreditCardInput","tap .clear_input":"onClearInput",'change input[name="nameoncard"]':"onCreditCardOwnerChanged",'input input[name="nameoncard"]':"onCreditCardOwnerChanged",'change select[name="cardExpirationMonth"]':"onCreditCardExpDateMonthChanged",'change select[name="cardExpirationYear"]':"onCreditCardExpDateYearChanged",'change select[name="cardTypeSelector"]':"onCreditCardManualTypeNameChanged"},constants:{supportedPrimeCards:{ccTypeMasterCredit:"CA",ccTypeMasterDebit:"MD",ccTypeVisaCredit:"VI",ccTypeVisaDebit:"VD",ccTypeVisaElectron:"VE",ccTypeAmex:"AX",ccTypeTP:"TP",ccTypeDc:"DC"},minCCNumberLength:13,minCCOwnerLength:6,yearRange:11,validState:"valid",invalidState:"invalid",emptyState:"empty",initState:"init",defaultSelect:"default",ccNumberPattern:"ccNumberFormatted",trackingCategory:"my_area_account",validIcon:"7",invalidIcon:"r"},initialize:function(){this.renderCCForm(),this.updateCachedViewListener(),this.setInputsPattern()},setInputsPattern:function(){r.initInputPattern(this.$cachedSelectors.ccOwner),r.initInputPattern(this.$cachedSelectors.ccnumber)},updateCachedViewListener:function(){this.listenTo(this.model,"change:displayAddCCModal",this.onCreditCardDisplayChange),this.listenTo(this.model,"change:creditCardTypeCode",this.onCreditCardTypeCodeChange),this.listenTo(this.model,"change:showCCFormError",this.onCreditCardFormErrorChange)},onCloseCreditCardModal:function(){this.trackAddCardPopupEvent("close"),this.model.set("displayAddCCModal",!1)},onCreditCardNumberChanged:_.debounce(function(e){var t=this.$cachedSelectors.ccnumber.val();this.model.set({isPaste:e,creditCardNumber:c.trimCreditCardNumber(t)})},300),onClearInput:function(e){$(e.target).closest(".validation_field").find("input").val("").trigger("change")},onValidateCreditCardInput:function(e){var t=$(e.target),i=t.attr("data-name"),n=this.getValidationField(t),a=Odigeo.Utils.trim(t.val()),s=_.isEqual(e.type,"focusin");c.showHidePlaceholder(t,s),n.toggleClass("od-acc-pref-cc-input focused",s);var r=0;_.isEqual(i,"ccnumber")?r=this.constants.minCCNumberLength:_.isEqual(i,"nameoncard")&&(r=this.constants.minCCOwnerLength),a.length&&a.length<r?(n.attr("data-state",this.constants.invalidState),c.showError(n)):c.setStateAndShowError(t,!0,!1)},onCreditCardOwnerChanged:function(){this.model.set("creditCardOwner",this.$cachedSelectors.ccOwner.val())},onCreditCardExpDateMonthChanged:function(e){var t=$(e.target),i=this.getValidationField(t),n=t.val();this.model.set("creditCardExpMonthDate",n);var a=_.isEqual(n,this.constants.defaultSelect)?this.constants.emptyState:this.constants.validState;i.attr("data-state",a)},onCreditCardExpDateYearChanged:function(e){var t=$(e.target),i=this.getValidationField(t),n=t.val();this.model.set("creditCardExpYearDate",n);var a=_.isEqual(n,this.constants.defaultSelect)?this.constants.emptyState:this.constants.validState;i.attr("data-state",a),_.isEqual(a,this.constants.emptyState)||this.isExpirationDateValid(n,this.model.get("creditCardExpMonthDate"))||i.attr("data-state",this.constants.invalidState)},getValidationField:function(e){return e.closest(".validation_field")},toggleSelectCardType:function(e){e&&this.$cachedSelectors.cardOptionsDrop.val(this.constants.defaultSelect),this.$cachedSelectors.selectCardType.toggleClass("odf-hidden",!e)},onSubmitCCData:function(e){e&&e.preventDefault(),Odigeo.trigger(this.id+":submitCCData",[{creditCardNumber:this.model.get("creditCardNumber"),expirationDateMonth:this.model.get("creditCardExpMonthDate"),expirationDateYear:this.model.get("creditCardExpYearDate").slice(-2),owner:this.model.get("creditCardOwner"),creditCardType:{creditCardCode:this.model.get("creditCardTypeCode")}}])},onCreditCardDisplayChange:function(){this.$cachedSelectors.creditCardModal.toggleClass("open opened",this.model.get("displayAddCCModal")),this.clearFormInputData()},onCreditCardFormErrorChange:function(){this.$cachedSelectors.ccFormError.toggleClass("odf-hidden",!this.model.get("showCCFormError"))},setCreditCardTypeIcon:function(e){this.$cachedSelectors.ccTypeIcon.attr("data-card",e)},setCreditCardFormat:function(e){e&&(r.setSelectedCreditCard(e),this.$cachedSelectors.ccnumber.trigger(Odigeo.Events.input).trigger(Odigeo.Events.keydown))},onCreditCardManualTypeNameChanged:function(e){var t=$(e.target).val();this.model.set("creditCardTypeCode",t)},onCreditCardTypeCodeChange:function(){var e=this.model.get("creditCardTypeCode"),t=o[e]?o[e].name:e;e=this.isCardCodeSupported(e)?e:null,this.setCreditCardTypeIcon(e),this.setCreditCardFormat(e),Odigeo.trigger(this.id+":creditCardTypeCodeChanged",e,t),_.isEmpty(e)&&this.toggleSelectCardType(!_.isEmpty(this.model.get("creditCardNumber")))},clearFormInputData:function(){this.$cachedSelectors.formObj.trigger("reset"),this.model.set({creditCardNumber:"",creditCardOwner:"",creditCardExpMonthDate:"",creditCardExpYearDate:""}),this.$cachedSelectors.validationFieldInputs.focus(),this.$cachedSelectors.validationFieldInputs.blur(),this.$cachedSelectors.validationFieldInputs.attr("data-state",this.constants.initState),this.toggleSelectCardType(!1)},renderSelectCardOptions:function(){this.$cachedSelectors.cardOptionsDrop.append(_.map(this.constants.supportedPrimeCards,_.bind(function(e,t){return $("<option>").attr({value:e}).text(this.keys[t])},this)))},renderCCForm:function(){return this.$cachedSelectors.formContainer.append($(this.templates.cardForm({ccNumber:this.keys.ccNumber,ccNumberHelpMessage:this.keys.ccNumberHelpMessage,ccOwner:this.keys.ccOwner,ccOwnerHelpMessage:this.keys.ccOwnerHelpMessage,ccOwnerPlaceholder:this.keys.ccOwnerPlaceholder,ccOwnerDataError:this.keys.ccOwnerDataError,ccOwnerDataMandatory:this.keys.ccOwnerDataMandatory,ccNotDetected:this.keys.ccNotDetected,ccSelectType:this.keys.ccSelectType,ccExpirationDate:this.keys.ccExpirationDate,ccExpirationDateDataError:this.keys.ccExpirationDateDataError,ccExpirationDateDataMandatory:this.keys.ccExpirationDateDataMandatory,ccAddBtn:this.keys.ccAddBtn,ccMonthSel:this.keys.ccMonthSel,ccYearSel:this.keys.ccYearSel,validIcon:this.constants.validIcon,invalidIcon:this.constants.invalidIcon}))),this.updateDomSelectorsToCache(),this.$cachedSelectors.formObj.on("submit",_.bind(this.onSubmitCCData,this)),this.renderBinDetection()},renderBinDetection:function(){this.$cachedSelectors.binDetectionContainer.prepend($(this.templates.ccBinDetection({ccNumberPlaceholder:this.keys.ccNumberPlaceholder,ccNumberDataMandatory:this.keys.ccNumberDataMandatory,ccNumberDataError:this.keys.ccNumberDataError,ccMinLength:this.constants.minCCNumberLength,ccNumberFormatted:this.constants.ccNumberPattern,validIcon:this.constants.validIcon}))),this.updateDomSelectorsToCache(),this.renderMonthExpDate(),this.renderYearExpDate(),this.renderSelectCardOptions(),this.updateDomSelectorsToCache()},renderMonthExpDate:function(){this.$cachedSelectors.expDateMonthDrop.append(_.map(this.getMonthRange(),function(e){var t=e<10?"0"+e.toString():e.toString();return $("<option>").attr({value:t}).text(t)}))},renderYearExpDate:function(){this.$cachedSelectors.expDateYearDrop.append(_.map(this.getYearRange(),function(e){return $("<option>").attr({value:e.toString()}).text(e.toString())}))},isCardCodeSupported:function(e){return e in _.invert(this.constants.supportedPrimeCards)},getMonthRange:function(){return _.range(1,13)},getYearRange:function(){var e=new Date;return _.range(e.getFullYear(),e.getFullYear()+this.constants.yearRange)},isExpirationDateValid:function(e,t){return new Date(e.concat("-",t))>new Date},trackAddCardPopupEvent:function(e){var t="cc_widget_add_card_"+e;d.trackEventWithCategory(this.constants.trackingCategory,"cc_widget",t)}})))},function(e,t,i){"use strict";e.exports=Backbone.Model.extend({dataURL:"getcreditcardbindetails",defaults:{creditCardBinCache:[],creditCardNumber:null,creditCardType:null,creditCardTypeCode:null,creditCardBin:null,creditCardHolder:null,creditCardExpDate:null,displayAddCCModal:null,showCCFormError:!1},initialize:function(){this.updateModelListeners()},updateModelListeners:function(){this.on("change:creditCardNumber",this.onCreditCardNumberChange),this.on("change:creditCardBin",this.onCreditCardBinChange)},getCreditCardTypeCode:function(e){return e.creditCardTypeCodeList[0]},onCreditCardNumberChange:function(){var e=this.get("creditCardNumber"),t=e.substring(0,6);/^[0-9]{6,19}$/.test(e)?t!==this.get("creditCardBin")&&this.set("creditCardBin",t):this.set({creditCardType:"",creditCardTypeCode:"",creditCardBin:""})},onCreditCardBinChange:function(){var e=this.get("creditCardBin"),t=this.get("creditCardBinCache"),i=_.find(t,{creditCardBin:e});this.xhr&&this.xhr.abort(),_.isObject(i)?this.set({creditCardTypeCode:this.getCreditCardTypeCode(i)}):e&&(this.xhr=this.fetch(this.getRequest({creditCardBin:e})))},getRequest:function(e){return{type:"POST",data:JSON.stringify(e),timeout:11e3,contentType:"application/json",dataType:"json",cache:!1,success:_.bind(this.requestSuccessHandler,this),error:_.bind(this.requestErrorHandler,this)}},requestSuccessHandler:function(e,t){if(t.error)return this.requestErrorHandler(t);this.get("creditCardBinCache").push(t),this.set({creditCardBinDetails:t,creditCardTypeCode:this.getCreditCardTypeCode(t)}),this.xhr=null},requestErrorHandler:function(e){_.isObject(e)&&e.error?this.trigger("unknownCardType",e.error):this.trigger("unknownCardType","ERROR500_ONEFRONT_NOT_RESPONSE"),this.set("creditCardTypeCode",null),this.xhr=null},setCCFormError:function(e){this.set({showCCFormError:e,displayAddCCModal:e})},url:function(){return Odigeo.Settings.getProperty("serviceCollectionMethodFormatter")(this.dataURL)}})},function(e,t,i){"use strict";var n=i(10);e.exports=n({modelClass:i(850),viewClass:i(851),methods:{setBillingCardAvailable:function(e){this.model.setBillingCardAvailable(e),this.model.checkWarningRules()},setSubscriptionDetails:function(e){this.setSubscriptionDetails(e)}}})},function(e,t,i){"use strict";e.exports=Backbone.Model.extend({defaults:{subscriptionPaymentMethod:null,isBillingCardAvailable:!1,warningMessage:null,warningMessageType:"highlight"},messageTypeWarning:"warning",messageTypeHighlight:"highlight",isCreditCardExists:function(){return!_.isNull(this.getCreditCardNumber())},isCreditCardExpired:function(){return!!this.isCreditCardExists()&&new Date(this.getExpirationDateYear().concat("-",this.getExpirationDateMonth()))<new Date},checkWarningRules:function(){var e=this.getBillingCardAvailable(),t=this.isCreditCardExists(),i=this.isCreditCardExpired(),n=!t||i?this.buildWarningMessage(e,t):null;this.setWarningMessage(n)},buildWarningMessage:function(e,t){var i=this.get("translations"),n=i.infoInvalidMessage,a=i.warningInvalidMessage,s=i.infoExpiredMessage,r=i.warningExpiredMessage;return e?this.buildKeyWhenCreditCardNotExist(t,s,n,this.messageTypeHighlight):this.buildKeyWhenCreditCardNotExist(t,r,a,this.messageTypeWarning)},buildKeyWhenCreditCardNotExist:function(e,t,i,n){return this.setMessageType(n),e?t:i},getBillingCardAvailable:function(){return this.get("isBillingCardAvailable")},getSubscriptionPaymentMethod:function(){return this.get("subscriptionPaymentMethod")},getCreditCardName:function(){return _.get(this.getSubscriptionPaymentMethod(),"creditCardType.creditCardName",null)},getCreditCardNumber:function(){var e=_.get(this.getSubscriptionPaymentMethod(),"creditCardNumber",null);return _.isNull(e)?e:_.padLeft(e.slice(-4),8,"*")},getExpirationDateMonth:function(){return _.get(this.getSubscriptionPaymentMethod(),"expirationDateMonth",null)},getExpirationDateYear:function(){return this.getFormattedYear(_.get(this.getSubscriptionPaymentMethod(),"expirationDateYear",null))},getExpirationDate:function(){return this.getExpirationDateMonth().concat("/",this.getExpirationDateYear())},getCreditCardOwner:function(){return _.get(this.getSubscriptionPaymentMethod(),"owner",null)},getFormattedYear:function(e){if(_.isEqual(e.length,4))return e;var t=(new Date).getFullYear();return Math.floor(t/100)+e.slice(0,2)},setMessageType:function(e){this.set("warningMessageType",e)},setWarningMessage:function(e){this.set("warningMessage",e)},setBillingCardAvailable:function(e){this.set("isBillingCardAvailable",e)}})},function(e,t,i){"use strict";var n=i(13),a=i(18),s=i(167),r=i(0);e.exports=a(s(n.extend({name:"membership_default_billing",selectors:{creditCardInfo:".credit_card_info",warningMessage:".warning_message"},initialize:function(){this.requestSubscriptionDetails(),this.model.set("translations",this.keys),this.listenTo(this.model,"change:subscriptionPaymentMethod",this.renderCreditCardInfo),this.listenTo(this.model,"change:warningMessage",this.renderWarningMessage)},requestSubscriptionDetails:function(){Odigeo.trigger(this.id+":getSubscriptionDetails")},setSubscriptionDetails:function(e){if(!this.model.initialized){var t=_.get(e,"memberSubscriptionDetailsDTO.subscriptionPaymentMethod",null);this.model.set("subscriptionPaymentMethod",t),this.trackCard()}},trackCard:function(){var e=this.model.isCreditCardExists(),t=this.model.isCreditCardExpired(),i=e?t?"expired":"valid":"none";r.trackEvent("prime_cc_widget","prime_cc_widget_"+i,"my_area_account")},renderCreditCardInfo:function(){if(this.model.isCreditCardExists()){var e=this.model.isCreditCardExpired()?this.keys.expiredMessage:this.keys.expireMessage,t={ccName:this.model.getCreditCardName(),ccNumber:this.model.getCreditCardNumber(),ccExpirationDate:this.model.getExpirationDate(),ccOwner:this.model.getCreditCardOwner(),ccExpirationMessage:e};this.$cachedSelectors.creditCardInfo.html(this.templates.creditCardInfo(t)),this.model.checkWarningRules()}},renderWarningMessage:function(){var e={message:this.model.get("warningMessage"),type:this.model.get("warningMessageType")};this.$cachedSelectors.warningMessage.html(this.templates.warningMessage(e))}})))},function(e,t,i){"use strict";var n=i(13),a=i(0);e.exports=n.extend({name:"find_booking",selectors:{findBookingItem:".find_booking_item"},events:{"tap .find_booking_item":"openFindBookingLink"},renderTemplate:function(e){this.processFindBookingTemplateData(e),this.$el.html(this.templates.main({keys:this.keys,options:this.options}))},emptyFindBookings:function(){this.$el.empty()},processFindBookingTemplateData:function(e){this.keys=_.extend(this.keys,{gtLink:Odigeo.Utils.replaceCmsKeyArgs(this.keys.gtLink,"link-mytrips")}),this.options=_.extend(this.options,{isHotelsLink:!_.isEmpty(this.keys.isHotelsLink)&&"true"===this.keys.isHotelsLink.toLowerCase(),isCarsLink:!_.isEmpty(this.keys.isCarsLink)&&"true"===this.keys.isCarsLink.toLowerCase(),isGtLink:!_.isEmpty(this.keys.hasGtGlobal)&&"true"===this.keys.hasGtGlobal.toLowerCase()&&!_.isEmpty(this.keys.hasGtLoginLocal)&&"true"===this.keys.hasGtLoginLocal.toLowerCase(),categoryBookings:e})},openFindBookingLink:function(e){var t=$(e.currentTarget),i=t.data("ref"),n=t.data("track-category"),s=t.data("track-action"),r=t.data("track-label"),o=_.isEmpty(t.data("place"))?"_self":t.data("place");_.isEmpty(i)||(a.trackEvent(s,r,n),_.isEqual(o,"_blank")?window.open(i):window.open(i,o,!1))}})},function(e,t,i){"use strict";var n=$(".waiting_page"),a=i(0),s=i(357),r=i(589),o=Odigeo.autoloadWidgetsAsync({getUsersManager:["users-manager","usersmanager"],getPostBookingAccommodation:["post-booking-accommodation","post_booking_accommodation"],getAccommodationSearchManager:["accommodation-search-post-booking","accommodation_search_manager"]}),c=function(e,t){_.each(e,function(e){_.isEmpty(e.code)||a.trackEvent("intermediate_page_on_load","intermediate_page_not_shown_"+t+e.code)})};e.exports={viewEvents:{"post-booking:loadTrip":"onLoadTrip","post-booking-accommodation:available":"onAvailableAccommodationPostBooking","post-booking-accommodation:loadError":"onAccommodationPostBookingError","accommodation-search-post-booking:successPostBookingAccommodationSearch":"onSuccessPostBookingAccommodationSearch","accommodation-search-post-booking:errorNewAccommodationSearch":"onErrorPostBookingAccommodationSearch","users-manager:getTripOk":"onTripLoadOk","post-booking:noParams":"onTripLoadOk","users-manager:getTripWithError":"onTripLoadError","users-manager:getTripError":"onTripLoadError"},eventHandlers:{onLoadTrip:function(e){o.getUsersManager().execute("submitUserRequest",e)},onAvailableAccommodationPostBooking:function(e){o.getAccommodationSearchManager().execute("postBooking",e,!1)},onAccommodationPostBookingError:function(){a.trackPage("results_error",{funnel:"hotels"})},onErrorPostBookingAccommodationSearch:function(){o.getPostBookingAccommodation().execute("error","no_hotel_results")},onSuccessPostBookingAccommodationSearch:function(e){Odigeo.Session.set("intPageAccommodationResults",JSON.stringify(e)),_.isEmpty(e.errors)?!_.isEmpty(e.messages)||e.accommodationSearchResultsMetadata.numResults<1?(c(e.messages,"postbooking-noavailable_"),o.getPostBookingAccommodation().execute("error","no_hotel_results")):(a.trackEvent("intermediate_page_on_load","intermediate_page_shown_postBooking"),e.analyticsSearchInfo&&Odigeo.Session.set("analyticsSearchInfo",JSON.stringify(e.analyticsSearchInfo)),this.goToIntermediatePage()):(c(e.errors,"postbooking-noavailable_"),o.getPostBookingAccommodation().execute("error","no_hotel_results"))},goToIntermediatePage:function(){var e,t,i;e=Odigeo.Settings.getProperty("pathNames"),t=location.protocol,i=e[Odigeo.Router.getApp("home")],location.href=t+"//"+location.hostname+(location.port?":"+location.port:"")+i+"#/xsellproductselection/"},onTripLoadOk:function(e){if(e.bookingDetailDTO){if(s=(n=e).bookingDetailDTO.itineraryBookings.bookingItinerary.arrivalDate,r=n.bookingDetailDTO.itineraryBookings.bookingItinerary.departureDate,(c="mobile"===Odigeo.SessionScope.flow||n.bookingDetailDTO.bookingBasicInfo.website.code!==Odigeo.SessionScope.website||"CONTRACT"!==n.bookingDetailDTO.bookingStatus||30<(s-r)/864e5||"TL"===Odigeo.SessionScope.brand||!Odigeo.AB.isAccommodationPostBookingEnabled)&&a.trackEvent("accommodation_postbooking_on_load"," postbook_redirect_white_label"),c){var t=Odigeo.AB.isExpediaLinksAndWidget?"&wapb3="+Odigeo.Session.get("wapb3"):";label="+Odigeo.Session.get("label"),i=this.getWhiteLabelUrl(e.bookingDetailDTO);return window.location.replace(i+t),null}a.trackEvent("accommodation_postbooking_on_load"," postbook_own_funnel"),Odigeo.Session.set("bookingInfo",JSON.stringify(e.bookingDetailDTO)),o.getPostBookingAccommodation().execute("load",e.bookingDetailDTO)}else o.getPostBookingAccommodation().execute("error","no_booking_found");var n,s,r,c},getWhiteLabelUrl:function(e){var t={expedia:Odigeo.UIElements.translations.expediaHotelsUrl,booking:Odigeo.UIElements.translations.bookingHotelsUrl,expediaHotels:Odigeo.UIElements.translations.expediaHotels,isGtActive:Odigeo.UIElements.translations.myTripsXsellParameters.gtActive},i=_.extend({},this.keys,{params:t}),n=s(e),a=this.getHotelsUrl(i);return r(n,a)},getHotelsUrl:function(e){var t=Odigeo.AB.isExpediaLinksAndWidget?e.params.expedia.deeplink:e.params.booking.deeplink;return{expediaParams:_.pick(e.params.expediaHotels,"id","key"),url:t}},onTripLoadError:function(){o.getPostBookingAccommodation().execute("error","no_booking_found")},trackErrorAndMessages:function(e,t){_.each(e,function(e){if(!_.isEmpty(e.code)){var i="WNG-024"===e.code?"noresults":e.code;a.trackEvent("intermediate_page_on_load","intermediate_page_not_shown_"+t+i)}})}},showWaitingPage:function(){Odigeo.UIElements.enhanceLoading(n).showLoading(["waiting_post_booking_accommodation_intermediate"])},trackErrorAndMessages:function(e,t){_.each(e,function(e){_.isEmpty(e.code)||a.trackEvent("intermediate_page_on_load","intermediate_page_not_shown_"+t+e.code)})}}},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,i){"use strict";var n=i(585);Odigeo.defineWidget("boarding_options",Odigeo.Widget.extend(_.merge({},n,{viewClass:i(922),modelClass:i(923),showNag:function(){this.view.showNag()},proceedToPayment:function(){Odigeo.trigger("nagmanager:continue")},updateDataAndProceedToPayment:function(){this.proceedToPayment()}})))},function(e,t,i){"use strict";var n=i(41),a=i(586);e.exports=Odigeo.View.extend(_.merge({},a,{HIDE_SUCCESS_MESSAGE:3500,ANIMATION_DELAY:10,boardingOptionsNagLightbox:null,selectors:{boardingOptionsPopupContainer:".boarding_options_nag_container",nagDialog:".nag_dialog",nagBtnOption:".nag_btn_option:not(.disabled)",serviceTooltipHint:".service_tooltip_hint",termsTooltipHintNag:".terms_tooltip_hint_nag",boardingOptionsNagDescription:".boarding_options_nag_description",boardingOptionsNagContent:".boarding_options_nag_content",boardingOptionsNagConfirmation:".boarding_options_nag_confirmation",lightboxClose:".boarding_options_nag_container .lightbox_close"},events:{"tap @nagBtnOption":"onNagBtnOption","tap @lightboxClose":"closeNag"},loadView:function(){n.trackBoardingOptionAllSections(this.model.getTrackingData()),this.renderMainTemplate()},getTemplateData:function(){return _.extend(this.getCommonTemplateData(),{services:this.getServices(),dataTable:this.getDataTable()})},loadLightbox:function(){this.boardingOptionsNagLightbox=new Odigeo.UIElements.Lightbox(this.$cachedSelectors.boardingOptionsPopupContainer,{overFullPage:!1,closeOnOuterClick:!1})},getServices:function(){var e=this.model.getFormattedCarrierCode();return[{name:_.get(this.keys,e+"_service1_name"),hint:_.get(this.keys,e+"_service1_hint")},{name:_.get(this.keys,e+"_service2_name"),hint:_.get(this.keys,e+"_service2_hint")},{name:_.get(this.keys,e+"_service3_name"),hint:_.get(this.keys,e+"_service3_hint")},{name:_.get(this.keys,e+"_service4_name"),hint:_.get(this.keys,e+"_service4_hint")}]},getDataTable:function(){var e=this.getServices(),t=_.get(this.model.getData(),"availableOptions"),i=[],n=void 0;return _.each(e,function(e,a){n={service:e,data:[]},_.each(t,function(e){n.data.push(this.extendServiceData(_.get(e,["services",a])))},this),i.push(n)},this),i},extendServiceData:function(e){return _.extend({},e,{available:"less"!==e.value})},toggleLightbox:function(e,t){this.boardingOptionsNagLightbox.toggle(e),t&&n.setPopupMode(t)},onTapOpenButton:function(){var e=this.getTrackingData();this.renderPopupTemplate({showClose:!0,showPreselection:!0,continueToPayment:!1,showDescription:!1}),this.toggleLightbox(!0,"popup"),this.model.triggerUserInteraction(),n.trackBoardingOptionsOpenButton(e),n.trackingBoardingOptionsShowPopup(e)},onNagBtnOption:function(e){var t=$(e.target).closest(".nag_btn_option"),i=t.data("type");this.model.selectType(i,!0),this.renderMainTemplate(),n.trackingBoardingOptionsPopupButton(_.extend(this.getTrackingData(),{selected:i})),t.data("continue")?this.continueToPayment():this.toggleLightbox(!1)},continueToPayment:function(){this.showSuccessMessage(),_.delay(_.bind(function(){this.toggleLightbox(!1),this.widget.updateDataAndProceedToPayment()},this),this.HIDE_SUCCESS_MESSAGE)},showSuccessMessage:function(){var e=this.getNagHeight(),t=this.getNagConfirmationHeight();this.$cachedSelectors.boardingOptionsNagDescription.hide(),this.$cachedSelectors.boardingOptionsNagContent.hide(),this.$cachedSelectors.nagDialog.css("min-height",e),setTimeout(_.bind(function(){this.$cachedSelectors.nagDialog.removeClass("odf-lightbox-lg").addClass("odf-lightbox-sm").css("min-height",t),this.$cachedSelectors.boardingOptionsNagConfirmation.addClass("shown")},this),this.ANIMATION_DELAY)},getNagHeight:function(){return this.$cachedSelectors.nagDialog.outerHeight()},getNagConfirmationHeight:function(){return this.$cachedSelectors.boardingOptionsNagConfirmation.outerHeight()},loadWidgetHints:function(){Odigeo.UIElements.hint.enhance(Odigeo.History.getPageNameFromFragment(),this.$cachedSelectors.termsTooltipHint,{events:{tap:!0},googleAnalyticsOnOpen:this.getHintTrackingData()})},loadPopupHints:function(){_.each(this.$cachedSelectors.serviceTooltipHint,function(e){$(e).hover(function(){$(this).addClass("open")},function(){$(this).removeClass("open")})}),Odigeo.UIElements.hint.enhance(Odigeo.History.getPageNameFromFragment(),this.$cachedSelectors.termsTooltipHintNag,{events:{tap:!0},googleAnalyticsOnOpen:this.getPopupHintTrackingData()})},showNag:function(){this.renderPopupTemplate({showClose:!1,showPreselection:!1,continueToPayment:!0,showDescription:!0}),this.toggleLightbox(!0,"nag"),n.trackingBoardingOptionsShowPopup(this.getTrackingData())},closeNag:function(){n.trackingBoardingOptionsPopupClose(this.getTrackingData())},trackAttentionMessage:function(){this.model.isDefaultOptionSelected()&&n.trackBoardingOptionAttention(this.getTrackingData())}}))},function(e,t,i){"use strict";var n=i(587);e.exports=Odigeo.Model.extend(_.merge({},n,{loadData:function(e){this.loadModel(e),this.widget.view.trackAttentionMessage(),this.widget.view.loadLightbox()},extendOptionInfo:function(e){return this.extendOption(e)},getData:function(){return _.extend(this.toJSON(),{services:this.getServices(),highlightedType:this.getCarrierHighlightedType(),trackingData:this.getTrackingData()})},getContentKey:function(e){return _.get(this,["widget","view","keys",this.getFormattedCarrierCode()+"_"+e.toLowerCase()])}}))},,,,,,,,,,,,,function(e,t,i){"use strict";e.exports={dpresults_flights:{to:"dpresults",params:";dpTabLandingType=flight"},dpresults_accommodation:{to:"dpresults",params:";dpTabLandingType=accommodation"},dpresults:{to:"dpresults_accommodation"},dpresults_accommodation_details:{to:"roomselection"},booking:{to:"details",params:";redirect=dpresults"},passengersinfo:{to:"details"}}},function(e,t,i){"use strict";var n=i(612).notificationService(),a=i(0);Odigeo.defineWidget("browser_notification_popup",Odigeo.Widget.extend({viewClass:Odigeo.View.extend({events:{"tap @acceptNotification":"onAcceptNotification","tap @dismissNotification":"onDismissNotification","tap @closePopup":"onClosePopupClick"},selectors:{notificationsBox:".notification_popup",acceptNotification:".accept_notification",dismissNotification:".dismiss_notification",closePopup:".close_notification_popup"},init:function(){this.listenTo(this.model,"change:showed",_.bind(this.renderPopup,this))},closePopUp:function(e){a.trackEvent("browser_notification","browser_notification_accept_"+e),this.removePopup()},onAcceptNotification:function(){this.closePopUp("YES"),n.requestPermission()},onDismissNotification:function(){this.closePopUp("NO")},onClosePopupClick:function(){this.closePopUp("close")},togglePopUp:function(e){this.$cachedSelectors.notificationsBox.toggleClass("show",e)},removePopup:function(){this.togglePopUp(!1),_.delay(_.bind(function(){this.$cachedSelectors.notificationsBox.remove()},this),500)},renderPopup:function(){this.$el.html(this.templates.popup(this.keys)),this.updateDomSelectorsToCache(),this.togglePopUp(!0)}}),launchPopup:function(){_.isUndefined(this.model.get("showed"))&&(a.trackEvent("browser_notification","browser_notification_accept_load"),this.model.set("showed",!0))},endPopup:function(){this.view.removePopup()}}))},function(e,t,i){"use strict";$(function(){var e=i(22);Odigeo.defineWidget("direct_flight_search_manager",Odigeo.Widget.extend({modelClass:Odigeo.Model.extend(e.extend({defaults:{directFlightsOnly:!1},setDirectFlightsOnly:function(e){this.save({directFlightsOnly:e})},parse:function(e){return _.pick(e,"directFlightsOnly")}})),viewClass:Odigeo.View.extend({events:{"tap .ip_direct_flight_switcher":"onChange"},selectors:{input:".ip_direct_flight_switcher",label:".ip_direct_flight_switcher_label"},init:function(){var e=_.uniqueId("ip-direct-flight-switcher-");this.$cachedSelectors.input.attr("id",e),this.$cachedSelectors.label.attr("for",e),this.listenTo(this.model,"sync:fetch",this.render)},render:function(){this.$cachedSelectors.input.prop("checked",this.model.get("directFlightsOnly"))},onChange:function(){this.model.setDirectFlightsOnly(this.$cachedSelectors.input.is(":checked"))}})}))})},function(e,t,i){"use strict";var n=i(22);Odigeo.defineWidget("direct_flights_search_manager",Odigeo.Widget.extend({modelClass:Odigeo.Model.extend(n.extend({defaults:{directFlightsOnly:!1}})),viewClass:Odigeo.View.extend({events:{"change input[type=checkbox]":"onChange"},selectors:{input:".direct_flights_selector_input"},init:function(){this.listenTo(this.model,"sync:fetch",this.render),this.render()},render:function(){return this.$cachedSelectors.input.prop("checked",this.model.get("directFlightsOnly")),this},onChange:function(e){this.model.save({directFlightsOnly:e.currentTarget.checked})}})}))},function(e,t,i){"use strict";var n=i(22);Odigeo.defineWidget("flexible_dates_search_manager",Odigeo.Widget.extend({modelClass:Odigeo.Model.extend(n.extend({defaults:{flexibleDates:!1},bindCustomEvents:function(e){this.searchModel=e}})),viewClass:Odigeo.View.extend({events:{"change input[type=checkbox]":"onChange"},selectors:{input:".calendar_grid_selector_input",wrapper:".calendar_grid_selector_wrapper"},init:function(){this.listenTo(this.model,"sync:fetch",this.render),this.listenTo(this.model.searchModel,"change:type",this.render),this.render()},render:function(){var e="oneWayTrip"===this.model.searchModel.get("type");return this.$cachedSelectors.wrapper.toggleClass("odf-hidden",!e),this.$cachedSelectors.input.prop("checked",this.model.get("flexibleDates")),this},onChange:function(e){this.model.save({flexibleDates:e.currentTarget.checked})}})}))},function(e,t,i){"use strict";var n=i(22);Odigeo.defineWidget("flight_type_search_manager",Odigeo.Widget.extend({modelClass:Odigeo.Model.extend(n.extend({defaults:{type:"roundTrip"}})),viewClass:Odigeo.View.extend({events:{"change input[type=radio]":"onChange"},selectors:{input:".flight_type_selector_input",multipleDestination:".oneline_flight_type_multiple_trip"},init:function(){this.render(),this.listenTo(this.model,"sync:fetch",this.render)},render:function(){var e=this.model.get("type"),t="true"===this.widget.options.allowMultipleDestination;return this.$cachedSelectors.multipleDestination.toggleClass("odf-hidden",!t),this.$cachedSelectors.input.filter("[value="+e+"]").prop("checked",!0),this},onChange:function(e){var t=e.currentTarget.value;_.includes(["oneWayTrip","roundTrip"],t)&&Odigeo.trigger("OneLinerMultiDestination:changeLegsMD",1),this.model.save({type:t})}})}))},function(e,t,i){"use strict";$(function(){var e=i(0),t=i(60);Odigeo.defineWidget("hotelpromotion",Odigeo.Widget.extend({modelClass:Odigeo.Model.extend({bookingData:{}}),viewClass:Odigeo.View.extend(t.extend({events:{},selectors:{templateHeroBanner:".hero_banner_promotion_template",hotelPromotion:"#hotelPromotion",heroboxContainer:".herobox_container",slider:"#hp_slider"},templateSettings:{evaluate:/\{\{#([\s\S]+?)\}\}/g,interpolate:/\{\{([^#][\s\S]+?)\}\}/g,escape:/\{\{\{([\s\S]+?)\}\}\}/g},init:function(){this.widget.options=Odigeo.Utils.parseOptions(this.widget.options),this.readStorage()},cacheDomSelectors:function(){this.addSelectorToCache("hotelPromotionSearch",this.$widget.find(".hotel_promotion_search")),this.addSelectorToCache("hotelPromotionCancel",this.$widget.find(".hotel_promotion_cancel"))},bindToDom:function(){this.cacheDomSelectors(),this.$cachedSelectors.hotelPromotionSearch.off().on(Odigeo.Events.tap,_.bind(Odigeo.AB.isExpediaLinksAndWidget?this.openExpediaSearchPromotionLink:this.openSearchPromotionLink,this)),this.$cachedSelectors.hotelPromotionCancel.off().on(Odigeo.Events.tap,_.bind(this.hidePromotion,this))},fillTemplates:function(e){var t=_.template(this.$cachedSelectors.templateHeroBanner.html(),this.templateSettings),i=_.bind(function(e){var t,i=this.$cachedSelectors.slider,n=this.widget.options.customCityImageUrlPath,a=this.widget.options.defaultCityImageUrlPath,s=new Image;t=n+e+"_1920x800.jpg",s.onerror=function(){$(i).css("background-image","url("+a+")"),$(i).css("opacity","")},s.src=t,$(i).css("background-image","url("+s.src+")")},this);this.$cachedSelectors.hotelPromotion.html(t({data:this.processKeys(e)})),this.$cachedSelectors.slider.addClass("od-ui-carousel-slide carousel_slide active"),i(e.iata),Odigeo.trigger(this.widget.id+":hideCarousel",!1),this.bindToDom()},readStorage:function(){var e=Odigeo.Storage.get("infoHotelsHero");if(!_.isNull(e)){var t=Odigeo.Utils.parseJson(e);Odigeo.Utils.isFutureDate(t.departureDate)?(this.widget.model.set({bookingData:t}),this.trackEvent("load_xsell_"),this.fillTemplates(t)):Odigeo.Storage.remove("infoHotelsHero")}},processKeys:function(e){var t={hpHello:"",hpOnly:"",hpSearch:""},i=_.bind(function(e){return Odigeo.Utils.monthsShort[parseInt(Odigeo.Utils.formatDate(e,"justMonth",!0),10)-1]},this),n=_.bind(function(e){return parseInt(Odigeo.Utils.formatDate(e,"justDay",!0),10)},this);return t.hpHello=Odigeo.Utils.replaceCmsKeyArgs(this.widget.options.hpHello,e.buyer_name),t.hpOnly=Odigeo.Utils.pluralizeAll(this.widget.options.hpOnly,n(e.departureDate),i(e.departureDate),Odigeo.Utils.getRemainingDays(e.departureDate)),t.hpSearch=Odigeo.Utils.replaceCmsKeyArgs(this.widget.options.hpSearch,e.iataArrival),_.extend({translations:t},e)},openSearchPromotionLink:function(){var e=this.widget.options.url+";",t=this.widget.model.get("bookingData"),i={iata:t.iata,checkin_monthday:t.checkin_monthday,checkin_year_month:t.checkin_year_month,checkout_monthday:t.checkout_monthday,checkout_year_month:t.checkout_year_month,selected_currency:t.selected_currency,lang:this.widget.options.lang,group_adults:t.group_adults,group_children:t.group_children};_.each(i,function(t,i){e+=i+"="+t+";"}),_.isEmpty(t.age)||_.each(t.age,function(t){e+="age="+Odigeo.Utils.getAge(t)+";"}),window.open(e),this.trackEvent("select_xsell_")},openExpediaSearchPromotionLink:function(){var e=this.widget.model.get("bookingData"),t=e.checkin_year_month.concat("-").concat(e.checkin_monthday),i=e.checkout_year_month.concat("-").concat(e.checkout_monthday),n=Odigeo.Utils.formatDate(new Date,Odigeo.Utils.formatDate.masks.isoDate),a=e.group_adults+e.group_children,s=Odigeo.UIElements.translations.expediaHotels.key,r=t+"-"+i+"-"+a+"-"+e.iataAirportDeparture+"-"+n,o={numAdults:e.group_adults,numChildren:e.group_children,numInfants:0},c=Odigeo.Utils.replaceCmsKeyArgs(this.widget.options.url,e.iata,Odigeo.UIElements.translations.expediaHotels.id,t,i,App.Flights.getRoomsParams(o),e.selected_currency,a,t,i,e.iataAirportDeparture,n,_.isEmpty(s)?"":this.getExpediaToken(r,s));window.open(c),this.trackEvent("select_xsell_")},hidePromotion:function(){Odigeo.Storage.remove("infoHotelsHero"),this.trackEvent("discard_xsell_"),this.$cachedSelectors.slider.addClass("active-no-background"),Odigeo.trigger(this.widget.id+":hideHotelPromotion"),this.$cachedSelectors.heroboxContainer.addClass("hide")},trackEvent:function(t){var i=Odigeo.Utils.getRemainingDays(this.widget.model.get("bookingData").departureDate);e.trackEvent("cross_sell_widget",t+this.widget.model.get("bookingData").category+"_"+i)}}))}))})},function(e,t,i){"use strict";var n=i(22),a=i(944),s=i(945),r=Backbone.Collection.extend({model:a}),o=i(615);Odigeo.defineWidget("itinerary_md_search_manager",Odigeo.Widget.extend({modelClass:Odigeo.Model.extend(n.extend({defaults:{searchSegments:[]}})),viewClass:Odigeo.View.extend({templateSettings:Odigeo.Utils.getTmplSettings({variable:""}),selectors:{itemsWrapper:".oneline_md_items_wrapper",itemTemplate:"#multiple_destination_item",airportTemplate:"#airport_selector_template",airportAutoCompleteTemplate:"#airport_autocomplete_template",airportAutoCompleteTemplateZero:"#airport_autocomplete_zero_results",dateTemplate:"#date_selector_template",addLeg:".oneline_md_item_wrapper"},init:function(){this.options=Odigeo.parseOptions(this.widget.options),this.loadTemplates(),this.items=new r,this.listenTo(this.model,"sync:fetch",this.reload),this.model.listenSearchModelProperty("type",_.bind(this.reload,this)),Odigeo.on("OneLinerMultiDestination:add",_.bind(this.addItem,this)),Odigeo.on("OneLinerMultiDestination:remove",_.bind(this.removeItem,this)),this.childrenView=[],this.focusHandler=new o(this.childrenView),this.model.listenSearchModelProperty("type",_.bind(this.onChildFulfilled,this))},toggleAddLeg:function(){var e=_.size(this.model.getOriginalData().searchSegments)+1>this.options.maxLegs;this.$cachedSelectors.addLeg.toggleClass("odf-hidden",e)},addItem:function(){var e=this.model.getOriginalData().searchSegments||[],t=e.length;if(this.toggleAddLeg(),t<this.options.maxLegs){var i=e[t-1];e.push({departure:i.destination,searchSubmit:!1}),this.model.setSearchModelProperty("searchSegments",e),this.reload(),this.focusHandler.setFocus()}},removeItem:function(e){var t=this.model.getOriginalData().searchSegments||[];1<t.length&&(t.splice(e,1),this.model.setSearchModelProperty("searchSegments",t),this.reload(),this.copyDestinationToNextOrigin(),this.focusHandler.setFocus())},loadTemplates:function(){this.tmpl={main:_.template(this.$cachedSelectors.itemTemplate.html(),this.templateSettings),airport:_.template(this.$cachedSelectors.airportTemplate.html(),this.templateSettings),autoComplete:_.template(this.$cachedSelectors.airportAutoCompleteTemplate.html(),this.templateSettings),autoCompleteZero:_.template(this.$cachedSelectors.airportAutoCompleteTemplateZero.html(),this.templateSettings),date:_.template(this.$cachedSelectors.dateTemplate.html(),this.templateSettings)}},reload:function(){var e=this.model.getOriginalData(),t=e.type,i=e.searchSegments||[];if(i.length&&"multipleTrip"===t){if(this.items.reset(i),e.editsearch){var n=i.length,a=this.widget.options.maxLegs;Odigeo.trigger("OneLinerMultiDestination:changeLegsMD",n,n<a)}this.render()}},render:function(){return Odigeo.UIElements.calendar=null,this.$cachedSelectors.itemsWrapper.empty(),this.childrenView.length=0,this.items.forEach(this.renderItem,this),this.toggleAddLeg(),this},renderItem:function(e,t){var i=new s({model:e,index:t,templates:this.tmpl,hideDeleteButton:t<2});this.$cachedSelectors.itemsWrapper.append(i.el),this.childrenView.push(i),this.bindItem(i)},bindItem:function(e){this.listenTo(e.model,"change:dateStr",_.bind(this.clearDates,this)),this.listenTo(e.model,"change",_.bind(this.updateSearchSegments,this)),e.on("fulfilled",_.bind(this.onChildFulfilled,this))},clearDates:function(){var e=0;this.items.forEach(function(t){var i=t.get("dateStr"),n=!!i&&Odigeo.Utils.parseDate(i);n&&e<=n?e=n:t.set("dateStr",null)})},updateSearchSegments:function(){if("multipleTrip"===this.model.getOriginalData().type){this.copyDestinationToNextOrigin();var e=this.items.map(function(e){return e.toJSON()});this.model.setSearchModelProperty("searchSegments",e)}},copyDestinationToNextOrigin:function(){this.items.forEach(_.bind(function(e,t){t&&!e.get("departure")&&this.items.at(t-1).get("destination")&&e.set("departure",this.items.at(t-1).get("destination"))},this))},onChildFulfilled:function(){this.focusHandler.onChildFulfilled()}})}))},function(e,t,i){"use strict";var n=i(22);e.exports=Odigeo.Model.extend(n.extend({defaults:{dateStr:null,departure:null,destination:null},initialize:function(){this.init()},bindCustomEvents:function(e){e.on("submit",_.bind(this.onSearchSubmit,this))},onSearchSubmit:function(){this.set("searchSubmit",this.getOriginalData().searchSubmit)},isOneWay:function(){return!1}}))},function(e,t,i){"use strict";var n=i(613),a=i(614),s=i(0),r=i(615);e.exports=Odigeo.View.extend({selectors:{origin:"#origin_field_container",destination:"#destination_field_container",departureDate:"#depart_date_field_container"},trackingMap:{"#origin_field_container":"orig","#destination_field_container":"dest","#depart_date_field_container":"dep"},dateFocusControllerMap:{"#depart_date_field_container":"returnDateView"},datesFormat:"ddd. d/mm",events:{"click .oneline_md_remove_item":"removeItem"},initialize:function(e){this.options=_.extend({},e,this.optionsFromTemplate()),this.template=this.options.templates.main,this.render(),this.departureAirportView=this.createAirportSelectorView("DEPARTURE"),this.destinationAirportView=this.createAirportSelectorView("ARRIVAL"),this.departureDateView=this.createDateSelectorView(),this.setErrorMapping(),this.setSearchSegmentViewValues(),this.listenTo(this.model,"sync:fetch",this.setSearchSegmentViewValues),this.listenTo(this.model,"update",this.updateSearchSegments),this.listenTo(this.model,"change",this.setSearchSegmentViewValues),this.listenTo(this.model,"error",this.onErrorHandler),this.childrenView=[this.departureAirportView,this.destinationAirportView,this.departureDateView],this.bindChildrenEvents(),this.childrenFocusHandler=new r(this.childrenView)},bindChildrenEvents:function(){_.forEach(this.childrenView,_.bind(function(e){e.on("fulfilled",_.bind(this.onChildFulfilled,this))},this))},optionsFromTemplate:function(){var e=$("#multiple_destination_item_options");return e&&e.length?JSON.parse(e.html()):{}},removeItem:function(){Odigeo.trigger("OneLinerMultiDestination:remove",this.options.index)},setErrorMapping:function(){this.errorsMap={date:{obj:"departureDateView",showError:"triggerError"},departure:{obj:"departureAirportView",showError:"showError"},destination:{obj:"destinationAirportView",showError:"showError"}}},createAirportSelectorView:function(e){var t="DEPARTURE"===e?"origin":"destination",i={onFocus:_.bind(this.focusHandler,this)};return new n({el:this.$el.find(this.selectors[t]+this.options.index),template:this.options.templates.airport,templateAutoComplete:this.options.templates.autoComplete,templateAutoCompleteZero:this.options.templates.autoCompleteZero,departureOrArrival:e,placeholder:this.options.placeholders[t],tabIndex:{origin:0,destination:1}[t],errorMessages:this.options.errorMessages,callbacks:i,parent:this,showNearestLocations:this.options.showNearestLocations})},createDateSelectorView:function(){var e=this.options.index,t={onFocus:_.bind(this.focusHandler,this)};return new a({el:this.$el.find(this.selectors.departureDate+e),template:this.options.templates.date,format:this.datesFormat,index:e,tabIndex:e+2,calendarDaysNames:this.options.calendarDaysName,callbacks:t,parent:this,placeholder:this.options.placeholders.departureDate,closeButton:this.options.closeButton,type:"multiple",datepickerClasses:{containerClass:"od-ui-datepicker-container datepicker od-input-right"}})},onErrorHandler:function(e){e=_.filter(e,_.bind(function(e){return e.index===this.options.index},this)),this.removeErrors(),_.isEmpty(e)||_.each(e,_.bind(this.handleError,this))},removeErrors:function(){this.departureAirportView.removeError(),this.destinationAirportView.removeError(),this.departureDateView.removeError()},handleError:function(e){var t=_.isUndefined(this.errorsMap[e.key])?null:this.errorsMap[e.key];_.isNull(t)||!0!==this.model.get("searchSubmit")||this[t.obj][t.showError](e.type)},focusHandler:function(e){var t="#"+e.$el.attr("id");this.model.setSearchModelProperty("focused",t),this.model.setSearchModelProperty("editsearch",!0),s.trackEvent("searcher_flights","open_change_search_"+this.trackingMap[t])},setSearchSegmentViewValues:function(){var e=this.model.toJSON();this.departureAirportView.model.set("selectedLocation",e.departure),this.destinationAirportView.model.set("selectedLocation",e.destination),this.departureDateView.model.set("selectedDate",e.dateStr?Odigeo.Utils.parseDate(e.dateStr):null)},updateSearchSegments:function(){var e=this.departureDateView.model.get("selectedDate"),t={departure:this.departureAirportView.model.get("selectedLocation"),destination:this.destinationAirportView.model.get("selectedLocation"),dateStr:e?Odigeo.Utils.formatDate(e,Odigeo.Utils.formatDate.masks.isoDate):null};this.model.save(t)},render:function(){return this.$el.html(this.template({index:this.options.index,hideDeleteButton:this.options.hideDeleteButton})),this},onChildFulfilled:function(){this.trigger("fulfilled")},isEmptyOrHasError:function(){return this.childrenFocusHandler.isEmptyOrHasError()},setFocus:function(){this.childrenFocusHandler.setFocus()}})},function(e,t,i){"use strict";e.exports=Odigeo.Model.extend({defaults:{autocompleteResults:[],autocompleteSuggestions:[],autocompleteSuggestionsLimit:5,searchKey:"",searchWord:"",searchCompletedFor:[],selectedLocation:null},initialize:function(e,t){this.departureOrArrival=t.departureOrArrival,this.showNearestLocations=t.showNearestLocations,this.on("change:searchWord",this.setSearchKey),this.on("change:autocompleteResults change:searchWord autocomplete",this.triggerAutocomplete),this.on("change:searchKey",this.fetch)},parse:function(e){return _.includes(this.get("searchCompletedFor"),this.get("searchKey"))||this.get("searchCompletedFor").push(this.get("searchKey")),{autocompleteResults:e}},url:function(){var e=this.showNearestLocations?";nearestLocations=true":"";return Odigeo.Settings.property("geoServiceUrlFormatter")("autocomplete")+";searchWord="+encodeURIComponent(this.get("searchKey"))+";departureOrArrival="+this.departureOrArrival+";addSearchByCountry=true;addSearchByRegion=true"+e+";product=FLIGHT"},setSearchKey:function(){var e=this.get("searchWord"),t=Odigeo.Utils.replaceAccents(e.substr(0,3).toUpperCase());3<=e.length&&this.set("searchKey",t)},locationContains:function(e,t){var i=Odigeo.Utils.replaceNonAlphaNumeric(t,"",!0);return 0<=Odigeo.Utils.replaceNonAlphaNumeric(e,"",!0).indexOf(i)&&i.length},formatLocation:function(e){var t,i=_.partial(_.template,_,Odigeo.Utils.getTmplSettings({variable:null})),n={AIRPORT:i("{{ (displayName || name) }}"),CITY:i("{{ (displayName || name) }}"),IATA_CODE:i('{{ !_.isEmpty(relatedLocations) ? displayName + " - " + relatedLocations[0].name : displayName + " - " + name }}')};return 1<e.relatedLocations.length&&_.each(e.relatedLocations,function(e){t=e.geoNodeType||e.type,_.extend(e,{text:_.isFunction(n[t.toUpperCase()])?n[t.toUpperCase()](e):""})}),_.has(e,"displayName")&&!_.isEmpty(e.displayName)||_.extend(e,{displayName:e.city}),t=e.geoNodeType||e.type||"CITY",_.extend(e,{text:_.isFunction(n[t.toUpperCase()])?n[t.toUpperCase()](e):""})},filterLocations:function(e){var t=this.showNearestLocations?["type","geoNodeId","relatedLocations"]:["type","geoNodeId"];return _.filter(this.toJSON().autocompleteResults,function(i,n){return _.chain(i).omit(t).values().even().any(function(t){return!!_.isString(t)&&this.locationContains(t.toLowerCase(),e.toLowerCase())},this).value()},this)},fillDisplayName:function(e){_.isEmpty(e.relatedLocations)||_.each(e.relatedLocations,function(e){_.extend(e,{displayName:e.name})})},suggestedLocations:function(e){return _.map(this.filterLocations(e),function(t){var i,n=[t.name];return"REGION"!==t.type&&_.isArray(t.locationNames)&&(n=n.concat(t.locationNames)),i=_.find(n,function(t){return 0<=t.toLowerCase().indexOf(e)}),this.fillDisplayName(t),_.chain(t).extend({displayName:("CITY"===t.geoNodeType&&"IATA_CODE"===t.type?t.city:t.name)||i}).tap(_.bind(this.formatLocation,this)).value()},this)},triggerAutocomplete:function(){var e,t=this.get("autocompleteResults"),i=this.get("autocompleteSuggestionsLimit"),n=this.get("searchWord");n.length<3?this.trigger("clear:filtered"):(_.mixin({even:function(e){return _.isObject(e)?_.flatten(_.map(_.isArray(e)?_.flatten(e):e,_.even)):e}}),e=this.suggestedLocations(n),this.showNearestLocations&&(e=_.uniq(e,function(e){return _.pluck(e.relatedLocations,"geoNodeId").sort().toString()})),e=e.slice(0,i),this.set("autocompleteSuggestions",e),_.isArray(t)&&_.includes(this.get("searchCompletedFor"),this.get("searchKey"))&&this.trigger("autocompleted",e,n))}})},function(e,t,i){"use strict";e.exports=Odigeo.Model.extend({defaults:{selectedDate:null}})},function(e,t,i){"use strict";var n=i(22),a=i(169),s=i(613),r=i(614),o=i(365),c=i(0),d=i(6),l="SEARCH_PRICE";Odigeo.defineWidget("itinerary_search_manager",Odigeo.Widget.extend({calendarFaresManager:Odigeo.AB.faresInCalendar!==Odigeo.Utils.Partition.C&&new o,modelClass:Odigeo.Model.extend(n.extend({defaults:{searchSegments:[]},bindCustomEvents:function(e){var t={numberOfDaysFlexibility:Odigeo.JCMS.flexibleDatesDaysOfFlexibility||2,priceFreshnessDays:Odigeo.JCMS.priceFreshnessDays||5,searchStrategy:Odigeo.JCMS.searchStrategy||l};this.searchModel=e,this.flexibleDates=new a(t),this.flexibleDates.set("interfaceClient",Odigeo.Utils.InterfaceClient.DESKTOP)},isOneWay:function(){return"oneWayTrip"===this.searchModel.get("type")}})),viewClass:Odigeo.View.extend({selectors:{origin:"#origin_field_container",destination:"#destination_field_container",departureDate:"#depart_date_field_container",returnDate:"#return_date_field_container"},trackingMap:{"#origin_field_container":"orig","#destination_field_container":"dest","#depart_date_field_container":"dep","#return_date_field_container":"ret"},dateFocusControllerMap:{"#depart_date_field_container":"returnDateView","#return_date_field_container":"departureDateView"},datesFormat:"ddd. d/mm",init:function(){this.departureAirportView=this.createAirportSelectorView("DEPARTURE"),this.destinationAirportView=this.createAirportSelectorView("ARRIVAL"),this.departureDateView=this.createDateSelectorView("departureDate"),this.returnDateView=this.createDateSelectorView("returnDate"),this.setErrorMapping(),this.bindEvents(),this.childrenView=[this.departureAirportView,this.destinationAirportView,this.departureDateView,this.returnDateView]},bindEvents:function(){this.listenTo(this.model,"sync:fetch",this.setSearchSegmentsFromSessionStorage),this.listenTo(this.model,"update",this.updateSearchSegments),this.listenTo(this.model,"error",this.onErrorHandler),this.listenTo(this.model.searchModel,"change:type",this.onTypeChange),this.listenTo(this.model.flexibleDates,"change:matrixEntries",this.onFlexibleDatesUpdate),this.widget.calendarFaresManager&&(this.listenTo(this.departureAirportView.model,"change:selectedLocation",this.updateCalendar),this.listenTo(this.destinationAirportView.model,"change:selectedLocation",this.updateCalendar))},errorMapObj:function(e,t){return{obj:e,showError:t}},setErrorMapping:function(){this.errorsMap={date:[this.errorMapObj("departureDateView","triggerError"),this.errorMapObj("returnDateView","triggerError")],departure:[this.errorMapObj("departureAirportView","showError"),this.errorMapObj("departureAirportView","showError")],destination:[this.errorMapObj("destinationAirportView","showError"),this.errorMapObj("destinationAirportView","showError")]}},createAirportSelectorView:function(e){var t="DEPARTURE"===e?"origin":"destination",i={onFocus:_.bind(this.focusHandler,this)};return new s({el:this.selectors[t],departureOrArrival:e,placeholder:this.widget.options.placeholders[t],tabIndex:{origin:0,destination:1}[t],errorMessages:this.widget.options.errorMessages,callbacks:i,parent:this,showNearestLocations:this.widget.options.showNearestLocations})},getCalendarType:function(){return this.model.isOneWay()?"single":"dual"},createDateSelectorView:function(e){var t="departureDate"===e?0:1,i={onFocus:_.bind(this.focusHandler,this)};return new r({el:this.selectors[e],format:this.datesFormat,index:t,tabIndex:t+2,calendarDaysNames:this.widget.options.calendarDaysName,callbacks:i,parent:this,placeholder:this.widget.options.placeholders[e],closeButton:this.widget.options.closeButton,type:this.getCalendarType(),faresInCalendar:this.widget.calendarFaresManager,hideFaresInCalendar:Odigeo.AB.faresInCalendar===Odigeo.Utils.Partition.A,hasFaresInCalendarLegend:Odigeo.AB.faresInCalendar===Odigeo.Utils.Partition.B,hasFaresInCalendarLegendWithAmount:Odigeo.AB.faresInCalendar===Odigeo.Utils.Partition.D&&Odigeo.JCMS.isFaresCalendarAmountMarketEnabled})},toggleReturnDate:function(){var e=!this.model.isOneWay();this.returnDateView.toggle(e),e&&_.isNull(this.returnDateView.model.get("selectedDate"))&&this.returnDateView.open()},onTypeChange:function(){var e=this.model.searchModel.get("searchSegments");this.setSearchSegmentViewValues(e),this.departureDateView.updateCalendarType(),this.returnDateView.updateCalendarType(),this.toggleReturnDate(),this.widget.calendarFaresManager&&this.updateCalendar()},onErrorHandler:function(e){_.isEmpty(e)?this.removeErrors():_.each(e,_.bind(this.handleError,this))},removeErrors:function(){this.departureAirportView.removeError(),this.destinationAirportView.removeError(),this.departureDateView.removeError(),this.returnDateView.removeError()},handleError:function(e){var t=e.index||0,i=_.isUndefined(this.errorsMap[e.key])?null:this.errorsMap[e.key][t];this.model.searchModel.isSingleFlight()&&(_.isNull(i)||!0!==this.model.searchModel.get("searchSubmit")||this[i.obj][i.showError](e.type))},focusHandler:function(e){var t,i="#"+e.$el.attr("id"),n=this.trackingMap[i],a="dep"===n||"ret"===n,s=d.isMultipleDestinations(this.model.searchModel.get("type")),r=Odigeo.AB.faresInCalendar===Odigeo.Utils.Partition.B,o=Odigeo.AB.faresInCalendar===Odigeo.Utils.Partition.D&&Odigeo.JCMS.isFaresCalendarAmountMarketEnabled;this.model.searchModel.set("focused",i),this.model.searchModel.set("editsearch",!0),c.trackEvent("searcher_flights","open_change_search_"+this.trackingMap[i]),a&&!s&&(r||o)&&(t=this.widget.calendarFaresManager.openCalendarFaresTrackingLabel(n))&&c.trackEvent("searcher_flights",t,"flights_results")},setSearchSegmentViewValues:function(e){var t=e[0].departure||{},i=e[0].destination||{},n=_.get(e,"[0].dateStr"),a=_.get(e,"[1].dateStr");n=n?Odigeo.Utils.parseDate(n):null,a=a?Odigeo.Utils.parseDate(a):null,this.departureAirportView.model.set("selectedLocation",t),this.destinationAirportView.model.set("selectedLocation",i),this.departureDateView.model.set("selectedDate",n),this.returnDateView.model.set("selectedDate",a)},setSearchSegmentsFromSessionStorage:function(){var e=this.model.searchModel.get("searchSegments");_.isArray(e)&&_.isObject(e[0])&&(this.onTypeChange(),this.model.searchModel.set("editsearch",!1))},updateReturnDate:function(e){e.returnDate=this.model.dateRange?new Date(e.departureDate.getTime()+this.model.dateRange):null,this.returnDateView.model.set("selectedDate",e.returnDate),this.returnDateView.updateCalendarDates(),this.returnDateView.$datepicker.trigger("open")},fillSearchSegment:function(e){var t=[{},{}],i=e.departureDate,n=e.returnDate;return t[0].departure=t[1].destination=e.departure,t[0].destination=t[1].departure=e.destination,t[0].dateStr=i?Odigeo.Utils.formatDate(i,"isoDate",!0):null,t[1].dateStr=n?Odigeo.Utils.formatDate(n,"isoDate",!0):null,t},updateCalendar:function(){this.widget.calendarFaresManager.cleanFares()},updateSearchSegments:function(){if(this.model.searchModel.isSingleFlight()){var e={departure:this.departureAirportView.model.get("selectedLocation"),destination:this.destinationAirportView.model.get("selectedLocation"),departureDate:this.departureDateView.model.get("selectedDate"),returnDate:this.returnDateView.model.get("selectedDate")};e.returnDate&&e.returnDate<e.departureDate?this.updateReturnDate(e):(e.departureDate&&e.returnDate&&(this.model.dateRange=e.returnDate-e.departureDate),this.model.save({searchSegments:this.fillSearchSegment(e)}))}},onFlexibleDatesUpdate:function(){this.widget.calendarFaresManager.parseFares(this.model.flexibleDates.get("matrixEntries"))},isEmptyOrHasError:function(){return _.some(this.childrenView,function(e){return e.isEmptyOrHasError()})},setFocus:function(){var e=_.chain(this.childrenView).filter(function(e){return e.isEmptyOrHasError()}).head().value();e&&e.setFocus()}}),setCheapestPrice:function(e){this.calendarFaresManager&&this.calendarFaresManager.setCurrentAmount(e)},updateFlexibleDates:function(e){this.isValidDates(e)&&(this.calendarFaresManager.setCurrentSearch(e),this.model.flexibleDates.numberOfDaysFlexibility=this.getDaysOfFlexibilityParameter(),this.model.flexibleDates.priceFreshnessDays=this.getPriceFreshnessParameter(),this.model.flexibleDates.searchStrategy=this.getSearchStrategyParameter(),this.model.flexibleDates.set("tripType",e.type),this.model.flexibleDates.set("searchParameters",e),this.model.flexibleDates.refresh())},getDaysOfFlexibilityParameter:function(){return!_.isEmpty(Odigeo.JCMS.flexibleDatesDaysOfFlexibility)&&$.isNumeric(Odigeo.JCMS.flexibleDatesDaysOfFlexibility)?Number(Odigeo.JCMS.flexibleDatesDaysOfFlexibility):2},getPriceFreshnessParameter:function(){return!_.isEmpty(Odigeo.JCMS.priceFreshnessDays)&&$.isNumeric(Odigeo.JCMS.priceFreshnessDays)?Number(Odigeo.JCMS.priceFreshnessDays):5},getSearchStrategyParameter:function(){return _.isEmpty(Odigeo.JCMS.searchStrategy)?l:Odigeo.JCMS.searchStrategy},isValidDates:function(e){return!this.isFutureDate(e.searchSegments[0].dateStr)||!d.isRoundTrip(e.type)||this.isFutureDate(e.searchSegments[1].dateStr)},isFutureDate:function(e){var t=Odigeo.Utils.parseDate(e);return Odigeo.Utils.isFutureDate(t)}}))},function(e,t,i){"use strict";Odigeo.defineWidget("membership_subscription_on_top",Odigeo.Widget.extend({viewClass:Odigeo.View.extend({selectors:{wrapper:".membership_subscription_on_top"},events:{"tap .open_membership_perks":"onOpenMembershipPerks"},init:function(){var e,t=Odigeo.Utils.parseOptions(this.widget.options);t.isPriceWithoutDiscountSelected&&(e=Odigeo.Utils.replaceCmsKeyArgs(this.keys.membershipSubscriptionOnTopTitleNonPrime,Odigeo.Utils.formatCurrency(t.membershipDiscount)),this.keys=_.extend(this.keys,{membershipSubscriptionOnTopTitleNonPrime:e})),this.setTemplate(this.$el,"membershipSubscriptionOnTop",t)},onOpenMembershipPerks:function(){this.membershipPerksOpen()},membershipPerksOpen:function(){Odigeo.trigger(this.widget.id+":openMembershipPerksInfoLightbox")},updateMembershipSubscriptionOnTop:function(e){this.$cachedSelectors.wrapper.toggleClass("odf-hidden",!!e)}}),updateMembershipSubscriptionOnTop:function(e){this.view.updateMembershipSubscriptionOnTop(e)}}))},function(e,t,i){"use strict";var n=i(22);Odigeo.defineWidget("oneline_cabinclass",Odigeo.Widget.extend({init:function(){this.options=Odigeo.Utils.parseOptions(this.options)},modelClass:Odigeo.Model.extend(n.extend({bindCustomEvents:function(e){this.searchModel=e}})),viewClass:Odigeo.View.extend({selectors:{cabinClass:"#oneline-cabin-class",cabinClassValue:".classselector_value"},init:function(){Odigeo.UIElements.enhanceSwitcher(this.$cachedSelectors.cabinClass),this.listenTo(this.model,"sync:fetch",this.onDataFromStorageReady),this.$cachedSelectors.cabinClass.on(Odigeo.Events.change,_.bind(this.onChangeCabinClass,this))},onDataFromStorageReady:function(){var e=this.model.searchModel.get("searchSegments");_.isUndefined(e)||this.setCabinClassValue(this.model.searchModel.get("cabinClass"))},setCabinClassValue:function(e){var t=this.$cachedSelectors.cabinClass,i=_.isUndefined(e)?t.find("option:selected").val():e,n=_.isUndefined(e)?t.find("option:selected").text():t.find('[value="'+e+'"]').text();this.$cachedSelectors.cabinClassValue.text(n),this.model.searchModel.set("cabinClass",i)},onChangeCabinClass:function(){this.setCabinClassValue()}})}))},function(e,t,i){"use strict";var n=i(22),a=i(0),s=i(6),r=i(484),o=i(155),c=Odigeo.Widget.extend({init:function(){this.options=Odigeo.Utils.parseOptions(this.options)},modelClass:Odigeo.Model.extend(n.extend({bindCustomEvents:function(e){this.searchModel=e},mpiRoutes:o})),viewClass:Odigeo.View.extend({calendarFares:{},events:{"tap @searchButton":"onClickSearch","tap @editButton":"onClickEdit"},selectors:{searchButton:".oneline_search_button",editButton:".oneline_search_button_change"},trackingMap:{multipleTrip:"multiple_destinations",oneWayTrip:"one_way",roundTrip:"return"},typeTrackingMap:{multipleTrip:"MD",oneWayTrip:"OW",roundTrip:"RT"},init:function(){this.model.listenSearchModelProperty("editsearch",_.bind(this.onEditSearchChange,this)),Odigeo.on("CalendarFaresManager:onDateSelect",_.bind(this.onCalendarFareSelect,this))},onCalendarFareSelect:function(e){this.calendarFares=e},toggleElements:function(e){this.$cachedSelectors.editButton.toggleClass("odf-hidden",e),this.$cachedSelectors.searchButton.toggleClass("odf-hidden",!e),this.model.set("editSearchOpen",e),this.model.setSearchModelProperty("editsearch",e),Odigeo.trigger(this.widget.id+":editSearch",e)},onEditSearchChange:function(e,t){t&&this.toggleElements(!0)},triggerSearchEventTracking:function(e){a.trackEvent("searcher_flights","search_"+this.trackingMap[e.type])},trackingSearchEvents:function(e){this.triggerSearchEventTracking(e),_.isUndefined(this.model.searchModel.get("lastSearch"))||this.trackingDetailsSearch(this.model.searchModel.get("lastSearch"),e)},getJsonRequestObject:function(e){var t=_.clone(e);return"oneWayTrip"===t.type&&(t.searchSegments=[t.searchSegments[0]]),t},onClickEdit:function(){if(this.toggleElements(!0),"multipleTrip"===this.model.searchModel.get("type")){var e=this.model.searchModel.get("searchSegments").length,t=this.widget.options.maxLegs;Odigeo.trigger("OneLinerMultiDestination:changeLegsMD",e,e<t)}this.model.setSearchModelProperty("editsearch",!0),a.trackEvent("searcher_flights","open_change_search_cta")},setForceResultsSearch:function(){this.model.searchModel.get("isInDetail")&&Odigeo.Session.set("setForceResultsPage",Odigeo.Utils.getSearchId())},trackingDetailsSearch:function(e,t){var i=s.isMultipleDestinations(this.model.searchModel.get("type")),n=s.isRoundTrip(this.model.searchModel.get("type")),r={},o=Odigeo.AB.faresInCalendar===Odigeo.Utils.Partition.B,c=Odigeo.AB.faresInCalendar===Odigeo.Utils.Partition.D&&Odigeo.JCMS.isFaresCalendarAmountMarketEnabled;a.trackEvent("searcher_flights",this.trackingDetailsSearchLabel(e,t)),i||!o&&!c||(Odigeo.Storage.remove("calendarFares"),r.dep=this.getTrackingFaresSearchLabel(e,t,"dep"),n&&(r.ret=this.getTrackingFaresSearchLabel(e,t,"ret")),Odigeo.Storage.set("calendarFares",JSON.stringify(r)))},trackingDetailsSearchLabel:function(e,t){return r.changesInRequest(e,t,{cheaper:this.calendarFares.cheaper,available:this.calendarFares.available})},getTrackingFaresSearchLabel:function(e,t,i){return r.changesDatesWithFaresInRequest(e,t,i,{cheaper:this.calendarFares.cheaper,available:this.calendarFares.available,trackingFaresSearchData:this.calendarFares.trackingFaresSearchData})},trimSearchLegs:function(e){var t=this.model.getOriginalData().searchSegments;t.length=e,this.model.setSearchModelProperty("searchSegments",t)},onClickSearch:function(){var e,t=this.model.getOriginalData().type;if(this.model.setSearchModelProperty("searchSubmit",!0),this.model.setSearchModelProperty("isInspirationalSearch",!1),this.model.searchModel.trigger("submit"),!_.isEmpty(this.model.getErrors())&&this.model.searchModel.isSingleFlight()&&this.trimSearchLegs("oneWayTrip"===t?1:2),_.isEmpty(this.model.getErrors())){this.trackingSearchEvents(this.model.getOriginalData()),this.setForceResultsSearch(),this.activateSearch(),e=this.getJsonRequestObject(this.model.getOriginalData()),"details"===Odigeo.History.getPageNameFromFragment()&&(e.comesFromPassenger=!0);var i=this.model.searchModel.get("searchSegments"),n=_.first(i),a=_.isUndefined(n)?"":n.departure.iata,s=_.isUndefined(n)?"":n.destination.iata;Odigeo.AB.isMPIRouteDesktop&&this.isMPIRoute(a,s)&&this.setMPISessionValues(a,s),e.externalSelectionRequest={},Odigeo.trigger(this.widget.id+":search",e)}},isMPIRoute:function(e,t){return this.existsDepartureAndDestination(e,t)&&this.existsSegmentInMPIList(e,t)},setMPISessionValues:function(e,t){Odigeo.Storage.set("mpiRouteStartSearch",Date.now()),Odigeo.Storage.set("departureIATA",e),Odigeo.Storage.set("destinationIATA",t)},existsDepartureAndDestination:function(e,t){return!_.isEmpty(e)&&!_.isEmpty(t)},existsSegmentInMPIList:function(e,t){var i=e+"-"+t;return _.contains(this.model.mpiRoutes,i)},activateSearch:function(){Odigeo.trigger(this.widget.id+":activatedSearchClick"),this.widget.options.activateSearch?Odigeo.trigger(this.widget.id+":toggleChangeSearch",!0):this.toggleElements(!1)}}),changeVisibility:function(){this.view.onClickEdit()}});Odigeo.defineWidget("onelinebutton_search_manager",c),e.exports=c},function(e,t,i){"use strict";var n=i(22);Odigeo.defineWidget("onelinesearchmanager",Odigeo.Widget.extend({init:function(){this.options=Odigeo.Utils.parseOptions(this.options),this.view.toggleFold(this.options.activateSearch),this.model.set("isInDetail","details"===this.options.page),this.model.get("isInDetail")&&this.view.showInDetailsPage()},displaySearchBar:function(e){this.view.displaySearchBar(e)},modelClass:Odigeo.Model.extend(n.extend({bindCustomEvents:function(e){this.searchModel=e}})),viewClass:Odigeo.View.extend({events:{"click @mdAddItem":"onClickAddmdItem","click @hideChangeSearch":"onClickHideSearch"},selectors:{flightTypeRow:".flight_type_row",directFlightRow:".direct_flight_row",searchButtonCol:".search_button_col",onelineManager:".oneline_manager",singleFlight:".itinerary_single",multipleDestinationFlight:".itinerary_multiple_destination",mdAddItem:".oneline_md_add_item",paxSelectorAsInput:".pax_input_format",paxSelectorAsList:".pax_list_format",iconButton:".oneline_search_button_change_icon",hideChangeSearch:".hide_change_search"},init:function(){this.model.listenSearchModelProperty("editsearch",_.bind(this.onEditSearch,this)),this.listenTo(this.model,"sync:fetch",this.onDataFromStorageReady),this.listenTo(this.model.searchModel,"change:type",this.onTypeChange),this.onTypeChange()},onClickAddmdItem:function(e){e.stopPropagation(),e.preventDefault(),Odigeo.trigger("OneLinerMultiDestination:add")},onTypeChange:function(){var e=this.widget.options.allowMultipleDestination&&!this.model.searchModel.isSingleFlight();this.$cachedSelectors.singleFlight.toggleClass("odf-hidden",e),this.$cachedSelectors.multipleDestinationFlight.toggleClass("odf-hidden",!e),this.$cachedSelectors.iconButton.toggleClass("odf-hidden",!e),this.$cachedSelectors.paxSelectorAsInput.toggleClass("odf-hidden",e),this.$cachedSelectors.paxSelectorAsList.toggleClass("odf-hidden",!e)},onEditSearch:function(e){_.isUndefined(e.changed.editsearch)||this.toggleFold(e.changed.editsearch)},displaySearchBar:function(e){this.model.setSearchModelProperty("editsearch",!0),this.toggleSearchBar(e)},toggleSearchBar:function(e){this.$cachedSelectors.onelineManager.toggleClass("opened",e)},onClickHideSearch:function(){this.toggleSearchBar(!1),Odigeo.trigger(this.widget.id+":hideSearchBar",!1)},setLastSearch:function(e){var t={searchSegments:e.get("searchSegments"),numAdults:e.get("numAdults"),numChildren:e.get("numChildren"),numInfants:e.get("numInfants"),type:e.get("type"),directFlightsOnly:e.get("directFlightsOnly")};this.model.setSearchModelProperty("lastSearch",t)},onDataFromStorageReady:function(){var e=this.model.searchModel.get("searchSegments");_.isUndefined(e)||(this.model.setSearchModelProperty("editsearch",this.widget.options.activateButton),this.setLastSearch(this.model.searchModel),this.model.get("isInDetail")&&(this.model.setSearchModelProperty("isInDetail",!0),this.hideSearchOnPax())),this.onTypeChange()},toggleFold:function(e){this.widget.options.activateSearch&&!e||(this.$cachedSelectors.flightTypeRow.toggleClass("active",e),this.$cachedSelectors.directFlightRow.toggleClass("active",e),this.$cachedSelectors.searchButtonCol.toggleClass("od-oneline-edit-col",!e),this.$cachedSelectors.searchButtonCol.toggleClass("od-oneline-button-col",e),this.$cachedSelectors.onelineManager.toggleClass("expanded",e))},hideSearchOnPax:function(){!this.model.searchModel.isSingleFlight()&&this.model.get("isInDetail")&&(this.$el.addClass("odf-hidden"),Odigeo.trigger(this.widget.id+":showOnelineSearch",!1))},initMetaSearchBar:function(){this.$cachedSelectors.flightTypeRow.toggleClass("active",this.widget.options.hideOnLoad),this.$cachedSelectors.directFlightRow.toggleClass("active",this.widget.options.hideOnLoad),this.$cachedSelectors.onelineManager.toggleClass("od-show-onelinesearch",!this.widget.options.hideOnLoad)},showInDetailsPage:function(){Odigeo.Session.storage.setItem("changeSearchMetaShown",!0),this.initMetaSearchBar(),Odigeo.trigger(this.widget.id+":showOnelineSearch",!0)}})}))},function(e,t,i){"use strict";$(function(){var e,t,n=i(22),a=i(0);Odigeo.defineWidget("passengers_search_manager",Odigeo.Widget.extend({modelClass:Odigeo.Model.extend(n.extend({defaults:{numAdults:1,numChildren:0,numInfants:0,kid0Age:"",kid1Age:"",kid2Age:"",kid3Age:"",kid4Age:"",kid5Age:"",infant0Age:"",infant1Age:"",infant2Age:"",infant3Age:""},init:function(){return this.options=Odigeo.parseOptions(this.widget.options),n.getMixin().init.apply(this,arguments)},getNumAdults:function(){return parseInt(this.get("numAdults")||this.defaults.numAdults,10)},getNumChildren:function(){return parseInt(this.get("numChildren")||this.defaults.numChildren,10)},getNumInfants:function(){return parseInt(this.get("numInfants")||this.defaults.numInfants,10)},getPassengers:function(){return{adults:parseInt(this.get("numAdults")||this.defaults.numAdults,10),children:parseInt(this.get("numChildren")||this.defaults.numChildren,10),infants:parseInt(this.get("numInfants")||this.defaults.numInfants,10)}},setPaxByType:function(t,i){if(_.includes(_.values(e.PAX_TYPES),t)){var n="num"+Odigeo.Utils.capitalize(t);this.save(n.toString(),i)}else this.trigger("error:paxType",t)},parse:function(e){var t={numAdults:e.numAdults,numChildren:e.numChildren,numInfants:e.numInfants},i=Odigeo.AB.isOfferChildrenAgeDesktop?this.getAgeParamsFromSearch(e):{};return _.extend(t,i)},getAgeParamsFromSearch:function(e){var t=this.getAgeParams(e,e.numInfants,"infant"),i=this.getAgeParams(e,e.numChildren,"kid");return _.extend(i,t)},getAgeParams:function(e,t,i){return _.reduce(_.range(t),function(t,n){return t[i+n+"Age"]=e[i+n+"Age"],t},{})},getLimits:function(){var e=this.widget.options.limits,t=this.getPassengers(),i=t.adults,n=t.children,a=t.infants,s=e.total-n-a,r=Math.min(e.total-i-a,i*e.childrenPerAdult-a),o=Math.min(e.total-i-n,i*e.childrenPerAdult-n,i*e.infantsPerAdult);return{adults:{min:Math.max(Math.round((n+a)/e.childrenPerAdult),a,1),max:s},children:{max:r},infants:{max:o}}}})),viewClass:Odigeo.View.extend({templateSettings:{evaluate:/\{\{#([\s\S]+?)\}\}/g,interpolate:/\{\{[^#{]([\s\S]+?)[^}]\}\}/g,escape:/\{\{\{([\s\S]+?)\}\}\}/g},events:{"tap .passengers_search_input":"onTapInInput","tap .passengers_search_append":"onTapInInput","tap .passengers_search_close_btn":"onTapInCloseBtn","tap .adult_quick_access":"onTapQuickPax"},selectors:{viewTemplate:".passengers_search_template",inputTemplate:".passengers_search_input_template",limitsTemplate:".passengers_search_limits_template",input:".passengers_search_input",passengersWrapper:".view_container"},slctrs:{spinners:{adults:".adults_item",children:".children_item",infants:".infants_item"},switchers:{kids0Age:".kids0Age",kids1Age:".kids1Age",kids2Age:".kids2Age",kids3Age:".kids3Age",kids4Age:".kids4Age",kids5Age:".kids5Age",infants0Age:".infants0Age",infants1Age:".infants1Age",infants2Age:".infants2Age",infants3Age:".infants3Age"},container:".passengers_search_container",msgContainer:".passengers_search_error_container"},init:function(){this.widget.options=Odigeo.parseOptions(this.widget.options),this.listenTo(this.model,"change",this.render),this.listenTo(Odigeo.Events.fake,"fake:blur",this.onBlur),this.model.listenSearchModelProperty("focused",_.bind(this.onChangeFocusSearch,this)),this.model.listenSearchModelProperty("type",_.bind(this.updateValues,this))},onChangeFocusSearch:function(t,i){i!==this.selectors.input&&this.toggle(e.HIDE)},initializeSpinners:function(){return _.each(this.slctrs.spinners,function(e,t){var i=this.$(e);this.addSelectorToCache(t,i),Odigeo.UIElements.enhanceSpinner(i),i.on("change",_.bind(this.onChangeSpinner,this,t))},this),this},initializeSwitchers:function(){return _.each(this.slctrs.switchers,function(e,t){var i=this.$(e);this.addSelectorToCache(t,i),Odigeo.UIElements.enhanceSwitcher(i),i.on("change",_.bind(this.onChangeSwitcher,this,t))},this),this},configSpinners:function(e){_.each(this.slctrs.spinners,function(t,i){var n=e[i].min,a=e[i].max,s=this.$(t);s.trigger("config",{maxRange:a,max:a}),_.isUndefined(n)||s.trigger("config",{minRange:n,min:n})},this)},updateLimits:function(){return this.configSpinners(this.model.getLimits()),this.checkMsg(e.MSG.LIMITS),this},renderTemplate:function(e,t,i){var n=_.template(e.html(),this.templateSettings),a=_.extend({},i||this.model.toJSON());return t.html(n(a)),this},isOpen:function(){return this.$(this.slctrs.container).hasClass("open")},render:function(){var e={},t={};Odigeo.AB.isOfferChildrenAgeDesktop&&(e=this.getAges(this.model.attributes,"numChildren","kid"),t=this.getAges(this.model.attributes,"numInfants","infant")),this.renderTemplate(this.$cachedSelectors.viewTemplate,this.$cachedSelectors.passengersWrapper,{passengers:this.getRenderData(),childAges:e,infantAges:t}),this.initializeSpinners(),Odigeo.AB.isOfferChildrenAgeDesktop&&this.initializeSwitchers(),this.updateLimits()},toggle:function(e){var t=this.$(this.slctrs.container);return e=_.isUndefined(e)?!t.hasClass("open"):e,t.toggleClass("open focus",e),this},checkMsg:function(i){if(!_.includes(e.MSG,i))return!1;var n=this.$(this.slctrs.msgContainer),a=_.find(_.keys(t[i]),function(e){return t[i][e].call(this.model)},this),s=!_.isUndefined(a),r=_.template(this.$cachedSelectors.limitsTemplate.html(),this.templateSettings);return n.toggle(s),n.html(r({msg:this.widget.options.translate.limits[a]})),s},onTapInCloseBtn:function(){var t=!Odigeo.AB.isOfferChildrenAgeDesktop||this.allAgesFilled(".kid_age_container",this.model.getNumChildren())&this.allAgesFilled(".infant_age_container",this.model.getNumInfants());return this.$el.find(".passengerssearch_validation_message").toggleClass("odf-hidden",t),t&&this.toggle(e.HIDE),this},allAgesFilled:function(e,t){var i=this.$el.find(e).not(".odf-hidden");return _.eq(_.reduce(i,function(e,t){var i=""===$(t).find(".age_selector_visible_value").text();return i||e.push($(t)),$(t).toggleClass("od-validation-error",i),e},[]).length,t)},onChangeSpinner:function(e,t){return this.model.setPaxByType(e,parseInt($(t.target).val(),10)),this.$cachedSelectors.input.html(this.getText()),this},onChangeSwitcher:function(e,t){var i=$(t.currentTarget),n=i.closest(".age_selector_container"),a=i.find(":selected").text(),s=": "+a,r=this.getModelAttribute(e);this.model.set(r,a),n.find(".age_selector_visible_value").text(s),this.modifyKidsAndChildrenAgeSelectorVisibility(this.model.getNumChildren(),this.model.getNumInfants())},getModelAttribute:function(e){return e.replace("s","")},modifyKidsAndChildrenAgeSelectorVisibility:function(e,t){this.showAgeContainers(".kid_age_container",e,"kid"),this.showAgeContainers(".infant_age_container",t,"infant")},onTapInInput:function(){return this.toggle(),this.model.setSearchModelProperty("focused",this.selectors.input),this.model.setSearchModelProperty("editsearch",!0),a.trackEvent("searcher_flights","open_change_search_pax"),this},showAgeContainers:function(e,t,i){_.each(this.$el.find(e),function(e){$(e).toggleClass("odf-hidden",t<$(e).attr("data-"+i+"-age"))})},onTapQuickPax:function(e){var t=$(e.target).data("quick-adults");return this.model.save("numAdults",parseInt(t,10)),this.model.setSearchModelProperty("editsearch",!0),a.trackEvent("searcher_flights","passenger_shortcut_"+t),this},onBlur:function(t){return 0===$(t.target).closest(this.$el).length&&this.toggle(e.HIDE),this},getRenderData:function(){var e=this.model.getPassengers();return _.extend({},{numAdults:e.adults,numChildren:e.children,numInfants:e.infants,inputText:this.getText(),limits:this.model.getLimits(),openedClass:this.isOpen()?"open focus":"",quickPaxSelectedClass:{one:1===e.adults?"active":"",two:2===e.adults?"active":"",three:3===e.adults?"active":""}},this.model.attributes)},getAges:function(e,t,i){return _.reduce(_.range(e[t]),function(t,n){return t[n]=""!==e[i+n+"Age"]?": "+e[i+n+"Age"]:"",t},{})},getText:function(){var e=this.widget.options.translate,t=this.model.getPassengers();return _.template(this.$cachedSelectors.inputTemplate.html(),this.templateSettings)({input:{adults:{num:t.adults,text:Odigeo.Utils.pluralizeAll(e.adults,t.adults)},children:{num:t.children,text:Odigeo.Utils.pluralizeAll(e.children,t.children)},infants:{num:t.infants,text:Odigeo.Utils.pluralizeAll(e.infants,t.infants)}}})},updateValues:function(){var e=_.pick(this.model.getOriginalData(),["numAdults","numChildren","numInfants"]),t=_.mapKeys(this.model.getPassengers(),function(e,t){return"num"+_.capitalize(t)});_.isEmpty(e)||_.isEqual(e,t)||(this.model.save("numAdults",parseInt(e.numAdults,10)),this.model.save("numChildren",parseInt(e.numChildren,10)),this.model.save("numInfants",parseInt(e.numInfants,10)),this.render())}})})),e={HIDE:!1,SHOW:!0,PAX_TYPES:{ADULTS:"adults",CHILDREN:"children",INFANTS:"infants"},MSG:{LIMITS:"limits"}},t={limits:{total:function(){var e=this.getPassengers();return e.adults+e.children+e.infants===this.widget.options.limits.total},childrenPerAdult:function(){var e=this.getPassengers();return(e.children+e.infants)/e.adults===this.widget.options.limits.childrenPerAdult}}}})},function(e,t,i){"use strict";var n=i(36),a=i(94),s=i(52);Odigeo.defineWidget("pricemanager_enhanced",Odigeo.Widget.extend(s.extend(a.extend(n.extend({modelClass:i(955),viewClass:i(956),init:function(){this.suscribeBaggagesCollectionEvents()},onBaggageLoaded:function(){this.onBaggageChange()},onBaggageChange:function(){_.each(this.getBaggagePriceBreakDownItems(),function(e){var t=this.getPriceBreakdownItemByConceptKey(e.idRow);_.isUndefined(t)||t.set("departureIata",e.departureIata).set("arrivalIata",e.arrivalIata).set("baggageApplicationLevel",e.baggageApplicationLevel)},this),this.view.renderView(this.getPriceCollectionData())},showCcSelected:function(){this.view.showCcNameSelected.apply(this.view,arguments)},updateFlag:function(){this.view.updateFlag.apply(this.view,arguments)},showPaymentMethodDisclaimer:function(){this.view.showPaymentMethodDisclaimer.apply(this.view,arguments)},showPayWithGuarantee:function(){this.view.showPayWithGuarantee()},hidePayWithGuarantee:function(){this.view.hidePayWithGuarantee()},checkIfOfferPricesTextSizeShouldBeResized:function(){this.view.checkIfOfferPricesTextSizeShouldBeResized()},getPdfUrl:function(e){this.view.getPdfUrl(e)},getPolicy:function(e){this.view.getPolicy(e)},setRepricing:function(){var e=[].slice.call(arguments,0),t=_.extend({},e[0]);t.formattedPrices={oldPrice:Odigeo.Utils.splitFormatedCurrency(t.oldPrice)},this.model.set("repricing",t)},refreshOfferPricesTextSize:function(){this.view.refreshOfferPricesTextSize()}})))))},function(e,t,i){"use strict";var n=i(52),a=i(333),s=i(43),r=i(14).getInstance();e.exports=Odigeo.Model.extend(n.extend({defaults:{savingAlertsTracking:!1},dataURL:null,agreeConditionsUrl:"iagreeconditions",init:function(){this.refreshData(),this.bindPriceCollection(),this.on("priceCollection.repaintPrices",this.reloadPriceViews)},getDataRequestSettings:function(){return{type:"GET",cache:!1,success:_.bind(this.requestSuccessHandler,this)}},url:function(){return Odigeo.Settings.getProperty("widgetPartUrlFormatter")(this.widget.name,this.agreeConditionsUrl)},requestSuccessHandler:function(e){this.trigger("renderAgreeConditions",e)},refreshData:function(){this.isEmptyData=!1,this.refresh()},reloadPriceViews:function(){this.trigger("updatePrices",this.getFinalPrice(),this.getPricePerPassenger()),this.trigger("render",this.getPriceCollectionData())},getPriceBreakdownItemByType:function(e){return this.getItemByType(e)},updateCcFee:function(e){var t=e.fee,i=void 0===t?0:t,n=this.getPriceBreakdownItemByType(s.CC_FEE);return n.set("allPrice",i),n.set("onePrice",i/this.widget.options.numtravellers),Odigeo.trigger(this.widget.id+":updateSummaryPrices"),this.getPriceCollectionData()},getPriceSummaryData:function(e){var t=this.getPriceCollectionData(),i=e,n=this.getPassengersPrices(t),a=this.getTaxesAndChargesPrice(n.flightTaxesAndCharges,t.totalFeeProvider),r=this.getNegativeTaxesAndChargesPrice(n.flightTaxesAndCharges,t.totalFeeProvider),o=n.ticketsPrice+a,c=t.ccFeeItem.allPrice,d=this.getEdreamsDiscount(i.isIncludedInPrice,r,c),l=this.getAdditionalServices(t.items,this.widget.options);return{additionalServices:l,discountedPrice:this.getDiscountedPrice(d,o,i.isIncludedInPrice?i.displayFee:0),edreamsDiscount:d,edreamsPrimeMemberDiscount:{edreamsPrimeMemberDiscountVisibilityClass:i.displayFee<0?"":"odf-hidden",edreamsPrimeMemberDiscountStateClass:i.isIncludedInPrice?"odf-text-positive":"odf-text-warning",edreamsPrimeMemberDiscountSlashedClass:i.slashedClass,value:this.formatPriceIfHasValue(i.displayFee)},hasAdditionalServices:!_.every(l,_.isEmpty),paymentMethod:this.getPaymentMethod(this.getPriceBreakdownItemByType(s.CC_FEE)),repricing:this.getRepricing(this.getPriceBreakdownItemByType(s.REPRICING)),standardPrice:this.formatPriceIfHasValue(o),taxesAndCharges:{total:Odigeo.Utils.formatCurrency(a),taxesAndChargesDetailsClass:n.flightTaxesAndCharges<=0||t.totalFeeProvider<=0?"odf-hidden":"",flightTaxesAndCharges:this.formatPriceIfHasValue(n.flightTaxesAndCharges),servicesCharges:this.formatPriceIfHasValue(t.totalFeeProvider)},ticketsPrice:this.formatPriceIfHasValue(n.ticketsPrice),total:this.formatPriceIfHasValue(t.totalPrice),options:this.widget.options,priceCollection:t,areAllPassengersWithBaggage:this.widget.getAreAllPassengersWithBaggage(),baggagesDiscount:this.widget.getBaggagesDiscount()}},getPaymentMethod:function(e){var t=e.get("concept"),i=e.get("method"),n=e.get("allPrice"),s=!_.isUndefined(e.get("creditCardResolved"))&&e.get("creditCardResolved"),r={name:"",value:0,creditCardResolved:!1};return t&&(r.name="CREDITCARD"!==i||_.isUndefined(a[t])?t:a[t].name,r.creditCardResolved="CREDITCARD"!==i||s,r.value=n),r},getRepricing:function(e){return this.getPriceSummaryItemData(e?e.get("allPrice"):0)},getTaxesAndChargesPrice:function(e,t){return(e=0<e?e:0)+(0<t?t:0)},getNegativeTaxesAndChargesPrice:function(e,t){return(e=e<0?e:0)+(t<0?t:0)},getDiscountedPrice:function(e,t,i){var n=t+i+e.value;return{displayClass:i+e.value===0?"odf-hidden":"",value:this.formatPriceIfHasValue(n)}},getEdreamsDiscount:function(e,t,i){var n,a=i<0?i:0;return{displayClass:0!=(n=e?t<0?t:0:t<0?t+a:a)?"":"odf-hidden",formattedValue:this.formatPriceIfHasValue(n),value:n}},getAdditionalServices:function(e,t){var i=0,n=0,a=0,o=0,c=0,d=[],l=[],g=[];return _.each(e,_.bind(function(e){switch(e.type){case s.BAGGAGES:case s.BAGGAGES_WEIGHT:i+=e.allPrice;break;case s.MEMBERSHIP_SUBSCRIPTION:n+=e.allPrice;break;case s.PROMO_CODE:a+=e.allPrice;break;case s.SEAT:case s.SEATMAP:o+=e.allPrice;break;case s.ASSISTANCE_INSURANCE:case s.CANX_INSURANCE:case s.INSURANCE:case s.INSURANCE_IN_CART:case s.REBOOKING_INSURANCE:d.push(e);break;case s.ADDITION:l.push(e);break;case s.SERVICE_OPTIONS:t.serviceOptionsEnabled&&g.push(e);break;case"HAND_BAGGAGE":c+=e.allPrice}},this)),{additionalCheckedBaggage:this.formatPriceIfHasValue(this.widget.getBaggagesDiscountPrice(i)),beforeDiscountAdditionalCheckedBaggages:this.formatPriceIfHasValue(i),membershipSubscription:this.formatPriceIfHasValue(n),promoCode:this.formatPriceIfHasValue(a),seats:this.formatPriceIfHasValue(o),insurances:d,additionalAncillariesProducts:l,serviceOptions:g,hasBaggageIncluded:this.widget.hasAllRowsIncludedBaggages(),hasFreeCancellation:!r.isCanxFree()&&t.showFreeCancellationMessage,handBaggage:this.formatPriceIfHasValue(c)}},getPriceSummaryItemData:function(e){return{displayClass:e<=0?"odf-hidden":"",value:this.formatPriceIfHasValue(e)}},formatPriceIfHasValue:function(e){return 0!==e?Odigeo.Utils.formatCurrency(e):0},getPassengersPrices:function(e){var t=0,i=0;return _.each(e.items,function(e){e.isPassengerItem&&(t+=e.providerFare*e.quantity,i+=e.tax*e.quantity)}),{ticketsPrice:t,flightTaxesAndCharges:i}},getPriceWithoutGuaranteeFormatted:function(){var e=this.getPayWithGuaranteeItemInCollection().get("allPrice")||0,t=this.getPriceCollectionData().totalPrice;return Odigeo.Utils.formatCurrency(t-e)}}))},function(e,t,i){"use strict";var n=i(0),a=i(191),s=!1,r=i(14).getInstance();e.exports=Odigeo.View.extend({preSelectedServicePrice:0,seatSelection:null,seatMapSelection:null,currency:null,isPriceWithoutDiscountSelected:!1,preselectedServiceOption:null,lastTalPricesContainerWidth:0,template:null,pricebreakdownTemplate:null,priceSummaryTemplate:null,templateSettings:{evaluate:/\{\{#([\s\S]+?)\}\}/g,interpolate:/\{\{[^#{]([\s\S]+?)[^}]\}\}/g,escape:/\{\{\{([\s\S]+?)\}\}\}/g},selectors:{refundableTaxesBlock:".refundable_taxes_section",refundableTaxesPrice:".refundable_price",payWithGuaranteeContainer:".pay_with_guarantee_container",pwgConditionsLinkMoved:".pwg_conditions_link_moved",pwgConditionsLink:".pwg_conditions_link",tableColumn:".pricebreakdown_table_column",priceColumn:".pricebreakdown_price_column",paymentButton:".payment_continue_button",priceWithoutGuarantee:".pay_without_guarantee_price",totalPriceTemplate:".totalprice_template",payWithGuaranteeTotalPrice:".pay_with_guarantee_total_price",paymentButtonsBox:".payment_buttons_box",pricebreakdownContainer:".pricebreakdown_container",totalPricesContainer:".price_total",savingAlertWrapper:".saving_alert_wrapper",savingAlertsTemplate:".saving_alert_template",priceSummaryTaxInfo:".price_summary_tax_info",priceSummaryPopup:".price_summary_popup",priceSummaryLink:".price_summary_link",priceSummaryHint:".price_summary_hint",pwgConditionsLinkMovedClicked:".pwg_conditions_pdf_link_moved",freeCanxTitle:".od-payment-manager-free-canx-title",freeCanxTooltip:".od-payment-manager-free-canx-tooltip"},events:{"tap .pricebreakdown_content":"clickHandler","tap .pricebreakdown_toggle":"onPriceBreakdownToggleClicked","tap .od_pr-details":"onToggleExpandable","tap @paymentButton":"onContinueButtonClicked","tap .agree_conditions_folded":"onAgreeConditionsFoldedClicked","tap .tracking_policy a":"onTrackingPolicyClicked","tap .conditions_section_title":"onShowConditionsSectionTitle","mouseover  @paymentButton":"onContinueButtonMouseover","mouseover .price_summary_tax_info":"onTaxInfoMouseover","mouseleave .price_summary_tax_info":"onTaxInfoMouseLeave","tap @pwgConditionsLinkMovedClicked":"onPwgConditionsLinkMovedClicked"},init:function(){this.widget.options=Odigeo.parseOptions(this.widget.options),this.templates=Odigeo.Utils.getTemplates(this.$el,{priceWithoutGuaranteRepricing:"#price_without_guarantee_repricing"},this.templateSettings),this.bindEvents(),this.setVariables(),this.initPriceBreakdownTemplate(),this.hideSelectedCcIfIsPriceWithoutDiscount(),this.updateAtolProtected(),this.setSeatsLeft(),this.setSavingAlert()},bindEvents:function(){this.bindGeneralEvents(),this.bindPriceEvents(),this.listenTo(this.model,"renderAgreeConditions",this.renderAgreeConditions)},renderAgreeConditions:function(e){this.$el.find(".payment_agree").html(e),this.hasPopupPaymentCondition()&&this.enhancePaymentConditionsHint(),Odigeo.Utils.parseJson(Odigeo.Session.storage.getItem("isAccommodationPostBooking"))&&this.checkIfFlightHasInsurance()&&this.$el.find(".pba_flight_insurances_disclaimer").removeClass("odf-hidden"),Odigeo.Utils.parseJson(Odigeo.Session.get("isAccommodationPostBooking"))&&this.$cachedSelectors.priceSummaryHint.addClass("odf-hidden"),this.bindAgreeConditionsEvents()},checkIfFlightHasInsurance:function(){return 0<Odigeo.Utils.parseJson(Odigeo.Session.storage.bookingInfo).insuranceBookings.bookings.length},checkIfOfferPricesTextSizeShouldBeResized:function(){var e=this.$cachedSelectors.totalPricesContainer.width();this.lastTalPricesContainerWidth!==e&&(this.lastTalPricesContainerWidth=e,this.refreshOfferPricesTextSize())},refreshOfferPricesTextSize:function(){this.$el.find(".resizable_text").each(_.bind(function(e,t){var i=$(t),n=+i.data("defSize");_.isNumber(n)&&!_.isNaN(n)||(n=parseInt(i.css("font-size")),i.data("defSize",n));var a=i.closest(".resizable_text_container");i.css("font-size",n+"px");for(var s=n;this.checkOfferPriceTextVsContainerWidth(i)>a.width()&&14<s;)s-=2,i.css("font-size",s+"px")},this))},checkOfferPriceTextVsContainerWidth:function(e){var t,i=$(e),n=i.css("position");return i.css("position","absolute"),t=i.width(),i.css("position",n),t},bindAgreeConditionsEvents:function(){this.hasPopupPaymentCondition()&&this.$el.find(".conditions_section_title").on(Odigeo.Events.tap,_.bind(function(e){e.preventDefault(),e.stopPropagation(),this.hasPopupPaymentCondition()&&(this.$el.find('div[class^="conditions_section_content_"]').addClass("hidden",!0),this.$el.find(".conditions_section_content_"+$(e.currentTarget).data("layer")).removeClass("hidden"))},this)),this.widget.options.isCollapsive&&this.setUpCollapsiblePanel()},bindPriceEvents:function(){this.listenTo(this.model,"updatePrices",this.repaintPrices),this.listenTo(this.model,"render",this.renderView)},bindGeneralEvents:function(){var e=this.$el.find(".pricemanager_info"),t=this.$el.find(".price_summary_hint");0<e.length&&Odigeo.UIElements.enhanceExpandable(e,{selfClose:!1}),0<t.length&&Odigeo.UIElements.hint.enhance(Odigeo.History.getPageNameFromFragment(),t,{events:{tap:!0},googleAnalyticsOnOpen:{type:"trackEvent",data:{page:Odigeo.History.getPageNameFromFragment(),action:"trip_information",label:"open_price_breakdown"}}})},setUpCollapsiblePanel:function(){var e=this.$el.find(".pricemanager_expandable"),t=this.widget.options.isFolded;this.$el.find(".pricebreakdown_toggle_container").toggleClass("hidden",!t),Odigeo.UIElements.collapsive.enhance(e,{triggerLauncher:"priceManagerExpandable"}),e.trigger(t?"collapsePanel":"expandPanel"),this.moveAgreeCheckbox(t),this.$cachedSelectors.pricebreakdownContainer.toggleClass("expanded",!t),e.on("expanded onCollapse",_.bind(function(){Odigeo.trigger(this.widget.id+":priceBreakdownToggled")},this))},moveAgreeCheckbox:function(e){var t=this.$el.find(".agree_checkbox_folded").find(".agree_selectable"),i=this.$el.find(".agree_checkbox").find(".agree_selectable"),n=this.$el.find(".agree_cond_one_button .agree_checkbox_folded"),a=this.$el.find(".agree_cond_one_button .agree_checkbox"),s=this.$el.find(".agree_cond_two_buttons .agree_checkbox_folded");e?i.appendTo(n):(t.appendTo(a),t.appendTo(s)),i.appendTo(s)},enhancePaymentConditionsHint:function(){Odigeo.UIElements.hint.enhance("payment",this.$el.find(".popUp_payment_conditions_hint"),{events:{tap:!0},googleAnalyticsOnOpen:{type:"trackEvent",data:{page:Odigeo.History.getPageNameFromFragment(),action:"payment_details",label:"link_general_terms_and_conditions_open"}}})},hasPopupPaymentCondition:function(){return this.widget.options.hasPopupPaymentCondition&&!_.isEmpty(this.$el.find(".popUp_payment_conditions_hint"))},onTaxInfoMouseover:function(){this.togglePriceSummaryPopups(!0,".price_summary_tax_info_popup")},onTaxInfoMouseLeave:function(){this.togglePriceSummaryPopups(!1,".price_summary_tax_info_popup")},togglePriceSummaryPopups:function(e,t){this.$el.find(t).toggleClass("open opened",e)},onAgreeConditionsFoldedClicked:function(e){e.stopPropagation(),this.hasPopupPaymentCondition()&&this.$el.find(".payment_agree").find(".popUp_payment_conditions_hint").trigger("toggle")},onTrackingPolicyClicked:function(e){e.stopPropagation(),n.trackEvent("payment_details","link_data_protection_policy_open")},initPriceBreakdownTemplate:function(){this.templateType=this.getTemplateName(),this.priceSummaryTemplate=_.template(this.$el.find(".priceSummaryTemplate").html(),this.templateSettings),this.pricebreakdownTemplate=_.template(this.$el.find("."+this.templateType).html(),this.templateSettings)},getTemplateName:function(){var e=this.isTaxFee()?"taxfee":"";return this.isNetTaxSeparatelyTemplateConfig()?"netTaxSeparately":this.isBestPriceConfigurationConfig()?e+"bestPrice":this.isFullPriceFullTableConfig()?e+"fullpriceFullTable":e+"fullPrice"},isTaxFee:function(){return this.widget.options.pricebreakdownShowingTaxAndFee&&!this.widget.options.isDynpack&&!this.widget.options.isUpsell},isNetTaxSeparatelyTemplateConfig:function(){return this.widget.options.showNetTaxSeparately&&!this.widget.options.pricebreakdownShowingTaxAndFee},isBestPriceConfigurationConfig:function(){return this.widget.options.isBestPriceConfigurationEnabled},isFullPriceFullTableConfig:function(){return this.widget.options.isFullPriceConfigurationEnabled&&this.widget.options.fullTablePriceBreakDownOnFullPriceAtPayment},repaintPrices:function(e,t){this.$el.find(".od-js-total-price").html(this.formatSeparatedDecimals(e)),this.$el.find(".od-js-total-pp-price").html(Odigeo.Utils.formatCurrency(t))},formatSeparatedDecimals:function(e){var t=this.separateDecimals(e);if(1<t.length)return $("<span>").append(t.integer).add($("<span>",{class:"decimal"}).append(t.decimalSeparator+t.decimal))},separateDecimals:function(e){var t=_.has(this.currency,"decimalSeparator")?this.currency.decimalSeparator:Odigeo.Utils.Currency.decimalSeparator;return{decimalSeparator:t,integer:e.split(t)[0],decimal:e.split(t)[1]}},renderView:function(e){this.renderTotalPriceSection(e),this.renderPriceBreakdownTemplate(_.extend(e,{insurance_fare_upgrades:this.getInsuranceFareUpgradesFormatted(e)},this)),this.showRefundableTaxes(e),e.isRefundableFareUpgradeShownInPax&&this.hidePayWithGuarantee()},getInsuranceFareUpgradesFormatted:function(e){var t=this.getInsuranceFareUpgrades(e);return _.map(t,function(e){return _.extend(e,{onePriceFormatted:Odigeo.Utils.formatCurrency(e.onePrice),allPriceFormatted:Odigeo.Utils.formatCurrency(e.allPrice)})})},getInsuranceFareUpgrades:function(e){var t=this.getPreselectedInsurances();return _.filter(e.items,function(e){return _.contains(t,e.id)})},getPreselectedInsurances:function(){var e=r.isLoaded()?r.getInsurances():{},t=_.filter(e,function(e){return e.preselected});return _.map(t,function(e){return e.policy})},showRefundableTaxes:function(e){this.$cachedSelectors.refundableTaxesBlock.toggleClass("odf-hidden",0===e.refundableTaxes),0<e.refundableTaxes&&this.$cachedSelectors.refundableTaxesPrice.html(e.refundableTaxesFormatted)},renderTotalPriceSection:function(e){var t=this.updateCcFee(e),i=_.template(this.$el.find(".totalPriceSection").html(),this.templateSettings)({options:this.widget.options,priceCollection:t,templateType:this.templateType,ccSelected:this.ccSelected});this.$cachedSelectors.totalPriceTemplate.html(i),this.$cachedSelectors.priceWithoutGuarantee.html(this.model.getPriceWithoutGuaranteeFormatted()),this.renderRepricing(),Odigeo.trigger(this.widget.id+":totalPriceUpdated"),this.toggleTotalPriceContainer(),this.updateFreeCanxTextsVisibility()},updateFreeCanxTextsVisibility:function(){var e=this;r.getLoadedPromise().then(function(t){t&&r.isCanxFree()&&(e.$cachedSelectors.freeCanxTitle.removeClass("odf-hidden"),e.$cachedSelectors.freeCanxTooltip.removeClass("odf-hidden"))})},renderPriceWithOldPrice:function(e){return this.templates.priceWithoutGuaranteRepricing({priceWithOffer:e,repricing:this.model.get("repricing")})},renderRepricing:function(){if(_.isObject(this.model.get("repricing"))){var e=this.$cachedSelectors.totalPriceTemplate.find(".pricebreakdown_total_price");this.$cachedSelectors.priceWithoutGuarantee.html(this.renderPriceWithOldPrice(this.model.getPriceWithoutGuaranteeFormatted())),e.html(this.renderPriceWithOldPrice(e.html()))}},renderPriceBreakdownTemplate:function(e){var t=this.widget.options,i=this.isMembershipPriceDisplay(e,t),n=this.updateWithPerksInfo(e,t,i);if(Odigeo.AB.isPriceSummaryDesktop){var a=this.priceSummaryTemplate(this.model.getPriceSummaryData(n.membershipPerks));this.$el.find(".price_summary_template").html(a)}else this.renderOldPricebreakdown(e,t,i)},renderOldPricebreakdown:function(e,t,i){var n=this.pricebreakdownTemplate({options:t,priceCollection:this.updateWithPerksInfo(e,t,i),segmentsTotalQuantity:t.numtravellers*t.numsegments,isTaxFee:this.isTaxFee(),pricebreakdownShowingTaxAndFee:t.pricebreakdownShowingTaxAndFee,pricebreakdownShowingRealProviderFare:t.pricebreakdownShowingRealProviderFare,preSelectedServiceOption:this.getPreselectedServiceOption(),texts:{ccFee:this.getCcFeeTexts(i,t)}});this.$el.find(".pricebreakdown_template").html(n)},isMembershipIncluded:function(e){return e.membershipPerks.isIncludedInPrice},isMembershipPriceDisplay:function(e,t){return this.isMembershipIncluded(e)||t.isMembershipDualPrice},updateWithPerksInfo:function(e,t,i){var n=_.bind(this.updateCcFee,this),a=_.partial(this.addPerksDefaultValues,_,i),s=_.partial(this.addMembershipPerksValues,_,t,i);return _.flowRight(s,a,n)(e)},addPerksDefaultValues:function(e,t){var i=e.membershipPerks;return i.membershipClass="",i.slashedClass="",i.isMembershipPriceDisplay=t,i.displayFee=0,i.disclaimerText="",e},addMembershipPerksValues:function(e,t,i){var n=e.membershipPerks;return i&&(n.membershipClass="od-pricebreakdown-membership-discount-fee",n.displayFee=t.showFeesQuantityAlwaysOne?n.fee:n.fee/t.numtravellers,n.isIncludedInPrice||(n.membershipClass="od-pricebreakdown-membership-discount-fee-warning od-membership-align-top",n.slashedClass="odf-text-line-through",n.disclaimerText=n.isMemberLoggedIn?t.membershipDisclaimerDiscountNotBtwnTrav:t.membershipDisclaimerDiscountNotApplied)),e},updateCcFee:function(e){var t=e.membershipPerks;return Odigeo.trigger(this.widget.id+":updatePremiumSidebarView",_.extend(t,{membershipPrice:_.result(_.find(e.items,"type","MEMBERSHIP_SUBSCRIPTION"),"onePrice")})),this.isMembershipIncluded(e)?this.widget.model.updateCcFee(t):e},getCcFeeTexts:function(e,t){var i=t.membershipDiscountText,n=t.membershipCcTextNeg,a=t.membershipCcTextPos;return e?{pos:i,neg:i}:{pos:a,neg:n}},getPreselectedServiceOption:function(){return _.isNull(this.preselectedServiceOption)&&(this.preselectedServiceOption=this.$el.find(".pricebreakdown_content").data("preSelectedServiceOption")),this.preselectedServiceOption},setVariables:function(){var e=this.$el.find(".od_pr-breakdown"),t=this.widget.model.getPriceBreakdownItemByType("INSURANCES").get("conceptKey");this.currency=e.data("currency"),this.isPriceWithoutDiscountSelected=this.$el.find(".pricebreakdown_content").data("isPriceWithoutDiscountSelected"),this.isAtolProtected=Odigeo.Utils.parseJson(Odigeo.Storage.get("isAtolProtected")),_.isEmpty(t)&&(t=-1),Odigeo.trigger(this.widget.id+":checkSelectedInsuranceIfNotChecked",{insuranceId:t})},hideSelectedCcIfIsPriceWithoutDiscount:function(){this.isPriceWithoutDiscountSelected&&this.$el.toggleClass("hidden-cctype",!0)},updateAtolProtected:function(){this.isAtolProtected&&this.$el.find(".price_breakdown_atol_protected_text").removeClass("odf-hidden")},onToggleExpandable:function(){(_.isUndefined(this.widget.options.enhanceExpandable)||this.widget.options.enhanceExpandable)&&(this.$el.find(".pricemanager_info").trigger("toggleExpandable"),this.showDetailsHandler())},onPriceBreakdownToggleClicked:function(){if(this.widget.options.isCollapsive){var e=this.$cachedSelectors.pricebreakdownContainer,t=e.hasClass("expanded");this.moveAgreeCheckbox(t),this.$el.find(".pricemanager_expandable").trigger("togglePanel"),e.toggleClass("expanded"),t||n.trackEvent("trip_information","open_price_breakdown",Odigeo.History.getPageNameFromFragment())}},onContinueButtonClicked:function(){Odigeo.trigger(this.widget.id+":onContinueButtonClicked",{})},onContinueButtonMouseover:function(){Odigeo.trigger(this.widget.id+":trackContinueButtonMouseover")},clickHandler:function(){Odigeo.trigger("complete",{type:"success",data:this.data,id:this.id})},showDetailsHandler:function(){var e=this.$el.find(".od_pr-details");e.find(".pricemanager_toggle_title_show").toggleClass("hidden"),e.find(".pricemanager_toggle_title_hide").toggleClass("hidden");var t=e.find(".pricemanager_toggle_title_show").hasClass("hidden");n.trackEvent("trip_information",(t?"open":"close")+"_price_breakdown",Odigeo.History.getPageNameFromFragment()),Odigeo.trigger(this.widget.id+":heightChanged")},setSeatsLeft:function(){var e=this.$el.find(".seats-left-summary");if(0<e.length){var t=_.template(e.html(),this.templateSettings),i=this.$el.find(".seats_left_template_content"),a=i.data("seatsLeft");i.html(t(this.getSeatLeftTemplate(a))),this.isTrackingSeatsLeftSent||0<a&&(n.trackEvent("seats_left","seats_left_"+a),this.isTrackingSeatsLeftSent=!0)}},setSavingAlert:function(){var e=new a({selectedPrice:this.widget.options.selectedPrice,averagePrice:this.widget.options.averagePrice,minBoundary:this.widget.options.savingAlertsMinBoundary,template:_.template(this.$cachedSelectors.savingAlertsTemplate.html(),Odigeo.Utils.getTmplSettings({variable:""})),translations:this.widget.options.translations,tests:_.get(this.widget.options,"tests")});e.render(),this.$cachedSelectors.savingAlertWrapper.html(e.$el)},getSeatLeftTemplate:function(e){var t=this.widget.options.tests.isSeatLeftsCopyUpdatesMobileEnabled&&9<=e;return{numSeatsLeft:e,numSeatsLeftText:this.widget.options.seatsTranslations["seatsLeftMsg"+(t?"More":"")]}},toggleInsuranceAsterisk:function(e){this.$el.find(".pricebreakdown_message_insurance").toggleClass("hidden",e)},showCcNameSelected:function(e){this.ccSelected=e.ccName;var t=!_.isEmpty(e.ccName)&&e.resolved||!_.isEmpty(e.ccName)&&!e.resolved&&!this.isPriceWithoutDiscountSelected;Odigeo.trigger(this.widget.id+":toggleCcType",t),this.$el.find(".show_cc_type").toggleClass("odf-hidden",!t),this.$el.find(".show_cc_name").html(e.ccName)},updateFlag:function(e){this[e.flag]=e.value},showPaymentMethodDisclaimer:function(e){var t=!_.isEmpty(e.ccName)&&e.resolved||!_.isEmpty(e.ccName)&&!e.resolved&&!this.isPriceWithoutDiscountSelected;this.$el.toggleClass("hidden-cctype",!t),Odigeo.trigger(this.widget.id+":toggleCcType",t)},showPayWithGuarantee:function(){this.togglePayWithGuarantee(!0)},hidePayWithGuarantee:function(){this.togglePayWithGuarantee(!1)},getPolicy:function(e){this.$cachedSelectors.pwgConditionsLinkMovedClicked.attr("data-policy",e)},onPwgConditionsLinkMovedClicked:function(){var e="link_data_"+this.$el.find(this.$cachedSelectors.pwgConditionsLinkMovedClicked).attr("data-policy")+"_policy_open";n.trackEvent("payment_details",e)},getPdfUrl:function(e){this.$cachedSelectors.pwgConditionsLinkMovedClicked.attr("href",e)},togglePayWithGuarantee:function(e){s=e;var t=this.$cachedSelectors.pricebreakdownContainer.hasClass("expanded");this.$cachedSelectors.pricebreakdownContainer.toggleClass("od-pricebreakdown-one-price",!e).toggleClass("agree_cond_one_button",!e).toggleClass("agree_cond_two_buttons",e),this.$cachedSelectors.payWithGuaranteeContainer.toggleClass("odf-hidden",!e),this.$cachedSelectors.pwgConditionsLinkMoved.toggleClass("odf-hidden",!e),this.$cachedSelectors.pwgConditionsLink.toggleClass("odf-hidden",e),this.$cachedSelectors.tableColumn.toggleClass("odf-col-span6",e).toggleClass("odf-col-span8",!e),this.$cachedSelectors.priceColumn.toggleClass("odf-col-span6",e).toggleClass("odf-col-span4",!e),this.$cachedSelectors.paymentButton.toggleClass("odf-btn-lg odf-btn-secondary od-pay-guarantee-button-height",e).toggleClass("odf-btn-primary",!e),this.$cachedSelectors.priceWithoutGuarantee.toggleClass("odf-hidden",!e),this.toggleTotalPriceContainer(),this.$cachedSelectors.payWithGuaranteeTotalPrice.toggleClass("odf-hidden",!e),this.$cachedSelectors.paymentButtonsBox.toggleClass("od-payment-buttons-box",e).toggleClass("od-payment-continue-box",!e),this.moveAgreeCheckbox(!t)},toggleTotalPriceContainer:function(){this.$cachedSelectors.totalPriceTemplate.find(".total_price_container").toggleClass("odf-hidden",s)}})},function(e,t,i){"use strict";var n=i(36),a=Odigeo.Widget.extend(n.extend({viewClass:i(958),init:function(){this.options=Odigeo.Utils.parseOptions(this.options),this.suscribeBaggagesCollectionEvents()},onCollectionBuilt:function(){this.view.onUpdateBaggages(),Odigeo.AB.isBaggageFeeHint&&this.view.enhanceBaggageFeeTooltip()},onBaggageChange:function(e){e.currentOption.get("selected")&&this.view.onUpdateBaggages()}}));Odigeo.defineWidget("baggage_summary",a)},function(e,t,i){"use strict";var n,a;e.exports=(n=i(37).getInstance(),a=i(58).getInstance(),Odigeo.View.extend({templateSettings:Odigeo.Utils.getTmplSettings({variable:""}),sidebarSegmentOrder:["FIRST","SECOND","THIRD","FOURTH","FIFTH","SIXTH"],selectors:{baggageWrapper:".baggage_summary_wrapper",baggageInfo:".baggage_info",baggageFeeHintContainer:".baggage_fee_hint_container",baggageFeeHintText:".baggage_fee_hint_text"},MAX_BAGGAGE_WEIGHT:32,onUpdateBaggages:function(){this.updateBaggageSection(),Odigeo.AB.isBaggageFeeHint&&this.renderBaggageDisclaimer()},updateBaggageSection:function(){var e=this.getAllPiecesBySegmentAndWeight(),t=n.isAnItineraryTrip()&&1===_.size(e),i=t?"ROUND_TRIP":n.getRequestType();t&&(e={FIRST:_.clone(e.FIRST),SECOND:_.extend(e.FIRST,{segmentId:"SECOND"})}),this.printBaggageSection(e,i)},renderBaggageDisclaimer:function(){var e=this.getNumberBaggagePieces(),t=this.widget.getSelectedBaggageAverageFee();this.$cachedSelectors.baggageFeeHintText.html(Odigeo.Utils.replaceCmsKeyArgs(this.keys.baggageFeeDisclaimer,t)),this.$cachedSelectors.baggageFeeHintContainer.toggleClass("odf-hidden",0===e||0===t)},enhanceBaggageFeeTooltip:function(){this.$cachedSelectors.baggageFeeHintContainer.length&&Odigeo.UIElements.hint.enhance(Odigeo.History.getPageNameFromFragment(),this.$cachedSelectors.baggageFeeHintContainer,{events:{tap:!0}})},printBaggageSection:function(e,t){var i=Odigeo.Utils.formatCurrency(a.selectedTotalPrice),n=Odigeo.Utils.formatCurrency(a.selectedTotalPricePlusDiscount);this.$cachedSelectors.baggageInfo.html(this.templates.segment({piecesBySegment:e,showAsteriskLegend:this.showAsteriskLegend(e),selectedBaggageTotalPrice:i,selectedBaggageTotalPricePlusDiscount:n,showSelectedBaggageTotalPrice:this.shouldShowSelectedBaggageTotalPrice(),segmentNames:this.segmentNames[t],keys:this.keys,getPromotionMerchandisingBadge:1<Odigeo.AB.promotionMerchandisingBadgePartition&&a.shouldDisplayPromotionBadge(),discount:a.getDiscount(),areAllPassengersWithBaggage:a.areAllPassengersWithBaggage()}))},shouldShowSelectedBaggageTotalPrice:function(){return!this.widget.options.isMetaSearch&&0<a.selectedTotalPrice},showAsteriskLegend:function(e){return _.some(e,function(e){return e.showAsteriskLegend})},getNumberBaggagePieces:function(){return Odigeo.AB.isItineraryBagPriceSplitDesktop?this.widget.calculateTotalQuantity():this.widget.getBaggageSelectedPieces()},getAllPiecesBySegmentAndWeight:function(){var e={};return this.setEmptySegmentData(e),_.each(a.getAllPiecesBySegment(),function(t,i){e[i]=this.getSegmentData(t,i)},this),e},getSegmentData:function(e,t){var i=this.MAX_BAGGAGE_WEIGHT,n=_.reduce(e,function(e,t){var n=t.get("isIncludedBaggage"),a=t.get("piecesToShow"),s=parseFloat(t.get("kilosPerPiece")),r=e.isWeightBased||t.get("isWeightBased"),o=e.piecesPerWeight,c=parseFloat(n?t.get("pieces"):a);return o[s]=(o[s]||0)+c,_.extend(e,{weight:e.weight+s,pieces:e.pieces+c,piecesToShow:e.piecesToShow+a,piecesPerWeight:o,isWeightBased:r,isIncludedBaggage:e.isIncludedBaggage||n,showAsteriskLegend:r&&i<s,hasPieces:e.hasPieces||0<c}),e},this.getEmptySegmentData(t));return n.piecesPerWeight=this.groupPieces(n),n},groupPieces:function(e){var t=[];return _.each(e.piecesPerWeight,function(i,n){0<i&&t.push(this.addOptionType({pieces:i,weight:parseFloat(n),hasPieces:e.hasPieces,isWeightBased:e.isWeightBased,showAsteriskLegend:e.showAsteriskLegend}))},this),_.isEmpty(t)?this.getEmptySegmentBaggage():this.sortPieces(t)},addOptionType:function(e){return e.hasPieces&&(0===e.weight?e.label=this.getNoWeightLabel(e):e.label=e.isWeightBased?this.getWeightBasedLabel(e):this.getWithWeightLabel(e)),e},getWithWeightLabel:function(e){return[e.pieces,Odigeo.Utils.pluralizeAll(this.keys.piecesWithKilos,e.pieces,e.weight)].join(" ")},getWeightBasedLabel:function(e){return[Odigeo.Utils.pluralizeAll(this.keys.totalWeight,e.weight,e.pieces),e.showAsteriskLegend?"*":""].join(" ")},getNoWeightLabel:function(e){return[e.pieces,Odigeo.Utils.pluralizeAll(this.keys.piecesWithoutKilos,e.pieces,e.weight)].join(" ")},getEmptySegmentBaggage:function(){return[{pieces:0,weight:0}]},sortPieces:function(e){return e.sort(function(e,t){return e.weight-t.weight}),e},getEmptySegmentData:function(e){return{weight:0,pieces:0,piecesToShow:0,piecesPerWeight:{},isIncludedBaggage:!1,isWeightBased:!1,segmentId:e}},setEmptySegmentData:function(e){_.each(n.getRowIds(),function(t){e[t]={weight:0,pieces:0,piecesToShow:0,isIncludedBaggage:!1,isWeightBased:!1}})},init:function(){this.initSegmentNames()},initSegmentNames:function(){this.segmentNames={ONE_WAY:{FIRST:this.keys.flightOutbound},ROUND_TRIP:{ITINERARY:this.keys.flightItinerary,FIRST:this.keys.flightOutbound,SECOND:this.keys.flightInbound},MULTIPLE_DESTINATIONS:{FIRST:this.keys.flightFirst,SECOND:this.keys.flightSecond,THIRD:this.keys.flightThird,FOURTH:this.keys.flightFourth,FIFTH:this.keys.flightFifth,SIXTH:this.keys.flightSixth}}}}))},function(e,t,i){"use strict";Odigeo.defineWidget("hand_baggage_summary",Odigeo.Widget.extend({modelClass:i(960),viewClass:i(961),storeBoardingOptions:function(e){this.model.storeBoardingOptions(e)}}))},function(e,t,i){"use strict";e.exports=Odigeo.Model.extend({getFlightDetails:function(){return this.get("flightDetailsDTO")},getTripType:function(){return this.get("tripType")},getOptions:function(){return Odigeo.parseOptions(this.widget.options)},getNumTravellers:function(){return _.get(this.getOptions(),"numTravellers")},getProduct:function(){return _.get(this.getOptions(),"product")},storeBoardingOptions:function(e){this.set(e),this.load()},getTranslations:function(){return _.get(this,["widget","view","keys"])},getTranslation:function(e){return _.get(this.getTranslations(),[this.getCarrierKey(),e].join("_"))},getSelectedType:function(){return this.get("selectedType")},isDefaultType:function(){return"BO_SB"===this.getSelectedType()},getSelectedTypeTranslation:function(){return this.getTranslation(this.getSelectedType().toLowerCase())},getData:function(){var e=this.hasStops();return _.extend(this.toJSON(),{hasStops:e,baggageInfo:this.getBaggageInfo(e)})},load:function(){_.isEmpty(this.getFlightDetails())||this.widget.view.show()},getSegments:function(){return _.get(this.getFlightDetails(),"segments",[])},getSections:function(){return _.get(this.getFlightDetails(),"allSections",[])},hasStops:function(){return!_.isUndefined(_.find(this.getSegments(),function(e){return 0<e.stops}))},getBaggageInfo:function(e){return e?this.getSectionBaggageInfo():this.getSegmentBaggageInfo()},getSectionBaggageInfo:function(){var e=this.getCarrierList(),t=this.getSelectedTypeTranslation(),i=this.getNumTravellersTimes();return _.flatten(_.map(this.getSegments(),function(n){return _.map(n.sections,function(a){return{key:this.getFlightIdentifier(a),text:_.includes(e,_.get(a,"carrier.code",""))?i+t:this.getSegmentContentKey(n)}},this)},this))},getNumTravellersTimes:function(){return this.isDefaultType()?"":this.getNumTravellers()+" x "},getFlightIdentifier:function(e){return[_.get(e,"departureLocation.iata",""),_.get(e,"arrivalLocation.iata","")].join(" - ")},getSegmentBaggageInfo:function(){var e=this.getCarrierList(),t=this.getSelectedTypeTranslation(),i=this.getNumTravellersTimes();return _.map(this.getSegments(),function(n){return _.includes(e,_.get(n,"carrier.code",""))?i+t:this.getSegmentContentKey(n)},this)},getSegmentContentKey:function(e){var t=_.get(e,"baggage.includedType","");return this.getContentKey(t)||this.getContentKey("BO_SB")},getContentKey:function(e){return _.get(this,["widget","view","keys",e.toLowerCase()])},getCarrierKey:function(){return this.getCarrier().toLowerCase().replace(".","_")},getCarrier:function(){return this.get("carrier")||""},getCarrierList:function(){return this.get("carrierList")||[]}})},function(e,t,i){"use strict";var n=i(41);e.exports=Odigeo.View.extend({init:function(){this.initSegmentNames()},selectors:{handBaggageSummaryWrapper:".hand_baggage_summary_wrapper",baggageInfo:".baggage_info",baggageFeeHintContainer:".baggage_fee_hint_container",baggageFeeHintText:".baggage_fee_hint_text"},show:function(){this.$cachedSelectors.handBaggageSummaryWrapper.removeClass("odf-hidden"),this.renderBaggage(this.model.getData()),this.initTooltip()},renderBaggage:function(e){this.$cachedSelectors.baggageInfo.html(this.getTemplate(e))},getTemplate:function(e){return(e.hasStops?this.templates.section:this.templates.segment)(_.extend(e,{segmentNames:this.getKeysPerTripType(this.model.getTripType()),product:this.model.getProduct()}))},initSegmentNames:function(){this.segmentNames={ONE_WAY:[this.keys.flightOutbound],ROUND_TRIP:[this.keys.flightOutbound,this.keys.flightInbound],MULTIPLE_DESTINATIONS:[this.keys.flightFirst,this.keys.flightSecond,this.keys.flightThird,this.keys.flightFourth,this.keys.flightFifth,this.keys.flightSixth]}},getKeysPerTripType:function(e){return this.segmentNames[e]||[]},initTooltip:function(){this.$cachedSelectors.baggageFeeHintContainer.addClass("odf-hidden"),0<this.model.get("fee")&&this.initTooltipData()},initTooltipData:function(){var e=Odigeo.Utils.replaceCmsKeyArgs(this.model.getTranslation("hint"),this.getFormattedFeePrice()),t=this.model.get("trackingData");_.isEmpty(e)||(this.$cachedSelectors.baggageFeeHintContainer.removeClass("odf-hidden"),this.$cachedSelectors.baggageFeeHintText.html(e),Odigeo.UIElements.hint.enhance(Odigeo.History.getPageNameFromFragment(),this.$cachedSelectors.baggageFeeHintContainer,{events:{tap:!0},googleAnalyticsOnOpen:this.getTrackingData(t)}))},getFormattedFeePrice:function(){return Odigeo.Utils.formatCurrency(this.model.get("fee"))},getTrackingData:function(e){return{type:"trackEvent",data:{action:"sidebar",label:["ryanair_sidebar_info-",n.getTypeTrackingConstant(this.model.getSelectedType()),"_legs:",e.totalNumber,"-",this.model.getCarrier(),":",e.carrierNumber].join("")}}}})},function(e,t,i){"use strict";$(function(){var e=i(36),t=Odigeo.Widget.extend(e.extend({modelClass:i(963),viewClass:i(964),init:function(){this.options=Odigeo.Utils.parseOptions(this.options),this.suscribeBaggagesCollectionEvents(),this.view.renderFlexAlert()},updatePage:function(e){this.model.updateDataSource(e),this.view.onUpdateTravellersName(),this.view.initializeStickyPrice(),this.view.showPriceWithoutDiscountSelectedDisclaimer()},onBaggageLoaded:function(){this.view.onUpdateBaggages()},onBaggageChange:function(e){e.currentOption.get("selected")&&this.view.onUpdateBaggages()},onSeatmapChange:function(e){this.model.setSeatMapFromCollection(e)},updateTravellersName:function(e){var t=$.extend([],this.model.get("paxNameList"));t[e.index]=e.name,this.model.set("isSinglePremiumPassengerSelected",!_.isUndefined(e.id)&&0===e.id),this.model.set("paxNameList",t),this.view.initializeStickyPrice()},updatePrices:function(e){this.model.set("price",e)},updateConcept:function(e,t){this.model.set(e,t)},updateIsPrimeBlocked:function(e){this.model.set("isPrimeBlocked",e)},setCcSelected:function(e){this.view.setCcSelected(e)},toggleCcType:function(e){this.view.toggleCcType(e)},setIsUpdatedMembershipPrices:function(e){this.model.set("isUpdatedMembershipPrices",e)},updatePriceMemberDisplay:function(e,t){this.view.updatePriceMemberDisplay(e,t)},isPriceWithoutDiscountSelected:function(){var e=this.view.$cachedSelectors.cheapestPaymentmethodDisclaimer;return!_.isEmpty(e)&&e.data("isPriceWithoutDiscountSelected")},updatePriceMemberDisplayPrices:function(e,t){this.view.updatePriceMemberDisplayPrices(e,t)},refreshPrice:function(){this.model.refreshPrice()},updatePremiumDisclaimers:function(e){this.view.displayPremiumDisclaimers(e)},updatePremiumSidebarView:function(e){var t=e.isIncludedInPrice;e.isMembershipPriceDisplay&&(this.view.displayPremiumDisclaimers(t),this.view.displayPremiumView(t&&1===_.size(this.model.get("paxNameList"))),this.updateBubblePremium({isMemberTestActive:e.isMembershipPriceDisplay,isMemberLogged:e.isMemberLoggedIn,memberInTravellers:e.isIncludedInPrice,membershipPrice:e.membershipPrice,isPrimeBlocked:this.model.get("isPrimeBlocked"),isCheapestPriceSelected:e.isCheapestPriceSelected,isSubscriptionAdded:e.isSubscriptionAdded}))},updatePricesWithMembershipSubscription:function(e){this.view.updatePricesWithMembershipSubscription(e)},stickPriceSection:function(e){this.view.stickPriceSection(e)},updateBubblePremium:function(e){this.view.renderPremiumBubble(e)},confirmHotelRemoved:function(){this.view.confirmHotelRemoved()},disableRemoveHotel:function(){this.view.disableRemoveHotel()},enableRemoveHotel:function(){this.view.enableRemoveHotel()},updatePromocode:function(e){this.view.updatePromocode(e)},togglePriceLoading:function(e){this.view.togglePriceLoading(e)}}));Odigeo.defineWidget("sidebar_summary",t)})},function(e,t,i){"use strict";var n;e.exports=(n=i(52),Odigeo.Model.extend(n.extend({defaults:{page:"",price:-1,seatmap:{},paxNameList:[],isPrimeBlocked:!1,isUpdatedMembershipPrices:!1},initialize:function(){this.bindPriceCollection(),this.on("priceCollection.repaintPrices",this.refreshPrice)},isPrimeEnabled:function(){return Odigeo.Membership.isMembershipProductEnabled&&!Odigeo.SessionScope.isMeta},isSlowLoadingPrimePriceFix:function(){var e=!this.widget.isPriceWithoutDiscountSelected(),t=this.get("isUpdatedMembershipPrices"),i=this.widget.view.isPayment();return this.isPrimeEnabled()&&e&&!t&&!i},isRefreshPriceAllowed:function(e){return!e||e&&0<this.getUnformattedTicketPrice()},refreshPrice:function(){var e=this.isSlowLoadingPrimePriceFix(),t=e?this.getTicketPrice():this.getFinalPrice(),i=e?this.getTicketPricePerPassenger():this.getPricePerPassenger();this.isRefreshPriceAllowed(e)&&this.trigger("updatePrices",t,i,this.getSHPrice())},updateDataSource:function(e){return{details:function(){this.set({page:e})},payment:function(){var t=Odigeo.Utils.parseJson(Odigeo.Session.storage.getItem("booking_pax_list"))||{},i=_.pluck(t,"name"),n=this.getSeatmapFromSession();i=_.map(t,function(e){return{fullName:e.name+" "+e.firstLastName}}),this.set({page:e,seatmap:n,paxNameList:i})}}[e].apply(this,arguments)},setSeatMapFromCollection:function(e){var t={allprice:e.getSelectedSeatsPrice(),quantity:e.getSelectedSeatsLength()};this.set({seatmap:t})},getSeatmapFromSession:function(){var e=Odigeo.Utils.parseJson(Odigeo.Session.storage.getItem("seatPreferenceSelection"))||[];return{allprice:_.reduce(e,function(e,t){return e+(_.has(t,"totalPrice")?t.totalPrice:0)},0),quantity:e.length}}})))},function(e,t,i){"use strict";var n,a,s,r,o,c=i(326);e.exports=(n=i(0),a=i(52),s=i(360),r=i(37).getInstance(),o=i(14).getInstance(),Odigeo.View.extend(a.extend({templateSettings:Odigeo.Utils.getTmplSettings({variable:""}),initialTop:0,finalTop:0,stickyEnabled:!1,sidebarSegmentOrder:["FIRST","SECOND","THIRD","FOURTH","FIFTH","SIXTH"],selectors:{totalPrice:".total_price",showCcType:".show_cc_type",showCcName:".show_cc_name",stopsCounterList:".stops",paxCounterList:".pax",paxNameList:".pax_name_list",seatmapTable:".seatmap_table",wrapper:".TSwrapper_summary",sidebarSummarySticky:".sidebar_summary_sticky",priceSummary:".TSprice_summary",titleSummary:".TStitle_summary",paxSummary:".TSpax_summary",flightSummary:".TSflight_summary",accommodationSummary:".TSaccommodation_summary",removeHotel:".remove_hotel",paxCounterResult:".pax_counter_result",paxCounterWrapper:".pax_counter_wrapper",datailsButton:".details_button",resultPriceBreakdown:".result_price_breakdown",detailsPricebreakdown:".details_pricebreakdown",tripDisclosure:".trip_disclosure",exceptions:".exceptions",exceptionsWrapper:".exceptions_wrapper",tripBaggageRepricing:".trip_baggage_repricing",owcSpecialRules:".owc_special_rules",priceperpax:".pax_price",cheapestPaymentmethodDisclaimer:".cheapest_paymentmethod_disclaimer",sidebarSummaryPartialPriceLabel:".sidebarSummary_partial_price_label",sidebarSummaryTotalPriceLabel:".sidebarSummary_total_price_label",promocodeContainer:".promocode_table",baggagesTemplate:".baggage_template",baggagesTemplateSplitted:".baggage_template_splitted",baggagesContainer:".baggage_table",baggagesDisclaimer:".baggage_disclaimer",passengersSection:".passengers_sidebar",premiumPassengerSection:".premium_passenger_sidebar",premiumPassengerName:".premium_passenger_name_sidebar",membershipPriceDisplayCcFee:".paymentfee.membership_price_display_cc_fee",membershipPriceDisplayFeeText:".membership_price_display_fee_text",membershipPriceDisplayFeeValue:".membership_price_display_fee_value",membershipPriceDisplayDisclaimer:".membership_price_display_disclaimer",membershipPriceDisplayDisclaimerNoBtwnTrav:".membership_price_display_disclaimer_no_btwn_trav",membershipPriceDisplayDisclaimerTxt:".disclaimer_txt",SHPrice:".SH_price",addpaxAction:".details_add_adults_button",baggageSegmentTemplate:".baggage_segment_tmpl",premiumBubbleContent:".bubble_sidebar_member_content",premiumBubbleTemplate:".bubble_sidebar_member_tmpl",priorityBoardingContainer:".priority_boarding_container",tooltipPrimePricePopup:".tooltip_prime_price_popup",flexAlertWrapper:".flex_alert",flexAlertTemplate:".flex_alert_template",flexAlertMessage:".flex_message",handBaggageTemplate:".hand_baggage_template",priceContainer:".sidebar_price_container",priceLoader:".sidebar_price_loader",primePersuasionMessage:".prime_persuasion_message",gdsFreeCancellationMessage:".od-persuasion-message-pax-summary-free-cancellation-hint"},events:{"tap .details_button":"onDetailsButtonClick","tap .change_search":"changeResults","tap .remove_hotel":"removeHotel","tap .accommodation_toggle_details":"accommodationToggleDetails","tap .change_suggestion":"sendUserToResults","tap @addpaxAction":"onAddpaxAction","tap .open_membership_lightbox_perks":"onOpenMembershipLightboxPerks","tap .tooltip_prime_price_popup_close":"onTooltipPrimePricePopupClose","tap .tooltip_login_link":"onOpenLoginForm"},setCcSelected:function(e){this.$cachedSelectors.showCcName.html(e)},initializeStickyPrice:function(){this.stickyEnabled=this.isPayment()&&this.$cachedSelectors.wrapper.data("sticky")},isPayment:function(){return"payment"===this.model.get("page")},stickPriceSection:function(e){if(this.stickyEnabled){var t,i,n,a=e.scrollTop,s=e.footerTop;0===this.initialTop&&(this.initialTop=this.$cachedSelectors.priceSummary.offset().top),n=a>this.initialTop,this.$cachedSelectors.sidebarSummarySticky.toggleClass("sticky",n),this.$cachedSelectors.titleSummary.toggleClass("odf-hidden",n),this.$cachedSelectors.paxSummary.toggleClass("odf-hidden",n),this.$cachedSelectors.flightSummary.toggleClass("odf-hidden",n),this.$cachedSelectors.accommodationSummary.toggleClass("odf-hidden",n),this.$cachedSelectors.exceptionsWrapper.toggleClass("odf-hidden",n),n&&(t=$("#header").height(),this.finalTop=s-this.$cachedSelectors.sidebarSummarySticky.height()-t-40,i=a-t>this.finalTop,this.$cachedSelectors.sidebarSummarySticky.toggleClass("sticky-footer",i),this.$cachedSelectors.sidebarSummarySticky.css({top:i?this.finalTop:""}))}},onDetailsButtonClick:function(e){n.trackEvent("trip_information","open_trip_details_sidebar"),Odigeo.trigger(this.widget.id+":openFlightDetails",e,!1)},changeResults:function(e){var t=$(e.target).data("to");n.trackEventWithCategory(t,"searcher_flights","open_change_search"),"livebox"!==t&&Odigeo.Router.navigate("results")},initializesStops:function(){_.each(this.$cachedSelectors.stopsCounterList,function(e){$(e).html(Odigeo.Utils.pluralizeAll($(e).data("plural"),parseInt($(e).data("stops"),10)))})},setPaxCounters:function(){var e=[];_.each(this.$cachedSelectors.paxCounterList,function(t){var i=$(t),n=parseInt(i.data("count"),10);0<n&&e.push(Odigeo.Utils.pluralizeAll(i.data("plural"),n))}),this.$cachedSelectors.paxCounterResult.html(_.compact(e).join(", "))},onUpdateTravellersName:function(){var e,t=_.compact(this.model.get("paxNameList"))||[],i=_.isEmpty(t);this.$cachedSelectors.paxCounterWrapper.toggleClass("odf-hidden",!i),e="payment"===this.model.get("page")?_.template(this.$el.find(".passengers_list_template").html(),Odigeo.Utils.getTmplSettings())({travellers:t}):t.join(", "),this.$cachedSelectors.paxNameList.html(e).toggleClass("odf-hidden",i),this.$cachedSelectors.premiumPassengerName.html(e).toggleClass("odf-hidden",i),this.displayPremiumView(1===_.size(this.model.get("paxNameList"))&&this.model.get("isSinglePremiumPassengerSelected"))},displayPremiumView:function(e){this.$cachedSelectors.passengersSection.toggleClass("odf-hidden",e),this.$cachedSelectors.premiumPassengerSection.toggleClass("odf-hidden",!e)},displayPremiumDisclaimers:function(e,t){var i="discount"===t||"noDiscount"===t||e;this.$cachedSelectors.membershipPriceDisplayDisclaimerNoBtwnTrav.toggleClass("odf-hidden",i),this.$cachedSelectors.membershipPriceDisplayDisclaimer.toggleClass("odf-hidden",!0)},updatePriceMemberDisplayPrices:function(e,t){s.updatePriceMemberDisplayPrices({action:e,isSubscriptionAdded:!!t,options:this.widget.options,$cachedSelectors:this.$cachedSelectors,$widget:this.$widget})},updatePriceMemberDisplay:function(e,t){var i="login"===e||t||"discount"===e;this.displayPremiumDisclaimers(i,e)},onUpdateBaggages:function(){var e=Odigeo.Utils.parseOptions(this.widget.options),t=this.getBaggage(),i=this.getBaggageTemplateData(t);Odigeo.AB.isItineraryBagPriceSplitDesktop?_.isFunction(this.baggagesTemplateSplitted)&&this.$cachedSelectors.baggagesContainer.html(this.baggagesTemplateSplitted(i)):_.isFunction(this.baggagesTemplate)&&this.$cachedSelectors.baggagesContainer.html(this.baggagesTemplate(t)),this.$cachedSelectors.baggagesContainer.attr("data-all-price-baggage",this.widget.getBaggageSelectedTotalPrice()),this.checkPricebreakDownVisibility(),Odigeo.trigger("getTotalByFullprice",this.$widget),this.renderBaggageDisclaimer(e.translations)},getBaggage:function(){return Odigeo.AB.isItineraryBagPriceSplitDesktop?this.widget.getAllBaggagePriceBreakDownItems():this.widget.getBaggagePriceBreakDownItems()},getBaggageTemplateData:function(e){var t=r.getRequestType();return{baggageInfo:this.widget.extendItineraryBaggage(e),price:this.widget.getTotalPrice(e),translations:this.widget.options.translations.flightTypes[t]}},getNumberBaggagePieces:function(){return Odigeo.AB.isItineraryBagPriceSplitDesktop?this.widget.calculateTotalQuantity():this.widget.getBaggageSelectedPieces()},updatePromocode:function(e){s.updatePromocode({$cachedSelectors:this.$cachedSelectors,promoCode:e,$widget:this.$widget})},renderBaggageDisclaimer:function(e){var t=this.$cachedSelectors.baggagesContainer.find(".baggage_fee_disclaimer"),i=this.getNumberBaggagePieces(),n=this.widget.getSelectedBaggageAverageFee();t.html(Odigeo.Utils.replaceCmsKeyArgs(e.disclaimer.baggageFee,n)),t.toggleClass("odf-hidden",0===i||0===n)},onUpdateSeatmap:function(){var e,t=this.model.get("seatmap"),i=_.gt(t.quantity,0),n=_.isEmpty(t)?0:t.quantity,a=_.isEmpty(t)?0:t.allprice,s=this.$cachedSelectors.seatmapTable,r=s.find(".seat_map_concept"),o=Odigeo.Utils.pluralizeAll(r.attr("data-plural"),n);Odigeo.Session.set("numSelected_seats",n),i&&(s.data("quantity-seatmap",n),(e=s.find(".seat_map_all_price")).html(Odigeo.Utils.formatCurrency(a)),e.attr("data-allprice-seatmap",a),r.html(o)),s.toggleClass("hidden",!i),this.checkPricebreakDownVisibility()},checkPricebreakDownVisibility:function(){var e=0<this.model.get("seatmap").quantity,t=!this.widget.hasNoBagBeenSelected();0<this.$cachedSelectors.detailsPricebreakdown.length&&this.$cachedSelectors.detailsPricebreakdown.toggleClass("odf-hidden",!e&&!t)},repaintPrices:function(e,t,i){this.$cachedSelectors.totalPrice.html(e),this.$cachedSelectors.priceperpax.html(t),_.isUndefined(this.$cachedSelectors.SHPrice)||this.$cachedSelectors.SHPrice.html(i)},showFinalPrice:function(e){this.$cachedSelectors.sidebarSummaryPartialPriceLabel.toggleClass("odf-hidden",e),this.$cachedSelectors.sidebarSummaryTotalPriceLabel.toggleClass("odf-hidden",!e)},showPriceWithoutDiscountSelectedDisclaimer:function(){if(!_.isEmpty(this.$cachedSelectors.cheapestPaymentmethodDisclaimer)){var e=this.$cachedSelectors.cheapestPaymentmethodDisclaimer.data("isPriceWithoutDiscountSelected");this.$cachedSelectors.cheapestPaymentmethodDisclaimer.toggleClass("odf-hidden",e)}},renderPremiumBubble:function(e){if(s.renderPremiumBubble({membershipSettings:e,$cachedSelectors:this.$cachedSelectors,options:this.widget.options,templateSettings:this.templateSettings}),Odigeo.AB.isMemberSmoothSubscription){var t="payment"===this.model.get("page");this.showFinalPrice(t||e.isSubscriptionAdded||!e.isCheapestPriceSelected)}},getMembershipTrackingLabel:function(e){return{"logged-applied":"member","member-not-travelers":"member_missing",applied:"prime_suggested","not-applied":"not_elegible","subscription-added":"prime_added"}[$(e.currentTarget).data("status")]},onTooltipPrimePricePopupClose:function(e){n.trackEvent("prime_sidebar","prime_sidebar_tooltip_close"),this.$el.find(this.selectors.tooltipPrimePricePopup).addClass("odf-hidden")},renderFlexAlert:function(){var e=this;o.getLoadedPromise().then(function(t){t&&o.isCanxFree()&&(e.$el.find(e.$cachedSelectors.flexAlertMessage).removeClass("odf-hidden"),Odigeo.Session.get("FlexSystemAlertClosed")||(new c({el:e.$cachedSelectors.flexAlertWrapper,template:_.template(e.$cachedSelectors.flexAlertTemplate.html(),Odigeo.Utils.getTmplSettings()),translations:e.widget.options.translations.flexibilityDisruption,page:"pax"}),e.$el.find(e.$cachedSelectors.flexAlertWrapper).removeClass("odf-hidden")))})},onOpenMembershipLightboxPerks:function(e){n.trackEvent("sidebar_prime","click_logo_"+this.getMembershipTrackingLabel(e))},toggleCcType:function(e){this.$cachedSelectors.showCcType.toggleClass("odf-hidden",!e)},onAddpaxAction:function(){Odigeo.trigger(this.widget.id+":addPaxSidebar")},onOpenLoginForm:function(e){n.trackEvent("prime_sidebar","prime_sidebar_tooltip_login"),Odigeo.trigger(this.widget.id+":openLoginForm",e)},updatePricesWithMembershipSubscription:function(e){var t=this.$el.find(".membership_subscription_table"),i=0===e.allPrice;t.toggleClass("odf-hidden",i),t.find(".od-js-all-price").attr("data-all-price",e.allPrice),t.find(".od-js-one-price").html(Odigeo.Utils.formatCurrency(e.onePrice)),t.find(".od-js-quantity").html(e.quantity),t.find(".od-js-all-price").html(Odigeo.Utils.formatCurrency(e.allPrice))},confirmHotelRemoved:function(){this.$cachedSelectors.sidebarSummarySticky.addClass("hotel_removed")},accommodationToggleDetails:function(e){var t=$(e.currentTarget),i=_.clone(t.data("details")),a=t.data("label"),s=Odigeo.History.getPageNameFromFragment()+"_flights_container",r=this.$("#"+s).hasClass("open");e.stopPropagation(),i.target=s,Odigeo.trigger(this.widget.id+":toggleDetails",i),!r&&a&&n.trackEvent("trip_information",a)},removeHotel:function(){var e=this.$el.find(".xsell_hotel_image").attr("src");this.$cachedSelectors.removeHotel.data("disabled")||Odigeo.trigger(this.widget.id+":removeHotel",e)},disableRemoveHotel:function(){this.$cachedSelectors.removeHotel.data("disabled",!0)},enableRemoveHotel:function(){this.$cachedSelectors.removeHotel.data("disabled",!1)},sendUserToResults:function(e){$(e.target).data("isUpsell")?Odigeo.Router.navigate("results"):this.sendUserToDpResults(e)},sendUserToDpResults:function(e){Odigeo.Session.remove("before-page"),Odigeo.trigger(this.widget.id+":sendUserToDpResults",$(e.target).data("product"))},init:function(){if(this.initializesStops(),this.setPaxCounters(),this.$cachedSelectors.baggageSegmentTemplate.html()&&(this.baggageSegmentTemplate=_.template(this.$cachedSelectors.baggageSegmentTemplate.html(),this.templateSettings)),this.$cachedSelectors.handBaggageTemplate.html()&&(this.handBaggageTemplate=_.template(this.$cachedSelectors.handBaggageTemplate.html(),this.templateSettings)),"details"===this.widget.options.page){var e=_.extend({},this.templateSettings,{variable:"priceDescriptorsArray"});this.baggagesTemplate=_.template(this.$cachedSelectors.baggagesTemplate.html(),e),this.baggagesTemplateSplitted=_.template(this.$cachedSelectors.baggagesTemplateSplitted.html(),e)}_.isEmpty(this.$cachedSelectors.resultPriceBreakdown)||Odigeo.UIElements.hint.enhance(Odigeo.History.getPageNameFromFragment(),this.$cachedSelectors.resultPriceBreakdown,{events:{tap:!0},googleAnalyticsOnOpen:{type:"trackEvent",data:{page:Odigeo.History.getPageNameFromFragment(),action:"trip_information",label:"open_price_breakdown"}}}),_.isEmpty(this.$cachedSelectors.tripDisclosure)||Odigeo.UIElements.hint.enhance(Odigeo.History.getPageNameFromFragment(),this.$cachedSelectors.tripDisclosure,{events:{tap:!0},googleAnalyticsOnOpen:{type:"trackEvent",data:{page:Odigeo.History.getPageNameFromFragment(),action:"trip_information",label:"open_notes_tooltip"}}}),this.$cachedSelectors.tripBaggageRepricing.length&&(Odigeo.UIElements.hint.enhance(Odigeo.History.getPageNameFromFragment(),this.$cachedSelectors.tripBaggageRepricing,{events:{tap:!0},googleAnalyticsOnOpen:{type:"trackEvent",data:{category:"flights_pay_page",action:"trip_information",label:"baggage_allowance_changed_details_clicks"}}}),n.trackEvent("trip_information","baggage_allowance_changed")),this.$cachedSelectors.owcSpecialRules.length&&(n.trackEvent("on_load","xfaring_info_loaded"),Odigeo.UIElements.hint.enhance(Odigeo.History.getPageNameFromFragment(),this.$cachedSelectors.owcSpecialRules,{events:{tap:!0},googleAnalyticsOnOpen:{type:"trackEvent",data:{action:"xfaring_info",label:"xfaring_info_clicked"}}})),this.listenTo(this.model,"change:seatmap",this.onUpdateSeatmap),this.listenTo(this.model,"change:paxNameList",this.onUpdateTravellersName),this.listenTo(this.model,"updatePrices",this.repaintPrices),this.processCanxFree()},processCanxFree:function(){var e=this;o.getLoadedPromise().then(function(t){t&&o.isCanxFree()&&e.$cachedSelectors.gdsFreeCancellationMessage.addClass("odf-hidden")})},togglePriceLoading:function(e){this.$el.find(this.$cachedSelectors.priceContainer).toggleClass("od-smooth-opacity-layer",e),this.$el.find(this.$cachedSelectors.priceLoader).toggleClass("odf-hidden",!e)}})))},function(e,t,i){"use strict";Odigeo.defineWidget("ip_new_search_tooltip",Odigeo.Widget.extend({viewClass:Odigeo.View.extend({slctrs:{tooltip:".new_search_tooltip"},toggleTooltip:function(e){this.$el.find(this.slctrs.tooltip).toggleClass("open",e),document.querySelector(this.slctrs.tooltip).style.zIndex="3"}}),showTooltip:function(){this.view.toggleTooltip(!0)},hideTooltip:function(){this.view.toggleTooltip(!1)}}))},function(e,t,i){"use strict";var n=i(622);e.exports=n.extend({events:_.extend({"click @insuranceDescriptionFullToggleButton":"onCoverageClickHandler"},n.prototype.events),selectors:_.extend({insuranceDescriptionFull:".insurance_description_full",insuranceDescriptionFullToggleButton:".insurance_full_coverage_link",insuranceItemPopup:".insurance_item_popup"},n.prototype.selectors),parseTextsAndAttributes:function(e){n.prototype.parseTextsAndAttributes.apply(this,arguments),this.parseFullBenefits(e)},parseFullBenefits:function(e){_.extend(e.texts,{parsedFullBenefits:e.parsedFullBenefits||this.parseBenefitsHtml(e.texts.benefitsFull)})},parseFooterLink:function(e){var t=$("<div>",{class:"hint_trigger_button odf-popup-container"});t.append($("<span>",{class:"odf-link odf-link-sm odf-link-legal",text:_.get(e,"texts.footerLink")})).append($("<span>",{class:"hint_container odf-text-mono-color-03"})),_.extend(e.texts,{parsedFooter:Odigeo.Utils.replaceCmsKeyArgs(e.texts.footer,$("<div>").append(t).html())})},postRender:function(){n.prototype.postRender.apply(this,arguments),_.each(this.$cachedSelectors.insuranceDescriptionFull,this.enhanceFullBenefits,this),_.each(this.$cachedSelectors.insuranceItemPopup,this.enhanceHintPopup,this)},enhanceFullBenefits:function(e){var t=$(e),i=t.data("policy"),n={googleAnalyticsOnOpen:{type:"trackEvent",data:this.widget.tracking.getTrackData("open_details",i)},googleAnalyticsOnClose:{type:"trackEvent",data:this.widget.tracking.getTrackData("close_details",i)}};Odigeo.UIElements.collapsive.enhance(t,n)},onCoverageClickHandler:function(e){var t=$(e.target),i=t.closest(".insurance_full_coverage_link"),n=t.closest(".insurance_element").find(".insurance_description_full"),a=n.hasClass("expanded");n.is(":animated")||(n.trigger("togglePanel"),i.find(".closed_label").toggleClass("odf-hidden",!a),i.find(".opened_label").toggleClass("odf-hidden",a))}})},function(e,t,i){"use strict";var n,a,s,r,o="",c="",d=!0,l="en-US",g=null,h=$(window),u=$("body"),p=i(0),f=i(612).notificationService(),m=function(){window.focus(),p.trackEvent("browser_notification","browser_notification_clicked"),this.close()},b=_.once(function(e){if(Odigeo.AB.isBrowserNotificationsMeta&&("flights_pax_page"===e||"flights_pay_page"===e)){var t="flights_pax_page"===e?Odigeo.UIElements.translations.notifications.paxGeneralBody:Odigeo.UIElements.translations.notifications.payGeneralBody,i="flights_pax_page"===e?Odigeo.UIElements.translations.notifications.paxSubtitleBody:Odigeo.UIElements.translations.notifications.paySubtitleBody;f.send(t,{body:i},m).then(function(){p.trackEvent("browser_notification","browser_notification_loaded")})}}),y=function(e){var t=$('link[rel*="icon"]'),i=e?"favicon.ico":"favicon_2.ico",n=e?"favicon_2.ico":"favicon.ico";_.each(t,function(e){e.href=e.href.replace(i,n)})},v=function(e){var t,i=e.data,n=i,a=function(){var e=1<n.length?n.substring(1,n.length):i;postMessage(e),1<n.length?n=e:s()},s=function(){clearInterval(t),n=i,setTimeout(r,3e3)},r=function(){postMessage(i),t=setInterval(a,200)};setTimeout(s,17e3)},S=function(e,t){d=!0,l=e.replace("_","-"),g=Odigeo.Utils.parseJson(Odigeo.Session.get("searchParameters")),_.isNull(g)||(function(){!_.isNull(g)&&g.searchSegments.length&&(o="",_.each(g.searchSegments,function(e,t){o=o+(0<t?" | ":"")+e.departure.city+" -> "+e.destination.city+" ("+new Date(e.dateStr).toLocaleDateString(l)+")"},this))}(),function(e){_.isUndefined(n)&&(c=document.title,function(){var e="self.onmessage = "+v.toString();if(_.isUndefined(a))try{a=new Blob([e],{type:"application/javascript"})}catch(i){var t;window.BlobBuilder=window.BlobBuilder||window.WebKitBlobBuilder||window.MozBlobBuilder,(t=new window.BlobBuilder).append(e),a=t.getBlob()}}(),(n=new Worker(URL.createObjectURL(a))).onmessage=function(t){document.title=t.data,d&&(y(!0),d=!1,b(e))}),n.postMessage(o)}(t))},C=function(){_.isNull(g)||_.isUndefined(n)||(document.title=c,n.terminate(),n=void 0,y(!1))};e.exports={init:function(e){var t;Odigeo.SessionScope.isMeta&&(t=e,_.isFunction(s)&&_.isFunction(r)&&h.off(Odigeo.Events.blur,s).off(Odigeo.Events.focus,r),s=_.partial(S,u.data("locale"),t),r=_.partial(C,t),h.on(Odigeo.Events.blur,s).on(Odigeo.Events.focus,r))}}},,,,,function(e,t,i){"use strict";var n=i(618),a=i(564),s=i(101),r=i(94);e.exports=new n(r.extend({modelClass:i(761),viewClass:null,exposedMethods:null,seatMapSelectionCollection:null,passengerCollection:null,descriptorsScheme:{},analitycLabel:"",init:function(){this.options=Odigeo.Utils.parseOptions(this.options),(this.options.isPostBooking||this.options.hasToShow)&&this.initCollections(),this.options.hasToShow?(this.trackSeats("onload_seat_widget_prov"),this.options.isPureAmadeus&&Odigeo.trigger("seatmap:initInspectlet")):this.trackSeats("seat_widget_unavailable_loading_not_applied_prov")},initCollections:function(){this.constructCollections(),this.removeStoragedSeatPreferenceSelection()},getProviderTracking:function(){return this.options.isPureAmadeus?"ama":"other"},trackSeats:function(e){this.analyticsEventTracking({action:"on_load_widgets",label:e+":"+this.getProviderTracking()})},constructCollections:function(){this.options.isPostBooking||this.model.fetch(this.model.getDataRequestSettings()),this.passengerCollection=a.getInstance(),this.seatMapSelectionCollection=s.getInstance(),this.setupViewOptions(),this.afterConstructCollections()},afterConstructCollections:function(){this.options.isPostBooking||this.passengerCollection.setUp(this.options),this.seatMapSelectionCollection.setUp(this.options),this.bindEvents()},removeStoragedSeatPreferenceSelection:function(){Odigeo.Session.remove("seatPreferenceSelection")},setupViewOptions:function(){this.analitycLabel=this.options.analitycLabel},bindEvents:function(){this.listenTo(this.model,"responseIsOK",this.toggleLoadingSeats,this),this.listenTo(this.model,"responseIsKO",_.bind(this.toggleLoadingSeats,this,!1)),this.listenTo(this.model,"responseIsOK",this.updateDescriptors,this),this.listenTo(this.model,"responseIsKO",this.view.hideSeatSelection,this),this.listenTo(this.passengerCollection,"passengerCollectionIsOk",this.sendResponsePassengerCollectionIsOk,this),this.listenTo(this.seatMapSelectionCollection,"seatMapSelectionResponseIsOK",this.updateViewWithSelections,this),this.listenTo(this.seatMapSelectionCollection,"add",this.updateView,this),this.listenTo(this.seatMapSelectionCollection,"remove",this.updateView,this),this.listenTo(this.seatMapSelectionCollection,"reset",this.updateView,this)},triggerNagSubscribeEvent:function(){Odigeo.AB.isNewCreateShoppingCart&&!this.areSegmentsLoaded()||Odigeo.trigger(this.id+":nagSubscribe",{widgetId:"seatmap-selection",details:{priceData:{},seatsContinueNagAlreadyShown:!1,seatsRemoveNagAlreadyShown:!1}})},updateSeatFees:function(e,t,i){var n=this.seatMapSelectionCollection.getSeatSelectionFees();e.html(Odigeo.Utils.replaceCmsKeyArgs(i,Odigeo.Utils.formatCurrency(n))),t.toggleClass("odf-hidden",0===this.seatMapSelectionCollection.length||n<=0)},updateDescriptors:function(e){this.setDescriptorsScheme(e),Odigeo.AB.isNewCreateShoppingCart&&!this.areSegmentsLoaded()||(this.model.set("pristineMoveThrough",!0),this.setPreferredSeatsThresholds(e),this.view.activeButton(),this.triggerNagSubscribeEvent(),this.view.autoOpenAircraft())},setDescriptorsScheme:function(e){this.descriptorsScheme=e},areSegmentsLoaded:function(){return _.filter(this.getSeatMapSegments(),function(e){return"LOADED"===e.status&&!_.isEmpty(e.seatMap)}).length},setPreferredSeatsThresholds:function(e){this.model.set("preferredSeatsThreshold",this.generatePreferredSeatsThresholds(e))},generatePreferredSeatsThresholds:function(e){var t=_.filter(e.attributes,_.isObject);return _.reduce(t,function(e,t){var i=this.getSegmentPreferredSeatsThresholds(t);return _.assign(i,e)},{},this)},getSegmentPreferredSeatsThresholds:function(e){return _.reduce(e.seatMap,function(e,t){var i=this.getSectionSeatsPriceIntervals(t.cabin),n=this.calculatePreferredSeatThreshold(i),a={};return a[t.section]=n,_.assign(a,e)},{},this)},getSectionSeatsPriceIntervals:function(e){return _.map(_.uniq(_.flatten(_.map(e,function(e){return _.filter(e.seats.seat,function(e){return _.includes(e.seatCharacteristics.characteristic,"CHARGEABLE_SEAT")&&!_.includes(e.seatCharacteristics.characteristic,"EXTRA_LEG")&&0<e.totalPrice})})),"totalPrice"),"totalPrice")},calculatePreferredSeatThreshold:function(e){return _.isArray(e)&&3<=e.length?_.max(e)-.1*(_.max(e)-_.min(e)):0},getSeatMap:function(e,t){var i={};return _.each(this.descriptorsScheme.attributes,function(n){n.segment===e&&_.each(n.seatMap,function(e){e.section===t&&(i=e)},this)},this),i},hasSeatsAndEnoughForAllPassengers:function(e){var t=!_.isEmpty(e.seats)&&!_.isEmpty(e.seats.seat),i=t?_.size(e.seats.seat):0,n=t?_.size(_.filter(e.seats.seat,{type:"NO_SEAT"})):0;return{hasSeats:!!t&&0<i-n,hasSeatsForAllPax:!!t&&i-n>this.options.nTravellers}},getSeatMapSegments:function(){return _.filter(this.descriptorsScheme.attributes,function(e){return _.isObject(e)&&0<=e.segment})},getNumberOfSectionsWithSelectableSeats:function(){return _.reduce(this.getSeatMapSegments(),function(e,t){return _.size(t.seatMap)+e},0)},getFirstSectionWithAvailableSeats:function(e){return _.get(_.find(e,function(e){return 0<_.size(e.seatMap)}),"seatMap[0].section",0)},updateView:function(){(this.options.isPostBooking||this.options.hasToShow)&&this.view.updateView()},toggleLoadingSeats:function(e){e||this.trackSeats("seat_widget_error_prov"),this.view.hideLoadingSeatMap()},updateSelectedSeats:function(){var e=_.isEmpty(this.seatMapSelectionCollection)?{}:this.createSeatMapSelectionCollection();Odigeo.trigger(this.id+":updateSeatsInPassengersPage",e)},createSeatMapSelectionCollection:function(){var e={seatData:{seatMapSelectionRequests:[],numberOfRetries:this.retries}};return this.seatMapSelectionCollection.each(function(t){e.seatData.seatMapSelectionRequests.push({sections:[t.get("section")],numPassenger:t.get("numPassenger"),floor:t.get("floorSelection"),row:t.get("rowSelection"),seatMapRow:t.get("seatMapRow"),column:t.get("columnSelection"),selection:!0})},this),e},updateTotalPriceValues:function(e){var t,i=0,n=0;this.seatMapSelectionCollection.each(function(e){i+=e.get("totalPrice"),n++},this),t=i?2:0,this.view.updatePriceView(i,t),this.addItemToPricemanagerCollection({allPrice:i,conceptKey:"seatmap",onePrice:i/n,quantity:n}),this.updatePriceBreakDown({allprice:i,concept:"seatmap",oneprice:i/n,quantity:n}),Odigeo.Session.set("seatPreferenceSelection",JSON.stringify(this.seatMapSelectionCollection)),Odigeo.Session.set("seatSelection_"+e,JSON.stringify(this.seatMapSelectionCollection))},updatePassengers:function(){this.passengerCollection.updatePassengers()},showErrors:function(){this.hideErrors(),this.view.showErrors()},hideErrors:function(){this.view.hideErrors(),this.view.hideRetryWarnings()},updatePriceBreakDown:function(e){var t={seatData:{},priceData:{data:e,id:"seatmap",type:"seatmap"}};_.isEmpty(this.seatMapSelectionCollection)||(t.seatData={seatMapSelectionRequests:[],numberOfRetries:this.retries},this.seatMapSelectionCollection.each(function(e){t.seatData.seatMapSelectionRequests.push({sections:[e.get("section")],numPassenger:e.get("numPassenger"),floor:e.get("floorSelection"),row:e.get("rowSelection"),seatMapRow:e.get("seatMapRow"),column:e.get("columnSelection"),selection:!0})},this)),Odigeo.trigger(this.id+":seatMapSelected",t)},seatMapSelectionRetryError:function(e){this.analyticsEventTracking({label:"seat_selection_gds_submit_error"}),this.hideErrors(),this.retries=this.retries+1,this.retries>this.options.maxRetries?Odigeo.trigger(this.id+":severalRetries"):(this.view[this.retries===this.options.maxRetries?"showNoMoreRetries":"showErrors"](),this.manageRetryErrors(e),this.model.fetch())},manageRetryErrors:function(e){_.each(e,function(e){"SEATMAP_SELECTION_RETRY_NOT_AVAILABE_ERROR_CODE"===e.code?this.manageSeatNotAvaliableErrors(e.seatMapFlightDetails):"SEATMAP_SELECTION_RETRY_NUMPAX_ERROR_CODE"===e.code&&this.manageNumMaxErrors(e.seatMapFlightDetails)},this)},manageSeatNotAvaliableErrors:function(e){_.each(e,function(e){this.seatMapSelectionCollection.removeSelection(this.seatMapSelectionCollection.getFlightSeats(null,e.section)),this.view.showRetryWarning(e.segment,e.section)},this)},initializeSeatView:function(e){var t=!1,i=!1;return _.each(e,_.bind(function(e){var n=e.seatMap,a=this.$el.find('.hide_seats[data-segment="'+e.segment+'"]');_.isEmpty(n)?(a.removeClass("seatmapselection_flight_section"),a.find(".add_seats").addClass("odf-hidden"),a.find(".not_seats").removeClass("odf-hidden"),a.find(".seats_arrow").addClass("odf-hidden")):(a.addClass("seatmapselection_flight_section"),a.find(".not_seats").addClass("odf-hidden"),a.find(".add_seats").removeClass("odf-hidden")),t=t||_.isObject(e)&&"LOADED"===e.status,i=!_.isEmpty(n)||i},this)),this.widget.trackingSeats(i),t},trackingSeats:_.once(function(e){e?this.trackSeats("seat_widget_loaded_prov"):this.trackSeats("seat_widget_unavailable_prov")}),getTrackingConfig:function(){return{type:"trackEvent",data:{category:this.options.isPostBooking?"post_booking":"flights_pax_page",action:"seat_selection"}}},analyticsEventTracking:function(e){var t=$.extend(!0,{},this.getTrackingConfig());return _.extend(t.data,e),Odigeo.trigger("analytics:tracking",t),this},execute:function(e){return Odigeo.Utils.executeInternalMethods(this,this.exposedMethods,e,_.toArray(arguments).slice(1))}}))},function(e,t,i){"use strict";var n="data-status",a="aircraft",s="inactive",r="data-warning",o="odf-hidden",c="INFANT";e.exports=Odigeo.View.extend({selectors:{first_flight_section:".aircraftmap_0_flight_section",first_flight_section_tab:"#seatmapselection_tab_0",seatmapselectionAdded:".seatmapselection_added",seatmapselectionAircraftsWrapper:".seatmapselection_aircrafts_wrapper",seatmapselectionArrowLeft:".seatmapselection_arrow_left",seatmapselectionArrowRight:".seatmapselection_arrow_right",seatmapselectionErrors:".seatmapselection_errors",seatmapselectionFlightSection:".seatmapselection_flight_section",seatmapselectionLabelTab:".seatmapselection_label_tab",seatmapselectionMask:".seatmapselection_mask",seatmapselectionResumeSeats:".seatmapselection_resume_seats",seatmapselectionRetryErrors:".seatmapselection_retry_errors",seatmapselectionSelectButton:".seatmapselection_select_button",seatmapselectionSelectionWrapper:".seatmapselection_selection_wrapper",seatmapselectionSlider:".seatmapselection_slider",seatmapselectionTotalprice:".seatmapselection_totalprice",seatmapselectionWrapper:".seatmapselection",seatmapselectionFooter:".seatmapselection_footer",seatmapRemoveSelection:".seatmapselection_remove_seats",seatmapSpinner:".seatmap_spinner",seatmapFlightTabsTemplateContainer:".seatmap_desktop_flight_tabs_template_wrapper",seatmapFlightTabsTemplate:".seatmap_desktop_flight_tabs",seatmapSelectionSummaryTemplateContainer:".seatmap_desktop_selection_summary_template_wrapper",seatmapSelectionSummaryTemplate:".seatmap_desktop_selection_summary",seatmapSelectionDetailsArrow:".seat_selection_details_arrow",seatmapItineraryCities:".seatmap_itinerary_cities",seatmapItineraryDates:".seatmap_itinerary_dates",seatSelectionDetailsToggle:".post_booking_seat_selection_details_toggle",seatsMessagesWrapper:".seatmap_messages_wrapper",seatsFeeHintContainer:".seats_fee_hint_container",seatsFeeHintText:".seats_fee_hint_text",seatsMessagesIcon:".seats_messages_icon",seatsMessagesTitle:".seats_messages_title",seatsMessagesText:".seats_messages_text"},events:{"tap @seatmapselectionArrowLeft":"onTapLeftArrow","tap @seatmapselectionArrowRight":"onTapRightArrow","tap @seatmapselectionErrors":"hideErrors","tap @seatmapselectionFlightSection":"onTapOpenAircraftMap","tap @seatmapselectionRetryErrors":"hideErrors","tap @seatmapselectionSelectButton":"onTapSeatmapselectionSelectButton","tap @seatmapRemoveSelection":"onResetSeatmapSelectionDialog","tap .seatmapselection_confirm_button":"onTapConfirmSeats","tap @seatSelectionDetailsToggle":"toggleSeatSelectionDetails"},activeStep:0,openWhenLoadWidget:!0,onTapSeatmapselectionSelectButton:function(){this.openFirstSectionAircraftMap(),this.hideBubble(this.$cachedSelectors.seatmapselectionAdded),this.updateRemoveSelectionButton(),this.widget.analyticsEventTracking({label:"seats_gds_open_clicks"}),this.widget.options.isPostBooking&&(this.toggleChangeSelectionButton(!0),this.toggleSelectionShowDetailsButton(!1),Odigeo.trigger(this.widget.id+":moveToShoppingPhase"))},toggleChangeSelectionButton:function(e){this.$cachedSelectors.seatmapselectionSelectButton.toggleClass(o,e)},toggleSelectionShowDetailsButton:function(e){this.$cachedSelectors.seatSelectionDetailsToggle.toggleClass(o,e)},onResetSeatmapSelectionDialog:function(){Odigeo.trigger(this.widget.id+":showDeleteAllDialog",{keepSeatmapOpen:!0})},resetSeatmapSelection:function(){this.widget.seatMapSelectionCollection.resetCollection(),this.openFirstSectionAircraftMap(),this.updateRemoveSelectionButton(),Odigeo.trigger(this.widget.name+":updateSidebarSummary",this.widget.seatMapSelectionCollection)},onTapConfirmSeats:function(){0<this.widget.seatMapSelectionCollection.length?(this.widget.disablePristineMoveThrough(),this.closeAircraftMap(),this.scrollToSeatMapSelectionTop()):Odigeo.trigger(this.widget.id+":showNoSeatsSelectedDialog"),this.widget.analyticsEventTracking({label:this.widget.seatMapSelectionCollection.getConfirmActionTrackingText()}),this.widget.analyticsEventTracking({label:this.widget.seatMapSelectionCollection.getConfirmActionTrackingButton("global")})},onTapOpenAircraftMap:function(e){this.widget.hideErrors(),this.widget.disablePristineMoveThrough(),this.openAircraftMap($(e.currentTarget))},onTapLeftArrow:function(){this.moveTabSlider("left")},onTapRightArrow:function(){this.moveTabSlider("right")},checkTabSlider:function(){var e=0==this.activeStep,t=this.$cachedSelectors.seatmapselectionSlider.width()<=this.$cachedSelectors.seatmapselectionMask.width();this.$cachedSelectors.seatmapselectionSlider.css({left:"0px"}),this.$cachedSelectors.seatmapselectionArrowLeft.toggleClass(o,e),this.$cachedSelectors.seatmapselectionArrowRight.toggleClass(o,t)},moveTabSlider:function(e){var t=this.$cachedSelectors.seatmapselectionSlider;this.getStatusValue(t)===s&&(this.setStatusValue(t,"active"),t.css({left:this.getLeftValue(e)+"px"}),t.on(Odigeo.Events.transitionEnd,_.bind(function(){this.checkArrowsVisibility(),this.setStatusValue(t,s)},this)))},getLeftValue:function(e){return this.activeStep="left"===e?this.activeStep-1:this.activeStep+1,154*-this.activeStep},checkArrowsVisibility:function(){var e=!1,t=!1;0===this.activeStep?e=!0:(this.activeStep===this.widget.options.numberOfFlightSections-1||this.isTheLastTabVisible())&&(t=!0),this.$cachedSelectors.seatmapselectionArrowLeft.toggleClass(o,e),this.$cachedSelectors.seatmapselectionArrowRight.toggleClass(o,t)},isTheLastTabVisible:function(){var e=this.$cachedSelectors.seatmapselectionSlider,t=this.$cachedSelectors.seatmapselectionMask;return e.offset().left+e.width()+5<=t.offset().left+t.width()},isArrowVisible:function(e){return!("left"===e?this.$cachedSelectors.seatmapselectionArrowLeft:this.$cachedSelectors.seatmapselectionArrowRight).hasClass(o)},openAircraftMap:function(e,t){var i=e.data("carrier"),n=this.setupAircraftOptions(e.data(),t),a=this.widget.getSeatMap(n.segment,n.section);this.openAircraftMapTracking(e,n),this.$cachedSelectors.seatmapselectionFooter.toggleClass(o,this.isNoSeatMapAndNoSeatsSelected(a)),this.updateSelectedAircraft(e),this.widget.updatePassengers(),this.updateSectionTabPosition(n),this.updateSeatMapMessages(a,i),Odigeo.trigger(this.widget.id+":openAircraftMap",a,n)},openAircraftMapTracking:function(e,t){var i=t.section+1,n=this.$cachedSelectors.seatmapselectionLabelTab.length;"false"===e.find(this.$cachedSelectors.seatmapselectionLabelTab).attr("data-selected")&&this.widget.analyticsEventTracking({label:"seats_gds_select_flight_"+i+"_"+n}),t.isLast&&this.widget.analyticsEventTracking({label:"last_seatmap_screen_loaded_"+i+"_leg"})},setupAircraftOptions:function(e,t){var i=0<e.nEligibleTravellers?e.nEligibleTravellers:this.getEligibleTravellersCount(),n={itinerarySectionsCount:_.size(this.model.get("seatMapInfo")),isMultiDestination:this.model.get("isMultiDestination"),nEligibleTravellers:i};return _.extend({},e,t,n,{pristineMoveThrough:this.model.get("pristineMoveThrough"),preferredSeatsThreshold:this.model.get("preferredSeatsThreshold")})},isNoSeatMapAndNoSeatsSelected:function(e){return 0===_.size(this.widget.seatMapSelectionCollection)&&_.isEmpty(e)},openNextAircraft:function(e,t){var i=this.$el.find(this.getItineraryDivBySection(e.section));this.updateSelectedAircraft(i.next()),this.openAircraftMap(i.next(),_.extend({next:!0},t))},openPrevAircraft:function(e,t){var i=this.$el.find(this.getItineraryDivBySection(e.section));this.updateSelectedAircraft(i.prev()),this.openAircraftMap(i.prev(),_.extend({prev:!0},t))},updateSelectedAircraft:function(e){this.resetAircraftSelection(),e.children(this.$cachedSelectors.seatmapselectionLabelTab).attr("data-selected",!0)},updateSectionTabPosition:function(e){e.next&&0<e.section&&this.isArrowVisible("right")?this.onTapRightArrow():e.prev&&this.isArrowVisible("left")&&this.onTapLeftArrow()},updateSeatMapMessages:function(e,t){var i=!_.isEmpty(e);this.$cachedSelectors.seatsMessagesWrapper.toggleClass(o,!i),i&&(this.widget.options.isFRSeatmap="FR"===t,this.setSeatMapPolicyMessage())},resetAircraftSelection:function(){this.$cachedSelectors.seatmapselectionLabelTab.attr("data-selected",!1)},autoOpenAircraft:function(){this.openWhenLoadWidget&&this.openFirstSectionAircraftMap()},getTargetSectionSelectors:function(){var e=this.widget.getFirstSectionWithAvailableSeats(this.widget.getSeatMapSegments());return this.getSectionSelectors(e)},getSectionSelectors:function(e){return{section:this.$cachedSelectors.seatmapselectionSlider.find(".aircraftmap_"+e+"_flight_section"),tab:this.$cachedSelectors.seatmapselectionSlider.find("#seatmapselection_tab_"+e)}},getEligibleTravellersCount:function(e){var t=_.get(e,"nEligibleTravellers",0);return 0<t?t:this.widget.passengerCollection.passengerCountByType("ADULT")+this.widget.passengerCollection.passengerCountByType("CHILDREN")},openFirstSectionAircraftMap:function(){var e=this.getTargetSectionSelectors();this.openAircraftMap(e.section),e.tab.attr("data-selected",!0),this.setStatusValue(this.$cachedSelectors.seatmapselectionWrapper,a),this.checkTabSlider()},closeAircraftMap:function(){var e="initial";this.widget.disablePristineMoveThrough(),0<_.size(this.widget.seatMapSelectionCollection)?(e="selected",this.displayBubbleShake(this.$cachedSelectors.seatmapselectionAdded)):this.hideBubble(this.$cachedSelectors.seatmapselectionAdded),this.setStatusValue(this.$cachedSelectors.seatmapselectionWrapper,e),this.widget.options.isPostBooking&&this.updateSeatMapSelectionDetails()},toggleSeatSelectionDetails:function(e){var t=this.$cachedSelectors.seatmapSelectionSummaryTemplateContainer.hasClass(o);(t&&!0===e||!t&&!1===e||!_.isBoolean(e))&&(this.$cachedSelectors.seatmapSelectionSummaryTemplateContainer.toggleClass(o),this.$cachedSelectors.seatmapSelectionDetailsArrow.toggleClass("odf-icon-arrow-down odf-icon-arrow-up"))},updateSeatMapSelectionDetails:function(){this.toggleChangeSelectionButton(!1),this.toggleSelectionShowDetailsButton(!0),this.toggleSeatSelectionDetails(!0)},updateRemoveSelectionButton:function(){var e=0<this.widget.seatMapSelectionCollection.length;this.$cachedSelectors.seatmapRemoveSelection.toggleClass(o,!e)},renderSeatFees:function(){this.widget.updateSeatFees(this.$cachedSelectors.seatsFeeHintText,this.$cachedSelectors.seatsFeeHintContainer,this.widget.options.translations.seatsFeeDisclaimer)},activeButton:function(){this.$cachedSelectors.seatmapselectionSelectButton.removeAttr("disabled")},updateView:function(){this.$cachedSelectors.seatmapselectionResumeSeats.html("--"),this.widget.seatMapSelectionCollection.each(function(e){var t=this.$el.find(this.getItineraryResumeDiv(e)),i="--"===t.html()?e.get("rowSelection")+e.get("columnSelection"):t.html()+", "+e.get("rowSelection")+e.get("columnSelection");t.html(i)},this),this.widget.updateTotalPriceValues(this.widget.options.bookingId),this.updateRemoveSelectionButton()},checkSections:function(e,t){var i=this.widget.getSeatMap(e,t),n=this.widget.hasSeatsAndEnoughForAllPassengers(i);return n.hasSeats&&n.hasSeatsForAllPax||(i=null),i},updatePriceView:function(e,t){this.$cachedSelectors.seatmapselectionTotalprice.html(Odigeo.Utils.formatCurrency(e,_.clone(Odigeo.Utils.Currency,{decimalPlaces:t})))},hideErrors:function(){this.$cachedSelectors.seatmapselectionErrors.addClass(o),this.$cachedSelectors.seatmapselectionRetryErrors.addClass(o)},showErrors:function(){this.showAndFocusError(this.$cachedSelectors.seatmapselectionErrors)},showNoMoreRetries:function(){this.showAndFocusError(this.$cachedSelectors.seatmapselectionRetryErrors)},showAndFocusError:function(e){e.toggleClass(o),this.scrollToSeatMapSelectionTop(),this.hideBubble(this.$cachedSelectors.seatmapselectionAdded)},showRetryWarning:function(e,t){this.showSection(t),this.$el.find(".seatmapselection_label_tab_"+t).attr(r,!0)},showSection:function(e){var t=this.$el.find(".aircraftmap_"+e+"_flight_section");this.openAircraftMap(t),t.prop("checked",!0),this.setStatusValue(this.$cachedSelectors.seatmapselectionWrapper,a)},hideRetryWarnings:function(){this.$cachedSelectors.seatmapselectionLabelTab.attr(r,!1)},scrollToSeatMapSelectionTop:function(){Odigeo.trigger(this.widget.id+":scrollToSeatMapSelection")},setStatusValue:function(e,t){_.isUndefined(e)||e.attr(n,t)},getStatusValue:function(e){return e.attr(n)},getItineraryDiv:function(e){return this.getItineraryDivBySection(e.get("section"))},getItineraryDivBySection:function(e){return'.seatmapselection_flight_section[data-section="'+e+'"]'},getItineraryResumeDiv:function(e){return'.seatmapselection_resume_seats[data-section="'+e.get("section")+'"]'},displayBubbleShake:function(e){e.toggleClass("odf-shake",!1),_.delay(_.bind(function(){e.toggleClass("odf-shake",!0).addClass("open")},this),5)},hideBubble:function(e){e.removeClass("open")},loadPreselectedSeats:function(){var e=this.widget.seatMapSelectionCollection.options,t=e.nTravellers*e.numberOfFlightSections;this.widget.seatMapSelectionCollection.loadPreselectedSeats(this.selectedSeatMap),t&&this.widget.seatMapSelectionCollection.length===t&&(this.closeAircraftMap(),this.openWhenLoadWidget=!1),this.renderSeatFees(),Odigeo.trigger(this.widget.name+":updateSidebarSummary",this.widget.seatMapSelectionCollection)},getProviderType:function(){var e=this.widget.options;return e.existsAmadeusFlight&&e.existsTravelFusionFlight?"xfare":e.existsAmadeusFlight?"gds":"tf"},getInformativeMessageType:function(){var e=this.widget.options,t=this.getEligibleTravellersCount();return 0<e.numInfants||this.widget.passengerCollection.passengerCountByType(c)?"INF":e.isFRSeatmap?1<t?"RY2":"RY1":1===t?"GEN1":"GEN2"},setInformative:function(e){return{type:"informative",icon:"od-infants-icon",title:e.translations.infants.title,text:e.translations.infants.text}},setWarning:function(e){var t=1<this.getEligibleTravellersCount(e)?"policy2":"policy1";return{type:"warning",icon:"od-seats-warning-icon",title:e.translations[t].title,text:e.translations[t].text}},setPositive:function(e){var t="pax2",i="together";return 1===this.getEligibleTravellersCount(e)&&(t="pax1",i="window"),{type:"positive",icon:"od-seat-"+i+"-icon",title:e.translations[t].title,text:e.translations[t].text}},setSeatMapPolicyMessage:function(){var e,t=this.widget.options;e=0<t.numInfants||this.widget.passengerCollection.passengerCountByType(c)?this.setInformative(t):t.isFRSeatmap?this.setWarning(t):this.setPositive(t),this.drawSeatMapPolicy(e)},enhanceSeatsFeeTooltip:function(){this.$cachedSelectors.seatsFeeHintContainer.length&&Odigeo.UIElements.hint.enhance(Odigeo.History.getPageNameFromFragment(),this.$cachedSelectors.seatsFeeHintContainer,{events:{tap:!0}})},cleanSeatMapPolicy:function(){return this.$cachedSelectors.seatsMessagesIcon.is(".od-seats-warning-icon, .od-seat-window-icon, .od-seat-together-icon")&&(this.$cachedSelectors.seatsMessagesIcon.removeClass("od-seats-warning-icon od-seat-window-icon od-seat-together-icon"),this.$cachedSelectors.seatsMessagesTitle.removeClass("od-seats-warning od-seats-positive")),!1},drawSeatMapPolicy:function(e){this.cleanSeatMapPolicy(),this.$cachedSelectors.seatsMessagesIcon.addClass(e.icon),this.$cachedSelectors.seatsMessagesTitle.text(e.title).addClass("od-seats-"+e.type),this.$cachedSelectors.seatsMessagesText.text(e.text)},renderFlightTabs:function(e){var t=_.template(this.$cachedSelectors.seatmapFlightTabsTemplate.html(),Odigeo.Utils.getTmplSettings());this.$cachedSelectors.seatmapFlightTabsTemplateContainer.html(t(e)),this.updateDomSelectorsToCache()},renderSummarySelection:function(e){var t=_.template(this.$cachedSelectors.seatmapSelectionSummaryTemplate.html(),Odigeo.Utils.getTmplSettings());this.$cachedSelectors.seatmapSelectionSummaryTemplateContainer.html(t(e)),this.$cachedSelectors.seatmapItineraryCities.html(e.bookingInfoData.itineraryCities),this.$cachedSelectors.seatmapItineraryDates.html(e.bookingInfoData.itineraryDates),this.toggleSelectionShowDetailsButton(!1),this.updateDomSelectorsToCache()},init:function(){this.selectedSeatMap=Odigeo.Utils.parseJson(Odigeo.Session.storage.getItem("seatSelection_"+this.widget.options.bookingId))||[],this.enhanceSeatsFeeTooltip(),_.isEmpty(this.selectedSeatMap)||Odigeo.Session.set("trackABSeatsInSession",!0)},hideLoadingSeatMap:_.once(function(){this.$cachedSelectors.seatmapSpinner.remove(),this.widget.initializeSeatView.call(this,this.model.getSeatsStatus())&&this.$cachedSelectors.seatmapselectionWrapper.removeClass(o)})})},function(e,t,i){"use strict";var n=i(622);e.exports=n.extend({events:_.extend({"click @insuranceDescriptionFullToggleButton":"onCoverageClickHandler"},n.prototype.events),selectors:_.extend({insuranceDescriptionFull:".insurance_description_full",insuranceDescriptionFullToggleButton:".insurance_full_coverage_link",insuranceItemPopup:".insurance_item_popup"},n.prototype.selectors),postRender:function(){n.prototype.postRender.apply(this,arguments),_.each(this.$cachedSelectors.insuranceItemPopup,this.enhanceHintPopup,this)}})},function(e,t,i){"use strict";var n=i(358),a=i(622);e.exports=a.extend({modalTemplateName:"modals/modalDesktop",selectors:_.extend({insuranceItemPopup:".insurance_item_popup"},a.prototype.selectors),postRender:function(){a.prototype.postRender.apply(this,arguments),_.each(this.$cachedSelectors.insuranceItemPopup,this.enhanceHintPopup,this)},onNagRejected:function(e){e===n.NAG_TYPE.reject||e===n.NAG_TYPE.confirmation?this.model.selectProduct(!1,this.model.getRejectedPolicy()):e===n.NAG_TYPE.continuance&&(_.isNull(this.model.getAddedPolicy())&&this.model.selectProduct(!1,this.model.getRejectedPolicy()),Odigeo.trigger(this.widget.name+":onContinuanceNagRejected"))}})},function(e,t,i){"use strict";var n=i(51);e.exports={onPassengerPageComplete:function(e,t,i,a){return e.errors?n.scrollToFirstError(a):"buyer-email-on-top"===e.widgetId?i.buyer=e.data:(i[e.widgetId]=i[e.widgetId]||{},_.extend(i[e.widgetId],e.data)),{hasErrors:!!e.errors,widgetData:i}},validatePassengersManager:function(e){_.each(e,function(e){Odigeo.requireWidget($(e).data("id"),$(e).data("widget"),function(e){e.execute("validate")})})},getBuyerInfoDto:function(e){var t=void 0;return _.each(e,function(e){Odigeo.requireWidget($(e).data("id"),$(e).data("widget"),function(e){t=e.get("getBuyerDTO")})}),t}}},function(e,t,i){"use strict";var n={},a=_.throttle(function(e,t){var i=e.offset().top;n[t]=e.hasClass("od-sticky-seats-left")?n[t]:i,e.toggleClass("od-sticky-seats-left",$(window).scrollTop()>n[t])},100,{trailing:!0,leading:!0});e.exports={stickyTopSeats:function(e,t){Odigeo.addScrollListener({name:t,fn:_.bind(a,this,e,t),pageName:Odigeo.History.getPageNameFromFragment()})}}},,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,,function(e,t,i){"use strict";i(699),i(937),i(702),i(488),i(176),i(703),i(182),i(184),i(356),i(489),i(1115),i(724),i(733),i(725),i(735),i(736),i(495),i(738),i(199),i(739),i(1116),i(208),i(742),i(209),i(593),i(744),i(957),i(959),i(962),i(1119),i(601),i(213),i(1122),i(1123),i(1124),i(1125),i(757),i(497),i(595),i(766),i(745),i(1128),i(1130),i(752),i(753),i(1132),i(1133),i(338),i(340),i(765),i(565),i(599),i(600),i(1136),i(1139),i(731),i(337),i(952),i(950),i(953),i(938),i(939),i(940),i(951),i(941),i(948),i(943),i(334),i(942),i(1140),i(954),i(350),i(1141),i(1142),i(721),i(770),i(1151),i(921),i(304),i(949),i(965),i(604),i(605),i(1154),i(1158),i(1160),i(1162),i(310),i(312),i(313),i(314),i(1163),i(1164),i(1166),i(1167),i(1168),i(1169),i(1170),i(1171),i(1172),i(1173),i(1174),i(1175),i(1176),i(1177),i(1178),i(1179),i(364)(i(936)),i(607)},function(e,t,i){"use strict";var n=i(0);Odigeo.defineWidget("get_your_guide",Odigeo.Widget.extend({viewClass:Odigeo.View.extend({events:{"tap @allActivitiesButton":"onTapAllActivitiesButton","tap @activitiesContainer":"onTapOneActivity"},selectors:{allActivitiesButton:".all_activities_btn",activitiesContainer:".activities_container a"},init:function(){this.options=Odigeo.parseOptions(this.widget.options),this.initTemplate(),Odigeo.require(["getYourGuide"],_.bind(function(e){e.Widget(document.getElementById("gyg-widget"),{partnerId:this.options.partnerId,iata:this.options.iata,q:this.options.destinationName,numberOfItems:4,currency:Odigeo.Utils.Currency.currencyCode,localeCode:this.options.localeCode.replace("_","-"),cmp:"cfmpage"})},this))},initTemplate:function(){this.$el.find(".get_your_guide_wrapper").append($(this.templates.getYourGuide({titleText:Odigeo.Utils.replaceCmsKeyArgs(this.keys.titleText,this.options.destinationName),buttonText:Odigeo.Utils.replaceCmsKeyArgs(this.keys.buttonText,this.options.destinationName),url:this.buildUrl()})))},onTapOneActivity:function(){n.trackEvent("activities_confirmation","activity_1")},onTapAllActivitiesButton:function(){n.trackEvent("activities_confirmation","activity_all")},buildUrl:function(){return this.options.domain+"s/?"+$.param({partner_id:this.options.partnerId,q:this.options.destinationName,iata:this.options.iata,currency:Odigeo.Utils.Currency.currencyCode,cmp:"cfmpage-viewmore"})}})}))},function(e,t,i){"use strict";Odigeo.defineWidget("membership_smooth_subscription",Odigeo.Widget.extend({modelClass:i(1117),viewClass:i(1118),init:function(){this.listenTo(this.view,"updateProduct",this.updateProduct)},getRequestData:function(){return this.view.trackContinueToPayment(),this.model.getRequestData()},getGroup:function(){return this.model.getGroup()},loginDone:function(e){this.model.set({isUserLoggedIn:!0,userDTO:e}),this.view.setContentKeys(),this.view.loadLoginTemplate(e)},logoutDone:function(){this.model.set("isUserLoggedIn",!1),this.view.setContentKeys()},registerError:function(){this.view.registerError()},registerOk:function(){this.view.registerSuccess()},registerWithError:function(){this.view.registerError()},updateProduct:function(e){this.model.updateProduct(e)},validate:function(){this.view.validate()},closePCIErrorPopup:function(){this.view.onClosePCIErrorPopup()},scrollAndHighlightPrimeButton:function(){this.view.scrollAndHighlightPrimeButton()},scrollAndSelectPrime:function(e){this.view.scrollAndSelectPrime(e)},renderCaptcha:function(){this.view.renderCaptcha()},updateScenario:function(e){this.view.updateScenario(e)},isMembershipSelected:function(){return this.model.get("isMembershipSelected")}}))},function(e,t,i){"use strict";var n=i(94);e.exports=Odigeo.Model.extend(n.extend({dataUrl:"getsubscriptionoffer",defaults:{allPrice:0,allPriceFromBackend:0,onePrice:0,onePriceFromBackend:0,quantity:0,conceptKey:"membershipsubscription",conceptLabel:"",type:"MEMBERSHIP_SUBSCRIPTION",defaultTransitionTime:800,userDTO:null,isUserLoggedIn:!1,isPriceWithoutDiscountSelected:!1,callbackData:null,recaptchaWidgetID:null,smoothSubscriptionIndicatorOpened:!1,membershipDiscount:null,membershipSubscriptionPrice:null,state:"",groupVariation:"",isMembershipSelected:!1},url:function(){return Odigeo.Settings.getProperty("membershipServiceFormatter")(this.dataUrl)},init:function(){this.fetchProductPrice()},buildPriceFromOffer:function(e){return{onePriceFromBackend:+e.price,allPriceFromBackend:+e.price,formattedPrice:Odigeo.Utils.formatCurrency(e.price,_.extend({},Odigeo.Utils.Currency,{decimalPlaces:2}))}},fetchProductPrice:function(){this.fetch({dataType:"json",contentType:"application/json",type:"GET",success:_.flowRight(_.bind(this.set,this),this.propagate(this.widget.id),this.buildPriceFromOffer,this.getOfferFromResponse)})},getOfferFromResponse:function(e,t){var i=_.get(t,"membershipSubscriptionOfferDTO");return _.isObject(i)&&_.isEmpty(t.errors)?i:{price:0}},getOldProductRequest:function(){return Odigeo.Utils.parseJson(Odigeo.Session.get("membershipProductPreviousRequest"))},getRequestData:function(){var e=this.get("callbackData");return{email:_.isEmpty(e)?null:e.email,password:_.isEmpty(e)?null:e.password,quantity:this.get("quantity")}},isProductStoredInSession:function(){var e=this.getOldProductRequest();return!_.isEmpty(e)&&0<e.quantity},isRemoveAction:function(e){return"remove"===e},onQuantityChange:function(e){this.addItemToPricemanagerCollection(e.attributes),Odigeo.trigger(this.widget.id+":membershipSubscriptionChange",e.attributes)},propagate:function(e){return function(t){return Odigeo.trigger(e+":membershipSubscriptionStored",t.formattedPrice),t}},getGroup:function(){return this.get("groupVariation")},updateProduct:function(e){this.set({quantity:this.isRemoveAction(e)?0:1,allPrice:this.isRemoveAction(e)?0:this.get("allPriceFromBackend"),onePrice:this.isRemoveAction(e)?0:this.get("onePriceFromBackend")}),this.onQuantityChange(this)}}))},function(e,t,i){"use strict";var n=i(81),a=i(39),s=i(50).isUserDTOMember,r=i(0),o=new Odigeo.Enum(["MAIL_VALIDATOR","SECOND_EMAIL_VALIDATOR"]);e.exports=Odigeo.View.extend({slctrs:{allInputs:'[data-name]:not([type="hidden"])',createAccount:".smooth_subscribe_button",smoothInputContainer:".smooth_input_container",smoothError:".smooth_error",smoothEmail:".smooth_email",smoothEmailContainer:".smooth_email_container",smoothEmailError:".smooth_email_error",smoothEmailConfirm:".smooth_email_confirm",smoothEmailConfirmContainer:".smooth_email_confirm_container",smoothEmailConfirmError:".smooth_email_confirm_error",smoothPassword:".smooth_password",smoothPasswordContainer:".smooth_password_container",smoothPasswordError:".smooth_password_error",smoothModifySubscription:".smooth_modify_subscription",smoothLoader:".smooth_loader",passwordViewerIcon:".password_viewer_icon",boxContent:".box_content",smoothPCIErrorPopup:".smooth_pci_error_popup",errorPopupLoginLink:".error_popup_login_link"},events:{"tap .smooth_delete_subscription":"onSmoothDeleteSubscription","tap .smooth_classic_button":"onSmoothClassicButtonClick","tap .smooth_subscribe_button":"onSmoothSubscribeButtonClick","tap .smooth_information":"onMembershipPerksLink","tap .delete_membership":"onDeleteMembership","tap .smooth_modify_subscription":"onSmoothModifySubscription","tap .smooth_pci_error_close":"onClosePCIErrorPopup","tap .error_popup_login_link":"onLoginLink","tap .password_icon":"onPasswordIconClick","tap .terms_and_conditions":"onTermsAndConditionsClick"},init:function(){this.options=Odigeo.Utils.parseOptions(this.widget.options);var e,t=this.options,i=t.isPriceWithoutDiscountSelected,n=t.membershipSubscriptionPriceNumber,a=t.membershipDiscountNumber;e=a+n<0?"2":a+n/2<0?"3":"4",this.model.set({isPriceWithoutDiscountSelected:i,groupVariation:e}),this.setContentKeys(),this.chooseTemplate()},setContentKeys:function(){var e=Odigeo.Session.get("displayName"),t=this.keys,i=t.primeSmoothSubscriptionHeaderTitle,n=t.primeSmoothSubscriptionClassicTitle,a=t.primeSmoothSubscriptionLoggedPrimeSelectedTitle,s=t.primeSmoothSubscriptionLoggedPrimeNotSelectedTitle,r=t.primeSmoothSubscriptionAddedLoggedTitle,o=this.options,c=o.membershipSubscriptionPrice,d=o.membershipDiscount;this.keys.cms={primeSmoothSubscriptionHeaderTitle:Odigeo.Utils.replaceCmsKeyArgs(i,c),primeSmoothSubscriptionClassicTitle:Odigeo.Utils.replaceCmsKeyArgs(n,d),primeSmoothSubscriptionLoggedPrimeSelectedTitle:Odigeo.Utils.replaceCmsKeyArgs(a,e),primeSmoothSubscriptionLoggedPrimeNotSelectedTitle:Odigeo.Utils.replaceCmsKeyArgs(s,e,d),primeSmoothSubscriptionAddedLoggedTitle:Odigeo.Utils.replaceCmsKeyArgs(r,e)}},renderAddedTemplate:function(){var e=this.model.get("callbackData"),t=this.model.get("userDTO"),i={email:_.isEmpty(t)?_.isEmpty(e)?"":e.email:t.email,isUserLoggedIn:this.model.get("isUserLoggedIn")};this.setTemplate(this.$el,"smoothSubscriptionAdded",i),this.launchShowEmailEvent(!1),this.showPassengerIndicator(!0),this.toggleLoading(!1),Odigeo.trigger(this.widget.id+":fieldsTemplateActive",!1),Odigeo.trigger(this.widget.id+":smoothSubscriptionAdded",i),this.model.set({state:this.model.get("isUserLoggedIn")?"login-added":"added",isMembershipSelected:!0})},renderClassicTemplate:function(){var e={isPrimePriceSelected:!this.model.get("isPriceWithoutDiscountSelected"),isUserLoggedIn:this.model.get("isUserLoggedIn")};this.setTemplate(this.$el,"smoothSubscriptionClassic",e),this.launchShowEmailEvent(!0),this.toggleLoading(!1),Odigeo.trigger(this.widget.id+":fieldsTemplateActive",!1)},renderClassicTemplateMemberSelected:function(){this.renderClassicTemplate(),this.showPassengerIndicator(!0)},renderClassicTemplateNotMemberSelected:function(){this.renderClassicTemplate(),this.showPassengerIndicator(!1)},renderEmptyTemplate:function(){this.setTemplate(this.$el),this.showPassengerIndicator(!1),Odigeo.trigger(this.widget.id+":fieldsTemplateActive",!1)},renderFieldsTemplate:function(){this.setTemplate(this.$el,"smoothSubscriptionFields",{recaptchaEnabled:this.options.recaptchaEnabled}),this.model.set("isPriceWithoutDiscountSelected",!1),this.initRecaptcha(),this.launchShowEmailEvent(!1),Odigeo.trigger(this.widget.id+":showPassengerIndicator"),this.showPassengerIndicator(!0),Odigeo.trigger(this.widget.id+":fieldsTemplateActive",!0),this.trigger("updateProduct","remove"),this.toggleLoading(!1)},initRecaptcha:function(){this.options.recaptchaEnabled&&(a.isGRecaptchaLoaded?this.renderCaptcha():a.init())},addProduct:function(){this.trigger("updateProduct"),this.renderAddedTemplate()},chooseLoginTemplate:function(){this.model.isProductStoredInSession()||0<this.model.get("quantity")?this.renderAddedTemplate():this.options.isPriceWithoutDiscountSelected?this.renderClassicTemplateNotMemberSelected():this.renderClassicTemplateMemberSelected()},chooseTemplate:function(){if(this.model.isProductStoredInSession())this.renderAddedTemplate();else{var e=this.model.get("isUserLoggedIn");this.options.isPriceWithoutDiscountSelected?(this.model.set("state",e?"login-no-prime":"no-prime"),this.renderClassicTemplateNotMemberSelected()):(this.model.set("state",e?"login-prime":"prime"),this.renderFieldsTemplate())}this.model.onQuantityChange(this.model)},enableLoadingButton:function(e){this.$el.find(this.slctrs.createAccount).toggleClass("loading",e)},launchShowEmailEvent:function(e){Odigeo.trigger(this.widget.id+":smoothShowEmail",e)},loadLoginTemplate:function(e){this.setContentKeys(),s(e)?(this.trigger("updateProduct","remove"),this.renderEmptyTemplate()):this.chooseLoginTemplate()},onDeleteMembershipAction:function(){r.trackEvent("unlocked","unlocked_remove_nag_confirm_prime_added_sce:"+this.model.get("state")),this.showLoadingWithTimer(function(){this.removePrimeMembership()})},removePrimeMembership:function(){r.trackEvent("unlocked","prime_mem_remove_prime_sce:"+this.model.get("state")),this.model.set({state:this.model.get("isUserLoggedIn")?"login-remove":"remove",isPriceWithoutDiscountSelected:!0,isMembershipSelected:!1}),this.trigger("updateProduct","remove"),this.renderClassicTemplateNotMemberSelected()},onDeleteMembershipCancel:function(){r.trackEvent("unlocked","unlocked_remove_nag_cancel_prime_added_sce:"+this.model.get("state")),this.trigger("closeAllPopUps")},onMembershipPerksLink:function(){r.trackEvent("unlocked","know_more_clicked_pax_sce:"+this.model.get("state")),Odigeo.trigger(this.widget.id+":openMembershipPerksInfoLightbox"),Odigeo.trigger(this.widget.id+":openOrCloseMembershipDialog",!0)},onSmoothClassicButtonClick:function(){this.showLoadingWithTimer(function(){this.selectPrimeMembership()})},selectPrimeMembership:function(){if(this.model.get("isUserLoggedIn")){var e=!this.model.get("isPriceWithoutDiscountSelected");r.trackEvent("unlocked","prime_mem_select_log-no-sub_"+(e?"p":"np")),this.addProduct()}else r.trackEvent("unlocked","prime_mem_view_no-log-no-sub_pax"),this.model.set("state","no-prime-add"),this.model.set("scenario","no-log-no-sub"),this.renderFieldsTemplate()},onSmoothModifySubscription:function(){r.trackEvent("unlocked","unlocked_added_change_email"),this.showLoadingWithTimer(function(){this.renderFieldsTemplate();var e=this.model.get("callbackData");this.$el.find(this.slctrs.smoothEmail).val(e.email),this.$el.find(this.slctrs.smoothEmailConfirm).val(e.email),this.$el.find(this.slctrs.smoothPassword).val(e.password)})},onSmoothDeleteSubscription:function(){r.trackEvent("unlocked","unlocked_remove_nag_prime_added_sce:"+this.model.get("state")),Odigeo.UIElements.showLightboxWarning("od-passenger-lightbox-edit",_.bind(this.onDeleteMembershipAction,this),_.bind(this.onDeleteMembershipCancel,this),{headerTitle:this.options.lightboxTextsHeader,description:this.options.lightboxTextsDescription,primaryButton:this.options.lightboxTextsPrimary,secondaryButton:this.options.lightboxTextsSecondary})},onSmoothSubscribeButtonClick:function(){this.tryToCreateAccount()},recaptchaCallback:function(){var e=a.gRecaptchaGetResponse(this.model.get("recaptchaWidgetID"));this.model.set("callbackData",_.extend(this.model.get("callbackData"),{recaptchaResponse:e})),this.triggerRegisterRequest()},registerError:function(){this.model.unset("callbackData"),this.options.recaptchaEnabled&&a.gRecaptchaReset(this.model.get("recaptchaWidgetID")),this.showPCIErrorPopup(),this.toggleLoading(!1),this.enableLoadingButton(!1)},showPCIErrorPopup:function(){r.trackEvent("unlocked","unlocked_existing_account_sce:"+this.model.get("state")),Odigeo.trigger(this.widget.id+":smoothSubscriptionPCIErrorPopupOpened"),this.$el.find(this.slctrs.smoothPCIErrorPopup).addClass("opened"),this.$el.find(this.slctrs.smoothEmailContainer).addClass("invalid"),this.$el.find(this.slctrs.smoothEmailError).toggleClass("odf-hidden",!0)},registerSuccess:function(){this.addProduct()},renderCaptcha:function(){this.model.set("recaptchaWidgetID",a.gRecaptchaRender("g_recaptcha_smooth_membership_register",_.bind(this.recaptchaCallback,this),this.options.recaptchaSiteKey))},setCallbackData:function(){this.model.set("callbackData",{email:this.$el.find(this.slctrs.smoothEmail).val(),password:this.$el.find(this.slctrs.smoothPassword).val(),acceptsNewsletter:!1})},showPassengerIndicator:function(e){this.model.get("smoothSubscriptionIndicatorOpened")||(this.model.set("smoothSubscriptionIndicatorOpened",!0),Odigeo.trigger(this.widget.id+":showPassengerIndicator")),Odigeo.trigger(this.widget.id+":showPassengerTitleIndicator",e)},triggerRegisterRequest:function(){this.toggleLoading(!0),Odigeo.trigger(this.widget.id+":createAccount",this.model.get("callbackData"))},clearValidationErrors:function(){this.$el.find(this.slctrs.smoothInputContainer).removeClass("invalid"),this.$el.find(this.slctrs.smoothError).removeClass("invalid"),this.$el.find(this.slctrs.createAccount).removeClass("focus-error"),_.each(this.$el.find(".validation_field.invalid"),function(e){$(e).removeClass("invalid")},this)},showErrors:function(e){_.each(e,function(e){var t,i,a,s,r;t=e,a=(i=this.$widget.find("[data-name="+t.index+"]")).data(t.key),s=i.closest(".input_wrapper"),r=i.closest(".validation_field"),n.showError(a,s),r.addClass("invalid")},this)},codeError:function(e,t,i){return{index:i,key:t?"empty":"invalid"}},isEmptyMail:function(e,t){return e===o.MAIL_VALIDATOR&&_.isEmpty(t)},isNotValidMail:function(e,t){return e===o.MAIL_VALIDATOR&&!_.isEmpty(t)&&!Odigeo.Utils.isValidEmail(t)},isNotSecondMail:function(e,t){var i=!_.isEmpty(t)&&this.$el.find(this.slctrs.smoothEmail).val()!==t;return e===o.SECOND_EMAIL_VALIDATOR&&(_.isEmpty(t)||i)},isMailValidationError:function(e,t){return this.isEmptyMail(e,t)||this.isNotValidMail(e,t)||this.isNotSecondMail(e,t)},checkValidityOne:function(e,t){var i=[],a=$(t).val(),s=$(t).data().validationType;return this.isMailValidationError(s,a)?i=this.codeError(i,this.isEmptyMail(s,a),$(t).data().name):s!==o.MAIL_VALIDATOR&&s!==o.SECOND_EMAIL_VALIDATOR&&(i=_.head(n._validateOneField($(t)))),_.isEmpty(i)||e.push(i),e},checkValidity:function(e){var t=_.reduce(e,this.checkValidityOne,[],this);return this.showErrors(t),t},tryToCreateAccount:function(){this.clearValidationErrors();var e=this.checkValidity(this.$el.find(this.slctrs.allInputs));_.isEmpty(e)?(this.model.set("isPriceWithoutDiscountSelected",!1),this.model.set("scenario","no-log-no-sub"),r.trackEvent("unlocked","prime_mem_select_no-log-no-sub_pax"),this.shouldCreateNewAccount()?this.initiateRegisterFlow():this.showLoadingWithTimer(function(){this.trigger("updateProduct"),this.setCallbackData(),this.renderAddedTemplate()})):_.forEach(e,_.bind(function(e){this.trackingFieldsErrors(e.index),this.$el.find(this.slctrs[e.index+"Container"]).addClass("invalid"),this.$el.find(this.slctrs[e.index+"Error"]).addClass("invalid")},this))},trackingFieldsErrors:function(e){var t;switch(e){case"smoothEmail":t="mail";break;case"smoothEmailConfirm":t="confmail";break;case"smoothPassword":t="pw";break;default:t="err"}r.trackEvent("unlocked",t+"_inline_FE_error_no-log-no-sub")},shouldCreateNewAccount:function(){var e=this.model.get("callbackData");return(e?e.email:"")!==this.$el.find(this.slctrs.smoothEmail).val()},initiateRegisterFlow:function(){this.setCallbackData(),this.enableLoadingButton(!0),this.options.recaptchaEnabled?a.gRecaptchaExecute(this.model.get("recaptchaWidgetID")):this.triggerRegisterRequest()},validate:function(){var e,t={},i=this.model.get("callbackData");this.validateAllFields()?_.isEmpty(i)||(e=i.email,t.mail=e,t.validationMail=e):t.errors=!0,Odigeo.trigger(this.widget.id+":validationComplete",t)},validateAllFields:function(){return _.isEmpty(this.checkValidity(this.$el.find(this.slctrs.allInputs)))},onPasswordIconClick:function(){var e=this.$el.find(this.slctrs.smoothPassword);this.$el.find(this.slctrs.passwordViewerIcon).toggleClass("odf-hidden");var t="password"===e.attr("type")?"text":"password";e.attr("type",t)},toggleLoading:function(e){this.$el.find(this.slctrs.boxContent).toggleClass("od-smooth-opacity-layer",e),this.$el.find(this.slctrs.smoothLoader).toggleClass("odf-hidden",!e)},showLoadingWithTimer:function(e,t){this.toggleLoading(!0),Odigeo.trigger(this.widget.id+":simulatePriceLoading"),setTimeout(_.bind(e,this),t||this.model.get("defaultTransitionTime"))},onClosePCIErrorPopup:function(){r.trackEvent("unlocked","unlocked_existing_account_close_sce:"+this.model.get("state")),this.$el.find(this.slctrs.smoothPCIErrorPopup).removeClass("opened"),this.$el.find(this.slctrs.smoothEmailContainer).removeClass("invalid")},onLoginLink:function(){r.trackEvent("unlocked","unlocked_go_to_login_sce:"+this.model.get("state")),Odigeo.trigger(this.widget.id+":openLoginForm")},scrollAndHighlightPrimeButton:function(){r.trackEvent("unlocked","continue_wo_confirm_prime_error_no-log-no-sub"),this.$el.find(this.slctrs.createAccount).addClass("focus-error"),Odigeo.Utils.scrollToElement(this.$el.find(this.slctrs.boxContent))},scrollAndSelectPrime:function(e){Odigeo.Utils.scrollToElement(this.$el.find(this.slctrs.boxContent)),this.showLoadingWithTimer(function(){this.renderFieldsTemplate(),this.$el.find(this.slctrs.smoothEmail).val(e),this.$el.find(this.slctrs.smoothEmailConfirm).val(e)},1e3)},onTermsAndConditionsClick:function(){r.trackEvent("unlocked","unlocked_terms_and_conditions_sce:"+this.model.get("state"))},trackContinueToPayment:function(){if(!this.options.isPriceWithoutDiscountSelected){var e=this.model.get("userDTO");_.isEmpty(this.model.get("scenario"))&&!_.isEmpty(e)&&this.updateScenario({status:s(e)?"PREMIUM":e.source}),r.trackEvent("unlocked","prime_mem_continue_:"+this.model.get("scenario"))}},updateScenario:function(e){if(_.isEmpty(this.model.get("scenario"))){_.isEmpty(e)||this.model.set("member",e);var t=this.model.get("member"),i={NOT_REGISTERED:"no-log-no-sub",REGISTERED:"no-log-no-sub-upg",LOGGED:"log-no-sub"},n=t.isLogged?i.LOGGED:i[t.status];this.model.set("scenario",n)}}})},function(e,t,i){"use strict";Odigeo.defineWidget("trip_summary_total_price",Odigeo.Widget.extend({viewClass:i(1120),modelClass:i(1121)}))},function(e,t,i){"use strict";var n=i(0);e.exports=Odigeo.View.extend({selectors:{totalPrice:".total_price",totalPricePax:".pax_price",hintPopup:".hint_free_cancellation_trigger_button",cancellationPopup:".cancellation_popup"},events:{"tap @hintPopup":"openedPopUp"},openedPopUp:function(e){this.$cachedSelectors.cancellationPopup.toggleClass("opened"),e.stopPropagation(),this.$cachedSelectors.cancellationPopup.hasClass("opened")?(this.listenTo(Odigeo.Events.fake,"fake:blur",this.openedPopUp),n.trackEvent("free_cancelation_message","price_guaranty_more_info")):this.stopListening(Odigeo.Events.fake,"fake:blur")},paintPrices:function(e,t){this.$cachedSelectors.totalPrice.html(e),this.$cachedSelectors.totalPricePax.html(t)},init:function(){this.listenTo(this.model,"updateTotalPrices",this.paintPrices)}})},function(e,t,i){"use strict";var n=i(52);e.exports=Odigeo.Model.extend(n.extend({init:function(){this.bindPriceCollection(),this.on("priceCollection.repaintPrices",this.updatePrices)},updatePrices:function(){this.trigger("updateTotalPrices",this.getFinalPrice(),this.getPricePerPassenger())}}))},function(e,t,i){"use strict";Odigeo.defineWidget("security_cta_message",Odigeo.Widget.extend({viewClass:Odigeo.View.extend({init:function(){this.widget.options=Odigeo.Utils.parseOptions(this.widget.options),this.$el.html(this.templates.ctaSecurityMsg({title:"ancillaries"===this.widget.options.page?this.keys.ancillariesTitle:this.keys.paxTitle,benefit1:"ancillaries"===this.widget.options.page?this.keys.ancillariesBenefit1:this.keys.paxBenefit1,benefit2:"ancillaries"===this.widget.options.page?this.keys.ancillariesBenefit2:this.keys.paxBenefit2}))}})}))},function(e,t,i){"use strict";var n=i(972);Odigeo.defineWidget("seatmap_desktop",Odigeo.Widget.extend(n.extend({viewClass:i(973),retries:0,exposedMethods:{onCloseAircraftMap:"closeAircraftMap",onHideErrors:"hideErrors",onScrollToSeatMapSelectionTop:"scrollToSeatMapSelectionTop",onSeatMapSelectionRetryError:"seatMapSelectionRetryError",onShowErrors:"showErrors",onTapNavigateButton:"navigateToAircraft",updateSelectedSeats:"updateSelectedSeats",updateSeatSelectionFees:"updateSeatSelectionFees",resetSeatmapSelection:"resetSeatmapSelection",onWindowResize:"checkTabSlider",loadFromParameters:"loadFromParameters"},updateViewWithSelections:function(){this.view.updateView(),this.view.loadPreselectedSeats()},sendResponsePassengerCollectionIsOk:function(){Odigeo.trigger(this.id+":passengerCollectionIsPopulated")},checkTabSlider:function(){this.view.checkTabSlider()},updatePassengers:function(){this.passengerCollection.updatePassengersManager()},disablePristineMoveThrough:function(){Odigeo.trigger(this.id+":disablePristineMoveThrough"),this.model.set("pristineMoveThrough",!1)},navigateToAircraft:function(e,t,i){var n=this.view.$cachedSelectors.seatmapselectionWrapper.find(this.view.getItineraryDivBySection(e.section)),a="next"===t?n.next():n.prev(),s=parseInt(a.attr("data-section"),10),r=parseInt(a.attr("data-segment"),10),o=this.sectionHasSeatMap(this.model.widget.getSeatMap(r,s))?"1":"0";this.analyticsEventTracking({label:"seats_gds_"+t+"_flight_"+o}),this.view["next"===t?"openNextAircraft":"openPrevAircraft"](e,this.setupAircraftMapOptions(i))},setupAircraftMapOptions:function(e){return this.setLastSeatSelected(e),_.assign(e,{lastSeatSelectionType:this.model.get("lastSeatSelectedType")})},setLastSeatSelected:function(e){!_.isEmpty(e)&&e.lastSeatSelectionType&&this.model.set("lastSeatSelectedType",e.lastSeatSelectionType)},updateSeatSelectionFees:function(){this.view.renderSeatFees()},resetSeatmapSelection:function(){this.view.resetSeatmapSelection()},closeAircraftMap:function(){this.view.closeAircraftMap()},sectionHasSeatMap:function(e){return!_.isEmpty(e)&&this.cabinHasSeatMap(e.cabin)},cabinHasSeatMap:function(e){var t=_.find(e,function(e){return!_.isEmpty(e.seats)&&0<_.size(e.seats.seat)});return!_.isEmpty(t)},manageNumMaxErrors:function(e){_.each(e,function(e){this.seatMapSelectionCollection.removeSelection(this.seatMapSelectionCollection.getFlightSeats(null,e.section)),this.view.showRetryWarning(null,e.section),this.desactivateItinerary(e)},this)},desactivateItinerary:function(e){var t=this.descriptorsScheme.attributes,i=e.segment,n=_.find(t,{segment:i}),a=_.isUndefined(n)?-1:_.indexOf(t[i].seatMap,_.find(n.seatMap,{section:e.section}));-1!==a&&(this.descriptorsScheme.attributes[i].seatMap[a]={})},scrollToSeatMapSelectionTop:function(){this.view.scrollToSeatMapSelectionTop()},getItineratyInfoFormatted:function(e,t,i){return{itineraryCities:e.departure.cityName+" - "+e.arrival.cityName,itineraryDates:Odigeo.Utils.formatDate(t,"dayMonth")+" - "+Odigeo.Utils.formatDate(i,"dayMonth")}},parseBookingInfo:function(e){var t=e.itineraryBookings.itinerarySegments,i="MULTIPLE_DESTINATIONS"===e.itineraryBookings.bookingItinerary.tripType,n=_.size(e.travellers),a=t[0].sections[0].section.departureDate,s=t[t.length-1].sections[0].section.departureDate,r=this.getItineratyInfoFormatted(e.itineraryBookings.bookingItinerary,a,s);return{segments:t=_.map(t,function(e,t){return{id:t,segmentNumber:t+1,isOutbound:0===t,sections:_.map(e.sections,function(e,t){return{id:_.parseInt(e.id),sectionNumber:t+1,numTravellers:n,departureDate:e.section.departureDate,departureDateFormatted:Odigeo.Utils.formatDate(e.section.departureDate,"ddd, mmm dd yyyy"),arrivalDate:e.section.arrivalDate,departureCityName:e.section.from.cityName,departureCityIataCode:e.section.from.cityIataCode,arrivalCityName:e.section.to.cityName,arrivalCityIataCode:e.section.to.cityIataCode,carrierCode:e.section.carrier.code}})}}),isMultiDestination:i,numTravellers:n,firstDepartureDate:a,lastDepartureDate:s,longHaul:e.longHaul,pristineMoveThrough:!0,hasFlightDetails:!0,itineraryInfoFormatted:r}},sortSeatmapResults:function(e){return _.map(_.sortBy(e,function(e){return[e.segment]}),function(e){return _.assign({segment:e.segment,seatMapPreferencesDescriptorItemList:_.sortBy(e.seatMapPreferencesDescriptorItemList,function(e){return[e.section]})})})},parseAncillaryInfo:function(e){var t=this.sortSeatmapResults(e.ancillaryOptionsContainer.seatMapResultsResponse);return _.map(t,function(e){var t=_.map(e.seatMapPreferencesDescriptorItemList,function(e){var t=_.map(e.cabin,function(e){var t=e.seatMapRowsCharacteristics,i=_.isEmpty(t.exitRows)?null:t.exitRows.join(" "),n=_.isEmpty(t.extraLegSeats)?null:t.extraLegSeats.join(" "),a=[t.overWingsFromRow,t.overWingsToRow].join("-"),s={columnDistribution:t.cabinColumnDistribution,exitRows:i,extraLegSeats:n,overWingsRows:a},r=_.map(e.seats,function(e){return{seatCharacteristics:{characteristic:_.map(e.characteristics,"seatCharacteristic")},totalPrice:e.totalPrice.amount,providerPrice:e.providerPrice.amount,currencyCode:e.providerPrice.currencyCode,floor:e.seatLocation.floor,column:e.seatLocation.column,seatMapRow:e.seatLocation.seatMapRow,seatRow:e.seatLocation.seatRow,type:e.seatType.seatType}});return{floor:e.cabinFloor,firstSeatsRow:e.firstSeatsRow,lastSeatsRow:e.lastSeatsRow,seatMapRowFrom:e.seatMapRowFrom,seatMapRowTo:e.seatMapRowTo,cabinCharacteristics:s,seats:{seat:r}}});return{section:_.parseInt(e.section),cabin:t}});return{segment:e.segment,seatMap:t}})},setupSeatMapInfo:function(e,t){var i,n,a,s,r=[],o=!0,c=!1,d=["EK","TK"],l=void 0,g=void 0,h=!1,u=Odigeo.AB.isDisabledRetriesMobile,p=Odigeo.AB.isSeatMapCtaImproved,f=Odigeo.WebsiteConfig.seatMapSelectionSettings.seatMapMaxNumberOfRetries,m="default",b=0;return _.each(e.segments,function(i){var n,a=_.size(i.sections);e.isMultiDestination?i.typeOfFlight=t["segment"+i.segmentNumber]:(n=i.isOutbound?"outboundTitle":"inboundTitle",i.typeOfFlight=Odigeo.Utils.replaceCmsKeyArgs(t[n])),_.each(i.sections,function(n){var s,u;n.id=b,n.aircraftmapId=["aircraftmap",i.id,n.id].join("_"),n.flightSection=[n.departureCityName,n.arrivalCityName].join(" - "),s=Odigeo.Utils.replaceCmsKeyArgs(t.flightIndex,n.sectionNumber,a),u=i.isOutbound?"flightDeparture":"flightReturn",n.flightSectionDetail=e.isMultiDestination?i.typeOfFlight:t[u],1<a&&(n.flightSectionDetail=[n.flightSectionDetail,s].join(" ")),n.iconClass="odf-icon-flight-"+(e.isMultiDestination||i.isOutbound?"right":"left"),"TF"===n.providerCode&&(c=!0),_.includes(d,n.carrierCode)&&(h=!0),r.push({segment:i,section:n}),b+=1,o&&(l=i,g=n,o=!1)})}),n=u&&h?0:f,i=r.length,a=_.chain(r).map(function(e,n){var a,s,o=0===n,c=n===i-1;return e.prevSectionText="",e.nextSectionText="",o||(a=r[n-1],e.prevSegment=a.segment,e.prevSection=a.section,e.prevSegmentId=e.prevSegment.id,e.prevSectionId=e.prevSection.id,e.prevSectionText=[e.prevSection.departureCityIataCode,e.prevSection.arrivalCityIataCode].join(" > "),e.prevSectionTextItinerary=[e.prevSection.departureCityName,e.prevSection.arrivalCityName].join(" - ")),c||(s=r[n+1],e.nextSegment=s.segment,e.nextSection=s.section,e.nextSegmentId=s.segment.id,e.nextSectionId=s.section.id,e.nextSectionText=[s.section.departureCityIataCode,s.section.arrivalCityIataCode].join(" > "),e.nextSectionTextItinerary=[s.section.departureCityName,s.section.arrivalCityName].join(" - "),e.nextSectionDepartureDate=Odigeo.Utils.formatDate(s.section.departureDate)),e.isFirstItinerarySection=o,e.isLastItinerarySection=c,e.flightSection=e.section.flightSection,e.flightSectionDetail=e.section.flightSectionDetail,e.defaultPassengerSelectString=t.selectText,e.nTravellers=e.section.numTravellers,e}).reduce(function(e,t){return e[[t.segment.id,t.section.id].join("-")]=t,e},{}).value(),p?1<e.numTravellers?(s="scn4",m="paxs"):s="scn5":1<e.numTravellers?(s="scn4",m="paxs"):s=e.longHaul?"scn3":Odigeo.Utils.formatDate(e.firstDepartureDate)===Odigeo.Utils.formatDate(e.lastDepartureDate)?"scn2":"scn1",{aircraftMapInfo:a,segments:e.segments,firstSegment:l,firstSection:g,existsTravelFusionFlight:c,isSeatMapCtaImproved:p,maxRetries:n,scenario:s,scenarioName:m,pristineMoveThrough:!0,hasFlightDetails:!0}},setupPassengersInfo:function(e){return _.map(e,function(e,t){return{index:t,numPassenger:e.travellerNumber,name:e.name,defaultName:"",firstLastName:e.firstLastName,shortName:"",defaultShortName:"P",travellerType:e.travellerType}})},minTotalPriceSeat:function(e){var t=void 0;return e=_.chain(e).reject({seatType:"NO_SEAT"}).filter("totalPrice").value(),_.each(e,function(e){_.isUndefined(t)&&(t=e),e.totalPrice<t.totalPrice&&(t=e)}),t},setupSeatMapPreferencesDescriptors:function(e,t){var i,n={},a=[],s=this.minTotalPriceSeat,r=0;return _.each(e,function(e){_.each(e.seatMap,function(i){var o,c,d,l=[e.segment,i.section].join("-"),g=[];_.each(i.cabin,function(e){_.isUndefined(e.seats)||_.isEmpty(e.seats.seat)||g.push(e.seats.seat)}),r=i.section,g=_.flatten(g),o=s(g),d=c=0,_.isUndefined(o)||(a.push(o),c=o.totalPrice,d=o.totalPrice-o.providerPrice),n[l]={isSelectable:!_.isEmpty(g),hasExceededMaxRetries:!1,hasSeatsForAllTravellers:_.size(g)>=t.numTravellers,seatMap:i,minPrice:c,minFee:d}})}),i=s(a),{minPrice:_.isUndefined(i)?0:i.totalPrice,maxPriceFee:this.maxPriceFee(a),seatMapInfo:n,seatMapPreferencesDescriptors:e,pristineMoveThrough:!0,hasSeatMapInfo:!0,lastSectionId:r}},maxPriceFee:function(e){var t=0;return _.each(e,function(e){var i=e.totalPrice-e.providerPrice;t<i&&(t=i)}),t},loadFromParameters:function(e,t){var i=this.parseBookingInfo(e),n=this.parseAncillaryInfo(t),a={attributes:n},s={numTravellers:_.size(e.travellers)},r=_.assign({showPrice:!1,showTitle:!1,isMultiDestination:i.isMultiDestination},this.setupSeatMapInfo(i,this.view.keys),this.setupSeatMapPreferencesDescriptors(n,s));this.passengerCollection.reset(this.setupPassengersInfo(t.travellers)),Odigeo.trigger(this.id+":checkPassengerCollectionPopulated"),this.model.set(r),this.view.renderSummarySelection(_.assign(r,{translations:this.options.translations,bookingInfoData:i.itineraryInfoFormatted})),this.view.renderFlightTabs(r),this.view.toggleSeatSelectionDetails(!1),this.setDescriptorsScheme(a),this.setPreferredSeatsThresholds(a),this.resetSeatmapSelection(),this.view.activeButton(),this.view.autoOpenAircraft()}})))},function(e,t,i){"use strict";$(function(){var e=i(972);Odigeo.defineWidget("seatmap_selection_manager",Odigeo.Widget.extend(e.extend({viewClass:i(973),retries:0,exposedMethods:{onCloseAircraftMap:"closeAircraftMap",onHideErrors:"hideErrors",onScrollToSeatMapSelectionTop:"scrollToSeatMapSelectionTop",onSeatMapSelectionRetryError:"seatMapSelectionRetryError",onShowErrors:"showErrors",onTapNavigateButton:"navigateToAircraft",updateSelectedSeats:"updateSelectedSeats",updateSeatSelectionFees:"updateSeatSelectionFees",resetSeatmapSelection:"resetSeatmapSelection",onWindowResize:"checkTabSlider"},updateViewWithSelections:function(){this.view.updateView(),this.view.loadPreselectedSeats()},sendResponsePassengerCollectionIsOk:function(){Odigeo.trigger(this.id+":passengerCollectionIsPopulated")},checkTabSlider:function(){this.view.checkTabSlider()},updatePassengers:function(){this.passengerCollection.updatePassengersManager()},disablePristineMoveThrough:function(){Odigeo.trigger(this.id+":disablePristineMoveThrough"),this.model.set("pristineMoveThrough",!1)},navigateToAircraft:function(e,t,i){var n=this.view.$cachedSelectors.seatmapselectionWrapper.find(this.view.getItineraryDivBySection(e.section)),a="next"===t?n.next():n.prev(),s=parseInt(a.attr("data-section"),10),r=parseInt(a.attr("data-segment"),10),o=this.sectionHasSeatMap(this.model.widget.getSeatMap(r,s))?"1":"0";this.analyticsEventTracking({label:"seats_gds_"+t+"_flight_"+o}),this.view["next"===t?"openNextAircraft":"openPrevAircraft"](e,this.setupAircraftMapOptions(i))},setupAircraftMapOptions:function(e){return this.setLastSeatSelected(e),_.assign(e,{lastSeatSelectionType:this.model.get("lastSeatSelectedType")})},setLastSeatSelected:function(e){!_.isEmpty(e)&&e.lastSeatSelectionType&&this.model.set("lastSeatSelectedType",e.lastSeatSelectionType)},updateSeatSelectionFees:function(){this.view.renderSeatFees()},resetSeatmapSelection:function(){this.view.resetSeatmapSelection()},closeAircraftMap:function(){this.view.closeAircraftMap()},sectionHasSeatMap:function(e){return!_.isEmpty(e)&&this.cabinHasSeatMap(e.cabin)},cabinHasSeatMap:function(e){var t=_.find(e,function(e){return!_.isEmpty(e.seats)&&0<_.size(e.seats.seat)});return!_.isEmpty(t)},manageNumMaxErrors:function(e){_.each(e,function(e){this.seatMapSelectionCollection.removeSelection(this.seatMapSelectionCollection.getFlightSeats(null,e.section)),this.view.showRetryWarning(null,e.section),this.desactivateItinerary(e)},this)},desactivateItinerary:function(e){var t=this.descriptorsScheme.attributes,i=e.segment,n=_.find(t,{segment:i}),a=_.isUndefined(n)?-1:_.indexOf(t[i].seatMap,_.find(n.seatMap,{section:e.section}));-1!==a&&(this.descriptorsScheme.attributes[i].seatMap[a]={})},scrollToSeatMapSelectionTop:function(){this.view.scrollToSeatMapSelectionTop()}})))})},function(e,t,i){"use strict";$(function(){var e=i(762);Odigeo.defineWidget("aircraftmap_manager",Odigeo.Widget.extend(e.extend({viewClass:i(1126),exposedMethods:{onOpenAircraftMap:"openAircraftMap",onTapRetainSelection:"view.onTapRetainSelection",onTapRemoveSelection:"view.onTapRemoveSelection",cancelAircraftMoveThrough:"view.cancelAircraftMoveThrough",checkPassengerCollectionPopulated:"view.checkPassengerCollectionPopulated"}})))})},function(e,t,i){"use strict";var n=i(1127),a=i(619),s={DATA_STATUS:"data-status",STATUS_AVAILABLE:"available",STATUS_UNAVAILABLE:"unavailable",STATUS_ACTIVE:"active",STATUS_INACTIVE:"inactive",STATUS_SELECTED:"selected",STATUS_VISIBLE:"visible",STATUS_HIDDEN:"hidden",STATUS_CLOSED:"closed",STATUS_NO_SEAT:"no_seat",STATUS_OUTBOUND:"outbound",STATUS_INBOUND:"inbound",STATUS_CLASS_DISABLED:"odf-text-mono-color-06",SCROLL_TOP_OFFSET:132,SCROLL_ANIMATION_DURATION:800,CMS_REGEX:"%1$s",SEAT_HEIGHT:35,SEAT_WIDTH:35,SEAT_SELECTED:!0,SEAT_UNSELECTED:!1,SEAT_HOVER_CLASS:"od-aircraftmap-seat-preview-hover",HIDDEN_CLASS:"odf-hidden",PASSENGER_TYPE_ADULT:"ADULT",PASSENGER_TYPE_CHILDREN:"CHILDREN",PASSENGER_TYPE_INFANT:"INFANT",AIRCRAFT_LOADER_TIMEOUT:1e3,AIRCRAFT_NO_SEATS_TIMEOUT:2500,ICON_PAX:"odf-icon-pax",ICON_X_LEG:"odf-icon-x-leg-room",ICON_PREFERRED:"odf-icon-crown",ICON_CHEAPER:"odf-icon-tag"};e.exports=Odigeo.View.extend({selectors:{aircraftContainer:".aircraftmap_container",aircraftmapFlightSectionText:".aircrafmap_flight_section_text",aircraftmapFlightSectionTextSmall:".aircrafmap_flight_section_text_small",aircraftmapFlightSectionType:".aircrafmap_flight_section_type",aircraftmapHeaderFlightSegment:".aircraftmap_header_flight_segment",aircraftmapMask:".aircraftmap_mask",aircraftmapMinimumPrice:".aircraftmap_textblock",aircraftmapNextSectionButton:".aircraftmap_next_button",aircraftmapNoContent:".aircraftmap_no_content",aircraftmapNoContentImage:".aircraftmap_noseatmap_image",aircraftmapPrevButton:".aircraftmap_prev_button",aircraftmapRetainButton:".aircraftmap_retainselection",aircraftmapRibbonSlider:".aircraftmap_ribbon_slider",aircraftmapSaveButton:".aircraftmap_save_selection",aircraftmapSeatAvailable:".aircraftmap_seat_available",aircraftmapUidialogOK:".aircraftmap_ui_dialog_OK",aircraftmapSectionLoader:".seatmap_section_loader",aircraftmapMoveThroughSpinner:".move_through_spinner",aircraftmapMoveThroughSuccess:".move_through_success",aircraftmapLegendPreferred:".legend_preferred_seat",aircraftmapLegendExtraLeg:".legend_extra_leg_room_seat",aircraftmapLegendStandard:".legend_standard_seat",aircraftmapLegendCheapest:".legend_cheapest_seat",aircraftmapLegendClickable:".legend_clickable_type",aircraftmapCurrentSection:".aircraft_current_section",aircraftmapWrapper:".aircraftmap_wrapper",aircraftmapPreview:".aircraftmap_seat_preview",aircraftmapPreviewImage:".aircraftmap_seat_preview_image",aircraftmapPreviewSeatType:".aircraftmap_seat_preview_type",aircraftmapPreviewSeatId:".aircraftmap_seat_preview_number",aircraftmapPreviewSeatPrice:".aircraftmap_seat_preview_price",aircraftmapPreviewSeatExtraLeg:".aircraftmap_seat_preview_extra_leg",aircraftmapPassengersTemplate:".aircraftmap_passengers_template"},events:{"tap @aircraftmapNextSectionButton":"onTapNextButton","tap @aircraftmapNoContentImage":"onTapAircraftMapNoContentImage","tap @aircraftmapPrevButton":"onTapPrevButton","tap @aircraftmapRetainButton":"onTapRetainSelection","tap @aircraftmapSaveButton":"onTapConfirmSeats","tap @aircraftmapLegendClickable":"onTapLegendSeatType","tap .aircraftmap_deleteselection":"onTapRemoveSelection","tap .aircraftmap_seat":"onTapSeat","tap .aircraftmap_user_delete":"onTapDeleteButton","mouseover .aircraftmap_seat":"onSeatHover","mouseout .aircraftmap_seat":"onSeatOut"},nTravellers:0,defaultPassengerSelectString:"",segment:"",section:"",seatMap:[],aircraftLoaderTimeout:0,buildTemplate:function(){var e={keys:{unavailable:this.options.unavailable,window:this.options.window,aisle:this.options.aisle,middle:this.options.middle,rowPrice:this.options.rowPrice,darkzoneSingleRow:this.options.darkzoneSingleRow,darkzoneMultiRow:this.options.darkzoneMultiRow},seatMap:this.seatMap,preferredSeatsThreshold:this.getSectionPreferredSeatThreshold(this.options.preferredSeatsThreshold)};return new n(e).buildTemplate()},getSectionPreferredSeatThreshold:function(e){return _.isEmpty(e)?0:e[this.section]},setUpView:function(e,t){this.options=Odigeo.Utils.parseOptions(this.widget.options),this.seatMap=e,this.nTravellers=this.options.nTravellers||_.size(this.widget.passengerCollection),this.nEligibleTravellers=this.options.nEligibleTravellers||this.getEligibleTravellersCount(),this.section=this.options.section,this.segment=this.options.segment,this.itinerarySectionsCount=this.getItinerarySectionsCount(this.itinerarySectionsCount,this.options,t),this.isMultiDestination=this.isMultidestinationAircraftMap(this.isMultiDestination,this.options,t),this.multiSegmentText=this.options.multiSegmentText.split(","),this.defaultPassengerSelectString=this.options.defaultPassengerSelectString},isMultidestinationAircraftMap:function(e,t,i){if(!_.isUndefined(t.isMultiDestination)||!_.isUndefined(i))return _.isUndefined(e)?t.isMultiDestination||_.get(i,"isMultiDestination",!1):e},getItinerarySectionsCount:function(e,t,i){if(!_.isUndefined(t.itinerarySectionsCount)||!_.isUndefined(i))return _.isUndefined(e)?t.itinerarySectionsCount||_.get(i,"itinerarySectionsCount",0):e},onTapAircraftMapNoContentImage:function(){this.widget.options.isLast?this.tapButton("prev"):this.tapButton("next")},onTapConfirmSeats:function(){0<this.widget.seatMapSelectionCollection.length?this.closeAircraftMap():Odigeo.trigger(this.widget.name+":showNoSeatsSelectedDialog"),this.widget.analyticsEventTracking({label:this.widget.seatMapSelectionCollection.getConfirmActionTrackingText()}),this.widget.analyticsEventTracking({label:this.widget.seatMapSelectionCollection.getConfirmActionTrackingButton("global")})},onTapNextButton:function(){this.isNavigationButtonEnabled(this.$cachedSelectors.aircraftmapNextSectionButton)&&(this.cancelAircraftMoveThrough(),this.tapButton("next"),Odigeo.trigger(this.widget.name+":scrollToSeatMapSelection"))},onTapPrevButton:function(){this.isNavigationButtonEnabled(this.$cachedSelectors.aircraftmapPrevButton)&&(this.cancelAircraftMoveThrough(),this.tapButton("prev"),Odigeo.trigger(this.widget.name+":scrollToSeatMapSelection"))},toggleNavigationButton:function(e,t){e.toggleClass(s.STATUS_CLASS_DISABLED,t)},isNavigationButtonEnabled:function(e){return!e.hasClass(s.STATUS_CLASS_DISABLED)},onSeatHover:function(e){var t=$(e.target);t.attr("data-type")!==s.STATUS_UNAVAILABLE&&t.attr("data-type")!==s.STATUS_NO_SEAT&&(this.fillContentPreview(t),this.$cachedSelectors.aircraftmapPreview.offset(this.getNewPositionPreview(t)),this.$cachedSelectors.aircraftmapPreview.animate({top:"-=5"},1e3),this.$cachedSelectors.aircraftmapPreview.addClass(s.SEAT_HOVER_CLASS))},onSeatOut:function(){this.closeSeatPreviewPopOver()},fillContentPreview:function(e){var t=e.attr("data-type"),i=e.attr("data-texttype"),n=e.attr("data-row"),a=e.attr("data-column"),r="true"===e.attr("data-extra-leg"),o=e.attr("data-price"),c=!r;this.$cachedSelectors.aircraftmapPreviewSeatExtraLeg.toggleClass(s.HIDDEN_CLASS,c),this.$cachedSelectors.aircraftmapPreviewImage.attr("data-img",t),this.$cachedSelectors.aircraftmapPreviewSeatType.text(i),this.$cachedSelectors.aircraftmapPreviewSeatId.text(n+a),this.$cachedSelectors.aircraftmapPreviewSeatPrice.html(o)},closeSeatPreviewPopOver:function(){this.$cachedSelectors.aircraftmapPreview.removeClass(s.SEAT_HOVER_CLASS)},getNewPositionPreview:function(e){var t=e.offset(),i=this.$cachedSelectors.aircraftmapPreview.height(),n=this.$cachedSelectors.aircraftmapPreview.width();return{top:t.top-i-s.SEAT_HEIGHT/2,left:t.left+s.SEAT_WIDTH/2-n/2}},getEligibleTravellersCount:function(){return this.widget.passengerCollection.passengerCountByType(s.PASSENGER_TYPE_ADULT)+this.widget.passengerCollection.passengerCountByType(s.PASSENGER_TYPE_CHILDREN)},tapButton:function(e,t){this.isAircraftNoContentVisible()&&this.widget.analyticsEventTracking({label:"seatmap_flight_no_results_go_to_next"}),Odigeo.trigger(this.widget.name+":tapNavigateButton",{segment:this.segment,section:this.section},e,t)},onTapLegendSeatType:function(e){var t=$(e.currentTarget).data("type");this.scrollToFirstSeatType(a.getSeatCharacteristicClassByType(t)),this.widget.analyticsEventTracking({label:"see_"+t})},scrollToFirstSeatType:function(e){var t=this.$cachedSelectors.aircraftContainer.find("."+e);t.length&&this.nativeScrollAircraftMap(t.first().offsetParent())},autoScrollAircraftMap:function(e){var t=this.$el.find('.aircraftmap_seat_available[data-status="selected"]').first(),i=this.$el.find(".aircraftmap_seat_available"),n=i.filter('[data-rawprice="'+this.options.minimumPrice+'"]'),s=a.getSeatCharacteristicClassByType(e.lastSeatSelectionType);t.length||(t=n.length?n.first():i.first()),this.options.pristineMoveThrough&&e.lastSeatSelectionType&&this.containsSeatType(s)?this.scrollToFirstSeatType(s):this.nativeScrollAircraftMap(t)},nativeScrollAircraftMap:function(e){if(e.length){var t=(a.isEmergencyExitSeat(e)?e.offsetParent():e).position().top-s.SCROLL_TOP_OFFSET;this.$cachedSelectors.aircraftmapMask.animate({scrollTop:t},s.SCROLL_ANIMATION_DURATION)}},isAircraftNoContentVisible:function(){return this.getStatusValue(this.$cachedSelectors.aircraftmapNoContent)===s.STATUS_VISIBLE},onTapRetainSelection:function(){_.size(this.widget.seatMapSelectionCollection.getFlightSeats(this.segment,this.section))===this.nTravellers&&this.closeAircraftMap(),this.widget.analyticsEventTracking({label:this.widget.seatMapSelectionCollection.getConfirmActionTrackingText()}),this.widget.analyticsEventTracking({label:this.widget.seatMapSelectionCollection.getConfirmActionTrackingButton("end")})},onTapRemoveSelection:function(){this.widget.removeAllSelection(),this.closeAircraftMap(),this.widget.analyticsEventTracking({label:"seats_gds_remove_nag_remove"}),Odigeo.trigger(this.widget.name+":updateSidebarSummary",this.widget.seatMapSelectionCollection)},onTapSeat:function(e){var t=this.$widget.find(e.target),i=this.getStatusValue(t.parent());i!==s.STATUS_AVAILABLE||this.widget.allPaxHaveSeatInSection(this.segment,this.section)?i===s.STATUS_SELECTED&&(this.removeSelectedSeat(t),this.onSeatOut(),this.trackSeatStateChanging("removed"),this.changeSeatIcon(t,s.SEAT_UNSELECTED),this.setStatusValue(t.parent(),s.STATUS_AVAILABLE),Odigeo.trigger(this.widget.name+":updateSidebarSummary",this.widget.seatMapSelectionCollection)):(this.addSelectedSeat(t),this.onSeatOut(),this.trackSeatStateChanging("selected"),this.changeSeatIcon(t,s.SEAT_SELECTED),Odigeo.trigger(this.widget.name+":updateSidebarSummary",this.widget.seatMapSelectionCollection),this.setStatusValue(t.parent(),s.STATUS_SELECTED),this.options.pristineMoveThrough&&this.moveToNextSection(t)),Odigeo.trigger(this.widget.name+":updateSeatSelectionFees")},changeSeatIcon:function(e,t){t?this.removeSpecialSeatIcon(e):this.printAvailableSeat(e)},printAvailableSeat:function(e){return this.isSpecialSeat(e)?this.addSpecialSeatIcon(e):e.removeClass(s.ICON_PAX)},isSpecialSeat:function(e){return e.hasClass(a.constants.CLASS_CHEAPER)||e.hasClass(a.constants.CLASS_X_LEG)||e.hasClass(a.constants.CLASS_PREFFERED)},removeSpecialSeatIcon:function(e){e.removeClass([s.ICON_PREFERRED,s.ICON_X_LEG,s.ICON_CHEAPER].join(" ")).addClass(s.ICON_PAX)},addSpecialSeatIcon:function(e){e.removeClass(s.ICON_PAX).addClass(this.getSpecialSeatIcon(e))},getSpecialSeatIcon:function(e){return e.hasClass(a.constants.CLASS_CHEAPER)?s.ICON_CHEAPER:e.hasClass(a.constants.CLASS_X_LEG)?s.ICON_X_LEG:s.ICON_PREFERRED},onTapDeleteButton:function(e){var t=this.$widget.find(e.target),i=t.parent().parent().attr("id"),n=t.parent().attr("data-selected-seat"),a={numPassenger:parseInt(i.charAt(i.length-1),10),section:this.section};_.isEmpty(n)||this.deselectSeat(n),this.widget.removeSelection(this.widget.seatMapSelectionCollection.getSeat(a)),Odigeo.trigger(this.widget.name+":updateSidebarSummary",this.widget.seatMapSelectionCollection),this.trackSeatStateChanging("removed")},deselectSeat:function(e){var t=this.$el.find("#aircraft_map_"+e);this.setStatusValue(t,s.STATUS_AVAILABLE),this.changeSeatIcon(t.find(".aircraftmap_seat"),s.SEAT_UNSELECTED)},trackSeatStateChanging:function(e){this.widget.analyticsEventTracking({label:"seats_gds_seat_"+e})},closeAircraftMap:function(){Odigeo.trigger(this.widget.name+":closeAircraftMap")},moveToNextSection:function(e){this.widget.allPaxHaveSeatInSection(this.segment,this.section)&&(this.options.isLast?(this.$cachedSelectors.aircraftmapMoveThroughSuccess.removeClass(s.HIDDEN_CLASS),this.$cachedSelectors.aircraftmapMoveThroughSpinner.addClass(s.HIDDEN_CLASS),this.$cachedSelectors.aircraftmapSectionLoader.addClass("fadeIn"),this.aircraftLoaderTimeout=setTimeout(_.bind(function(){this.$cachedSelectors.aircraftmapSectionLoader.removeClass("fadeIn"),this.closeAircraftMap(),this.$cachedSelectors.aircraftmapMoveThroughSuccess.toggleClass(s.HIDDEN_CLASS),this.$cachedSelectors.aircraftmapMoveThroughSpinner.toggleClass(s.HIDDEN_CLASS)},this),s.AIRCRAFT_LOADER_TIMEOUT)):this.tapButton("next",{showLoader:!0,lastSeatSelectionType:e.data().characteristic}))},setupAircraftWithLoader:function(e,t){t.pristineMoveThrough&&(this.$cachedSelectors.aircraftmapSectionLoader.addClass("fadeIn"),this.aircraftLoaderTimeout=setTimeout(_.bind(function(){this.$cachedSelectors.aircraftmapSectionLoader.removeClass("fadeIn"),this.setupAircraft(e,t)},this,e),s.AIRCRAFT_LOADER_TIMEOUT))},setupAircraft:function(e,t){this.setUpView(e,t),_.isEmpty(e)?this.desactivateItinerary(t):(this.renderPassengersTemplate(),this.renderAircraftTitle(),this.renderAircraftStructure(),this.renderSelection(),this.activateItinerary()),this.cacheDomSelectors(),this.updateCommonElements(),this.autoScrollAircraftMap(t)},openAircraftMap:function(e,t){this.closeSeatPreviewPopOver(),t.showLoader?this.setupAircraftWithLoader(e,t):this.setupAircraft(e,t)},render:function(){this.renderPassengersInfo(),this.renderSelection(),this.updateCommonElements()},desactivateItinerary:function(e){this.setStatusValue(this.$cachedSelectors.aircraftmapWrapper,s.STATUS_HIDDEN),this.setStatusValue(this.$cachedSelectors.aircraftmapNoContent,s.STATUS_VISIBLE),!e.pristineMoveThrough||this.widget.options.isFirst||this.widget.options.isLast||(this.aircraftLoaderTimeout=setTimeout(_.bind(function(){this.tapButton("next",{showLoader:!0}),this.activateItinerary()},this),s.AIRCRAFT_NO_SEATS_TIMEOUT)),this.widget.analyticsEventTracking({label:"seatmap_flight_no_results_appearance"})},activateItinerary:function(){this.setStatusValue(this.$cachedSelectors.aircraftmapWrapper,s.STATUS_VISIBLE),this.setStatusValue(this.$cachedSelectors.aircraftmapNoContent,s.STATUS_HIDDEN)},cacheDomSelectors:function(){this.updateDomSelectorsToCache()},renderAircraftTitle:function(){var e=this.isMultiDestination?this.multiSegmentText[this.segment]:0===this.segment?this.options.outboundSegmentText:this.options.inboundSegmentText;this.$cachedSelectors.aircraftmapHeaderFlightSegment.html(e),this.$cachedSelectors.aircraftmapFlightSectionText.html(this.options.flightSection),this.$cachedSelectors.aircraftmapFlightSectionTextSmall.html(this.options.flightSectionSmall)},renderPassengersTemplate:function(){this.passengerCollectionLoadedPromise.then(_.bind(function(){this.$el.find(".aircraftmap_users").html(this.aircraftmapPassengersTemplate({passengers:this.widget.passengerCollection.toJSON(),translations:this.options.translations})),this.renderPassengersInfo()},this))},renderPassengersInfo:function(){var e;this.widget.passengerCollection.each(function(t){var i=t.get("numPassenger"),n=this.getPassengerDivId(i),a={numPassenger:i,section:this.section},r=this.widget.seatMapSelectionCollection.getSeat(a),o=!_.isEmpty(r),c=o?s.STATUS_VISIBLE:s.STATUS_HIDDEN,d=o?this.getSeatInfo(r):this.defaultPassengerSelectString;e=this.$widget.find(n),this.setStatusValue(e,s.STATUS_INACTIVE),this.setRemoveButtonStatus(this.$widget.find(n+" .aircraftmap_user_delete"),c,d),this.$el.find(n+" .aircraftmap_user_seat").html(d),this.$el.find(n+" .aircraftmap_user_seat").toggleClass("od-aircraftmap-user-seat-number-filled",o),_.isEmpty(t.get("name"))||this.$widget.find(n+" .aircraftmap_user_name").html(t.get("name"))},this),e=this.$widget.find(this.getPassengerDivId(this.getActivePassenger())),this.setStatusValue(e,s.STATUS_ACTIVE)},setRemoveButtonStatus:function(e,t,i){var n=i!==this.defaultPassengerSelectString?i:"";this.setStatusValue(e,t),e.attr("data-selected-seat",n)},renderAircraftStructure:function(){var e=this.buildTemplate();this.$cachedSelectors.aircraftContainer.empty().html(e),this.updateAircraftLegend(e)},renderAvailableSeats:function(){this.widget.seatMapDescriptorCollection.each(function(e){var t=this.$widget.find(this.getSeatDivId(e.get("seatRow"),e.get("column"))),i="NO_SEAT"===e.get("type")?s.STATUS_NO_SEAT:s.STATUS_AVAILABLE;this.setStatusValue(t,i)},this)},renderSelection:function(){this.setStatusValue(this.$cachedSelectors.aircraftmapSeatAvailable,s.STATUS_AVAILABLE);var e=this.widget.seatMapSelectionCollection.getFlightSeats(this.segment,this.section);_.each(e,function(e){var t=this.$widget.find(this.getSeatDivId(e.get("rowSelection"),e.get("columnSelection")));this.changeSeatIcon(t.find(".aircraftmap_seat"),s.SEAT_SELECTED),this.setStatusValue(t,s.STATUS_SELECTED)},this)},addSelectedSeat:function(e){var t={seatRow:e.data("row"),column:e.data("column")},i={numPassenger:this.getActivePassenger(),segment:this.segment,section:this.section,seat:this.widget.seatMapDescriptorCollection.getSeat(t)};this.widget.addSelection(i)},removeSelectedSeat:function(e){var t={rowSelection:e.data("row"),columnSelection:e.data("column"),section:this.section};this.widget.removeSelection(this.widget.seatMapSelectionCollection.getSeat(t))},updateAircraftLegend:function(e){var t=e.find("."+a.constants.CLASS_PREFFERED).length,i=e.find("."+a.constants.CLASS_X_LEG).length,n=e.find("."+a.constants.CLASS_CHEAPER).length,r=e.find("."+a.constants.CLASS_STANDARD).length;this.$cachedSelectors.aircraftmapLegendPreferred.toggleClass(s.HIDDEN_CLASS,!t),this.$cachedSelectors.aircraftmapLegendExtraLeg.toggleClass(s.HIDDEN_CLASS,!i),this.$cachedSelectors.aircraftmapLegendCheapest.toggleClass(s.HIDDEN_CLASS,!n),this.$cachedSelectors.aircraftmapLegendStandard.toggleClass(s.HIDDEN_CLASS,!r)},updateCommonElements:function(){var e=this.$cachedSelectors.aircraftmapMinimumPrice.attr("data-minimum")?this.$cachedSelectors.aircraftmapMinimumPrice.attr("data-minimum"):"";this.toggleNavigationButton(this.$cachedSelectors.aircraftmapNextSectionButton,this.options.isLast),this.toggleNavigationButton(this.$cachedSelectors.aircraftmapPrevButton,this.options.isFirst),this.$cachedSelectors.aircraftmapCurrentSection.html(Odigeo.Utils.replaceCmsKeyArgs(this.options.translations.flightIndex,this.options.section+1,this.itinerarySectionsCount)),this.$cachedSelectors.aircraftmapMinimumPrice.html(e.replace(s.CMS_REGEX,Odigeo.Utils.formatCurrency(this.options.minimumPrice)))},containsSeatType:function(e){return this.$cachedSelectors.aircraftContainer.find("."+e).length},getSeatInfo:function(e){return e.get("rowSelection")+e.get("columnSelection")},getActivePassenger:function(){var e,t=this.nTravellers,i=1;if(this.widget.passengerCollection.length)if(_.size(this.widget.seatMapSelectionCollection.getFlightSeats(this.segment,this.section))===this.nEligibleTravellers)i=this.widget.passengerCollection.getLastNumPassengerExcludingType(s.PASSENGER_TYPE_INFANT);else for(var n=t;1<=n;n--)this.widget.passengerCollection.getPassenger({numPassenger:n}).get("travellerType")!=s.PASSENGER_TYPE_INFANT&&(e={numPassenger:n,segment:this.segment,section:this.section},i=_.isUndefined(this.widget.seatMapSelectionCollection.getSeat(e))?n:i);return i},hideErrorMessage:function(){Odigeo.trigger(this.widget.name+":hideErrors")},setStatusValue:function(e,t){_.isUndefined(e)||e.attr(s.DATA_STATUS,t)},getStatusValue:function(e){return e.attr(s.DATA_STATUS)},getSeatDivId:function(e,t){return"#aircraft_map_"+e+t},getPassengerDivId:function(e){return"#aircraft_map_passenger_"+e},cancelAircraftMoveThrough:function(){clearTimeout(this.aircraftLoaderTimeout),this.$cachedSelectors.aircraftmapSectionLoader.removeClass("fadeIn")},checkPassengerCollectionPopulated:function(){this.passengerCollectionLoadedDeferred.resolve()},init:function(){this.aircraftmapPassengersTemplate=_.template(this.$cachedSelectors.aircraftmapPassengersTemplate.html(),Odigeo.Utils.getTmplSettings()),this.passengerCollectionLoadedDeferred=$.Deferred(),this.passengerCollectionLoadedPromise=this.passengerCollectionLoadedDeferred.promise()}})},function(e,t,i){"use strict";var n=i(619),a=function(e){n.options=n.parseOptions(e)};a.prototype={buildTemplate:function(){return $("<div>",{class:"od-aircraftmap-map-wrapper"}).append(this.buildBody())},buildBody:function(){n.setSeatPriceData(n.options.seatMap.cabin);var e=$("<div>",{class:"od-aircraftmap-cabins"});return _.each(n.options.seatMap.cabin,_.bind(function(t){e.append(this.buildCabin(t));var i=n.hasToShowDarkZone(t)?n.addDarkZone(t):"";e.append(i)},this)),e},buildRowHeader:function(e){var t=$("<div>",{class:"od-aircraftmap-columndistribution"});return _.each(e.cabinCharacteristics.columnDistribution,_.bind(function(e){"AISLE"===e?t.append($("<div>",{class:"od-aircraftmap-aisle"})):t.append($("<div>",{class:"od-aircraftmap-rowhead-seat odf-text-sm odf-strong"}).text(e))},this)),t.append($("<span>",{class:"aircraftmap_anchor"})),t},buildCabin:function(e){var t=$("<div>",{class:"od-aircraftmap-cabin"}),i=n.getCustomRowElement(e.cabinCharacteristics.exitRows,n.constants.BLANK_SPACE),a=e.firstSeatsRow;return t.append(this.buildRowHeader(e)),_.each(_.range(e.seatMapRowFrom,e.seatMapRowTo+1),_.bind(function(s){var r=n.getSeatRowFromSeatMapRow(e,s),o="od-aircraftmap-row ";if(r===n.constants.BLANK_SEATS)t.append($("<div>",{class:o}).append(this.buildNoSeatsRow(e,n.constants.BLANK_SEATS,s))),a++;else if(r>n.constants.BLANK_SEATS){a=r>n.constants.NO_SEATS?r:a;var c=$("<div>");c.addClass(o),n.isExitRow(i,a.toString())&&c.append(n.addExitRow(a)),t.append(c.append(this.buildRow(e,a,s))),a++}},this)),t},buildNoSeatsRow:function(e,t,i){var a=[],s=$("<div>",{class:"odf-text-center od-aircraftmap-row-aisle"});return _.each(e.cabinCharacteristics.columnDistribution,_.bind(function(r){"AISLE"===r?(a.push(s,$("<div>",{class:"odf-text-center odf-text-sm od-aircraftmap-aisle"}).text("-")),s=$("<div>",{class:"odf-text-center od-aircraftmap-row-aisle"})):s.append(this.buildSeat(n.getSeatCharacteristics(e,t,i,r)))},this)),a.push(s),a},buildRow:function(e,t,i){var a=[],s=$("<div>",{class:"odf-text-center od-aircraftmap-row-aisle"}),r=n.getCustomRowElement(e.cabinCharacteristics.extraLegSeats,n.constants.BLANK_SPACE);return _.each(e.cabinCharacteristics.columnDistribution,_.bind(function(o){if("AISLE"===o)a.push(s,$("<div>",{class:"odf-text-center odf-text-sm od-aircraftmap-aisle"}).append(t)),s=$("<div>",{class:"odf-text-center od-aircraftmap-row-aisle"});else{var c=n.isSeatExtraLeg(r,t,o)?this.buildExtraLegSeat(e,t,i,o):this.buildSeat(n.getSeatCharacteristics(e,t,i,o));s.append(c)}},this)),a.push(s),a},buildExtraLegSeat:function(e,t,i,a){var s=$("<div>",{class:"od-aircraftmap-row-extra-leg emergency_exit"}),r=$("<div>",{class:"od-aircraftmap-row-extra-leg-space"}),o=this.buildSeat(n.getSeatCharacteristics(e,t,i,a));return s.append(r).append(o)},buildSeat:function(e){return $("<div>",{class:this.getSeatStyle(e)}).attr("id","aircraft_map_"+e.row+e.column).attr("data-status",e.status).attr("data-rawprice",e.rawPrice).append(this.buildIcon(e))},getSeatStyle:function(e){return"aircraftmap_seat_"+e.status+" od-aircraftmap-seat-custom"},buildSeatAvailableType:function(e){var t="aircraftmap_seat odf-icon od-aircraftmap-icon odf-text-xl ",i=this.getSeatMainCharacteristic(e);return e.type===n.options.seatStatus.unavailable?t+="odf-icon-cross-light":n.isNoSeat(e)?(t+="od-aircraftmap-noseat ",_.isEmpty(e.characteristics.characteristic)||(t+=n.getNoSeatType(e.characteristics.characteristic))):t+=n.hasExtraLegCharacteristic(e)?this.getExtraLegClasses():n.hasPreferredSeatCharacteristic(e,n.options.preferredSeatsThreshold)?this.getPreferredSeatClasses():this.printRegularSeat(e),{classes:t,mainCharacteristic:i}},getExtraLegClasses:function(){return" aircraftmap_extra_leg_room od-aircraftmap-extra-leg-room odf-icon-x-leg-room "},getPreferredSeatClasses:function(){return" aircraftmap_preferred_seat od-aircraftmap-preferred-seats odf-icon-crown "},getSeatMainCharacteristic:function(e){return n.hasExtraLegCharacteristic(e)?n.constants.EXTRA_LEG_TYPE:n.hasPreferredSeatCharacteristic(e,n.options.preferredSeatsThreshold)?n.constants.PREFERRED_TYPE:n.isCheaperSeatCharacteristic(e)?n.constants.CHEAPER_TYPE:n.constants.STANDARD_TYPE},printRegularSeat:function(e){return this.getColouredSeatClasses(e)},getColouredSeatClasses:function(e){return n.isCheaperSeatCharacteristic(e)?" aircraftmap_cheaper_seat od-aircraftmap-default-seat-cheapest odf-icon-tag":" aircraftmap_default_seat od-aircraftmap-default-seat-primary"},buildIcon:function(e){var t=this.buildSeatAvailableType(e);return $("<div>",{class:t.classes}).attr("data-row",e.row).attr("data-column",e.column).attr("data-type",e.type).attr("data-texttype",n.options.keys[e.type]).attr("data-extra-leg",n.hasExtraLegCharacteristic(e)).attr("data-price",e.price).attr("data-characteristic",t.mainCharacteristic)}},e.exports=a.prototype.constructor=a},function(e,t,i){"use strict";var n=i(747);Odigeo.defineWidget("post_booking_bags",Odigeo.Widget.extend(_.extend(n,{viewClass:i(1129)})))},function(e,t,i){"use strict";var n=i(749);e.exports=Odigeo.View.extend(_.extend(n,{renderSelectedBagsForSegment:function(e,t,i){var n=e.travellerType.toUpperCase(),a=e.travellerNumber;return this.renderBaggageDropdown(n,t,a,i)},afterRenderContent:function(e){this.$cachedSelectors.widget.addClass("open opened")},beforeRemoveContent:function(){this.$cachedSelectors.widget.removeClass("open opened")}}))},function(e,t,i){"use strict";var n=i(750);Odigeo.defineWidget("post_booking_seats",Odigeo.Widget.extend(_.extend(n,{viewClass:i(1131)})))},function(e,t,i){"use strict";var n=i(751);e.exports=Odigeo.View.extend(_.extend(n,{afterRenderContent:function(e){this.$cachedSelectors.widget.addClass("open opened")},beforeRemoveContent:function(){this.$cachedSelectors.widget.removeClass("open opened")}}))},function(e,t,i){"use strict";var n=i(756);Odigeo.defineWidget("payment",Odigeo.Widget.extend(n))},function(e,t,i){"use strict";var n={desktop:i(1134)};Odigeo.defineWidget("pay_with_guarantee",Odigeo.Widget.extend({modelClass:i(1135),exposedMethods:{load:"model.refreshData"},beforeConstructView:function(){this.options=Odigeo.parseOptions(this.options),this.viewClass=n[this.options.template]},load:function(){this.model.refreshData()},updatePayWithGuarantee:function(e){this.model.setInsuranceOrGuaranteeSelected(e),this.view.updateViewState()},togglePaymentBtn:function(e){this.view.togglePaymentBtn(e)},trackPurchase:function(e,t){this.view.trackPurchase(e,t)},setInsuranceOrGuaranteeSelected:function(e){this.model.setInsuranceOrGuaranteeSelected(e)},setRepricing:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{};this.model.setRepricing(e)},updateViewState:function(){this.view.updateViewState()},onAncillaryProductRendered:function(e){this.view.onAncillaryProductRendered(e)}}))},function(e,t,i){"use strict";var n=i(0);e.exports=Odigeo.View.extend({hasGuaranteeProductRendered:!1,script:{main:"#pay_with_guarantee_script",priceWithRepricing:"#price_with_repricing"},events:{"tap @paymentWithGuaranteeButton":"onPaymentButton","tap @conditionsLink":"onConditionsLinkClicked"},selectors:{paymentWithGuaranteeButton:".pay_with_guarantee_button",conditionsLink:".pay_with_guarantee_conditions_link"},onConditionsLinkClicked:function(){n.trackEvent("payment_details","link_data_"+this.model.get("policy")+"_policy_open")},renderTemplate:function(e){this.$el.html(this.script.main(e.toJSON())),this.renderRepricing(),this.postRender()},renderRepricing:function(){_.isObject(this.model.get("repricing"))&&this.$el.find(".price_container").html(this.script.priceWithRepricing(this.model.toJSON()))},postRender:function(){this.updateDomSelectorsToCache(),Odigeo.trigger(this.widget.id+":rendered")},init:function(){this.model.set("shown",!1),this.script=Odigeo.Utils.getTemplates(this.$el,this.script,this.templateSettings),this.listenTo(this.model,"change",this.renderTemplate)},togglePaymentBtn:function(e){this.$cachedSelectors.paymentWithGuaranteeButton.toggleClass("loading",e.loading).attr("disabled",e.disabled)},onPaymentButton:function(e){n.startMetric("LOAD_CONFIRM"),e.preventDefault(),e.stopPropagation(),Odigeo.trigger(this.widget.id+":bookAncillariesModuleCanx",this.model.get("policy"))},onAncillaryProductRendered:function(e){this.hasGuaranteeProductRendered=this.hasGuaranteeProductRendered||this.model.hasGuaranteeProductBeenRendered(e),this.updateViewState()},updateViewState:function(){var e=this.model.get("ancillarySelected");!this.hasGuaranteeProductRendered||_.some(e,{added:!0})?this.hidePayWithGuarantee():this.showPayWithGuarantee()},showPayWithGuarantee:function(){this.model.get("policy")&&!this.model.get("selected")&&(Odigeo.trigger(this.widget.id+":showPayWithGuarantee"),this.model.set("shown",!0))},hidePayWithGuarantee:function(){Odigeo.trigger(this.widget.id+":hidePayWithGuarantee"),this.model.set("shown",!1)},trackPurchase:function(e,t){this.model.get("shown")&&n.trackEvent("confirm_purchase",this.getTrackPurchaseLabel(e,t))},getTrackPurchaseLabel:function(e,t){var i="purchase_"+e;return t?(i+="_PN:"+Math.floor(this.model.getPriceWithoutOffer()),i+="_PI:"+Math.floor(this.model.getPriceWithOffer())):i+="_FE_error",i}})},function(e,t,i){"use strict";var n=i(52),a=i(43);e.exports=Odigeo.Model.extend(n.extend({dataUrl:"getpaybutton",init:function(){this.bindPriceCollection(),this.set(this.widget.options),this.on("priceCollection.repaintPrices",this.updatePriceWithOffer)},refreshData:function(){this.isEmptyData=!1,this.refresh()},url:function(){return Odigeo.Settings.getProperty("ancillariesUrlFormatter")(this.dataUrl)},getDataRequestSettings:function(){return{type:"GET",data:null,success:_.bind(this.requestSuccessHandler,this),error:_.bind(this.requestErrorHandler,this)}},requestSuccessHandler:function(e){_.isEmpty(e)||(this.set(e),this.updatePriceWithOffer(),this.widget.view.updateViewState(),Odigeo.trigger(this.widget.id+":setPdfUrl",this.get("pdfUrl")),Odigeo.trigger(this.widget.id+":setPolicy",this.get("policy")))},requestErrorHandler:function(){this.widget.view.updateViewState()},updatePriceWithOffer:function(){var e=this.get("totalPrice")||0,t=this.getPriceWithoutOffer()+e,i=Odigeo.Utils.formatCurrency(t);i!==this.get("priceWithOffer")&&(this.set("priceWithOfferRaw",t),this.set("priceWithOffer",i))},getPriceWithoutOffer:function(){return _.get(this.getPriceCollectionData(),"totalPrice")-(this.getPayWithGuaranteeItemInCollection().get("allPrice")||0)},getPriceWithOffer:function(){return this.get("priceWithOfferRaw")},setInsuranceOrGuaranteeSelected:function(e){if(_.get(e,"pbdType")!==a.ADDITION){var t=this.get("ancillarySelected")||{},i=_.get(e,"selected"),n=_.get(e,"id");t[n]={policy:n,added:i},this.set("ancillarySelected",t)}},hasGuaranteeProductBeenRendered:function(e){var t=this.get("id");return!_.isEmpty(t)&&e.get("id")===t},setRepricing:function(){var e=0<arguments.length&&void 0!==arguments[0]?arguments[0]:{},t=_.extend({},e);t.formattedPrices={oldPrice:Odigeo.Utils.splitFormatedCurrency(t.oldPrice+this.get("totalPrice")||0)},this.set("repricing",t)}}))},function(e,t,i){"use strict";$(function(){Odigeo.defineWidget("service_options_table",Odigeo.Widget.extend({modelClass:i(1137),viewClass:i(1138),tracking:i(140)("serviceOptions"),init:function(){this.options=Odigeo.Utils.parseOptions(this.options),this.listenToOnce(this.model,"change:products",function(e){this.tracking.registerOffer(e.getAvailableProducts())})},load:function(){this.model.refreshData()},alignTableCellsHeight:function(){this.view.alignTableCellsHeight()},updateBreakdownPrices:function(){this.model.updateBreakdownPrices()},getAddedProduct:function(){return this.model.getAddedProduct()},validateConditionSoEvolutionAdded:function(){var e=this.model.validateConditionSoEvolutionAdded();return e||this.view.soEvolutionError(),e},addBasicSo:function(){this.model.addBasicSo()},addRecommendedSo:function(){this.model.addRecommendedSo()},addSoBasicIfNotAdded:function(){this.model.validateConditionSoEvolutionAdded()||this.model.addBasicSo()},getSelectedProductOrBasic:function(){return this.model.getSelectedProductOrBasic()}}))})},function(e,t,i){"use strict";var n,a,s="BASIC";e.exports=(n=i(94),a=i(0),Odigeo.Model.extend(n.extend({phonePattern:/^\d{3,13}$/,dataUrl:"getserviceoptiontable",defaults:{phoneInfo:{},avoidBlinkPhone:!1,keepPhoneAreaOpen:!1},init:function(){this.on("invalid",function(e,t){t.apply(this,arguments)})},validate:function(e){if(!this.phonePattern.exec(e.phoneInfo.phoneNumber))return this.phoneNumberInvalid},phoneNumberInvalid:function(){this.widget.view.showInvalidPhoneError(),this.widget.tracking.changePhoneIncorrect()},getDataRequestSettings:function(){return this.widget.tracking.willTrackOnLoadOfSomeProducts(),{type:"GET",data:null,success:_.bind(this.requestSuccessHandler,this),error:_.bind(this.requestErrorHandler,this)}},url:function(){return Odigeo.Settings.getProperty("serviceOptionsUrlFormatter")(this.dataUrl)},requestErrorHandler:function(){a.counterMetric("PLUS_ERROR_COUNT_SERVICE_OPTIONS_TABLE"),this.widget.tracking.trackOfferedProducts(null)},requestSuccessHandler:function(e){if(!_.isEmpty(e)){var t=this.parseProducts(e.columns);_.isEmpty(t)||(this.setInitialProductEvolutionSelection(t),this.set({phoneInfo:this.getPhoneInfo(e),services:e.options,serviceGroups:_.map(e.options,"groupId"),productTypes:_.keys(e.columns),recommended:this.getRecommendedProduct(t),products:t,keepPhoneAreaOpen:this.get("isProductSelected"),debugInfo:e.debugInfo,hasToAvoidRejectedNag:e.hasToAvoidRejectedNag}),this.updateBreakdownPrices(),this.trigger("change:keepPhoneAreaOpen",this),this.trackLoadedProducts(t))}},trackLoadedProducts:function(e){var t=[];_.each(e,function(e){var i=_.get(e,"type");t.push(i)}),this.widget.tracking.trackOfferedProducts(t)},getPhoneInfo:function(e){return _.isUndefined(this.get("phoneInfo").phoneNumber)?_.pick(e,"phoneCode","phoneNumber","phonePrefix"):this.get("phoneInfo")},refreshData:function(){this.isEmptyData=!1,this.refresh()},parseProducts:function(e){var t={};return _.each(e,function(e,i){var n=e.offerDTO;t[i]={servicesTexts:e.keys,pbdText:e.pbdText,name:n.name,offerId:n.offerId,recommended:n.recommended,selectable:n.selectable,selected:n.selected,type:n.type,productStructure:n.product,pricing:{onePrice:n.onePrice,quantity:n.quantity,totalPrice:n.totalPrice}}}),t},getRecommendedProduct:function(e){var t=_.filter(e,function(e){return"basic"!==e.type&&e.selected}),i=_.find(e,{recommended:!0}),n=_.isEmpty(i)?null:i.type;return 0<_.size(t)?null:n},getPriceSelectedProduct:function(e){var t=_.filter(e,function(e){return e.type!==s&&e.selected});return _.size(t)<=0?0:t[0].pricing.onePrice},isProductSelected:function(e){return!_.isUndefined(e)&&this.isProductSelectedWithProducts(e)},isProductSelectedWithProducts:function(e){var t=this.findSelectedProduct(e);return!_.isUndefined(t.type)},findSelectedProduct:function(e){return _.find(e,{selected:!0})},setInitialProductEvolutionSelection:function(e){var t,i,n=this.get("selectedProductType"),a=this.findSelectedProduct(e),s=_.get(a,"type");t=n===s&&!_.isEmpty(s)||(i=_.isEmpty(n)?s:n,this.set("selectedProductType",i),this.selectProductByType(e,i),!_.isEmpty(i)),this.set("isProductSelected",t)},selectProductByType:function(e,t){_.each(e,function(e){e.selected=e.type===t})},getProductPriceBreakdown:function(e){var t={},i=_.get(e,"pricing");return _.extend(i,{type:"SERVICE_OPTIONS"}),_.isUndefined(i)||(t={conceptLabel:e.pbdText,conceptKey:e.type,onePrice:i.onePrice,allPrice:i.totalPrice,quantity:i.quantity,type:i.type}),t},updateServiceOptions:function(e){var t=this.get("products"),i=this.getSelectedProduct();_.get(i,"type")!==e&&(this.selectProductByType(t,e),this.set({recommended:this.getRecommendedProduct(t),selectedProductType:e,avoidBlinkPhone:!_.includes([e,i.type],s),isProductSelected:this.isProductSelected(t),products:t,selectedProductPrice:this.getPriceSelectedProduct(t)}),this.trigger("change:products",this),this.updateBreakdownPrices())},updateBreakdownPrices:function(){var e=this.getSelectedProduct();if(!_.isEmpty(e)){var t=this.getProductPriceBreakdown(e),i={data:{offerId:e.offerId,postsellServiceOptionRequest:this.getPostsellServiceOptionRequest(e.productStructure)},id:"serviceoptions",type:"success"};this.addItemToPricemanagerCollection(t),Odigeo.trigger("complete:serviceoptions",i),Odigeo.trigger(this.widget.id+":productSelection",{concept:t.conceptLabel})}},getMonitoringAlertIdSelected:function(e){var t="";return _.each(e,function(e){_.has(e.monitoringAlert,"id")&&(t=e.monitoringAlert.id)}),t},getPostsellServiceOptionRequest:function(e){var t=this.get("phoneInfo");return _.size(e)?{monitoringAlertRequest:[{id:this.getMonitoringAlertIdSelected(e),phone:{phoneCountry:t.phoneCode,phoneNumber:t.phoneNumber}}]}:{}},updatePhoneInfo:function(e){this.set("avoidBlinkPhone",!0),this.set({phoneInfo:e},{validate:!0}),this.validationError||(this.trigger("change:phoneInfo",this),this.updateBreakdownPrices(),this.widget.tracking.changePhoneNumberOk())},getSelectedProduct:function(){return this.findSelectedProduct(this.get("products"))||{}},getSelectedProductOrBasic:function(){var e=this.findSelectedProduct(this.get("products"))||this.findBasicProduct(this.get("products"));return e?{offerId:e.offerId,postsellServiceOptionRequest:this.getPostsellServiceOptionRequest(e.productStructure)}:null},findBasicProduct:function(e){return _.find(e,{type:s})},getAvailableProducts:function(){return _.filter(_.map(this.get("products"),function(e){return e.type}),function(e){return e!==s})},getAddedProduct:function(){var e=this.findSelectedProduct(this.get("products"));return e?e.type:null},validateConditionSoEvolutionAdded:function(){return!!this.get("isProductSelected")||_.isEmpty(this.get("products"))},addBasicSo:function(){this.updateServiceOptions(s)},addRecommendedSo:function(){var e=_.find(this.get("products"),{recommended:!0}),t=_.isEmpty(e)?null:e.type;this.updateServiceOptions(t)},getSelectedProductType:function(){return this.get("selectedProductType")},isBasicSelected:function(){return this.getSelectedProductType()===s},hasToAvoidNag:function(){return this.get("hasToAvoidRejectedNag")}})))},function(e,t,i){"use strict";var n;e.exports=(n=i(0),Odigeo.View.extend({templateSettings:{evaluate:/\{\{#([\s\S]+?)\}\}/g,interpolate:/\{\{[^#{]([\s\S]+?)[^}]\}\}/g,escape:/\{\{\{([\s\S]+?)\}\}\}/g,variable:"tmpl"},events:{"mouseleave .service_options_table_services .so_services_table_row":"onLeaveSOTableRow","tap @productColumn":"onServiceOptionClick","tap @productEvolutionColumn":"onServiceOptionEvolutionClick","tap @modifyServiceOptions":"onModifyServiceOptionsClick","mouseover @productColumn":"onServiceOptionHover","mouseout @productColumn":"onServiceOptionHover","tap @phoneNumberChange":"onChangePhoneNumberClick","tap @confirmUpdate":"onConfirmUpdate","keypress @phoneNumber ":"updateAllPhoneInputs","change @phoneCode ":"updateAllPhoneInputs","tap @soRecommendedBubble":"onClickRecommendedBubble","tap @soSelectedBubble":"onClickSelectedBubble"},selectors:{productColumn:".product_column",productEvolutionColumn:".product_evolution_column",serviceTooltips:".service_tooltip_hint",soContainer:"#so_table_main",soColSelected:".sotable_selected",soColRecommended:".sotable_recommended",soSelectedBubble:".so_selected_bubble",soRecommendedBubble:".so_recommended_bubble",soTemplate:"#so_table_template",phoneNumberChange:".change_phone_link",phoneNumberDisplayWrapper:".phone_number_display_wrapper",phoneNumberUpdateWrapper:".phone_number_update_wrapper",phoneNumber:".phone_number",phoneCode:".phone_code",confirmUpdate:".confirm_update",phoneWrapper:".so_table_phone",odSotableExpanded:".so_sotable_expanded",odSotableCollapsed:".so_sotable_collapsed",modifyServiceOptions:".modify_service_option",soServicesTableRows:".so_services_table_row",soServicesTableCells:".so_services_table_cell",soServicesTablePhoneFormCell:".so_sotable_expanded .so_table_phone",soServicesTableButtonCells:".so_services_table_cell_button",soServicesTablePriceCells:".so_services_table_cell_price",soEvolutionMsgError:".msg_error"},renderTemplate:function(e){var t=_.extend(e.toJSON(),{phoneString:this.getPhoneString()});this.$cachedSelectors.soContainer.html(this.template(t)),this.updateDomSelectorsToCache(),this.enhanceServiceTooltips(),this.displayRecommendedColumn(),this.alignTableCellsHeight(),Odigeo.trigger("optimize:hasRendered","service_options"),n.stopMetric("PLUS_LOAD_SO_TABLE")},collapsiveAnimationDuration:500,renderTemplateShowingTable:function(e){this.renderTemplate(e),this.enhanceCollapsive(!0),this.enhanceBubbleShake(!0),this.displaySelectedBubble()},renderTemplateShowingPhone:function(e){var t=this.isSoTableExpanded();this.renderTemplate(e),this.enhanceCollapsive(t),this.enhanceBubbleShake(!1)},isCollapsibleEnabled:function(){return 0<this.$cachedSelectors.odSotableCollapsed.size()},enhanceCollapsive:function(e){this.enhanceCollapsiveElement("odSotableExpanded",e),this.isCollapsibleEnabled()&&this.enhanceCollapsiveElement("odSotableCollapsed",!e)},enhanceBubbleShake:function(e){this.addSelectorToCache(this.$cachedSelectors.soSelectedBubble,Odigeo.UIElements.shake.enhance(this.$cachedSelectors.soSelectedBubble,{initHidden:e}))},enhanceCollapsiveElement:function(e,t){this.$cachedSelectors.soContainer.css("height",this.$cachedSelectors.soContainer.height()),this.addSelectorToCache(e,Odigeo.UIElements.collapsive.enhance(this.$cachedSelectors[e],{initiallyExpanded:t,expandPanelDuration:this.collapsiveAnimationDuration})),this.$cachedSelectors.soContainer.css("height","")},onCollapseTable:function(e){this.isCollapsibleEnabled()&&(this.collapseAnimation("odSotableExpanded",e),this.collapseAnimation("odSotableCollapsed",!e),Odigeo.Utils.scrollToElement(this.$cachedSelectors[e?"odSotableExpanded":"odSotableCollapsed"].find(".collapsible_content"),{centerInWindow:!0,elementOffsetTop:this.$cachedSelectors.soContainer.offset().top}))},collapseAnimation:function(e,t){this.$cachedSelectors[e].removeClass("fade-in fade-in-end fade-out fade-out-end").addClass("fade-"+(t?"in":"out")+" fade-"+(t?"in":"out")+"-end").trigger(t?"expandPanel":"collapsePanel")},displaySelectedBubble:function(){0<this.$cachedSelectors.soSelectedBubble.size()&&_.delay(_.bind(function(){this.$cachedSelectors.soSelectedBubble.trigger("showShakeElement")},this),this.isCollapsibleEnabled()?this.collapsiveAnimationDuration+20:1)},displayRecommendedColumn:function(){var e=this.$cachedSelectors.soColRecommended.data("type"),t=this.$cachedSelectors.soColSelected.data("type"),i=this.model.get("lastSelectedProductType"),n=e===t,a=e===i===n;t===i&&_.isUndefined(t)&&this.$cachedSelectors.soColRecommended.addClass("od-sotable-recommended od-z-index-2"),this.displayRecommendedBubble(!0),n?a?this.displayRecommendedBubble(!1):this.displayRecommendedBubbleEasing(!1):a||this.displayRecommendedBubbleEasing(!0),this.model.set("lastSelectedProductType",t)},displayRecommendedBubbleEasing:function(e){this.displayRecommendedBubble(!e),_.delay(_.bind(function(){this.displayRecommendedBubble(e)},this),1)},displayRecommendedBubble:function(e){this.$cachedSelectors.soRecommendedBubble.toggleClass("open",e)},enhanceServiceTooltips:function(){var e={hover:!0};_.each(this.$cachedSelectors.serviceTooltips,function(t){Odigeo.UIElements.hint.enhance(Odigeo.History.getPageNameFromFragment(),t,{events:e,googleAnalyticsOnOpen:{type:"trackEvent",data:{category:"payment",action:"service_options_information",label:"email_alerts_tooltip_clicks"}}})})},onServiceOptionClick:function(e){var t=$(e.currentTarget).data("type"),i=$(e.target).hasClass("delete_service_option"),n=this.$cachedSelectors.soColSelected.data("type");this.widget.tracking.addOrRemoveProduct(t,!i),i?this.model.addBasicSo():this.widget.model.updateServiceOptions(t.toLocaleUpperCase()),this.onChangePhoneDisplay(),i||t===n||this.onCollapseTable(!1)},onServiceOptionEvolutionClick:function(e){var t=$(e.currentTarget).data("type"),i=this.model.isBasicSelected(),n="basic"===t&&!this.model.hasToAvoidNag();if(!i&&n){var a=_.find(this.model.get("products"),{recommended:!0}),s=_.isEmpty(a)?0:a.pricing.totalPrice;Odigeo.trigger(this.widget.id+":showBasicServiceOptionEvoNag",Odigeo.Utils.formatCurrency(s)),this.widget.tracking.addOrRemoveProduct(t,!0)}else this.onServiceOptionEvolutionChange(t)},onServiceOptionEvolutionChange:function(e){this.widget.tracking.addOrRemoveProduct(e,!0),this.model.updateServiceOptions(e.toLocaleUpperCase()),this.onChangePhoneDisplay(),this.$cachedSelectors.soEvolutionMsgError.addClass("odf-hidden").removeClass("validation_field empty")},onModifyServiceOptionsClick:function(){this.onCollapseTable(!0),this.widget.tracking.modifySelection()},onChangePhoneDisplay:function(){if(!this.model.get("avoidBlinkPhone")){var e=this.model.getSelectedProductType();_.isEmpty(e)||this.model.isBasicSelected()||this.$cachedSelectors.phoneWrapper.addClass("open")}},onServiceOptionHover:function(e){0<this.$cachedSelectors.soColSelected.size()||this.$cachedSelectors.soColRecommended.addClass("od-sotable-recommended od-z-index-2"),"mouseover"===e.type&&(this.$cachedSelectors.soColRecommended=$(e.currentTarget).siblings(".sotable_recommended").removeClass("od-sotable-recommended od-z-index-2"))},onChangePhoneNumberClick:function(){this.$cachedSelectors.phoneNumberDisplayWrapper.addClass("odf-hidden"),this.$cachedSelectors.phoneNumberUpdateWrapper.removeClass("odf-hidden"),this.precheckPhoneCode(),this.widget.tracking.changePhoneNumber()},isSoTableExpanded:function(){return this.$cachedSelectors.odSotableExpanded.is(".expanded")},precheckPhoneCode:function(){this.$cachedSelectors.phoneCode.val(this.model.get("phoneInfo").phoneCode).prop("selected",!0)},onConfirmUpdate:function(e){var t=$(e.target).closest(".so_table_phone"),i=t.find(".phone_code"),n=t.find(".phone_number"),a=i.find("option:selected");this.$cachedSelectors.phoneCode.val(i.val()),this.$cachedSelectors.phoneNumber.val(n.val()),this.widget.model.updatePhoneInfo({phoneCode:this.$cachedSelectors.phoneCode.val(),phoneNumber:this.$cachedSelectors.phoneNumber.val(),phonePrefix:0<a.length?a.data("prefix"):""})},showInvalidPhoneError:function(){this.$cachedSelectors.phoneWrapper.attr("data-state","invalid")},onLeaveSOTableRow:function(){Odigeo.UIElements.hint.hidePageHints(Odigeo.History.getPageNameFromFragment())},alignTableCellsHeight:function(){var e=this;_.each(this.$cachedSelectors.soServicesTableRows,function(t){var i=$(t).offset().top,n=$(t).height(),a=0;a<n&&(a=n);var s=_.filter(e.$cachedSelectors.soServicesTableCells,function(e){var t=$(e).offset().top;return i-5<t&&t<i+5});_.each(s,function(e){$(e).height(a)})}),this.alignPriceCellsWithPhoneFormHeight()},alignPriceCellsWithPhoneFormHeight:function(){this.$cachedSelectors.soServicesTablePriceCells.css("height","");var e=_.max(this.$cachedSelectors.soServicesTablePriceCells,function(e){return $(e).length?$(e).outerHeight():0}),t=$(e).length?$(e).outerHeight():0,i=this.$cachedSelectors.soServicesTablePhoneFormCell.outerHeight()-this.$cachedSelectors.soServicesTableButtonCells.outerHeight();this.$cachedSelectors.soServicesTablePriceCells.outerHeight(_.max([t,i]))},onClickRecommendedBubble:function(e){this.widget.tracking.popularBubble($(e.currentTarget).parents(".product_column").data("type"))},onClickSelectedBubble:function(){this.widget.tracking.addedBubble(this.model.getSelectedProduct().type)},getPhoneString:function(){var e=this.model.get("phoneInfo"),t=e.phoneNumber,i=e.phoneCode,n=e.phonePrefix;return i+" "+(_.isEmpty(n)?"":"(")+n+(_.isEmpty(n)?"":")")+" "+t},soEvolutionError:function(){this.$cachedSelectors.soEvolutionMsgError.removeClass("odf-hidden").addClass("validation_field empty"),Odigeo.trigger(this.widget.id+":setServiceOptionsEvoNagAlreadyShown")},init:function(){this.template=_.template(this.$cachedSelectors.soTemplate.html(),this.templateSettings),this.listenTo(this.model,"change:products",this.renderTemplateShowingTable),this.listenTo(this.model,"change:phoneInfo",this.renderTemplateShowingPhone),this.listenTo(this.model,"change:keepPhoneAreaOpen",this.onChangePhoneDisplay)}}))},function(e,t,i){"use strict";$(function(){Odigeo.defineWidget("meta_traffic_co_search",Odigeo.Widget.extend({modelClass:Odigeo.Model.extend({classAcronyms:{TOURIST:"EC",BUSINESS:"BC",FIRST:"FC",PREMIUM_ECONOMY:"PE"},countryNames:{FR:"FRANCE",UK:"UK",ES:"SPAIN",IT:"ITALY",DE:"GERMANY",US:"USA"},isThisWidgetEnabled:function(){var e=2<(JSON.parse(Odigeo.Session.get("searchParameters")).searchSegments||[1,2,3]).length,t=-1<navigator.userAgent.toLowerCase().indexOf("firefox");return!e&&!t},createPluginOptions:function(){if(!this._cachedPluginOptions){var e=JSON.parse(Odigeo.Session.get("searchParameters")),t=e.searchSegments[0],i=e.searchSegments[1];this._cachedPluginOptions={fromLocation:t.departure.iata,toLocation:t.destination.iata,departure:this.getDateFromSegment(t),adults:parseInt(e.numAdults,10),children:parseInt(e.numChildren,10),infants:parseInt(e.numInfants,10),roundTrip:e.type,class:this.classAcronyms[e.cabinClass],market:this.countryNames[Odigeo.SessionScope.website.substr(-2)],brand:Odigeo.SessionScope.brand[0],return:this.getDateFromSegment(i)}}return this._cachedPluginOptions},getDateFromSegment:function(e){if(!e)return"";var t=e.dateStr.split("-");return new Date(Date.UTC(t[0],t[1]-1,t[2]))}}),viewClass:Odigeo.View.extend({showPopUp:function(){window.pu=window.pu||[],window.pu.push(["open",this.widget.model.createPluginOptions()])}}),init:function(){this.model.isThisWidgetEnabled()&&(Odigeo.require(["//liligo.com/servlet/api/popunder/v1.js"]),Odigeo.on("dialogs:hidden",_.bind(function(e){"about-to-expire"===e.dialogID&&this.view.showPopUp()},this)))}}))})},function(e,t,i){"use strict";var n=i(191),a=i(0),s=i(92),r=i(14).getInstance(),o="flexibility_disruption";Odigeo.defineWidget("details_manager",Odigeo.Widget.extend({modelClass:Odigeo.Model.extend({}),viewClass:Odigeo.View.extend({selectors:{savingAlertWrapper:".saving_alert_wrapper",flexibilityDisruptionC2aWrapper:".flexibility_disruption_c2a_wrapper",savingAlertsTemplate:".result_saving_alert",savingAlertsWithIconTemplate:".result_saving_alert_with_icon_right"},init:function(){var e=this;this.widget.options=Odigeo.parseOptions(this.widget.options),r.getLoadedPromise().then(_.bind(function(t){t&&r.isCanxFree()?Odigeo.Templates.getGenericTemplates([o]).then(_.bind(function(e){if(_.isObject(e)){var t=_.get(e,o),i=e.getStaticTemplatesKeys(o);this.setFlexibilityDisruption(t,i)}},e)):e.widget.options.hideSavingAlert||e.setSavingAlert()},this)),s.trackOnLoadFlow()},setSavingAlert:function(){var e=this.$cachedSelectors.savingAlertsWithIconTemplate,t=new n({selectedPrice:this.widget.options.selectedPrice,averagePrice:this.widget.options.averagePrice,minBoundary:this.widget.options.savingAlertsMinBoundary,template:_.template(e.html(),Odigeo.Utils.getTmplSettings({variable:""})),translations:this.widget.options.translations,tests:_.get(this.widget.options,"tests")});t.render(),this.$cachedSelectors.savingAlertWrapper.html(t.$el),this.trackingSavingAlerts(this.widget.options.selectedPrice,this.widget.options.averagePrice)},setFlexibilityDisruption:function(e,t){var i=_.get(e,"callToAction",_.noop)({texts:t});this.$cachedSelectors.flexibilityDisruptionC2aWrapper.html(i),this.$cachedSelectors.flexibilityDisruptionC2aWrapper.removeClass("odf-hidden")},trackingSavingAlerts:function(e,t){if(!this.model.get("savingAlertsTracking")){var i=Math.ceil(100-e/t*100);i=i<10?"0"+i:i,a.trackEvent("saving_message","saving_message_"+i),this.model.set("savingAlertsTracking",!0)}}})}))},function(e,t,i){"use strict";var n=i(0);Odigeo.defineWidget("seats_left_on_top",Odigeo.Widget.extend({viewClass:Odigeo.View.extend({selectors:{seatsLeftContainer:".seats_left_on_top_container",seatsLeftText:".seats_left_text",pricesMayChange:".prices_may_change"},events:{"tap .seats_left_on_top_container":"onSeatsLeftMsgClick"},init:function(){this.widget.options=Odigeo.parseOptions(this.widget.options),_.isUndefined(this.widget.options.skipInitTracking)&&this.widget.options.isEnabled&&this.trackSeatsLeftOnTop(this.widget.options.minimumNumSeats),this.renderPricesMayChangeMessage()},renderPricesMayChangeMessage:function(){var e=this.widget.options;Odigeo.AB.isDesktopPricesMayIncrease&&this.$cachedSelectors.pricesMayChange.html(Odigeo.Utils.pluralizeAll(e.translations.priceMayChange,e.minimumNumSeats))},trackSeatsLeftOnTop:function(e){n.trackEvent("seats_left","seats_left_"+e),0<e&&e<=8&&this.$cachedSelectors.seatsLeftContainer.removeClass("odf-hidden")},onSeatsLeftMsgClick:function(){n.trackEvent("possible_CTA","seats_left_message_top")},toggleSeatsLeftSecondaryMessage:function(){var e="details"===Odigeo.History.getPageNameFromFragment()&&Odigeo.AB.isDesktopPricesMayIncrease;this.$cachedSelectors.pricesMayChange.toggleClass("odf-hidden",!e)}}),showSeatsLeft:function(e){var t=Odigeo.Utils.parseJson(Odigeo.Session.get("searchParameters")),i=t.numAdults+t.numChildren+t.numInfants===e?this.options.translations.lastSeatLeftKey:this.options.translations.seatsLeftKey;this.view.$cachedSelectors.seatsLeftText.html(Odigeo.Utils.pluralizeAll(i,e)),this.view.trackSeatsLeftOnTop(e)},toggleSeatsLeftSecondaryMessage:function(){this.view.toggleSeatsLeftSecondaryMessage()}}))},function(e,t,i){"use strict";var n={usa:i(1143),flex:i(1144),canx:i(1145),insurancesStandaloneFullBenefitsList:i(966),insurancesStandaloneBenefitsInsidePopup:i(974),insurancesStandaloneHub:i(555),insurancesItemNoFullBenefits:i(1146),insurancesItemFullBenefitsList:i(966),insurancesItemFullBenefitsListWithSubtitle:i(966),insurancesItemBenefitsPopup:i(974),insurancesHub:i(555),insurancesYesno:i(975),insurancesYesnoFr:i(975),guaranteesYesno:i(1147),additionsYesno:i(1148),additionsLegacy:i(1149)},a=i(717)(n),s=i(1150);i(719)(s,a)},function(e,t,i){"use strict";var n=i(500);e.exports=n.extend({className:"usa",buttonSelectedClass:"odf-icon-tick",buttonUnselectedClass:"odf-icon-plus",buttonSelectedKeyName:"buttonAddedUsa",buttonUnselectedKeyName:"buttonAddUsa",postRender:function(){n.prototype.postRender.apply(this,arguments),this.initSelectedBubble()},parseBenefitsHtml:function(e){var t=Odigeo.Utils.parseNodes(e).filter("li");return this.parsedBenefits=_.map(t,_.partial(this.parseListElement,_)).join("")},parseListElement:function(e){var t=$(e),i=t.find("span");i.eq(0).addClass("odf-col odf-col-gutter-sm odf-icon-xl"),i.eq(1).addClass("odf-col odf-col-lg odf-col-gutter-sm odf-text");var n=t.html();return $("<div>").append($("<li>",{class:"odf-text odf-row-fluid odf-text-mono-color-04 od-ancillaries-module-benefits-usa-li",html:n})).html()}})},function(e,t,i){"use strict";var n=i(500);e.exports=n.extend({className:"flex",addPopup:function(){var e=this.model.toJSON();this.model.hasModal()&&(this.enhancePopup(e),this.enhanceHint())},postRender:function(){n.prototype.postRender.apply(this,arguments),this.addPopup(),this.initSelectedBubble()},enhancePopup:function(e){var t=this,i={clickConditions:function(i){t.widget.tracking.clickConditionsFromPopup(e.policy,i)}},n=this.getPopupContent(e);this.modalContainer=this.$cachedSelectors.hintContainer,Odigeo.UIElements.enhanceConditionsPopup(this.modalContainer,n,i)},getPopupContent:function(e){var t=_.get(e,"texts.modal"),i={};return t&&(i={translations:{title:t.header,summary:t.summary,exclusions:t.exclusions},button:t.button,links:{summary:{text:t.summaryLink,link:e.url},extended:{text:t.extendedLink,link:e.urlExtended}},dualcontract:{enabled:e.flags.dualContract,text:t.dualContract,opener:t.dualContractLink}}),i},enhanceHint:function(){var e=this.model.get("policy"),t="trackEvent";this.modalHint=this.$cachedSelectors.seeFullCoverage,Odigeo.UIElements.hint.enhance("payment",this.modalHint,{events:{tap:!0},googleAnalyticsOnOpen:{type:t,data:this.widget.tracking.getTrackData("open_coverage",e)},googleAnalyticsOnClose:{type:t,data:this.widget.tracking.getTrackData("close_coverage",e)},googleAnalyticsOnCloseButton:{type:t,data:this.widget.tracking.getTrackData("close_coverage",e)},recalculate:!0})},parseBenefitsHtml:function(e){var t=Odigeo.Utils.parseNodes(e).filter("li");return this.parsedBenefits=_.map(t,_.partial(this.parseListElement,_)).join("")},parseListElement:function(e){var t=$(e),i=t.find("span");i.eq(0).addClass("odf-col odf-col-gutter-sm odf-icon-xl"),i.eq(1).addClass("odf-col odf-col-lg odf-col-gutter-sm odf-text");var n=t.html();return $("<div>").append($("<li>",{class:"odf-text odf-row-fluid odf-text-mono-color-03 od-ancillaries-module-benefits-flex-li",html:n})).html()}})},function(e,t,i){"use strict";var n=i(500);e.exports=n.extend({className:"canx",postRender:function(){n.prototype.postRender.apply(this,arguments),this.initSelectedBubble()}})},function(e,t,i){"use strict";var n=i(622);e.exports=n.extend({selectors:_.extend({insuranceItemPopup:".insurance_item_popup"},n.prototype.selectors),parseFooterLink:function(e){var t=$("<div>",{class:"hint_trigger_button odf-popup-container"});t.append($("<span>",{class:"odf-link odf-link-sm odf-link-legal",text:_.get(e,"texts.footerLink")})).append($("<span>",{class:"hint_container odf-text-mono-color-03"})),_.extend(e.texts,{parsedFooter:Odigeo.Utils.replaceCmsKeyArgs(_.get(e,"texts.footer"),$("<div>").append(t).html())})},postRender:function(){n.prototype.postRender.apply(this,arguments),_.each(this.$cachedSelectors.insuranceItemPopup,this.enhanceHintPopup,this)},parseTextsAndAttributes:function(e){n.prototype.parseTextsAndAttributes.apply(this,arguments),this.parseExclusions(e)},parseExclusions:function(e){_.extend(e.texts,{parsedExclusions:e.parsedExclusions||this.parseBenefitsHtml(e.texts.exclusions,"odf-ul-info odf-ul-md odf-space-outer-top-s")})},enhanceHintPopup:function(e){var t=this,i=$(e),n=i.find(".hint_container"),a=i.data("policy"),s=this.model.getPopupTextsByPolicy(a),r={clickConditions:function(e){t.widget.tracking.clickConditionsFromPopup(a,e)}};Odigeo.UIElements.enhanceConditionsPopup(n,s,r,{linkFontSizeModifierClass:"odf-link-md odf-text-mono-color-02 odf-text-underline",wrapperModifierClass:"odf-text-mono-color-02",popupIntroModifierClass:"odf-text-md od-modal-popupinfo-no-margin od-ancillaries-module-insurances-item-oldlegal-p",popupDualContractContainerModifierClass:"od-modal-popupinfo-no-margin",popupContentTitleModifierClass:"od-modal-popupinfo-no-margin",popupExclusionsModifierClass:"od-modal-popupinfo-no-margin"}),Odigeo.UIElements.hint.enhance(Odigeo.History.getPageNameFromFragment(),i,{events:{tap:!0},googleAnalyticsOnOpen:{type:"trackEvent",data:this.widget.tracking.getTrackData("open_coverage",a)},googleAnalyticsOnCloseButton:{type:"trackEvent",data:this.widget.tracking.getTrackData("close_coverage",a)},recalculate:!0})}})},function(e,t,i){"use strict";var n=i(500);e.exports=n.extend({className:"guarantee",modalTemplateName:"modals/modalDesktop",selectors:_.extend({conditions_link:".conditions_link"},n.prototype.selectors),parseTextsAndAttributes:function(e){n.prototype.parseTextsAndAttributes.apply(this,arguments),this.parseFooterIpidLink(e)}})},function(e,t,i){"use strict";var n=i(500);e.exports=n.extend({modalTemplateName:"modals/modalDesktop"})},function(e,t,i){"use strict";var n=i(500);e.exports=n.extend({className:"additions_legacy",modalTemplateName:"modals/modalDesktop"})},function(e,t,i){"use strict";var n=i(718),a=i(94),s=i(43),r=[s.ADDITION,s.INSURANCE];e.exports=n.extend(a.extend({priceCollectionItem:null,sortHubsBy:-1,parse:function(e,t){return(e=n.prototype.parse.apply(this,arguments)).isMultiOffer?_.each(e.products,function(t){this.addPriceBreakDownData(t,e)},this):this.addPriceBreakDownData(e),e},addPriceBreakDownData:function(e,t){var i=e.texts||{},n=e.prices||{},a=_.get(n,"totalPrice",0),s=_.get(t,"numTravellers",0),o=_.get(e,"numTravellers",s),c=0<a?o:0,d=_.get(t,"pbdType",""),l=_.get(e,"pbdType",d),g=_.includes(r,l);e.priceBreakDown={allowMultipleOfTheSameType:g,conceptLabel:i.productTitle||"",conceptKey:i.id||"",onePrice:n.passengerPrice||0,allPrice:n.totalPrice||0,quantity:c,type:l}},_selectProduct:function(e,t,i){n.prototype._selectProduct.apply(this,arguments),this.isSelectionChanged()&&(i!==t&&this.updateProductSelection(!1,i),this.updateProductSelection(e,t))},updateProductSelection:function(e,t){var i=this.getOfferByPolicy(t);_.isNull(i)||(this.updatePriceState(e,i),this.updateSidebar(e,i),this.addAncillaryDataToShoppingCart(t))},updatePriceState:function(e,t){_.isNull(t)||(e?this.priceCollectionItem=this.addItemToPricemanagerCollection(t.priceBreakDown):this.removeItemFromPricemanagerCollection(this.priceCollectionItem))},updateSidebar:function(e,t){_.isNull(t)||Odigeo.trigger(this.collection.widget.name+":ancillaryAdded",{added:e,id:t.policy,allowMultipleOfTheSameType:this.priceCollectionItem.get("allowMultipleOfTheSameType"),name:this.priceCollectionItem.get("conceptLabel"),type:this.priceCollectionItem.get("type")})},addAncillaryDataToShoppingCart:function(e){var t=this.getOfferByPolicy(e);if(!_.isNull(t)){var i={id:_.get(t,"id"),selected:this.isSelected(e),pbdType:this.get("pbdType")};Odigeo.trigger(this.collection.widget.name+":addAncillaryData",i)}},getPopupTextsByPolicy:function(e){var t=this.getOfferByPolicy(e),i={translations:{title:_.get(t,"texts.modal.header"),summary:_.get(t,"texts.modal.summary"),summaryTitle:_.get(t,"texts.modal.summaryTitle"),exclusions:_.get(t,"texts.modal.exclusions")},links:{summary:{text:_.get(t,"texts.modal.summaryLink"),link:_.get(t,"url")},extended:{text:_.get(t,"texts.modal.extendedLink"),link:_.get(t,"urlExtended")}},dualcontract:{enabled:_.get(t,"flags.dualContract"),opener:_.get(t,"texts.modal.dualContractLink"),text:_.get(t,"texts.modal.dualContract")}};return _.extend(i.links,{disclosure:{text:_.get(t,"texts.modal.disclosure"),link:_.get(t,"texts.modal.disclosureLink")}}),i}}))},function(e,t,i){"use strict";var n=i(36);Odigeo.defineWidget("special_baggage",Odigeo.Widget.extend(n.extend({viewClass:i(1152),modelClass:i(1153),init:function(){this.options=Odigeo.Utils.parseOptions(this.options),this.suscribeOnBaggageLoadedEvent()},onBaggageLoaded:function(){this.hasAnySpecialBaggage()&&(this.model.loadData(),this.view.loadView(),this.view.loadNagTemplate())}})))},function(e,t,i){"use strict";e.exports=Odigeo.View.extend({specialBaggageNagLightbox:null,selectors:{specialBaggageMainContainer:".special_baggage_main_container",specialBaggageNagWrapper:".special_baggage_nag_wrapper",specialBaggageNagContainer:".special_baggage_nag_container",addButton:".special_baggage_add_button",changeButton:".special_baggage_change_button",nagCollapsedContainer:".nag_collapsed_container",nagExpandedContainer:".nag_expanded_container",collapsedNagRowContainer:".nag_collapsed_row_container",departureNagRowContainer:".nag_departure_row_container",returnNagRowContainer:".nag_return_row_container",selectedRowContainer:".selected_row_container",dropdownContainer:".special_baggage_dropdown_container",dropdownItem:".special_baggage_dropdown_item",nagTotalPriceLabel:".nag_total_price",expandLink:".expand_link_container",nagCancel:".special_baggage_nag_cancel",nagConfirm:".special_baggage_nag_confirm"},events:{"tap @addButton":"onTapAddButton","tap @changeButton":"onTapAddButton","tap @dropdownContainer":"onTapDropdownContainer","tap @dropdownItem":"onTapDropdownItem","tap @expandLink":"onTapExpandLink","tap @nagCancel":"onTapNagCancel","tap @nagConfirm":"onTapNagConfirm","tap @specialBaggageNagContainer":"onTapSpecialBaggageNagContainer"},loadView:function(){this.$cachedSelectors.specialBaggageMainContainer.html(this.templates.specialBaggageEmpty({iconPath:Odigeo.Utils.getImageFromCDN("onefront/bluestone/icons/spot/"+this.keys.mainIcon)})),this.updateDomSelectorsToCache()},loadNagTemplate:function(){this.$cachedSelectors.specialBaggageNagWrapper.html(this.templates.specialBaggageNag({isExpandableTrip:this.model.isExpandableTrip()})),this.updateDomSelectorsToCache(),this.specialBaggageNagLightbox=new Odigeo.UIElements.Lightbox(this.$cachedSelectors.specialBaggageNagContainer,{overFullPage:!1}),this.updateDomSelectorsToCache()},renderAllNagSegmentTemplates:function(){this.renderNagSegmentTemplate(this.model.segmentType.COLLAPSED),this.model.isExpandableTrip()&&(this.renderNagSegmentTemplate(this.model.segmentType.DEPARTURE),this.renderNagSegmentTemplate(this.model.segmentType.RETURN))},renderNagSegmentTemplate:function(e){_.isObject(this.model.get(e))&&this.$cachedSelectors.specialBaggageNagContainer.find(this.selectors[e+"NagRowContainer"]).html(this.templates.specialBaggageNagItem({segmentsBaggage:this.model.getSegmentBaggage(e),segmentType:e,isOneWayTrip:this.model.isOneWayTrip(),partitionAB:this.widget.options.partitionAB}))},toggleLightbox:function(e){this.specialBaggageNagLightbox.toggle(e)},onSelectOption:function(e){var t=e.data("type"),i=e.data("passenger"),n=e.data("bag");this.model.updateBaggageData(t,i,n),this.updateNagPriceLabel(this.model.getTotalPrice()),this.renderAllNagSegmentTemplates()},updateNagPriceLabel:function(e){this.$cachedSelectors.nagTotalPriceLabel.html(Odigeo.Utils.formatCurrency(e))},closeAllNagDropdowns:function(){this.$el.find(".special_baggage_dropdown").toggleClass("odf-hidden",!0)},expandReturnSection:function(){this.$cachedSelectors.nagCollapsedContainer.toggleClass("odf-hidden"),this.$cachedSelectors.nagExpandedContainer.toggleClass("odf-hidden"),this.model.setHasExpanded(!0)},refreshMainContainer:function(){this.model.getTotalPieces()?(this.$cachedSelectors.specialBaggageMainContainer.html(this.templates.specialBaggageSelected({iconPath:Odigeo.Utils.getImageFromCDN("onefront/bluestone/icons/spot/"+this.keys.mainIconTick),totalPrice:Odigeo.Utils.formatCurrency(this.model.getTotalPrice())})),this.updateDomSelectorsToCache(),this.renderSelectedSegmentTemplates()):this.$cachedSelectors.specialBaggageMainContainer.html(this.templates.specialBaggageEmpty({iconPath:Odigeo.Utils.getImageFromCDN("onefront/bluestone/icons/spot/"+this.keys.mainIcon)}))},renderSelectedSegmentTemplates:function(){this.$cachedSelectors.selectedRowContainer.html(this.templates.specialBaggageSelectedItem({passengersBaggage:this.model.getDataForMainContainer()}))},onTapAddButton:function(){this.renderAllNagSegmentTemplates(),this.updateNagPriceLabel(this.model.getTotalPrice()),this.toggleLightbox(!0)},onTapDropdownContainer:function(e){var t=$(e.currentTarget),i=t.data("row"),n=this.$el.find(".special_baggage_dropdown_"+i),a=n.hasClass("odf-hidden");e.stopPropagation(),e.preventDefault(),this.closeAllNagDropdowns(),n.toggleClass("odf-hidden",!a),t.toggleClass("focus",a)},onTapDropdownItem:function(e){this.onSelectOption($(e.currentTarget))},onTapExpandLink:function(){this.expandReturnSection()},onTapNagCancel:function(){this.toggleLightbox(!1),this.model.cancelSelection()},onTapNagConfirm:function(){this.toggleLightbox(!1),this.model.confirmSelection(),this.refreshMainContainer()},onTapSpecialBaggageNagContainer:function(e){$(e.target).hasClass(".special_baggage_dropdown_container")||this.closeAllNagDropdowns()}})},function(e,t,i){"use strict";var n=i(36),a=i(168);e.exports=Odigeo.Model.extend(n.extend(a.extend({segmentType:{COLLAPSED:"collapsed",DEPARTURE:"departure",RETURN:"return"},loadData:function(){var e,t=this.getPassengerSegments(),i={collapsed:t.collapsed,totalPieces:0,totalPrice:0,hasExpanded:0};this.isExpandableTrip()&&(e=t.expanded,_.extend(i,{departure:e.FIRST,return:e.SECOND})),this.set(i)},getPassengerSegments:function(){var e=_.reduce(this.getBaggageAllRowsWithCid(),this.mapExpandedSegments,{collapsed:{},expanded:[]},this);return{collapsed:_.mapValues(e.collapsed,this.mapCollapsedSegmentOptions,this),expanded:e.expanded}},mapExpandedSegments:function(e,t){var i,n=t.cid,a=t.idPassenger,s=t.idRow,r=this.getAllSpecialBaggageOptions({idPassenger:a,idRow:s});return this.attachCollapsedData(e,n,t,a,s,r),_.isUndefined(e.expanded[s])&&(e.expanded[s]={}),r=this.unpackOptions(r),i=this.getEmptyOptionCid(r),e.expanded[s][a]={cid:n,cid2:"",idPassenger:a,idRow:s,options:r,isSelected:!1,isConfirmed:!1,label:this.widget.view.keys.noSpecialBag,pieces:0,price:0,selectedCid:i,confirmedCid:i},e},attachCollapsedData:function(e,t,i,n,a,s){_.isUndefined(e.collapsed[n])?e.collapsed[n]=_.extend(_.pick(i,"idPassenger","idRow"),{cid:t,cid2:"",segments:[]}):e.collapsed[n].cid2=t,e.collapsed[n].segments[a]=s},unpackOptions:function(e){var t=_.map(e,_.bind(function(e){return{cid:e.cid,price:e.get("price"),pieces:e.get("pieces"),kilos:e.get("kilos"),isSelected:!1,label:this.getOptionLabel(e,e.get("price"))}},this));return this.selectEmptyOption(t)},getOptionLabel:function(e,t){var i,n,a=e.get("piecesToShow"),s=this.widget.view.keys.noSpecialBag,r=this.widget.view.keys.addSpecialBag,o=Odigeo.Utils.formatCurrency(t),c=e.get("baggageType").toLowerCase();return 0!==a&&(i=!_.isUndefined(e.get("kilos"))&&0<e.get("kilos")?e.get("kilos"):null,n=_.isNull(i)?this.widget.view.keys[c]:this.widget.view.keys[c+"WithWeight"],s=r=a+" "+Odigeo.Utils.replaceCmsKeyArgs(n,i)),{rowLabel:r,optionLabel:s,priceLabel:o}},getEmptyOptionCid:function(e){var t=_.find(e,function(e){return 0===e.pieces});return _.get(t,"cid","")},selectEmptyOption:function(e){return _.map(e,function(e){var t=0===e.pieces;return _.extend(e,{isSelected:t})},this)},mapCollapsedSegmentOptions:function(e){var t,i=e.segments.FIRST,n=e.segments.SECOND,a=e.idPassenger,s=_.extend(e,{label:this.widget.view.keys.addSpecialBag,pieces:0,price:0,isSelected:!1,isConfirmed:!1});return _.isUndefined(n)?s.options=this.unpackOptions(i,a):(s.options=this.mapSegmentOptions(i,n),s.options=this.selectEmptyOption(s.options)),t=this.getEmptyOptionCid(s.options),s.selectedCid=t,s.confirmedCid=t,s},mapSegmentOptions:function(e,t){return _.map(e,function(e){var i,n=e.get("piecesToShow"),a=e.get("kilos"),s=this.findSecondSegmentOption(t,n,a);return _.isUndefined(s)?e:(a=e.get("kilos")===s.get("kilos")?a:0,i=2===this.widget.options.partitionAB?e.get("price")+s.get("price"):this.getAveragePrice([e,s]),{cid:e.cid,cid2:s.cid,price:i,pieces:n,kilos:a,isSelected:!1,label:this.getOptionLabel(e,i)})},this)},getAveragePrice:function(e){var t=0;return _.size(e)&&(t=_.reduce(e,function(e,t){return e+t.get("price")},0)/e.length),t},findSecondSegmentOption:function(e,t,i){var n=this.findOptionWithFilters(e,{idRow:"SECOND",pieces:t,kilos:i});return _.isUndefined(n)&&(n=this.findOptionWithFilters(e,{idRow:"SECOND",pieces:t})),n},findOptionWithFilters:function(e,t){return _.find(e,function(e){return _.every(t,function(t,i){return e.get(i)===t})})},getSegmentBaggage:function(e){return this.get(e)},getAllBaggage:function(){return this.isExpandableTrip()?_.values(this.getSegmentBaggage(this.segmentType.DEPARTURE)).concat(_.values(this.getSegmentBaggage(this.segmentType.RETURN))):this.getSegmentBaggage(this.segmentType.COLLAPSED)},updateBaggageData:function(e,t,i){var n=this.selectOption(e,t,i);this.updateModelAfterSelect(e,t,n)},selectOption:function(e,t,i){var n=this.get(e),a=n[t],s=a.options,r={};_.map(s,function(e){return e.isSelected=e.cid===i,e.isSelected&&(r=e),e});var o=0<r.pieces;return _.extend(a,{options:s,isSelected:o,label:r.label.rowLabel,price:r.price,pieces:r.pieces,selectedCid:r.cid}),this.set(e,n),r},updateModelAfterSelect:function(e,t,i){this.isExpandableTrip()&&e===this.segmentType.COLLAPSED&&(this.selectOption(this.segmentType.DEPARTURE,t,i.cid),this.selectOption(this.segmentType.RETURN,t,i.cid2)),this.updatePriceAndPieceCount()},updatePriceAndPieceCount:function(){var e=this.getAllBaggage(),t=this.getSumOfCollectionProperty(e,"price"),i=this.getSumOfCollectionProperty(e,"pieces");this.set("totalPieces",i),this.set("totalPrice",t)},getSumOfCollectionProperty:function(e,t){return _.reduce(e,function(e,i){return e+i[t]},0)},getTotalPieces:function(){return this.get("totalPieces")},getTotalPrice:function(){return this.get("totalPrice")},getSelectedOptionPieces:function(e,t){var i=this.get(e)[t].options,n=_.find(i,function(e){return!0===e.isSelected});return _.isUndefined(n)?0:n.pieces},setHasExpanded:function(e){this.set("hasExpanded",e)},hasExpanded:function(){return this.get("hasExpanded")},isExpandableTrip:function(){return!this.isAnItineraryTrip()&&!this.isOneWayTrip()},cancelSelection:function(){this.hasExpanded()?(this.cancelSegment(this.segmentType.DEPARTURE),this.cancelSegment(this.segmentType.RETURN)):this.cancelSegment(this.segmentType.COLLAPSED)},cancelSegment:function(e){var t=this.get(e);_.each(t,function(t){this.updateBaggageData(e,t.idPassenger,t.confirmedCid)},this)},confirmSelection:function(){this.confirmSegment(this.segmentType.COLLAPSED),this.isExpandableTrip()&&(this.confirmSegment(this.segmentType.DEPARTURE),this.confirmSegment(this.segmentType.RETURN))},confirmSegment:function(e){var t=this.get(e);_.map(t,function(e){return e.isConfirmed=e.isSelected,e.confirmedCid=e.selectedCid,e}),this.set(e,t)},getDataForMainContainer:function(){return this.isExpandableTrip()&&this.hasExpanded()?this.getExpandedDataForMainContainer():this.getCollapsedDataForMainContainer()},getCollapsedDataForMainContainer:function(){var e,t,i={},n=this.getSegmentBaggage(this.segmentType.COLLAPSED);return _.each(n,function(n){i[n.idPassenger]=[],e=n.pieces<=0,t=e?this.widget.view.keys.noSpecialBag:n.label,e||this.isOneWayTrip()||(t+=" "+this.widget.view.keys.allFlightsLabel),i[n.idPassenger].push({label:t,noBags:e})},this),i},getExpandedDataForMainContainer:function(){var e,t,i={},n=this.getSegmentBaggage(this.segmentType.DEPARTURE),a=this.getSegmentBaggage(this.segmentType.RETURN);return _.each(n,function(n){i[n.idPassenger]=[];var s=a[n.idPassenger];n.pieces===s.pieces?(e=n.pieces<=0,t=e?this.widget.view.keys.noSpecialBag:n.label+" "+this.widget.view.keys.allFlightsLabel):(e=!1,0<n.pieces&&(t=n.label+" "+this.widget.view.keys.departureLabel),0<s.pieces&&(t=s.label+" "+this.widget.view.keys.returnLabel)),i[n.idPassenger].push({label:t,noBags:e})},this),i}})))},function(e,t,i){"use strict";Odigeo.defineWidget("prime_ancillaries_module",Odigeo.Widget.extend({modelClass:i(1155),viewClass:i(1157),addProductToPbd:function(e){this.model.addProductToPbd(e)},getPrimeAncillariesData:function(){return this.model.getPrimeAncillariesData()},manageAddMembershipError:function(){this.model.revertQuantity()},membershipAddedSuccessfully:function(){this.model.addedSuccessfullyActions()},onPaymentStep:function(){this.model.set("paymentStep",!0),this.model.updatePaymentStepStatus()},onOpenPrimeSubscriptionLightBox:function(){this.view.toggleSubscribeNag()}}))},function(e,t,i){"use strict";var n=i(620),a=i(1156),s=i(94);function r(e,t){return _.isFunction(e)?_.bind(e,t):_.constant(null)}e.exports=Odigeo.Model.extend(s.extend({defaults:{paymentStep:null,userSubscribed:null,data:null,allPrice:0,isDiscountedPriceSelected:!1,allPriceFromBackend:0,onePrice:0,onePriceFromBackend:0,quantity:0,conceptKey:"membershipsubscription",conceptLabel:"",type:"MEMBERSHIP_SUBSCRIPTION",passengersInfoDTO:null},currentAction:null,url:function(){return Odigeo.Settings.getProperty("membershipServiceFormatter")(this.currentAction.getUrl())},getDataRequestSettings:function(){return{data:this.get("data"),dataType:"json",contentType:"application/json",type:this.currentAction.getMethod(),success:r(this.currentAction.requestSuccess,this),error:r(this.currentAction.requestError,this),complete:r(this.currentAction.requestComplete,this)}},getUserType:function(e){this.set("data",e),this.currentAction=n,this.performRequest()},getPassengerInfo:function(){this.currentAction=a,this.fetch()},getPrimeAncillariesData:function(){return{isDiscountedPriceSelected:this.get("isDiscountedPriceSelected"),isSubscriptionAdded:0<this.get("quantity")}},setInitValues:function(){var e=this.widget.view.getPrimePriceWithoutFormat();this.set({allPriceFromBackend:e,onePriceFromBackend:e})},revertQuantity:function(){var e=this.get("quantity");this.set("quantity",1===e?0:1)},addedSuccessfullyActions:function(){var e=1===this.get("quantity");Odigeo.trigger(this.widget.id+":updateMembershipPricePayment",e)},addProductToPbd:function(e){this.set({allPrice:e?this.get("allPriceFromBackend"):0,onePrice:e?this.get("onePriceFromBackend"):0}),this.addItemToPricemanagerCollection(this.attributes),e?this.widget.view.callBackAddProductActions():this.widget.view.callBackRemoveProductActions(),Odigeo.trigger(this.widget.id+":refreshPdbPrices")},updateMembershipProduct:function(e){this.set("quantity",e?1:0);var t={password:this.get("password"),quantity:this.get("quantity"),email:this.get("passengersInfoDTO").buyerDTO.mail};e&&this.getNames(this.getTravellerFromTravellersList(),t),Odigeo.trigger(this.widget.id+":updateMembershipProduct",t)},getNames:function(e,t){_.isObject(e)&&(t.name=e.middleName?e.name+" "+e.middleName:e.name,t.lastName=e.secondLastName?e.firstLastName+" "+e.secondLastName:e.firstLastName)},updatePageStatus:function(e){this.set({isDiscountedPriceSelected:!e}),Odigeo.trigger(this.widget.id+":updatePageStatus",e)},updatePaymentStepStatus:function(){0===this.get("quantity")&&Odigeo.trigger(this.widget.id+":updatePaymentStepStatus",!0)},getTravellerFromTravellersList:function(){return _.find(this.get("passengersInfoDTO").travellers,function(e){return e.travellerId.toString()===this.get("memberSelected")},this)}}))},function(e,t,i){"use strict";e.exports={getUrl:function(){return"getpassengerinfo"},getMethod:function(){return"GET"},requestSuccess:function(e){Odigeo.trigger(this.widget.id+":getPassengerInfoOk",e)},requestError:function(){Odigeo.trigger(this.widget.id+":getPassengerInfoFail")}}},function(e,t,i){"use strict";var n=i(81),a=i(0),s="isUserSubscribedItem";e.exports=Odigeo.View.extend({selectors:{allInputs:'[data-name]:not([type="hidden"])',primeContainer:".prime_child_container",primeMoreInfoLink:".prime_more_info_link",primeMoreInfoSection:".prime_more_info_section",primeSubscribeBtn:".prime_subscribe_btn",primeSubscriptionContainer:".subscription_prime_container",primeSubscriptionLightBox:".prime_subscription_lightbox",primeTermsConditions:".prime_terms_conditions",addPrimeProduct:".add_membership_product",primeSubscriptionClose:".prime_subscription_close_icon",membershipPassword:".membership_password",membershipPasswordContainer:".membership_password_container",memberSelectTravellers:".member_select_travellers",openRemovePrimeLightbox:".prime_feedback_remove",removePrimeLightbox:".remove_prime_lightbox",cancelRemovePrime:".close_remove_prime",confirmRemovePrime:".confirm_remove_prime",confirmRemovePrimeTxt:".confirm_remove_prime_text",expandDisplayC:".prime_expand_subscription_c",expandedContentC:".prime_c_content_expanded",openPerksInfo:".prime_open_membership_perks_info",pwdErrorMsg:".error_pwd_message",subscriptionBtnTxt:".subscription_btn_text"},events:{"tap @primeMoreInfoLink":"expandMoreInfo","tap @primeSubscribeBtn":"toggleSubscribeNag","tap @primeSubscriptionClose":"toggleSubscribeNag","tap @addPrimeProduct":"onAddMembershipProduct","tap @openRemovePrimeLightbox":"onToggleRemovePrimeLightbox","tap @cancelRemovePrime":"onToggleRemovePrimeLightbox","tap @confirmRemovePrime":"onRemovePrimeSubscription","tap @expandDisplayC":"onExpandDisplayC","tap @openPerksInfo":"onOpenMembershipPerksInfo","tap @primeTermsConditions":"onPrimeTermsConditions"},init:function(){this.opts=Odigeo.parseOptions(this.widget.options),this.updateKeys(),this.updateCachedViewListener(),this.model.getPassengerInfo()},initTemplate:function(){var e=this.model.get("passengersInfoDTO");_.isObject(e)&&_.isObject(e.buyerDTO)&&!_.isEmpty(e.travellers)&&(this.initRender(),this.renderSubscriptionLightBox(),this.model.setInitValues(),this.model.updatePageStatus(this.opts.isPriceWithoutDiscountSelected))},initRender:function(){return this.getUserSubscribed()?this.renderSuccessFeedback():this.renderPrimeAncillaries()},updateKeys:function(){this.opts.membershipDiscountFeeFmtd=_.trim(this.opts.membershipDiscountFeeFmtd,"- "),this.keys.primeInitialDesc=Odigeo.Utils.replaceCmsKeyArgs(this.keys.primeInitialDesc,this.opts.membershipDiscountFeeFmtd),this.keys.primeDescPayment=Odigeo.Utils.replaceCmsKeyArgs(this.keys.primeDescPayment,this.opts.membershipDiscountFeeFmtd),this.keys.primeInitialDescC=Odigeo.Utils.replaceCmsKeyArgs(this.keys.primeInitialDescC,this.opts.membershipDiscountFeeFmtd),this.keys.primeDescPaymentC=Odigeo.Utils.replaceCmsKeyArgs(this.keys.primeDescPaymentC,this.opts.membershipDiscountFeeFmtd),this.keys.primeExpandedDescriptionC=Odigeo.Utils.replaceCmsKeyArgs(this.keys.primeExpandedDescriptionC,this.opts.membershipDiscountFeeFmtd)},onExpandDisplayC:function(){this.$cachedSelectors.expandedContentC.slideToggle(0,"swing"),this.$cachedSelectors.expandDisplayC.toggleClass("odf-icon-arrow-up odf-icon-arrow-down"),this.$cachedSelectors.expandedContentC.toggleClass("odf-hidden");var e=this.$cachedSelectors.expandedContentC.hasClass("odf-hidden")?"unlocked_widget_close_sce:"+this.getTrackingLabel():"unlocked_widget_open_sce:"+this.getTrackingLabel();a.trackEventWithCategory("flights_pay_page","unlocked",e)},updateCachedViewListener:function(){this.listenTo(this.model,"change:paymentStep",this.onUserSubscribedChange),this.listenTo(this.model,"change:userSubscribed",this.onUserSubscribedChange),this.listenTo(this.model,"change:passengersInfoDTO",this.initTemplate)},getUserSubscribed:function(){return this.model.get("userSubscribed")||Odigeo.Utils.parseJson(Odigeo.Session.storage.getItem(s))},onOpenMembershipPerksInfo:function(){Odigeo.trigger(this.widget.id+":openMembershipPerksInfo"),a.trackEventWithCategory("flights_pay_page","unlocked","know_more_clicked_pay_sce:"+this.getTrackingLabel())},onUserSubscribedChange:function(){if(_.isObject(this.model.get("passengersInfoDTO")))return this.getUserSubscribed()?this.renderSuccessFeedback():this.renderPrimeAncillaries()},onToggleRemovePrimeLightbox:function(e){if(this.loadingRemoveSubscriptionBtn(!1),this.$cachedSelectors.removePrimeLightbox.toggleClass("open"),e)if(this.$cachedSelectors.removePrimeLightbox.hasClass("open")){var t=this.getMemberInfo().isLogged?"login-added":"added";a.trackEventWithCategory("flights_pay_page","unlocked","prime_mem_remove_prime_sce:"+t)}else a.trackEventWithCategory("flights_pay_page","unlocked","unlocked_remove_nag_cancel_prime_added_sce:"+this.getTrackingLabel())},onRemovePrimeSubscription:function(){this.model.updateMembershipProduct(!1),this.loadingRemoveSubscriptionBtn(!0)},toggleSubscribeNag:function(e){this.clearInputs(),this.$cachedSelectors.primeSubscriptionContainer.toggleClass("open"),this.loadingSubscriptionBtn(!1),_.isObject(e)&&$(e.target).hasClass("prime_subscribe_btn")&&a.trackEventWithCategory("flights_pay_page","unlocked","prime_mem_view_"+this.getSubscriptionTrackingLabel())},loadingSubscriptionBtn:function(e){this.$cachedSelectors.addPrimeProduct.attr("disabled",e),this.$cachedSelectors.addPrimeProduct.toggleClass("loading",e);var t=e?0:1;this.$cachedSelectors.subscriptionBtnTxt.css("opacity",t)},loadingRemoveSubscriptionBtn:function(e){this.$cachedSelectors.confirmRemovePrime.toggleClass("loading",e),this.$cachedSelectors.confirmRemovePrime.attr("disabled",e);var t=e?0:1;this.$cachedSelectors.confirmRemovePrimeTxt.css("opacity",t)},clearInputs:function(){this.clearPasswordErrors(),this.$cachedSelectors.membershipPassword.val("")},clearPasswordErrors:function(){this.$cachedSelectors.membershipPasswordContainer.removeClass("invalid"),this.$cachedSelectors.pwdErrorMsg.val("")},setMemberSelected:function(){this.model.set({password:this.$el.find(this.$cachedSelectors.membershipPassword).val(),memberSelected:this.$el.find(this.$cachedSelectors.memberSelectTravellers).val()})},showPasswordError:function(){this.$cachedSelectors.membershipPasswordContainer.addClass("invalid");var e=_.isEmpty(this.$cachedSelectors.membershipPassword.val())?this.keys.lightBoxPwdEmpty:this.keys.lightBoxPwdIncorrectFmt;this.$cachedSelectors.pwdErrorMsg.text(e)},getSubscriptionTrackingLabel:function(){return this.getMemberInfo().isLogged?"log-no-sub":_.isEqual(this.getMemberInfo().status,"REGISTERED")?"no-log-no-sub-upg":"no-log-no-sub"},onAddMembershipProduct:function(){var e=n.checkValidity(this.$el.find(this.$cachedSelectors.allInputs),this.$widget);_.isEmpty(e)?(this.loadingSubscriptionBtn(!0),this.setMemberSelected(),this.model.updateMembershipProduct(!0),a.trackEventWithCategory("flights_pay_page","unlocked","prime_mem_select_"+this.getSubscriptionTrackingLabel())):this.showPasswordError(e[0])},callBackAddProductActions:function(){this.toggleSubscribeNag(),Odigeo.Session.storage.setItem(s,!0),this.model.set("userSubscribed",!0)},callBackRemoveProductActions:function(){Odigeo.Session.storage.setItem(s,!1),this.model.set("userSubscribed",!1),this.onToggleRemovePrimeLightbox(),a.trackEventWithCategory("flights_pay_page","unlocked","unlocked_remove_nag_confirm_prime_added_sce:"+this.getTrackingLabel())},getTrackingLabel:function(){return!1===Odigeo.Utils.parseJson(Odigeo.Session.storage.getItem(s))?this.getMemberInfo().isLogged?"login-remove":"remove":!0===Odigeo.Utils.parseJson(Odigeo.Session.storage.getItem(s))?this.getMemberInfo().isLogged?"login-added":"added":this.getMemberInfo().isLogged?this.opts.isPriceWithoutDiscountSelected?"login-no-prime":"login-prime":this.opts.isPriceWithoutDiscountSelected?"no-prime":"prime"},onPrimeTermsConditions:function(){a.trackEventWithCategory("flights_pay_page","unlocked","unlocked_terms_and_conditions_sce:"+this.getTrackingLabel()+"_widget")},expandMoreInfo:function(){this.$cachedSelectors.primeMoreInfoLink.addClass("odf-hidden"),this.$cachedSelectors.primeMoreInfoSection.removeClass("odf-hidden"),a.trackEventWithCategory("flights_pay_page","unlocked","more_info_clicked_sce:"+this.getTrackingLabel())},isPrimeDisplayC:function(){return 3!==this.opts.membershipPrimeAncillaryDisplayD},getPrimeBenefits:function(){return this.isPrimeDisplayC()?[this.keys.primeBenefitsPerks1,this.keys.primeBenefitsPerks2,this.keys.primeBenefitsPerks3]:{perkOne:this.keys.primeBenefitsCPerks1,perkTwo:this.keys.primeBenefitsCPerks2,perkThree:this.keys.primeBenefitsCPerks3,perkFour:this.keys.primeBenefitsCPerks4}},getPrimePrice:function(){return this.opts.membershipSubscriptionPriceFmtd},getPrimePriceWithoutFormat:function(){return this.opts.membershipSubscriptionPrice},getPrimeDescriptionMessage:function(){var e=this.model.get("paymentStep")||!_.isNull(Odigeo.Utils.parseJson(Odigeo.Session.storage.getItem("isAncillaryStepOpenFirstTime")));return this.isPrimeDisplayC()?e?this.keys.primeDescPayment:this.keys.primeInitialDesc:e?this.keys.primeDescPaymentC:this.keys.primeInitialDescC},getMemberInfo:function(){return{email:this.model.get("passengersInfoDTO").buyerDTO.mail,travellers:this.model.get("passengersInfoDTO").travellers,status:this.model.get("passengersInfoDTO").userType,isLogged:this.model.get("passengersInfoDTO").userLogged}},renderPrimeAncillaries:function(){return this.isPrimeDisplayC()?this.renderPrimeAncillariesB():this.renderPrimeAncillariesC()},renderPrimeAncillariesB:function(){var e=this.model.get("userSubscribed");this.setTemplate(this.$cachedSelectors.primeContainer,"primePayB",{primeDesc:!1===e?this.keys.primeDescPayment:this.getPrimeDescriptionMessage(),primeHeaderPrice:this.getPrimePrice(),primeBenefits:this.getPrimeBenefits()})},renderPrimeAncillariesC:function(){var e=this.model.get("userSubscribed");this.setTemplate(this.$cachedSelectors.primeContainer,"primePayC",{primeDesc:!1===e?this.keys.primeDescPaymentC:this.getPrimeDescriptionMessage(),primeSubscriptionPriceC:Odigeo.Utils.replaceCmsKeyArgs(this.keys.primeSubscriptionPriceC,this.getPrimePrice()),primeBenefits:this.getPrimeBenefits()})},renderSubscriptionLightBox:function(){this.setTemplate(this.$cachedSelectors.primeSubscriptionContainer,"subscriptionLightbox",{member:this.getMemberInfo(),lightBoxHeaderNewUserFreeAcc:Odigeo.Utils.replaceCmsKeyArgs(this.keys.lightBoxHeaderNewUserFreeAcc,this.getPrimePrice()),lightBoxHeaderLoggedFreeAcc:Odigeo.Utils.replaceCmsKeyArgs(this.keys.lightBoxHeaderLoggedFreeAcc,this.getPrimePrice()),lightBoxHeaderNotLoggedFreeAcc:Odigeo.Utils.replaceCmsKeyArgs(this.keys.lightBoxHeaderNotLoggedFreeAcc,this.getPrimePrice()),lightBoxPwd:_.isEqual(this.getMemberInfo().status,"REGISTERED")?this.keys.lightBoxNotLoggedPwd:this.keys.lightBoxNewUserPwd,lightBoxPwdPlaceholder:_.isEqual(this.getMemberInfo().status,"REGISTERED")?this.keys.lightBoxNotLoggedPwdPlaceholder:this.keys.lightBoxNewUserPwdPlaceholder}),this.updateDomSelectorsToCache()},renderSuccessFeedback:function(){this.setTemplate(this.$cachedSelectors.primeContainer,"feedback",{memberMail:this.getMemberInfo().email})}})},function(e,t,i){"use strict";Odigeo.defineWidget("progress_bar",Odigeo.Widget.extend({viewClass:i(1159),setPaymentState:function(e){this.view.setPaymentState(e)}}))},function(e,t,i){"use strict";e.exports=Odigeo.View.extend({selectors:{steps:".progress_meta_step"},init:function(){this.opts=Odigeo.parseOptions(this.widget.options),this.setStepStates()},resetStates:function(){this.$cachedSelectors.steps.removeClass("odf-progress-metas-done odf-progress-metas-active odf-progress-metas-pending")},setStepStates:function(){this.resetStates();var e=this.opts.step,t=this.$cachedSelectors.steps;t.slice(0,e-1).addClass("odf-progress-metas-done"),t.slice(e-1,e).addClass("odf-progress-metas-active"),t.slice(e).addClass("odf-progress-metas-pending")},setPaymentState:function(e){this.opts.step=e,this.setStepStates()}})},function(e,t,i){"use strict";Odigeo.defineWidget("search_combine_message",Odigeo.Widget.extend({viewClass:i(1161)}))},function(e,t,i){"use strict";e.exports=Odigeo.View.extend({init:function(){this.enhanceHint()},selectors:{popupContainer:".search_combine_popup"},enhanceHint:function(){Odigeo.UIElements.hint.enhance(Odigeo.History.getPageNameFromFragment(),this.$cachedSelectors.popupContainer,{events:{tap:!0},googleAnalyticsOnOpen:{type:"trackEvent",data:{action:"search_combine_widget",label:"moreinfo_click"}}})}})},function(e,t,i){"use strict";i(306),i(773),i(780),i(783),i(798),i(801),i(804),i(821),i(824),i(827),i(832),i(308)},function(e,t,i){"use strict";var n=i(0),a=i(7),s=i(504),r=i(332),o=i(835),c=i(976),d=i(51),l=i(977),g=i(498),h=i(612).notificationService(),u=i(142).getInstance(),p=i(100).getInstance(),f=i(14).getInstance(),m=i(50).isUserDTOMember,b=i(322),y=i(59).getInstance({load:!0}),v=i(56),S=i(40);Odigeo.Router.handlers.details=function(e){Odigeo.Session.set("isAccommodationPostBooking",!1);var t=Odigeo.autoloadWidgets({dpWaitingPage:["dpwaiting-page","dp_waiting_page"],accommodationDetails:["accommodation-details","accommodation_details"],nagManager:["nagmanager","nagmanager"],getMembershipSubscription:["membership-subscription","membership_subscription"],passengersModifier:["passengers-update","passengers_update"],smartNagBaggage:["smart-nag-baggage","smart_nag_baggage"]}),C="sidebarsummary"===$(".side_summary_details").data("type"),w=Odigeo.autoloadWidgetsAsync({seatMapSelectionManager:["seatmap-selection-manager","seatmap_selection_manager"],aircraftMapManager:["aircraft_map_manager","aircraftmap_manager"],getSidebar:C?["sidebar-summary","sidebar_summary"]:["trip-summary-price","trip_summary_price"],getServiceSummary:["service-summary","service_summary"],getMembershipManager:["membership-manager","membership_manager"],getMembershipPerksInfoLightbox:["membership-perks-info-lightbox","membership_perks_info_lightbox"],getBaggageManager:["baggages-container0","baggagesmanager"],getUsersManager:["users-manager","usersmanager"],getAccommodationSearchManager:["accommodation-search-manager","accommodation_search_manager"],getMembershipRegister:["membership-register","membership_register"],getMembershipSmoothSubscription:["membership-smooth-subscription","membership_smooth_subscription"],getShoppingCartManager:["shoppingcart-manager","shoppingcartmanager"],getHandBaggageSummary:["hand-baggage-summary","hand_baggage_summary"],getBoardingOptions:["boarding-options","boarding_options"],getMembershipSubscriptionOnTop:["membership-subscription-on-top","membership_subscription_on_top"],getSeatsLeftOnTop:["seatsLeftOnTopPaymentPage","seats_left_on_top"],getCollapsibleFlightSummary:["collapsible-flight-summary","collapsible_flight_summary"],getSessionRecorder:["session-recorder","session_recorder"]}),O=S({login:["login-header",v]}),T=_.partial(i(50).openLoginForm,n,O),P=$("html,body"),E=$(window),k=$(".home_main_layout"),A=$("#logo"),D=Odigeo.Utils.isRequestApp("dp"),I=Odigeo.Utils.isRequestApp("upsell"),x=Odigeo.Session.get("before-page"),B=i(147),R=!1,M=!1;b.resetPolicySession();var N=$(".waiting_page"),L=!1,U=!1,F=!1,W=!1,H=void 0,q=new B({directFlightSearchManager:["direct_flights_search_manager","direct_flights_search_manager"],flightTypeSearchManager:["flight_type_search_manager","flight_type_search_manager"],passengersSelectorSearchManager:["passengers_search_manager","passengers_search_manager"],onelineButtonSearch:["onelinebutton_search_manager","onelinebutton_search_manager"],onelineCabinClass:["oneline_cabinclass","oneline_cabinclass"],itinerarySearchManager:["itinerary_search_manager","itinerary_search_manager"]},{searchParam:"searchParameters",omittedParams:["airlinesCodes"]});Odigeo.Router.eventController=$.extend(!0,Odigeo.Router.eventController,Odigeo.Router.handlers.userEventController,Odigeo.Router.handlers.errorManagerEventController,Odigeo.Router.handlers.searchFlightsEventController,Odigeo.Router.handlers.repriceManagerEventController,{globalEvents:{},viewEvents:_.extend(o.viewEvents,{"shoppingcart-manager:requestCompletedSuccessfully":"onSCManagerRequestCompletedSuccessfully","shoppingcart-manager:successDeleteHotelFromCart":"onSuccessDeleteHotelFromCart","shoppingcart-manager:errorDeleteHotelFromCart":"onErrorDeleteHotelFromCart",getTotalByFullprice:"onTotalByFullPrice",continueTransitionToPayment:"onContinueTransitionToPayment","global:userNotLogged":"onNotLoggedUser","global:userLogged":"onLoggedUser","global:userNotLoggedRemembered":"onNotLoggedUserRemembered","users-manager:updateAccountInfoOk":"onUpdateTraveller","users-manager:updateAccountInfoWithError":"onResetTravellersData","users-manager:updateAccountInfoError":"onResetTravellersData","users-manager:loginOk":"onRemembermeLoginOk","users-manager:loginWithError":"onRemembermeLoginError","users-manager:loginError":"onRemembermeLoginError","global:repricingShown":"onRepricing","seatmap:initInspectlet":"onInitInspectlet","passengers_manager:completed":"onPassengerPageComplete","expanded-summary:panelCollapsed":"onExpandedSummaryClosed","collapsed-summary:panelCollapsed":"onCollapsedSummaryClosed","passengers_manager:travellerSelected":"onHideTravellerSelected","passengers_manager:travellerNotSelected":"onShowTravellerSelected","passengers_manager:submitUserResultRequest":"onSubmitUserResultRequest","passengers_manager:addTravellerData":"onAddTravellerData","passengers_manager:sendNameToSidebar":"onSendNameToSidebar","passengers_manager:deleteMembership":"onDeleteMembership","passengers_manager:continueButtonBinding":"continueButtonBinding","passengers_manager:scrollAndSelectPrime":"onScrollAndSelectPrime","passengers_manager:openLoginForm":"onOpenLoginForm","passengers_manager:closeForceLoginPopup":"onCloseForceLoginPopup","onelinebutton_search_manager:editSearch":"onEditSearch","oneline-search-manager:showOnelineSearch":"onShowOnelineSearch","sidebar-summary:openFlightDetails":"onOpenFlightDetails","sidebar-summary:addPaxSidebar":"onAddPaxSidebar","seatmap-selection-manager:seatMapSelected":"onSeatMapSelection","seatmap-selection-manager:scrollToSeatMapSelection":"onScrollToSeatMapSelection","seatmap-selection-manager:openAircraftMap":"onOpenAircraftMap","seatmap-selection-manager:showDeleteAllDialog":"onShowDeleteAllDialog","seatmap-selection-manager:resetSeatmapSelection":"onResetSeatmapSelection","seatmap-selection-manager:severalRetries":"onSCManagerRequestCompletedSuccessfully","seatmap-selection-manager:showNoSeatsSelectedDialog":"onShowNoSeatsSelectedDialog","seatmap-selection-manager:nagSubscribe":"onNagSubscriber","aircraftmap_manager:closeAircraftMap":"onCloseAircraftMap","aircraftmap_manager:scrollToSeatMapSelection":"onScrollToSeatMapSelection","aircraftmap_manager:tapNavigateButton":"onTapAircraftMapNavigateButton","aircraftmap_manager:keepSeatMapSelection":"onKeepSeatMapSelection","aircraftmap_manager:removeSeatMapSelection":"onRemoveSeatMapSelection","aircraftmap_manager:showNoSeatsSelectedDialog":"onShowNoSeatsSelectedDialog","aircraftmap_manager:closeSeatMap":"onCloseAircraftMap","aircraftmap_manager:updateSidebarSummary":"onSelectSeatUpdateSidebarSummary","aircraftmap_manager:updateSeatSelectionFees":"onUpdateSeatSelectionFees","seatmap_selection_manager:updateSidebarSummary":"onSelectSeatUpdateSidebarSummary","dpwaiting-page:cleanDpWaitingPage":"cleaningDpWaitingPage","dpwaiting-page:hidePageOverDpWaitingPage":"hiddenPageOverDpWaitingPage","flight-details:toggleDetails":"onDpToggleAccommodationDetails","flight-details-open-search:toggleDetails":"onDpToggleAccommodationDetails","trip-summary-price:sendUserToDpResults":"sendUserToDpResults","trip-summary-price:removeHotel":"removeHotelFromCart","trip-summary-price:toggleDetails":"onDpToggleAccommodationDetails","sidebar-summary:toggleDetails":"onDpToggleAccommodationDetails","sidebar-summary:removeHotel":"removeHotelFromCart","sidebar-summary:sendUserToDpResults":"sendUserToDpResults","trip-summary-price:addPaxSidebar":"onAddPaxSidebar","flight-details:closeAccommodation":"closeAccommodationDeTails","nagmanager:addBaggages":"onNagManagerAddBaggages","nagmanager:continue":"onNagManagerContinue","nagmanager:evenUpBaggageSelection":"onEvenUpBaggageSelection","baggagesmanager:baggageSelectorOpened":"onBaggageSelectorOpened","baggagesmanager:passengerValid":"displayPromotionBadgeView","baggagesmanager:displayDiscountPercentage":"displayDiscountPercentage","nagmanager:goToSeats":"onGoToSeats","nagmanager:addPrime":"onLaunchTravellersValidations","nagmanager:requestXsellAccommodationResults":"onRequestXsellAccommodationResults","detail-search-summary:showHeaderBackgroundSearchSummary":"onRemoveBackgroundHeaderSearchSummary","seatmap-selection-manager:passengerCollectionIsPopulated":"onPassengerCollectionPopulated","seatmap-selection-manager:disablePristineMoveThrough":"onDisablePristineMoveThrough","passengers-update:addPaxCompleteSuccessful":"onAddPaxCompleteSuccessful","membership-subscription:launchTravellersValidations":"onLaunchTravellersValidations","membership-subscription:launchTravellersValidationsForRegister":"onLaunchTravellersValidationsForRegister","passengers-update:addPaxCompleteError":"onAddPaxCompleteError","shoppingcart-manager:requestCompletedWithError":"onSCManagerRequestCompletedWithError","membership:refreshWidgets":"onMembershipRefreshWidgets","membership:refreshSubscription":"onMembershipRefreshSubscription","membership:updatePremiumDisclaimers":"onUpdatePremiumDisclaimers","membership-manager:getUserTypeOk":"onGetUserTypeResponse","membership-manager:getUserTypeFail":"onGetUserTypeResponse","membership-manager:addMembershipOk":"onAddMembershipResponse","membership-manager:addMembershipFail":"onAddMembershipResponse","membership-manager:addMembershipComplete":"onAddMembershipResponseFinished","membership-subscription:membershipSubscriptionChange":"onMembershipSubscriptionChange","membership-smooth-subscription:membershipSubscriptionChange":"onMembershipSubscriptionChange","membership-smooth-subscription:smoothShowEmail":"onSmoothShowEmail","membership-smooth-subscription:validationComplete":"onValidationComplete","membership-smooth-subscription:showPassengerIndicator":"onShowPassengerIndicator","membership-smooth-subscription:showPassengerTitleIndicator":"onShowPassengerTitleIndicator","membership-smooth-subscription:fieldsTemplateActive":"onSmoothFieldsTemplateActive","membership-smooth-subscription:smoothSubscriptionAdded":"onSmoothSubscriptionAdded","membership-subscription:openLoginForm":"onOpenLoginForm","membership-subscription:openMembershipPerksInfoLightbox":"onOpenMembershipPerksInfoLightbox","membership-subscription:getTravellersSelected":"onGetTravellersSelected","membership-subscription:membershipSubscriptionStored":"onMembershipSubscriptionStored","membership-smooth-subscription:membershipSubscriptionStored":"onMembershipSubscriptionStored","membership-smooth-subscription:openMembershipPerksInfoLightbox":"onOpenMembershipPerksInfoLightbox","membership-smooth-subscription:openLoginForm":"onOpenLoginForm","membership-subscription:openOrCloseMembershipDialog":"onOpenOrCloseMembershipDialog","membership-subscription-on-top:openMembershipPerksInfoLightbox":"onOpenMembershipPerksInfoLightbox","membership-register:addProduct":"onMembershipRegisterAddProduct","membership-register:createAccount":"onMembershipRegisterCreateAccount","membership-smooth-subscription:createAccount":"onMembershipRegisterCreateAccount","membership-smooth-subscription:smoothSubscriptionPCIErrorPopupOpened":"onSmoothSubscriptionPCIErrorPopupOpened","membership-smooth-subscription:simulatePriceLoading":"onSimulatePriceLoading","membership-register:openLoginForm":"onOpenLoginForm","membership-register:blockBuyerEmail":"onBlockBuyerEmail","membership-register:scrollToEmail":"onScrollToEmail","membership-register:highlightMembershipWidget":"onHighlightMembershipWidget","membership-register:unlockEmail":"onUnlockEmail","membership-subscription:unlockEmail":"onUnlockEmail","users-manager:registerOk":"onRegisterEvent","users-manager:registerWithError":"onRegisterEvent","users-manager:registerError":"onRegisterEvent","membership-perks-info-lightbox:openOrClosePerksMembershipDialog":"onOpenOrCloseMembershipDialog","membership-perks-info-lightbox:launchTravellersValidations":"onLaunchTravellersValidations","sidebar-summary:openLoginForm":"onOpenLoginForm","share-itinerary-details:onShareEmailSearch":"onShareEmailSearch","recaptcha:loaded":"onRecaptchaLoaded","promotional-codes:updatePromocode":"onUpdatePromocode","baggagesmanager:updateSelectedBaggageFromSmartnag":"onUpdateSelectedBaggageFromSmartnag","accommodation-search-manager:resultsLoaded":"onSuccessAccommodationSearch","accommodation-search-manager:resultsNotAvailable":"onErrorAccommodationSearch","smart-nag-baggage:showSmartNagBaggage":"onShowSmartNagBaggage","fare-upgrade-selector:fareUpgradeSelected":"onFareUpgradeSelected","fare-upgrade-selector:fareUpgradeUnselected":"onFareUpgradeUnselected","boarding-options:onBoardingOptionSelected":"onBoardingOptionSelected","boarding-options:onBoardingOptionInteracted":"onBoardingOptionInteracted","collapsible-flight-summary:changeCurrentSearch":"onShowSearchBar","oneline-search-manager:hideSearchBar":"toggleSearchBar","boarding-options:showPriorityBoardingNag":"onShowPriorityBoardingNag","boarding-options:boardingOptionsLoaded":"onBoardingOptionsLoaded"}),eventHandlers:_.extend(o.eventHandlers,{onUpdatePromocode:function(e){w.getSidebar().execute("updatePromocode",e)},onMembershipSubscriptionStored:function(e){w.getMembershipPerksInfoLightbox().execute("updateSubscriptionPrice",e)},onSuccessAccommodationSearch:function(e){Odigeo.Session.set("intPageAccommodationResults",JSON.stringify(e)),t.nagManager().execute("showHotelsReminderNag")},onErrorAccommodationSearch:function(){"roundTrip"===JSON.parse(Odigeo.Session.get("searchParameters")).type&&n.trackEvent("nags","nag_hotel_upsell_not_shown_sesionerror")},onShowSearchBar:function(e){Odigeo.requireWidget("oneline-search-manager","onelinesearchmanager",function(t){t.execute("displaySearchBar",e)}),this.toggleSearchBar(e)},toggleSearchBar:function(e){xe.toggleClass("expanded",e),ie("enableChangeSearch",e)},onInitInspectlet:function(){Odigeo.AB.isNewCreateShoppingCart&&Odigeo.AB.isInspectletNewCreateShoppingCartDesktop&&w.getSessionRecorder().execute("start",[],Pe)},onRequestXsellAccommodationResults:function(){var e,t,i;g.fillWaitingPage(Odigeo.Utils.parseJson(Odigeo.Session.get("searchParameters"))),N.addClass("od-waiting-intermediate"),Odigeo.UIElements.enhanceLoading(N).showLoading(["waiting_intermediate_page","waiting_flight_info","waiting_intermediate_footer"]),Odigeo.Session.set("ipHotelReminderNagShown",!0),Odigeo.Session.set("intermediatePageShown",!1),e=Odigeo.Settings.getProperty("pathNames"),t=location.protocol,i=e[Odigeo.Router.getApp("home")],location.href=t+"//"+location.hostname+(location.port?":"+location.port:"")+i+"#/xsellproductselection/"},onSelectSeatUpdateSidebarSummary:function(e){C&&w.getSidebar().execute("onSeatmapChange",e),w.getServiceSummary().execute("onSeatmapChange",e),Odigeo.trigger("getTotalByFullprice")},onPassengerCollectionPopulated:function(){w.aircraftMapManager().execute("checkPassengerCollectionPopulated")},onDisablePristineMoveThrough:function(){w.aircraftMapManager().execute("cancelAircraftMoveThrough")},onMembershipRefreshSubscription:function(e){var i="login"===e;t.getMembershipSubscription().execute(i?"hideWidget":"showWidget",i)},trackErrorAndMessages:function(e,t){_.each(e,function(e){_.isEmpty(e.code)||n.trackEvent("intermediate_page_on_load","intermediate_page_not_shown_"+t+e.code)})},onUpdateBubblePremium:function(e){w.getSidebar().execute("updateBubblePremium",e)},onMembershipRefreshWidgets:function(e,t){w.getSidebar().execute("updatePriceMemberDisplay",e,t),w.getSidebar().execute("updatePriceMemberDisplayPrices",e,t),w.getMembershipSubscriptionOnTop().execute("updateMembershipSubscriptionOnTop",t)},onAddMembershipResponseFinished:function(){Ce(!1)},onGetTravellersSelected:function(){var e=be(),i=He.hasClass("userLogged");i?(_.extend(e,{isLogged:i}),t.getMembershipSubscription().execute("setListOfTravellers",e),t.getMembershipSubscription().execute("renderLightBoxTemplate"),t.getMembershipSubscription().execute("trackGetMembershipLightBox","widget_appears",e)):w.getMembershipManager().execute("getUserType",e.email)},onOpenMembershipPerksInfoLightbox:function(){w.getMembershipPerksInfoLightbox().execute("openMembershipPerksInfoLightbox")},onOpenOrCloseMembershipDialog:function(e){G(e)},onGetUserTypeResponse:function(e){var i,n=He.hasClass("userLogged");if(Odigeo.AB.isMemberSmoothSubscription)i={isLogged:n,status:e},w.getMembershipSmoothSubscription().execute("updateScenario",i);else if(!_.isEqual(Odigeo.Utils.getAppInGlobalScope(),"dp")&&Odigeo.Membership.isMembershipPrimePaymentD)if("PREMIUM"===e){U=!0,X();var a=Ee.find(".details_manager_data").data("discountselected");Odigeo.requireWidget("buyer","passengers_manager",function(e){e.execute("showForcePrimeLoginIndicator",a)})}else z();else i=be(),_.extend(i,{isLogged:n,status:e}),t.getMembershipSubscription().execute("setListOfTravellers",i),t.getMembershipSubscription().execute("renderLightBoxTemplate"),t.getMembershipSubscription().execute("trackGetMembershipLightBox","widget_appears",i)},onCloseForceLoginPopup:function(){U=!1},onAddMembershipResponse:function(e){_.isEmpty(e)?Odigeo.trigger("continueTransitionToPayment"):we(e[0]),this.onAddMembershipResponseFinished()},onUpdatePremiumDisclaimers:function(e,t,i){var n=Ee.find(".details_manager_data").data("membershipdualdisplay"),a=e?"login":n?"noDiscount":"logout",s={isMemberTestActive:n,memberInTravellers:e,isMemberLogged:!0,isFreeAccount:t,isPrimeTravellerUnselected:i,isCheapestPriceSelected:Ee.find(".details_manager_data").data("discountselected")};it=e,this.onUpdateBubblePremium(s),(e||i)&&w.getSidebar().execute("updatePriceMemberDisplayPrices",a),w.getSidebar().execute("updatePremiumDisclaimers",e)},onScrollAndSelectPrime:function(e){Odigeo.AB.isMemberSmoothSubscription&&w.getMembershipSmoothSubscription().execute("scrollAndSelectPrime",e)},onLaunchTravellersValidations:function(){Be=!1,fe(),Odigeo.AB.isMemberSmoothSubscription?Odigeo.requireWidget("buyer","passengers_manager",function(e){e.execute("getBuyersEmail")}):t.getMembershipSubscription().execute(Be?"alertDisclaimer":"openLightBox",Be)},onLaunchTravellersValidationsForRegister:function(){var e,i;Be=!1,fe(),Be?t.getMembershipSubscription().execute("alertDisclaimer",Be):(e=be(),i=He.hasClass("userLogged"),w.getMembershipRegister().execute("openLightBox",{userData:e,isUserLogged:i}))},onMembershipRegisterAddProduct:function(e){t.getMembershipSubscription().execute("addProductByTraveller",e)},onSmoothSubscriptionPCIErrorPopupOpened:function(){L=!0},onSimulatePriceLoading:function(){w.getSidebar().execute("togglePriceLoading",!0),setTimeout(function(){w.getSidebar().execute("togglePriceLoading",!1)},800)},onMembershipRegisterCreateAccount:function(e){w.getSidebar().execute("togglePriceLoading",!0),w.getUsersManager().execute("submitUserRequest",{action:"register",data:e})},onRegisterEvent:function(e){w.getSidebar().execute("togglePriceLoading",!1),Odigeo.getWidgetByID("membership-smooth-subscription")?w.getMembershipSmoothSubscription().execute(e.action):Odigeo.getWidgetByID("membership-register")&&w.getMembershipRegister().execute(e.action)},onUnlockEmail:function(){ne("unlockEmail")},onBlockBuyerEmail:function(){ne("blockEmail")},onScrollToEmail:function(){ne("highlightEmail")},onHighlightMembershipWidget:function(){t.getMembershipSubscription().execute("highlightMembershipWidget")},onDeleteMembership:function(){t.getMembershipSubscription().execute("deleteMembership")},onUpdateTraveller:function(e){this.onResetTravellersData(),_.isObject(e)&&e.responseOK&&(Odigeo.requireWidget("passengers0","passengers_manager",function(t){t.execute("updatePassengerListSelected",e)}),ne("updatePassengerListSelected",e))},onResetTravellersData:function(){$e=[],We={}},onSCManagerRequestCompletedWithError:function(){Ce(!1)},onEditSearch:function(){xe.addClass("expanded")},onShowOnelineSearch:function(e){xe.toggleClass("active",e)},onShareEmailSearch:function(e,t){Odigeo.requireWidget("share-selection","share_selection",function(i){i.execute("setShareSelectionEl",e.currentTarget),i.execute("reset",t)})},onAddTravellerData:function(e,t){"passenger"===t?$e.push(e):"contactDetails"===t&&(We=e),$e.length!==Ue.length-1||_.isEmpty(We)||($e=_.reject($e,function(e){return 0===e.traveller.id}),se("saveAllPassengersData",{passengers:$e,contactDetails:We}))},onSendNameToSidebar:function(e){w.getSidebar().execute("updateTravellersName",e)},onOpenFlightDetails:function(e,t){var i="flight-details";P.animate({scrollTop:100},100),i=0<Ee.find("#flight-details-open-search").length?"flight-details-open-search":i,Odigeo.requireWidget(i,"flight_details",function(i){i.execute("toggleViewPanel",e,t)})},onAddPaxSidebar:function(){Odigeo.requireWidget("passengers-update","passengers-update",function(e){e.execute("addAdult")})},onSubmitUserResultRequest:function(e,t){se(e,t)},onHideTravellerSelected:function(e){te("hideTraveller",e)},onCollapsedSummaryClosed:function(){ie("expandSummaryPanel",!0)},onExpandedSummaryClosed:function(){ie("expandSummaryPanel",!1)},onShowTravellerSelected:function(e){te("showTraveller",e)},onNotLoggedUser:function(){H=null,He.addClass("localStorageEnabled").removeClass("userLogged"),je.removeClass("hidden"),je.find(".login_button").off().on(Odigeo.Events.tap,T),ae("enableRememberMe",!1),te("userNotLoggedHidePassengerList"),ne("userNotLoggedHideNonEditableBuyerLayer"),this.updateMembershipPrices(Ee.find(".details_manager_data").data("membershipdualdisplay")),t.getMembershipSubscription().execute("logoutDone"),t.getMembershipSubscription().execute("checkPreviouslyAddedProduct"),t.nagManager().execute("logoutDone"),w.getMembershipSmoothSubscription().execute("logoutDone"),w.getMembershipPerksInfoLightbox().execute("logoutDone")},updateMembershipPrices:function(e,t,i,n){var a=void 0,s={isCheapestPriceSelected:_.isUndefined(n)?Ee.find(".details_manager_data").data("discountselected"):!n,isMemberTestActive:e,isMemberLogged:!_.isEmpty(H),isSubscriptionAdded:t,membershipPrice:i};W=!0,w.getSidebar().execute("setIsUpdatedMembershipPrices",!0),_.isEmpty(H)||_.extend(s,{isFreeAccount:!m(H)}),e&&(a=Ee.find(".details_manager_data").data("discountselected")?"discount":"noDiscount",this.onMembershipRefreshWidgets(a,t)),this.onUpdateBubblePremium(s)},onLoggedUser:function(e,t){re(e.userDTO||e,t),Odigeo.Session.set("displayName",e.displayName),!Odigeo.AB.isMemberSmoothSubscription&&m(e.userDTO)||this.updateMembershipPrices(Ee.find(".details_manager_data").data("membershipdualdisplay"))},onNotLoggedUserRemembered:function(){He.addClass("localStorageEnabled").removeClass("userLogged"),te("userNotLoggedHidePassengerList"),ae("enableRememberMe",!0),ne("userNotLoggedHideNonEditableBuyerLayer"),this.updateMembershipPrices(Ee.find(".details_manager_data").data("membershipdualdisplay"))},onRepricing:function(){Odigeo.requireWidget("details-page-top-persuasive-message","persuasiveMessaging",function(e){e.execute("closeMessage")})},onSCManagerRequestCompletedSuccessfully:function(){var t=D?e:"",i=!Odigeo.AB.isMetaAncillariesPageActive||D||I?"payment":"metaancillaries";r.removeBinds(["email","validationMail"]),Odigeo.Router.navigate(i,{params:t})},onPassengerPageComplete:function(e){var t=c.onPassengerPageComplete(e,Be,Ne,Ee);Be=t.hasErrors||Be,Ne=t.widgetData},calculateTotalPrices:function(){var e,t,i,n,a,s,r=Ee.find(".sidebar_details"),o=void 0,c=0,d=this.getHandBaggagePrice(),l=0,g=0,h=0,u=0,p=0,f=0,m=void 0,b=void 0,y=void 0,v=void 0,S=void 0,C=void 0,w=void 0;if(r.find(".baggage_table").hasClass("hidden")||(m=r.find(".baggage_table").attr("data-all-price-baggage"),c=_.isEmpty(m)?0:parseFloat(m)),s=r.find(".promocode_table .od-js-all-price").attr("data-all-price-promocode"),a=_.isEmpty(s)?0:parseFloat(s),r.find(".seats_table").hasClass("hidden")||(b=r.find(".seats_table .od-js-all-price").attr("data-allprice-seats"),l=_.isEmpty(b)?0:parseFloat(b)),r.find(".seatmap_table").hasClass("hidden")||(y=r.find(".seatmap_table .od-js-all-price").attr("data-allprice-seatmap"),g=_.isEmpty(y)?0:parseFloat(y)),r.find(".servicesfee").hasClass("hidden")||(v=r.find(".servicesfee .od-js-service-fee").attr("data-fee"),h=_.isEmpty(v)?0:parseFloat(v)),0<r.find(".paymentfee").length&&!r.find(".paymentfee").hasClass("hidden")&&(S=r.find(".paymentfee .od-js-service-fee").attr("data-fee"),u=_.isEmpty(S)?0:parseFloat(S)),r.find(".rebooking_table").hasClass("hidden")||(C=r.find(".rebooking_table .od-js-all-price").attr("data-allprice-rebooking"),p=_.isNaN(+C)?0:+C),r.find(".membership_subscription_table").hasClass("hidden")||(w=r.find(".membership_subscription_table .od-js-all-price").attr("data-all-price"),f=_.isNaN(+w)?0:+w),e=parseFloat(Ee.find(".js-total-price-ticket").data("priceticket"))||0,t=parseFloat(Ee.find(".od-js-discount-price").data("priceDiscount"))||0,i=parseFloat(Ee.find(".dynpack_fare_discount").data("dynpackfarediscount"))||0,Odigeo.AB.isMemberSmoothSubscription){var O=0<De.find(".membership_subscription_price").length;u=De.find(".membership_discount_fee").data("withprimediscount")||O?u:0}o=e+c+d+h+u+l+p+t+g+f+a;var T=Odigeo.Membership.isMembershipProductEnabled&&!Odigeo.Utils.isRequestApp("dp")&&!Odigeo.SessionScope.isMeta,P=Ee.find(".details_manager_data").data("discountselected"),E=T&&P&&!W&&0===f;return n=o+i,Odigeo.AB.isFareC4ARinPaxEnabled&&this.isFareUpgradeSelected()&&(o+=this.getFareUpgradePrice()),{sumTotalPrice:o,totalPriceWithoutDiscount:n,pricePerPassenger:this.getPricePerPassenger(o),isSlowLoadingPrimePriceFix:E}},isFareUpgradeSelected:function(){return R||!M&&f.getInsuranceByPolicy("CANXSELF").preselected},getPricePerPassenger:function(e){return e/Number($(".js-priceperpassenger").data("numtravellers"))},onTotalByFullPrice:function(){var e=this.calculateTotalPrices();this.updateSidebarPrices(e),Odigeo.AB.isFareC4ARinPaxEnabled&&this.updateRefundableFareUpgradePrices(e,this.isFareUpgradeSelected())},updateSidebarPrices:function(e){var t=e.sumTotalPrice,i=e.totalPriceWithoutDiscount,n=e.pricePerPassenger,a=e.isSlowLoadingPrimePriceFix,s=Ee.find(".sidebar_details"),r=Odigeo.Utils.formatCurrency(n);a?w.getSidebar().execute("refreshPrice"):s.find(".total_price").html(Odigeo.Utils.formatCurrency(t)),s.find(".total_price_without_discount").html(Odigeo.Utils.formatCurrency(i)),s.find(".od-pricebreakdown-table-content-infotable-totalrow .od-js-total-price").html(Odigeo.Utils.formatCurrency(t)),s.find(".js-priceperpassenger").html(r),s.find(".pax_price").html(r),Ie.find(".total_price").html(Odigeo.Utils.formatCurrency(t)),Ie.find(".pax_price").html(r)},updateRefundableFareUpgradePrices:function(e,t){w.getCollapsibleFlightSummary().execute("updateFareUpgradePrices",e,t)},getFareUpgradePrice:function(){return f.getInsuranceByPolicy("CANXSELF").totalPrice},getHandBaggagePrice:function(){return y.getSelectionPrice()},onSeatMapSelection:function(e){var i=e.priceData.data;o.seatMapSelectionData=e.seatData,C||w.getSidebar().execute("showIncludedSeatMap",i),Odigeo.trigger("getTotalByFullprice"),t.nagManager().execute("updateSeats","seatmap-selection",o.seatMapSelectionData)},onOpenAircraftMap:function(e,t){Odigeo.requireWidget("aircraft_map_manager","aircraftmap_manager",function(i){i.execute("onOpenAircraftMap",e,t)})},onShowDeleteAllDialog:function(e){var i={keepCallBack:function(){Odigeo.trigger("aircraftmap_manager:keepSeatMapSelection")},removeCallBack:function(){Odigeo.trigger("aircraftmap_manager:removeSeatMapSelection")},closeCallBack:function(){Odigeo.trigger("aircraftmap_manager:closeSeatMap")}};e&&e.keepSeatmapOpen&&_.assign(i,{keepCallBack:function(){},removeCallBack:function(){Odigeo.trigger("seatmap-selection-manager:resetSeatmapSelection")}}),t.nagManager().execute("showRemoveSeatsNags",i)},onResetSeatmapSelection:function(){w.seatMapSelectionManager().execute("resetSeatmapSelection")},onShowNoSeatsSelectedDialog:function(){var e={keepCallBack:function(){Odigeo.trigger("aircraftmap_manager:keepSeatMapSelection")},closeCallBack:function(){Odigeo.trigger("aircraftmap_manager:closeSeatMap")}};t.nagManager().execute("showNoSeatsSelectedNags",e)},onKeepSeatMapSelection:function(){w.aircraftMapManager().execute("onTapRetainSelection")},onRemoveSeatMapSelection:function(){w.aircraftMapManager().execute("onTapRemoveSelection")},onTapAircraftMapNavigateButton:function(e,t,i){Odigeo.requireWidget("seatmap-selection-manager","seatmap_selection_manager",function(n){n.execute("onTapNavigateButton",e,t,i)})},onCloseAircraftMap:function(){Odigeo.requireWidget("seatmap-selection-manager","seatmap_selection_manager",function(e){e.execute("onCloseAircraftMap")}),this.onScrollToSeatMapSelection()},onUpdateSeatSelectionFees:function(){w.seatMapSelectionManager().execute("updateSeatSelectionFees")},onHideErrors:function(){Odigeo.requireWidget("seatmap-selection-manager","seatmap_selection_manager",function(e){e.execute("onHideErrors")})},onScrollToSeatMapSelection:function(){var e=Ee.find(".seatmapselection");e.attr("data-scroll","true"),P.animate({scrollTop:e.offset().top-20+"px"},500,"swing",_.bind(function(){e.attr("data-scroll","false")},this))},onRemembermeLoginOk:function(e){O.get("login").execute("loginOk",e)},onRemembermeLoginError:function(e){_.isNull(Odigeo.Utils.readCookie("sso_remember_me"))?O.get("login").execute("loginWithError",e):ae("showLoginError",e)},cleaningDpWaitingPage:function(){k.removeClass("od-process-dpwaiting"),A.removeClass("disabled")},hiddenPageOverDpWaitingPage:function(){k.addClass("od-process-dpwaiting"),A.addClass("disabled")},sendUserToDpResults:function(t){var i="accommodation"===t?"dpresults_accommodation":"dpresults_flights";Odigeo.Session.set("DynPackActiveProduct",t),Odigeo.Router.navigate(i,{params:e})},removeHotelFromCartAndDisableRemoveHotelButton:function(e){C||w.getSidebar().execute("disableRemoveHotel"),Odigeo.requireWidget("shoppingcart-manager","shoppingcartmanager",function(t){t.execute("deleteHotelFromCart",e)})},removeHotel:function(){this.removeHotelFromCartAndDisableRemoveHotelButton();var e=$(".remove_hotel_nag");e.find(".dialog_content_container").removeClass("odf-hidden"),e.find(".dialog_footer, .dialog_post_footer").addClass("odf-hidden")},changeHotel:function(){this.removeHotelFromCartAndDisableRemoveHotelButton(!0),n.trackEvent("nags","remove_hotel_change")},showRemoveHotelNag:function(e){var t=Odigeo.UIElements.translations.xsellIntermediatePage.removeHotel.alternative,i=$("<span>",{class:"odf-text odf-text-sm",text:t}),n=Odigeo.UIElements.translations.xsellIntermediatePage.removeHotel.changeHotel,a=$("<span>",{class:"odf-link odf-link-sm remove_hotel_nag_change_hotel",text:n}),s=$("<div>",{class:"odf-loading-rounded odf-loading-rounded-sm odf-loading-rounded-informative od-loading-spinner"}).append($("<div>",{class:"odf-loading-rounded-container"}).append($("<svg>",{class:"odf-path-container",viewBox:"0 0 100 100"}).append($("<path>",{class:"odf-loading-rounded-track",d:"M 50,50 m 0,-44.5 a 44.5,44.5 0 1 1 0,89 a 44.5,44.5 0 1 1 0,-89"})).append($("<path>",{class:"odf-loading-rounded-head",d:"M 94.5 50 A 44.5 44.5 0 0 0 50 5.5"})))),r=Odigeo.UIElements.translations.xsellIntermediatePage.removeHotel.loadingMessage,o=$("<span>",{class:"odf-text odf-text-sm",text:r}),c=$("<div>",{class:"odf-hidden od-dialog-content-container dialog_content_container"}).append(s).append(o);Odigeo.UIElements.showNagPopup("od-nag-remove-hotel remove_hotel_nag",Odigeo.UIElements.translations.xsellIntermediatePage.removeHotel,_.bind(this.removeHotel,this),function(){Odigeo.UIElements.hideDialog($(".remove_hotel_nag"))},{appearances:"remove_hotel_appearances",add:"remove_hotel_remove",skip:"remove_hotel_keep"},i.outerHtml()+" "+a.outerHtml(),c.outerHtml(),!0),$(".remove_hotel_nag .dialog_box_header").css({"background-image":"url("+e+")"}),$(".remove_hotel_nag_change_hotel").on(Odigeo.Events.tap,_.bind(this.changeHotel,this))},removeHotelFromCart:function(e){this.showRemoveHotelNag(e),n.trackEvent("trip_information","remove_hotel")},onSuccessDeleteHotelFromCart:function(e){Odigeo.Session.set("deletedHotelFromCart","true"),e?window.history.back():window.location.reload()},onErrorDeleteHotelFromCart:function(){window.history.back()},onDpToggleAccommodationDetails:function(e){t.accommodationDetails().execute("process",e)},closeAccommodationDeTails:function(){t.accommodationDetails().execute("closeDetails")},onNagManagerAddBaggages:function(){Odigeo.Utils.scrollToElement(Ee.find("#baggages-container0"))},onNagManagerContinue:function(){ce()},onEvenUpBaggageSelection:function(){w.getBaggageManager().execute("evenUpBaggageSelection").then(function(){fe(),ce()})},onBaggageSelectorOpened:function(){_.each(Ee.find('div[data-widget="baggagesmanager"]'),function(e){Odigeo.requireWidget(e.id,"baggagesmanager",function(e){e.execute("closeBaggageSelector")})})},displayPromotionBadgeView:function(e,t){var i=0<u.isBaggageSelected();"passengers0"!==e||3!==Odigeo.AB.promotionMerchandisingBadgePartition||i||w.getBaggageManager().execute("displayPromotionBadge",t)},displayDiscountPercentage:function(){var e=u.getDiscountPercentage();w.getBaggageManager().execute("displayDiscountPercentage",e)},onNagSubscriber:function(e){t.nagManager().execute("subscribeWidget",e)},onGoToSeats:function(){Odigeo.Utils.scrollToElement(Ze)},onRemoveBackgroundHeaderSearchSummary:function(){Me.removeClass("odf-hidden")},onAddPaxCompleteSuccessful:function(){Odigeo.Router.reload()},onAddPaxCompleteError:function(e){Odigeo.Router.navigate("results",{params:e})},onMembershipSubscriptionChange:function(e){Odigeo.AB.isMemberSmoothSubscription?(w.getSidebar().execute("updatePricesWithMembershipSubscription",e),this.updateMembershipPrices(!0,1===e.quantity,e.allPrice,e.isPriceWithoutDiscountSelected)):(w.getSidebar().execute("updatePricesWithMembershipSubscription",e),this.updateMembershipPrices(!0,1===e.quantity||e.isUserLoggedIn,e.allPrice)),Odigeo.trigger("getTotalByFullprice")},onSmoothShowEmail:function(e){ne("showEmail",e)},onSmoothFieldsTemplateActive:function(e){F=e},onSmoothSubscriptionAdded:function(e){w.getMembershipManager().execute("getUserType",e.email)},onShowPassengerIndicator:function(){Odigeo.requireWidget("passengers0","passengers_manager",function(e){e.execute("showSmoothSubscriptionIndicator")})},onShowPassengerTitleIndicator:function(e){Odigeo.requireWidget("passengers0","passengers_manager",function(t){t.execute("showSmoothSubscriptionTitleIndicator",e)})},onValidationComplete:function(e){e.errors?(Be=!0,d.scrollToFirstError(Ee)):(Ne.buyer=Ne.buyer||{},_.extend(Ne.buyer,e))},onOpenLoginForm:T,continueButtonBinding:function(){X.call(this)},onContinueTransitionToPayment:function(){n.startMetric("LOAD_PAYMENTS");var e,i,a=Ge.is(":checked"),s=He.hasClass("userLogged");Odigeo.trigger("session:stopped"),e=$("#details").find("form"),i=oe();for(var r=0;r<e.length;r++){var o=e[r],c=document.createElement("input");c.style.display="none",c.type="submit",o.appendChild(c),o.action="javascript:void(0)",o.target="iframe_native_autocomplete",c.click()}Ne=_.isEmpty(i)?Ne:_.extend(Ne,{seats:i}),_.extend(Ne,{insurancesToAdd:[],boardingOptions:y.getCompleteUserSelectionData()}),Le.bookingID=Ee.find(".details_manager_data").data("bookingid"),Le.data=Ne,Le.nextPage="PAYMENT_PAGE",Odigeo.requireWidget("shoppingcart-manager","shoppingcartmanager",function(e){e.execute("addProductToShoppingCart",Le).execute("submitProducts")}),pe(),J(),n.trackEvent("continue_next_step","continue_clicks"),D?(t.dpWaitingPage().execute("activate",{redirect:"payment"}),Odigeo.Session.set("before-page","tap-details")):Odigeo.UIElements.enhanceLoading($(".waiting_page")).showLoading(["waiting_payment","waiting_bottom","waiting_pay_one","waiting_pay_two","waiting_pay_three","waiting_bottom_gradient"]),s&&a?(te("getTravellersData","addTravellerData"),ne("getContactDetails","addTravellerData")):He.hasClass("localStorageEnabled")&&a&&n.trackEvent("sso_pax_page","save_paxsnbuyers_details_local"),ne("storeLocalData",!s&&a),te("storeLocalData",!s&&a),t.nagManager().execute("saveNagsStateToSession"),w.getBoardingOptions().execute("trackContinueToPayment"),this.preloadFollowingPageWidgetTemplates()},preloadFollowingPageWidgetTemplates:function(){Odigeo.AB.isPrefetchAncillariesModule&&Odigeo.preloadNextWidgetTemplates()},onRegisterFullUserOk:function(){Odigeo.trigger("continueTransitionToPayment")},onRecaptchaLoaded:function(){Odigeo.requireWidget("rememberme","remember_me_manager",function(e){e.execute("renderCaptcha")}),Odigeo.AB.isMemberSmoothSubscription?w.getMembershipSmoothSubscription().execute("renderCaptcha"):w.getMembershipRegister().execute("renderCaptcha"),_.each(["share-selection","share-selection-dp"],function(e){Odigeo.getWidgetByID(e)&&Odigeo.requireWidget(e,"share_selection",function(e){e.execute("renderCaptcha")})})},onShowSmartNagBaggage:function(){var e=[];_.each(Fe,function(t){Odigeo.requireWidget(t.id,"passengers_manager",function(t){e.push(t.get("getPassengerFullName","getPassengerFullName"))})}),t.smartNagBaggage().execute("setPassengersData",e),t.smartNagBaggage().execute("showSmartNagBaggage")},onUpdateSelectedBaggageFromSmartnag:function(e,t){Odigeo.requireWidget("baggages-container"+e,"baggagesmanager",function(e){e.execute("onSelectedBaggageFromSmartNag",t)}),fe()},onFareUpgradeSelected:function(){V(!1),M=R=!0,Odigeo.trigger("getTotalByFullprice"),w.getShoppingCartManager().execute("selectFareUpgrade")},onFareUpgradeUnselected:function(){V(!0),M=!(R=!1),Odigeo.trigger("getTotalByFullprice"),Odigeo.requireWidget("shoppingcart-manager","shoppingcartmanager",function(e){e.execute("deleteFareUpgrade")})},onBoardingOptionSelected:function(e){w.getCollapsibleFlightSummary().execute("showBoardingOptions",e),w.getHandBaggageSummary().execute("storeBoardingOptions",e),y.select(e)},onBoardingOptionInteracted:function(){y.setInteraction()},onShowPriorityBoardingNag:function(){w.getBoardingOptions().execute("showNag")},onBoardingOptionsLoaded:function(e){w.getBoardingOptions().execute("loadData",e)}})});var V=function(e){if(f.isLoaded()){var t=f.getInsuranceByPolicy("CANXSELF")||{};w.getServiceSummary().execute("updateConcept",{isSetup:!1,added:!e,id:"CANXSELF",name:t.name,type:"CANX_INSURANCE"})}};p.fetchData();var G=function(e){Odigeo.Device.getViewport().toggleClass("od-viewport-no-vertical-scroll",e)};if(E.resize(_.bind(function(){Odigeo.requireWidget("seatmap-selection-manager","seatmap_selection_manager",function(e){e.execute("onWindowResize")})},this)),D){var j="roomselection"===x||_.isNull(x)?"deactivate":"activate";t.dpWaitingPage().execute(j)}else"payment"===Odigeo.Session.get("page")?Odigeo.UIElements.enhanceLoading($(".waiting_page")).hideLoading():k.removeClass("od-process-dpwaiting");Odigeo.Session.set(D?"before-page":"page","details"),w.getSeatsLeftOnTop().execute("toggleSeatsLeftSecondaryMessage"),Odigeo.Router.eventController.execute();var K,z,Y,X,J,Q,Z,ee,te,ie,ne,ae,se,re,oe,ce,de,le,ge,he,ue,pe,fe,me,_e,be,ye,ve,Se,Ce,we,Oe,Te,Pe="details",Ee=$("#details"),ke=$("#header"),Ae=$("#page"),De=$(".sidebar_price_container"),Ie=$("#sidebar-price"),xe=ke.find(".search_summary_bg"),Be=!1,Re=Ee.find(".flight_details"),Me=ke.find(".background_detail_searchsummary"),Ne={},Le={},Ue=Ee.find('div[data-widget="passengers_manager"]'),Fe=_.filter(Ue,function(e){return"buyer"!==e.id}),$e=[],We={},He=Ee.find(".customers_buyer_manager"),qe=Ee.find(".save_recommended"),Ve=Ee.find(".gdpr_icon"),Ge=$("#customersinfosave"),je=Ee.find(".login_details"),Ke={},ze=Ee.find(".persuasive_best_price"),Ye=Ee.find(".persuasion_message_popup"),Xe=Ee.find(".fare_tendency_message_popup"),Je=i(331),Qe=i(967),Ze=Ee.find("#seatmap-selection-manager"),et=Odigeo.Utils.parseJson(Odigeo.Storage.get("isAtolProtected")),tt=Ee.find(".details_atol_protected_text"),it=!1,nt=Ee.find(".details_continue_button");if(_.isNull(Odigeo.Session.get("searchParameters"))&&-1!==location.hash.indexOf("redirect=dpresults"))Odigeo.Router.navigate("dpresults",{params:_.last(Odigeo.History.getFragment().concat(";landingPageType=PASSENGER").split("/"))});else{u.buildCollection(),Je.removeStorageOnNotSelected(Ge,"passengersData"),Odigeo.AB.isTicketsLeftNextToContinueDetails||Odigeo.AB.isNewTicketsLeftOnTop||l.stickyTopSeats(Ee.find(".seats_left_top_details"),"seatsLeftTopStickyDetails"),ye=function(){var e=t.getMembershipSubscription().get("getData");_.extend(e,{email:Ne.buyer.mail}),w.getMembershipManager().execute("addMembership",e),Ce(!0)},ve=function(){w.getMembershipSmoothSubscription().get("getRequestData").then(function(e){var t=Se(e);w.getMembershipManager().execute("addMembership",t),Ce(!0)})},(Ce=function(e){Ee.find(".details_continue_button").attr("disabled",e)})(!(Se=function(e){return{email:e.email,password:e.password,name:Ne.passengers0.name,lastName:Ne.passengers0.firstLastName,quantity:e.quantity}})),Oe=function(e){t.getMembershipSubscription().execute("solveAddMembershipError",this,e)},we=function(e){Odigeo.UIElements.showLightboxWarning("od-passenger-lightbox-logout",_.bind(Oe,e),null,"UNL_CONNECTION_FAILED"===e.code?Odigeo.UIElements.translations.errMembershipSubscription.creatingAccount:Odigeo.UIElements.translations.errMembershipSubscription.memberExists)},se=function(e,t){Odigeo.requireWidget("users-manager","usersmanager",function(i){i.execute(e,t)})},re=function(e,i){if(H=e,je.addClass("hidden"),He.addClass("userLogged").removeClass("localStorageEnabled"),se("mixUserAndMember",e),te("userLoggedShowPassengerList",{userDTO:e,track:i}),ae("enableRememberMe",!1),ne("userLoggedSetBuyerData",e),te("updatePassengerSelected"),t.getMembershipSubscription().execute("loginDone",e),t.nagManager().execute("loginDone"),w.getMembershipRegister().execute("loginDone",m(e)),w.getMembershipSubscriptionOnTop().execute("updateMembershipSubscriptionOnTop",m(e)),w.getMembershipSmoothSubscription().execute("loginDone",e),w.getMembershipPerksInfoLightbox().execute("loginDone"),!_.isEmpty(e.membershipInfoDTO.membershipDTO)&&!_.isEmpty(e.membershipInfoDTO.errorDTOs)){var n=_.head(e.membershipInfoDTO.errorDTOs),a=!_.isUndefined(n.code)&&"UNL_VELOCITY_RULES_EXCEDEED"===n.code,s=e.membershipInfoDTO.membershipDTO.name;t.nagManager().execute("updatePrimeUserBlocked",a,s)}},te=function(e,t){_.each(Fe,function(i){Odigeo.requireWidget(i.id,"passengers_manager",function(i){i.execute(e,t||null)})})},ie=function(e,t){Odigeo.requireWidget("collapsible-flight-summary","collapsible_flight_summary",function(i){i.execute(e,t)})},be=function(){var e=[];return _.each(Ne,function(t,i){t&&t.name&&"ADULT"===t.travellerType&&e.push({name:t.name,lastName:t.firstLastName,id:i})}),{travellers:e,email:Ne.buyer.mail}},ne=function(e,t){Odigeo.requireWidget("buyer","passengers_manager",function(i){i.execute(e,t||null)})},ae=function(e,t){Odigeo.requireWidget("rememberme","remember_me_manager",function(i){i.execute(e,t)})},Odigeo.trigger("session:refreshed"),Re.hasClass("hidden")&&(Odigeo.UIElements.hideAllDialogs(),Re.removeClass("hidden")),$("#details_infofooter_details_button",Ee).off(Odigeo.Events.tap).on(Odigeo.Events.tap,function(){$("#details_infofooter_details",Ee).toggleClass("hidden")}),qe.on(Odigeo.Events.tap,function(){n.trackEvent("possible_CTA","keep_PAX_info_bubble")}),Z=function(e){var t=$(e.target),i=".gdpr_popup",a=t.hasClass("od-gdpr-icon"),s=a?t.parent().find(i):Ee.find(i),r=!s.hasClass("open");a&&r&&n.trackEvent("sso_pax_page","save_paxsnbuyers_details"),s.toggleClass("open opened",!!a&&r),e.stopPropagation()},ee=function(e){Z(e),Ee.one(Odigeo.Events.click,Z),Ee.find(".dropdown_select_with_input").removeClass("focus")},Ve.on(Odigeo.Events.click,ee),Te=function(){Odigeo.Session.storage.removeItem("nagsState")},oe=function(){return _.extend(Ke,o.seatMapSelectionData)},pe=function(){w.getBaggageManager().execute("sendContinueToPaymentBaggageTracking",o.getPassengersCountByType(Ne))},ce=function(){Odigeo.AB.isNewWarningPopup&&Ae.find(".ui_dialog_box.opened").trigger("dialog:closeOnNavigate"),Odigeo.getWidgetByID("membership-subscription")?(t.getMembershipSubscription().execute("setListOfTravellers",be()),ye()):Odigeo.getWidgetByID("membership-smooth-subscription")?ve():(!_.isUndefined(H)&&m(H)&&n.trackEvent("unlocked","prime_mem_continue_sub-log"),Odigeo.trigger("continueTransitionToPayment"))},fe=_.bind(c.validatePassengersManager,this,Ee.find('[data-widget="passengers_manager"]\n        '+(Odigeo.AB.isMemberSmoothSubscription?',[data-widget="membership_smooth_subscription"]':""))),le=function(){return 0<(ue=Ee.find('[id="details-pax-legalcheck"]')).length&&!ue.is(":checked")},ge=function(){Ee.find('[id="details-pax-legalcheck-notchecked"]').removeClass("hidden"),Ee.find('[id="details-pax-legalcheck"]').parent().find("label").addClass("od-checkbox-not-checked"),n.trackEvent("pax_details_error","accept_terms_error"),ue.focus()},he=function(){Ee.find('[id="details-pax-legalcheck-notchecked"]').addClass("hidden"),Ee.find('[id="details-pax-legalcheck"]').parent().find("label").removeClass("od-checkbox-not-checked")},z=function(){K()},K=function(){t.nagManager().execute("shootNags")||ce()};Y=function(){nt.attr("disabled",!0),Be=!1,fe();var e=He.hasClass("userLogged"),i=!_.isEqual(Odigeo.Utils.getAppInGlobalScope(),"dp")&&Odigeo.Membership.isMembershipPrimePaymentD&&!Be;if(!e&&Odigeo.Membership.isMembershipProductEnabled&&function(){var e,i,n;(e=Odigeo.AB.isMemberSmoothSubscription,i=e?w.getMembershipSmoothSubscription().get("getGroup"):t.getMembershipSubscription().get("getGroup"),n=e?w.getMembershipSmoothSubscription().get("isMembershipSelected"):t.getMembershipSubscription().get("isSelected"),$.when(O.get("login").get("isMember"),i,n)).then(function(e,i,n){t.nagManager().execute("updateMembership",{isMember:e,group:+i,added:n})})}(),le())ge(),X();else if(i&&!e){var a=be();w.getMembershipManager().execute("getUserType",a.email),X(!1)}else he(),_.delay(_.bind(function(){Be?(X(),n.trackEvent("continue_next_step","continue_clicks_FE_error")):Odigeo.AB.isMemberSmoothSubscription&&F?w.getMembershipSmoothSubscription().execute("scrollAndHighlightPrimeButton"):(it&&n.trackEvent("unlocked","subscriber_included_continue"),Odigeo.AB.isBrowserNotificationsMeta&&Odigeo.SessionScope.isMeta&&h.isEnabled()&&"granted"!==h.getPermission()&&!Odigeo.AB.isRemoveBrowserNotification&&Odigeo.requireWidget("browser-notification-popup","browser_notification_popup",function(e){e.execute("endPopup")}),z())},this),400)},(X=function(){nt.attr("disabled",!1),nt.off(Odigeo.Events.tap).one(Odigeo.Events.tap,Y)})(),et&&tt.removeClass("odf-hidden"),"false"===Odigeo.Session.get("ipHotelReminderNagShown")&&w.getAccommodationSearchManager().execute("getAccommodationResults"),_.each(Ee.find('[data-widget="passengers_manager"]'),function(e){var t=$(e),i=$(e).find('select[data-name="localityCodeOfResidence"]');Odigeo.UIElements.enhanceDateWithSelects(t.find('input[data-name="dateOfBirth"]'),{yearLimit:1910}),Odigeo.UIElements.enhanceDateWithSelects(t.find('input[data-name="identificationExpirationDate"]'),{yearLimit:2050}),t.find(".flyer_code_select").off().on("change",function(e){t.find(".flyer_code_input").data({carrier:e.target.value})});var n=$("#details").find(".ffc_tooltip_btn");Odigeo.UIElements.hint.enhance("details",n,{events:{hover:!0},closeOthers:!1}),0<i.length&&(i.off().on("change",function(e){t.find('input[data-name="localityNameOfResidence"]').val(e.target[e.target.selectedIndex].label)}),i.val(i[0][i[0].selectedIndex].value),t.find('input[data-name="localityNameOfResidence"]').val(i[0][i[0].selectedIndex].label),t.find('select[data-name="identificationType"] option[value="NIF"]').prop("selected",!0).trigger("change"))}),te("defaultNifSelection"),J=function(){Ge.is(":checked")&&n.trackEvent("sso_pax_page","save_paxsnbuyers_details")},Q=function(){n.trackPage(D||"upsell"===Odigeo.Utils.getAppInGlobalScope()?"details":"details-extras",{legacy:Odigeo.Utils.getFunnelTrackingLegacy()+"pasajeros-a/",funnel:!0}),a.updateDatalayer()},de=function(e){n.trackEvent("seat_selection_gds","seat_selection_gds_load_pro:"+e.itineraryType+"_pax:"+e.adultsAndChildrens+"_off:"+e.numberOfAvailableSeatmap)},_.isEmpty(ze)||Odigeo.UIElements.hint.enhance(Odigeo.History.getPageNameFromFragment(),ze,{events:{tap:!0}}),_.each(Ye,function(e){var t=$(e).data("tracking"),i=t?{type:"trackEvent",data:{action:t,label:"price_guaranty_more_info"}}:null;Odigeo.UIElements.hint.enhance(Odigeo.History.getPageNameFromFragment(),e,{events:{tap:!0},googleAnalyticsOnOpen:i})});var at=Ee.find(".resident_city");Odigeo.UIElements.hint.enhance("details",at,{events:{tap:!0}}),_.each(Xe,function(e){Odigeo.UIElements.hint.enhance(Odigeo.History.getPageNameFromFragment(),e,{events:{tap:!0}})}),me=function(e,t){var i=$("#details").find(t);$.each(i,function(t,i){$(i).is(e)||0!==$(i).has(e).length||$(i).addClass("odf-hidden")})},_e=function(e,t){return 0===$(e).parents(t).length},$(".details").on(Odigeo.Events.tap,function(e){var t=$(e.target),i=!t.hasClass("baggage_selector_button")&&!t.hasClass("baggage_add_button"),n=U&&_e(e.target,".prime_in_payment_force_login"),a=L&&_e(e.target,".smooth_pci_error_popup")&&_e(e.target,".user_login")&&!t.hasClass("modal_view");i&&me(e.target,".new_baggage_type_wrapper"),a&&(w.getMembershipSmoothSubscription().execute("closePCIErrorPopup"),L=!1),n&&Odigeo.requireWidget("buyer","passengers_manager",function(e){e.execute("closeForceLoginPopup")}),t.hasClass("baggage_selector_button")||t.hasClass("baggage_add_button")?Odigeo.Session.set("intentionToBuy_bags",!0):t.hasClass("aircraftmap_seat")&&Odigeo.Session.set("intentionToBuy_seats",!0)}),0<+$("div.details_manager_data").data("bookingid")||Odigeo.UIElements.showBackToHomeError(),Te();var st=JSON.parse(Odigeo.Session.get("searchParameters"));if(_.has(st,"searchSegments")){var rt=Ee.find(".flights_list_item").map(function(){return $(this).attr("data-transport-type")});_.each(st.searchSegments,function(e,t){e.transportType=rt[t]})}Odigeo.Session.set("searchParameters",JSON.stringify(st)),"true"===Odigeo.Session.get("deletedHotelFromCart")&&(Odigeo.Session.remove("deletedHotelFromCart"),w.getSidebar().execute("confirmHotelRemoved")),Odigeo.trigger("getTotalByFullprice"),C&&w.getSidebar().execute("updatePage","details"),w.getServiceSummary().execute("updatePage","details"),$("#bread-crumbs").find(".bread_crumbs_wrapper").removeClass("hidden"),Odigeo.Utils.patchFormsForiOS8(Ee),Q(),Odigeo.Utils.ensighten(),Odigeo.requireWidget("seatmap-selection-manager","seatmap_selection_manager",function(e){var t={adultsAndChildrens:e.options.numAdults+e.options.numChildren,numberOfAvailableSeatmap:e.options.numberOfAvailableSeatmap,itineraryType:e.options.itineraryType};de(t)}),D&&t.dpWaitingPage().execute("deactivate"),n.bindEvents(Ee),Odigeo.UIElements.hint.enhance(Odigeo.History.getPageNameFromFragment(),$(".flightsummary_layover_hint"),{events:{hover:!0}}),q.restoreSearchParams(),w.seatMapSelectionManager().execute("updateSelectedSeats"),Qe.init("flights_pax_page"),Odigeo.AB.isBrowserNotificationsMeta&&Odigeo.SessionScope.isMeta&&h.isEnabled()&&"granted"!==h.getPermission()&&Odigeo.requireWidget("browser-notification-popup","browser_notification_popup",function(e){e.execute("launchPopup")});var ot=(location.search.match(/mktportal=([a-zA-Z-]+)/)||[null,"T"])[1],ct=(location.search.match(/landingPageType=([A-Z]+)/)||[null,null])[1],dt=Odigeo.Session.get("isMetaForIntermediate");"PASSENGER"!==ct||"T"===ot||dt?n.stopMetric("LOAD_PASSENGERS_FLIGHTS"):(n.stopMetric("LOAD_META_PASSENGERS"),Odigeo.Session.remove("LOAD_META_INTERMEDIATE")),s.refreshSession(Ee.find(".details_manager_data").data("bookingid"),"details")}}},function(e,t,i){"use strict";!function(){var e=i(976);i(59).getInstance({load:!0});var t=i(56),n=i(40),a=i(96),s=i(0),r=i(7),o=i(142).getInstance(),c=i(621),d=i(1165),l=i(51),g=i(100).getInstance(),h=i(977),u=i(967),p=i(504),f=i(43),m=i(322),b=i(92),y=i(328);Odigeo.Router.handlers.payment=function(i){var v=Odigeo.autoloadWidgets({getUsersManager:["users-manager","usersmanager"],getBinDetection:["payment-bin-detection-manager","bindetectionmanager"],dpWaitingPage:["dpwaiting-page","dp_waiting_page"],accommodationDetails:["accommodation-details","accommodation_details"],getPaymentManager:["payment-manager","paymentmanager"],getPaymentErrorManager:["payment-error-manager","paymenterrormanager"],getInvoiceManager:["invoice-manager","invoice_manager"],getSpecialrequestManager:["specialrequest","special_request_manager"],getServiceoptionsTableManager:["so-table","service_options_table"],nagManager:["nagmanager","nagmanager"],binDetectionManager:["payment-bin-detection-manager","bin_detection_manager"]}),S=new a(v);Odigeo.AB.isMoveSpecialRequest&&S.deactivate("getSpecialrequestManager");var C,w,O,T,P,E,k,A,D="sidebarsummary"===$(".side_summary_payment").data("type"),I=Odigeo.autoloadWidgetsAsync({getPriceManagerEnhanced:["price-breakdown-payments","pricemanager_enhanced"],getSidebar:D?["sidebar-summary-payment","sidebar_summary"]:["trip-summary-price-payment","trip_summary_price"],getServiceSummary:["service-summary","service_summary"],getPayWithGuarantee:["pay-with-guarantee","pay_with_guarantee"],getAncillariesModule:["ancillaries-module","ancillaries_module"],getAncillariesModuleFlex:["ancillaries-module-flex","ancillaries_module"],getAncillariesDebugInfo:["ancillaries-debuginfo","ancillaries_debuginfo"],getHandBaggageSummary:["hand-baggage-summary","hand_baggage_summary"],getSeatsLeftOnTop:["seatsLeftOnTopPaymentPage","seats_left_on_top"],getBoardingOptions:["boarding-options","boarding_options"],getMembershipManager:["membership-manager","membership_manager"],getPrimeAncillariesModule:["prime-ancillaries-module","prime_ancillaries_module"],getMembershipPerksInfoLightbox:["membership-perks-info-lightbox","membership_perks_info_lightbox"],getProgressBar:["progress-bar-3","progress_bar"]}),x=n({login:["login-header",t]}),B=$("#payment"),R=$("#cybersource-fingerprint-wrapper"),M=null,N=null,L=!1,U={},F=JSON.parse(Odigeo.Session.get("lastRouteChange")),W=Odigeo.Utils.isRequestApp("dp"),H=W?"_DYNPACK_":"_FLIGHTS_",q=$(".home_main_layout"),V=$("#logo"),G=void 0,j=$('input[name="cardType"]'),K=$(".cc_not_detected"),z=B.find(".persuasion_message_popup"),Y=B.find(".flight_details"),X=B.find("#persuasive_title_name"),J=B.find(".almost_done_with_name"),Q=B.find(".almost_done_without_name"),Z=$("#footer"),ee=$("#page"),te=$(window),ie=0,ne=0,ae=0,se=_.throttle(function(){I.getPriceManagerEnhanced().execute("checkIfOfferPricesTextSizeShouldBeResized")},32),re=_.isNull(F)&&-1!==location.hash.indexOf("redirect=dpresults"),oe=!1,ce=ee.find(".gdpr_icon");if(re)Odigeo.Router.navigate("dpresults",{params:_.last(Odigeo.History.getFragment().concat(";landingPageType=PASSENGER").split("/"))});else{o.buildCollection(),Odigeo.AB.isTicketsLeftNextToContinueDetails||Odigeo.AB.isNewTicketsLeftOnTop||h.stickyTopSeats(ee.find(".seats_left_top_payment"),"seatsLeftTopStickyPayment"),G=_.bind(e.validatePassengersManager,this,ee.find('[data-widget="passengers_manager"]')),w=function(e,t){Odigeo.requireWidget("payment-bin-detection-manager","bin_detection_manager",function(i){i.execute(e,t)})},O=function(e,t,i){I.getPriceManagerEnhanced().execute(e,{ccName:t,resolved:i}),_.isUndefined(t)||I.getSidebar().execute("setCcSelected",t)},T=function(){var e,t={data:{}};L=!0,!_.isEmpty(U)&&U.invoicemanager.invoiceRequired&&(e=U.invoicemanager.professional?"business":"leisure",s.trackEvent("invoice_widget","invoice_requested_"+e)),t.bookingID=v.getPaymentManager().model.get("bookingId"),_.isNull(M)||(t.data=_.extend(t.data,M)),_.isNull(N)||(t.data=_.extend(t.data,N)),t.nextPage="PAYMENT_PAGE",Odigeo.requireWidget("shoppingcart-manager","shoppingcartmanager",function(e){e.execute("addProductToShoppingCart",t).execute("submitProducts",{avoidEnsightenReload:!0})})},k=function(e){var t=$(e.target),i=".gdpr_popup",n=t.hasClass("od-gdpr-icon"),a=n?t.parent().find(i):ee.find(i),r=!a.hasClass("open");n&&r&&s.trackEvent("sso_pax_page","save_paxsnbuyers_details"),a.toggleClass("open opened",!!n&&r),e.stopPropagation()},A=function(e){k(e),ee.one(Odigeo.Events.click,k)},ce.on(Odigeo.Events.click,A),E=function(e){g.setMembershipPerksIncludedPrice(!e),v.getPaymentManager().execute("changePaymentMethod")},Odigeo.Session.set("page","payment"),Odigeo.Storage.remove("fromContinueButton"),I.getSeatsLeftOnTop().execute("toggleSeatsLeftSecondaryMessage"),g.fetchData(),Odigeo.Router.eventController=$.extend(!0,Odigeo.Router.eventController,Odigeo.Router.handlers.userEventController,Odigeo.Router.handlers.repriceManagerEventController,Odigeo.Router.handlers.errorManagerEventController,{globalEvents:{},viewEvents:_.extend(c.viewEvents(),{"ancillaries_module:ancillaryAdded":"onAncillariesModuleItemToggled","ancillaries_module:addAncillaryData":"addAncillaryData","ancillaries_module:onContinuanceNagAccepted":"onUserAcceptAncillaryNagInstance","ancillaries_module:onContinuanceNagRejected":"onUserRejectAncillaryNagInstance","ancillaries_module:selectionChanged":"ancillaryOfferSelectionChanged","ancillaries_module:ancillaryProductRendered":"onAncillaryProductRendered","payment-error-manager:sendValidationErrors":"sendValidationErrors","dpwaiting-page:cleanDpWaitingPage":"cleaningDpWaitingPage","dpwaiting-page:hidePageOverDpWaitingPage":"hiddenPageOverDpWaitingPage","flight-details-payments:closeAccommodation":"closeAccommodationDeTails","flight-details-payments:heightChanged":"onHeightChanged","flight-details-payments:toggleDetails":"onDpToggleAccommodationDetails","invoice-manager:clearValidationErrors":"onInvoiceManagerClearValidationErrors","invoice-manager:showErrorsResume":"onShowInvoiceManagerErrorsResume","page:afterSwitch":"onAfterSwitchView","page:scrollTo":"onScrollTo","payment-bin-detection-manager:creditCardTypeChanged":"onCreditCardChanged","payment-bin-detection-manager:methodTypeChanged":"onCcMethodTypeSelected","payment-bin-detection-manager:showPaymentMethodDisclaimer":"onShowPaymentMethodDisclaimer","payment-manager:confirmationLoading":"onConfirmationLoading","payment-manager:noPaymentMethodsAvailable":"onNoPaymentMethodsAvailable","payment-manager:paymentMethodChanged":"onPaymentMethodChanged","payment-manager:paymentOptionsUpdated":"onCreditCardListReady","payment-manager:ready":"onPaymentManagerReady","payment-manager:showErrors":"onShowErrors","payment-manager:showErrorsResume":"onShowPaymentErrorsResume","payment-manager:updateCardMethod":"onUpdateCardMethod","payment-manager:expirationDateChange":"onExpirationDateChange","payment-manager:creditCardTypeChanged":"onCreditCardChanged","passengers_manager:completed":"onPassengerPageComplete","price-breakdown-payments:priceManagerReady":"onPriceManagerReady","price-breakdown-payments:refreshData":"onPriceManagerReady","price-breakdown-payments:updatePricesTripSummary":"onUpdatePrices","price-breakdown-payments:toggleCcType":"onToggleCcType","price-breakdown-payments:breakdownLoaded":"onBreakdownLoaded","price-breakdown-payments:onContinueButtonClicked":"onContinueButtonClicked","price-breakdown-payments:trackContinueButtonMouseover":"onTrackContinueButtonMouseover","price-breakdown-payments:priceBreakdownToggled":"onPriceBreakdownToggled","so-table:productSelection":"onServiceOptionViewUpdated","so-table:updateBreakdown":"onServiceOptionUpdatedBreakdown","so-table:showBasicServiceOptionEvoNag":"showBasicServiceOptionEvoNag","so-table:setServiceOptionsEvoNagAlreadyShown":"setServiceOptionsEvoNagAlreadyShown","nagmanager:addRecommendedSoEvo":"onAddRecommendedSoEvo","nagmanager:addBasicSoEvo":"onAddBasicSoEvo","shoppingcart-manager:requestCompletedSuccessfully":"onSCManagerRequestCompletedSuccessfully","shoppingcart-manager:requestCompletedWithError":"onSCManagerRequestCompletedWithError","shoppingcart-manager:requestError":"onSCManagerRequestError","sidebar-summary-payment:openFlightDetails":"onOpenFlightDetails","specialrequest:clearValidationErrors":"onSpecialrequestClearValidationErrors","trip-summary-price-payment:changeBackPage":"goToPassengerDetails","trip-summary-price-payment:sendUserToDpResults":"sendUserToDpResults","trip-summary-price-payment:toggleDetails":"onDpToggleAccommodationDetails","sidebar-summary-payment:toggleDetails":"onDpToggleAccommodationDetails","sidebar-summary-payment:sendUserToDpResults":"sendUserToDpResults","global:repricingShown":"onRepricing","error-message-layer:tryAgain":"goToPayment","shoppingcart-manager:enablePaymentButton":"enablePaymentButton","membership:priceMemberDisplay":"onPriceMemberDisplay","price-breakdown-payments:updateSummaryPrices":"onUpdateSummaryPrices","price-breakdown-payments:updatePremiumSidebarView":"onUpdatePremiumSidebarView","price-breakdown-payments:totalPriceUpdated":"refreshOfferPricesTextSize","share-itinerary-payment:onShareEmailSearch":"onShareEmailSearch","membership:refreshWidgets":"onMembershipRefreshWidgets","pay-with-guarantee:bookAncillariesModuleCanx":"payWithAncillariesModuleCanx","pay-with-guarantee:showPayWithGuarantee":"showPayWithGuarantee","pay-with-guarantee:hidePayWithGuarantee":"hidePayWithGuarantee","pay-with-guarantee:rendered":"refreshOfferPricesTextSize","ancillariesStep:opened":"onAncillariesStepOpened","optimize:hasRendered":"onOptimizeHasRendered","boarding-options:boardingOptionsLoaded":"onBoardingOptionsLoaded","prime-ancillaries-module:openMembershipPerksInfo":"onOpenMembershipPerksInfo","prime-ancillaries-module:updateMembershipProduct":"onUpdateMembershipProduct","membership-manager:addMembershipOk":"onAddMembershipResponse","membership-manager:addMembershipFail":"onAddMembershipResponse","membership-manager:addMembershipComplete":"onAddMembershipResponse","membership-perks-info-lightbox:openPaymentSubscriptionLightBox":"onOpenPrimeSubscriptionLightBox","prime-ancillaries-module:updateMembershipPricePayment":"onUpdateMembershipPricePayment","prime-ancillaries-module:refreshPdbPrices":"onRefreshPdbPrices","prime-ancillaries-module:updatePageStatus":"onUpdatePageStatus","prime-ancillaries-module:updatePaymentStepStatus":"onUpdatePaymentStepStatus","pay-with-guarantee:setPdfUrl":"setPdfUrl","pay-with-guarantee:setPolicy":"setPolicy"}),eventHandlers:_.extend(c.eventHandlers(),{onAncillaryProductRendered:function(e){I.getPayWithGuarantee().execute("onAncillaryProductRendered",e)},payWithAncillariesModuleCanx:function(e){this.payWithGuarantee(e,I.getAncillariesModule())},payWithGuarantee:function(e,t){s.counterMetric("FRONT"+H+"PAYMENT_CLICK_COUNTER"),G(B),this.validatePaymentPage()?(s.counterMetric("FRONT"+H+"PAYMENT_VALIDATION_OK_COUNTER"),I.getPayWithGuarantee().execute("setInsuranceOrGuaranteeSelected",{id:e,selected:!0}),I.getPayWithGuarantee().execute("trackPurchase",e,!0),t.execute("toggleAncillaryOffer",e,!0),P({loading:!1,disabled:!0},{loading:!0,disabled:!0}),this.onPaymentValidationSuccess()):(s.counterMetric("FRONT"+H+"PAYMENT_VALIDATION_KO_COUNTER"),I.getPayWithGuarantee().execute("trackPurchase",e,!1),this.showPaymentValidationErrors())},showPayWithGuarantee:function(){I.getPriceManagerEnhanced().execute("showPayWithGuarantee"),this.refreshOfferPricesTextSize(),te.on("resize",se)},setPdfUrl:function(e){I.getPriceManagerEnhanced().execute("getPdfUrl",e)},setPolicy:function(e){I.getPriceManagerEnhanced().execute("getPolicy",e)},onPromotionalCodesUpdatePrices:function(){I.getPriceManagerEnhanced().execute("reloadPrices")},hidePayWithGuarantee:function(){I.getPriceManagerEnhanced().execute("hidePayWithGuarantee"),te.off("resize",se)},refreshOfferPricesTextSize:function(){I.getPriceManagerEnhanced().execute("refreshOfferPricesTextSize")},onPriceBreakdownToggled:function(){this.refreshOfferPricesTextSize()},onMembershipRefreshWidgets:function(){x.get("login").execute("launchPriceMemberDisplay")},onPriceMemberDisplay:function(e){I.getSidebar().execute("updatePriceMemberDisplay",e)},onUpdateSummaryPrices:function(){var e=D?"refreshPrice":"updatePrices";I.getSidebar().execute(e)},onUpdatePremiumSidebarView:function(e){Odigeo.Membership.isMembershipPrimePaymentD&&!_.isEqual(Odigeo.Utils.getAppInGlobalScope(),"dp")?I.getPrimeAncillariesModule().get("getPrimeAncillariesData").then(function(t){I.getSidebar().execute("updatePremiumSidebarView",_.extend(e,{isCheapestPriceSelected:t.isDiscountedPriceSelected,isSubscriptionAdded:t.isSubscriptionAdded}))}):I.getSidebar().execute("updatePremiumSidebarView",e)},onToggleCcType:function(e){I.getSidebar().execute("toggleCcType",e)},sendValidationErrors:function(e){v.getPaymentErrorManager().execute("updateErrorsCollection",e)},onUpdateFlagPriceManager:function(e){I.getPriceManagerEnhanced().execute("updateFlag",e)},onServiceOptionViewUpdated:function(e){I.getServiceSummary().execute("updateConcept",_.extend(e,{id:f.SERVICE_OPTIONS,type:f.SERVICE_OPTIONS,added:!0}))},onServiceOptionUpdatedBreakdown:function(e){I.getPriceManagerEnhanced().execute("priceHandler",e)},setServiceOptionsEvoNagAlreadyShown:function(e){v.nagManager().execute("setServiceOptionsEvoNagAlreadyShown")},onAddRecommendedSoEvo:function(){v.getServiceoptionsTableManager().execute("addRecommendedSo")},onAddBasicSoEvo:function(){v.getServiceoptionsTableManager().execute("addBasicSo")},showBasicServiceOptionEvoNag:function(e){v.nagManager().execute("showBasicServiceOptionEvoNag",e)},onOpenFlightDetails:function(e,t){Odigeo.requireWidget("flight-details-payments","flight_details",function(i){i.execute("toggleViewPanel",e,t)})},onShareEmailSearch:function(e,t){Odigeo.requireWidget("share-selection","share_selection",function(i){i.execute("setShareSelectionEl",e.currentTarget),i.execute("reset",t)})},onConfirmationLoading:function(){V.addClass("disabled"),Odigeo.Session.remove("before-page")},getBuyerInfoOnPayment:function(t){var i=Odigeo.AB.buyerWidgetPayment?e.getBuyerInfoDto(B.find('[data-widget="passengers_manager"]')):null;t.execute("commit",{showErrorsResume:!0,addBuyerInformationRequestDTO:i})},onSCManagerRequestCompletedSuccessfully:function(){L?(L=!1,this.getBuyerInfoOnPayment(v.getPaymentManager())):v.getPaymentManager().execute("getPaymentOptions")},onSCManagerRequestCompletedWithError:function(){},onSCManagerRequestError:function(){Odigeo.UIElements.enhanceLoading($(".waiting_page")).hideLoading()},onCreditCardChanged:function(e,t,i,n){e&&"-1"!==e&&v.getPaymentManager().execute("setCreditCardType",e,n),"CREDITCARD"===v.getPaymentManager().model.get("chosenMethod")&&O("showCcSelected",t,i),D||I.getSidebar().execute("setCcSelected",t)},onShowPaymentMethodDisclaimer:function(e){O("showPaymentMethodDisclaimer",e.ccName,e.resolved)},onBreakdownLoaded:function(){w("getCcSelectedName"),v.getPaymentManager().execute("isStoredCardSelected")},onRepricing:function(){Odigeo.requireWidget("payment-page-top-persuasive-message","persuasiveMessaging",function(e){e.execute("closeMessage")})},enablePaymentButton:function(){P({loading:!1,disabled:!1},{loading:!1,disabled:!1}),I.getPayWithGuarantee().execute("updateViewState")},onPaymentMethodChanged:function(e){"CREDITCARD"!==e?O("showCcSelected",""):w("getCcSelectedName")},onCreditCardListReady:function(e){w("setCCFees",e)},onCcMethodTypeSelected:function(e){"CREDITCARD"===v.getPaymentManager().model.get("chosenMethod")&&O("showCcSelected",e)},trackMembershipInfo:function(){"subscriber"===Odigeo.Utils.readCookie("ua_dimension31")&&s.setCustomDimension(32,window.tmParam.unlocked_eligibility)},onPaymentManagerReady:function(){var e=Odigeo.UIElements.enhanceDateWithSelects($("#ccExpiration"),{yearLimit:2050});v.getPaymentManager().execute("enhancedElementList",{uielement:"ccExpiration",element:e}),Odigeo.UIElements.enhanceDateWithSelects($("#cnBirthDate"),{yearLimit:1910}),I.getPriceManagerEnhanced().execute("reloadPrices"),D||I.getSidebar().execute("fillPax"),Odigeo.requireWidget("flight-details-payments","flight_details",function(e){e.execute("refreshPaxData")}),Odigeo.Utils.sessionTimer.reset(),this.trackMembershipInfo(),s.trackPage("payment",{legacy:Odigeo.Utils.getFunnelTrackingLegacy()+"pago/",funnel:!0}),Odigeo.Utils.ensighten(),r.updateDatalayer(),B.removeClass("hidden"),Odigeo.UIElements.enhanceLoading($(".waiting_page")).hideLoading(),B.find(".paypal_info_hint").off().on(Odigeo.Events.tap,function(e){e.preventDefault(),window.open($(e.target).data("url"),"_blank","scrollbars=1,resizable=1,height=300,width=450")}),W&&v.dpWaitingPage().execute("deactivate"),Odigeo.Utils.patchFormsForiOS8(B),(v.getPaymentManager().isPaymentMethodRetry||v.getPaymentManager().isRepricing)&&(v.getPaymentManager().isRepricing=!1),v.getPaymentManager().isPaymentMethodRetry=!1;var t=v.getPaymentManager().error;_.isUndefined(t)||(v.getPaymentErrorManager().execute("updateErrorsCollection",t).execute("scrollToError"),v.getPaymentManager().error=null),(Odigeo.Utils.isRequestApp("dp")||Odigeo.Utils.isRequestApp("upsell"))&&Odigeo.trigger("reprice-manager:checkRepricing","#repricing-notification-payment");var i=Odigeo.Settings.property("appContext")+Odigeo.Settings.property("widgetUrlPrefix")+"flight_details/shortPaxInfo";$(".pax_info_table_details_payment").load(i,function(){Odigeo.requireWidget("flight-details-payments","flight_details",function(e){e.execute("paxDetailsUpdated")})})},onPriceManagerReady:function(){C(),$("input[name=agree]").off("change").on("change",function(){$("input[name=agree]").prop("checked")&&$(".pricebreakdown_remember_tooltip").addClass("hidden")}),Odigeo.trigger("reprice-manager:checkRepricing","#repricing-notification-payment"),Odigeo.UIElements.hint.enhance(Odigeo.History.getPageNameFromFragment(),$(".flightsummary_layover_hint_payment"),{events:{hover:!0}}),v.getPaymentManager().execute("updateFees")},onUpdateCardMethod:function(){$(".payment_method_remember_tooltip").addClass("hidden")},onScrollTo:function(e,t){var i=_.isObject(e)&&!_.isUndefined(e.top)?e.top:0;$("html, body").animate({scrollTop:i},t||{duration:500,easing:"swing"})},onHeightChanged:function(){$("#payment").find(".scroll_area").trigger("updateDimensions")},onUpdatePrices:function(e){I.getSidebar().execute("updatePrices",e)},onShowPaymentErrorsResume:function(e){var t="",i=B.find(".paymentmanager_validation_errors");!_.isUndefined(e)&&0<_.keys(e).length&&(K.hasClass("hidden")||"-1"!==j.val()||(e.cardType="empty"),_.each(e,function(e,i){var n,a={creditCardExpiration:"cardExpirationMonth"}[i]||i,s=$("input[name="+a+"], select[name="+a+"]");0<s.length&&""!==(n=s.closest(".card_field").find(".form-"+("invalid"===e?"error":"empty")).text().trim())&&(t=t+"<li>"+n+"</li>")}),i.html(t),Odigeo.trigger("payment-manager:showErrors","newError"))},onShowInvoiceManagerErrorsResume:function(e,t){var i,n=B.find(".invoicemanager_validation_errors"),a=B.find(".paymentmanager_validation_errors"),s="";a.empty(),_.each(e,function(e){i=".form-"+("invalid"===e.errorType?"invalid":"empty"),"invoice_name"!==e.name&&"invoice_id"!==e.name||(i=i+" span."+t);var n=$("input[name="+e.name+"]").parent().find(i).text().trim();s=s+"<li>"+n+"</li>"}),n.html(s),Odigeo.trigger("payment-manager:showErrors","newError")},onInvoiceManagerClearValidationErrors:function(){B.find(".invoicemanager_validation_errors").html("")},onShowErrors:function(){l.scrollToFirstError(B)},onSpecialrequestErrorsResume:function(e){var t,i=B.find(".specialrequest_validation_errors"),n="";_.each(e,function(e){t=$('[name="'+e.name+'"]').data(e.errorType),n=n+"<li>"+t+"</li>"}),i.html(n)},onSpecialrequestClearValidationErrors:function(){B.find(".specialrequest_validation_errors").empty()},onAfterSwitchView:function(){this.onScrollTo(0,100)},onNoPaymentMethodsAvailable:function(){Odigeo.UIElements.showBrokenFlowError()},goToPassengerDetails:function(){window.history.back()},cleaningDpWaitingPage:function(){q.removeClass("od-process-dpwaiting"),V.removeClass("disabled")},hiddenPageOverDpWaitingPage:function(){q.addClass("od-process-dpwaiting"),V.addClass("disabled")},sendUserToDpResults:function(e){var t="accommodation"===e?"dpresults_accommodation":"dpresults_flights";Odigeo.Session.set("DynPackActiveProduct",e),Odigeo.Router.navigate(t,{params:i})},onDpToggleAccommodationDetails:function(e){v.accommodationDetails().execute("process",e)},closeAccommodationDeTails:function(){v.accommodationDetails().execute("closeDetails")},onExpirationDateChange:function(e){if("cardExpirationMonth"===e.attr("name")){var t=new Date,i=$('select[name="cardExpirationYear"] option').eq(1),n=t.getMonth()+1;parseInt(e.val(),10)<n?i.attr("disabled","disabled"):i.removeAttr("disabled")}},goToPayment:function(){var e=$("#payment-manager").offset().top-10+"px";this.onScrollTo(e,100)},onUserAcceptAncillaryNagInstance:function(e){Odigeo.Utils.scrollToElement(e)},onUserRejectAncillaryNagInstance:function(){d.openAncillariesStep()},onPassengerPageComplete:function(t){var i=e.onPassengerPageComplete(t,oe,{},B);oe=i.hasErrors},validatePaymentPage:function(){var e=$("#i-agree-togglebutton").is(":checked"),t=v.getInvoiceManager(),i=v.getSpecialrequestManager(),n=v.getPaymentManager(),a=t.get("isInvoiceValid",!0);if(a&&(U=t.get("getInvoiceData"),n.execute("setInvoiceRequestDTO",U.invoicemanager)),Odigeo.AB.isMoveSpecialRequest)return n.execute("setBookingUserComments",JSON.parse(Odigeo.Session.get("bookingUserComments"))),v.binDetectionManager().get("isValid")&&e&&n.get("isValid")&&a&&!oe;var s=i.get("hasSpecialRequest"),r=i.get("isValid");return r&&s&&n.execute("setBookingUserComments",i.get("getSpecialRequestData")),v.binDetectionManager().get("isValid")&&e&&n.get("isValid")&&r&&a&&!oe},showPaymentValidationErrors:function(){var e=v.getPaymentManager(),t=$("#i-agree-togglebutton");t.is(":checked")||(s.trackEvent("confirm_purchase","conditions_unchecked_error"),Odigeo.trigger("payment-manager:showErrors","agree")),s.trackEvent("confirm_purchase","purchase_clicks_FE_error"),t.closest(".payment_agree").attr("data-state","invalid"),Odigeo.UIElements.enhanceLoading($(".waiting_page")).hideLoading(),e.execute("commit",{simulate:!0,showErrorsResume:!0,displayErrors:!0}),l.scrollToFirstError(B)},onContinueButtonClicked:function(){if(s.startMetric("LOAD_CONFIRM"),s.counterMetric("FRONT"+H+"PAYMENT_CLICK_COUNTER"),G(B),I.getBoardingOptions().execute("trackContinueToConfirmation"),this.validatePaymentPage()){s.counterMetric("FRONT"+H+"PAYMENT_VALIDATION_OK_COUNTER"),I.getPayWithGuarantee().execute("trackPurchase","normal",!0),P({loading:!0,disabled:!0},{loading:!1,disabled:!0});var e=Odigeo.Session.get("repricingClose");e&&s.trackEvent("repricing_popup",e),this.onPaymentValidationSuccess()}else s.counterMetric("FRONT"+H+"PAYMENT_VALIDATION_KO_COUNTER"),I.getPayWithGuarantee().execute("trackPurchase","normal",!1),this.showPaymentValidationErrors()},onPaymentValidationSuccess:function(){var e=v.getPaymentManager();s.trackEvent("confirm_purchase","purchase_clicks"),this.trackContinueWithAncillaries("payment"),$("#i-agree-togglebutton").closest(".payment_agree").removeAttr("data-state"),_.isNull(N)&&Odigeo.getWidgetByID("so-table")&&(N={serviceoptions:v.getServiceoptionsTableManager().get("getSelectedProductOrBasic")}),_.isNull(M)&&_.isNull(N)?(this.enablePaymentButton(),this.getBuyerInfoOnPayment(e)):T(),Odigeo.AB.isMoveSpecialRequest||v.getSpecialrequestManager().execute("analyticsEventTracking")},onTrackContinueButtonMouseover:function(){var e=v.getPaymentManager();if("CREDITCARD"===e.get("getPaymentMethod")&&!e.get("isValid")){var t=$(".payment_method_remember_tooltip");t.hasClass("hidden")&&(s.trackEvent("inline_bubbles","payment_form_bubble_appearances"),t.removeClass("hidden"))}if(!$("input[name=agree]").prop("checked")){var i=$(".pricebreakdown_remember_tooltip");i.hasClass("hidden")&&(s.trackEvent("inline_bubbles","conditions_bubble_appearances"),i.removeClass("hidden"))}},onAncillariesModuleItemToggled:function(e){e&&I.getServiceSummary().execute("updateConcept",_.extend(e,{isSetup:!1}))},addAncillaryData:function(e){switch(_.isEmpty(M)&&(M={insurances:[]}),e.selected?M.insurances.push(e.id):M.insurances.splice(M.insurances.indexOf(e.id),1),e.pbdType){case f.REBOOKING_INSURANCE:d.setSkipByRebooking(e.selected);break;case f.CANX_INSURANCE:d.setSkipByCanx(e.selected)}},ancillaryOfferSelectionChanged:function(e){I.getPayWithGuarantee().execute("updatePayWithGuarantee",e)},onAncillariesStepOpened:function(){this.trackContinueWithAncillaries("ancillaries"),se(),I.getPrimeAncillariesModule().execute("onPaymentStep"),Odigeo.AB.isMetaAncillariesPageActive||I.getProgressBar().execute("setPaymentState",3)},trackContinueWithAncillaries:function(e){var t,i,n=[];Odigeo.getWidgetByID("so-table")&&n.push(v.getServiceoptionsTableManager().get("getAddedProduct")),Odigeo.getWidgetByID("ancillaries-module")&&(t=I.getAncillariesModule().get("getAddedPolicies")),Odigeo.getWidgetByID("ancillaries-module-flex")&&(i=I.getAncillariesModuleFlex().get("getAddedPolicies")),$.when(t,i).done(function(t,i){var a=n.concat(t,i);m.track(e,a,"ancillaries")})},onOptimizeHasRendered:function(e){s.pushOptimizeWidget("payment",e)},onBoardingOptionsLoaded:function(e){I.getHandBaggageSummary().execute("storeBoardingOptions",e),I.getSidebar().execute("updateHandBaggageView",e)},onOpenMembershipPerksInfo:function(){I.getMembershipPerksInfoLightbox().execute("openMembershipPerksInfoLightbox",!0)},onOpenPrimeSubscriptionLightBox:function(){I.getPrimeAncillariesModule().execute("onOpenPrimeSubscriptionLightBox")},onUpdateMembershipProduct:function(e){I.getMembershipManager().execute("addMembership",e)},onAddMembershipResponse:function(e){_.isEmpty(e)?I.getPrimeAncillariesModule().execute("membershipAddedSuccessfully"):I.getPrimeAncillariesModule().execute("manageAddMembershipError")},onUpdateMembershipPricePayment:function(e){g.setMembershipPerksIncludedPrice(e),I.getPrimeAncillariesModule().execute("addProductToPbd",e)},onRefreshPdbPrices:function(){v.getPaymentManager().execute("changePaymentMethod")},onUpdatePageStatus:function(e){d.isEnabled()&&E(e)},onUpdatePaymentStepStatus:function(e){E(e)}})}),v.nagManager().execute("updateState"),s.startMetric("PLUS_LOAD_SO_TABLE"),v.getServiceoptionsTableManager().execute("load"),I.getPayWithGuarantee().execute("load"),s.startMetric(y.getLoadMetricKey(Odigeo.AB.isYesNoEnabledDesktop?"selection":"payment")),I.getAncillariesModule().execute("fetchData"),s.startMetric(y.getLoadMetricKey("paymentFlex")),I.getAncillariesModuleFlex().execute("fetchData"),I.getAncillariesDebugInfo().execute("load"),te.resize(_.throttle(function(){v.getServiceoptionsTableManager().execute("alignTableCellsHeight")},50)),Y.hasClass("hidden")&&(Odigeo.UIElements.hideAllDialogs(),Y.removeClass("hidden")),_.each(z,function(e){Odigeo.UIElements.hint.enhance(Odigeo.History.getPageNameFromFragment(),e,{events:{tap:!0}})}),C=function(){v.getServiceoptionsTableManager().execute("updateBreakdownPrices")},Odigeo.Router.eventController.execute(),0<R.length&&R.load(Odigeo.Settings.property("widgetUrlFormatter")("cybersource-fingerprint","cybersourcefingerprint")),Odigeo.Utils.sessionTimer.reset(),Odigeo.bind("complete:serviceoptions",function(e){"success"===e.type&&(N={serviceoptions:e.data})},this),v.getPaymentManager().execute("updatePaymentOptions"),c.isLoggedIn(),d.init(),W?"tap-details"!==Odigeo.Session.get("before-page")&&v.dpWaitingPage().execute("activate"):Odigeo.UIElements.enhanceLoading($(".waiting_page")).hideLoading(),_.isNull(F)||"confirmation"!==F.from.name?Odigeo.Session.set("before-page","payment"):v.getPaymentManager().isPaymentMethodRetry||v.getPaymentManager().isRepricing||(v.getPaymentManager().bookingAlreadyDone=!0,Odigeo.UIElements.showBookingAlreadyDone("alert")),P=function(e,t){B.find(".payment_continue_button").toggleClass("loading",e.loading).attr("disabled",e.disabled),I.getPayWithGuarantee().execute("togglePaymentBtn",t)},D&&I.getSidebar().execute("updatePage","payment"),I.getServiceSummary().execute("updatePage","payment"),x.get("login").execute("launchPriceMemberDisplay"),te.scroll(function(){var e=te.scrollTop(),t=D?"stickPriceSection":"manageScroll";ie=ee.find(".body_content").height(),ne=Z.offset().top,ae=B.find(".left_payment_bar").height(),I.getSidebar().execute(t,{scrollTop:e,bodyHeight:ie,footerTop:ne,paymentMainHeight:ae})}),s.bindEvents(B);var de,le=Odigeo.Session.get("booking_pax_list")||null,ge="";_.isNull(le)?(le=Odigeo.Session.get("passengersData")||null,_.isNull(le)||(ge=(de=Odigeo.Utils.parseJson(le)).passengers1.name)):(de=Odigeo.Utils.parseJson(le),ge=_.filter(de,{travellerId:"1"})[0].name),!_.isEmpty(ge)&&0<_.size(J)&&(X.html(ge),Q.addClass("hidden"),J.removeClass("hidden")),u.init("flights_pay_page"),s.stopMetric("LOAD_PAYMENTS"),b.trackOnLoadFlow(),p.refreshSession(v.getPaymentManager().model.get("bookingId")+"","payment")}}}()},function(e,t,i){"use strict";var n,a,s,r=i(0),o=(i(51),i(14).getInstance()),c=Odigeo.autoloadWidgets({getServiceoptionsTableManager:["so-table","service_options_table"]}),d=Odigeo.autoloadWidgetsAsync({getAncillariesModule:["ancillaries-module","ancillaries_module"]}),l=$("#payment"),g={paymentForm:l.find(".payment_pay_module"),stepButton:l.find(".ancillaries_step_button"),stepButtonContainer:l.find(".ancillaries_step_button_container"),ancillariesButton:l.find(".show_ancillaries_button"),ancillariesBlock:l.find(".ancillaries_block"),ancillariesModule:l.find("#ancillaries-module"),stepButtonContainerTitle:l.find(".ancillaries_step_title"),stepButtonContainerSubtitle:l.find(".ancillaries_step_subtitle")},h="isAncillaryStepOpenFirstTime";function u(){n=Odigeo.Utils.parseJson(Odigeo.Session.storage.getItem(h)),s=a=!1,_.isNull(n)?(g.paymentForm.fadeOut(),function(){g.stepButton.on(Odigeo.Events.tap,_.bind(function(){var e;n=!1,Odigeo.Session.storage.setItem(h,n),Odigeo.getWidgetByID("ancillaries-module")?(e="selection"===_.get(Odigeo.getWidgetByID("ancillaries-module"),"options.page"),d.getAncillariesModule().get("validateSelection",e).done(function(e){var t,i=_.get(e,"validationType","none"),n=_.get(e,"invalid",!1);switch(i){case"MANDATORY_SELECTION":!function(e){if(e){var t=g.ancillariesModule.find(".mandatory_selection_error").first().closest(".insurance_element");Odigeo.Utils.scrollToElement(t)}else d.getAncillariesModule().execute("rejectSelectionForUnSelectedSingleProducts"),p(!0)}(n);break;case"NAG":t=n,a||s||!t?p(!0):d.getAncillariesModule().execute("showContinueNag");break;default:p(!0)}})):p(!0)},this))}()):p(),o.getLoadedPromise().then(function(e){e&&o.isCanxFree()&&(g.stepButtonContainerTitle.removeClass("odf-hidden"),g.stepButtonContainerSubtitle.removeClass("odf-hidden"))})}function p(e){e&&Odigeo.getWidgetByID("so-table")&&c.getServiceoptionsTableManager().execute("addSoBasicIfNotAdded"),g.stepButton.addClass("odf-hidden"),g.stepButtonContainer.addClass("odf-hidden"),g.paymentForm.fadeIn(350),r.trackEvent("ancillaries_step","proceed_to_payment","ancillaries"),Odigeo.trigger("ancillariesStep:opened")}function f(){return 0<g.paymentForm.size()}e.exports={init:function(){f()&&u()},isEnabled:f,openAncillariesStep:p,setSkipByRebooking:function(e){a=e},setSkipByCanx:function(e){s=e}}},function(e,t,i){"use strict";var n,a,s,r,o,c,d;n=i(0),a=i(7),s=i(621),r=i(51),o=i(100).getInstance(),c=i(967),d=i(504),Odigeo.Router.handlers.pbpayment=function(){var e,t,i,l=Odigeo.autoloadWidgets({getUsersManager:["users-manager","usersmanager"],getBinDetection:["payment-bin-detection-manager","bindetectionmanager"],dpWaitingPage:["dpwaiting-page","dp_waiting_page"],accommodationDetails:["accommodation-details","accommodation_details"],getPaymentManager:["payment-manager","paymentmanager"],getPaymentErrorManager:["payment-error-manager","paymenterrormanager"],getInvoiceManager:["invoice-manager","invoice_manager"],getSpecialrequestManager:["specialrequest","special_request_manager"],nagManager:["nagmanager","nagmanager"],binDetectionManager:["payment-bin-detection-manager","bin_detection_manager"]}),g="sidebarsummary"===$(".side_summary_payment").data("type"),h=Odigeo.autoloadWidgetsAsync({getPriceManagerEnhanced:["price-breakdown-payments","pricemanager_enhanced"],getSidebar:g?["sidebar-summary-payment","sidebar_summary"]:["trip-summary-price-payment","trip_summary_price"],getServiceSummary:["service-summary","service_summary"],getPayWithGuarantee:["pay-with-guarantee","pay_with_guarantee"],getLoginHeader:["login-header","login"]}),u=$("#pbpayment"),p={},f=JSON.parse(Odigeo.Session.get("lastRouteChange")),m=$("#logo"),b=$('input[name="cardType"]'),y=$(".cc_not_detected"),v=u.find(".persuasion_message_popup"),S=u.find("#persuasive_title_name"),C=u.find(".almost_done_with_name"),w=u.find(".almost_done_without_name"),O=$("#footer"),T=$("#page"),P=$(window),E=0,k=0,A=0;e=function(e,t){Odigeo.requireWidget("payment-bin-detection-manager","bin_detection_manager",function(i){i.execute(e,t)})},t=function(e,t,i){h.getPriceManagerEnhanced().execute(e,{ccName:t,resolved:i}),_.isUndefined(t)||h.getSidebar().execute("setCcSelected",t)},Odigeo.Session.set("page","pbpayment"),Odigeo.Storage.remove("fromContinueButton"),o.fetchData(),Odigeo.Router.eventController=$.extend(!0,Odigeo.Router.eventController,Odigeo.Router.handlers.userEventController,Odigeo.Router.handlers.repriceManagerEventController,Odigeo.Router.handlers.errorManagerEventController,{globalEvents:{},viewEvents:_.extend(s.viewEvents(),{"payment-error-manager:sendValidationErrors":"sendValidationErrors","invoice-manager:clearValidationErrors":"onInvoiceManagerClearValidationErrors","invoice-manager:showErrorsResume":"onShowInvoiceManagerErrorsResume","payment-bin-detection-manager:creditCardTypeChanged":"onCreditCardChanged","payment-bin-detection-manager:methodTypeChanged":"onCcMethodTypeSelected","payment-bin-detection-manager:showPaymentMethodDisclaimer":"onShowPaymentMethodDisclaimer","payment-manager:confirmationLoading":"onConfirmationLoading","payment-manager:noPaymentMethodsAvailable":"onNoPaymentMethodsAvailable","payment-manager:paymentMethodChanged":"onPaymentMethodChanged","payment-manager:paymentOptionsUpdated":"onCreditCardListReady","payment-manager:ready":"onPaymentManagerReady","payment-manager:showErrors":"onShowErrors","payment-manager:showErrorsResume":"onShowPaymentErrorsResume","payment-manager:updateCardMethod":"onUpdateCardMethod","payment-manager:expirationDateChange":"onExpirationDateChange","payment-manager:creditCardTypeChanged":"onCreditCardChanged","price-breakdown-payments:priceManagerReady":"onPriceManagerReady","price-breakdown-payments:refreshData":"onPriceManagerReady","price-breakdown-payments:updatePricesTripSummary":"onUpdatePrices","price-breakdown-payments:toggleCcType":"onToggleCcType","price-breakdown-payments:breakdownLoaded":"onBreakdownLoaded","price-breakdown-payments:onContinueButtonClicked":"onContinueButtonClicked","price-breakdown-payments:trackContinueButtonMouseover":"onTrackContinueButtonMouseover","price-breakdown-payments:priceBreakdownToggled":"onPriceBreakdownToggled","specialrequest:clearValidationErrors":"onSpecialrequestClearValidationErrors","trip-summary-price-payment:changeBackPage":"changeBackPage","trip-summary-price-payment:toggleDetails":"onDpToggleAccommodationDetails","sidebar-summary-payment:toggleDetails":"onDpToggleAccommodationDetails","global:repricingShown":"onRepricing","shoppingcart-manager:enablePaymentButton":"enablePaymentButton","price-breakdown-payments:updateSummaryPrices":"onUpdateSummaryPrices","price-breakdown-payments:totalPriceUpdated":"refreshOfferPricesTextSize","pay-with-guarantee:rendered":"refreshOfferPricesTextSize","optimize:hasRendered":"onOptimizeHasRendered"}),eventHandlers:_.extend(s.eventHandlers(),{onPromotionalCodesUpdatePrices:_.noop,onDpToggleAccommodationDetails:function(e){l.accommodationDetails().execute("process",e)},refreshOfferPricesTextSize:function(){h.getPriceManagerEnhanced().execute("refreshOfferPricesTextSize")},onPriceBreakdownToggled:function(){this.refreshOfferPricesTextSize()},onUpdateSummaryPrices:function(){var e=g?"refreshPrice":"updatePrices";h.getSidebar().execute(e)},onToggleCcType:function(e){h.getSidebar().execute("toggleCcType",e)},sendValidationErrors:function(e){l.getPaymentErrorManager().execute("updateErrorsCollection",e)},onUpdateFlagPriceManager:function(e){h.getPriceManagerEnhanced().execute("updateFlag",e)},onConfirmationLoading:function(){m.addClass("disabled"),Odigeo.Session.remove("before-page")},onCreditCardChanged:function(e,i,n,a){e&&"-1"!==e&&l.getPaymentManager().execute("setCreditCardType",e,a),"CREDITCARD"===l.getPaymentManager().model.get("chosenMethod")&&t("showCcSelected",i,n),g||h.getSidebar().execute("setCcSelected",i)},onShowPaymentMethodDisclaimer:function(e){t("showPaymentMethodDisclaimer",e.ccName,e.resolved)},onBreakdownLoaded:function(){e("getCcSelectedName"),l.getPaymentManager().execute("isStoredCardSelected")},onRepricing:function(){Odigeo.requireWidget("payment-page-top-persuasive-message","persuasiveMessaging",function(e){e.execute("closeMessage")})},enablePaymentButton:function(){i({loading:!1,disabled:!1},{loading:!1,disabled:!1}),h.getPayWithGuarantee().execute("updateViewState")},onPaymentMethodChanged:function(i){"CREDITCARD"!==i?t("showCcSelected",""):e("getCcSelectedName")},onCreditCardListReady:function(t){e("setCCFees",t)},onCcMethodTypeSelected:function(e){"CREDITCARD"===l.getPaymentManager().model.get("chosenMethod")&&t("showCcSelected",e)},onPaymentManagerReady:function(){var e=Odigeo.UIElements.enhanceDateWithSelects($("#ccExpiration"),{yearLimit:2050});l.getPaymentManager().execute("enhancedElementList",{uielement:"ccExpiration",element:e}),Odigeo.UIElements.enhanceDateWithSelects($("#cnBirthDate"),{yearLimit:1910}),h.getPriceManagerEnhanced().execute("reloadPrices"),Odigeo.Utils.sessionTimer.reset(),n.trackPage("payment",{legacy:Odigeo.Utils.getFunnelTrackingLegacy()+"pago/",funnel:!0}),Odigeo.Utils.ensighten(),a.updateDatalayer(),u.removeClass("hidden"),Odigeo.UIElements.enhanceLoading($(".waiting_page")).hideLoading(),u.find(".paypal_info_hint").off().on(Odigeo.Events.tap,function(e){e.preventDefault(),window.open($(e.target).data("url"),"_blank","scrollbars=1,resizable=1,height=300,width=450")}),Odigeo.Utils.patchFormsForiOS8(u),(l.getPaymentManager().isPaymentMethodRetry||l.getPaymentManager().isRepricing)&&(l.getPaymentManager().isRepricing=!1),l.getPaymentManager().isPaymentMethodRetry=!1;var t=l.getPaymentManager().error;_.isUndefined(t)||(l.getPaymentErrorManager().execute("updateErrorsCollection",t).execute("scrollToError"),l.getPaymentManager().error=null),(Odigeo.Utils.isRequestApp("dp")||Odigeo.Utils.isRequestApp("upsell"))&&Odigeo.trigger("reprice-manager:checkRepricing","#repricing-notification-payment")},onPriceManagerReady:function(){$("input[name=agree]").off("change").on("change",function(){$("input[name=agree]").prop("checked")&&$(".pricebreakdown_remember_tooltip").addClass("hidden")}),Odigeo.trigger("reprice-manager:checkRepricing","#repricing-notification-payment"),Odigeo.UIElements.hint.enhance(Odigeo.History.getPageNameFromFragment(),$(".flightsummary_layover_hint_payment"),{events:{hover:!0}}),l.getPaymentManager().execute("updateFees")},onUpdateCardMethod:function(){$(".payment_method_remember_tooltip").addClass("hidden")},onUpdatePrices:function(e){h.getSidebar().execute("updatePrices",e)},onShowPaymentErrorsResume:function(e){var t="",i=u.find(".paymentmanager_validation_errors");!_.isUndefined(e)&&0<_.keys(e).length&&(y.hasClass("hidden")||"-1"!==b.val()||(e.cardType="empty"),_.each(e,function(e,i){var n,a={creditCardExpiration:"cardExpirationMonth"}[i]||i,s=$("input[name="+a+"], select[name="+a+"]");0<s.length&&""!==(n=s.closest(".card_field").find(".form-"+("invalid"===e?"error":"empty")).text().trim())&&(t=t+"<li>"+n+"</li>")}),i.html(t),Odigeo.trigger("payment-manager:showErrors","newError"))},onShowInvoiceManagerErrorsResume:function(e,t){var i,n=u.find(".invoicemanager_validation_errors"),a=u.find(".paymentmanager_validation_errors"),s="";a.empty(),_.each(e,function(e){i=".form-"+("invalid"===e.errorType?"invalid":"empty"),"invoice_name"!==e.name&&"invoice_id"!==e.name||(i=i+" span."+t);var n=$("input[name="+e.name+"]").parent().find(i).text().trim();s=s+"<li>"+n+"</li>"}),n.html(s),Odigeo.trigger("payment-manager:showErrors","newError")},onInvoiceManagerClearValidationErrors:function(){u.find(".invoicemanager_validation_errors").html("")},onShowErrors:function(){r.scrollToFirstError(u)},onSpecialrequestErrorsResume:function(e){var t,i=u.find(".specialrequest_validation_errors"),n="";_.each(e,function(e){t=$('[name="'+e.name+'"]').data(e.errorType),n=n+"<li>"+t+"</li>"}),i.html(n)},onSpecialrequestClearValidationErrors:function(){u.find(".specialrequest_validation_errors").empty()},onNoPaymentMethodsAvailable:function(){Odigeo.UIElements.showBrokenFlowError()},changeBackPage:function(){window.history.back()},onExpirationDateChange:function(e){if("cardExpirationMonth"===e.attr("name")){var t=new Date,i=$('select[name="cardExpirationYear"] option').eq(1),n=t.getMonth()+1;parseInt(e.val(),10)<n?i.attr("disabled","disabled"):i.removeAttr("disabled")}},validatePaymentPage:function(){var e=$("#i-agree-togglebutton").is(":checked"),t=l.getInvoiceManager(),i=l.getPaymentManager(),n=t.get("isInvoiceValid",!0);return n&&(p=t.get("getInvoiceData"),i.execute("setInvoiceRequestDTO",p.invoicemanager)),l.binDetectionManager().get("isValid")&&e&&i.get("isValid")&&n},showPaymentValidationErrors:function(){var e=l.getPaymentManager(),t=$("#i-agree-togglebutton");t.is(":checked")||(n.trackEvent("confirm_purchase","conditions_unchecked_error"),Odigeo.trigger("payment-manager:showErrors","agree")),n.trackEvent("confirm_purchase","purchase_clicks_FE_error"),t.closest(".payment_agree").attr("data-state","invalid"),Odigeo.UIElements.enhanceLoading($(".waiting_page")).hideLoading(),e.execute("commit",{simulate:!0,showErrorsResume:!0,displayErrors:!0}),r.scrollToFirstError(u)},onContinueButtonClicked:function(){if(n.startMetric("LOAD_CONFIRM"),this.validatePaymentPage()){h.getPayWithGuarantee().execute("trackPurchase","normal",!0),i({loading:!0,disabled:!0},{loading:!1,disabled:!0});var e=Odigeo.Session.get("repricingClose");e&&n.trackEvent("repricing_popup",e),this.onPaymentValidationSuccess()}else n.counterMetric("FRONT_FLIGHTS_PAYMENT_VALIDATION_KO_COUNTER"),this.showPaymentValidationErrors()},onPaymentValidationSuccess:function(){var e=l.getPaymentManager();n.trackEvent("confirm_purchase","purchase_clicks"),$("#i-agree-togglebutton").closest(".payment_agree").removeAttr("data-state"),this.enablePaymentButton(),e.execute("commit",{showErrorsResume:!0,isAccommodationPostBooking:!0}),l.getSpecialrequestManager().execute("analyticsEventTracking")},onTrackContinueButtonMouseover:function(){var e=l.getPaymentManager();if("CREDITCARD"===e.get("getPaymentMethod")&&!e.get("isValid")){var t=$(".payment_method_remember_tooltip");t.hasClass("hidden")&&(n.trackEvent("inline_bubbles","payment_form_bubble_appearances"),t.removeClass("hidden"))}if(!$("input[name=agree]").prop("checked")){var i=$(".pricebreakdown_remember_tooltip");i.hasClass("hidden")&&(n.trackEvent("inline_bubbles","conditions_bubble_appearances"),i.removeClass("hidden"))}},onOptimizeHasRendered:function(e){n.pushOptimizeWidget("payment",e)}})}),h.getPayWithGuarantee().execute("load"),_.each(v,function(e){Odigeo.UIElements.hint.enhance(Odigeo.History.getPageNameFromFragment(),e,{events:{tap:!0}})}),Odigeo.Router.eventController.execute(),Odigeo.Utils.sessionTimer.reset(),l.getPaymentManager().execute("updatePaymentOptions"),s.isLoggedIn(),Odigeo.UIElements.enhanceLoading($(".waiting_page")).hideLoading(),_.isNull(f)||"confirmation"!==f.from.name?Odigeo.Session.set("before-page","payment"):l.getPaymentManager().isPaymentMethodRetry||l.getPaymentManager().isRepricing||(l.getPaymentManager().bookingAlreadyDone=!0,Odigeo.UIElements.showBookingAlreadyDone("alert")),i=function(e,t){u.find(".payment_continue_button").toggleClass("loading",e.loading).attr("disabled",e.disabled),h.getPayWithGuarantee().execute("togglePaymentBtn",t)},g&&h.getSidebar().execute("updatePage","payment"),P.scroll(function(){var e=P.scrollTop(),t=g?"stickPriceSection":"manageScroll";E=T.find(".body_content").height(),k=O.offset().top,A=u.find(".left_payment_bar").height(),h.getSidebar().execute(t,{scrollTop:e,bodyHeight:E,footerTop:k,paymentMainHeight:A})}),n.bindEvents(u);var D=Odigeo.Utils.parseJson(Odigeo.Session.get("bookingInfo")).buyer.name;!_.isEmpty(D)&&0<_.size(C)&&(S.html(D),w.addClass("hidden"),C.removeClass("hidden")),c.init("flights_pay_page"),n.stopMetric("LOAD_PAYMENTS"),l.getPaymentManager().execute("getPaymentOptions"),d.refreshSession(l.getPaymentManager().model.get("bookingId")+"","payment")}},function(e,t,i){"use strict";var n,a;n=i(0),a=i(7),Odigeo.Router.handlers.payment3ds=function(){var e=Odigeo.Settings.property("appContext")+"/service/recoverfromuserinteraction";Odigeo.Router.eventController=$.extend(!0,Odigeo.Router.eventController,Odigeo.Router.handlers.errorManagerEventController,{globalEvents:{},viewEvents:{},eventHandlers:{}}),Odigeo.Router.eventController.execute(),n.trackPage("redirection-3dsecure",{legacy:Odigeo.Utils.getFunnelTrackingLegacy()+"pago/",funnel:!0}),a.updateDatalayer(),Odigeo.Session.set("payment3ds","true"),$.ajax({type:"GET",url:e,success:function(e){if(_.isEmpty(e))Odigeo.UIElements.showBrokenFlowError("alert",!0),Odigeo.UIElements.enhanceLoading($(".waiting_page")).hideLoading();else if(e.errors)"SESSION_EXPIRED_ERROR"===e.errors[0].code?Odigeo.UIElements.showSessionExpiredError("alert",!0):Odigeo.UIElements.showBrokenFlowError("alert",!0),Odigeo.UIElements.enhanceLoading($(".waiting_page")).hideLoading();else if("BOOKING_PAYMENT_RETRY"===e.bookingStatus&&"SOFORT"!==e.myTrip.paymentRetryInfo.paymentDetails.method)Odigeo.requireWidget("payment-manager","paymentmanager",function(t){t.execute("paymentRetry",e)}),Odigeo.Router.navigate("payment"),Odigeo.Utils.ensighten(e.tmParam);else{Odigeo.Router.navigate("confirmation"),e.tmParam&&Odigeo.Utils.ensighten(e.tmParam);var t={bookingstatus:e.bookingStatus,repricing:e.repricing,extensions:e.extensions,myTrip:e.myTrip,membershipPerksDTO:e.membershipPerksDTO,userInteractionNeededDTO:e.userInteractionNeededDTO||null,analyticsEcommerce:e.analyticsEcommerce};_.delay(function(){Odigeo.trigger("payment-manager:confirmationReady",t)},1e3)}},error:function(e){Odigeo.Model.prototype.afterLoadData(e)}})}},function(e,t,i){"use strict";var n,a,s,r,o,c,d,l;n=i(0),a=i(7),s="flights_confirmation_page",r=i(836),o=i(158),c=i(56),d=i(40),l=i(92),Odigeo.Router.handlers.confirmation=function(){var e="confirmation",t=Odigeo.Session.get("page"),g=JSON.parse(Odigeo.Session.get("lastRouteChange")),h=$(".waiting_page"),u=$(".price_breakdown_payments_container"),p=Odigeo.UIElements.enhanceLoading(h),f=!_.isNull(g)&&"payment"===g.from.name&&"confirmation"===g.to.name,m=Odigeo.autoloadWidgets({dpWaitingPage:["dpwaiting-page","dp_waiting_page"],accommodationDetails:["accommodation-details","accommodation_details"]}),b=$(".home_main_layout"),y=Odigeo.Utils.isRequestApp("dp"),v=y?"_DYNPACK_":"_FLIGHTS_",S=!1,C=y?"dpresults":"results",w=Odigeo.autoloadWidgetsAsync({getConfirmationManager:["confirmation-manager","confirmation_manager"],getUsersManager:["users-manager","usersmanager"],sessionRecorder:["session-recorder","sessionrecorder"]}),O=d({login:["login-header",c]});_.isNull(g)&&"confirmation"===t||Odigeo.Session.set("confirmationReloaded",!1),Odigeo.Session.set("page",e);var T=i(837),P=3===Odigeo.AB.confirmationMytripsAutomaticRedirection?new T(y,O,{name:"waitingPage",waitingController:p}):new T(y,O,{name:"dialog"}),E=P.automaticRedirectionStates;y?m.dpWaitingPage().execute("activate"):Odigeo.Utils.parseJson(Odigeo.Session.get("isAccommodationPostBooking"))?p.showLoading(["waiting_post_booking_accommodation_confirmation"]):p.showLoading(["waiting_processing_booking","waiting_bottom","waiting_confirmation","waiting_bottom_gradient"]);var k=function(){var e=$("#confirmation").find(".serviceoptions_confirmation_details li");_.each(e,function(e){Odigeo.UIElements.hint.enhance("confirmation",$(e).find("div"),{generateHtml:!0,wrapperClass:"od-service-options-hint od-hint-notitle so_detail_hint",hintTriggerButton:{hintTriggerButtonClass:"od-service-options-hint-btn",hintTriggerButtonText:"9"},events:{hover:!1,tap:!0}})})},A=function(e){Odigeo.Utils.parseJson(Odigeo.Session.get("isAccommodationPostBooking"))?Odigeo.Router.navigate("pbpayment",e):Odigeo.Router.navigate("payment",e)},D=function(){Odigeo.requireWidget("payment-manager","paymentmanager",function(e){e.execute("setManualPaymentRetry",!0),_.defer(A)})};Odigeo.Router.eventController=$.extend(!0,Odigeo.Router.eventController,Odigeo.Router.handlers.errorManagerEventController,{globalEvents:{},viewEvents:{"payment-manager:confirmationReady":"onConfirmationReady","payment-manager:confirmationShoppingBasketReady":"onConfirmationShoppingBasketReady","confirmation-manager:userInteractionNeeded":"onUserInteractionNeeded","confirmation-manager:bookingConfirmedLoaded":"onBookingConfirmedLoaded","confirmation-manager:bookingPaymentRetryLoaded":"onBookingPaymentRetryLoaded","confirmation-manager:bookingRejectedLoaded":"onBookingRejectedLoaded","confirmation-manager:bookingNegativeFeeLoaded":"onBookingNegativeFeeLoaded","confirmation-manager:bookingPendingLoaded":"renderXsell","confirmation:cancelPayment":"onCancelPayment","confirmation:buyFlightBtn":"onBuyFlightBtn","confirmation-manager:bookingRepricingLoaded":"onBookingRepricingLoaded","flight-details-confirmation:toggleDetails":"onDpToggleAccommodationDetails","confirmation-manager:confirmationPageSuccessfully":"onConfirmationPageSuccessfully","confirmation-manager:confirmationPageUnsuccessfully":"onConfirmationPageUnsuccessfully","dpwaiting-page:cleanDpWaitingPage":"cleaningDpWaitingPage","confirmation-widget:hotelsSearchCompletedSuccessfully":"onHotelsSearchCompletedSuccessfully","confirmation-widget:hotelsSearchFailed":"onHotelsSearchFailed","confirmation-manager:goToMyTrips":"onGoToMyTrips","login-header:navigateToMyTrips":"navigateToMyTrips","login-header:navigateToTripDetails":"navigateToTripDetails","confirmation-manager:goToMyTripsDetails":"requestBookingDetails","users-manager:getTripOk":"goToMyTripsDetails","users-manager:getTripWithError":"catchGetTripError","users-manager:getTripError":"catchGetTripError"},confirmationData:{},eventHandlers:{helpers:{showAdvertisementListGpt:function(){var e=$("#confirmation").find(".advertisement_gpt");0<e.length&&(_.each(e,function(e){$(e).removeClass("hidden").show()}),Odigeo.UIElements.enhanceAdvertisementGpt(e,!0,!0,!0))}},goToMyTripsDetails:function(e){P.automaticRedirectionStatus===E.INIT&&(P.automaticRedirectionStatus=E.SUCCESSFUL,Odigeo.Session.set("isFromAutomaticRedirection",!0),n.stopMetric("LOAD_CONFIRM")),P.goToMyTripsDetails(e.bookingDetailDTO)},catchGetTripError:function(){P.automaticRedirectionStatus===E.INIT?(P.catchAutomaticRedirectionError(),w.getConfirmationManager().execute("renderConfirmationWhenBookingApiError",this.confirmationData)):P.catchGetTripError()},onGoToMyTrips:function(){O.get("login").execute("goToMyTrips")},navigateToMyTrips:function(){Odigeo.Router.navigate("mytrips")},navigateToTripDetails:function(){Odigeo.Router.navigate("tripdetails")},automaticRedirection:function(e){this.hideWaitings(),P.automaticRedirectionStatus=E.INIT,P.requestBookingDetailsWithConfirmationdata(w.getUsersManager,e),this.confirmationData=e},requestBookingDetails:function(){P.requestBookingDetails(w.getUsersManager)},onConfirmationShoppingBasketReady:function(e){$("#logo").removeClass("disabled"),Odigeo.requireWidget("confirmation-manager","confirmation_manager",function(t){t.execute("loadOnReady",e)}),p.hideLoading(),$(".header_funnel_background").css({height:"190px"})},confirmationReadyTrackings:function(e){var t,i,s,r=e.myTrip,o=_.isObject(r)?r.accommodationBooking:null,c="UNKNOWN"===(_.isObject(o)?o.bookingStatus:null),d="BOOKING_CONFIRMED"===e.bookingstatus&&c;_.includes(["BOOKING_CONFIRMED","BOOKING_RETAINED","BOOKING_PENDING"],e.bookingstatus)&&(a.updateDatalayer(e.tmsDatalayer),t=e.analyticsEcommerce,i=e.myTrip.itineraries[0].segments[0].departureLocation.iata+"-"+e.myTrip.itineraries[0].segments[0].arrivalLocation.iata,t.locations=i,s=t.transaction,Odigeo.trigger("analytics:tracking",{type:"trackVirtualPageInClassic",data:{page:"confirmation",funnel:!0,legacy:Odigeo.Utils.getFunnelTrackingLegacy()+"confirmacion/"+i+"/"}}),n.trackEcommerce(t),Odigeo.trigger("analytics:tracking",{type:"trackVirtualPageInUniversal",data:{page:"confirmation",funnel:!0,customMetrics:t.customMetrics}}),Odigeo.UIElements.advertisementSpotlightConfirmation({quantity:t.items?t.items.length:0,cost:_.isUndefined(s.total)?0:s.total,orderId:_.isUndefined(s.orderId)?"":s.orderId})),"BOOKING_CONFIRMED"!==e.bookingstatus||c?("BOOKING_PENDING"===e.bookingstatus||d)&&n.trackEventWithCategory("flights_confirmation_page_pending","booking_status","pending_booking"):n.trackEventWithCategory("flights_confirmation_page_confirmed","booking_status","confirmed_booking")},isNotBankTransfer:function(e){return _.isNull(e.myTrip)||!e.myTrip.bankTransfer},shouldDoAutomaticRedirection:function(e){return 3===Odigeo.AB.confirmationMytripsAutomaticRedirection&&!Odigeo.Utils.parseJson(Odigeo.Session.get("isAccommodationPostBooking"))&&_.includes(["BOOKING_CONFIRMED","BOOKING_PENDING"],e.bookingstatus)&&"desktop"===Odigeo.SessionScope.flow&&this.isNotBankTransfer(e)},onConfirmationReady:function(e){var t,i=Odigeo.Utils.parseJson(Odigeo.Session.get("searchParameters"))||{},a=_.extend({},e,i);n.counterMetric("FRONT"+v+"CONFIRMATION_READY_COUNTER"),o.getInstance().setFromConfirmation(a),s+=e.bookingstatus.toLowerCase().substring(e.bookingstatus.indexOf("_")),this.confirmationReadyTrackings(e),this.shouldDoAutomaticRedirection(e)?this.automaticRedirection(e):Odigeo.requireWidget("confirmation-manager","confirmation_manager",function(t){t.execute("loadOnReady",e)}),n.trackEventIfCondition(s,"unlocked","subscriber_included_booking",!_.isNull(e.membershipPerksDTO)),S=!_.isNull(e.membershipPerksDTO),$("#logo").removeClass("disabled"),"BOOKING_CONFIRMED"===e.bookingstatus&&(t=Odigeo.Utils.parseJson(Odigeo.Storage.get("mytripsData"))||[],_.isEmpty(e.myTrip)||t.push(e.myTrip),Odigeo.Storage.set("mytripsData",JSON.stringify(t))),b.on(Odigeo.Events.tap,".confirmation_cars_textlink_button",function(e){e.stopPropagation(),e.preventDefault();var t=e.target.href;Odigeo.requireWidget("google-analytics","googleanalytics",function(e){t=e.execute("prepareUrlToTrackCrossDomain",t)}),n.trackEventWithCategory((Odigeo.Utils.isRequestApp("dp")?"dynpack":"flights")+"_confirmation_page_confirmed","xsell_banner","cars_clicks_button"),window.open(t)}),b.on(Odigeo.Events.tap,".confirmation_ground_transports_textlink_button",function(e){e.stopPropagation(),e.preventDefault();var t=e.target.href;n.trackEvent("xsell_banner","groundtransportation_clicks_button",(Odigeo.Utils.isRequestApp("dp")?"dynpack":"flights")+"_confirmation_page_confirmed"),window.open(t)}),_.isFunction(window.usabilla_live)&&window.usabilla_live("virtualPageView"),l.trackOnLoadFlow()},onUserInteractionNeeded:function(e){r.userInteractionNeededHandler(e,v)},onBookingNegativeFeeLoaded:function(){n.counterMetric("FRONT"+v+"CONFIRMATION_NEGATIVE_FEE_COUNTER"),Odigeo.requireWidget("payment-manager","paymentmanager",function(e){e.execute("showNegativeFee")}),_.delay(function(){window.history.back()},2*Odigeo.ViewSwitcher.animationDuration)},onBookingConfirmedLoaded:function(){n.counterMetric("FRONT"+v+"CONFIRMATION_CONFIRMED_COUNTER"),_.isFunction(window.usabilla_live)&&(_.set(window.tmParam,"has_membership_discount",S),window.usabilla_live("data",{custom:window.tmParam}),window.usabilla_live("virtualPageView"));var e=$("#insurance-inconfirmation"),t=function(e){e.stopPropagation(),e.preventDefault();var t=$(e.target);t=t.data("tracking")?t:t.closest(".insurance_inconfirmation"),n.trackEvent("insurances_widget",t.data("tracking"),Odigeo.History.getPageNameFromFragment())};Odigeo.Utils.parseJson(Odigeo.Session.get("isAccommodationPostBooking"))||this.renderXsell(),this.helpers.showAdvertisementListGpt(),k(),Odigeo.requireWidget("flight-details-confirmation","flight_details"),Odigeo.requireWidget("get-your-guide","get_your_guide"),e.find(".insurance_inconfirmation").on(Odigeo.Events.tap,t),e.find(".insurance_inconfirmation_form_trigger").on(Odigeo.Events.tap,function(e){t(e),$("#confirmation").find('form[name="usaInsuranceForm"]').submit()}),n.addCrossDomainIframesTracking()},renderXsell:function(){Odigeo.Utils.parseJson(Odigeo.Session.get("isAccommodationPostBooking"))||Odigeo.requireWidget("xsell-products-iframes","xsell_products_iframes",function(e){e.execute("renderIframes",b.find(".xsell_products_iframes"))})},onBookingPaymentRetryLoaded:function(e){r.paymentRetryHandler(e,v,"paymentRetry"),n.trackPage("payment",{funnel:!0,error:{type:"default",message:"retry"}}),A({isSecured:!0,replace:!1})},onBookingRejectedLoaded:function(){n.counterMetric("FRONT"+v+"CONFIRMATION_REJECTED_COUNTER"),Odigeo.requireWidget("confirmation-manager","confirmation_manager",function(e){e.view.$cachedSelectors.confirmationContainer.find(".button_search").one(Odigeo.Events.tap,function(){n.trackEventWithCategory("flights_confirmation_page_rejected","reject_solutions","launch_new_search"),Odigeo.Utils.parseJson(Odigeo.Session.get("isAccommodationPostBooking"))?Odigeo.Utils.repeatAccommodationPBSearch():Odigeo.Router.navigate(C)})}),this.helpers.showAdvertisementListGpt(),n.trackPage("confirmation",{funnel:!0,error:{type:"default",message:"rejected"},legacy:Odigeo.Utils.getFunnelTrackingLegacy()+"rejected/"}),n.trackEventWithCategory("flights_confirmation_page_rejected","booking_status","rejected_booking"),k()},onCancelPayment:function(){n.counterMetric("FRONT"+v+"CONFIRMATION_CANCELED_COUNTER"),n.trackPage("payment",{funnel:!0,error:{type:"default",message:"canceled"}}),Odigeo.Router.navigate("payment")},onBuyFlightBtn:function(){Odigeo.requireWidget("payment-manager","paymentmanager",function(e){e.execute("commit",!1)})},onBookingRepricingLoaded:function(t){!Odigeo.AB.isNewCreateShoppingCart&&Odigeo.AB.repricingPopupFromCollectionDataEnabled&&w.sessionRecorder().execute("start",[],e),r.repricingHandlerDesktop(t,u,v),n.trackPage("payment",{funnel:!0,error:{type:"default",message:"repricing"}}),Odigeo.Router.navigate("payment",{isSecured:!0,replace:!0})},cleaningDpWaitingPage:function(){b.removeClass("od-process-dpwaiting")},onDpToggleAccommodationDetails:function(e){m.accommodationDetails().execute("process",e)},onConfirmationPageSuccessfully:function(){n.stopMetric("LOAD_CONFIRM"),this.hideWaitings()},onConfirmationPageUnsuccessfully:function(){this.hideWaitings()},hideWaitings:function(){y&&(this.enhancePopupCondition(),m.dpWaitingPage().execute("deactivate")),Odigeo.UIElements.enhanceLoading(h).hideLoading()},enhancePopupCondition:function(){Odigeo.UIElements.hint.enhance(Odigeo.History.getPageNameFromFragment(),b.find(".popup_confirmation_conditions_hint"),{events:{tap:!0}}),b.find(".conditions_section_title").on(Odigeo.Events.tap,_.bind(this.showConditionsSection,this))},showConditionsSection:function(e){e.stopPropagation(),b.find('div[class^="conditions_section_content_"]').addClass("hidden"),b.find(".conditions_section_content_"+$(e.currentTarget).data("layer")).removeClass("hidden")},onHotelsSearchCompletedSuccessfully:function(e){w.getConfirmationManager().execute("loadHotelsBanner",e)},onHotelsSearchFailed:function(e){w.getConfirmationManager().execute("loadHotelsBannerNoResults",e)}}}),Odigeo.Router.eventController.execute(),_.isEmpty(Odigeo.PageStorage.get("confirmation"))||Odigeo.PageStorage.set("confirmation",!0);var I="false"===Odigeo.Storage.get("confirmationReached");"confirmation"===t&&(f&&(I?D():Odigeo.Session.set("confirmationReloaded",!0)),"true"===Odigeo.Session.get("confirmationReloaded")&&Odigeo.UIElements.showBookingAlreadyDone("alert")),_.isNull(Odigeo.Storage.get("fromContinueButton"))&&f&&D(),n.bindEvents(b)}},function(e,t,i){"use strict";var n,a;n=i(0),a=i(7),Odigeo.Router.handlers.register=function(){$("#page").removeClass().addClass("register"),Odigeo.Session.set("page","register"),Odigeo.Router.eventController=$.extend(!0,Odigeo.Router.eventController,Odigeo.Router.handlers.userEventController,{globalEvents:{"global:userLogged":"onUserLogged"},viewEvents:{"users-manager:registerOk":"onRegisterEvent","users-manager:registerWithError":"onRegisterEvent","users-manager:registerError":"onRegisterEvent","users-manager:registerWithFacebookOk":"onRegisterEvent","users-manager:registerWithFacebookWithError":"onRegisterEvent","users-manager:registerWithFacebookError":"onRegisterEvent","users-manager:registerWithGoogleOk":"onRegisterEvent","users-manager:registerWithGoogleWithError":"onRegisterEvent","users-manager:registerWithGoogleError":"onRegisterEvent","users-manager:updateAccountInfoOk":"onRegisterEvent","users-manager:updateAccountInfoWithError":"onRegisterEvent","users-manager:updateAccountInfoError":"onRegisterEvent","register-manager:submitUserRequest":"onSubmitUserRequest","register-manager:registerSuccess":"onChangeHeader","recaptcha:loaded":"onRecaptchaLoaded"},eventHandlers:{onRegisterEvent:function(e){Odigeo.requireWidget("register-manager","register_manager",function(t){t.execute(e.action,e)})},onChangeHeader:function(){$(".header_funnel_background").addClass("od-header-register-short")},onSubmitUserRequest:function(e){Odigeo.requireWidget("users-manager","usersmanager",function(t){t.execute("submitUserRequest",e)})},onUserLogged:function(){Odigeo.Utils.goToApplicationHome()},onRecaptchaLoaded:function(){Odigeo.requireWidget("register-manager","register_manager",function(e){e.execute("renderCaptcha")})}}}),Odigeo.Router.eventController.execute(),Odigeo.Utils.sessionTimer.reset(),Odigeo.Utils.ensighten({page_name:"registration",page_type:"general"}),n.trackPage("register",{funnel:!1}),a.updateDatalayer()}},function(e,t,i){"use strict";var n,a;n=i(0),a=i(7),Odigeo.Router.handlers.resetpassword=function(e){$("#page").removeClass().addClass("resetpassword"),Odigeo.Session.set("page","resetpassword"),Odigeo.Router.eventController=$.extend(Odigeo.Router.eventController,Odigeo.Router.handlers.userEventController),Odigeo.Router.eventController=$.extend(!0,Odigeo.Router.eventController,{globalEvents:{},viewEvents:{"reset-password:submitUserRequest":"onSubmitUserRequest","users-manager:changePasswordWithCodeOk":"onChangePasswordSuccess","users-manager:changePasswordWithCodeWithError":"onChangePasswordWithError","users-manager:changePasswordWithCodeError":"onChangePasswordError"},eventHandlers:{onChangePasswordSuccess:function(e){t("passwordChangedOk",e)},onChangePasswordWithError:function(e){t("passwordWithError",e)},onChangePasswordError:function(e){t("passwordError",e)},onSubmitUserRequest:function(e){Odigeo.requireWidget("users-manager","usersmanager",function(t){t.execute("submitUserRequest",e)})}}}),Odigeo.Router.eventController.execute();var t=function(e,t){Odigeo.requireWidget("reset-password","resetpassword",function(i){i.execute(e,t)})};Odigeo.requireWidget("reset-password","reset_password_manager",function(t){t.execute("setRecoverCode",e)}),Odigeo.Utils.ensighten({page_name:"change_password",page_type:"general"}),n.trackPage("password_change",{funnel:!1}),a.updateDatalayer(),Odigeo.Utils.sessionTimer.reset()}},function(e,t,i){"use strict";var n,a;n=i(0),a=i(7),Odigeo.Router.handlers.accountblocked=function(){$("#page").removeClass().addClass("accountblocked"),Odigeo.Session.set("page","accountblocked"),Odigeo.Router.eventController=$.extend(Odigeo.Router.eventController,Odigeo.Router.handlers.userEventController),Odigeo.Router.eventController=$.extend(!0,Odigeo.Router.eventController,{}),Odigeo.Router.eventController.execute(),Odigeo.Utils.ensighten({page_name:"account_blocked_error",page_type:"general"}),n.trackPage("login/account_blocked",{funnel:!1}),a.updateDatalayer(),Odigeo.Utils.sessionTimer.reset()}},function(e,t,i){"use strict";var n,a,s,r;n=i(0),a=i(499),s=i(592),r=i(40),Odigeo.Router.handlers.frequentpassengers=function(e){var t=$("#page"),i=r({xsellFindBooking:["my-trips-with-find-booking",s]});t.removeClass().addClass("frequentpassengers"),Odigeo.Router.eventController=$.extend(Odigeo.Router.eventController,Odigeo.Router.handlers.userEventController),Odigeo.Router.eventController=$.extend(!0,Odigeo.Router.eventController,{globalEvents:{"users-manager:getAccountInfoOk":"onGetAccountInfo","global:onGetDataError":"onGetDataError","global:userLogout":"onGoToHomePage","users-manager:updateAccountInfoOk":"onFrequentPassengersRequest","users-manager:updateAccountInfoWithError":"onFrequentPassengersRequest","users-manager:updateAccountInfoError":"onFrequentPassengersRequest","frequent-passengers-manager:changePageTitle":"onChangePageTitle","frequent-passengers-manager:submitUserRequest":"onUserManagerRequest"},eventHandlers:{onGetDataError:function(e){a.processError(e)},onGoToHomePage:function(){Odigeo.Utils.goToApplicationHome()},onFrequentPassengersRequest:function(e){o(e)},onUserManagerRequest:function(e,t){c(e,t)},onChangePageTitle:function(e){d(e)},onGetAccountInfo:function(e){$("#myInfoUserName").text(e.displayName?e.displayName:""),o(e)}}}),Odigeo.Router.eventController.execute();var o,c,d,l=$("#personal_area_menu"),g=Odigeo.UIElements.menu.enhanceMenu(l),h=$(".freq_pass_edit_title"),u=$(".freq_pass_main_title"),p=$(".freq_pass_notification_error");o=function(e){Odigeo.requireWidget("frequent-passengers-manager","frequent_passengers_manager",function(t){t.execute(e.action,e)}),Odigeo.requireWidget("download-app-banner","download_app_banner",function(e){e.execute("trackEventCategory","my_area_pax")})},c=function(e,t){var i=t?e.action:"submitUserRequest",n=t?e.data:e;Odigeo.requireWidget("users-manager","usersmanager",function(e){e.execute(i,n)})},d=function(e){l.data("track-action","sidebar").data("track-category","my_area_pax"),h.toggleClass("hidden","edit"!==e&&"new"!==e),u.toggleClass("hidden","edit"===e||"new"===e)},p.toggleClass("hidden",!0),o({action:"setUserID",userID:e}),d("main"),c({data:"",action:"getAccountInfo"}),g&&(g.trigger("changeSelectedMenu",t.attr("class")),i.get("xsellFindBooking").execute("emptyFindBookings")),n.trackPage("account/frequent_travelers",{funnel:!1})}},function(e,t,i){"use strict";var n,a,s,r,o,c,d,l,g;n=i(0),a=i(7),s=i(499),r=i(840),o=i(843),c=i(846),d=i(849),l=i(592),g=i(40),Odigeo.Router.handlers.accountpreferences=function(){var e=$("#page"),t=Odigeo.autoloadWidgetsAsync({getAccountPreferencesManager:["account-preferences-manager","account_preferences_manager"],getMembershipManager:["membership-manager","membership_manager"],getUsersManager:["users-manager","usersmanager"]}),i=g({membershipAccountBilling:["membership-account-billing",r],membershipBillingInformation:["membership-billing-information",o],membershipCardInfoManager:["membership-card-info-manager",c],membershipDefaultBilling:["membership-default-billing",d],xsellFindBooking:["my-trips-with-find-booking",l]});e.removeClass().addClass("accountpreferences"),Odigeo.Router.eventController=$.extend(Odigeo.Router.eventController,Odigeo.Router.handlers.userEventController),Odigeo.Router.eventController=$.extend(!0,Odigeo.Router.eventController,{globalEvents:{"account-preferences-manager:changePageTitle":"onChangePageTitle","account-preferences-manager:submitUserRequest":"onUserManagerRequest","cancel-account:submitUserRequest":"onUserManagerRequest","account-preferences-manager:cancelAccount":"onUserManagerRequest","account-preferences-manager:changePassword":"onUserManagerRequest","account-preferences-manager:clearChangePasswordFieldsHide":"clearChangePasswordFields","membership-account-preferences:renderOk":"onMembershipAccountPreferencesRendered","users-manager:getAccountInfoOk":"onGetAccountInfo","users-manager:getCreditCardOk":"onGetCreditCard","users-manager:addCreditCardsOk":"onAddCreditCardsOk","users-manager:addCreditCardsWithError":"onFailedToAddCreditCard","users-manager:deleteCreditCardsOk":"onGetCreditCard","global:onGetDataError":"onGetDataError","global:userLogout":"onGoToHomePage","users-manager:changePasswordOk":"onAccountPreferencesRequest","users-manager:changePasswordWithError":"onAccountPreferencesRequest","users-manager:changePasswordError":"onAccountPreferencesRequest","users-manager:cancelAccountOk":"onAccountPreferencesRequest","users-manager:cancelAccountError":"onAccountPreferencesRequest","users-manager:cancelAccountWithError":"onAccountPreferencesRequest","membership-manager:enableAutoRenewalOk":"onAutoRenewalOk","membership-manager:disableAutoRenewalOk":"onAutoRenewalOk","membership-manager:getSubscriptionDetailsOk":"onGetSubscriptionDetailsOk","membership-account-billing:onDisableAutoRenewal":"onDisableAutoRenewal","membership-account-billing:onEnableAutoRenewal":"onEnableAutoRenewal","membership-billing-information:addCreditCard":"onAddCreditCard","membership-billing-information:deleteCreditCard":"onDeleteCreditCard","membership-billing-information:updateCreditCardList":"onUpdateCreditCardList","membership-billing-information:billingCardsAvailable":"onBillingCardsAvailable","membership-card-info-manager:submitCCData":"onSubmitCCData","membership-cancel-account:cancelAccountClose":"onCancelAccountClose","membership-default-billing:getSubscriptionDetails":"onGetSubscriptionDetails"},eventHandlers:{onGetDataError:function(e){s.processError(e)},onGoToHomePage:function(){Odigeo.Utils.goToApplicationHome()},onAccountPreferencesRequest:function(e){h(e)},onUserManagerRequest:function(e){u(e)},onChangePageTitle:function(){p()},onGetAccountInfo:function(e){$("#myInfoUserName").text(e.displayName?e.displayName:""),h(e)},clearChangePasswordFields:function(e){Odigeo.requireWidget("account-preferences-manager","account_preferences_manager",function(t){t.execute("clearChangePasswordFields",e)})},onEnableAutoRenewal:function(){t.getMembershipManager().execute("enableAutoRenewal")},onDisableAutoRenewal:function(){t.getMembershipManager().execute("disableAutoRenewal")},onMembershipAccountPreferencesRendered:function(e){i.get("membershipCardInfoManager"),i.get("membershipDefaultBilling"),i.get("membershipBillingInformation"),i.get("membershipAccountBilling").execute("updateModel",e)},onAutoRenewalOk:function(){i.get("membershipAccountBilling").execute("onAutoRenewalOk")},onGetSubscriptionDetailsOk:function(e){i.get("membershipDefaultBilling").execute("setSubscriptionDetails",e)},onGetCreditCard:function(e){i.get("membershipBillingInformation").execute("setUserDTO",e),i.get("membershipCardInfoManager").execute("setCCFormError",!1)},onAddCreditCardsOk:function(e){i.get("membershipBillingInformation").execute("setUserDTO",e),i.get("membershipCardInfoManager").execute("onCreditCardAdded")},onFailedToAddCreditCard:function(){i.get("membershipCardInfoManager").execute("onFailedCreditCardAdded")},onAddCreditCard:function(){i.get("membershipCardInfoManager").execute("displayAddCCModal")},onDeleteCreditCard:function(e){t.getUsersManager().execute("submitUserRequest",{data:e,action:"deleteCreditCards"})},onUpdateCreditCardList:function(){t.getUsersManager().execute("submitUserRequest",{data:"",action:"getCreditCard"})},onSubmitCCData:function(e){t.getUsersManager().execute("submitUserRequest",{action:"addCreditCards",data:e})},onCancelAccountClose:function(){t.getAccountPreferencesManager().execute("closeCancelAccountView")},onGetSubscriptionDetails:function(){t.getMembershipManager().execute("getSubscriptionDetails")},onBillingCardsAvailable:function(e){i.get("membershipDefaultBilling").execute("setBillingCardAvailable",e)}}}),Odigeo.Router.eventController.execute();var h,u,p,f=$("#personal_area_menu"),m=Odigeo.UIElements.menu.enhanceMenu(f);u=function(e){Odigeo.requireWidget("users-manager","usersmanager",function(t){t.execute("submitUserRequest",e)})},p=function(){f.data("track-action","sidebar").data("track-category","my_area_account")},(h=function(e){Odigeo.requireWidget("account-preferences-manager","account_preferences_manager",function(t){t.execute(e.action,e)}),Odigeo.requireWidget("download-app-banner","download_app_banner",function(e){e.execute("trackEventCategory","my_area_account")})})({action:"loadUser",data:""}),p("main"),u({data:"",action:"getAccountInfo"}),m&&(m.trigger("changeSelectedMenu",e.attr("class")),i.get("xsellFindBooking").execute("emptyFindBookings")),Odigeo.Utils.ensighten({page_name:"accountpreferences",page_type:"general"}),n.trackPage("account/preferences",{funnel:!1}),a.updateDatalayer()}},function(e,t,i){"use strict";var n,a,s,r,o,c,d;n=i(0),a=i(7),s=i(499),r=i(590),o=i(591),c=i(592),d=i(40),Odigeo.Router.handlers.mytrips=function(e){var t=$("#page"),i=$("body"),l=$("#myInfo"),g=Odigeo.autoloadWidgetsAsync({getUsersManager:["users-manager","usersmanager"],getPostBookingSeats:["post-booking-seats","post_booking_seats"],getPostBookingBags:["post-booking-bags","post_booking_bags"],getMyTrips:["my-trips","my_trips"]}),h=d({xsellFindBooking:["my-trips-with-find-booking",c]});t.removeClass().addClass("mytrips"),Odigeo.Router.eventController=$.extend(Odigeo.Router.eventController,Odigeo.Router.handlers.userEventController),Odigeo.Router.eventController=$.extend(!0,Odigeo.Router.eventController,Odigeo.Router.handlers.searchSummaryEventController),Odigeo.Router.eventController=$.extend(!0,Odigeo.Router.eventController,r,{globalEvents:{"session:loginexpiration":"onLoginExpiration"},viewEvents:{"my-trips:changePageTitle":"onChangePageTitle","my-trips:showCanFindBooking":"onShowCanFindBooking","my-trips:hideCanFindBooking":"onHideCanFindBooking","my-trips:hideManageMyBookingBox":"onHideManageMyBookingBox","my-trips:showManageMyBookingBox":"onShowManageMyBookingBox","global:onGetDataError":"onGetDataError","global:userLogout":"onGoToHomePage","users-manager:getMyTripsWithError":"onGetDataError","users-manager:getMyTripsError":"onGetDataError","users-manager:getMyTripsOk":"onGetMyTripsOk","users-manager:getEncryptedTripOk":"onGetEncryptedTripOk","users-manager:getEncryptedTripWithError":"onGetEncryptedTripError","users-manager:getEncryptedTripError":"onGetEncryptedTripError","bags_and_seats_offline:loadBags":"onLoadBags","bags_and_seats_offline:loadSeats":"onLoadSeats","post-booking-bags:bagsAvailable":"onBagsAvailable","post-booking-seats:seatsAvailable":"onSeatsAvailable","my-trips:changeCategoryTracking":"onChangeCategoryTracking","my-trips:dataTrackNoTrips":"onDataTrackNoTrips","users-manager:getManageBookingTokenOk":"onGetManageBookingTokenOK"},eventHandlers:{onLoadBags:function(e){i.addClass("od-vertical-scroll"),Odigeo.Session.set("bookingInfo",JSON.stringify(e)),g.getPostBookingBags().execute("open"),g.getUsersManager().execute("loadTripBags",e)},onLoadSeats:function(e){i.addClass("od-vertical-scroll"),Odigeo.Session.set("bookingInfo",JSON.stringify(e)),g.getPostBookingSeats().execute("open"),g.getUsersManager().execute("loadTripSeats",e)},onBagsAvailable:function(e){var t=Odigeo.Utils.parseJson(Odigeo.Session.get("bookingInfo"));Odigeo.Session.set("ancillaryInfo",JSON.stringify(e.availableAncillariesOptionsDTO)),Odigeo.trigger("my-trips:openAddBags",t,e.availableAncillariesOptionsDTO)},onSeatsAvailable:function(e){var t=Odigeo.Utils.parseJson(Odigeo.Session.get("bookingInfo"));Odigeo.Session.set("ancillaryInfo",JSON.stringify(e.availableAncillariesOptionsDTO)),Odigeo.trigger("my-trips:openAddSeats",t,e.availableAncillariesOptionsDTO)},onGoToHomePage:function(){Odigeo.Utils.goToApplicationHome()},onChangePageTitle:function(){O()},onGetDataError:function(e){s.processError(e)},onGetMyTripsOk:function(e){var t=o.retrieveBookingInfoFromToken(m,y,e);t.bookingID=t.bookingID||C,_.isNumber(t.bookingID)?o.navigateToBooking(t,e):(t.error&&g.getMyTrips().execute("openLightBoxMsg",t.error),w(e))},onShowCanFindBooking:function(e){h.get("xsellFindBooking").execute("renderTemplate",e)},onHideCanFindBooking:function(){h.get("xsellFindBooking").execute("emptyFindBookings")},onChangeCategoryTracking:function(e){T(e)},onDataTrackNoTrips:function(e){l.find("#personal_area_menu").data("track-action",e.action).data("track-category",e.category),Odigeo.requireWidget("download-app-banner","download_app_banner",function(t){t.execute("dataTrack",e.category)})},onLoginExpiration:function(){g.getMyTrips().execute("clearEML")},onHideManageMyBookingBox:function(){g.getMyTrips().execute("hideManageMyBookingBox",f)},onShowManageMyBookingBox:function(e){g.getUsersManager().execute("submitUserRequest",{data:e,action:"getManageBookingToken"})},onGetManageBookingTokenOK:function(e){g.getMyTrips().execute("showManageMyBookingBox",{box:f,response:e})},onGetEncryptedTripOk:function(e){C=e.bookingDetailDTO.bookingBasicInfo.id,o.requestMyTrips()},onGetEncryptedTripError:function(e){o.requestMyTrips(),g.getMyTrips().execute("openLightBoxMsg",e.messageError)}}}),Odigeo.Router.eventController.execute(),r.init(i,"od-vertical-scroll");var u=$("#personal_area_menu"),p=Odigeo.UIElements.menu.enhanceMenu(u),f=u.find(".manage_my_booking_menu"),m=Odigeo.Session.get("tdid"),b=Odigeo.Session.get("td"),y=Odigeo.Session.get("tdo"),v=Odigeo.History.getFragment().split("/")[1],S=""!==v&&!_.isNaN(v),C=void 0,w=function(t){$("#myInfoUserName").text(t.displayName?t.displayName:""),(t.selectedBooking=e)&&Odigeo.trigger("my-trips:hideCanFindBooking"),g.getMyTrips().execute(t.action,t),g.getPostBookingBags().execute("clearBagSelections"),g.getPostBookingSeats().execute("clearSeatSelections")},O=function(){u.data("track-action","sidebar").data("track-category","my_area_trips")};O("main"),_.isEmpty(b)?(Odigeo.Session.remove("tdid"),Odigeo.Session.remove("tdo"),o.requestMyTrips()):(Odigeo.Session.remove("td"),o.requestEncriptedTrip(b));var T=function(e){Odigeo.requireWidget("download-app-banner","download_app_banner",function(t){t.execute("trackEventCategory",e)})};p&&p.trigger("changeSelectedMenu",t.attr("class")),Odigeo.once("routeChange",function(){Odigeo.AB.isManageMyBookingDesktop&&g.getMyTrips().execute("hideManageMyBookingBox",f)}),Odigeo.Utils.ensighten({page_name:"mytrips",page_type:"general"}),S||n.trackPage("mytrips",{funnel:!1}),a.updateDatalayer()}},function(e,t,i){"use strict";var n,a,s;n=i(0),a=i(7),s=i(139).getRememberMeCookieField,Odigeo.Router.handlers.loginexpired=function(){var e="loginexpired";$("#page").removeClass().addClass(e),Odigeo.Router.eventController=$.extend(Odigeo.Router.eventController,Odigeo.Router.handlers.userEventController),Odigeo.Router.eventController=$.extend(!0,Odigeo.Router.eventController,{globalEvents:{"login-expired-manager:submitUserRequest":"onUserManagerRequest","login-expired-login-form:submitUserRequest":"onUserManagerRequest","global:userLogged":"onLoginExpiredLoginOK","users-manager:loginWithError":"onLoginExpiredLoginError","users-manager:loginError":"onLoginExpiredLoginError","users-manager:logOutOk":"onGoToHomePage","users-manager:loginWithFacebookOk":"onSocialLoginOk","users-manager:loginWithGoogleOk":"onSocialLoginOk","users-manager:isLoggedInOk":"onGoToHomePage","recaptcha:loaded":"onRecaptchaLoaded"},eventHandlers:{onLoginExpiredLoginOK:function(){var e="mail"===s("loginType");n.trackEventWithCategory("signin_successful_message","sign_in","sso_expired"),e&&t()},onLoginExpiredLoginError:function(e){Odigeo.requireWidget("login-expired-manager","login_expired_manager",function(t){t.execute("showLoginError",e)})},onUserManagerRequest:function(e,t){var i=t?e.action:"submitUserRequest",n=t?e.data:e;Odigeo.requireWidget("users-manager","usersmanager",function(e){e.execute(i,n)})},onGoToHomePage:function(){Odigeo.Utils.goToApplicationHome()},onSocialLoginOk:function(){t()},onRecaptchaLoaded:function(){Odigeo.requireWidget("login-expired-manager","login_expired_manager",function(e){e.execute("renderCaptcha")})}}}),Odigeo.Router.eventController.execute();var t=function(){var e=Odigeo.Utils.parseJson(Odigeo.Session.get("lastRouteChange")),t=_.get(e,"from.name","home");"home"===t?Odigeo.Utils.goToApplicationHome():Odigeo.Router.navigate(t)};Odigeo.Utils.ensighten({page_name:e,page_type:"general"}),n.trackPage(e,{funnel:!1}),a.updateDatalayer()}},function(e,t,i){"use strict";var n,a,s,r;n=i(0),a=i(7),s=i(56),r=i(40),Odigeo.Router.handlers.mytripslogin=function(){var e=r({login:["my-trips-login-form",s]}),t="mytripslogin";$("#page").removeClass().addClass(t),Odigeo.Router.eventController=$.extend(!0,Odigeo.Router.eventController,Odigeo.Router.handlers.userEventController,{globalEvents:{"global:userLogged":"onLoginMT","global:loginOk":"onLoginMT","global:userNotLoggedRemembered":"onLoginMT","global:loginWithError":"onLoginEventsMT","global:loginError":"onLoginEventsMT","global:recoverPasswordOk":"onLoginEventsMT","global:recoverPasswordWithError":"onLoginEventsMT","global:recoverPasswordError":"onLoginEventsMT"},viewEvents:{"my-trips-login-form:submitUserRequest":"onSubmitUserRequestMT","my-trips-login-form:openRegister":"onOpenRegisterMT","my-trips-login-form:userLoggedMT":"onLoginMT","mytripslogin:openRegister":"onOpenRegisterMT","mytripslogin:submitUserRequest":"onSubmitUserRequestMT","users-manager:getTripWithError":"onLoadEventError","users-manager:getTripError":"onLoadEventError","users-manager:getTripOk":"onLoadEvent","mytripslogin:renderOk":"onMyTripsLoginRenderOk","mytripslogin:loadTripOK":"onLoadTripOK","recaptcha:loaded":"onRecaptchaLoaded"},eventHandlers:{onSubmitUserRequestMT:function(e){Odigeo.requireWidget("users-manager","usersmanager",function(t){t.execute("submitUserRequest",e)})},onLoginMT:function(){_.defer(_.bind(Odigeo.Router.navigate,Odigeo.Router),"mytrips")},onOpenRegisterMT:function(){"register"===Odigeo.History.getPageNameFromFragment()?e.get("login").execute("closeConnectorsLayer"):Odigeo.Router.navigate("register")},onLoginEventsMT:function(t){e.get("login").execute(t.action,t)},onLoadEvent:function(e){Odigeo.requireWidget("mytripslogin","my_trips_login",function(t){t.execute(e.action,e)})},onLoadEventError:function(e){Odigeo.requireWidget("mytripslogin","my_trips_login",function(t){t.execute("getTripError",e)})},onLoadTripOK:function(e){Odigeo.Session.set("bookingInfo",JSON.stringify(e.bookingDetailDTO)),Odigeo.Router.navigate("tripdetails")},onRecaptchaLoaded:function(){e.get("login").execute("renderCaptcha",!0)},onMyTripsLoginRenderOk:function(){e.get("login")}}}),Odigeo.Router.eventController.execute(),Odigeo.Utils.ensighten({page_name:t,page_type:"general"}),n.trackPage(t,{funnel:!1}),a.updateDatalayer()}},function(e,t,i){"use strict";var n=i(0),a=i(148),s=i(853);Odigeo.Router.handlers.post_booking=function(e){var t=_.isEqual(Odigeo.Utils.parseHashParameters(e).product,"accommodation"),i="post_booking",r=$("#page"),o=Odigeo.autoloadWidgetsAsync({getUsersManager:["users-manager","usersmanager"],getPaymentBags:["post-booking-payment-bags","payment"],getPostBooking:["post-booking","post_booking"],getPostBookingBags:["post-booking-bags","post_booking_bags"],getPostBookingSeats:["post-booking-seats","post_booking_seats"]}),c=a.parsePostBookingParams(e);if(r.removeClass().addClass(i),Odigeo.Router.eventController=$.extend(!0,Odigeo.Router.eventController,Odigeo.Router.handlers.userEventController,{viewEvents:{"post-booking:loadTrip":"onLoadTrip","post-booking:noParams":"onTripLoadError","post-booking-bags:bagsAvailable":"onBagsAvailable","post-booking-bags:noBagsAvailable":"onNoBagsAvailable","post-booking-seats:seatsAvailable":"onSeatsAvailable","post-booking-seats:noSeatsAvailable":"onNoSeatsAvailable","users-manager:getTripOk":"onTripLoadOk","users-manager:getTripWithError":"onTripLoadError","users-manager:getTripError":"onTripLoadError","users-manager:getBagsOk":"onBagsLoaded","users-manager:getBagsWithError":"onNoBagsAvailable","users-manager:getBagsError":"onNoBagsAvailable","users-manager:getSeatsOk":"onSeatsLoaded","users-manager:getSeatsWithError":"onNoSeatsAvailable","users-manager:getSeatsError":"onNoSeatsAvailable"},eventHandlers:{onLoadTrip:function(e){o.getUsersManager().execute("submitUserRequest",e),o.getPostBookingBags().execute("clearBagSelections"),o.getPostBookingSeats().execute("clearSeatSelections")},onTripLoadOk:function(e){switch(Odigeo.Session.set("bookingInfo",JSON.stringify(e.bookingDetailDTO)),c.product){case a.availableProducts.none:Odigeo.Router.navigate("tripdetails");break;case a.availableProducts.bags:o.getUsersManager().execute("loadTripBags",e.bookingDetailDTO);break;case a.availableProducts.seats:Odigeo.AB.isPostBookingSeatsDesktop?o.getUsersManager().execute("loadTripSeats",e.bookingDetailDTO):Odigeo.Router.navigate("tripdetails");break;default:Odigeo.Router.navigate("tripdetails")}},onTripLoadError:function(e){o.getPostBooking().execute("bookingNotFound",e)},onBagsLoaded:function(e){o.getPostBookingBags().execute("checkAvailableBags",e)},onBagsAvailable:function(e){Odigeo.Session.set("ancillaryInfo",JSON.stringify(e.availableAncillariesOptionsDTO)),Odigeo.Router.navigate("tripdetails",{params:"showFlightInfo=true;product="+c.product})},onNoBagsAvailable:function(){n.trackEventWithCategory("post_booking","baggage_offline_no-available","baggage_offline_no-available_appearances"),Odigeo.Router.navigate("tripdetails")},onSeatsLoaded:function(e){o.getPostBookingSeats().execute("checkAvailableSeats",e)},onSeatsAvailable:function(e){Odigeo.Session.set("ancillaryInfo",JSON.stringify(e.availableAncillariesOptionsDTO)),Odigeo.Router.navigate("tripdetails",{params:"showFlightInfo=true;product="+c.product})},onNoSeatsAvailable:function(){n.trackEventWithCategory("post_booking","seats_offline_no-available","seats_offline_no-available_appearances"),Odigeo.Router.navigate("tripdetails")}}},t&&s),Odigeo.Router.eventController.execute(),t&&(Odigeo.Session.set("wapb3",Odigeo.Utils.parseHashParameters(e).wapb3),Odigeo.Session.set("label",Odigeo.Utils.parseHashParameters(e).label),s.showWaitingPage(),Odigeo.Session.set("isAccommodationPostBooking",!0),n.trackPage("waiting/1"),n.startMetric("LOAD_ACCOMMODATION_POSTBOOKING")),c){var d={data:{queryParams:{email:c.email,bookingid:c.bookingId}},action:"getTrip"};Odigeo.trigger("post-booking:loadTrip",d)}else Odigeo.trigger("post-booking:noParams",{});t||(Odigeo.Utils.ensighten({page_name:i,page_type:"general"}),n.trackPage(i,{funnel:!1}))}},function(e,t,i){"use strict";var n=i(590),a=i(148),s=i(591);Odigeo.Router.handlers.tripdetails=function(e){var t="tripdetails",i=$("#page"),r=$("body"),o=Odigeo.Session.get("bookingInfo"),c=Odigeo.Session.get("ancillaryInfo"),d=_.defaults({},Odigeo.Utils.parseHashParameters(e),{showFlightInfo:!1}),l=Odigeo.autoloadWidgetsAsync({getUsersManager:["users-manager","usersmanager"],getPostBookingBags:["post-booking-bags","post_booking_bags"],getPostBookingSeats:["post-booking-seats","post_booking_seats"],getSeatMap:["seatmap-desktop","seatmap_desktop"],getOpenMyTrips:["openmytrips","my_trips"]}),g=$(".trip_details_menu"),h=g.find(".manage_my_booking_menu"),u=g.find(".create_account_item");i.removeClass().addClass(t),Odigeo.Router.eventController=$.extend(!0,Odigeo.Router.eventController,Odigeo.Router.handlers.userEventController,n,{globalEvents:{"global:loginOk":"onLoginOkMT","global:userNotLoggedRemembered":"onNotLoggedUser","global:userLogged":"onLoginOkMT","global:isLoggedInWithError":"onIsLoggedInWithError","global:userLogout":"onNotLoggedUser"},viewEvents:{"bags_and_seats_offline:loadBags":"onLoadBags","bags_and_seats_offline:loadSeats":"onLoadSeats","post-booking-bags:bagsAvailable":"onBagsAvailable","post-booking-seats:seatsAvailable":"onSeatsAvailable","users-manager:getEncryptedTripWithError":"onGetEncryptedTripError","users-manager:getEncryptedTripError":"onGetEncryptedTripError","users-manager:getEncryptedTripOk":"onGetEncryptedTripOk","openmytrips:hideManageMyBookingBox":"onHideManageMyBookingBox","openmytrips:showManageMyBookingBox":"onShowManageMyBookingBox","users-manager:getManageBookingTokenOk":"onGetManageBookingTokenOK","users-manager:getTripWithError":"onGetTripError","users-manager:getTripError":"onGetTripError","users-manager:getTripOk":"onGetTripOk"},eventHandlers:{onLoginOkMT:function(){var e=d.td,t=d.tdo;_.isEmpty(e)?_.isEmpty(t)||Odigeo.Session.set("tdo",t):Odigeo.Session.set("td",e),_.defer(_.bind(Odigeo.Router.navigate,Odigeo.Router),"mytrips")},onNotLoggedUser:function(){u.toggleClass("hidden")},onLoadBags:function(e){r.addClass("od-vertical-scroll"),l.getPostBookingBags().execute("open"),l.getUsersManager().execute("loadTripBags",e)},onLoadSeats:function(e){r.addClass("od-vertical-scroll"),l.getPostBookingSeats().execute("open"),l.getUsersManager().execute("loadTripSeats",e)},onBagsAvailable:function(e){var t=Odigeo.Utils.parseJson(Odigeo.Session.get("bookingInfo"));Odigeo.Session.set("ancillaryInfo",JSON.stringify(e.availableAncillariesOptionsDTO)),Odigeo.trigger("trip-details:openAddBags",t,e.availableAncillariesOptionsDTO,!1)},onSeatsAvailable:function(e){var t=Odigeo.Utils.parseJson(Odigeo.Session.get("bookingInfo"));Odigeo.Session.set("ancillaryInfo",JSON.stringify(e.availableAncillariesOptionsDTO)),Odigeo.trigger("trip-details:openAddSeats",t,e.availableAncillariesOptionsDTO,!1)},onGetEncryptedTripError:function(){Odigeo.Session.remove("bookingInfo"),Odigeo.Router.navigate("mytripslogin")},onGetEncryptedTripOk:function(e){Odigeo.Session.remove("bookingInfo"),l.getOpenMyTrips().execute("loadOpenBookingDetails",e.bookingDetailDTO)},onHideManageMyBookingBox:function(){l.getOpenMyTrips().execute("hideManageMyBookingBox",h)},onShowManageMyBookingBox:function(e){l.getUsersManager().execute("submitUserRequest",{data:e,action:"getManageBookingToken"})},onGetManageBookingTokenOK:function(e){l.getOpenMyTrips().execute("showManageMyBookingBox",{box:h,response:e})},onIsLoggedInWithError:function(){var e=d.td,t=d.tdo;if(_.isEmpty(e))if(_.isEmpty(t))_.isEmpty(o)?Odigeo.Router.navigate("mytripslogin"):p();else{var i=s.extractTokenFromDeeplink(t);_.isEmpty(i.email)?this.onGetEncryptedTripError():s.requestTrip(i)}else s.requestEncriptedTrip(e)},onGetTripError:function(){this.onGetEncryptedTripError()},onGetTripOk:function(e){o=JSON.stringify(e.bookingDetailDTO),p()}}}),Odigeo.Router.eventController.execute(),n.init(r,"od-vertical-scroll");var p=function(){if(d.showFlightInfo)switch(d.showFlightInfo=!1,d.product){case a.availableProducts.bags:l.getPostBookingBags().execute("open"),Odigeo.trigger("trip-details:openAddBags",Odigeo.Utils.parseJson(o),Odigeo.Utils.parseJson(c),!0);break;case a.availableProducts.seats:Odigeo.AB.isPostBookingSeatsDesktop&&(l.getPostBookingSeats().execute("open"),Odigeo.trigger("trip-details:openAddSeats",Odigeo.Utils.parseJson(o),Odigeo.Utils.parseJson(c),!1));break;case a.availableProducts.none:}l.getOpenMyTrips().execute("loadOpenBookingDetails",Odigeo.Utils.parseJson(o))};o&&p(),Odigeo.once("routeChange",function(){Odigeo.AB.isManageMyBookingDesktop&&l.getOpenMyTrips().execute("hideManageMyBookingBox",h)}),Odigeo.Utils.ensighten({page_name:t,page_type:"general"})}},function(e,t,i){"use strict";Odigeo.Router.handlers.metaancillaries=function(){var e=$("#metaancillaries"),t=Odigeo.autoloadWidgetsAsync({getSpecialrequestManager:["specialrequest","special_request_manager"]});Odigeo.UIElements.enhanceLoading($(".waiting_page")).hideLoading(),e.find(".ancillaries_page_step_button").on(Odigeo.Events.tap,_.bind(_.debounce(function(){t.getSpecialrequestManager().execute("setBookingUserComments").then(function(){Odigeo.Router.navigate("payment")})},1e3),this))}}]);
